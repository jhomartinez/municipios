/*! jQuery v1.9.1 | (c) 2005, 2012 jQuery Foundation, Inc. | jquery.org/license
*/(function(e,t){var n,r,i=typeof t,o=e.document,a=e.location,s=e.jQuery,u=e.$,l={},c=[],p="1.9.1",f=c.concat,d=c.push,h=c.slice,g=c.indexOf,m=l.toString,y=l.hasOwnProperty,v=p.trim,b=function(e,t){return new b.fn.init(e,t,r)},x=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/^[\],:{}\s]*$/,E=/(?:^|:|,)(?:\s*\[)+/g,S=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,A=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,j=/^-ms-/,D=/-([\da-z])/gi,L=function(e,t){return t.toUpperCase()},H=function(e){(o.addEventListener||"load"===e.type||"complete"===o.readyState)&&(q(),b.ready())},q=function(){o.addEventListener?(o.removeEventListener("DOMContentLoaded",H,!1),e.removeEventListener("load",H,!1)):(o.detachEvent("onreadystatechange",H),e.detachEvent("onload",H))};b.fn=b.prototype={jquery:p,constructor:b,init:function(e,n,r){var i,a;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:o,!0)),C.test(i[1])&&b.isPlainObject(n))for(i in n)b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(a=o.getElementById(i[2]),a&&a.parentNode){if(a.id!==i[2])return r.find(e);this.length=1,this[0]=a}return this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return h.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(h.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:d,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},u=2),"object"==typeof s||b.isFunction(s)||(s={}),l===u&&(s=this,--u);l>u;u++)if(null!=(o=arguments[u]))for(i in o)e=s[i],r=o[i],s!==r&&(c&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,a=e&&b.isArray(e)?e:[]):a=e&&b.isPlainObject(e)?e:{},s[i]=b.extend(c,a,r)):r!==t&&(s[i]=r));return s},b.extend({noConflict:function(t){return e.$===b&&(e.$=u),t&&e.jQuery===b&&(e.jQuery=s),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?!--b.readyWait:!b.isReady){if(!o.body)return setTimeout(b.ready);b.isReady=!0,e!==!0&&--b.readyWait>0||(n.resolveWith(o,[b]),b.fn.trigger&&b(o).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!y.call(e,"constructor")&&!y.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||y.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=C.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=b.trim(n),n&&k.test(n.replace(S,"@").replace(A,"]").replace(E,"")))?Function("return "+n)():(b.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(j,"ms-").replace(D,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(a){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:v&&!v.call("\ufeff\u00a0")?function(e){return null==e?"":v.call(e)}:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?b.merge(n,"string"==typeof e?[e]:e):d.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(g)return g.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else while(n[o]!==t)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(s[s.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(s[s.length]=r);return f.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),b.isFunction(e)?(r=h.call(arguments,2),i=function(){return e.apply(n||this,r.concat(h.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,o,a,s){var u=0,l=e.length,c=null==r;if("object"===b.type(r)){o=!0;for(u in r)b.access(e,n,u,r[u],!0,a,s)}else if(i!==t&&(o=!0,b.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(b(e),n)})),n))for(;l>u;u++)n(e[u],r,s?i:i.call(e[u],u,n(e[u],r)));return o?e:c?n.call(e):l?n(e[0],r):a},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n)if(n=b.Deferred(),"complete"===o.readyState)setTimeout(b.ready);else if(o.addEventListener)o.addEventListener("DOMContentLoaded",H,!1),e.addEventListener("load",H,!1);else{o.attachEvent("onreadystatechange",H),e.attachEvent("onload",H);var r=!1;try{r=null==e.frameElement&&o.documentElement}catch(i){}r&&r.doScroll&&function a(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(a,50)}q(),b.ready()}}()}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function M(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}r=b(o);var _={};function F(e){var t=_[e]={};return b.each(e.match(w)||[],function(e,n){t[n]=!0}),t}b.Callbacks=function(e){e="string"==typeof e?_[e]||F(e):b.extend({},e);var n,r,i,o,a,s,u=[],l=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=u.length,n=!0;u&&o>a;a++)if(u[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,u&&(l?l.length&&c(l.shift()):r?u=[]:p.disable())},p={add:function(){if(u){var t=u.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);"function"===r?e.unique&&p.has(n)||u.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?o=u.length:r&&(s=t,c(r))}return this},remove:function(){return u&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,u,r))>-1)u.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}),this},has:function(e){return e?b.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],this},disable:function(){return u=l=r=t,this},disabled:function(){return!u},lock:function(){return l=t,r||p.disable(),this},locked:function(){return!l},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!u||i&&!l||(n?l.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,o){var a=o[0],s=b.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=h.call(arguments),r=n.length,i=1!==r||e&&b.isFunction(e.promise)?r:0,o=1===i?e:b.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?h.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},s,u,l;if(r>1)for(s=Array(r),u=Array(r),l=Array(r);r>t;t++)n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(a(t,l,n)).fail(o.reject).progress(a(t,u,s)):--i;return i||o.resolveWith(l,n),o.promise()}}),b.support=function(){var t,n,r,a,s,u,l,c,p,f,d=o.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),r=d.getElementsByTagName("a")[0],!n||!r||!n.length)return{};s=o.createElement("select"),l=s.appendChild(o.createElement("option")),a=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==d.className,leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!a.value,optSelected:l.selected,enctype:!!o.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==o.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===o.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!l.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}a=o.createElement("input"),a.setAttribute("value",""),t.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),t.radioValue="t"===a.value,a.setAttribute("checked","t"),a.setAttribute("name","t"),u=o.createDocumentFragment(),u.appendChild(a),t.appendChecked=a.checked,t.checkClone=u.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in{submit:!0,change:!0,focusin:!0})d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1;return d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip,b(function(){var n,r,a,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",u=o.getElementsByTagName("body")[0];u&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",u.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=d.getElementsByTagName("td"),a[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===a[0].offsetHeight,a[0].style.display="",a[1].style.display="none",t.reliableHiddenOffsets=p&&0===a[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===d.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==u.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(o.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(u.style.zoom=1)),u.removeChild(n),n=d=a=r=null)}),n=s=u=l=r=a=null,t}();var O=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,B=/([A-Z])/g;function P(e,n,r,i){if(b.acceptData(e)){var o,a,s=b.expando,u="string"==typeof n,l=e.nodeType,p=l?b.cache:e,f=l?e[s]:e[s]&&s;if(f&&p[f]&&(i||p[f].data)||!u||r!==t)return f||(l?e[s]=f=c.pop()||b.guid++:f=s),p[f]||(p[f]={},l||(p[f].toJSON=b.noop)),("object"==typeof n||"function"==typeof n)&&(i?p[f]=b.extend(p[f],n):p[f].data=b.extend(p[f].data,n)),o=p[f],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[b.camelCase(n)]=r),u?(a=o[n],null==a&&(a=o[b.camelCase(n)])):a=o,a}}function R(e,t,n){if(b.acceptData(e)){var r,i,o,a=e.nodeType,s=a?b.cache:e,u=a?e[b.expando]:b.expando;if(s[u]){if(t&&(o=n?s[u]:s[u].data)){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in o?t=[t]:(t=b.camelCase(t),t=t in o?[t]:t.split(" "));for(r=0,i=t.length;i>r;r++)delete o[t[r]];if(!(n?$:b.isEmptyObject)(o))return}(n||(delete s[u].data,$(s[u])))&&(a?b.cleanData([e],!0):b.support.deleteExpando||s!=s.window?delete s[u]:s[u]=null)}}}b.extend({cache:{},expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!$(e)},data:function(e,t,n){return P(e,t,n)},removeData:function(e,t){return R(e,t)},_data:function(e,t,n){return P(e,t,n,!0)},_removeData:function(e,t){return R(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,o=this[0],a=0,s=null;if(e===t){if(this.length&&(s=b.data(o),1===o.nodeType&&!b._data(o,"parsedAttrs"))){for(r=o.attributes;r.length>a;a++)i=r[a].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),W(o,i,s[i]));b._data(o,"parsedAttrs",!0)}return s}return"object"==typeof e?this.each(function(){b.data(this,e)}):b.access(this,function(n){return n===t?o?W(o,e,b.data(o,e)):null:(this.each(function(){b.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}});function W(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(B,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:O.test(r)?b.parseJSON(r):r}catch(o){}b.data(e,n,r)}else r=t}return r}function $(e){var t;for(t in e)if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}b.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=b._data(e,n),r&&(!i||b.isArray(r)?i=b._data(e,n,b.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),o=b._queueHooks(e,t),a=function(){b.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),o.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=b.Deferred(),a=this,s=this.length,u=function(){--i||o.resolveWith(a,[a])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(s--)r=b._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(u));return u(),o.promise(n)}});var I,z,X=/[\t\r\n]/g,U=/\r/g,V=/^(?:input|select|textarea|button|object)$/i,Y=/^(?:a|area)$/i,J=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,G=/^(?:checked|selected)$/i,Q=b.support.getSetAttribute,K=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,u="string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):" ")){o=0;while(i=t[o++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=b.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,u=0===arguments.length||"string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):"")){o=0;while(i=t[o++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?b.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var o,a=0,s=b(this),u=t,l=e.match(w)||[];while(o=l[a++])u=r?u:!s.hasClass(o),s[u?"addClass":"removeClass"](o)}else(n===i||"boolean"===n)&&(this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];{if(arguments.length)return i=b.isFunction(e),this.each(function(n){var o,a=b(this);1===this.nodeType&&(o=i?e.call(this,n,a.val()):e,null==o?o="":"number"==typeof o?o+="":b.isArray(o)&&(o=b.map(o,function(e){return null==e?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,o,"value")!==t||(this.value=o))});if(o)return r=b.valHooks[o.type]||b.valHooks[o.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(U,""):null==n?"":n)}}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,u=0>i?s:o?i:0;for(;s>u;u++)if(n=r[u],!(!n.selected&&u!==i||(b.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&b.nodeName(n.parentNode,"optgroup"))){if(t=b(n).val(),o)return t;a.push(t)}return a},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var o,a,s,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return typeof e.getAttribute===i?b.prop(e,n,r):(a=1!==u||!b.isXMLDoc(e),a&&(n=n.toLowerCase(),o=b.attrHooks[n]||(J.test(n)?z:I)),r===t?o&&a&&"get"in o&&null!==(s=o.get(e,n))?s:(typeof e.getAttribute!==i&&(s=e.getAttribute(n)),null==s?t:s):null!==r?o&&a&&"set"in o&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r):(b.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(w);if(o&&1===e.nodeType)while(n=o[i++])r=b.propFix[n]||n,J.test(n)?!Q&&G.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(Q?n:r)},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!b.isXMLDoc(e),a&&(n=b.propFix[n]||n,o=b.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):V.test(e.nodeName)||Y.test(e.nodeName)&&e.href?0:t}}}}),z={get:function(e,n){var r=b.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),o="boolean"==typeof r?K&&Q?null!=i:G.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return o&&o.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}},K&&Q||(b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,n,r){return b.nodeName(e,"input")?(e.defaultValue=n,t):I&&I.set(e,n,r)}}),Q||(I=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:I.get,set:function(e,t,n){I.set(e,""===t?!1:t,n)}},b.each(["width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,n){return b.isArray(n)?e.checked=b.inArray(b(e).val(),n)>=0:t}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;function it(){return!0}function ot(){return!1}b.event={global:{},add:function(e,n,r,o,a){var s,u,l,c,p,f,d,h,g,m,y,v=b._data(e);if(v){r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=b.guid++),(u=v.events)||(u=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof b===i||e&&b.event.triggered===e.type?t:b.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(w)||[""],l=n.length;while(l--)s=rt.exec(n[l])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),p=b.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=b.event.special[g]||{},d=b.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&b.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=u[g])||(h=u[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),b.event.global[g]=!0;e=null}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,p,f,d,h,g,m=b.hasData(e)&&b._data(e);if(m&&(c=m.events)){t=(t||"").match(w)||[""],l=t.length;while(l--)if(s=rt.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){p=b.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=f.length;while(o--)a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a));u&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||b.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)b.event.remove(e,d+t[l],n,r,!0);b.isEmptyObject(c)&&(delete m.handle,b._removeData(e,"events"))}},trigger:function(n,r,i,a){var s,u,l,c,p,f,d,h=[i||o],g=y.call(n,"type")?n.type:n,m=y.call(n,"namespace")?n.namespace.split("."):[];if(l=f=i=i||o,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+b.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),u=0>g.indexOf(":")&&"on"+g,n=n[b.expando]?n:new b.Event(g,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:b.makeArray(r,[n]),p=b.event.special[g]||{},a||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!a&&!p.noBubble&&!b.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(l=l.parentNode);l;l=l.parentNode)h.push(l),f=l;f===(i.ownerDocument||o)&&h.push(f.defaultView||f.parentWindow||e)}d=0;while((l=h[d++])&&!n.isPropagationStopped())n.type=d>1?c:p.bindType||g,s=(b._data(l,"events")||{})[n.type]&&b._data(l,"handle"),s&&s.apply(l,r),s=u&&l[u],s&&b.acceptData(l)&&s.apply&&s.apply(l,r)===!1&&n.preventDefault();if(n.type=g,!(a||n.isDefaultPrevented()||p._default&&p._default.apply(i.ownerDocument,r)!==!1||"click"===g&&b.nodeName(i,"a")||!b.acceptData(i)||!u||!i[g]||b.isWindow(i))){f=i[u],f&&(i[u]=null),b.event.triggered=g;try{i[g]()}catch(v){}b.event.triggered=t,f&&(i[u]=f)}return n.result}},dispatch:function(e){e=b.event.fix(e);var n,r,i,o,a,s=[],u=h.call(arguments),l=(b._data(this,"events")||{})[e.type]||[],c=b.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){s=b.event.handlers.call(this,e,l),n=0;while((o=s[n++])&&!e.isPropagationStopped()){e.currentTarget=o.elem,a=0;while((i=o.handlers[a++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,u),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],u=n.delegateCount,l=e.target;if(u&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==e.type)){for(o=[],a=0;u>a;a++)i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?b(r,this).index(l)>=0:b.find(r,this,null,[l]).length),o[r]&&o.push(i);o.length&&s.push({elem:l,handlers:o})}return n.length>u&&s.push({elem:this,handlers:n.slice(u)}),s},fix:function(e){if(e[b.expando])return e;var t,n,r,i=e.type,a=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new b.Event(a),t=r.length;while(t--)n=r[t],e[n]=a[n];return e.target||(e.target=a.srcElement||o),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,a,s=n.button,u=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||o,a=i.documentElement,r=i.body,e.pageX=n.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&u&&(e.relatedTarget=u===e.target?n.toElement:u),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return b.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==o.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===o.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=o.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,n){return this instanceof b.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&b.extend(this,n),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0,t):new b.Event(e,n)},b.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;
return(!i||i!==r&&!b.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){return b.nodeName(this,"form")?!1:(b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return b.nodeName(this,"form")?!1:(b.event.remove(this,"._submit"),t)}}),b.support.changeBubbles||(b.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1):(b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=ot;else if(!i)return this;return 1===o&&(s=i,i=function(e){return b().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?b.event.trigger(e,n,r,!0):t}}),function(e,t){var n,r,i,o,a,s,u,l,c,p,f,d,h,g,m,y,v,x="sizzle"+-new Date,w=e.document,T={},N=0,C=0,k=it(),E=it(),S=it(),A=typeof t,j=1<<31,D=[],L=D.pop,H=D.push,q=D.slice,M=D.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},_="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=F.replace("w","w#"),B="([*^$|!~]?=)",P="\\["+_+"*("+F+")"+_+"*(?:"+B+_+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+O+")|)|)"+_+"*\\]",R=":("+F+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+P.replace(3,8)+")*)|.*)\\)|)",W=RegExp("^"+_+"+|((?:^|[^\\\\])(?:\\\\.)*)"+_+"+$","g"),$=RegExp("^"+_+"*,"+_+"*"),I=RegExp("^"+_+"*([\\x20\\t\\r\\n\\f>+~])"+_+"*"),z=RegExp(R),X=RegExp("^"+O+"$"),U={ID:RegExp("^#("+F+")"),CLASS:RegExp("^\\.("+F+")"),NAME:RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:RegExp("^("+F.replace("w","w*")+")"),ATTR:RegExp("^"+P),PSEUDO:RegExp("^"+R),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+_+"*(even|odd|(([+-]|)(\\d*)n|)"+_+"*(?:([+-]|)"+_+"*(\\d+)|))"+_+"*\\)|)","i"),needsContext:RegExp("^"+_+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+_+"*((?:-\\d)?\\d*)"+_+"*\\)|)(?=[^-]|$)","i")},V=/[\x20\t\r\n\f]*[+~]/,Y=/^[^{]+\{\s*\[native code/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,G=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,K=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{q.call(w.documentElement.childNodes,0)[0].nodeType}catch(nt){q=function(e){var t,n=[];while(t=this[e++])n.push(t);return n}}function rt(e){return Y.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function ot(e){return e[x]=!0,e}function at(e){var t=p.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function st(e,t,n,r){var i,o,a,s,u,l,f,g,m,v;if((t?t.ownerDocument||t:w)!==p&&c(t),t=t||p,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(!d&&!r){if(i=J.exec(e))if(a=i[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&y(t,o)&&o.id===a)return n.push(o),n}else{if(i[2])return H.apply(n,q.call(t.getElementsByTagName(e),0)),n;if((a=i[3])&&T.getByClassName&&t.getElementsByClassName)return H.apply(n,q.call(t.getElementsByClassName(a),0)),n}if(T.qsa&&!h.test(e)){if(f=!0,g=x,m=t,v=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){l=ft(e),(f=t.getAttribute("id"))?g=f.replace(K,"\\$&"):t.setAttribute("id",g),g="[id='"+g+"'] ",u=l.length;while(u--)l[u]=g+dt(l[u]);m=V.test(e)&&t.parentNode||t,v=l.join(",")}if(v)try{return H.apply(n,q.call(m.querySelectorAll(v),0)),n}catch(b){}finally{f||t.removeAttribute("id")}}}return wt(e.replace(W,"$1"),t,n,r)}a=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},c=st.setDocument=function(e){var n=e?e.ownerDocument||e:w;return n!==p&&9===n.nodeType&&n.documentElement?(p=n,f=n.documentElement,d=a(n),T.tagNameNoComments=at(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),T.attributes=at(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),T.getByClassName=at(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),T.getByName=at(function(e){e.id=x+0,e.innerHTML="<a name='"+x+"'></a><div name='"+x+"'></div>",f.insertBefore(e,f.firstChild);var t=n.getElementsByName&&n.getElementsByName(x).length===2+n.getElementsByName(x+0).length;return T.getIdNotName=!n.getElementById(x),f.removeChild(e),t}),i.attrHandle=at(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==A&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},T.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==A&&!d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==A&&!d){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==A&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=T.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==A?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},i.find.NAME=T.getByName&&function(e,n){return typeof n.getElementsByName!==A?n.getElementsByName(name):t},i.find.CLASS=T.getByClassName&&function(e,n){return typeof n.getElementsByClassName===A||d?t:n.getElementsByClassName(e)},g=[],h=[":focus"],(T.qsa=rt(n.querySelectorAll))&&(at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||h.push("\\["+_+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||h.push(":checked")}),at(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&h.push("[*^$]="+_+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||h.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),h.push(",.*:")})),(T.matchesSelector=rt(m=f.matchesSelector||f.mozMatchesSelector||f.webkitMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&at(function(e){T.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),g.push("!=",R)}),h=RegExp(h.join("|")),g=RegExp(g.join("|")),y=rt(f.contains)||f.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},v=f.compareDocumentPosition?function(e,t){var r;return e===t?(u=!0,0):(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&r||e.parentNode&&11===e.parentNode.nodeType?e===n||y(w,e)?-1:t===n||y(w,t)?1:0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t)return u=!0,0;if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:0;if(o===a)return ut(e,t);r=e;while(r=r.parentNode)s.unshift(r);r=t;while(r=r.parentNode)l.unshift(r);while(s[i]===l[i])i++;return i?ut(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},u=!1,[0,0].sort(v),T.detectDuplicates=u,p):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&c(e),t=t.replace(Z,"='$1']"),!(!T.matchesSelector||d||g&&g.test(t)||h.test(t)))try{var n=m.call(e,t);if(n||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&c(e),y(e,t)},st.attr=function(e,t){var n;return(e.ownerDocument||e)!==p&&c(e),d||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):d||T.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},st.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],r=1,i=0;if(u=!T.detectDuplicates,e.sort(v),u){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e};function ut(e,t){var n=t&&e,r=n&&(~t.sourceIndex||j)-(~e.sourceIndex||j);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ot(function(t){return t=+t,ot(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n},i=st.selectors={cacheLength:50,createPseudo:ot,match:U,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return U.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&z.test(n)&&(t=ft(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[e+" "];return t||(t=RegExp("(^|"+_+")"+e+"("+_+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!u&&!s;if(m){if(o){while(g){p=t;while(p=p[g])if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&v){c=m[x]||(m[x]={}),l=c[e]||[],d=l[0]===N&&l[1],f=l[0]===N&&l[2],p=d&&m.childNodes[d];while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if(1===p.nodeType&&++f&&p===t){c[e]=[N,d,f];break}}else if(v&&(l=(t[x]||(t[x]={}))[e])&&l[0]===N)f=l[1];else while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if((s?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(v&&((p[x]||(p[x]={}))[e]=[N,f]),p===t))break;return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[x]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ot(function(e,n){var i,o=r(e,t),a=o.length;while(a--)i=M.call(e,o[a]),e[i]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ot(function(e){var t=[],n=[],r=s(e.replace(W,"$1"));return r[x]?ot(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:ot(function(e){return function(t){return st(e,t).length>0}}),contains:ot(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ot(function(e){return X.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=d?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:pt(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=lt(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=ct(n);function ft(e,t){var n,r,o,a,s,u,l,c=E[e+" "];if(c)return t?0:c.slice(0);s=e,u=[],l=i.preFilter;while(s){(!n||(r=$.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),u.push(o=[])),n=!1,(r=I.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(W," ")}),s=s.slice(n.length));for(a in i.filter)!(r=U[a].exec(s))||l[a]&&!(r=l[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?st.error(e):E(e,u).slice(0)}function dt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function ht(e,t,n){var i=t.dir,o=n&&"parentNode"===i,a=C++;return t.first?function(t,n,r){while(t=t[i])if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,s){var u,l,c,p=N+" "+a;if(s){while(t=t[i])if((1===t.nodeType||o)&&e(t,n,s))return!0}else while(t=t[i])if(1===t.nodeType||o)if(c=t[x]||(t[x]={}),(l=c[i])&&l[0]===p){if((u=l[1])===!0||u===r)return u===!0}else if(l=c[i]=[p],l[1]=e(t,n,s)||r,l[1]===!0)return!0}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){var o,a=[],s=0,u=e.length,l=null!=t;for(;u>s;s++)(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),l&&t.push(s));return a}function yt(e,t,n,r,i,o){return r&&!r[x]&&(r=yt(r)),i&&!i[x]&&(i=yt(i,o)),ot(function(o,a,s,u){var l,c,p,f=[],d=[],h=a.length,g=o||xt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:mt(g,f,e,s,u),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,u),r){l=mt(y,d),r(l,[],s,u),c=l.length;while(c--)(p=l[c])&&(y[d[c]]=!(m[d[c]]=p))}if(o){if(i||e){if(i){l=[],c=y.length;while(c--)(p=y[c])&&l.push(m[c]=p);i(null,y=[],l,u)}c=y.length;while(c--)(p=y[c])&&(l=i?M.call(o,p):f[c])>-1&&(o[l]=!(a[l]=p))}}else y=mt(y===a?y.splice(h,y.length):y),i?i(null,a,y,u):H.apply(a,y)})}function vt(e){var t,n,r,o=e.length,a=i.relative[e[0].type],s=a||i.relative[" "],u=a?1:0,c=ht(function(e){return e===t},s,!0),p=ht(function(e){return M.call(t,e)>-1},s,!0),f=[function(e,n,r){return!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;o>u;u++)if(n=i.relative[e[u].type])f=[ht(gt(f),n)];else{if(n=i.filter[e[u].type].apply(null,e[u].matches),n[x]){for(r=++u;o>r;r++)if(i.relative[e[r].type])break;return yt(u>1&&gt(f),u>1&&dt(e.slice(0,u-1)).replace(W,"$1"),n,r>u&&vt(e.slice(u,r)),o>r&&vt(e=e.slice(r)),o>r&&dt(e))}f.push(n)}return gt(f)}function bt(e,t){var n=0,o=t.length>0,a=e.length>0,s=function(s,u,c,f,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,T=l,C=s||a&&i.find.TAG("*",d&&u.parentNode||u),k=N+=null==T?1:Math.random()||.1;for(w&&(l=u!==p&&u,r=n);null!=(h=C[b]);b++){if(a&&h){g=0;while(m=e[g++])if(m(h,u,c)){f.push(h);break}w&&(N=k,r=++n)}o&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,o&&b!==v){g=0;while(m=t[g++])m(x,y,u,c);if(s){if(v>0)while(b--)x[b]||y[b]||(y[b]=L.call(f));y=mt(y)}H.apply(f,y),w&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(f)}return w&&(N=k,l=T),x};return o?ot(s):s}s=st.compile=function(e,t){var n,r=[],i=[],o=S[e+" "];if(!o){t||(t=ft(e)),n=t.length;while(n--)o=vt(t[n]),o[x]?r.push(o):i.push(o);o=S(e,bt(i,r))}return o};function xt(e,t,n){var r=0,i=t.length;for(;i>r;r++)st(e,t[r],n);return n}function wt(e,t,n,r){var o,a,u,l,c,p=ft(e);if(!r&&1===p.length){if(a=p[0]=p[0].slice(0),a.length>2&&"ID"===(u=a[0]).type&&9===t.nodeType&&!d&&i.relative[a[1].type]){if(t=i.find.ID(u.matches[0].replace(et,tt),t)[0],!t)return n;e=e.slice(a.shift().value.length)}o=U.needsContext.test(e)?0:a.length;while(o--){if(u=a[o],i.relative[l=u.type])break;if((c=i.find[l])&&(r=c(u.matches[0].replace(et,tt),V.test(a[0].type)&&t.parentNode||t))){if(a.splice(o,1),e=r.length&&dt(a),!e)return H.apply(n,q.call(r,0)),n;break}}}return s(e,p)(r,t,d,n,V.test(e)),n}i.pseudos.nth=i.pseudos.eq;function Tt(){}i.filters=Tt.prototype=i.pseudos,i.setFilters=new Tt,c(),st.attr=b.attr,b.find=st,b.expr=st.selectors,b.expr[":"]=b.expr.pseudos,b.unique=st.uniqueSort,b.text=st.getText,b.isXMLDoc=st.isXML,b.contains=st.contains}(e);var at=/Until$/,st=/^(?:parents|prev(?:Until|All))/,ut=/^.[^:#\[\.,]*$/,lt=b.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e)return r=this,this.pushStack(b(e).filter(function(){for(t=0;i>t;t++)if(b.contains(r[t],this))return!0}));for(n=[],t=0;i>t;t++)b.find(e,this[t],n);return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(b.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1))},filter:function(e){return this.pushStack(ft(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?lt.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,o=[],a=lt.test(e)||"string"!=typeof e?b(e,t||this.context):0;for(;i>r;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&11!==n.nodeType){if(a?a.index(n)>-1:b.find.matchesSelector(n,e)){o.push(n);break}n=n.parentNode}}return this.pushStack(o.length>1?b.unique(o):o)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack;function pt(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return at.test(e)||(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),i=this.length>1&&!ct[e]?b.unique(i):i,this.length>1&&st.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!b(o).is(r)))1===o.nodeType&&i.push(o),o=o[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});function ft(e,t,n){if(t=t||0,b.isFunction(t))return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return b.grep(e,function(e){return e===t===n});if("string"==typeof t){var r=b.grep(e,function(e){return 1===e.nodeType});if(ut.test(t))return b.filter(t,r,!n);t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Nt=/^(?:checkbox|radio)$/i,Ct=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(o),Dt=jt.appendChild(o.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e))return this.each(function(t){b(this).wrapAll(e.call(this,t))});if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;null!=(n=this[r]);r++)(!e||b.filter(e,[n]).length>0)&&(t||1!==n.nodeType||b.cleanData(Ot(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Mt(Ot(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&b.cleanData(Ot(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(gt,""):t;if(!("string"!=typeof e||Tt.test(e)||!b.support.htmlSerialize&&mt.test(e)||!b.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(b.cleanData(Ot(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return t||"string"==typeof e||(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=f.apply([],e);var i,o,a,s,u,l,c=0,p=this.length,d=this,h=p-1,g=e[0],m=b.isFunction(g);if(m||!(1>=p||"string"!=typeof g||b.support.checkClone)&&Ct.test(g))return this.each(function(i){var o=d.eq(i);m&&(e[0]=g.call(this,i,n?o.html():t)),o.domManip(e,n,r)});if(p&&(l=b.buildFragment(e,this[0].ownerDocument,!1,this),i=l.firstChild,1===l.childNodes.length&&(l=i),i)){for(n=n&&b.nodeName(i,"tr"),s=b.map(Ot(l,"script"),Ht),a=s.length;p>c;c++)o=l,c!==h&&(o=b.clone(o,!0,!0),a&&b.merge(s,Ot(o,"script"))),r.call(n&&b.nodeName(this[c],"table")?Lt(this[c],"tbody"):this[c],o,c);if(a)for(u=s[s.length-1].ownerDocument,b.map(s,qt),c=0;a>c;c++)o=s[c],kt.test(o.type||"")&&!b._data(o,"globalEval")&&b.contains(u,o)&&(o.src?b.ajax({url:o.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((o.text||o.textContent||o.innerHTML||"").replace(St,"")));l=i=null}return this}});function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function Ht(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Mt(e,t){var n,r=0;for(;null!=(n=e[r]);r++)b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}function _t(e,t){if(1===t.nodeType&&b.hasData(e)){var n,r,i,o=b._data(e),a=b._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;i>r;r++)b.event.add(t,n,s[n][r])}a.data&&(a.data=b.extend({},a.data))}}function Ft(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events)b.removeEvent(t,r,i.handle);t.removeAttribute(b.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Nt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],o=b(e),a=o.length-1;for(;a>=r;r++)n=r===a?this:this.clone(!0),b(o[r])[t](n),d.apply(i,n.get());return this.pushStack(i)}});function Ot(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s)for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++)!n||b.nodeName(o,n)?s.push(o):b.merge(s,Ot(o,n));return n===t||n&&b.nodeName(e,n)?b.merge([e],s):s}function Bt(e){Nt.test(e.type)&&(e.defaultChecked=e.checked)}b.extend({clone:function(e,t,n){var r,i,o,a,s,u=b.contains(e.ownerDocument,e);if(b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(r=Ot(o),s=Ot(e),a=0;null!=(i=s[a]);++a)r[a]&&Ft(i,r[a]);if(t)if(n)for(s=s||Ot(e),r=r||Ot(o),a=0;null!=(i=s[a]);a++)_t(i,r[a]);else _t(e,o);return r=Ot(o,"script"),r.length>0&&Mt(r,!u&&Ot(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){var i,o,a,s,u,l,c,p=e.length,f=dt(t),d=[],h=0;for(;p>h;h++)if(o=e[h],o||0===o)if("object"===b.type(o))b.merge(d,o.nodeType?[o]:o);else if(wt.test(o)){s=s||f.appendChild(t.createElement("div")),u=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[u]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];while(i--)s=s.lastChild;if(!b.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!b.support.tbody){o="table"!==u||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;while(i--)b.nodeName(l=o.childNodes[i],"tbody")&&!l.childNodes.length&&o.removeChild(l)
}b.merge(d,s.childNodes),s.textContent="";while(s.firstChild)s.removeChild(s.firstChild);s=f.lastChild}else d.push(t.createTextNode(o));s&&f.removeChild(s),b.support.appendChecked||b.grep(Ot(d,"input"),Bt),h=0;while(o=d[h++])if((!r||-1===b.inArray(o,r))&&(a=b.contains(o.ownerDocument,o),s=Ot(f.appendChild(o),"script"),a&&Mt(s),n)){i=0;while(o=s[i++])kt.test(o.type||"")&&n.push(o)}return s=null,f},cleanData:function(e,t){var n,r,o,a,s=0,u=b.expando,l=b.cache,p=b.support.deleteExpando,f=b.event.special;for(;null!=(n=e[s]);s++)if((t||b.acceptData(n))&&(o=n[u],a=o&&l[o])){if(a.events)for(r in a.events)f[r]?b.event.remove(n,r):b.removeEvent(n,r,a.handle);l[o]&&(delete l[o],p?delete n[u]:typeof n.removeAttribute!==i?n.removeAttribute(u):n[u]=null,c.push(o))}}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+x+")(.*)$","i"),Yt=RegExp("^("+x+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+x+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===b.css(e,"display")||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,o=[],a=0,s=e.length;for(;s>a;a++)r=e[a],r.style&&(o[a]=b._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=b._data(r,"olddisplay",un(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display"))));for(a=0;s>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"));return e}b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,o,a={},s=0;if(b.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++)a[n[s]]=b.css(e,n[s],!1,o);return a}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,u=b.camelCase(n),l=e.style;if(n=b.cssProps[u]||(b.cssProps[u]=tn(l,u)),s=b.cssHooks[n]||b.cssHooks[u],r===t)return s&&"get"in s&&(o=s.get(e,!1,i))!==t?o:l[n];if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(b.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||b.cssNumber[u]||(r+="px"),b.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(l[n]="inherit"),s&&"set"in s&&(r=s.set(e,r,i))===t)))try{l[n]=r}catch(c){}}},css:function(e,n,r,i){var o,a,s,u=b.camelCase(n);return n=b.cssProps[u]||(b.cssProps[u]=tn(e.style,u)),s=b.cssHooks[n]||b.cssHooks[u],s&&"get"in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||b.isNumeric(o)?o||0:a):a},swap:function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s.getPropertyValue(n)||s[n]:t,l=e.style;return s&&(""!==u||b.contains(e.ownerDocument,e)||(u=b.style(e,n)),Yt.test(u)&&Ut.test(n)&&(i=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=u,u=s.width,l.width=i,l.minWidth=o,l.maxWidth=a)),u}):o.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s[n]:t,l=e.style;return null==u&&l&&l[n]&&(u=l[n]),Yt.test(u)&&!zt.test(n)&&(i=l.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),l.left="fontSize"===n?"1em":u,u=l.pixelLeft+"px",l.left=i,a&&(o.left=a)),""===u?"auto":u});function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;for(;4>o;o+=2)"margin"===n&&(a+=b.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=b.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=b.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=b.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=b.css(e,"border"+Zt[o]+"Width",!0,i)));return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i))return i;r=a&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function un(e){var t=o,n=Gt[e];return n||(n=ln(e,t),"none"!==n&&n||(Pt=(Pt||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=ln(e,t),Pt.detach()),Gt[e]=n),n}function ln(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}b.each(["height","width"],function(e,n){b.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(b.css(e,"display"))?b.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,i),i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===b.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,n){return n?b.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,n){b.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?b(e).position()[n]+"px":r):t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||b.css(e,"display"))},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=o[r]||o[r-2]||o[0];return i}},Ut.test(e)||(b.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Nt.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],o=function(e,t){t=b.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){o(this.name,this.value)});else for(r in e)gn(r,e[r],n,o);return i.join("&").replace(cn,"+")};function gn(e,t,n,r){var i;if(b.isArray(t))b.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==b.type(t))r(e,t);else for(i in t)gn(e+"["+i+"]",t[i],n,r)}b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,yn,vn=b.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Nn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Cn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=b.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=a.href}catch(Ln){yn=o.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[];function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(w)||[];if(b.isFunction(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,n,r,i){var o={},a=e===jn;function s(u){var l;return o[u]=!0,b.each(e[u]||[],function(e,u){var c=u(n,r,i);return"string"!=typeof c||a||o[c]?a?!(l=c):t:(n.dataTypes.unshift(c),s(c),!1)}),l}return s(n.dataTypes[0])||!o["*"]&&s("*")}function Mn(e,n){var r,i,o=b.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i]);return r&&b.extend(!0,e,r),e}b.fn.load=function(e,n,r){if("string"!=typeof e&&Sn)return Sn.apply(this,arguments);var i,o,a,s=this,u=e.indexOf(" ");return u>=0&&(i=e.slice(u,e.length),e=e.slice(0,u)),b.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&b.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,o){return b.isFunction(r)&&(o=o||i,i=r,r=t),b.ajax({url:e,type:n,dataType:o,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Nn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Mn(Mn(e,b.ajaxSettings),t):Mn(b.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,u,l,c,p=b.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?b(f):b.event,h=b.Deferred(),g=b.Callbacks("once memory"),m=p.statusCode||{},y={},v={},x=0,T="canceled",N={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!c){c={};while(t=Tn.exec(a))c[t[1].toLowerCase()]=t[2]}t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return x||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return x||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>x)for(t in e)m[t]=[m[t],e[t]];else N.always(e[N.status]);return this},abort:function(e){var t=e||T;return l&&l.abort(t),k(0,t),this}};if(h.promise(N).complete=g.add,N.success=N.done,N.error=N.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=b.trim(p.dataType||"*").toLowerCase().match(w)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?80:443))==(mn[3]||("http:"===mn[1]?80:443)))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=b.param(p.data,p.traditional)),qn(An,p,n,N),2===x)return N;u=p.global,u&&0===b.active++&&b.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Cn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(b.lastModified[o]&&N.setRequestHeader("If-Modified-Since",b.lastModified[o]),b.etag[o]&&N.setRequestHeader("If-None-Match",b.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&N.setRequestHeader("Content-Type",p.contentType),N.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers)N.setRequestHeader(i,p.headers[i]);if(p.beforeSend&&(p.beforeSend.call(f,N,p)===!1||2===x))return N.abort();T="abort";for(i in{success:1,error:1,complete:1})N[i](p[i]);if(l=qn(jn,p,n,N)){N.readyState=1,u&&d.trigger("ajaxSend",[N,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){N.abort("timeout")},p.timeout));try{x=1,l.send(y,k)}catch(C){if(!(2>x))throw C;k(-1,C)}}else k(-1,"No Transport");function k(e,n,r,i){var c,y,v,w,T,C=n;2!==x&&(x=2,s&&clearTimeout(s),l=t,a=i||"",N.readyState=e>0?4:0,r&&(w=_n(p,N,r)),e>=200&&300>e||304===e?(p.ifModified&&(T=N.getResponseHeader("Last-Modified"),T&&(b.lastModified[o]=T),T=N.getResponseHeader("etag"),T&&(b.etag[o]=T)),204===e?(c=!0,C="nocontent"):304===e?(c=!0,C="notmodified"):(c=Fn(p,w),C=c.state,y=c.data,v=c.error,c=!v)):(v=C,(e||!C)&&(C="error",0>e&&(e=0))),N.status=e,N.statusText=(n||C)+"",c?h.resolveWith(f,[y,C,N]):h.rejectWith(f,[N,C,v]),N.statusCode(m),m=t,u&&d.trigger(c?"ajaxSuccess":"ajaxError",[N,p,c?y:v]),g.fireWith(f,[N,C]),u&&(d.trigger("ajaxComplete",[N,p]),--b.active||b.event.trigger("ajaxStop")))}return N},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}});function _n(e,n,r){var i,o,a,s,u=e.contents,l=e.dataTypes,c=e.responseFields;for(s in c)s in r&&(n[c[s]]=r[s]);while("*"===l[0])l.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"));if(o)for(s in u)if(u[s]&&u[s].test(o)){l.unshift(s);break}if(l[0]in r)a=l[0];else{for(s in r){if(!l[0]||e.converters[s+" "+l[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==l[0]&&l.unshift(a),r[a]):t}function Fn(e,t){var n,r,i,o,a={},s=0,u=e.dataTypes.slice(),l=u[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u[1])for(i in e.converters)a[i.toLowerCase()]=e.converters[i];for(;r=u[++s];)if("*"!==r){if("*"!==l&&l!==r){if(i=a[l+" "+r]||a["* "+r],!i)for(n in a)if(o=n.split(" "),o[1]===r&&(i=a[l+" "+o[0]]||a["* "+o[0]])){i===!0?i=a[n]:a[n]!==!0&&(r=o[0],u.splice(s--,0,r));break}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(c){return{state:"parsererror",error:i?c:"No conversion from "+l+" to "+r}}}l=r}return{state:"success",data:t}}b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=o.head||b("head")[0]||o.documentElement;return{send:function(t,i){n=o.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var On=[],Bn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=On.pop()||b.expando+"_"+vn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,u=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return u||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,u?n[u]=n[u].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||b.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,On.push(o)),s&&b.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn)Pn[e](t,!0)};function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}b.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&In()||zn()}:In,Rn=b.ajaxSettings.xhr(),b.support.cors=!!Rn&&"withCredentials"in Rn,Rn=b.support.ajax=!!Rn,Rn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,o){var a,s,u=n.xhr();if(n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)u[s]=n.xhrFields[s];n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)u.setRequestHeader(s,i[s])}catch(l){}u.send(n.hasContent&&n.data||null),r=function(e,i){var s,l,c,p;try{if(r&&(i||4===u.readyState))if(r=t,a&&(u.onreadystatechange=b.noop,$n&&delete Pn[a]),i)4!==u.readyState&&u.abort();else{p={},s=u.status,l=u.getAllResponseHeaders(),"string"==typeof u.responseText&&(p.text=u.responseText);try{c=u.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}catch(d){i||o(-1,d)}p&&o(s,c,p,l)},n.async?4===u.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},b(e).unload($n)),Pn[a]=r),u.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+x+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n,r,i=this.createTween(e,t),o=Yn.exec(t),a=i.cur(),s=+a||0,u=1,l=20;if(o){if(n=+o[2],r=o[3]||(b.cssNumber[e]?"":"px"),"px"!==r&&s){s=b.css(i.elem,e,!0)||n||1;do u=u||".5",s/=u,b.style(i.elem,e,s+r);while(u!==(u=i.cur()/a)&&1!==u&&--l)}i.unit=r,i.start=s,i.end=o[1]?s+(o[1]+1)*n:n}return i}]};function Kn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Qn[t]||[]).concat(Qn["*"]),i=0,o=r.length;for(;o>i;i++)if(r[i].call(e,t,n))return})}function er(e,t,n){var r,i,o=0,a=Gn.length,s=b.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;var t=Xn||Kn(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,a=0,u=l.tweens.length;for(;u>a;a++)l.tweens[a].run(o);return s.notifyWith(e,[l,o,n]),1>o&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)l.tweens[n].run(1);return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),c=l.props;for(tr(c,l.opts.specialEasing);a>o;o++)if(r=Gn[o].call(l,e,c,l.opts))return r;return Zn(l,c),b.isFunction(l.opts.start)&&l.opts.start.call(e,l),b.fx.timer(b.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function tr(e,t){var n,r,i,o,a;for(i in e)if(r=b.camelCase(i),o=t[r],n=e[i],b.isArray(n)&&(o=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),a=b.cssHooks[r],a&&"expand"in a){n=a.expand(n),delete e[r];for(i in n)i in e||(e[i]=n[i],t[i]=o)}else t[r]=o}b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}});function nr(e,t,n){var r,i,o,a,s,u,l,c,p,f=this,d=e.style,h={},g=[],m=e.nodeType&&nn(e);n.queue||(c=b._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,p=c.empty.fire,c.empty.fire=function(){c.unqueued||p()}),c.unqueued++,f.always(function(){f.always(function(){c.unqueued--,b.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==un(e.nodeName)?d.zoom=1:d.display="inline-block")),n.overflow&&(d.overflow="hidden",b.support.shrinkWrapBlocks||f.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(i in t)if(a=t[i],Vn.exec(a)){if(delete t[i],u=u||"toggle"===a,a===(m?"hide":"show"))continue;g.push(i)}if(o=g.length){s=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden"in s&&(m=s.hidden),u&&(s.hidden=!m),m?b(e).show():f.done(function(){b(e).hide()}),f.done(function(){var t;b._removeData(e,"fxshow");for(t in h)b.style(e,t,h[t])});for(i=0;o>i;i++)r=g[i],l=f.createTween(r,m?s[r]:0),h[r]=s[r]||b.style(e,r),r in s||(s[r]=l.start,m&&(l.end=l.start,l.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),o=b.speed(t,n,r),a=function(){var t=er(this,b.extend({},e),o);a.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=b.timers,a=b._data(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&Jn.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=b.timers,a=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;for(Xn=b.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Un||(Un=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Un),Un=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)});var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s)return n=s.documentElement,b.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");"static"===r&&(e.style.position="relative");var i=b(e),o=i.offset(),a=b.css(e,"top"),s=b.css(e,"left"),u=("absolute"===r||"fixed"===r)&&b.inArray("auto",[a,s])>-1,l={},c={},p,f;u?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),b.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(l.top=t.top-o.top+p),null!=t.left&&(l.left=t.left-o.left+f),"using"in t?t.using.call(e,l):i.css(l)}},b.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===b.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||o.documentElement;while(e&&!b.nodeName(e,"html")&&"static"===b.css(e,"position"))e=e.offsetParent;return e||o.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?b(a).scrollLeft():o,r?o:b(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}});function or(e){return b.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return b.access(this,function(n,r,i){var o;return b.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?b.css(n,r,s):b.style(n,r,i,s)},n,a?i:t,a,null)}})}),e.jQuery=e.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})})(window);/*! Copyright (c) 2013 Brandon Aaron (http://brandon.aaron.sh)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Version: 3.1.12
 *
 * Requires: jQuery 1.2.2+
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});(function(k){function n(c,a){k.ajax({url:c,async:!1,cache:a.cache,contentType:"text/plain;charset="+a.encoding,dataType:"text",success:function(b){r(b,a.mode)}})}function r(c,a){for(var b="",e=c.split(/\n/),d=/(\{\d+\})/g,q=/\{(\d+)\}/g,m=/(\\u.{4})/ig,f=0;f<e.length;f++)if(e[f]=e[f].replace(/^\s\s*/,"").replace(/\s\s*$/,""),e[f].length>0&&e[f].match("^#")!="#"){var g=e[f].split("=");if(g.length>0){for(var o=unescape(g[0]).replace(/^\s\s*/,"").replace(/\s\s*$/,""),h=g.length==1?"":g[1];h.match(/\\$/)==
"\\";)h=h.substring(0,h.length-1),h+=e[++f].replace(/\s\s*$/,"");for(var l=2;l<g.length;l++)h+="="+g[l];h=h.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(a=="map"||a=="both"){if(g=h.match(m))for(l=0;l<g.length;l++)h=h.replace(g[l],s(g[l]));k.i18n.map[o]=h}if(a=="vars"||a=="both")if(h=h.replace(/"/g,'\\"'),t(o),d.test(h)){for(var g=h.split(d),l=!0,j="",n=[],p=0;p<g.length;p++)if(d.test(g[p])&&(n.length==0||n.indexOf(g[p])==-1))l||(j+=","),j+=g[p].replace(q,"v$1"),n.push(g[p]),l=!1;b+=o+"=function("+
j+"){";o='"'+h.replace(q,'"+v$1+"')+'"';b+="return "+o+";};"}else b+=o+'="'+h+'";'}}eval(b)}function t(c){if(/\./.test(c))for(var a="",c=c.split(/\./),b=0;b<c.length;b++)b>0&&(a+="."),a+=c[b],eval("typeof "+a+' == "undefined"')&&eval(a+"={};")}function s(c){var a=[],c=parseInt(c.substr(2),16);c>=0&&c<Math.pow(2,16)&&a.push(c);for(var c="",b=0;b<a.length;++b)c+=String.fromCharCode(a[b]);return c}k.i18n={};k.i18n.map={};k.i18n.properties=function(c){c=k.extend({name:"Messages",language:"",path:"",mode:"vars",
cache:!1,encoding:"UTF-8",callback:null},c);if(c.language===null||c.language=="")c.language=k.i18n.browserLang();if(c.language===null)c.language="";var a=c.name&&c.name.constructor==Array?c.name:[c.name];for(i=0;i<a.length;i++)n(c.path+a[i]+".properties",c),c.language.length>=2&&n(c.path+a[i]+"_"+c.language.substring(0,2)+".properties",c),c.language.length>=5&&n(c.path+a[i]+"_"+c.language.substring(0,5)+".properties",c);c.callback&&c.callback()};k.i18n.prop=function(c){var a=k.i18n.map[c];if(a==null)return"["+
c+"]";var b;if(typeof a=="string"){for(b=0;(b=a.indexOf("\\",b))!=-1;)a=a[b+1]=="t"?a.substring(0,b)+"\t"+a.substring(b++ +2):a[b+1]=="r"?a.substring(0,b)+"\r"+a.substring(b++ +2):a[b+1]=="n"?a.substring(0,b)+"\n"+a.substring(b++ +2):a[b+1]=="f"?a.substring(0,b)+"\u000c"+a.substring(b++ +2):a[b+1]=="\\"?a.substring(0,b)+"\\"+a.substring(b++ +2):a.substring(0,b)+a.substring(b+1);var e=[],d,j;for(b=0;b<a.length;)if(a[b]=="'")if(b==a.length-1)a=a.substring(0,b);else if(a[b+1]=="'")a=a.substring(0,b)+
a.substring(++b);else{for(d=b+2;(d=a.indexOf("'",d))!=-1;)if(d==a.length-1||a[d+1]!="'"){a=a.substring(0,b)+a.substring(b+1,d)+a.substring(d+1);b=d-1;break}else a=a.substring(0,d)+a.substring(++d);d==-1&&(a=a.substring(0,b)+a.substring(b+1))}else if(a[b]=="{")if(d=a.indexOf("}",b+1),d==-1)b++;else if(j=parseInt(a.substring(b+1,d)),!isNaN(j)&&j>=0){var m=a.substring(0,b);m!=""&&e.push(m);e.push(j);b=0;a=a.substring(d+1)}else b=d+1;else b++;a!=""&&e.push(a);a=e;k.i18n.map[c]=e}if(a.length==0)return"";
if(a.lengh==1&&typeof a[0]=="string")return a[0];m="";for(b=0;b<a.length;b++)m+=typeof a[b]=="string"?a[b]:a[b]+1<arguments.length?arguments[a[b]+1]:"{"+a[b]+"}";return m};k.i18n.browserLang=function(){var c=navigator.language||navigator.userLanguage,c=c.toLowerCase();c.length>3&&(c=c.substring(0,3)+c.substring(3).toUpperCase());return c};var j;if(!j)j=function(c,a,b){if(Object.prototype.toString.call(a)!=="[object RegExp]")return typeof j._nativeSplit=="undefined"?c.split(a,b):j._nativeSplit.call(c,
a,b);var e=[],d=0,k=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.sticky?"y":""),a=RegExp(a.source,k+"g"),m,f,g;c+="";j._compliantExecNpcg||(m=RegExp("^"+a.source+"$(?!\\s)",k));if(b===void 0||+b<0)b=Infinity;else if(b=Math.floor(+b),!b)return[];for(;f=a.exec(c);){k=f.index+f[0].length;if(k>d&&(e.push(c.slice(d,f.index)),!j._compliantExecNpcg&&f.length>1&&f[0].replace(m,function(){for(var a=1;a<arguments.length-2;a++)arguments[a]===void 0&&(f[a]=void 0)}),f.length>1&&f.index<c.length&&Array.prototype.push.apply(e,
f.slice(1)),g=f[0].length,d=k,e.length>=b))break;a.lastIndex===f.index&&a.lastIndex++}d===c.length?(g||!a.test(""))&&e.push(""):e.push(c.slice(d));return e.length>b?e.slice(0,b):e},j._compliantExecNpcg=/()??/.exec("")[1]===void 0,j._nativeSplit=String.prototype.split;String.prototype.split=function(c,a){return j(this,c,a)}})(jQuery);/*! jQuery plugin for Hammer.JS - v1.1.2 - 2014-04-25
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */

!function(a,b){"use strict";function c(){e.READY||(t.determineEventTypes(),s.each(e.gestures,function(a){v.register(a)}),t.onTouch(e.DOCUMENT,o,v.detect),t.onTouch(e.DOCUMENT,p,v.detect),e.READY=!0)}function d(a,c){Date.now||(Date.now=function(){return(new Date).getTime()}),a.utils.each(["on","off"],function(d){a.utils[d]=function(a,e,f){c(a)[d](e,function(a){var d=c.extend({},a.originalEvent,a);d.button===b&&(d.button=a.which-1),f.call(this,d)})}}),a.Instance.prototype.trigger=function(a,b){var d=c(this.element);return d.has(b.target).length&&(d=c(b.target)),d.trigger({type:a,gesture:b})},c.fn.hammer=function(b){return this.each(function(){var d=c(this),e=d.data("hammer");e?e&&b&&a.utils.extend(e.options,b):d.data("hammer",new a(this,b||{}))})}}var e=function w(a,b){return new w.Instance(a,b||{})};e.VERSION="1.1.2",e.defaults={behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},e.DOCUMENT=document,e.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,e.HAS_TOUCHEVENTS="ontouchstart"in a,e.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),e.NO_MOUSEEVENTS=e.HAS_TOUCHEVENTS&&e.IS_MOBILE||e.HAS_POINTEREVENTS,e.CALCULATE_INTERVAL=25;var f={},g=e.DIRECTION_DOWN="down",h=e.DIRECTION_LEFT="left",i=e.DIRECTION_UP="up",j=e.DIRECTION_RIGHT="right",k=e.POINTER_MOUSE="mouse",l=e.POINTER_TOUCH="touch",m=e.POINTER_PEN="pen",n=e.EVENT_START="start",o=e.EVENT_MOVE="move",p=e.EVENT_END="end",q=e.EVENT_RELEASE="release",r=e.EVENT_TOUCH="touch";e.READY=!1,e.plugins=e.plugins||{},e.gestures=e.gestures||{};var s=e.utils={extend:function(a,c,d){for(var e in c)!c.hasOwnProperty(e)||a[e]!==b&&d||(a[e]=c[e]);return a},on:function(a,b,c){a.addEventListener(b,c,!1)},off:function(a,b,c){a.removeEventListener(b,c,!1)},each:function(a,c,d){var e,f;if("forEach"in a)a.forEach(c,d);else if(a.length!==b){for(e=0,f=a.length;f>e;e++)if(c.call(d,a[e],e,a)===!1)return}else for(e in a)if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1)return},inStr:function(a,b){return a.indexOf(b)>-1},inArray:function(a,b){if(a.indexOf){var c=a.indexOf(b);return-1===c?!1:c}for(var d=0,e=a.length;e>d;d++)if(a[d]===b)return d;return!1},toArray:function(a){return Array.prototype.slice.call(a,0)},hasParent:function(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1},getCenter:function(a){var b=[],c=[],d=[],e=[],f=Math.min,g=Math.max;return 1===a.length?{pageX:a[0].pageX,pageY:a[0].pageY,clientX:a[0].clientX,clientY:a[0].clientY}:(s.each(a,function(a){b.push(a.pageX),c.push(a.pageY),d.push(a.clientX),e.push(a.clientY)}),{pageX:(f.apply(Math,b)+g.apply(Math,b))/2,pageY:(f.apply(Math,c)+g.apply(Math,c))/2,clientX:(f.apply(Math,d)+g.apply(Math,d))/2,clientY:(f.apply(Math,e)+g.apply(Math,e))/2})},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){var c=b.clientX-a.clientX,d=b.clientY-a.clientY;return 180*Math.atan2(d,c)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.clientX-b.clientX),d=Math.abs(a.clientY-b.clientY);return c>=d?a.clientX-b.clientX>0?h:j:a.clientY-b.clientY>0?i:g},getDistance:function(a,b){var c=b.clientX-a.clientX,d=b.clientY-a.clientY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return a.length>=2&&b.length>=2?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return a.length>=2&&b.length>=2?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==i||a==g},setPrefixedCss:function(a,b,c,d){var e=["","Webkit","Moz","O","ms"];b=s.toCamelCase(b);for(var f=0;f<e.length;f++){var g=b;if(e[f]&&(g=e[f]+g.slice(0,1).toUpperCase()+g.slice(1)),g in a.style){a.style[g]=(null==d||d)&&c||"";break}}},toggleBehavior:function(a,b,c){if(b&&a&&a.style){s.each(b,function(b,d){s.setPrefixedCss(a,d,b,c)});var d=c&&function(){return!1};"none"==b.userSelect&&(a.onselectstart=d),"none"==b.userDrag&&(a.ondragstart=d)}},toCamelCase:function(a){return a.replace(/[_-]([a-z])/g,function(a){return a[1].toUpperCase()})}};e.Instance=function(a,b){var d=this;c(),this.element=a,this.enabled=!0,s.each(b,function(a,c){delete b[c],b[s.toCamelCase(c)]=a}),this.options=s.extend(s.extend({},e.defaults),b||{}),this.options.behavior&&s.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=t.onTouch(a,n,function(a){d.enabled&&a.eventType==n?v.startDetect(d,a):a.eventType==r&&v.detect(a)}),this.eventHandlers=[]},e.Instance.prototype={on:function(a,b){var c=this;return t.on(c.element,a,b,function(a){c.eventHandlers.push({gesture:a,handler:b})}),c},off:function(a,b){var c=this;return t.off(c.element,a,b,function(a){var d=s.inArray({gesture:a,handler:b});d!==!1&&c.eventHandlers.splice(d,1)}),c},trigger:function(a,b){b||(b={});var c=e.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b;var d=this.element;return s.hasParent(b.target,d)&&(d=b.target),d.dispatchEvent(c),this},enable:function(a){return this.enabled=a,this},dispose:function(){var a,b;for(s.toggleBehavior(this.element,this.options.behavior,!1),a=-1;b=this.eventHandlers[++a];)s.off(this.element,b.gesture,b.handler);return this.eventHandlers=[],t.off(this.element,f[n],this.eventStartHandler),null}};var t=e.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(a,b,c,d){var e=b.split(" ");s.each(e,function(b){s.on(a,b,c),d&&d(b)})},off:function(a,b,c,d){var e=b.split(" ");s.each(e,function(b){s.off(a,b,c),d&&d(b)})},onTouch:function(a,b,c){var d=this,e=function(e){var f,g=e.type.toLowerCase(),h=s.inStr(g,"pointer"),i=s.inStr(g,"mouse");i&&d.preventMouseEvents||(i&&b==n&&0===e.button?(d.preventMouseEvents=!1,d.shouldDetect=!0):h&&b==n?d.shouldDetect=1===e.buttons:i||b!=n||(d.preventMouseEvents=!0,d.shouldDetect=!0),h&&b!=p&&u.updatePointer(b,e),d.shouldDetect&&(f=d.doDetect.call(d,e,b,a,c)),f==p&&(d.preventMouseEvents=!1,d.shouldDetect=!1,u.reset()),h&&b==p&&u.updatePointer(b,e))};return this.on(a,f[b],e),e},doDetect:function(a,b,c,d){var e=this.getTouchList(a,b),f=e.length,g=b,h=e.trigger,i=f;b==n?h=r:b==p&&(h=q,i=e.length-(a.changedTouches?a.changedTouches.length:1)),i>0&&this.started&&(g=o),this.started=!0;var j=this.collectEventData(c,g,e,a);return b!=p&&d.call(v,j),h&&(j.changedLength=i,j.eventType=h,d.call(v,j),j.eventType=g,delete j.changedLength),g==p&&(d.call(v,j),this.started=!1),g},determineEventTypes:function(){var b;return b=e.HAS_POINTEREVENTS?a.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:e.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],f[n]=b[0],f[o]=b[1],f[p]=b[2],f},getTouchList:function(a,b){if(e.HAS_POINTEREVENTS)return u.getTouchList();if(a.touches){if(b==o)return a.touches;var c=[],d=[].concat(s.toArray(a.touches),s.toArray(a.changedTouches)),f=[];return s.each(d,function(a){s.inArray(c,a.identifier)===!1&&f.push(a),c.push(a.identifier)}),f}return a.identifier=1,[a]},collectEventData:function(a,b,c,d){var e=l;return s.inStr(d.type,"mouse")||u.matchType(k,d)?e=k:u.matchType(m,d)&&(e=m),{center:s.getCenter(c),timeStamp:Date.now(),target:d.target,touches:c,eventType:b,pointerType:e,srcEvent:d,preventDefault:function(){var a=this.srcEvent;a.preventManipulation&&a.preventManipulation(),a.preventDefault&&a.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return v.stopDetect()}}}},u=e.PointerEvent={pointers:{},getTouchList:function(){var a=[];return s.each(this.pointers,function(b){a.push(b)}),a},updatePointer:function(a,b){a==p||a!=p&&1!==b.buttons?delete this.pointers[b.pointerId]:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b)},matchType:function(a,b){if(!b.pointerType)return!1;var c=b.pointerType,d={};return d[k]=c===(b.MSPOINTER_TYPE_MOUSE||k),d[l]=c===(b.MSPOINTER_TYPE_TOUCH||l),d[m]=c===(b.MSPOINTER_TYPE_PEN||m),d[a]},reset:function(){this.pointers={}}},v=e.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:s.extend({},b),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){a=this.extendEventData(a);var b=this.current.inst,c=b.options;return s.each(this.gestures,function(d){return!this.stopped&&b.enabled&&c[d.name]&&d.handler.call(d,a,b)===!1?(this.stopDetect(),!1):void 0},this),this.current&&(this.current.lastEvent=a),a.eventType==p&&this.stopDetect(),a}},stopDetect:function(){this.previous=s.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(a,b,c,d,f){var g=this.current,h=!1,i=g.lastCalcEvent,j=g.lastCalcData;i&&a.timeStamp-i.timeStamp>e.CALCULATE_INTERVAL&&(b=i.center,c=a.timeStamp-i.timeStamp,d=a.center.clientX-i.center.clientX,f=a.center.clientY-i.center.clientY,h=!0),(a.eventType==r||a.eventType==q)&&(g.futureCalcEvent=a),(!g.lastCalcEvent||h)&&(j.velocity=s.getVelocity(c,d,f),j.angle=s.getAngle(b,a.center),j.direction=s.getDirection(b,a.center),g.lastCalcEvent=g.futureCalcEvent||a,g.futureCalcEvent=a),a.velocityX=j.velocity.x,a.velocityY=j.velocity.y,a.interimAngle=j.angle,a.interimDirection=j.direction},extendEventData:function(a){var b=this.current,c=b.startEvent,d=b.lastEvent||c;(a.eventType==r||a.eventType==q)&&(c.touches=[],s.each(a.touches,function(a){c.touches.push({clientX:a.clientX,clientY:a.clientY})}));var e=a.timeStamp-c.timeStamp,f=a.center.clientX-c.center.clientX,g=a.center.clientY-c.center.clientY;return this.getCalculatedData(a,d.center,e,f,g),s.extend(a,{startEvent:c,deltaTime:e,deltaX:f,deltaY:g,distance:s.getDistance(c.center,a.center),angle:s.getAngle(c.center,a.center),direction:s.getDirection(c.center,a.center),scale:s.getScale(c.touches,a.touches),rotation:s.getRotation(c.touches,a.touches)}),a},register:function(a){var c=a.defaults||{};return c[a.name]===b&&(c[a.name]=!0),s.extend(e.defaults,c,!0),a.index=a.index||1e3,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}};!function(a){function b(b,d){var e=v.current;if(!(d.options.dragMaxTouches>0&&b.touches.length>d.options.dragMaxTouches))switch(b.eventType){case n:c=!1;break;case o:if(b.distance<d.options.dragMinDistance&&e.name!=a)return;var f=e.startEvent.center;if(e.name!=a&&(e.name=a,d.options.dragDistanceCorrection&&b.distance>0)){var k=Math.abs(d.options.dragMinDistance/b.distance);f.pageX+=b.deltaX*k,f.pageY+=b.deltaY*k,f.clientX+=b.deltaX*k,f.clientY+=b.deltaY*k,b=v.extendEventData(b)}(e.lastEvent.dragLockToAxis||d.options.dragLockToAxis&&d.options.dragLockMinDistance<=b.distance)&&(b.dragLockToAxis=!0);var l=e.lastEvent.direction;b.dragLockToAxis&&l!==b.direction&&(b.direction=s.isVertical(l)?b.deltaY<0?i:g:b.deltaX<0?h:j),c||(d.trigger(a+"start",b),c=!0),d.trigger(a,b),d.trigger(a+b.direction,b);var m=s.isVertical(b.direction);(d.options.dragBlockVertical&&m||d.options.dragBlockHorizontal&&!m)&&b.preventDefault();break;case q:c&&b.changedLength<=d.options.dragMaxTouches&&(d.trigger(a+"end",b),c=!1);break;case p:c=!1}}var c=!1;e.gestures.Drag={name:a,index:50,handler:b,defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag"),e.gestures.Gesture={name:"gesture",index:1337,handler:function(a,b){b.trigger(this.name,a)}},function(a){function b(b,d){var e=d.options,f=v.current;switch(b.eventType){case n:clearTimeout(c),f.name=a,c=setTimeout(function(){f&&f.name==a&&d.trigger(a,b)},e.holdTimeout);break;case o:b.distance>e.holdThreshold&&clearTimeout(c);break;case q:clearTimeout(c)}}var c;e.gestures.Hold={name:a,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:b}}("hold"),e.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==q&&b.trigger(this.name,a)}},e.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:.6,swipeVelocityY:.6},handler:function(a,b){if(a.eventType==q){var c=a.touches.length,d=b.options;if(c<d.swipeMinTouches||c>d.swipeMaxTouches)return;(a.velocityX>d.swipeVelocityX||a.velocityY>d.swipeVelocityY)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}}},function(a){function b(b,d){var e,f,g=d.options,h=v.current,i=v.previous;switch(b.eventType){case n:c=!1;break;case o:c=c||b.distance>g.tapMaxDistance;break;case p:"touchcancel"!=b.srcEvent.type&&b.deltaTime<g.tapMaxTime&&!c&&(e=i&&i.lastEvent&&b.timeStamp-i.lastEvent.timeStamp,f=!1,i&&i.name==a&&e&&e<g.doubleTapInterval&&b.distance<g.doubleTapDistance&&(d.trigger("doubletap",b),f=!0),(!f||g.tapAlways)&&(h.name=a,d.trigger(h.name,b)))}}var c=!1;e.gestures.Tap={name:a,index:100,handler:b,defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),e.gestures.Touch={name:"touch",index:-1/0,defaults:{preventDefault:!1,preventMouse:!1},handler:function(a,b){return b.options.preventMouse&&a.pointerType==k?void a.stopDetect():(b.options.preventDefault&&a.preventDefault(),void(a.eventType==r&&b.trigger("touch",a)))}},function(a){function b(b,d){switch(b.eventType){case n:c=!1;break;case o:if(b.touches.length<2)return;var e=Math.abs(1-b.scale),f=Math.abs(b.rotation);if(e<d.options.transformMinScale&&f<d.options.transformMinRotation)return;v.current.name=a,c||(d.trigger(a+"start",b),c=!0),d.trigger(a,b),f>d.options.transformMinRotation&&d.trigger("rotate",b),e>d.options.transformMinScale&&(d.trigger("pinch",b),d.trigger("pinch"+(b.scale<1?"in":"out"),b));break;case q:c&&b.changedLength<2&&(d.trigger(a+"end",b),c=!1)}}var c=!1;e.gestures.Transform={name:a,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:b}}("transform"),a.Hammer=e,"undefined"!=typeof module&&module.exports&&(module.exports=e),"function"==typeof define&&define.amd?define(["jquery"],function(b){return d(a.Hammer,b)}):d(a.Hammer,a.jQuery||a.Zepto)}(window);
//
/****************************************************************************** 
	rtree.js -Non-Recursive Javascript R-Tree Library
	Version 1.0.0, March 15th 2013

	https://github.com/leaflet-extras/RTree.
******************************************************************************/

var RTree=function(a){var c=3;var b=6;if(!isNaN(a)){c=Math.floor(a/2);b=a}var f={x:0,y:0,w:0,h:0,id:"root",nodes:[]};var j=function(q){return Object.prototype.toString.call(q)==="[object Array]"};var i=(function(){var q={};return function(s){var r=0;if(s in q){r=q[s]++}else{q[s]=0}return s+"_"+r}})();RTree.Rectangle.squarified_ratio=function(r,q,v){var u=(r+q)/2;var t=r*q;var s=t/(u*u);return(t*v/s)};var e=function(w,s,x){var y=[];var u=[];var z=[];var A=1;var C,r,v;if(!w||!RTree.Rectangle.overlap_rectangle(w,x)){return z}var q={x:w.x,y:w.y,w:w.w,h:w.h,target:s};u.push(x.nodes.length);y.push(x);do{C=y.pop();r=u.pop()-1;if("target" in q){while(r>=0){v=C.nodes[r];if(RTree.Rectangle.overlap_rectangle(q,v)){if((q.target&&"leaf" in v&&v.leaf===q.target)||(!q.target&&("leaf" in v||RTree.Rectangle.contains_rectangle(v,q)))){if("nodes" in v){z=m(v,true,[],v);C.nodes.splice(r,1)}else{z=C.nodes.splice(r,1)}RTree.Rectangle.make_MBR(C.nodes,C);delete q.target;if(C.nodes.length<c){q.nodes=m(C,true,[],C)}break}else{if("nodes" in v){A+=1;u.push(r);y.push(C);C=v;r=v.nodes.length}}}r-=1}}else{if("nodes" in q){C.nodes.splice(r+1,1);if(C.nodes.length>0){RTree.Rectangle.make_MBR(C.nodes,C)}for(var B=0;B<q.nodes.length;B++){h(q.nodes[B],C)}q.nodes.length=0;if(y.length==0&&C.nodes.length<=1){q.nodes=m(C,true,q.nodes,C);C.nodes.length=0;y.push(C);u.push(1)}else{if(y.length>0&&C.nodes.length<c){q.nodes=m(C,true,q.nodes,C);C.nodes.length=0}else{delete q.nodes}}}else{RTree.Rectangle.make_MBR(C.nodes,C)}}A-=1}while(y.length>0);return(z)};var l=function(y,z){var u=-1;var x=[];var B;var C=function(E,D){return(function(F){E._attach_data(D,F)})};x.push(z);var q=z.nodes;do{if(u!=-1){x.push(q[u]);q=q[u].nodes;u=-1}for(var s=q.length-1;s>=0;s--){var w=q[s];if("leaf" in w){u=-1;break}var v=RTree.Rectangle.squarified_ratio(w.w,w.h,w.nodes.length+1);var t=Math.max(w.x+w.w,y.x+y.w)-Math.min(w.x,y.x);var r=Math.max(w.y+w.h,y.y+y.h)-Math.min(w.y,y.y);var A=RTree.Rectangle.squarified_ratio(t,r,w.nodes.length+2);if(u<0||Math.abs(A-v)<B){B=Math.abs(A-v);u=s}}}while(u!=-1);return(x)};var d=function(q){var r=k(q);while(q.length>0){g(q,r[0],r[1])}return(r)};var g=function(q,D,C){var u=RTree.Rectangle.squarified_ratio(D.w,D.h,D.nodes.length+1);var t=RTree.Rectangle.squarified_ratio(C.w,C.h,C.nodes.length+1);var s;var z;var E;for(var x=q.length-1;x>=0;x--){var r=q[x];var y={};y.x=Math.min(D.x,r.x);y.y=Math.min(D.y,r.y);y.w=Math.max(D.x+D.w,r.x+r.w)-y.x;y.h=Math.max(D.y+D.h,r.y+r.h)-y.y;var B=Math.abs(RTree.Rectangle.squarified_ratio(y.w,y.h,D.nodes.length+2)-u);var w={};w.x=Math.min(C.x,r.x);w.y=Math.min(C.y,r.y);w.w=Math.max(C.x+C.w,r.x+r.w)-w.x;w.h=Math.max(C.y+C.h,r.y+r.h)-w.y;var A=Math.abs(RTree.Rectangle.squarified_ratio(w.w,w.h,C.nodes.length+2)-t);if(!z||!s||Math.abs(A-B)<s){z=x;s=Math.abs(A-B);E=A<B?C:D}}var v=q.splice(z,1)[0];if(D.nodes.length+q.length+1<=c){D.nodes.push(v);RTree.Rectangle.expand_rectangle(D,v)}else{if(C.nodes.length+q.length+1<=c){C.nodes.push(v);RTree.Rectangle.expand_rectangle(C,v)}else{E.nodes.push(v);RTree.Rectangle.expand_rectangle(E,v)}}};var k=function(q){var s=q.length-1;var A=0;var r=q.length-1;var y=0;var w,v;for(var u=q.length-2;u>=0;u--){var t=q[u];if(t.x>q[A].x){A=u}else{if(t.x+t.w<q[s].x+q[s].w){s=u}}if(t.y>q[y].y){y=u}else{if(t.y+t.h<q[r].y+q[r].h){r=u}}}var z=Math.abs((q[s].x+q[s].w)-q[A].x);var x=Math.abs((q[r].y+q[r].h)-q[y].y);if(z>x){if(s>A){w=q.splice(s,1)[0];v=q.splice(A,1)[0]}else{v=q.splice(A,1)[0];w=q.splice(s,1)[0]}}else{if(r>y){w=q.splice(r,1)[0];v=q.splice(y,1)[0]}else{v=q.splice(y,1)[0];w=q.splice(r,1)[0]}}return([{x:w.x,y:w.y,w:w.w,h:w.h,nodes:[w]},{x:v.x,y:v.y,w:v.w,h:v.h,nodes:[v]}])};var p=function(r,q){r.nodes=q.nodes;r.x=q.x;r.y=q.y;r.w=q.w;r.h=q.h;return(r)};var m=function(v,s,u,w){var x=[];if(!RTree.Rectangle.overlap_rectangle(v,w)){return(u)}var y=function(A,z){return(function(B){A._attach_data(z,B)})};x.push(w.nodes);do{var q=x.pop();for(var r=q.length-1;r>=0;r--){var t=q[r];if(RTree.Rectangle.overlap_rectangle(v,t)){if("nodes" in t){x.push(t.nodes)}else{if("leaf" in t){if(!s){u.push(t.leaf)}else{u.push(t)}}}}}}while(x.length>0);return(u)};var h=function(q,w){var u;if(w.nodes.length===0){w.x=q.x;w.y=q.y;w.w=q.w;w.h=q.h;w.nodes.push(q);return}var s=l(q,w);var r=q;do{if(u&&"nodes" in u&&u.nodes.length===0){var z=u;u=s.pop();for(var y=0;y<u.nodes.length;y++){if(u.nodes[y]===z||u.nodes[y].nodes.length===0){u.nodes.splice(y,1);break}}}else{u=s.pop()}if("leaf" in r||"nodes" in r||j(r)){if(j(r)){for(var v=0;v<r.length;v++){RTree.Rectangle.expand_rectangle(u,r[v])}u.nodes=u.nodes.concat(r)}else{RTree.Rectangle.expand_rectangle(u,r);u.nodes.push(r)}if(u.nodes.length<=b){r={x:u.x,y:u.y,w:u.w,h:u.h}}else{var x=d(u.nodes);r=x;if(s.length<1){u.nodes.push(x[0]);s.push(u);r=x[1]}}}else{RTree.Rectangle.expand_rectangle(u,r);r={x:u.x,y:u.y,w:u.w,h:u.h}}}while(s.length>0)};this.get_tree=function(){return f};this.set_tree=function(r,q){if(!q){q=f}return(p(q,r))};this.search=function(w,q,v,x){if(arguments.length<1){throw"Wrong number of arguments. RT.Search requires at least a bounding rectangle."}var t,y,u,r;switch(arguments.length){case 1:return m.apply(this,[w,false,[],f]);case 2:if(typeof q==="function"){t=[w,false,[],f];y=q;break}else{return m.apply(this,[w,q,[],f])}case 3:if(typeof v==="function"){t=[w,q,[],f];y=v;break}else{return m.apply(this,[w,q,v,f])}case 4:t=[w,q,v,f];y=x;break}if(y){try{u=m.apply(this,t)}catch(s){r=s}finally{y(r,u)}}};this.toJSON=function(z,E){var B=[];var w=[];var A={};var s=3;var C=1;var r="";if(z&&!RTree.Rectangle.overlap_rectangle(z,f)){return""}if(!E){w.push(f.nodes.length);B.push(f.nodes);r+="var main_tree = {x:"+f.x.toFixed()+",y:"+f.y.toFixed()+",w:"+f.w.toFixed()+",h:"+f.h.toFixed()+",nodes:["}else{s+=4;w.push(E.nodes.length);B.push(E.nodes);r+="var main_tree = {x:"+E.x.toFixed()+",y:"+E.y.toFixed()+",w:"+E.w.toFixed()+",h:"+E.h.toFixed()+",nodes:["}do{var q=B.pop();var v=w.pop()-1;if(v>=0&&v<q.length-1){r+=","}while(v>=0){var y=q[v];if(!z||RTree.Rectangle.overlap_rectangle(z,y)){if(y.nodes){if(C>=s){var x=A.length;var u=i("saved_subtree");r+="{x:"+y.x.toFixed()+",y:"+y.y.toFixed()+",w:"+y.w.toFixed()+",h:"+y.h.toFixed()+",load:'"+u+".js'}";A[u]=this.toJSON(z,y);if(v>0){r+=","}}else{r+="{x:"+y.x.toFixed()+",y:"+y.y.toFixed()+",w:"+y.w.toFixed()+",h:"+y.h.toFixed()+",nodes:[";C+=1;w.push(v);B.push(q);q=y.nodes;v=y.nodes.length}}else{if(y.leaf){var t=y.leaf.toJSON?y.leaf.toJSON():JSON.stringify(y.leaf);r+="{x:"+y.x.toFixed()+",y:"+y.y.toFixed()+",w:"+y.w.toFixed()+",h:"+y.h.toFixed()+",leaf:"+t+"}";if(v>0){r+=","}}else{if(y.load){r+="{x:"+y.x.toFixed()+",y:"+y.y.toFixed()+",w:"+y.w.toFixed()+",h:"+y.h.toFixed()+",load:'"+y.load+"'}";if(v>0){r+=","}}}}}v-=1}if(v<0){r+="]}";C-=1}}while(B.length>0);r+=";";for(var D in A){r+="\nvar "+D+" = function(){"+A[D]+" return(main_tree);};"}return(r)};this.remove=function(t,v,w){var q,s,r,u;if(arguments.length<1){throw"Wrong number of arguments. RT.remove requires at least a bounding rectangle."}switch(arguments.length){case 1:s=[t,false,f];break;case 2:if(typeof arguments[1]==="function"){q=v;v=false}s=[t,v,f];break;case 3:if(typeof w==="function"){q=w}s=[t,v,f];break}if(s[1]===false){r=0;u=[];do{r=u.length;u=u.concat(e.apply(this,s))}while(r!=u.length);if(!q){return u}else{q(null,u)}}else{if(!q){return(e.apply(this,s))}else{q(null,e.apply(this,s))}}};this.insert=function(r,u,v){var q,s;if(arguments.length<2){throw"Wrong number of arguments. RT.Insert requires at least a bounding rectangle and an object."}if(!v){return(h({x:r.x,y:r.y,w:r.w,h:r.h,leaf:u},f)||true)}else{try{q=(h({x:r.x,y:r.y,w:r.w,h:r.h,leaf:u},f))}catch(t){s=t}finally{v(s,q)}}};var n=function(t,w){if(w&&w.bbox){return{leaf:w,x:w.bbox[0],y:w.bbox[1],w:w.bbox[2]-w.bbox[0],h:w.bbox[3]-w.bbox[1]}}var r=t.length;var v=0;var s=new Array(r);while(v<r){s[v]=[t[v][0],t[v][1]];v++}var x=s[0];r=s.length;v=1;var q={min:[].concat(x),max:[].concat(x)};while(v<r){if(s[v][0]<q.min[0]){q.min[0]=s[v][0]}else{if(s[v][0]>q.max[0]){q.max[0]=s[v][0]}}if(s[v][1]<q.min[1]){q.min[1]=s[v][1]}else{if(s[v][1]>q.max[1]){q.max[1]=s[v][1]}}v++}var u={x:q.min[0],y:q.min[1],w:(q.max[0]-q.min[0]),h:(q.max[1]-q.min[1])};if(w){u.leaf=w}return u};var o={};o.point=function(q){return(h({x:q.geometry.coordinates[0],y:q.geometry.coordinates[1],w:0,h:0,leaf:q},f))};o.multiPointLineString=function(q){return(h(n(q.geometry.coordinates,q),f))};o.multiLineStringPolygon=function(q){return(h(n(Array.prototype.concat.apply([],q.geometry.coordinates),q),f))};o.multiPolygon=function(q){return(h(n(Array.prototype.concat.apply([],Array.prototype.concat.apply([],q.geometry.coordinates)),q),f))};o.makeRec=function(q){return new RTree.Rectangle(q.x,q.y,q.w,q.h)};o.geometryCollection=function(u){if(u.bbox){return(h({leaf:u,x:u.bbox[0],y:u.bbox[1],w:u.bbox[2]-u.bbox[0],h:u.bbox[3]-u.bbox[1]},f))}var w=u.geometry.geometries;var s=0;var r=w.length;var q=[];var t;while(s<r){t=w[s];switch(t.type){case"Point":q.push(o.makeRec({x:t.coordinates[0],y:t.coordinates[1],w:0,h:0}));break;case"MultiPoint":q.push(o.makeRec(n(t.coordinates)));break;case"LineString":q.push(o.makeRec(n(t.coordinates)));break;case"MultiLineString":q.push(o.makeRec(n(Array.prototype.concat.apply([],t.coordinates))));break;case"Polygon":q.push(o.makeRec(n(Array.prototype.concat.apply([],t.coordinates))));break;case"MultiPolygon":q.push(o.makeRec(n(Array.prototype.concat.apply([],Array.prototype.concat.apply([],t.coordinates)))));break;case"GeometryCollection":w=w.concat(t.geometries);r=w.length;break}s++}var v=q[0];s=1;r=q.length;while(s<r){v.expand(q[s]);s++}return h({leaf:u,x:v.x(),y:v.y(),h:v.h(),w:v.w()},f)};this.geoJSON=function(u,v){v=v||function(){return true};var t,s;if(j(u)){t=u.slice()}else{if(u.features&&j(u.features)){t=u.features.slice()}else{throw ("this isn't what we're looking for")}}var q=t.length;var r=0;while(r<q){s=t[r];if(s.type==="Feature"){switch(s.geometry.type){case"Point":o.point(s);break;case"MultiPoint":o.multiPointLineString(s);break;case"LineString":o.multiPointLineString(s);break;case"MultiLineString":o.multiLineStringPolygon(s);break;case"Polygon":o.multiLineStringPolygon(s);break;case"MultiPolygon":o.multiPolygon(s);break;case"GeometryCollection":o.geometryCollection(s);break}}r++}return v(null,true)};this.bbox=function(){var s,u,r,t,w,q,v;switch(arguments.length){case 0:throw ("not enough arguments");case 1:s=arguments[0][0][0];u=arguments[0][0][1];r=arguments[0][1][0];t=arguments[0][1][1];break;case 2:if(typeof arguments[1]==="function"){s=arguments[0][0][0];u=arguments[0][0][1];r=arguments[0][1][0];t=arguments[0][1][1];w=arguments[1];break}else{s=arguments[0][0];u=arguments[0][1];r=arguments[1][0];t=arguments[1][1];break}case 3:s=arguments[0][0];u=arguments[0][1];r=arguments[1][0];t=arguments[1][1];w=arguments[2];break;case 4:s=arguments[0];u=arguments[1];r=arguments[2];t=arguments[3];break;case 5:s=arguments[0];u=arguments[1];r=arguments[2];t=arguments[3];w=arguments[4];break}if(!w){return this.search({x:s,y:u,w:r-s,h:t-u})}else{this.search({x:s,y:u,w:r-s,h:t-u},w)}}};var rTree=function(b,f){var a,c;if(typeof b==="function"){f=b;b=undefined}if(!f){return new RTree(b)}else{try{a=new RTree(b)}catch(d){c=d}finally{f(c,a)}}};RTree.Rectangle=function(c,b,d,k){var i,a,f,g,j,e;if(c.x){i=c.x;f=c.y;if(c.w!==0&&!c.w&&c.x2){j=c.x2-c.x;e=c.y2-c.y}else{j=c.w;e=c.h}a=i+j;g=f+e}else{i=c;f=b;j=d;e=k;a=i+j;g=f+e}this.x1=this.x=function(){return i};this.y1=this.y=function(){return f};this.x2=function(){return a};this.y2=function(){return g};this.w=function(){return j};this.h=function(){return e};this.toJSON=function(){return('{"x":'+i.toString()+', "y":'+f.toString()+', "w":'+j.toString()+', "h":'+e.toString()+"}")};this.overlap=function(h){return(this.x()<h.x2()&&this.x2()>h.x()&&this.y()<h.y2()&&this.y2()>h.y())};this.expand=function(l){var h=Math.min(this.x(),l.x());var m=Math.min(this.y(),l.y());j=Math.max(this.x2(),l.x2())-h;e=Math.max(this.y2(),l.y2())-m;i=h;f=m;return(this)};this.setRect=function(n,m,o,u){var s,l,q,r,t,p;if(n.x){s=n.x;q=n.y;if(n.w!==0&&!n.w&&n.x2){t=n.x2-n.x;p=n.y2-n.y}else{t=n.w;p=n.h}l=s+t;r=q+p}else{s=n;q=m;t=o;p=u;l=s+t;r=q+p}}};RTree.Rectangle.overlap_rectangle=function(d,c){if((d.h===0&&d.w===0)||(c.h===0&&c.w===0)){return(d.x<=(c.x+c.w)&&(d.x+d.w)>=c.x&&d.y<=(c.y+c.h)&&(d.y+d.h)>=c.y)}else{return(d.x<(c.x+c.w)&&(d.x+d.w)>c.x&&d.y<(c.y+c.h)&&(d.y+d.h)>c.y)}};RTree.Rectangle.contains_rectangle=function(d,c){return((d.x+d.w)<=(c.x+c.w)&&d.x>=c.x&&(d.y+d.h)<=(c.y+c.h)&&d.y>=c.y)};RTree.Rectangle.expand_rectangle=function(e,d){var c=Math.min(e.x,d.x);var f=Math.min(e.y,d.y);e.w=Math.max(e.x+e.w,d.x+d.w)-c;e.h=Math.max(e.y+e.h,d.y+d.h)-f;e.x=c;e.y=f;return(e)};RTree.Rectangle.make_MBR=function(a,c){if(a.length<1){return({x:0,y:0,w:0,h:0})}if(!c){c={x:a[0].x,y:a[0].y,w:a[0].w,h:a[0].h}}else{c.x=a[0].x}c.y=a[0].y;c.w=a[0].w;c.h=a[0].h;for(var b=a.length-1;b>0;b--){RTree.Rectangle.expand_rectangle(c,a[b])}return(c)};if(typeof module!=="undefined"&&module.exports){module.exports=rTree};
var ouilib;(function(){function a(b,d){if(!b){b={}}var b=b||{};b.config=b.config||{defaultViewportWidth:undefined,defaultViewportHeight:undefined,defaultLayoutDir:undefined,defaultLogLevel:"FINEST",defaultLogHandler:undefined,embeddedResourcesMap:undefined,preventTimerStart:false,frameRate:undefined,environment:undefined,base:".",catchAllEventListener:undefined,altText:"",hiDPI:true,silverlight:undefined};b.setUp=function(e){var f=b.config;if(b.equalIgnoreCase(b.RTL,f.defaultLayoutDir)){b.layoutDir=b.RTL;b.filters._onLayoutDir(b.layoutDir)}else{b.layoutDir=b.LTR}if(b.equalIgnoreCase(b.EnvironmentEnum.MOBILE,f.environment)){b.environment=b.EnvironmentEnum.MOBILE}else{b.environment=b.EnvironmentEnum.DESKTOP}b.deviceOrientation=b.DeviceOrientationEnum.LANDSCAPE;b.viewportWidth=0;if(b.isPositiveNumber(f.defaultViewportWidth)){b.viewportWidth=f.defaultViewportWidth}b.viewportHeight=0;if(b.isPositiveNumber(f.defaultViewportHeight)){b.viewportHeight=f.defaultViewportHeight}b.viewportBounds={x:0,y:0,width:b.viewportWidth,height:b.viewportHeight};b.tree=new b.scene.Tree();b.timer=new b.timing.Timer(f.frameRate);b.tree._setContainerImpl(e);b.rootNode=b.tree.userLayer;b.focusManager=new b.focus.FocusManager(b.rootNode);b.tooltipManager=new b.tooltip.TooltipManager();b.resourcesManager=new b.utils.ResourcesManager();b.rootNode.addEventListener(b.ViewEvents.USER_EVENTS_SUPPORTED,b.events.setUserEventsSupported);b.rootNode.addEventListener(b.ViewEvents.ABOUT_INFO_REQUEST,function(g){g.returnValue=b.aboutInfo});if(f.preventTimerStart!==true){b.timer.start()}};(function(){b.NO_OP=function(){};b.BASE_VALUE="base";b.FillEnum={REMOVE:"REMOVE",FREEZE:"FREEZE",_LEGACY:"_LEGACY"};b.DEFAULT_TAG="defaultTag";b.TAGS={LAYOUT_DIR:"layoutDir",PAINT:"paint",GEOM:"geom",TRANSFO_SET:"transfoSet",TRANSFO:"transfo",SENSITIVITY:"sensitivity",VISIBILITY:"visibility",DISPLAY:"display",OPACITY:"opacity",NAME:"name",CLIP:"clip",CURSOR:"cursor",FOCUSABLE:"focusable",DESC:"desc",FILTER:"filter",LAYOUT:"layout",PREF_SIZE:"prefSize",SRC:"src",MARKER_START:"markerStart",MARKER_START_DATA:"markerStartData",MARKER_START_PAINT:"markerStartPaint",MARKER_END:"markerEnd",MARKER_END_DATA:"markerEndData",MARKER_END_PAINT:"markerEndPaint"};b.EnvironmentEnum={DESKTOP:"DESKTOP",MOBILE:"MOBILE"};b.DeviceOrientationEnum={LANDSCAPE:"LANDSCAPE",PORTRAIT:"PORTRAIT"};b.CursorType={AUTO:"auto",DEFAULT:"default",MOVE:"move",POINTER:"pointer",TEXT:"text",WAIT:"wait",NONE:"none",HELP:"help",CROSSHAIR:"crosshair"};b.TextAlignEnum={LINE_BEGIN:"LINE_BEGIN",CENTER:"CENTER",LINE_END:"LINE_END",JUSTIFY:"JUSTIFY"};b.LineCap={BUTT:"butt",ROUND:"round",SQUARE:"square"};b.DirectionEnum={UP:"UP",DOWN:"DOWN",LEFT:"LEFT",RIGHT:"RIGHT",TO_LINE_BEGIN:"TO_LINE_BEGIN",TO_LINE_END:"TO_LINE_END"};b.OrientationEnum={VERTICAL:"VERTICAL",HORIZONTAL:"HORIZONTAL"};b.LineJoin={MITER:"miter",ROUND:"round",BEVEL:"bevel"};b.FontWeightEnum={NORMAL:"NORMAL",BOLD:"BOLD"};b.FontStyleEnum={NORMAL:"NORMAL",ITALIC:"ITALIC"};b.LayoutDirEnum={LTR:"LTR",RTL:"RTL"};b.LTR="LTR";b.RTL="RTL";b.NodeAlign={TOP:0,CENTER:0.5,BOTTOM:1,LINE_BEGIN:0,LINE_END:1};b._BoundsType={DEFAULT:0,LAYOUT:1,RENDER:2};b.KeyCode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,MULTIPLY:106,PLUS:107,MINUS:109,DIVIDE:111,DASH:189,FORWARD_SLASH:191,BACK_SLASH:220};b.PreserveAspectRatioEnum={NONE:"NONE",MIN:"MIN",MAX:"MAX"};b.WindingRuleEnum={EVEN_ODD:"EVEN_ODD",NON_ZERO:"NON_ZERO"};b.AUTO="AUTO";b.QuoteStyleEnum={ENT_COMPAT:"ENT_COMPAT",ENT_QUOTES:"ENT_QUOTES",ENT_NOQUOTES:"ENT_NOQUOTES"};b.GENERIC_FONTS={SERIF:"serif",SANS_SERIF:"sans-serif",CURSIVE:"cursive",MONOSPACE:"monospace"}}());b.LogLevel={OFF:"OFF",ERROR:"ERROR",SEVERE:"SEVERE",WARNING:"WARNING",INFO:"INFO",FINEST:"FINEST",ALL:"ALL",LOG:"LOG"};var c;b.log=c=(function(){var o=b.LogLevel,f={OFF:0,SEVERE:1,WARNING:2,INFO:3,FINEST:4,ALL:5},n=[],j=0,i=[],p,l,h,e,k;p=function(){k.release()};function m(w,u){var r=n,t,s,v=r.length;for(s=0;s<v;s++){t=r[s];if(typeof t==="function"){t.call(null,w,u)}else{t.log(w,u)}}}function q(s,r){if(i.length===j){i.shift()}i.push({level:s,message:r})}function g(s){var r=o.INFO;if(typeof s==="string"){s=s.toUpperCase()}if(o.hasOwnProperty(s)){r=o[s]}return r}k=function(r,u,s){var t,v;if(u){r=g(r);if(u instanceof Error){u=u.toString()}if(e){u=e(u,s)}if(r===o.ERROR){throw new Error(u)}else{t=f[h];v=f[r];if(v<=t){if(j>0){q(r,u)}else{m(r,u)}}}}};k.setLevel=function(r){h=g(r)};k.setFormatter=function(r){if(typeof r==="function"){e=r}};k.error=function(s,r){k(o.ERROR,s,r)};k.severe=function(s,r){k(o.SEVERE,s,r)};k.warn=k.warning=function(s,r){k(o.WARNING,s,r)};k.info=function(s,r){k(o.INFO,s,r)};k.finest=function(s,r){k(o.FINEST,s,r)};k.addLogHandler=function(r){if(typeof r==="function"||(r&&typeof r.log==="function")){n.push(r)}};k.delay=function(r,s){if(l){clearTimeout(l)}k.hold(s);l=setTimeout(p,r)};k.hold=function(r){j=r>0?r:500};k.release=function(){var r,s=i.length;if(s>0){m(o.LOG,">>>> releasing "+s+" logs.");while(s--){r=i.shift();m(r.level,r.message)}m(o.LOG,">>>> end logs release")}j=0};k.setLevel(b.config.defaultLogLevel||b.LogLevel.FINEST);k.addLogHandler(b.config.defaultLogHandler);k.setFormatter(function(s,r){if(r!==undefined){if(r.constructor===Array){s+="::"+r.join(",")}else{s+="::"+r}}return s});return k}());b.ns=function(j){var g,f,k,e,h,m,l;if(typeof j==="string"){for(h=0,m=j.length;h<m;h++){l=j.charAt(h);if((l===".")||((l>="a")&&(l<="z"))||((l>="A")&&(l<="Z"))||((l>="0")&&(l<="9"))){continue}else{c.error("ERR__NAMESPACE__ILLEGAL_CHAR",j)}}k=j.split(".");f=undefined;if(k[0]==="oui"){f=b}if(f===undefined||f.length===0){c.error("ERR__NS__ROOT_FAIL",k[0])}for(h=1,m=k.length;h<m;h++){e=k[h];f[e]=f[e]||{};f=f[e]}g=f}else{c.error("ERR__NS__INV_STR",[j,typeof j])}return g};(function(){b.ns("oui.lang");b.lang.AspectSupport={addAspect:function(g,f,j,i){var h=this[g],e;if(b.isA(h,Function)&&b.isA(f,Function)){if(j===true){e=function(){e.aspect.apply(this,arguments);return e.nextMethod.apply(this,arguments)}}else{e=function(){var k=h.apply(this,arguments);e.aspect.apply(this,arguments);return k}}e.nextMethod=h;e.aspect=f;e.aspectName=i;this[g]=e}},removeAspect:function(f,e){var h=this[f],g;while(h){if(h.aspect===e){if(g){g.nextMethod=h.nextMethod}else{this[f]=h.nextMethod}break}else{g=h;h=h.nextMethod}}}}}());(function(){b.ns("oui.lang");var f,e={superClass:false,__configs:false,events:true};b.lang.Class=f={mixin:function(i,h,g){if(!i){c.error("ERR__MIX__INV_TARGET")}else{if(!h||!f._isStrictObject(h)){c.error("ERR__MIX__INV_SRC")}else{if(g===undefined){g=true}if(f._isClass(i)){f.merge(i.prototype,h,g,e)}else{if(f._isStrictObject(i)){f.merge(i,h,g,e)}else{c.error("ERR__MIX__INV_TARGET")}}f._copyConfigs(i,h)}}},_copyConfigs:function(l,j){var n,m,i,g,h,k;if(j.__configs){if(!l.__configs){l.__configs={}}for(n in j.__configs){if(!l.__configs[n]){b.lang.PropertiesUtil.addConfig(l,{},n)}m=j.__configs[n].definitionClass.prototype;i=j.__configs[n].configClass.prototype;g=l.__configs[n].definitionClass.prototype;h=l.__configs[n].configClass.prototype;for(k in m){if(!i[k]){c.error("ERR__CONFIG__NO_DEFAULT",k)}if(!g[k]&&!h[k]){g[k]=m[k];h[k]=i[k]}else{c.error("ERR__CONFIG__DUP_PROP",k)}}}}},merge:function(k,h,g,j){var i;j=j||{};for(i in h){if(!j.hasOwnProperty(i)&&(g||!k.hasOwnProperty(i))){k[i]=h[i]}else{if(j[i]===true){if(!k[i]){k[i]={}}this.merge(k[i],h[i],g,j)}}}if(h.hasOwnProperty("toString")&&g){k.toString=h.toString}},extend:function(i,g){var h;if(!i||!f._isClass(i)){c.error("ERR__EXT__INV_CHILD")}else{if(!g||!f._isClass(g)){c.error("ERR__EXT__INV_PARENT")}else{if(i.superClass!==undefined){c.error("ERR__EXT__MULT_INHERIT")}h=function(){};h.prototype=g.prototype;i.prototype=new h();i.prototype.constructor=i;i.superClass=g}}},isA:function(i,h){var g=false;if(typeof i==="boolean"){g=(h===Boolean)}else{if(typeof i==="number"){g=(h===Number)}else{if(typeof i==="string"){g=(h===String)}else{if(h===Function){g=(typeof i==="function"||i===Date)}else{if(h&&i){if(i.constructor===h){g=true}else{if(f._isClass(h)&&i instanceof h){g=true}else{if(i.constructor!==undefined){g=f._inheritsFrom(i.constructor,h)}}}}}}}}return g},isAny:function(h){var k=arguments.length,g=false,j;for(j=1;j<k;j++){if(b.isA(h,arguments[j])){g=true;break}}return g},_isStrictObject:function(g){return g.constructor===Object},_isClass:function(g){return(g.constructor===Function||(b.as3Class!==undefined&&g.constructor===b.as3Class))},_inheritsFrom:function(j,i){var g=false,h=j.superClass;if(j===i){g=true}else{if(h!==undefined){g=f._inheritsFrom(h,i)}}return g},declare:function(l){var m,h,o,j,k,p,g;if(!b.isA(l,Object)){c.error("ERR__DECL__INV_CLASS_DEF")}m=l.name;if(!b.isA(m,String)||m.indexOf(".")<0){c.error("ERR__DECL__INV_CLASS_NAME")}j=m.lastIndexOf(".");h=b.ns(m.substr(0,j));m=m.substr(j+1);if(l.isAbstract===true){o=function(){c.error("ERR__ABSTR_CLASS",l.name)}}else{o=function(){this.init.apply(this,arguments)}}if(h[m]!==undefined){c.error("ERR__DECL__DUP_CLASS",l.name)}h[m]=o;if(b.isA(l.extend,Function)){b.extend(o,l.extend)}if(b.isA(l.mixins,Array)){for(k=0,p=l.mixins.length;k<p;k++){b.mixin(o,l.mixins[k])}}g=[{name:"styleDef",call:b.addStyleSupport},{name:"modelDef",call:b.addModelSupport},{name:"propertiesDef",call:b.addPropertiesSupport},{name:"resourcesDef",call:b.addI18nSupport},{name:"jsonDef",call:b.addJSONLoaderSupport},{name:"eventsDef",call:b.addEventsSupport}];for(k=0,p=g.length;k<p;k++){if(b.isA(l[g[k].name],Object)){g[k].call(o,l[g[k].name])}}if(b.isA(l.membersDef,Object)){b.mixin(o,l.membersDef)}return o}};b.merge=f.merge;b.extend=f.extend;b.mixin=f.mixin;b.isA=f.isA;b.isAny=f.isAny;b.declare=f.declare}());(function(){b.ns("oui.lang");b.mixin(b,{isChar:function(e){return typeof e==="string"&&e.length===1},isStringNotEmpty:function(e){return typeof e==="string"&&e.length>0},isValueInEnum:function(f,e){return typeof f==="string"&&e!==undefined&&e.hasOwnProperty(f)},isPositiveNumber:function(f,e){return typeof f==="number"&&(e===true?f>0:f>=0)},isFiniteNumber:function(e){return typeof e==="number"&&isFinite(e)},isFinitePositiveNumber:function(f,e){return typeof f==="number"&&isFinite(f)&&(e===true?f>0:f>=0)},isNumberInRange:function(g,e,h){var f;if(h===true){f=b.isArrayOfType(e,{type:Number})&&e.length===2&&!isNaN(e[0])&&!isNaN(e[1])}else{f=true}return f&&typeof g==="number"&&!isNaN(g)&&g>=e[0]&&g<=e[1]},isFunctionWithArgCount:function(e,f){return typeof e==="function"&&e.length===f},isArrayOfType:function(f,g,l,m,k){var e=true,j,h;if(g===undefined||g===null||g.type===undefined){e=false}else{if(f&&f.constructor===Array){j=f.length;if(l!==undefined){if(k===true&&typeof l!=="number"){e=false}if(j<l){e=false}}if(m!==undefined){if(k===true&&typeof m!=="number"){e=false}if(j>m){e=false}}for(h=0;h<j&&e===true;h++){e=b.isValueValid(f[h],g)}}else{e=false}}return e},isArrayOfProperties:function(l,e,f,m,k){var n=true,h=null,j,g;if(e===undefined||e===null){n=false}else{if(l&&l.constructor===Array){j=l.length;if(f!==undefined){if(k===true&&typeof f!=="number"){n=false}if(j<f){n=false}}if(m!==undefined){if(k===true&&typeof m!=="number"){n=false}if(j>m){n=false}}for(g=0;g<j&&n===true;g++){h=l[g];n=h!==undefined&&h!==null&&h.constructor===Object&&b.isObjectValid(h,e,true)}}else{n=false}}return n},isMapOfType:function(h,f){var e=true,g;if(f===undefined||f===null||f.type===undefined){e=false}else{if(typeof h==="object"){for(g in h){if(h.hasOwnProperty(g)){e=b.isValueValid(h[g],f)}}}else{e=false}}return e},isMapOfProperties:function(k,g,h,f,i){var e=false,j;if(g&&k&&k.constructor===Object){if(typeof h!=="boolean"){h=true}e=true;for(j in k){if(k.hasOwnProperty(j)){e=b.isObjectValid(k[j],g,h,f);if(e===false&&i===true){e=b.isMapOfProperties(k[j],g,h,f,i)}if(e===false){break}}}}return e},isObjectValid:function(l,k,h,i){var n=false,f=false,m=false,e,j,g;if(k!==undefined&&l!==undefined&&k!==null&&l!==null){for(e in k){if(k[e]!==undefined){j=l[e];g=k[e];if(j!==undefined){f=b.isValueValid(j,g,h);n=f}else{m=m||!l.hasOwnProperty(e);n=!h}if(n!==true){break}}}if(n===true&&h===false&&i===true&&m){if(f===true){for(e in k){if(l.hasOwnProperty(e)===false){g=k[e];l[e]=g.defaultValue}}}else{n=false}}}return n},inheritsFrom:function(h,i,f){var e=false,g=true;if(f!==false){g=b.isA(i,Function)}if(g&&b.isA(h,Function)){e=b.lang.Class._inheritsFrom(h,i)}return e}})}());(function(){b.ns("oui.lang");var e=b.QuoteStyleEnum,f="(&amp;|&lt;|&gt;|&quot;|&#039;|&#8230;)",g=new RegExp(f,"gi"),h=new RegExp("^"+f+"$","i");b.mixin(b,{currentTimeMillis:function(){return new Date().getTime()},equalIgnoreCase:function(k,j){var i=false;if(typeof k==="string"&&typeof j==="string"){i=(k.toLowerCase()===j.toLowerCase())}return i},trim:function(i){return i.replace(/^\s+|\s+$/g,"")},arrayRemove:function(o,l,k){var j,m=o.length;for(j=m-1;j>=0;j--){if(o[j]===l){o.splice(j,1);if(k===false){break}}}return o},hasOwnValue:function(l,n,k){var m,j=false,i;if(l!==undefined){if(typeof n==="string"&&k===true){i=n.toLowerCase();for(m in l){if(l.hasOwnProperty(m)&&l[m].toLowerCase()===i){j=true;break}}}else{for(m in l){if(l.hasOwnProperty(m)&&l[m]===n){j=true;break}}}}return j},supportsEvents:function(i){return i!==null&&i!==undefined&&b.isA(i.addEventListener,Function)},getValidIndex:function(j,l){var m,k;if(j<0){k=j%l;m=(k===0)?0:l+(j%l)}else{if(j>0){m=(j<l)?j:j%l}else{m=0}}return m},isValueOfType:function(n,m,o){var i=false,l,k;if(m===Object){i=true}else{if(n!==undefined&&n!==null&&m!==undefined&&m!==null){if(m===String||m===Number||m===Boolean||m===Array||m===Date||m===Function){i=(n.constructor===m)}else{if(m.constructor===Object&&n.constructor===Object){i=(b.isObjectValid(n,m,o)===true)}else{if(m.constructor===Function){i=b.isA(n,m)}else{if(m.constructor===Array){k=m.length;for(l=0;l<k;l++){if(n===m[l]){i=true;break}}}}}}}}return i},isValueInConstraint:function(m,o,k){var l=null,j=null,i=true;if(o){i=false;if(o.constructor===Function){l=o;j=[m]}else{if(o.constructor===Array&&o.length>0&&o[0]!==undefined&&o[0]!==null&&o[0].constructor===Function){l=o[0];j=o.concat();j[0]=m}}}if(k===undefined){k=null}if(l!==null){try{i=l.apply(k,j)}catch(n){c.info("INFO__CONSTRAINT_FAIL",[n.message,m,o,k])}}return i},isValueValid:function(k,j,l){var i=false;if(j.type!==undefined){i=b.isValueOfType(k,j.type,l)}else{i=b.isValueOfType(k,j,l)}if(i===true&&j.constraint!==undefined){i=b.isValueInConstraint(k,j.constraint)}return i},buildDefaults:function(j,m){var i=m,k,l;if(typeof i!=="object"||i===null){i={}}for(l in j){k=j[l];if(k!==null&&k!==undefined&&k.constructor===Object){if(k.defaultValue!==undefined){i[l]=k.defaultValue}else{if(k.type!==undefined&&k.type.constructor===Object){k=k.type}i[l]=b.buildDefaults(k)}}}return i},applyProperties:function(l,m,k,i){var j={};if(l&&k){b._applyPropertiesImpl(l,m,k,i,j)}return j},_applyPropertiesImpl:function(i,q,l,t,v){var j,s,m,n,k,r,u,o=b._applyPropertiesImpl;for(j in i){m=l[j];s=i[j];n=q[j];if(m!==undefined&&s!==n){if(m.type===undefined){if(m.constructor===Object){o(s,n,m,t,v)}}else{if(m.type.constructor===Object){o(s,n,m.type,t,v)}else{k=false;r=undefined;k=(s===null&&m.allowsNull)||(s===undefined&&m.allowsUndef)||b.isValueOfType(s,m.type,false);if(k===true){r=s}else{if(m.convertor){u={value:undefined,validValue:false};m.convertor(s,u);k=(u.validValue===true);r=u.value}}if(k===true&&m.comparator){k=!m.comparator(n,s)}if(k===true&&m.constraint){k=b.isValueInConstraint(r,m.constraint,t);if(!k&&m.itemsConvertor){u={value:undefined,validValue:false};m.itemsConvertor(r,u);k=(u.validValue===true);r=u.value}}if(k===true){q[j]=r;if(m.tag){v[m.tag]=true}else{v[b.DEFAULT_TAG]=true}}}}}}},xmlSpecialChars:function(p,j,k){var o,m,l,q;if(!b.hasOwnValue(e,j)){j=e.ENT_COMPAT}if(k===false){o=p.split(g);for(l=0,q=o.length;l<q;l++){m=o[l];if(m.match(h)===null){o[l]=m.replace(/&/g,"&amp;")}}p=o.join("")}else{p=p.replace(/&/g,"&amp;")}p=p.replace(/</g,"&lt;");p=p.replace(/>/g,"&gt;");if(j===e.ENT_COMPAT){p=p.replace(/"/g,"&quot;")}else{if(j===e.ENT_QUOTES){p=p.replace(/"/g,"&quot;");p=p.replace(/'/g,"&#039;")}}p=p.replace(/\u2026/g,"&#8230;");return p}})}());(function(){b.ns("oui.defs");function l(w,u,v,A,y,o,t,x,s){var q,p,z,r=(v===null&&x)||(v===undefined&&s)||b.isValueOfType(v,u,false);if(!r||!b.isValueInConstraint(v,o)){if(t===undefined){t=["def=",v];if(b.isA(o,Array)){t.push(" with constraints: ");for(q=1,p=o.length;q<p;q++){t.push(o[q],", ")}}}c.error("ERR__DEFS__INV",[t,"oui.defs."+w])}else{if(A!==undefined&&!b.isA(A,String)){c.error("ERR__DEFS__INV",["tag","oui.defs."+w])}else{z={type:u,constraint:o,defaultValue:v,convertor:y,tag:A}}}return z}function f(q,p,o,r){var n=false;if(q===null){n=o}else{if(q===undefined){n=r}else{n=b.isValueOfType(q,p,true)}}return n}function i(p,r,o,q){var n=false;if(p===null){n=o}else{if(p===undefined){n=q}else{n=b.isValueInConstraint(p,r)}}return n}function k(o,n){if(o===1||o==="1"||o==="true"||o==="TRUE"){n.validValue=true;n.value=true}else{if(o===0||o==="0"||o==="false"||o==="FALSE"){n.validValue=true;n.value=false}}}function m(o,n){if(o!==undefined&&o!==null){n.validValue=true;n.value=o.toString()}}function e(o,n){if(b.isA(o,String)){var p=parseFloat(o);if(!isNaN(p)){n.valueValid=true;n.value=p}}}function g(p,o){if(b.isA(p,String)){var n=Date.parse(p);if(!isNaN(n)){o.validValue=true;o.value=new Date(n)}}}function j(p){var s,r=p.convertor,q,u,t,o;if(r!==undefined){s=function(v,n){u=[].concat(v);t=u.length;for(q=0;q<t;q++){o=b.isValueOfType(u[q],p.type,false);if(o===false){n.validValue=false;r(u[q],n,q,t);if(n.validValue===true){o=n.validValue;u[q]=n.value}}if(o===false){break}}if(q===t){n.validValue=true;n.value=u}else{n.validValue=false}}}return s}function h(o,r,q){var p,n=false;if(o!==null&&o!==undefined&&r!==null&&r!==undefined&&o.constructor===Array&&r.constructor===Array&&o.length===r.length){n=true;p=o.length;if(q===true){while(n&&p--){if(o[p].constructor===Array){n=h(o[p],r[p],q)}}}else{while(n&&p--){n=(o[p]===r[p])}}}return n}b.mixin(b.defs,{_createDef:l,Boolean:function(o,n){return l("Boolean",Boolean,o,n,k)},String:function(o,n){return l("String",String,o,n,m)},Char:function(o,n){return l("Char",String,o,n,m,b.isChar)},Number:function(o,n){return l("Number",Number,o,n,e)},FiniteNumber:function(o,n){return l("FiniteNumber",Number,o,n,e,b.isFiniteNumber)},FinitePositiveNumber:function(o,n){return l("FinitePositiveNumber",Number,o,n,e,b.isFinitePositiveNumber)},PositiveNumber:function(o,n){return l("PositiveNumber",Number,o,n,e,b.isPositiveNumber)},StrictlyPositiveNumber:function(o,n){return l("StrictlyPositiveNumber",Number,o,n,e,[b.isPositiveNumber,true])},NumberInRange:function(o,q,n){var r=[b.isNumberInRange,o,true],p=l("NumberInRange",Number,q,n,e,r);r[2]=false;return p},Enum:function(q,o,n){var s=[],r;for(r in q){if(q.hasOwnProperty(r)){s.push(q[r])}}return l("Enum",s,o,n)},Date:function(o,n){return l("Date",Date,o,n,g)},MapOfProperties:function(r,s,p,o,q,n){return l("MapOfProperties",Object,s,n,undefined,[b.isMapOfProperties,r,p,o,q])},MapOfType:function(o,p,n){return l("MapOfType",Object,p,n,undefined,[b.isMapOfType,o])},ArrayOfProperties:function(o,s,t,q,n){var r=[b.isArrayOfProperties,o,s,t,true],p=l("ArrayOfProperties",Array,q,n,undefined,r);r[4]=false;return p},ArrayOfType:function(u,n,t,p,x,v,s){var o=[b.isArrayOfType,u,n,t,true],q,w={},r;if(s){r=j(u);r(p,w);if(w.validValue){p=w.value}}q=l("ArrayOfType",Array,p,x,null,o);if(s){q.itemsConvertor=r}if(v){q.comparator=h}o[4]=false;return q},ObjectOfType:function(p,r,o,q,n){return l("ObjectOfType",Object,r,n,undefined,[f,p,o,q])},ObjectOfConstraint:function(p,r,o,q,n){return l("ObjectOfConstraint",Object,r,n,undefined,[i,p,o,q])},Function:function(p,o,n){return l("Function",Function,o,n,undefined,[b.isFunctionWithArgCount,p])},Class:function(r,p,n){var q=[b.inheritsFrom,r],o=l("Class",Function,p,n,undefined,q);q[2]=false;return o}})}());(function(){b.ns("oui.lang");b.lang.PropertiesSupport={_initProperties:function(e){this._properties=new this.Properties();this.setProperties(e)},setProperties:function(f){var e=this._properties.updateObject(f),g;for(g in e){if(e[g]===true){this.onPropChanged(g)}}},applyProperties:function(e){this.setProperties(e)},onPropChanged:function(){}}}());(function(){b.ns("oui.lang");var e=/\^\.([a-zA-Z0-9\-_]*)\[([a-zA-Z0-9\-]*)\]/;b.lang.BindingSupport={applyBinding:function(i,g,h,k,j,f){var l=this[j];if(b.isA(l,Function)){this._applyBinding(i,g,h,k,l,f)}},_applyBinding:function(o,g,k,f,p,t){var r=this[k],l,s,h,q,m,j;if(t===true&&r!==undefined){l=this._computeBinding(o,r,g,this);p.call(this,l)}s=this[f];if(s===undefined||g===s){q=this.firstChild;while(q){q._applyBinding(o,g,k,f,p,true);q=q.nextSibling}}else{h=this.getOutOfBindingScopeChildren(k);for(m=0,j=h.length;m<j;m++){h[m]._applyBinding(o,g,k,f,p,true)}}},getOutOfBindingScopeChildren:function(f){return[]},_computeBinding:function(i,j,g,h){var f;if(j.constructor===String){f=this._computeStringBinding(i,j,g,h)}else{if(j.constructor===Object){f=this._computeObjectBinding(i,j,g,h)}else{if(j.constructor===Function){f=j.call(g,i,h)}}}return f},_computeStringBinding:function(k,n,f,g){var q,p,o=0,m=n.charAt(0),j,h,l;if(m==="@"){p=n.slice(1).split(".");o=p.length;if(o>0){q=k;for(j=0;j<o;j++){q=q[p[j]]}}}else{if(m==="$"){h=f[n.slice(1)];if(h!==undefined&&h.constructor===Function){q=h.call(f,k,g)}}else{if(m==="^"){l=e.exec(n);if(l[1]&&l[2]){q=b.tree.getCSSValue(l[1],l[2])}}}}return q},_computeObjectBinding:function(j,g,h,i){var f={},k;for(k in g){if(g.hasOwnProperty(k)){f[k]=this._computeBinding(j,g[k],h,i)}}return f}}}());(function(){b.ns("oui.lang");b.lang.LinkedListSupport={addLinkedList:function(C,u,n,B,g,h,A,l,x,y,s,r,v,m,w,o,i,z,k,q){var t=C.prototype,j,p,e,f;if(!b.isA(i,String)){i="_numChildren"}t[n]=null;t[B]=null;t[g]=null;t[h]=null;t[A]=null;t[i]=0;if(b.isA(m,String)&&b.isA(t[m],Function)){j=function(D){return this[m](D)}}if(!j){j=function(D){return b.isA(D,u)}}if(b.isA(w,String)){p=t[w]}if(!p){p=function(D){}}if(b.isA(o,String)){e=t[o]}if(!e){e=function(D){}}f="_safe"+x.charAt(0).toUpperCase()+x.slice(1);t[l]=function(D){return this[s](D)};t[s]=function(F,I){var D,E,G,H;if(j.call(this,F)===true){E=true;G=this;while(G&&G!==F){G=G[g]}if(G!==null){E=false;c.warn("WARN__HRCHY_REQ__INSERT_ANCEST")}}else{E=false;c.warn("WARN__HRCHY_REQ__INV_TYPE")}if(E){H=F[g];if(H!==null){H[f](F,(H===this))}if(!I){if(this[A]!==null){F[B]=this[A];this[A][n]=F}else{F[B]=null;this[h]=F}F[n]=null;this[A]=F;D=F}else{if(I===this[h]){this[h]=F;F[n]=I;F[B]=null;I[B]=F;D=F}else{if(I[g]===this){I[B][n]=F;F[B]=I[B];I[B]=F;F[n]=I;D=F}else{c.warn("WARN__NOTFOUND__INSERT")}}}if(D){F[g]=this;p.call(this,F,I,(H===this));this[i]++}}return D};t[f]=function(E,D){if(this[h]===E){this[h]=E[n];if(this[A]===E){this[A]=null}}else{if(this[A]===E){this[A]=E[B]}}if(E[B]!==null){E[B][n]=E[n]}if(E[n]!==null){E[n][B]=E[B]}E[B]=null;E[n]=null;E[g]=null;if(D!==true){e.call(this,E,false,true)}this[i]--};t[x]=function(E){var D;if(E&&E[g]===this){this[f](E,false);D=E}else{c.warn("WARN__NOTFOUND__REMOVE")}return D};t[y]=function(){var D=this[h],E;if(D!==null){while(D){E=D[n];D[g]=null;D[B]=null;D[n]=null;e.call(this,D,true,(E===null));D=E}this[h]=null;this[A]=null;this[i]=0}};t[r]=function(G,E){var D,F;if(b.isA(E,u)&&E[g]===this){F=E.nextSibling;this[x](E);this[s](G,F);D=E}return D};t[v]=function(){return(this[h]!==null)};if(b.isA(z,String)){t[z]=function(D){var F=null,E=this[i];if(D>=0&&D<E){F=this[h];E=0;while(E<D){F=F[n];E++}}return F}}if(b.isA(k,String)){t[k]=function(E){var D=0,F=this[h];while(F&&F!==E){F=F[n];D++}return(F===E)?D:-1}}if(b.isA(q,String)){t[q]=function(E,D){var F=this[z](D);this[s](E,F)}}}}}());(function(){b.ns("oui.lang");function f(m,l){return function(){return this[m][l]}}function k(n,m){var l=m.concat();return function(){var p=this[n],o,q=l.length;for(o=0;o<q;o++){p=p[l[o]]}return p}}function i(l){return function(n){var m;if(n.length===1){m=f(l,n[0])}else{m=k(l,n)}return m}}function h(l,m){return function(n){var o={};o[m]=n;this[l](o)}}function e(l,n){var m=n.concat();return function(r){var s={},p=s,o,q=m.length;for(o=0;o<q-1;o++){p[m[o]]={};p=p[m[o]]}p[m[q-1]]=r;this[l](s)}}function j(l){return function(n){var m;if(n.length===1){m=h(l,n[0])}else{m=e(l,n)}return m}}b.lang.PropertiesUtil={addConfig:function(w,l,t,u,o){var n=t+"Definition",p=function(){},r=this._getSuperConfig(w,t),v,m,q,s,x;if(r!==undefined){v=r.__configs[t].definitionClass;m=r.__configs[t].configClass;b.extend(p,v)}b.mixin(p,l);s=(function(y){return function(A){var C,B,z;if(A!==undefined){C=function(){};if(y!==undefined){b.extend(C,y)}for(B in A){C.prototype[B]=A[B]}this.definition=new C();b.buildDefaults(this.definition,this)}else{z=this.compounds;for(B in z){if(z.hasOwnProperty(B)){this[B]=new z[B]()}}}}}(v));q={updateObject:function(z,y){return b.applyProperties(z,this,this.definition,y)},definition:new p(),compounds:{}};this._getDefaultsAndCompounds(q.definition,q,q.compounds);if(m!==undefined){b.extend(s,m)}b.mixin(s,q);x=w;if(b.isA(w,Function)){x=w.prototype}if(u){this._addAccessors(l,"get",[],i("_"+t.toLowerCase()),x,true)}if(o){this._addAccessors(l,"set",[],j("apply"+t),x,false)}if(w.constructor===Function){w.prototype[n]=p;w.prototype[t]=s;w[n]=l}if(!w.__configs){w.__configs={}}w.__configs[t]={definitionClass:p,configClass:s}},_addAccessors:function(q,v,y,u,t,x){var l,m,s,r,o,w;if(q!==undefined){if(!this._isCompound(q)){m="";r=y.length;for(s=0;s<r;s++){o=y[s];if(o.length>0){m+=o.charAt(0).toUpperCase()+o.slice(1)}}l=u(y);if(x){t[m.charAt(0).toLowerCase()+m.slice(1)]=l}t[v+m]=l}else{w=q;if(q.type!==undefined){w=q.type}for(o in w){if(w.hasOwnProperty(o)===true){y.push(o);this._addAccessors(w[o],v,y,u,t,x);y.pop()}}}}},_getSuperConfig:function(l,n){var m=l.superClass;if(m){if(!m.__configs||!m.__configs[n]){m=this._getSuperConfig(m,n)}}return m},_isCompound:function(l){return(l.type===undefined&&l.constructor===Object)||(l.type!==undefined&&l.type.constructor===Object)},_compoundedDefaultsFactory:function(m){var l={},n={},o;this._getDefaultsAndCompounds(m,n,l);o=function(){var q;for(q in l){if(l.hasOwnProperty(q)===true){this[q]=new l[q]()}}};o.prototype=n;return o},_getDefaultsAndCompounds:function(m,o,l){var q,n;for(n in m){if((q=m[n])!==null&&q!==undefined&&q.constructor===Object){if(this._isCompound(q)){l[n]=this._compoundedDefaultsFactory(q)}else{o[n]=q.defaultValue}}}}};var g=b.lang.PropertiesUtil;b.addStyleSupport=function(l,m){g.addConfig(l,m,"Style",true,true)};b.addModelSupport=function(l,m){g.addConfig(l,m,"Model",false,false)};b.addPropertiesSupport=function(l,m){g.addConfig(l,m,"Properties",true,true)}}());(function(){b.declare({name:"oui.geom.Matrix",membersDef:{init:function(l,j,n,m,k,i){if(arguments.length>=1&&b.isA(l,Number)&&b.isA(j,Number)&&b.isA(n,Number)&&b.isA(m,Number)&&b.isA(k,Number)&&b.isA(i,Number)){this.a=l;this.b=j;this.c=n;this.d=m;this.tx=k;this.ty=i}else{this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0}},_safeTranslate:function(i,j){this.tx+=this.a*i+this.c*j;this.ty+=this.b*i+this.d*j;return this},_safeRotate:function(p,j,r){var l=(j!==0||r!==0),i,q,k=Math.cos(p),o=Math.sin(p);if(l){this._safeTranslate(j,r)}i=this.a;q=this.c;this.a=i*k+q*o;this.c=i*-o+q*k;i=this.b;q=this.d;this.b=i*k+q*o;this.d=i*-o+q*k;if(l){this._safeTranslate(-j,-r)}return this},_safeScale:function(i,j){this.a*=i;this.c*=j;this.b*=i;this.d*=j;return this},set:function(i){if(b.isA(i,b.geom.Matrix)){this.a=i.a;this.b=i.b;this.c=i.c;this.d=i.d;this.tx=i.tx;this.ty=i.ty}return this},isIdentity:function(){return this.tx===0&&this.ty===0&&this.a===1&&this.b===0&&this.c===0&&this.d===1},concat:function(i){if(b.isA(i,b.geom.Matrix)){this._concat(i)}return this},_concat:function(o){var n,m,l;n=this.a;m=this.c;l=this.tx;this.a=n*o.a+m*o.b;this.c=n*o.c+m*o.d;this.tx=n*o.tx+m*o.ty+l;n=this.b;m=this.d;l=this.ty;this.b=n*o.a+m*o.b;this.d=n*o.c+m*o.d;this.ty=n*o.tx+m*o.ty+l},transformAll:function(q,t){var l=q.length||0,s,o,r,p,n,m,k,j;t=t||q;l+=l%2;r=this.a;p=this.b;n=this.c;m=this.d;k=this.tx;j=this.ty;while(l--){s=q[--l];o=q[l+1];t[l]=r*s+n*o+k;t[l+1]=p*s+m*o+j}return t},transform:function(i,j){return{x:this.a*i+this.c*j+this.tx,y:this.b*i+this.d*j+this.ty}},det:function(){return(this.a*this.d)-(this.b*this.c)},inv:function(){var i,j=this.det();if(j!==0){i=new b.geom.Matrix();i.a=this.d/j;i.b=-this.b/j;i.c=-this.c/j;i.d=this.a/j;i.tx=(this.c*this.ty-this.tx*this.d)/j;i.ty=(this.tx*this.b-this.a*this.ty)/j}else{c.error("ERR__MTX__INV")}return i},clone:function(){var i=new b.geom.Matrix();i.a=this.a;i.b=this.b;i.c=this.c;i.d=this.d;i.tx=this.tx;i.ty=this.ty;return i},equals:function(k,i){var j=false;if(b.isA(k,b.geom.Matrix)){if(!i){j=k.a===this.a&&k.c===this.c&&k.tx===this.tx&&k.b===this.b&&k.d===this.d&&k.ty===this.ty}else{j=Math.abs(k.a-this.a)<i&&Math.abs(k.c-this.c)<i&&Math.abs(k.tx-this.tx)<i&&Math.abs(k.b-this.b)<i&&Math.abs(k.d-this.d)<i&&Math.abs(k.ty-this.ty)<i}}return j}}});b.geom.Matrix.IDENTITY=new b.geom.Matrix();function h(j){var i=j.length;return function(){var l=arguments,k=[];k.push.apply(k,l);if(k.length>0&&typeof k[0]==="number"){if(i===3&&l[1]===undefined){k[1]=0;k[2]=0}else{if(l[i-1]===undefined){k[i-1]=k[i-2]}}j.apply(this,k)}return this}}var g=b.geom.Matrix.prototype,e={},f;for(f in g){if(f.indexOf("_safe")===0){e[f.charAt(5).toLowerCase()+f.substr(6)]=h(g[f])}}b.mixin(b.geom.Matrix,e)}());(function(){var j="([+-]?\\d+(\\.\\d+)?)",h="translate\\(\\s*"+j+"\\s*,\\s*"+j+"\\s*\\)",g="matrix\\(\\s*"+j+"\\s*,\\s*"+j+"\\s*,\\s*"+j+"\\s*,\\s*"+j+"\\s*,\\s*"+j+"\\s*,\\s*"+j+"\\s*\\)",e=new RegExp(h,"g"),f=new RegExp(g,"g");function i(m,k){var l,n=null;f.lastIndex=0;e.lastIndex=0;if(b.isA(m,Array)&&m.length===6){n=new b.geom.Matrix(m[0],m[1],m[2],m[3],m[4],m[5])}else{l=f.exec(m);if(l===null){l=e.exec(m);if(l!==null){n=new b.geom.Matrix(1,0,0,1,parseFloat(l[1]),parseFloat(l[3]))}}else{n=new b.geom.Matrix(parseFloat(l[1]),parseFloat(l[3]),parseFloat(l[5]),parseFloat(l[7]),parseFloat(l[9]),parseFloat(l[11]))}}if(n===null){k.validValue=false}else{k.validValue=true;k.value=n}}b.mixin(b.defs,{Matrix:function(l,k){return b.defs._createDef("Matrix",b.geom.Matrix,l,k,i)}})}());(function(){b.ns("oui.geom");function g(i,h,j){return i+(h-i)*j}function f(i,h){return(i+h)/2}var e=5;b.mixin(b.geom,{DEG_TO_RAD:Math.PI/180,computeBounds:function(m){var n=m.length||0,j,l,k,h,p,o;if(n%2===0&&n>1){k=m[0];p=m[0];h=m[1];o=m[1];for(l=2;l<n;l+=2){k=m[l]<k?m[l]:k;p=m[l]>p?m[l]:p;h=m[l+1]<h?m[l+1]:h;o=m[l+1]>o?m[l+1]:o}j={x:k,y:h,width:p-k,height:o-h}}return j},intersectLine:function(s,i,q,h,k,p,j,m){var t=b.geom.slope(s,i,q,h),r=b.geom.slope(k,p,j,m),o=i-(t*s),l=p-(r*k),n,u;if(t===r||Math.abs(t-r)<0.000001){u=[]}else{if(!isFinite(t)){u=[s,r*s+l]}else{if(!isFinite(r)){u=[k,t*k+o]}else{n=(o-l)/(r-t);u=[n,(t*n+o+r*n+l)/2]}}}return u},intersectRect:function(l,k,q){var s,m,j,i,r,h,p,o,n;if(l&&k){if(q!==true){if((m=l.x)<=(p=k.x+k.width)&&(h=k.x)<=(j=l.x+l.width)&&(i=l.y)<=(n=k.y+k.height)&&(o=k.y)<=(r=l.y+l.height)){s={x:m>h?m:h,y:i>o?i:o};s.width=(j>p?p:j)-s.x;s.height=(r>n?n:r)-s.y}}else{if((m=l.x)<(p=k.x+k.width)&&(h=k.x)<(j=l.x+l.width)&&(i=l.y)<(n=k.y+k.height)&&(o=k.y)<(r=l.y+l.height)){s={x:m>h?m:h,y:i>o?i:o};s.width=(j>p?p:j)-s.x;s.height=(r>n?n:r)-s.y}}}return s},unionRect:function(m,k){var i,j,n,o,h;if(m&&k){j=Math.min(m.x,k.x);n=Math.min(m.y,k.y);o=Math.max(m.x+m.width,k.x+k.width);h=Math.max(m.y+m.height,k.y+k.height);i={x:j,y:n,width:o-j,height:h-n}}else{i=m||k}return i},calculateAngle:function(h,l,j,i){var k=Math.atan2(i,j)-Math.atan2(l,h);if(k<0){k+=2*Math.PI}return k},slope:function(i,k,h,j){return(h-i===0)?Number.POSITIVE_INFINITY:((j-k)/(h-i))},distSq:function(i,k,h,j){return(i-h)*(i-h)+(k-j)*(k-j)},dist:function(i,k,h,j){return Math.sqrt(b.geom.distSq(i,k,h,j))},centroid:function(o,k,h){var m=0,l=0,p=o.length,j=p-1;while(j>=0){m+=o[j][k];l+=o[j][h];j--}return{x:(m/p),y:(l/p)}},dotprod:function(h,k,j,i){return(h*j)+(k*i)},ptSegDistSq:function(j,n,i,l,p,o){var m,h,k;i-=j;l-=n;p-=j;o-=n;m=p*i+o*l;if(m<=0){h=0}else{p=i-p;o=l-o;m=p*i+o*l;if(m<=0){h=0}else{h=m*m/(i*i+l*l)}}k=p*p+o*o-h;if(k<0){k=0}return k},isPointInEllipse:function(i,m,h,l,k,j){i=(i-h)/k;m=(m-l)/j;return(i*i+m*m)<=1},isPointInTriangle:function(s,q,t,r,H,G,n,l){var A=b.geom.dotprod,k=n-t,j=l-r,p=H-t,o=G-r,F=s-t,D=q-r,E=A(k,j,k,j),C=A(k,j,p,o),B=A(k,j,F,D),i=A(p,o,p,o),h=A(p,o,F,D),m=1/(E*i-C*C),z=(i*B-C*h)*m,w=(E*h-C*B)*m;return(z>=0)&&(w>=0)&&(z+w<=1)},isValidRect:function(h){return h!==undefined&&h!==null&&!isNaN(h.x)&&!isNaN(h.y)&&h.width>=0&&h.height>=0},getBoundedXY:function(m,A,o,v){var j=b.geom,n=null,l,k,q,p,u,t,i,h,s,r,z,w;if(!b.isFiniteNumber(o)){o=e}if(j.isValidRect(m)&&j.isValidRect(A)){l=m.x;k=m.y;q=m.width;p=m.height;u=A.x+o;t=A.y+o;i=A.width-2*o;h=A.height-2*o;if(v){s=v.x;r=v.y;z=2*s-(l+q);w=2*r-(k+p)}if(i>q){if(l<u){l=u}else{if(l+q>u+i){l=u+i-q;if(v&&s>l&&s<l+q&&r>k&&r<k+p&&z>=u&&z+q<=u+i){l=z}}}}else{if(i===q){l=u}}if(h>p){if(k<t){k=t}else{if(k+p>t+h){k=t+h-p;if(v&&s>l&&s<l+q&&r>k&&r<k+p&&w>=t&&w+p<=t+h){k=w}}}}else{if(h===p){k=t}}n={x:l,y:k}}return n},getBoxCtrlPts:function(i,l,k,h){var j=[];if(k>0&&h>0){j.push(i,l,i+k,l,i+k,l+h,i,l+h)}else{if(k>0){j.push(i,l,i+k,l)}else{if(h>0){j.push(i,l,i,l+h)}else{j.push(i,l)}}}return j},crossLine:function(k,m,j,l,i,n){var h;if((i<k&&i<j)||(i>k&&i>j)||(n>m&&n>l)||(k===j)){h=0}else{if(i===k){h=k<j?0:-1}else{if(i===j){h=k<j?1:0}else{if((n-m)-(l-m)*(i-k)/(j-k)<0){h=(k<j)?1:-1}else{h=0}}}}return h},crossQuad:function(j,n,i,m,h,k,o,l){var p;if((o<j&&o<i&&o<h)||(o>j&&o>i&&o>h)||(l>n&&l>m&&l>k)||(j===i&&i===h)){p=0}else{p=b.geom.crossLine(j,n,i,m,o,l)+b.geom.crossLine(i,m,h,k,o,l)}return p},crossCubic:function(j,p,i,n,h,l,r,k,o,m){var q;if((o<j&&o<i&&o<h&&o<r)||(o>j&&o>i&&o>h&&o>r)||(m>p&&m>n&&m>l&&m>k)||(j===i&&i===h&&h===r)){q=0}else{q=b.geom.crossLine(j,p,i,n,o,m)+b.geom.crossLine(i,n,h,l,o,m)+b.geom.crossLine(h,l,r,k,o,m)}return q},cubic2Quad:function(y,x,I,H,m,k,A,z){var u=f(y,I),t=f(x,H),o=f(I,m),n=f(H,k),l=f(m,A),j=f(k,z),C=f(u,o),B=f(t,n),K=f(o,l),J=f(n,j),r=g(y,u,3/4),p=g(x,t,3/4),E=g(C,K,1/8),D=g(B,J,1/8),M=g(K,C,1/8),L=g(J,B,1/8),s=g(A,l,3/4),q=g(z,j,3/4),w=f(r,E),v=f(p,D),G=f(C,K),F=f(B,J),i=f(M,s),h=f(L,q);return[r,p,w,v,E,D,G,F,M,L,i,h,s,q,A,z]},quad2Cubic:function(q,p,m,l,j,h){var k=q+(2/3)*(m-q),i=p+(2/3)*(l-p),o=k+(1/3)*(j-q),n=i+(1/3)*(h-p);return[k,i,o,n,j,h]},_isFlatQuad:function(j,q,m,k,h,p,l,i){var n,r,o=b.geom.dist;if(i===undefined||i<0){n=2/l;r=o(j,q,m,k)+o(m,k,h,p)-o(j,q,h,p)}else{n=i*i;r=b.geom.ptSegDistSq(j,q,h,p,m,k)}return r<n},_isFlatCubic:function(j,t,q,m,p,l,h,s,n,i){var o,u,r=b.geom.dist,k;if(i===undefined||i<0){o=2/n;u=r(j,t,q,m)+r(q,m,p,l)+r(p,l,h,s)-r(j,t,h,s)}else{k=b.geom.ptSegDistSq;o=i*i;u=Math.max(k(j,t,h,s,q,m),k(j,t,h,s,p,l))}return u<o},flattenQuad:function(k,s,p,n,h,r,q,o,j){var x=b.geom.flattenQuad,i=b.geom._isFlatQuad,w,v,m,l,u,t;if(o<=0||i(k,s,p,n,h,r,o,j)){q.push(h,r)}else{o--;w=(k+p)/2;v=(s+n)/2;m=(p+h)/2;l=(n+r)/2;u=(w+m)/2;t=(v+l)/2;x(k,s,w,v,u,t,q,o,j);x(u,t,m,l,h,r,q,o,j)}},flattenCubic:function(w,i,s,C,q,B,v,h,u,z,A){var t=b.geom.flattenCubic,D=b.geom._isFlatCubic,r,o,F,m,E,l,y,k,x,j,p,n;if(z<=0||D(w,i,s,C,q,B,v,h,z,A)){u.push(v,h)}else{z--;r=(s+q)/2;o=(C+B)/2;F=(w+s)/2;m=(i+C)/2;E=(F+r)/2;l=(m+o)/2;x=(q+v)/2;j=(B+h)/2;y=(r+x)/2;k=(o+j)/2;p=(E+y)/2;n=(l+k)/2;t(w,i,F,m,E,l,p,n,u,z,A);t(p,n,y,k,x,j,v,h,u,z,A)}}})}());(function(){function e(j,l,h,k,g,i){return(h-j)*(i-l)-(k-l)*(g-j)}function f(j,o,h,m,g,l){var p,n,k,q=(h-j),i=(m-o);p=((g-j)*q+(l-o)*i)/(q*q+i*i);n=j+p*q;k=o+p*i;return(n-g)*(n-g)+(k-l)*(k-l)}b.mixin(b.geom,{computeConvexHull:function(h){var g,i=h.length;if(i>2&&(i%2)===0){g=this._quickHull(h)}else{if(i===2){g=[h[0],h[1]]}else{g=[]}}return g},_quickHull:function(y){var t=[],p=y.length,h,q,s,v,u,g,o,m,k,j,w;for(s=h=q=0;s<p;s+=2){v=y[s];if(y[q]<v||(y[q]===v&&y[q+1]<y[s+1])){q=s}if(y[h]>v||(y[h]===v&&y[h+1]>y[s+1])){h=s}}if(q===h){t.push(y[q],y[q+1])}else{u=[];g=[];o=y[q];m=y[q+1];k=y[h];j=y[h+1];for(s=0;s<p;s+=2){if(s===q||s===h){continue}w=e(o,m,k,j,y[s],y[s+1]);if(w>0){u.push(y[s],y[s+1])}else{if(w<0){g.push(y[s],y[s+1])}}}t.push(k,j);b.geom._quickHullRecurse(k,j,o,m,u,t);t.push(o,m);b.geom._quickHullRecurse(o,m,k,j,g,t)}return t},_quickHullRecurse:function(j,s,h,r,v,m){var l,k=v.length,g,p,u,t,q,o;if(k>0){l=b.geom._farthestPointIndex(j,s,h,r,v);g=v[l];p=v[l+1];u=[];t=[];for(l=0;l<k;l+=2){q=v[l];o=v[l+1];if((q===j&&o===s)||(q===h&&o===r)){continue}else{if(e(g,p,j,s,q,o)>0){u.push(q,o)}else{if(e(h,r,g,p,q,o)>0){t.push(q,o)}}}}b.geom._quickHullRecurse(j,s,g,p,u,m);m.push(g,p);b.geom._quickHullRecurse(g,p,h,r,t,m)}},_farthestPointIndex:function(h,q,g,p,s){var k,j=s.length,t=-1,r=-1,o,m,l;for(k=0;k<j;k+=2){o=s[k];m=s[k+1];if((o===h&&m===q)||(o===g&&m===p)){continue}l=f(h,q,g,p,o,m);if(l>r){r=l;t=k}}return t}})}());(function(){b.UIEvents={ACTIVATE:"activate",FOCUS_IN:"focusIn",FOCUS_OUT:"focusOut"};b.MouseEvents={CLICK:"click",DBL_CLICK:"dblClick",MOUSE_DOWN:"mouseDown",MOUSE_UP:"mouseUp",MOUSE_OVER:"mouseOver",MOUSE_OUT:"mouseOut",MOUSE_MOVE:"mouseMove",MOUSE_ENTER:"mouseEnter",MOUSE_LEAVE:"mouseLeave",MOUSE_WHEEL:"mouseWheel"};b.KeyEvents={KEY_DOWN:"keyDown",KEY_UP:"keyUp"};b.SyncEvents={BEGIN:"begin",END:"end",REPEAT:"repeat"};b.DragEvents={DRAG:"drag",DRAG_START:"dragStart",DRAG_END:"dragEnd"};b.TouchEvents={TOUCH_START:"touchStart",TOUCH_END:"touchEnd",TOUCH_MOVE:"touchMove",TOUCH_ENTER:"touchEnter",TOUCH_LEAVE:"touchLeave"};b.GenericGestureEvents={GESTURE_START:"gestureStart",GESTURE_CHANGE:"gestureChange",GESTURE_END:"gestureEnd"};b.GestureEvents={TAP:"tap",DBL_TAP:"dblTap",TOUCH_LONG_PRESS:"touchLongPress",PRESS_AND_TAP:"pressAndTap",SWIPE:"swipe",PINCH:"pinch"};b.GestureEventPhases={BEGIN:"Begin",CHANGE:"Change",CANCEL:"Cancel",END:"End"};b.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2};b.ViewEvents={LOAD:"load",VIEWPORT_RESIZE:"viewportResize",RELEASE_FOCUS:"releaseFocus",FOCUS_COMPONENT:"focusComponent",BLUR_COMPONENT:"blurComponent",USER_EVENTS_SUPPORTED:"userEventsSupported",ABOUT_INFO_REQUEST:"aboutInfoRequest",DEVICE_ORIENTATION:"deviceOrientation"}}());(function(){b.ns("oui.events");var i="CAPTURE",j="BUBBLE";function e(m,l){if(m){if(m.handleEvent){m.handleEvent(l)}else{m.call(null,l)}}}function k(l){return(typeof l==="function"||(l!==null&&l!==undefined&&typeof l.handleEvent==="function"))}function f(l){this.defaultPrevented=true;if(l!==true&&this.preventNativeDefault){this.preventNativeDefault()}}function g(l){this.stopped=true;if(l!==true&&this.stopNativePropagation){this.stopNativePropagation()}}function h(l){this.stoppedImmediate=true;this.stopPropagation(l)}b.events.EventSupport={_snapshotListeners:function(p){var o=[],n=[],r=[],m=[],l=[],q=this;p=p.toLowerCase();while(q){o.push(q);q._appendListeners(p,n,r,m,l);q=q.parentNode}return{nodes:o,bubbleListeners:n,captureListeners:r,bubbleIndices:m,captureIndices:l}},_appendListeners:function(o,q,m,l,n){var p=this.listeners;n.push(m.length);if(p&&p[o]){m.push.apply(m,p[o][i]);q.push.apply(q,p[o][j])}l.push(q.length-1)},_checkListeners:function(){if(this.listeners===undefined){this.listeners={}}},addEventListener:function(p,q,m){var r,l,o,n=false;if(typeof p==="string"&&k(q)){p=p.toLowerCase();this._checkListeners();if(this.listeners[p]===undefined){this.listeners[p]={};this.listeners[p][i]=[];this.listeners[p][j]=[]}r=m===true?i:j;l=this.listeners[p][r];o=l.length;while(o--&&!n){n=(q===l[o])}if(!n){l.push(q)}}},removeEventListener:function(n,o,m){var l,p;if(typeof n==="string"&&k(o)&&this.listeners){n=n.toLowerCase();l=this.listeners[n];if(l){p=m===true?i:j;b.arrayRemove(l[p],o,false)}}},dispatchEvent:function(l){var u,p,v,m,n,q,x,z,r,y,o,w,t,s;if(l&&typeof l.type==="string"){l.timeStamp=b.currentTimeMillis();u=(l.bubbles!==false);p=(l.cancelable===true);v=null;if(typeof l.defaultAction==="function"){v=l.defaultAction}l.CAPTURING_PHASE=1;l.AT_TARGET=2;l.BUBBLING_PHASE=3;l.preventDefault=f;l.stopPropagation=g;l.stopImmediatePropagation=h;m=this._snapshotListeners(l.type);n=m.nodes;q=m.captureListeners;x=m.bubbleListeners;z=m.captureIndices;r=m.bubbleIndices;l.eventPhase=l.CAPTURING_PHASE;l.target=this;l.stopped=false;l.stoppedImmediate=false;l.defaultPrevented=false;y=q.length-1;for(t=n.length-1;t>0&&l.stopped===false;t--){l.currentTarget=n[t];for(s=y;s>=z[t]&&l.stoppedImmediate===false;s--){e(q[y],l);y--}}l.eventPhase=l.AT_TARGET;l.currentTarget=this;o=0;if(l.stopped!==true){for(s=y;s>=0&&l.stoppedImmediate===false;s--){e(q[y],l);y--}for(s=0;s<=r[0]&&l.stoppedImmediate===false;s++){e(x[o],l);o++}}if(u){l.eventPhase=l.BUBBLING_PHASE;w=n.length;for(t=1;t<w&&l.stopped===false;t++){l.currentTarget=n[t];for(s=o;s<=r[t]&&l.stoppedImmediate===false;s++){e(x[o],l);o++}}}if(v!==null&&(p===false||l.defaultPrevented!==true)){v.call(null,l)}}},getDefaultActivateAction:function(){var l;if(this.activateAction){l=this.activateAction}else{if(b.isA(this.getActivateAction,Function)){l=this.getActivateAction()}}return l},handler:function(p,n,m,l,q){var o=null,r=null;if(p){if(typeof p==="string"){if(typeof this[p]==="function"){o=this;r=this[p]}}else{if(typeof p==="function"){r=p}else{if(typeof p.handleEvent==="function"){o=p;r=p.handleEvent}}}}if(!r){c.error("ERR__EVT__INV_HANDLER")}return function(s){if(b.isValueInConstraint(s,q)){if(l===true){s.stopPropagation()}if(m===true){s.preventDefault()}r.call(o,s,n)}}}}}());(function(){b.ns("oui.events");var l=b.events,i=b.defs,m={},o,s,n,r,p,f,k;function e(w,v){var t,u=Math.min(w.length,v.length);for(t=0;t<u;t++){if(w[t]!==v[t]){break}}return(t-1)}function g(){l._stopNextNativeMouseEvent(this.type,this.clientX,this.clientY)}r={mousedown:function(t,u){if(!o||u!==o.target||t.clientX!==o.clientX||t.clientY!==o.clientY){n=1}else{n++}if(t.hasOwnProperty("detail")===false){t.detail=n}o=t},mouseup:function(t,u){if(!o||u!==o.target||t.clientX!==o.clientX||t.clientY!==o.clientY){n=1}if(t.hasOwnProperty("detail")===false){t.detail=n}}};p={mouseover:function(t){l.handleEnter(t.target,t.relatedTarget,b.MouseEvents.MOUSE_ENTER,t)},mouseout:function(t){l.handleLeave(t.target,t.relatedTarget,b.MouseEvents.MOUSE_LEAVE,t)},mousedown:function(t){var u=t.target,v=u;if(b.focus.isFocusableTarget(u)!==true){v=b.focus.getFocusableAncestor(u)}if(v!==null){b.focusManager.requestFocus(v,t);v.dispatchEvent({type:b.UIEvents.ACTIVATE,defaultAction:v.getDefaultActivateAction()})}},mouseup:function(w){var v=b.MouseEvents.CLICK,u=b.MouseEvents.DBL_CLICK,t;if(o&&w.target===o.target&&w.clientX===o.clientX&&w.clientY===o.clientY){t={type:v,clientX:w.clientX,clientY:w.clientY,pageX:w.pageX,pageY:w.pageY,userX:w.userX,userY:w.userY,ctrlKey:w.ctrlKey,shiftKey:w.shiftKey,altKey:w.altKey,button:w.button,detail:w.detail,defaultAction:null,stopNativePropagation:g};w.target.dispatchEvent(t);if(s&&t.target===s.target&&t.userX===s.userX&&t.userY===s.userY&&t.button===s.button&&t.detail%2===0&&t.timeStamp-s.timeStamp<500){t.target.dispatchEvent({type:u,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,userX:t.userX,userY:t.userY,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,button:t.button,detail:t.detail,defaultAction:null,stopNativePropagation:g})}s=t}}};f={KEYS:"KEYS",MOUSE:"MOUSE",WHEEL:"WHEEL",TOUCHES:"TOUCHES",GESTURES:"GESTURES"};k=function(){this._initProperties()};b.mixin(k,b.lang.PropertiesSupport);b.mixin(k,{onPropChanged:function(u){var t=this._properties.fromPlatform;switch(u){case f.KEYS:l.toggleNativeKeys(t.keyEvents);break;case f.MOUSE:l.toggleNativeMouse(t.mouseEvents);break;case f.WHEEL:l.toggleNativeWheel(t.wheelEvents);break;case f.TOUCHES:l.toggleNativeTouches(t.touchEvents);break;case f.GESTURES:l.toggleNativeGestures(t.gestureEvents);break;default:}}});b.addPropertiesSupport(k,{fromPlatform:{keyEvents:i.Boolean(false,f.KEYS),mouseEvents:i.Boolean(false,f.MOUSE),wheelEvents:i.Boolean(false,f.WHEEL),touchEvents:i.Boolean(false,f.TOUCHES),gestureEvents:i.Boolean(false,f.GESTURES)},fromContainer:{keyEvents:i.Boolean(true),mouseEvents:i.Boolean(true),wheelEvents:i.Boolean(true),touchEvents:i.Boolean(true),gestureEvents:i.Boolean(true)}});b.mixin(b.events,{_userEventsSupport:new k(),setUserEventsSupported:function(t){l._userEventsSupport.applyProperties(t)},getUserEventsSupported:function(){var t=l._userEventsSupport;return{fromPlatform:{keyEvents:t.fromPlatformKeyEvents(),mouseEvents:t.fromPlatformMouseEvents(),wheelEvents:t.fromPlatformWheelEvents(),touchEvents:t.fromPlatformTouchEvents(),gestureEvents:t.fromPlatformGestureEvents()},fromContainer:{keyEvents:t.fromContainerKeyEvents(),mouseEvents:t.fromContainerMouseEvents(),wheelEvents:t.fromContainerWheelEvents(),touchEvents:t.fromContainerTouchEvents(),gestureEvents:t.fromContainerGestureEvents()}}},toggleNativeKeys:function(t){},toggleNativeMouse:function(t){},toggleNativeWheel:function(t){},toggleNativeTouches:function(t){},toggleNativeGestures:function(t){},dispatchExternalEvent:function(u){var t=null;if(typeof b.config.catchAllEventListener==="function"&&u){u.domId=b.config.domId;b.config.catchAllEventListener(u,u.domId);t=u.returnValue}return t},handleExternalEvent:function(A){var C=l._userEventsSupport,D,u,y,v,t=C.fromContainerKeyEvents(),x=C.fromContainerMouseEvents(),B=C.fromContainerWheelEvents(),w=C.fromContainerTouchEvents(),z=C.fromContainerGestureEvents();if(A===null){c.warn("WARN__EVT__NPE")}else{if(A){u={type:A.type};y=null;if(b.hasOwnValue(b.KeyEvents,u.type,true)){if(t){u.cancelable=true;y=b.focusManager.getFocusOwner();u.keyCode=A.keyCode;l._getModifiers(u,A)}}else{if(b.equalIgnoreCase(b.MouseEvents.MOUSE_WHEEL,u.type)){if(B){y=l._getNodeFromContainer(A);if(y){l._getCoordsFromContainer(u,A,y);l._getModifiers(u,A);if(typeof A.delta==="number"){u.delta=A.delta}else{u.delta=0}}}}else{if(b.hasOwnValue(b.MouseEvents,u.type,true)){if(x){y=l._getNodeFromContainer(A);if(y){l._getCoordsFromContainer(u,A,y);l._getModifiers(u,A);if(b.equalIgnoreCase(b.MouseEvents.MOUSE_OVER,u.type)||b.equalIgnoreCase(b.MouseEvents.MOUSE_OUT,u.type)){u.relatedTarget=null}if(typeof A.button==="number"){u.button=A.button}else{u.button=0}}}}else{if(b.hasOwnValue(b.TouchEvents,u.type,true)){if(w){y=l._getNodeFromContainer(A);if(y){l._getCoordsFromContainer(u,A,y);l._getModifiers(u,A)}}}else{if(b.hasOwnValue(b.GenericGestureEvents,u.type,true)){if(z){y=b.rootNode;u.rotation=A.rotation;u.scale=A.scale}}else{y=b.rootNode;for(v in A){if(v!=="type"){u[v]=A[v]}}}}}}}if(y!==null){l._dispatchTo(y,u)}D=u.returnValue}}return D},_dispatchKeyEvent:function(v){var t,u=b.focusManager.getFocusOwner();if(u!==null){t=l._createAPIEvent(v,true);l._getKeyArgs(t,v);l._dispatchTo(u,t)}},_dispatchMouseEvent:function(v){var t,u=l._getAPITarget(v);if(u!==null){t=l._createAPIEvent(v);l._getMouseArgs(t,v,u);l._dispatchTo(u,t)}},_dispatchTouchEvent:function(w){var v=l._createAPIEvent(w,true),C=w.changedTouches,E=C.length,F=[],u=w.targetTouches,I=u.length,D=[],G=w.touches,z=G.length,B=[],H,A,y,x;if(v.type===b.TouchEvents.TOUCH_START){for(H=0;H<E;H++){A=C[H];y=l._createAPITouch(A);if(y){x={touchValue:y,relatedTarget:null};m[A.identifier]=x;l._handleTouchEnterLeave(A,x);F.push(y)}}}else{for(H=0;H<E;H++){A=C[H];x=m[A.identifier];if(x){y=x.touchValue;l._updateAPITouch(A,y);l._handleTouchEnterLeave(A,x);F.push(y)}}}for(H=0;H<I;H++){A=u[H];x=m[A.identifier];if(x){D.push(x.touchValue)}}for(H=0;H<z;H++){A=G[H];x=m[A.identifier];if(x){B.push(x.touchValue)}}v.changedTouches=F;v.targetTouches=D;v.touches=B;l._getModifiers(v,w);l._getGestureArgs(v,w);if(F.length>0&&F[0].target){l._dispatchTo(F[0].target,v)}},_handleTouchEnterLeave:function(v,u){var w=l._getAPITarget(v),t;if(w!==null){t=u.relatedTarget;if(w!==t){if(t!==null){l.handleLeave(t,w,b.TouchEvents.TOUCH_LEAVE,u.touchValue)}l.handleEnter(w,t,b.TouchEvents.TOUCH_ENTER,u.touchValue)}u.relatedTarget=w}},handleEnter:function(z,t,w,y){var x=z.getAncestors(),u=-1,v;if(t!==null){u=e(x,t.getAncestors())}for(v=u+1;v<x.length;v++){x[v].dispatchEvent({type:w,clientX:y.clientX,clientY:y.clientY,userX:y.userX,userY:y.userY,ctrlKey:y.ctrlKey,shiftKey:y.shiftKey,altKey:y.altKey,relatedTarget:t,bubbles:false})}},handleLeave:function(z,t,w,y){var x=z.getAncestors(),u=-1,v;if(t!==null){u=e(x,t.getAncestors())}for(v=x.length-1;v>u;v--){x[v].dispatchEvent({type:w,clientX:y.clientX,clientY:y.clientY,userX:y.userX,userY:y.userY,ctrlKey:y.ctrlKey,shiftKey:y.shiftKey,altKey:y.altKey,relatedTarget:t,bubbles:false})}},_createAPITouch:function(){},_updateAPITouch:function(){return null},_dispatchGestureEvent:function(u){var t=l._createAPIEvent(u,true);l._getGestureArgs(t,u);l._dispatchTo(b.rootNode,t)},_createAPIEvent:function(t,u){return{type:l._getAPIType(t),cancelable:u,preventNativeDefault:l._preventNativeDefault(t),stopNativePropagation:l._stopNativePropagation(t)}},_dispatchTo:function(x,w){var t=w.type.toLowerCase(),v=r[t],u=p[t];if(v){v(w,x)}x.dispatchEvent(w);if(u){u(w)}b.tree.layout()},_getModifiers:function(u,t){u.ctrlKey=t.ctrlKey;u.shiftKey=t.shiftKey;u.altKey=t.altKey},_getNodeFromContainer:function(w){var v=null,u=w.clientX,t=w.clientY,x=w.delta;if(isFinite(u)&&isFinite(t)){v=b.tree.getNodeAt(u,t)}else{if(isFinite(x)){v=b.rootNode}}return v},_getCoordsFromContainer:function(t,x,w){var v=x.clientX,u=x.clientY,y=w.globalToLocal(v,u);t.clientX=v;t.clientY=u;t.pageX=x.pageX;t.pageY=x.pageY;t.userX=y.x;t.userY=y.y},_getAPIType:function(){return undefined},_preventNativeDefault:function(t){return function(){t.preventDefault()}},_stopNativePropagation:function(t){return function(){t.stopPropagation()}},_stopNextNativeMouseEvent:function(){},_getAPITarget:function(){return null},_getKeyArgs:function(){},_getMouseArgs:function(){},_getGestureArgs:function(){}});function h(t){return function(v,u){this.addEventListener(t,v,u)}}function j(t){return function(v,u){this.removeEventListener(t,v,u)}}function q(t){return function(w){var u="",v="";if(w===undefined){w=0}u+=t;v+=w;if(!this._eventDescCache){this._eventDescCache={}}if(!this._eventDescCache[u]){this._eventDescCache[u]={}}if(!this._eventDescCache[u][v]){this._eventDescCache[u][v]={source:this,type:t,offset:w}}return this._eventDescCache[u][v]}}b.addEventsSupport=function(B,v){var z=B.superClass,y=B.prototype,C={},A,t,x,w,u;if(b.isA(v,Array)){x={};for(w=0,u=v.length;w<u;w++){b.mixin(x,v[w])}v=x}if(z&&z.prototype.events){C.prototype=z.prototype.events}for(t in v){if(v.hasOwnProperty(t)){A=v[t];C[t]=A;x=A.charAt(0).toUpperCase()+A.substr(1);y["on"+x]=h(A);y["off"+x]=j(A);y["on"+x+"At"]=q(A)}}y.events=C}}());(function(){var n=b.events,r=null,w=b.MouseEvents,x=b.KeyEvents,y=b.TouchEvents,q=b.GenericGestureEvents,t=b.CursorType.AUTO,v={},o="mousedown",g="mouseup",u="mouseover",B="mouseout",s="mousemove",m="keydown",i="keyup",e="touchstart",l="touchmove",f="touchend",p="gesturestart",k="gesturechange",j="gestureend";v[o]=w.MOUSE_DOWN;v[g]=w.MOUSE_UP;v[s]=w.MOUSE_MOVE;v[u]=w.MOUSE_OVER;v[B]=w.MOUSE_OUT;v[m]=x.KEY_DOWN;v[i]=x.KEY_UP;v[e]=y.TOUCH_START;v[l]=y.TOUCH_MOVE;v[f]=y.TOUCH_END;v[p]=q.GESTURE_START;v[k]=q.GESTURE_CHANGE;v[j]=q.GESTURE_END;function h(C){var E=n._getAPITarget(C),D;D={type:C.type,apiTarget:E,clientX:C.clientX,clientY:C.clientY,ctrlKey:C.ctrlKey,shiftKey:C.shiftKey,altKey:C.altKey,detail:C.detail,button:C.button,stopPropagation:function(){C.stopPropagation()},preventDefault:function(){C.preventDefault()}};if(E){n._dispatchMouseEvent(D)}if(E!==r){if(r){D.type=B;D.apiTarget=r;D.apiRelatedTarget=E;D.stopPropagation=b.NO_OP;D.preventDefault=b.NO_OP;n._dispatchMouseEvent(D)}if(E){D.type=u;D.apiTarget=E;D.apiRelatedTarget=r;D.stopPropagation=b.NO_OP;D.preventDefault=b.NO_OP;n._dispatchMouseEvent(D)}}r=E}function A(C){C.apiTarget=r;C.apiRelatedTarget=null;n._dispatchMouseEvent(C);r=null}function z(C){return(C?"add":"remove")+"EventListener"}b.mixin(b.events,{_stopNextNativeMouseEvent:function(F,C,H){var D=b.tree.canvas,E=F.toLowerCase(),G;G=function(I){var J=n.cvClientToRootCoords(I);if(C===J.x&&H===J.y){I.stopPropagation()}D.removeEventListener(E,G,true)};D.addEventListener(E,G,true)},_getAPIType:function(C){return v[C.type]},_getAPITarget:function(C){var D=null,E;if(!C.apiTarget){E=this.cvClientToRootCoords(C);D=b.tree.getNodeAt(E.x,E.y)}else{D=C.apiTarget}return D},_getKeyArgs:function(D,C){D.keyCode=C.keyCode;this._getModifiers(D,C)},_getMouseArgs:function(D,C,F){var E=C.type,G=this.cvClientToRootCoords(C);this.cvSetCoords(D,C,F,G);this._getModifiers(D,C);if(C.button!==undefined){D.button=C.button}if(E===u){D.relatedTarget=C.apiRelatedTarget;this.cvSetCursor(F)}else{if(E===B){D.relatedTarget=C.apiRelatedTarget;this.cvSetCursor(null)}}},_createAPITouch:function(C){var E,D=this.cvClientToRootCoords(C),F=b.tree.getNodeAt(D.x,D.y);if(F){E={identifier:C.identifier,target:F};this.cvSetCoords(E,C,F,D)}return E},_updateAPITouch:function(C,E){var D=this.cvClientToRootCoords(C);this.cvSetCoords(E,C,E.target,D)},_getGestureArgs:function(D,C){D.rotation=C.rotation;D.scale=C.scale},cvClientToRootCoords:function(C){var D=b.tree.cvGetRootClientCoords();return{x:(C.clientX-D.x),y:(C.clientY-D.y)}},cvSetCoords:function(C,E,F,D){var G=F.globalToLocal(D.x,D.y);C.clientX=D.x;C.clientY=D.y;C.userX=G.x;C.userY=G.y;C.screenX=E.screenX;C.screenY=E.screenY},toggleNativeKeys:function(E){var D=b.tree.canvas,C=z(E);D[C](m,this._dispatchKeyEvent,false);D[C](i,this._dispatchKeyEvent,false)},toggleNativeMouse:function(E){var D=b.tree.canvas,C=z(E);D[C](o,this._dispatchMouseEvent,false);D[C](g,this._dispatchMouseEvent,false);D[C](s,h,false);D[C](B,A,false)},toggleNativeTouches:function(E){var D=b.tree.canvas,C=z(E);D[C](e,this._dispatchTouchEvent,false);D[C](l,this._dispatchTouchEvent,false);D[C](f,this._dispatchTouchEvent,false)},toggleNativeGestures:function(E){var D=b.tree.canvas,C=z(E);D[C](p,this._dispatchGestureEvent,false);D[C](k,this._dispatchGestureEvent,false);D[C](j,this._dispatchGestureEvent,false)},cvSetCursor:function(D){var C=b.tree.canvas,E=t;while(D&&E===t){E=D.cursor();D=D.parentNode}C.style.cursor=(typeof E==="object"?"none":E)},cvGetLastTarget:function(){return r}})}());(function(){b.ns("oui.events");b.events.addDragSupport=function(l){var i,j,o,e,n,m,k,f,h,g;j=function(p){var r,q,v,t,u,s,x,w;p.stopPropagation();p.preventDefault();if(p.changedTouches===undefined){r=p.clientX;q=p.clientY}else{w=p.changedTouches[0];r=w.clientX;q=w.clientY}x=n.globalToLocal(r,q);v=x.x;t=x.y;x=n.globalToLocal(h,g);u=x.x;s=x.y;n.dispatchEvent({type:b.DragEvents.DRAG,cancelable:true,dragClientX:(r-h),dragClientY:(q-g),dragUserX:(v-u),dragUserY:(t-s),clientX:r,clientY:q,userX:v,userY:t,shiftKey:p.shiftKey,ctrlKey:p.ctrlKey,defaultAction:n.getDefaultDragAction()});h=r;g=q};o=function(p){var s,q,u,t,x,w,A,y,r,z,v;l.offMouseMove(j);l.offMouseUp(o);l.offTouchMove(j);l.offTouchEnd(o);l.offMouseLeave(o);if(n){A=n.globalToLocal(m,k);x=A.x;w=A.y;s=h;q=g;y=false;r=false;if(p){if(p.changedTouches===undefined){s=p.clientX;q=p.clientY}else{v=p.changedTouches[0];s=v.clientX;q=v.clientY}y=p.shiftKey;r=p.ctrlKey;z=p.timeStamp-f}A=n.globalToLocal(s,q);u=A.x;t=A.y;n.dispatchEvent({type:b.DragEvents.DRAG_END,cancelable:true,shiftKey:y,ctrlKey:r,clientX:s,clientY:q,userX:u,userY:t,totalDragClientX:(s-m),totalDragClientY:(q-k),totalDragUserX:(u-x),totalDragUserY:(t-w),totalDragTime:z});n=undefined}};e=function(){l.onMouseLeave(o)};i=function(t){var v=t.target,s,r,u=t.touches,p,q=false,w;if(u!==undefined){if(u.length===1){p=u[0]}else{q=true}}if(q){o(t)}else{while(v&&!v.draggable()){v=v.parentNode}if(v){n=v;if(p===undefined){s=t.clientX;r=t.clientY}else{s=p.clientX;r=p.clientY}w=n.globalToLocal(s,r);n.dispatchEvent({type:b.DragEvents.DRAG_START,cancelable:true,shiftKey:t.shiftKey,ctrlKey:t.ctrlKey,clientX:s,clientY:r,userX:w.x,userY:w.y,defaultAction:e,stopDrag:o});m=h=s;k=g=r;f=t.timeStamp;l.onMouseMove(j);l.onMouseUp(o);l.onTouchMove(j);l.onTouchEnd(o)}}};l.onMouseDown(i);l.onTouchStart(i)}}());var b=b||{};(function(){function e(t,u,n,p,i,m,k,l,s,h,r,o,q){var j=document.createEvent("MouseEvents");j.initMouseEvent(t,u,n,window,p,i.x,i.y,m,k,l,h,s,r,o,q);return j}function g(u,w,n,q,i,m,k,l,t,h,s,p,r,v,o,x){var j=document.createEvent("TouchEvent");j.initTouchEvent(u,w,n,window,q,i.x,i.y,m,k,l,h,t,s,p,r,v,o,x);return j}function f(h){return{x:h.screenX,y:h.screenY}}b.addGestureSupport=function(n,r,m,u,j,l,h){var s,q,i,t,v,p,o={},k;r=r||e;m=m||g;u=u||f;if(typeof j!=="number"){j=500}if(typeof l!=="number"){l=800}if(typeof h!=="number"){h=10}t=function(w){return function(){var z=o[w.identifier],x,y;if(z&&z.longPressTimeoutID){x=z.event;y=r("touchlongpress",true,true,k,u(w),w.clientX,w.clientY,x.ctrlKey,x.shiftKey,x.altKey,x.metaKey,0,w.target);w.target.dispatchEvent(y);z.longPressTimeoutID=undefined}}};q=function(y){var x=y.changedTouches,w,z=x.length,A,B;for(w=0;w<z;w++){B=x[w];A=o[B.identifier];if(A.longPressTimeoutID&&Math.abs(B.clientX-A.clientX)>h&&Math.abs(B.clientY-A.clientY)>h){clearTimeout(A.longPressTimeoutID);A.longPressTimeoutID=undefined}}};v=function(x){var w;if(x.detail>1&&x.timeStamp-p.timeStamp<j){w=r("dbltap",true,true,x.detail,u(x),x.clientX,x.clientY,x.ctrlKey,x.shiftKey,x.altKey,x.metaKey,0,x.target);x.target.dispatchEvent(w)}p=x};i=function(y){var D,B,C,A,w,x,E,z;n.removeEventListener("touchend",i,true);if(y.fake!==true){D=y.changedTouches;C=D.length;for(B=0;B<C;B++){A=D[B];w=o[A.identifier];if(w){if(w.longPressTimeoutID){clearTimeout(w.longPressTimeoutID);w.longPressTimeoutID=undefined}if(Math.abs(A.clientX-w.clientX)<h&&Math.abs(A.clientY-w.clientY)<h&&y.timeStamp-w.timeStamp<j){y.stopPropagation(true);x=m("touchend",true,true,y.detail,u(y),y.clientX,y.clientY,y.ctrlKey,y.shiftKey,y.altKey,y.metaKey,y.touches,y.targetTouches,y.changedTouches,y.scale,y.rotation);x.fake=true;y.target.dispatchEvent(x);if(x.defaultPrevented===true){y.preventDefault()}if(x.stopped===true){y.stopPropagation()}z=1;if(p&&Math.abs(A.clientX-p.clientX)<h&&Math.abs(A.clientY-p.clientY)<h){z=p.detail+1}E=r("tap",true,true,z,u(A),A.clientX,A.clientY,y.ctrlKey,y.shiftKey,y.altKey,y.metaKey,0,y.target);y.target.dispatchEvent(E);v(E)}o[A.identifier]=undefined}}}};s=function(z){var y=z.changedTouches,x,A=y.length,B,w;k=z.touches.length;for(x=0;x<A;x++){B=y[x];w={identifier:B.identifier,screenX:B.screenX,screenY:B.screenY,clientX:B.clientX,clientY:B.clientY,event:z};o[B.identifier]=w;w.timeStamp=z.timeStamp;w.longPressTimeoutID=setTimeout(t(B,o),l)}n.addEventListener("touchmove",q,true);n.addEventListener("touchend",i,true)};n.addEventListener("touchstart",s,true)}}());(function(){b.ns("oui.events");b.events.addPressNTapSupport=function(e){var f;e.onTouchStart(function(g){f=g});e.onTouchMove(function(){f=undefined});e.onTap(function(g){if(f){if(g.identifier!==f.identifier){f.target.dispatchEvent({type:b.GestureEvents.PRESS_AND_TAP,clientX:f.clientX,clientY:f.clientY,userX:f.userX,userY:f.userY,tapClientX:(g.clientX-f.clientX),tapClientY:(g.clientX-f.clientY),tapUserX:(g.userX-f.userX),tapUserY:(g.userY-f.userY),ctrlKey:f.ctrlKey,shiftKey:f.shiftKey})}f=undefined}});e.onTouchEnd(function(g){if(f&&g.identifier===f.identifier){f=undefined}})}}());(function(){var g=20,e=0.2;function f(j,h){var i=b.geom.centroid(j.touches,"clientX","clientY");b.rootNode.dispatchEvent({type:b.GestureEvents.PINCH,clientX:i.x,clientY:i.y,userX:i.x,userY:i.y,phase:b.GestureEventPhases[h],scale:j.scale,rotation:j.rotation,preventNativeDefault:function(){j.preventNativeDefault()}})}b.ns("oui.events");b.events.addPinchSupport=function(i){var j=false,h=false;i.onTouchStart(function(){j=false;h=false});i.onTouchMove(function(k){if(!j){if(Math.abs(k.rotation)>g){if(h){f(k,"CANCEL")}j=true}else{if(h){f(k,"CHANGE")}else{if(Math.abs(k.scale-1)>e){h=true;f(k,"BEGIN")}}}}});i.onTouchEnd(function(k){if(h&&!j){if(Math.abs(k.rotation)>g){f(k,"CANCEL");j=true}else{f(k,"END");j=true}}})}}());(function(){var g=b.DirectionEnum,e=10,k=Math.PI/4;function i(n,p,m,o){var r,q=Math.atan2((o-p),(m-n));if(Math.abs(q)<k){r=g.RIGHT}else{if(Math.abs(q-Math.PI/2)<k){r=g.DOWN}else{if(Math.abs(q+Math.PI/2)<k){r=g.UP}else{r=g.LEFT}}}return r}function l(n,o){var m=n.length;while(m--){if(o===n[m].identifier){break}}return n[m]}function j(t,p,s,n){var o=p.screenX-t.screenX,m=p.screenY-t.screenY,r=n.screenX-s.screenX,q=n.screenY-s.screenY;return b.geom.dotprod(o,m,r,q)>=0}function f(p){var t=[],o=p.length,n,u,r,q,s=Number.MAX_VALUE,m;while(o--){u=p[o].target.getAncestors();if(u.length<s){s=u.length;m=o}t.push(u)}r=t.splice(m,1)[0];for(o=0;o<s;o++){q=r[o];n=t.length;while(n--){if(t[n][o]!==q){break}}if(n>=0){break}}return r[o-1]}function h(m,o){var n=f(m);if(n){n.dispatchEvent({type:b.GestureEvents.SWIPE,phase:b.GestureEventPhases[o.phase],direction:o.direction,translate:o.translate,velocity:o.velocity})}}b.ns("oui.events");b.events.SwipeSupport={_forEachChangedTouch:function(r,q,m){var p=r.changedTouches,s=r.timeStamp,o,t=p.length;for(o=0;o<t&&(m===null||!m());o++){this[q](p[o],s)}},_handleStartedTouch:function(n){var m=this._touchesStarted;if(m){if(l(m,n.identifier)===undefined){this._touchesStarted.push(n)}else{if(this._nTouchesEnded>0){this._touchesStarted=undefined}}}else{this._touchesStarted=[n];this._touchesMoved={};this._nTouchesMoved=0;this._nTouchesEnded=0;this._centroid=undefined;this._gestureInfo=undefined}},_handleMovedTouch:function(w,n){var p=this._gestureInfo,u,D,m,o,C,z,s,x,E,q,t=0,y=0,B=0,A=true,r=w.identifier,v=l(this._touchesStarted,r);if(v===undefined){if(p){p.phase="CANCEL";h(this._touchesStarted,p)}this._touchesStarted=undefined}else{if(this._touchesMoved[r]===undefined){this._nTouchesMoved++}this._touchesMoved[r]=w;o=this._touchesStarted.length;C=this._nTouchesMoved;if(C===o){if(p===undefined){D={};u=this._centroid;if(u===undefined){u=b.geom.centroid(this._touchesStarted,"screenX","screenY");this._centroid=u}z=this._touchesStarted[0];s=this._touchesMoved[z.identifier];for(x=0;x<o;x++){E=this._touchesStarted[x];q=this._touchesMoved[E.identifier];y+=b.geom.dist(E.screenX,E.screenY,u.x,u.y);t=b.geom.dist(q.screenX,q.screenY,u.x,u.y);B+=t;A=A&&j(z,s,E,q);D[E.identifier]={lastMovedTouch:q,distanceToCentroid:t}}y/=o;B/=C;m=Math.abs(y-B);if(m>e){this._startGestureTime=n;p={phase:"BEGIN",centroid:u,meanDistances:y,newMeanDistances:B,touchesInfo:D,duration:1};if(A){p.direction=i(v.screenX,v.screenY,w.screenX,w.screenY);p.translate=m;p.velocity=m/p.duration;h(this._touchesStarted,p)}else{this._touchesStarted=undefined}this._gestureInfo=p}}else{this._updateGestureEvent(w,n,false)}}}},_updateGestureEvent:function(q,p,t){var s=this._gestureInfo,o=s.touchesInfo[q.identifier],n,r,m;if(o){n=b.geom.dist(q.screenX,q.screenY,this._centroid.x,this._centroid.y);r=s.newMeanDistances+(n-o.distanceToCentroid)/this._touchesStarted.length;s.newMeanDistances=r;s.duration=(p-this._startGestureTime);m=Math.abs(s.meanDistances-r);if(t||(s.direction===i(o.lastMovedTouch.screenX,o.lastMovedTouch.screenY,q.screenX,q.screenY))){if(t){s.phase="END"}else{s.phase="CHANGE"}s.translate=m;s.velocity=m/s.duration;h(this._touchesStarted,s)}else{s.phase="CANCEL";h(this._touchesStarted,s);this._touchesStarted=undefined}o.lastMovedTouch=q;o.distanceToCentroid=n}else{s.phase="CANCEL";h(this._touchesStarted,s);this._touchesStarted=undefined}},_handleEndedTouch:function(n,m){this._nTouchesEnded++;if(this._gestureInfo){this._updateGestureEvent(n,m,true);if(this._touchesStarted.length===this._nTouchesEnded){this._touchesStarted=undefined}}else{this._touchesStarted=undefined}}};b.events.addSwipeSupport=function(n){var o=b.events.SwipeSupport,m;m=function(){return(this._touchesStarted===undefined)};n.onTouchStart(function(p){return o._forEachChangedTouch(p,"_handleStartedTouch",null)});n.onTouchMove(function(p){return o._forEachChangedTouch(p,"_handleMovedTouch",m)});n.onTouchEnd(function(p){return o._forEachChangedTouch(p,"_handleEndedTouch",m)})}}());(function(){b.ns("oui.focus");b.mixin(b.focus,{getFocusableAncestor:function(g){var f=null,e=g.parentNode;if(e){if(b.focus.isFocusableTarget(e)){f=e}else{f=b.focus.getFocusableAncestor(e)}}return f},getFocusableDescendant:function(j,i,f){var e=null,g=true,h,k;if(i===false){g=false}h=g?"firstChild":"lastChild";k=g?"nextSibling":"previousSibling";j=f?f[k]:j[h];while(j&&!e){if(j._style.display){if(j._style.focusable){e=j}else{e=b.focus.getFocusableDescendant(j,g)}}j=j[k]}return e},isFocusableTarget:function(e){return e._style.display&&e._style.focusable}})}());(function(){var f=b.UIEvents.FOCUS_IN,e=b.UIEvents.FOCUS_OUT,g={};g[f]=function(m){var n=m.target,l=n.getLayoutBounds(b.tree.focusLayer),h=n.getFocusOutlineOffset(),k=l.width+h*2,i=l.height+h*2,j;if(k>0&&i>0){j=new b.graphics.Rectangle({x:l.x-h,y:l.y-h,width:k,height:i,fill:b.NO_PAINT,stroke:b.focusManager._strokeFocusOutline||b.GRAY});b.tree.focusLayer.appendChild(j)}};g[e]=function(){b.tree.focusLayer.removeChildren()};b.declare({name:"oui.focus.FocusManager",mixins:[b.events.EventSupport],membersDef:{init:function(h){if(!b.isA(h,b.graphics.AbstractGraphicNode)){h=null}this._focusRoot=h;this._focusOwner=h;b.rootNode.addEventListener(b.ViewEvents.FOCUS_COMPONENT,this.handler("_onFocusCmp"));b.rootNode.addEventListener(b.ViewEvents.BLUR_COMPONENT,this.handler("_onBlurCmp"));b.rootNode.onKeyDown(b.focus.DefaultFocus)},getFocusOwner:function(){return this._focusOwner},setFocusOutline:function(h){if(b.isA(h,b.style.Paint)){this._strokeFocusOutline=h}},requestFocus:function(h,i){if(b.isA(h,b.graphics.AbstractGraphicNode)&&h.getFocusable()){this._moveFocus(this._getValidFocusOwner(h),i)}},releaseFocus:function(){b.events.dispatchExternalEvent({type:b.ViewEvents.RELEASE_FOCUS})},_onFocusCmp:function(){if(this._focusOwner!==this._focusRoot){var h=this._focusOwner;this._focusOwner=this._focusRoot;this._moveFocus(h,undefined,true)}},_onBlurCmp:function(){this._fire(e,this._focusOwner,null,null)},moveFocusDirection:function(i){if(!b.isA(i,Boolean)){i=true}var h=this._getValidFocusOwner(this._focusOwner);h=this._moveFocusDirection(h,i);if(h===null){h=b.focus.getFocusableDescendant(this._focusRoot,i)}this._moveFocus(h)},_getValidFocusOwner:function(h){var k=h.getAncestors(),n=k.length,l=null,j,m=false;for(j=0;j<n;j++){l=k[j];if(l===this._focusRoot){m=true}if(!l.getDisplay()){break}}if(!m){l=null}return l},_moveFocus:function(h,i,j){var k=this._focusOwner;if(h!==null&&h!==k){this._fire(e,k,h,i);this._fire(f,h,k,i,j);this._moveFocusImpl(h);this._focusOwner=h}},_moveFocusImpl:function(h){},reFocus:function(){if(this._focusOwner!==null){this._reFocusImpl(this._focusOwner)}},_reFocusImpl:function(h){},_moveFocusDirection:function(k,j){var i=null,h;if(k!==null){h=k.parentNode;i=b.focus.getFocusableDescendant(h,j,k);if(i===null){i=this._moveFocusDirection(h,j)}}return i},_fire:function(l,m,h,i,k){var j=false,n=false;if(i){j=(i.shiftKey===true);n=(i.ctrlKey===true)}m.dispatchEvent({type:l,target:m,relatedTarget:h,cancelable:true,shiftKey:j,ctrlKey:n,defaultAction:g[l],details:k})}}})}());(function(){b.ns("oui.focus");var e=b.KeyCode;b.focus.DefaultFocus={handleEvent:function(g){var f=b.focusManager;if(b.equalIgnoreCase(b.KeyEvents.KEY_DOWN,g.type)){switch(g.keyCode){case e.TAB:f.moveFocusDirection(!g.shiftKey);break;case e.LEFT_ARROW:f.moveFocusDirection(false);break;case e.RIGHT_ARROW:f.moveFocusDirection(true);break;case e.ESC:f.releaseFocus();break;case e.ENTER:case e.SPACEBAR:g.target.dispatchEvent({type:b.UIEvents.ACTIVATE,defaultAction:g.target.getDefaultActivateAction()});break;default:break}}}}}());(function(){var e=b.KeyCode;b.declare({name:"oui.focus.FocusRing",membersDef:{init:function(){},handleEvent:function(g){var f=false;if(b.equalIgnoreCase(b.KeyEvents.KEY_DOWN,g.type)){this._initFocusRoot(g);switch(g.keyCode){case e.TAB:f=this.moveFocus(!g.shiftKey,g);break;case e.LEFT_ARROW:f=this.moveFocus(false,g);break;case e.RIGHT_ARROW:f=this.moveFocus(true,g);break;case e.ESC:f=this.moveFocusLevel(true,g);break;case e.ENTER:if((g.ctrlKey!==true)&&(g.shiftKey!==true)){f=this.moveFocusLevel(false,g)}break}}if(f){g.stopPropagation()}},moveFocusLevel:function(f,h){var j=false,g=b.focusManager.getFocusOwner(),i;if(g!==null){i=f?b.focus.getFocusableAncestor(g.parentNode):b.focus.getFocusableDescendant(g);if(i!==null){j=true;b.focusManager.requestFocus(i,h)}}return j},moveFocus:function(j,i){var m=false,f=b.focusManager,h=f.getFocusOwner(),k=f._moveFocusDirection(h,j),l=this._rootFocusNode,g;if(k===null){k=b.focus.getFocusableDescendant(b.rootNode,j)}if(h!==l){g=b.focus.getFocusableAncestor(h);if(k!==null&&k.isDescendant(g)!==true){k=b.focus.getFocusableDescendant(g,j)}}else{k=null}if(k!==null){m=true;f.requestFocus(k,i)}return m},_initFocusRoot:function(f){var g=f.currentTarget;if(!b.focus.isFocusableTarget(g)){g=b.focus.getFocusableDescendant(g)}this._rootFocusNode=g}}})}());(function(){var j=b.KeyCode,i=b.DirectionEnum,e=i.UP,h=i.DOWN,f=i.LEFT,g=i.RIGHT;function k(m,l){return b.geom.dist(m.x,m.y,l.x,l.y)}b.declare({name:"oui.focus.SpatialFocus",mixins:[b.events.EventSupport],membersDef:{init:function(m,l){this._keyDownFilter=this._defaultKeyDownFilter;this._focusContainer=null;if(b.isA(m,b.graphics.AbstractGraphicNode)){m.onFocusIn(this.handler("_onFocusIn"));this._focusContainer=m}if(b.isA(l,Function)){this._keyDownFilter=l}},_defaultKeyDownFilter:function(l){return((l.ctrlKey!==true)&&(l.shiftKey!==true))},_onFocusIn:function(l){var m=l.relatedTarget;if(m){m._focusPoint=undefined}},handleEvent:function(m){var l=(m.keyCode===j.TAB);if(this._keyDownFilter(m)===true){switch(m.keyCode){case j.LEFT_ARROW:this._moveFocus(m,f);l=true;break;case j.RIGHT_ARROW:this._moveFocus(m,g);l=true;break;case j.UP_ARROW:this._moveFocus(m,e);l=true;break;case j.DOWN_ARROW:this._moveFocus(m,h);l=true;break;default:}}if(l){m.stopPropagation()}},_moveFocus:function(l,n){this._cacheFocusableNodes();var m=this._getFocusableItem(l.target,n);if(m!==null){m._focusPoint=this._newFocusPoint;b.focusManager.requestFocus(m,l)}},_cacheFocusableNodes:function(){var m=b.focus.getFocusableDescendant(this._focusContainer),l;this._focusableNodes=[];if(m!==null){this._focusableNodes.push(m);l=b.focusManager._moveFocusDirection(m,true);while(l){this._focusableNodes.push(l);l=b.focusManager._moveFocusDirection(l,true)}}},_getFocusableItem:function(y,x){var z=null,o=this._getNodeInfos(y,x),p=o.center,u,q,m,l,n,w,s,r,t,v=this._focusableNodes.length;this._updateEntryPoint(o);for(s=0;s<v;s++){r=this._focusableNodes[s];if(r!==y){u=false;switch(x){case e:t=this._getNodeInfos(r,h);if(t.center.y<p.y){u=true}break;case h:t=this._getNodeInfos(r,e);if(t.center.y>p.y){u=true}break;case f:t=this._getNodeInfos(r,g);if(t.center.x<p.x){u=true}break;case g:t=this._getNodeInfos(r,f);if(t.center.x>p.x){u=true}break;default:}if(u){q=this._getNewFocusPoint(this._entryPoint,t.nodeBorder);l=this._computeFocusDistance(o,t,q);if((m===undefined)||(l<m)){m=l;n=b.geom.dist(p.x,p.y,t.center.x,t.center.y);z=r;this._newFocusPoint=q}else{if(m===l){w=b.geom.dist(p.x,p.y,t.center.x,t.center.y);if(w<n){z=r;this._newFocusPoint=q}}}}}}return z},_getNodeInfos:function(p,s){var q=p.getLayoutBounds(this._focusContainer),n=q.x,m=q.y,t=q.width,l=q.height,o={x:n+t/2,y:m+l/2},r;switch(s){case e:r={x1:n,y1:m,x2:n+t,y2:m};break;case h:r={x1:n,y1:m+l,x2:n+t,y2:m+l};break;case f:r={x1:n,y1:m,x2:n,y2:m+l};break;case g:r={x1:n+t,y1:m,x2:n+t,y2:m+l};break;default:}return{center:o,bounds:q,node:p,nodeBorder:r}},_updateEntryPoint:function(p){var l=false,o=p.node,m=p.bounds,n;if(o._focusPoint){n=o._focusPoint;if(n.x>=m.x&&n.x<=m.x+m.width&&n.y>=m.y&&n.y<=m.y+m.height){this._entryPoint=n;l=true}}if(!l){o._focusPoint=p.center;this._entryPoint=o._focusPoint}},_getNewFocusPoint:function(m,n){var l={};if(n.x1!==n.x2){if(m.x<n.x1){l.x=n.x1}else{if(m.x>n.x2){l.x=n.x2}else{l.x=m.x}}}else{l.x=n.x1}if(n.y1!==n.y2){if(m.y<n.y1){l.y=n.y1}else{if(m.y>n.y2){l.y=n.y2}else{l.y=m.y}}}else{l.y=n.y1}return l},_computeFocusDistance:function(l,r,p){var m=this._getEuclideanDistance(p),q=l.nodeBorder,v=0,t=0,u=0,o=0,s,n;if(q.x1!==q.x2){t=Math.abs(p.y-q.y1);u=Math.abs(p.x-this._entryPoint.x)}else{v=Math.abs(p.x-q.x1);o=Math.abs(p.y-this._entryPoint.y)}s=0;n=b.geom.intersectRect(l.bounds,r.bounds);if(n){s=Math.sqrt(n.width*n.height)}return(m+v+t+u+o-s)},_getEuclideanDistance:function(l){var n=this._entryPoint,m;if((n.x===l.x)||(n.y===l.y)){m=0}else{m=b.geom.dist(n.x,n.y,l.x,l.y)}return m}}})}());(function(){b.ns("oui.utils");var e=76,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b.utils.toBase64=function(l){var p=0,r=l.length,j="",n=0,g=0,m=0,q,h,k,o;while(n<=r){if((n%3)===0&&n!==0){m>>=8;m&=16777215;q=m;q>>=18;q&=63;j+=f.charAt(q);g++;q=m;q>>=12;q&=63;j+=f.charAt(q);g++;q=m;q>>=6;q&=63;j+=f.charAt(q);g++;q=m;q&=63;j+=f.charAt(q);g++;m=0;if(g>=e){j+="\r";j+="\n";g=0}if(r-n<3){break}}q=l[p++];m|=(256+q)%256;m<<=8;n++}h=(r-n)%3;if(h!==0){m=0;for(k=0;k<3;k++){if(k<h){q=l[p++];m|=(256+q)%256;m<<=8;n++}else{m|=0;m<<=8}}m>>=8;m&=16777215;q=m;if(h>=1){q>>=18;q&=63;j+=f.charAt(q);q=m;q>>=12;q&=63;j+=f.charAt(q)}if(h>=2){q=m;q>>=6;q&=63;j+=f.charAt(q)}if(h>=3){q=m;q&=63;j+=f.charAt(q)}for(o=3;o>h;o--){j+="="}}if(j.length===0){c.error("ERR__BASE64")}return j}}());(function(){var e;function g(q,p,h,r,n){var s,m,j,o,l,k;if(q!==undefined){m=e[q.type];if(m!==undefined){s=m.call(null,q,h,r,n);j=q.name;if(h){if(r===false){if(q.shortcutName!==undefined){o=q.shortcutName}}else{if(j!==undefined){o=j}}if(o!==undefined&&n!==undefined){o=n+o}if(o!==undefined){h[o]=s}}if(p){if(j!==undefined&&p!==h){p[j]=s}if(s.constructor===Array){k=s.length;for(l=0;l<k;l++){p.appendChild(s[l])}}else{p.appendChild(s)}}}}return s}function f(i,h){var k,j;if(b.isA(h,Function)){k=h}else{j=i;k=function(l){return new j(l,l.name)}}return k}b._CPGL_JSON_FACTORY=e={array:function(k){var h=[],j,m=k.length,l=k.of;if(b.isA(m,Number)&&l!==undefined){for(j=0;j<m;j++){h[j]=g(l)}}return h}};b.load=function(l,m,q,j,o){var h=null,k,p;if(l){if(l.constructor===Array){h=m||new b.graphics.Group();for(k=0,p=l.length;k<p;k++){g(l[k],h,q,j,o)}}else{if(l.constructor===Object){if(m){g(l,m,q,j,o);h=m}else{h=g(l,null,q,j,o)}}}}return h};b.addJSONLoaderSupport=function(h,j){var i="";if(!b.inheritsFrom(h,b.scene.AbstractNode)){c.error("ERR__JSONLOAD__INV_CLASS")}if(b.isA(j.type,String)){i=j.type}if(i.length>0){if(!e[i]){e[i]=f(h,j.factory)}else{c.warn("WARN__JSONLOAD__DUP_TYPE")}}else{c.warn("WARN__JSONLOAD__EMPTY_STR")}}}());(function(){var g=new RegExp("^(https?:\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]{2,6})\\/\\S+$",""),i=b.config.hasOwnProperty("base")?b.config.base+"/":"",j=0;function f(k){if(!g.test(k)&&k.indexOf("/")!==0&&k.indexOf("data")!==0){k=i+k}return k}function h(k){if(k.indexOf(i)===0){k=k.substring(i.length)}return k}function e(){b.tree.layout()}b.declare({name:"oui.utils.ImageLoader",mixins:[b.events.EventSupport],eventsDef:{COMPLETE:"complete",ERROR:"error"},membersDef:{init:function(){},load:function(k){var l=this;j++;if(b.tree.isPlatformAvailable()){this._loadImpl(f(k))}else{b.tree.addEventListener(b.tree.events.PLATFORM_AVAILABLE,function(){l._loadImpl(k)})}},_loadImpl:function(){},_dispatchCompleteEvent:function(l,n,m,k,o){this.dispatchEvent({type:this.events.COMPLETE,url:h(l),data:n,width:m,height:k,info:o,defaultAction:e});j--},_dispatchErrorEvent:function(k,l){this.dispatchEvent({type:this.events.ERROR,url:h(k),message:l});j--}}});b.hasImagesLoading=function(){return(j!==0)}}());(function(){b.mixin(b.utils.ImageLoader,{_loadImpl:function(e){var f=new Image();f.onload=this.handler("cvOnComplete");f.onerror=this.handler("cvOnError");f.onabort=this.handler("cvOnAbort");f.src=e},cvOnComplete:function(f){var e=f.target;this._dispatchCompleteEvent(e.src,e,e.width,e.height)},cvOnError:function(e){this._dispatchErrorEvent(e.target.src)},cvOnAbort:function(e){this._dispatchErrorEvent(e.target.src)}})}());(function(){function f(g,h){if(b.isA(g,Function)){g.call(null,h)}else{if(g&&b.isA(g.resourceUpdate,Function)){g.resourceUpdate(h)}}}function e(h){var g=h.observers.pop();while(g){f(g,h);g=h.observers.pop()}b.tree.layout()}b.declare({name:"oui.utils.ResourcesManager",membersDef:{init:function(){var g,h=b.config.embeddedResourcesMap;this._resources={};if(h){for(g in h){if(h.hasOwnProperty(g)){this._initEmbedImpl(g,h[g])}}}},requestResource:function(h,g){var i;h=this._checkURL(h);i=this._resources[h];if(!i){this._loadResource(h,h,g)}else{if(i.data===null){if(g){i.observers.push(g)}}else{f(g,i)}}},hasResource:function(h){var g=false;if(h.indexOf("@cache;")===0){g=true}else{g=(this._resources[h]!==undefined)}return g},removeObserver:function(h,g){var k,l,j;h=this._checkURL(h);k=this._resources[h];if(k){l=k.observers;j=l.length;while(j--){if(l[j]===g){l.splice(j,1);break}}}},_checkURL:function(g){if(g.indexOf("@cache;")===0){g=g.substr(7)}return g},_initEmbedImpl:function(){},_loadResource:function(i,l,h){var j=this,k,g;k={url:i,data:null,width:0,height:0,observers:[h]};this._resources[i]=k;g=new b.utils.ImageLoader();g.onComplete(function(m){j._onComplete(m,k)});g.onError(function(){j._onError(k)});g.load(l)},_onComplete:function(g,h){h.width=g.width;h.height=g.height;this._onCompleteImpl(g,h);e(h)},_onCompleteImpl:function(g,h){h.data=g.data},_onError:function(g){this._resources[g.url]=undefined;c.warn("WARN__RES_MGR__LOAD_FAIL",g.url)},_getBase64Data:function(){return undefined}}})}());(function(){b.mixin(b.utils.ResourcesManager,{_initEmbedImpl:function(e,f){this._loadResource(e,f.data);f.data=null},_getBase64Data:function(f){var e,h=b.config.embeddedResourcesMap,g;f=this._checkURL(f);if(h!==undefined&&h[f]!==undefined){g=this._resources[f];if(g.data){e=g.data.src}}return e}})}());(function(){var e="Obj_",f=0;b.declare({name:"oui.scene.AbstractNode",isAbstract:true,mixins:[b.events.EventSupport,b.lang.AspectSupport],membersDef:{init:function(g){this.dirtyMarkers={};this._id=e+f++;this.name="";this.setName(g);this._createNodeImpl();this._nativeMode=false},load:function(h,g){return b.load(h,g||this)},setName:function(g){if(typeof g==="string"){this.name=g;this.notifyNative(b.TAGS.NAME)}},getName:function(){return this.name},getFullName:function(){var g=this.name;if(this.parentNode){g=this.parentNode.getFullName()+"."+g}return g},getElementById:function(i){var g=null,h;if(this._id===i){g=this}else{h=this.firstChild;while(h&&!g){g=h.getElementById(i);h=h.nextSibling}}return g},getElementsByName:function(h,g){var i;g=g||[];i=this.firstChild;while(i){if(i.name===h){g.push(i)}i.getElementsByName(h,g);i=i.nextSibling}return g},getFirstElementByName:function(h){var g,i=this.firstChild;while(i&&!g){if(i.name===h){g=i}else{g=i.getFirstElementByName(h)}i=i.nextSibling}return g},getId:function(){return this._id},_isValidChild:function(g){return b.isA(g,b.scene.AbstractNode)},_onInsertChild:function(i,g,h){if(!g){this._appendChildImpl(i)}else{this._insertBeforeImpl(i,g)}if(h!==true){i._onParentChanged()}this._onChildrenChanged()},_onRemoveChild:function(i,h,g){i._onParentChanged();if(h===false){this._removeChildImpl(i);this._onChildrenChanged()}else{if(g===true){this._removeChildrenImpl();this._onChildrenChanged()}}},isDescendant:function(h){var g=false;if(this.parentNode===h){g=true}else{if(this.parentNode){g=this.parentNode.isDescendant(h)}}return g},_createNodeImpl:function(){},_appendChildImpl:function(){},_insertBeforeImpl:function(){},_removeChildImpl:function(){},_removeChildrenImpl:function(){},getAncestors:function(){var h=this,g=[];while(h){g.unshift(h);h=h.parentNode}return g},bringToFront:function(){var g=this.parentNode;if(g&&g.lastChild!==this){g.insertBefore(this,null)}},sendToBack:function(){var g=this.parentNode;if(g&&g.firstChild!==this){g.insertBefore(this,g.firstChild)}},bringForward:function(){var g=this.parentNode,h=this.nextSibling;if(g&&h){g.insertBefore(this,h.nextSibling)}},sendBackward:function(){var g=this.parentNode,h=this.previousSibling;if(g&&h){g.insertBefore(this,h)}},notifyNative:function(g){if(this._nativeMode){this.notifyNativeImpl(g)}else{this.dirtyMarkers[g]=true}},notifyNativeImpl:function(g,h){},_preParentChangedImpl:function(){},_onParentChanged:function(){var g=false;this._preParentChangedImpl();if(this.parentNode){g=this.parentNode._nativeMode}this._setNativeMode(g)},_onChildrenChanged:function(){},_setNativeMode:function(g,k){var j,i,h;if(this._nativeMode!==g){this._nativeMode=g;j=this.firstChild;while(j){j._setNativeMode(g,true);j=j.nextSibling}if(g){i=this.dirtyMarkers;for(h in i){if(i[h]){this.notifyNativeImpl(h,k)}}this.dirtyMarkers={}}}},notifyChildren:function(g){var h;this.notifyNative(g);h=this.firstChild;while(h){h.notifyChildren(g);h=h.nextSibling}}}});b.lang.LinkedListSupport.addLinkedList(b.scene.AbstractNode,b.scene.AbstractNode,"nextSibling","previousSibling","parentNode","firstChild","lastChild","appendChild","removeChild","removeChildren","insertBefore","replaceChild","hasChildNodes","_isValidChild","_onInsertChild","_onRemoveChild","childrenCount","getChildAt","getChildIndex","setChildIndex")}());(function(){b.mixin(b.scene.AbstractNode,{cvPaint:function(e){}})}());(function(){function f(r,s,l,n,h,k,i,j,q,g,p,m,o){return{type:r,canBubble:s,cancelable:l,detail:n,screenX:h.x,screenY:h.y,clientX:k,clientY:i,ctrlKey:j,shiftKey:q,altKey:g,metaKey:p,button:m,relatedTarget:o,preventNativeDefault:b.NO_OP,stopNativePropagation:b.NO_OP}}function e(s,u,l,o,h,k,i,j,r,g,q,n,p,t,m,v){return{type:s,canBubble:u,cancelable:l,detail:o,screenX:h.x,screenY:h.y,clientX:k,clientY:i,ctrlKey:j,shiftKey:r,altKey:g,metaKey:q,touches:n,targetTouches:p,changedTouches:t,scale:m,rotation:v,preventNativeDefault:b.NO_OP,stopNativePropagation:b.NO_OP}}b.declare({name:"oui.scene.Tree",mixins:[b.events.EventSupport,b.lang.AspectSupport],membersDef:{events:{PLATFORM_AVAILABLE:"platformAvailable"},init:function(){this.userLayer=this._createLayer("userLayer");this.focusLayer=this._createLayer("focusLayer");this.tooltipLayer=this._createLayer("tooltipLayer");this.layers=[this.userLayer,this.focusLayer,this.tooltipLayer];this._isReady=false;this.addEventListener(this.events.PLATFORM_AVAILABLE,this.handler("_onReady"))},destroy:function(){b.timer.stop();b.events._userEventsSupport.setProperties({fromPlatform:{keyEvents:false,mouseEvents:false,wheelEvents:false,touchEvents:false,gestureEvents:false}});this._destroyImpl()},layout:function(){var g,j,h=this.layers;for(g=0,j=h.length;g<j;g++){h[g].layout()}},setLayoutDir:function(g){var h,k,j=this.layers;if((g===b.RTL||g===b.LTR)&&g!==b.layoutDir){b.layoutDir=g;b.filters._onLayoutDir(g);for(h=0,k=j.length;h<k;h++){j[h].notifyChildren(b.TAGS.LAYOUT_DIR)}if(typeof this._setLayoutDirImpl==="function"){this._setLayoutDirImpl()}}},getNodeAt:function(g,m){var j=null,h,l=this.layers,k=l.length;for(h=k-1;h>=0&&!j;h--){j=this._getChildAtImpl(l[h],g,m)}return j},getElementById:function(l){var h=null,g,k=this.layers,j=k.length;for(g=j-1;g>=0&&!h;g--){h=k[g].getElementById(l)}return h},isPlatformAvailable:function(){return this._isReady},getCSSValues:function(h,i){var g=null;if(typeof b.config.readCSSValues==="function"){g=b.config.readCSSValues(h,i)}return g},_createLayer:function(g){var i=new b.graphics.Group(undefined,g),h=b.events;h.addDragSupport(i);h.addPressNTapSupport(i);h.addPinchSupport(i);h.addSwipeSupport(i);b.addGestureSupport(i,f,e);return i},_initShadowTree:function(g){g._createNodeImpl();var h=g.firstChild;while(h!==null){this._initShadowTree(h);g._appendChildImpl(h);h=h.nextSibling}g.invalidateLayout()},_onReady:function(){var j,l,h,k=this.layers,g=(b.environment===b.EnvironmentEnum.MOBILE);this._enableTreeOpsImpl();b.events._userEventsSupport.setProperties({fromPlatform:{keyEvents:true,mouseEvents:g?false:true,wheelEvents:true,touchEvents:true,gestureEvents:true}});for(j=0,l=k.length;j<l;j++){h=k[j];this._initShadowTree(h);this._attachLayerImpl(h);h._setNativeMode(true)}this.layout();this._isReady=true},_updateViewport:function(i,h){var g=b.viewportWidth,j=b.viewportHeight;if(g!==i||j!==h){b.viewportWidth=i;b.viewportHeight=h;b.viewportBounds.width=i;b.viewportBounds.height=h;this.userLayer.dispatchEvent({type:b.ViewEvents.VIEWPORT_RESIZE,oldViewportWidth:g,oldViewportHeight:j,newViewportWidth:i,newViewportHeight:h});this.layout()}},_updateDeviceOrientation:function(g){if(b.deviceOrientation!==g){b.deviceOrientation=g;this.userLayer.dispatchEvent({type:b.ViewEvents.DEVICE_ORIENTATION,orientation:b.deviceOrientation})}},_setContainerImpl:function(){},_destroyImpl:function(){},_getChildAtImpl:function(h,g,i){return h.hitTest(g,i)},_enableTreeOpsImpl:function(){},_attachLayerImpl:function(g){}}})}());(function(){var e=b.DeviceOrientationEnum,f={};function g(h){var i=false;while(h){if(h===document){i=true;break}h=h.parentNode}return i}b.mixin(b.scene.Tree,{_setContainerImpl:function(m){var h,p,i,l,n,k,o,q,j;this.document=m.ownerDocument;this.domElement=m;l=this.document.defaultView;h=this.cvCreateCanvasElt(0,0);if(!h.getContext){i=this.document.createElement("div");i.innerHTML="Your web browser does not support Canvas";m.appendChild(i);c.error("ERR__CNV__NO_SUPPORT")}h.setAttribute("style",["-webkit-user-select: none;","-webkit-touch-callout: none;","-webkit-tap-highlight-color: transparent;"].join(""));h.tabIndex=0;h.innerHTML=b.config.altText||"";p=h.getContext("2d");p.globalCompositeOperation="copy";m.appendChild(h);q=l.devicePixelRatio||1;j=p.webkitBackingStorePixelRatio||p.mozBackingStorePixelRatio||p.msBackingStorePixelRatio||p.oBackingStorePixelRatio||p.backingStorePixelRatio||1;this.cvPixelRatio=b.config.hiDPI!==false?q/j:1;this.cvBuffers=[];this.cvDirtyList={};this.canvas=h;this.c2d=p;this.offscreen=this.cvCreateCanvasElt(0,0);this.offscreen.style.display="none";this.offscreen2d=this.offscreen.getContext("2d");n=this.document.createElement("div");n.setAttribute("style","margin: 0; padding: 0;");k=this.document.createElement("span");n.appendChild(k);o=this.document.createElement("div");o.setAttribute("style","display: inline-block; vertical-align: baseline; width: 1px; height: 0px; margin: 0; padding: 0;");n.appendChild(o);this.cvTextMeasurer={div:n,span:k,ref:o};b.timer.addEventListener(b.timer.TIMER_EVENT,this.handler("_timerCallback"));this._orientationHandler=this.handler("cvOnDeviceOrientationChanged");l.addEventListener("orientationchange",this._orientationHandler,false);l.addEventListener("resize",this._orientationHandler,false);this.cvResize();this.cvOnDeviceOrientationChanged();this.dispatchEvent({type:this.events.PLATFORM_AVAILABLE})},_destroyImpl:function(){var i,h=this.document.defaultView;this.removeAspect("layout",this.cvRender);h.removeEventListener("orientationchange",this._orientationHandler,false);h.removeEventListener("resize",this._orientationHandler,false);i=this.cvBuffers.pop();while(i){i.width=0;i.height=0;i=this.cvBuffers.pop()}this.canvas.width=0;this.canvas.height=0;this.offscreen.width=0;this.offscreen.height=0;this.canvas=null;this.c2d=null;this.offscreen=null;this.offscreen2d=null;this.document=null},_enableTreeOpsImpl:function(){var j=function(k){b.tree.cvMarkAsDirty(k)},h=function(){b.tree.cvMarkAsDirty(this)},i=b.scene.AbstractNode.prototype;i._appendChildImpl=j;i._insertBeforeImpl=j;i._removeChildImpl=j;i._removeChildrenImpl=h;i=b.graphics.Text.prototype;i._getBBoxImpl=i.cvGetBBox;i=b.graphics.TextBlock.prototype;i._getBBoxImpl=i.cvGetBBox},_setLayoutDirImpl:function(){var h=b.layoutDir.toLowerCase();this.canvas.setAttribute("dir",h);this.offscreen.setAttribute("dir",h);this.cvMarkAsDirty()},cvCreateCanvasElt:function(i,h){var j=this.document.createElement("canvas");j.width=i;j.height=h;return j},cvRender:function(){var s,o,p,k,r,u,h,q,l,j,m;if(this.cvFullyDirty){r=b.viewportBounds}else{j=this.cvDirtyList;m=b.geom.unionRect;for(q in j){if(j.hasOwnProperty(q)){l=j[q];if(l._nativeMode){u=l._safeGetGlobalTxf();h=l._getBoundsImpl(u,b._BoundsType.RENDER);h=m(h,l.cvLastDrawBounds)}else{h=l.cvLastDrawBounds;l.cvLastDrawBounds=undefined}r=m(r,h)}}if(r){r.x=Math.floor(r.x)-1;r.y=Math.floor(r.y)-1;r.width=Math.ceil(r.width)+2;r.height=Math.ceil(r.height)+2}}if(r){this.domElement.appendChild(this.offscreen);s=this.offscreen2d;s.save();s.scale(this.cvPixelRatio,this.cvPixelRatio);s.clearRect(r.x,r.y,r.width,r.height);s.beginPath();s.rect(r.x,r.y,r.width,r.height);s.clip();o=this.layers;for(p=0,k=o.length;p<k;p++){o[p].cvPaint(s,r)}s.restore();this.c2d.drawImage(this.offscreen,0,0);this.cvDirtyList={};this.cvFullyDirty=false;this.domElement.removeChild(this.offscreen)}},cvMarkAsDirty:function(h){if(!this.cvFullyDirty){if(h){this.cvDirtyList[h._id]=h}else{this.cvFullyDirty=true}}},cvCreateBuffer:function(i,h){var j;if(this.cvBuffers.length===0){j=this.cvCreateCanvasElt(i,h);j.style.display="none"}else{j=this.cvBuffers.pop();j.width=i;j.height=h}this.domElement.appendChild(j);j.setAttribute("dir",b.layoutDir.toLowerCase());return j},cvDisposeBuffer:function(h){this.domElement.removeChild(h);this.cvBuffers.push(h)},_timerCallback:function(){if(!this.canvas.parentNode){this.destroy()}else{this.cvResize()}},cvResize:function(){var i=this.canvas.parentNode.getBoundingClientRect(),l=Math.floor(i.width),h=Math.floor(i.height),k=this.cvPixelRatio*l,m=this.cvPixelRatio*h,j=this.canvas;if(k!==j.width||m!==j.height){if(j.width===0||j.height===0){if(k!==0&&m!==0){this.addAspect("layout",this.cvRender)}}else{if(k===0||m===0){if(!g(j)){b.timer.stop()}this.removeAspect("layout",this.cvRender)}}j.width=k;j.height=m;j.style.width=l+"px";j.style.height=h+"px";this.c2d.globalCompositeOperation="copy";this.offscreen.width=k;this.offscreen.height=m;this.cvMarkAsDirty();this._updateViewport(l,h)}},cvOnDeviceOrientationChanged:function(){var h,i,j=this.document.defaultView;if(j.orientation!==undefined){h=Math.abs(j.orientation)===90?e.LANDSCAPE:e.PORTRAIT}else{i=j.screen;h=i.width>i.height?e.LANDSCAPE:e.PORTRAIT}this._updateDeviceOrientation(h)},cvGetRootClientCoords:function(){var h=this.canvas.getBoundingClientRect();return{x:h.left,y:h.top}},cvTextMetrics:function(m,l){var j=this.cvTextMeasurer,u=this.document,n,i=j.div,v=j.span,k=j.ref,h,r,q=0,s=0,p=0,w=0,t=this.c2d;t.font=l;if(m){q=t.measureText(m).width;if(!f[l]){n=u.body;try{if(b.equalIgnoreCase("body",u.defaultView.top.document.body.nodeName)){n=u.defaultView.top.document.body}}catch(o){c.warn(o)}n.appendChild(i);v.style.font=l;v.innerHTML=m;h=v.getBoundingClientRect();p=k.getBoundingClientRect().top-h.top;s=h.bottom-h.top;w=s-p;n.removeChild(i);f[l]={ascent:p,descent:w}}else{r=f[l];p=r.ascent;w=r.descent;s=p+w}}return{ascent:p,descent:w,width:q,height:s}}})}());(function(){b.declare({name:"oui.timing.Timer",mixins:[b.events.EventSupport],membersDef:{TIMER_EVENT:"TIMER_EVENT",DEFAULT_FRAME_RATE:25,init:function(e){if(b.isFinitePositiveNumber(e,true)){this.frameRate=e}else{this.frameRate=this.DEFAULT_FRAME_RATE}},start:function(){var f=this;function e(){f.dispatchEvent({type:f.TIMER_EVENT});b.tree.layout()}if(this.startImpl){this.startImpl(e)}else{if(setInterval){this.currentIntervalID=setInterval(e,1000/this.frameRate)}else{c.error("ERR__TIMER__START")}}},stop:function(){if(this.stopImpl){this.stopImpl()}else{if(this.currentIntervalID&&clearInterval){clearInterval(this.currentIntervalID);this.currentIntervalID=undefined}else{c.error("ERR__TIMER__STOP")}}}}})}());(function(){var h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,g=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame,f=navigator.userAgent,e=h&&!(f.match(/(iPod|iPhone|iPad)/)&&f.match(/AppleWebKit/));if(e){b.mixin(b.timing.Timer,{startImpl:function(l){var i,j,k=0;i=function(){k=h(i,b.tree.canvas);l()};if(g){j=function(){g(k);k=0}}else{j=function(){i=b.NO_OP}}this._cancelAnimate=j;i()},stopImpl:function(){if(this._cancelAnimate){this._cancelAnimate();this._cancelAnimate=undefined}}})}else{c.warn("WARN__CNV__REQ_ANIM_FRAME")}}());(function(){var e=b.defs,f="trigger",j=1000,h="begin",i="end",g={source:{type:Object,constraint:b.supportsEvents,defaultValue:null},type:e.String(""),offset:e.PositiveNumber(0)};b.declare({name:"oui.timing.TimeInterval",mixins:[b.events.EventSupport,b.lang.PropertiesSupport],membersDef:{init:function(k){this._plugged=true;this._active=false;this._beginSyncValues=[];this._endSyncValues=[];this._eventValues=[];this._initProperties(k);this._timerHandler=this.handler("_onTimer")},_onTimer:function(n){var m=n.timeStamp,k=this._beginTime,l=this._endTime;if(m>=k&&l>=k){if(!this._active){this.dispatchEvent({type:this.events.BEGIN,bubbles:false,syncTime:k});this._curBegin=k;this._curEnd=k+this._simpleDur;this._active=true;this._start(k)}this._repeat(m);if(m>=l){this._stop(l);this._active=false;b.timer.removeEventListener(b.timer.TIMER_EVENT,this._timerHandler);this.dispatchEvent({type:this.events.END,bubbles:false,syncTime:l,scheduled:(l>=this._curEnd)})}else{this._play(m)}}},_start:function(k){},_play:function(k){},_stop:function(k){},beginAt:function(k){this._beginSyncAt(b.currentTimeMillis(),k)},endAt:function(k){this._endSyncAt(b.currentTimeMillis(),k)},_beginSyncAt:function(m,n){var l=this._properties,k;if(isFinite(n)&&n>0){m+=n*j}this._simpleDur=l.dur*j;k=this._simpleDur;if(l.repeatDur!==0&&l.repeatCount!==0){k=Math.min(l.repeatDur*j,l.repeatCount*this._simpleDur)}else{if(l.repeatDur!==0){k=l.repeatDur*j}else{if(l.repeatCount!==0){k=l.repeatCount*this._simpleDur}}}this._endTime=m+k;this._beginTime=m;this._sync(h,this._beginTime);this._sync(i,this._endTime);b.timer.addEventListener(b.timer.TIMER_EVENT,this._timerHandler)},_endSyncAt:function(k,l){if(isFinite(l)&&l>0){k+=l*j}if(k<this._endTime){this._endTime=k;this._sync(i,this._endTime)}},_sync:function(l,p){var o=(l===h)?this._beginSyncValues:this._endSyncValues,k,n=o.length,m;for(k=0;k<n;k++){m=o[k];m.target[m.funcName](p,m.offset)}},_repeat:function(k){var m=this._beginTime,p=this._endTime,s=this._simpleDur,q=this._curBegin,r=this._curEnd,l,n,o;if(k>=r&&r<p){l=Math.floor((q-m)/s);o=Math.floor((k-q)/s);for(n=1;n<=o&&r<p;n++){q+=s;r+=s;this.dispatchEvent({type:this.events.REPEAT,bubbles:false,syncTime:q,detail:l+n})}this._curBegin=q;this._curEnd=r}},onPropChanged:function(k){if(k===f){this.plug()}},addBeginEvent:function(k){this._addEvent(k,"beginEvents",h,[])},addEndEvent:function(k){this._addEvent(k,"endEvents",i,[true])},_addEvent:function(l,p,o,k){var n=this._properties,m;if(n[p].length===0){n[p]=[]}m=n[p];if(b.isObjectValid(l,g,true)){m.push(l);if(this._plugged){this._plug(l,o,k)}}},plug:function(){var l,k,m;this.unplug();l=this._properties.beginEvents;for(k=0,m=l.length;k<m;k++){this._plug(l[k],h)}l=this._properties.endEvents;for(k=0,m=l.length;k<m;k++){this._plug(l[k],i)}this._plugged=true},_plug:function(o,l){var k=this,n="_"+l+"SyncAt",p=o.offset,m;if(o.type===h||o.type===i){m={target:k,funcName:n,offset:p};o.source._addSyncValue(o.type,m)}else{m=function(q){k[n](q.timeStamp,p)};o.source.addEventListener(o.type,m)}this._eventValues.push({desc:o,data:m})},unplug:function(){var k=this._eventValues,l,p,o,m;for(l=0,p=k.length;l<p;l++){o=k[l].desc;m=k[l].data;if(o.type===h||o.type===i){o.source._removeSyncValue(o.type,m)}else{o.source.removeEventListener(o.type,m)}}k.length=0;this._plugged=false},_addSyncValue:function(k,m){var l=(k===h)?this._beginSyncValues:this._endSyncValues;l.push(m)},_removeSyncValue:function(l,o){var n=(l===h)?this._beginSyncValues:this._endSyncValues,k,m=n.length;for(k=0;k<m;k++){if(n[k]===o){n.splice(k,1)}}}},eventsDef:[b.SyncEvents],propertiesDef:{dur:e.PositiveNumber(0),repeatDur:e.PositiveNumber(0),repeatCount:e.PositiveNumber(0),beginEvents:e.ArrayOfProperties(g,0,Number.MAX_VALUE,[],f),endEvents:e.ArrayOfProperties(g,0,Number.MAX_VALUE,[],f)}});b.timing.eventTriggerDefinition=g}());(function(){b.ns("oui.anim");function e(f){return{easeIn:function(g){return g===0?0:f(g)},easeOut:function(g){return 1-f(1-g)},easeInOut:function(g){if(g<0.5){g=f(2*g)/2}else{g=1-f(2*(1-g))/2}return g}}}b.anim.easing={linear:e(function(f){return f}),quadratic:e(function(f){return f*f}),cubic:e(function(f){return f*f*f}),quartic:e(function(f){return f*f*f*f}),quintic:e(function(f){return f*f*f*f*f}),exponential:e(function(f){return Math.pow(2,10*(f-1))}),circular:e(function(f){return 1-Math.sqrt(1-f*f)}),sine:e(function(f){return 1-Math.cos(f*Math.PI/2)}),back:e(function(g,f){f=f||1.70158;return g*g*((f+1)*g-f)}),bounce:e(function(f){f=1-f;if(f<1/2.75){f=2.75*f;f=f*f}else{if(f<2/2.75){f=2.75*f-1.5;f=f*f+0.75}else{if(f<2.5/2.75){f=2.75*f-2.25;f=f*f+0.9375}else{f=2.75*f-2.625;f=f*f+0.984375}}}return 1-f})}}());(function(){b.ns("oui.anim");b.mixin(b.anim,{interpolateDiscrete:function(h,f,g){var e;if(g<=0.5){e=h}else{e=f}return e},interpolateNumber:function(g,e,f){return g+(e-g)*f},interpolateColor:function(f,e,g){return new b.style.Color(f.red()+(e.red()-f.red())*g,f.green()+(e.green()-f.green())*g,f.blue()+(e.blue()-f.blue())*g,f.alpha()+(e.alpha()-f.alpha())*g)}})}());(function(){var e=b.defs,f=b.FillEnum;b.declare({name:"oui.anim.AbstractAnimation",isAbstract:true,extend:b.timing.TimeInterval,membersDef:{_stop:function(h){var g=this._properties.fill;if(g===f.REMOVE||(g===f._LEGACY&&h<this._curEnd)){this._play(this._curBegin)}else{this._play(h)}},_progress:function(h,i,l){var j,m=b.anim.easing[this._properties.easeMode],g=this._properties.easeIn,k=this._properties.easeOut;if(l<h){j=0}else{if(l>i||h===i){j=1}else{j=(l-h)/(i-h);if(m){if(g&&!k){j=m.easeIn(j)}else{if(!g&&k){j=m.easeOut(j)}else{if(g&&k){j=m.easeInOut(j)}}}}}}return j}},propertiesDef:{easeMode:e.String("quadratic"),easeIn:e.Boolean(false),easeOut:e.Boolean(false),fill:e.Enum(f,f.FREEZE)}})}());(function(){var j=b.anim.AbstractAnimation.prototype,f=b.defs,g=b.BASE_VALUE,i=b.anim.interpolateDiscrete,l=b.anim.interpolateNumber,h=b.anim.interpolateColor,m="ANIM_TAG",e,k;e=function(p,n,o){return b.anim.interpolateDiscrete(p,n,o)};k={interpolator:f.Function(3,e),beginValue:f.ObjectOfType(Object,g,true,false),endValue:f.ObjectOfType(Object,g,true,false)};b.declare({name:"oui.anim.AnimateStyle",extend:b.anim.AbstractAnimation,membersDef:{onPropChanged:function(n){var o=this._properties.targetNode;if(n===m){if(o){this._checkInterpolators(this._properties.animValues,o.StyleDefinition.prototype)}}else{j.onPropChanged.call(this,n)}},_checkInterpolators:function(r,p){var o,q,n,s;if(p===undefined){p={}}for(o in r){if(r.hasOwnProperty(o)){q=r[o];n=p[o];if(q.interpolator===undefined){this._checkInterpolators(q,n)}else{if(q.interpolator!==e){q._interpolate=q.interpolator}else{if(n!==undefined){s=n.type;if(s===Boolean){q._interpolate=i}else{if(s===Number){q._interpolate=l}else{if(s===b.style.Color||(s===b.style.Paint&&b.isA(q.beginValue,b.style.Color)&&b.isA(q.endValue,b.style.Color))){q._interpolate=h}else{q._interpolate=e}}}}else{if(b.isA(q.beginValue,Boolean)&&b.isA(q.endValue,Boolean)){q._interpolate=i}else{if(b.isA(q.beginValue,Number)&&b.isA(q.endValue,Number)){q._interpolate=l}else{if(b.isA(q.beginValue,b.style.Color)&&b.isA(q.endValue,b.style.Color)){q._interpolate=h}else{q._interpolate=e}}}}}}}}},_start:function(){var n=this._properties;this._resolveBaseValues(n.animValues,n.targetNode._style)},_play:function(o){var n=this._properties;n.targetNode.applyStyle(this._buildStyleObjectFor(n.animValues,this._progress(this._curBegin,this._curEnd,o)))},_resolveBaseValues:function(r,p){var n,q,o;for(n in r){q=r[n];o=p[n];if(q.hasOwnProperty("_interpolate")){if(q.beginValue===g){q._beginVal=o}else{q._beginVal=q.beginValue}if(q.endValue===g){q._endVal=o}else{q._endVal=q.endValue}}else{this._resolveBaseValues(q,o)}}},_buildStyleObjectFor:function(r,o){var n,q,p={};for(n in r){q=r[n];if(q.hasOwnProperty("_interpolate")){p[n]=q._interpolate(q._beginVal,q._endVal,o)}else{p[n]=this._buildStyleObjectFor(q,o)}}return p}},propertiesDef:{targetNode:{type:Object,constraint:function(n){return(n===undefined)||(b.isA(n.applyStyle,Function)&&b.isA(n.StyleDefinition,Function))},defaultValue:undefined,tag:m},animValues:f.MapOfProperties(k,{},false,true,true,m)}})}());(function(){var f=b.anim.AbstractAnimation.prototype,h="t",e="s",g="r";b.declare({name:"oui.anim.AnimateTransform",extend:b.anim.AbstractAnimation,membersDef:{init:function(j,i){f.init.call(this,j,i);this._interpolatedValue=new b.geom.Matrix();this._transforms=[]},translate:function(j,l,i,k){if(isFinite(j)&&isFinite(l)&&isFinite(i)&&isFinite(k)){this._transforms.push({type:h,x0:j,x1:i,y0:l,y1:k})}},rotate:function(l,k,j,i){if(isFinite(l)&&isFinite(k)){this._transforms.push({type:g,a0:l/180*Math.PI,a1:k/180*Math.PI,cx:j||0,cy:i||0})}},scale:function(j,l,i,k){if(isFinite(j)&&isFinite(l)&&isFinite(i)&&isFinite(k)){this._transforms.push({type:e,x0:j,x1:i,y0:l,y1:k})}},resetTransforms:function(){this._transforms.length=0},_play:function(p){var j=this._progress(this._curBegin,this._curEnd,p),n=this._transforms,l,o=n.length,k,m=this._interpolatedValue;m.init();for(l=0;l<o;l++){k=n[l];if(k.type===h){m._safeTranslate(k.x0+j*(k.x1-k.x0),k.y0+j*(k.y1-k.y0))}else{if(k.type===g){m._safeRotate(k.a0+j*(k.a1-k.a0),k.cx,k.cy)}else{if(k.type===e){m._safeScale(k.x0+j*(k.x1-k.x0),k.y0+j*(k.y1-k.y0))}}}}this._properties.targetNode.setTransformMatrix(m)}},propertiesDef:{targetNode:b.defs.ObjectOfType(b.scene.AbstractNode,undefined,false,true)}})}());(function(){b.declare({name:"oui.anim.AnimateCallback",extend:b.anim.AbstractAnimation,membersDef:{_play:function(e){this._properties.callback.call(this,this._progress(this._curBegin,this._curEnd,e))}},propertiesDef:{callback:{type:Function,defaultValue:b.NO_OP}}})}());(function(){b.ns("oui.anim");b.anim.EffectsSupport={_effectOn:function(h,g,k,l,f,j){var i,e=h+"Effect";if(this[e]===undefined){i={targetNode:this,dur:j,animValues:{}};i.animValues[k]={beginValue:l,endValue:f};this[e]=new b.anim.AnimateStyle(i)}this[e].addBeginEvent(g)},showOn:function(e){this._effectOn("show",e,"display",false,true,0)},hideOn:function(e){this._effectOn("hide",e,"display",true,false,0)},fadeOn:function(h,i,g,j,e){var f=null;if(b.isA(this,b.graphics.Group)||b.isA(this,b.graphics.Image)){f=new b.anim.AnimateStyle({targetNode:this,animValues:{opacity:{beginValue:i,endValue:g}},dur:j})}else{f=new b.anim.AnimateStyle({targetNode:this,animValues:{fillOpacity:{beginValue:i,endValue:g},strokeOpacity:{beginValue:i,endValue:g}},dur:j})}f.addBeginEvent(h);if(b.isA(e,String)){this[e]=f}},slideOn:function(i,j,l,k,h,g,f){var e=new b.anim.AnimateTransform({targetNode:this,dur:j,beginEvents:[i]});e.translate(l,k,h,g);if(b.isA(f,String)){this[f]=e}},scaleOn:function(g,f,i,h,n,k,l){var m,j,e;e=new b.anim.AnimateTransform({targetNode:this,dur:f,beginEvents:[g]});m=(n!==undefined?n:0);j=(k!==undefined?k:0);e.translate(m,j,m,j);e.scale(i,i,h,h);e.translate(-m,-j,-m,-j);if(b.isA(l,String)){this[l]=e}}}}());(function(){var h=b.defs,j=h._createDef,p={definition:h.ArrayOfProperties({type:h.String("image")},1,undefined,[{type:"image"}]),hotspotX:h.FinitePositiveNumber(0),hotspotY:h.FinitePositiveNumber(0)};function k(q){return b.hasOwnValue(b.CursorType,q,true)||b.isValueOfType(q,p,true)}function l(q){return(q===null)||b.isA(q,b.filters.AbstractFilter)}function m(r,q){return(r===q)||b.isFinitePositiveNumber(r)}function f(q){return(q===null)||b.isA(q,b.graphics.PathCommands)}function i(u,t,q){var w,v,s,r;q.value={};for(w in t){if(u[w]!==undefined){v=u[w];s=t[w];if(s.constructor===Object){r={validValue:false};i(v,s,r);if(r.validValue){q.value[w]=r.value}}else{if(s===true){q.value[w]=v;q.validValue=true}}}}}function g(u,t,q){var w,v,s,r;q.value={};for(w in u){if(u[w]!==undefined){v=u[w];s=t[w];if(s!==undefined&&s.constructor===Object){r={validValue:false};g(v,s,r);if(r.validValue){q.value[w]=r.value}}else{if(s!==false){q.value[w]=v;q.validValue=true}}}}}function o(s,q){var r=b.style.makeColor(s);if(r){q.validValue=true;q.value=r}}function n(s,q){var r;if(typeof s==="string"){s=s.toUpperCase();r=b.filters[s];if(r){q.validValue=true;q.value=r}}}function e(r,q){if(b.isA(r,String)){try{q.value=new b.graphics.PathCommands(r,true);q.validValue=true}catch(s){q.value=s.message;q.validValue=false}}}b.mixin(h,{Paint:function(r,q){if(!b.isA(r,b.style.Paint)){r=b.style.makeColor(r)}return j("Paint",b.style.Paint,r,q,o)},Color:function(r,q){r=b.style.makeColor(r);return j("Color",b.style.Color,r,q,o)},Image:function(t,s,r,q){return{src:h.String(t,q),width:h.FinitePositiveNumber(s,q),height:h.FinitePositiveNumber(r,q)}},Cursor:function(r,q){return j("Cursor",Object,r,q,undefined,k)},FilterEffect:function(r,q){return j("FilterEffect",Object,r,q,n,l)},Size:function(r,q){return j("Size",Object,r,q,undefined,[m,r])},PathData:function(r,q){return j("PathData",b.graphics.PathCommands,r,q,e,f,undefined,true)},PropertyFilter:function(r,s,q){return{type:"PropertyFilter",convertor:function(u,t){if(typeof u==="object"){if(r===true){g(u,s,t)}else{i(u,s,t)}}else{t.validValue=false}},tag:q}}});b.mixin(h,{FontStyle:function(t,z,u,y){var x=255,q=0,s=0,v=0,w;if(b.isA(y,b.style.Paint)){w=y}else{if(b.isA(y,Array)&&y.length>=3){q=y[0];s=y[1];v=y[2];if(y.length>3){x=y[3]}w=new b.style.Color(q,s,v,x)}else{w=b.black}}return{fontFamily:h.String(t),fontSize:h.FinitePositiveNumber(z),fontWeight:h.Enum(b.FontWeightEnum,u),fill:h.Paint(w)}},Padding:function(u,t,s,r,q){return{top:h.PositiveNumber(u,q),bottom:h.PositiveNumber(r,q),lineBegin:h.PositiveNumber(t,q),lineEnd:h.PositiveNumber(s,q)}},Marker:function(v,x,w,q,y,s,r,t,A,u,z){return{d:h.String(v,u||A),refX:h.FiniteNumber(x,A),refY:h.FiniteNumber(w,A),width:h.FinitePositiveNumber(q,A),height:h.FinitePositiveNumber(y,A),orient:{type:Object,constraint:function(B){return B===b.AUTO||b.isNumberInRange(B,[0,360],false)},defaultValue:s,tag:A},strokeUnits:h.Boolean(r,A),paint:{type:Object,defaultValue:t,tag:z||A}}}})}());(function(){b.declare({name:"oui.style.Paint",membersDef:{init:function(){},getOpacity:function(){return 1}}});b.NO_PAINT=new b.style.Paint()}());(function(){b.mixin(b.style.Paint,{cvToStyle:function(){return"rgba(255,255,255,0)"}})}());(function(){var h=b.defs,i=[0,255],m="([0-9a-f])",l="([0-9a-f]{2})",j="([0-9]{1,3})",k="\\s*,\\s*",e=new RegExp("^#?"+l+l+l+l+"?$|^#?"+m+m+m+"$"),f=new RegExp("^rgba\\("+j+k+j+k+j+k+j+"\\)$|^rgb\\("+j+k+j+k+j+"\\)$");function g(n){var o="";if(n<16){o="0"}return o+n.toString(16)}b.declare({name:"oui.style.Color",extend:b.style.Paint,mixins:[b.lang.PropertiesSupport],membersDef:{init:function(q,o,n,p){this._initProperties({red:q,green:o,blue:n,alpha:p});this.onPropChanged()},onPropChanged:function(){var p=this._properties,o,n,q,r;p.red=Math.round(p.red);p.green=Math.round(p.green);p.blue=Math.round(p.blue);p.alpha=Math.round(p.alpha);o=g(p.red);n=g(p.green);q=g(p.blue);r=g(p.alpha);this.hexRGB=o+n+q;this.hexRGBA=o+n+q+r;this.hexARGB=r+o+n+q;this._onPropChangedImpl()},_onPropChangedImpl:function(){},modify:function(o){var p=0,n=this._properties;if(b.isA(o,Number)){if(o<0){p=0}else{if(o>1){p=1}else{p=o}}}return new b.style.Color(n.red*p,n.green*p,n.blue*p,n.alpha)},setColor:function(o){if(b.isA(o,b.style.Color)){var n=o._properties;this.setProperties({red:n.red,green:n.green,blue:n.blue,alpha:n.alpha})}},setARGB:function(q,p,o,n){this.setProperties({red:p,green:o,blue:n,alpha:q})},setOpacity:function(n){this.setAlpha(n*255)},getOpacity:function(){return this._properties.alpha/255},toString:function(){var n,o=this._properties;if(o.alpha===255){n="#"+this.hexRGB}else{n="rgba(".concat(o.red,",",o.green,",",o.blue,",",o.alpha/255,")")}return n}},propertiesDef:{red:h.NumberInRange(i,0),green:h.NumberInRange(i,0),blue:h.NumberInRange(i,0),alpha:h.NumberInRange(i,255)}});b.style.makeColor=function(q){var n=null,p,o,t,s,r;if(b.isA(q,String)){q=b.trim(q).toLowerCase();if(b.style.CSS_COLORS.hasOwnProperty(q)){n=b[q]}if((r=e.exec(q))!==null){p=parseInt(r[1]||r[5]+r[5],16);o=parseInt(r[2]||r[6]+r[6],16);t=parseInt(r[3]||r[7]+r[7],16);s=255;if(r[4]){s=parseInt(r[4],16)}n=new b.style.Color(p,o,t,s)}if((r=f.exec(q))!==null){p=parseInt(r[1]||r[5],10);o=parseInt(r[2]||r[6],10);t=parseInt(r[3]||r[7],10);s=255;if(r[4]){s=parseInt(r[4],10)}n=new b.style.Color(p,o,t,s)}}else{if(b.isA(q,Array)&&(q.length===3||q.length===4)){p=q[0];o=q[1];t=q[2];s=255;if(q.length===4){s=q[3]}if(b.isNumberInRange(p,i)&&b.isNumberInRange(o,i)&&b.isNumberInRange(t,i)&&b.isNumberInRange(s,i)){n=new b.style.Color(p,o,t,s)}}else{if(b.isA(q,b.style.Color)){n=q}}}return n}}());(function(){b.mixin(b.style.Color,{_onPropChangedImpl:function(){this.cvColor=this.toString()},cvToStyle:function(){return this.cvColor}})}());b.style=b.style||{};(function(){var f,e;b.style.CSS_COLORS=f={aliceBlue:"F0F8FF",antiqueWhite:"FAEBD7",aqua:"0FF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000",blanchedAlmond:"FFEBCD",blue:"00F",blueViolet:"8A2BE2",brown:"A52A2A",burlyWood:"DEB887",cadetBlue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerBlue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"0FF",darkBlue:"00008B",darkCyan:"008B8B",darkGoldenRod:"B8860B",darkGray:"A9A9A9",darkGreen:"006400",darkKhaki:"BDB76B",darkMagenta:"8B008B",darkOliveGreen:"556B2F",darkOrange:"FF8C00",darkOrchid:"9932CC",darkRed:"8B0000",darkSalmon:"E9967A",darkSeaGreen:"8FBC8F",darkSlateBlue:"483D8B",darkSlateGray:"2F4F4F",darkTurquoise:"00CED1",darkViolet:"9400D3",deepPink:"FF1493",deepSkyBlue:"00BFFF",dimGray:"696969",dodgerBlue:"1E90FF",fireBrick:"B22222",floralWhite:"FFFAF0",forestGreen:"228B22",fuchsia:"F0F",gainsboro:"DCDCDC",ghostWhite:"F8F8FF",gold:"FFD700",goldenRod:"DAA520",gray:"808080",green:"008000",greenYellow:"ADFF2F",honeyDew:"F0FFF0",hotPink:"FF69B4",indianRed:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderBlush:"FFF0F5",lawnGreen:"7CFC00",lemonChiffon:"FFFACD",lightBlue:"ADD8E6",lightCoral:"F08080",lightCyan:"E0FFFF",lightGoldenRodYellow:"FAFAD2",lightGrey:"D3D3D3",lightGreen:"90EE90",lightPink:"FFB6C1",lightSalmon:"FFA07A",lightSeaGreen:"20B2AA",lightSkyBlue:"87CEFA",lightSlateGray:"789",lightSteelBlue:"B0C4DE",lightYellow:"FFFFE0",lime:"0F0",limeGreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumAquaMarine:"66CDAA",mediumBlue:"0000CD",mediumOrchid:"BA55D3",mediumPurple:"9370D8",mediumSeaGreen:"3CB371",mediumSlateBlue:"7B68EE",mediumSpringGreen:"00FA9A",mediumTurquoise:"48D1CC",mediumVioletRed:"C71585",midnightBlue:"191970",mintCream:"F5FFFA",mistyRose:"FFE4E1",moccasin:"FFE4B5",navajoWhite:"FFDEAD",navy:"000080",oldLace:"FDF5E6",olive:"808000",oliveDrab:"6B8E23",orange:"FFA500",orangeRed:"FF4500",orchid:"DA70D6",paleGoldenRod:"EEE8AA",paleGreen:"98FB98",paleTurquoise:"AFEEEE",paleVioletRed:"D87093",papayaWhip:"FFEFD5",peachPuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderBlue:"B0E0E6",purple:"800080",red:"F00",rosyBrown:"BC8F8F",royalBlue:"4169E1",saddleBrown:"8B4513",salmon:"FA8072",sandyBrown:"F4A460",seaGreen:"2E8B57",seaShell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyBlue:"87CEEB",slateBlue:"6A5ACD",slateGray:"708090",snow:"FFFAFA",springGreen:"00FF7F",steelBlue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",transparent:"FFFFFF00",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFF",whiteSmoke:"F5F5F5",yellow:"FF0",yellowGreen:"9ACD32"};if(typeof b.style.makeColor==="function"){for(e in f){if(f.hasOwnProperty(e)){b[e.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase()]=b[e.toLowerCase()]=b[e]=b.style.makeColor(f[e])}}}for(e in f){if(f.hasOwnProperty(e)){f[e]="#"+f[e];f[e.toLowerCase()]=f[e]}}}());(function(){b.declare({name:"oui.style.GradientStop",mixins:[b.lang.PropertiesSupport],membersDef:{init:function(e){this._initProperties(e)}},propertiesDef:{color:b.defs.Color(b.black),offset:b.defs.NumberInRange([0,1],0)}})}());(function(){b.declare({name:"oui.style.GradientPaint",isAbstract:true,extend:b.style.Paint,mixins:[b.lang.PropertiesSupport],membersDef:{init:function(e){this._initImpl();this._initProperties(e)},onPropChanged:function(){this._onPropChangedImpl()},addGradientStop:function(i,e){if(this._properties.stops.length===0){this._properties.stops=[]}var h=new b.style.GradientStop({offset:i,color:e}),g=this._properties.stops,j=g.length,f=0;while(f<=j-1&&i>=g[f].getOffset()){f++}g.splice(f,0,h);this.onPropChanged()},_initImpl:function(){},_onPropChangedImpl:function(){}},propertiesDef:{useObjectBoundingBox:b.defs.Boolean(true),stops:b.defs.ArrayOfType({type:b.style.GradientStop,convertor:function(h,e,g,k){var j,f=null;if(typeof h==="object"&&typeof h.offset==="number"){j=h.offset;f=b.style.makeColor(h.color)}else{if(k>1){j=g/(k-1);f=b.style.makeColor(h)}}if(f){e.validValue=true;e.value=new b.style.GradientStop({offset:j,color:f})}}},0,undefined,[],undefined,false,true)}})}());(function(){var e=b.defs;b.declare({name:"oui.style.LinearGradient",extend:b.style.GradientPaint,propertiesDef:{x1:e.FiniteNumber(0),y1:e.FiniteNumber(0),x2:e.FiniteNumber(1),y2:e.FiniteNumber(0)}});b.mixin(b.style,{deriveGradient:function(i,j,f){var k,h,g;if(f===undefined){f=0.8}k=i.modify(f);if(j===true){h=i;g=k}else{h=k;g=i}return new b.style.LinearGradient({x1:0,y1:0,x2:0,y2:1,stops:[h,g]})}})}());(function(){b.mixin(b.style.LinearGradient,{cvToStyle:function(e,m){var l=this._properties,n=l.stops,k=n.length,f,g,j,h;if(l.useObjectBoundingBox){f=m.createLinearGradient(l.x1*e.width+e.x,l.y1*e.height+e.y,l.x2*e.width+e.x,l.y2*e.height+e.y)}else{f=m.createLinearGradient(l.x1,l.y1,l.x2,l.y2)}for(h=0;h<k;h++){j=n[h];g=j.getColor();f.addColorStop(j.getOffset(),g.cvToStyle())}return f}})}());(function(){var e=b.defs;b.declare({name:"oui.style.RadialGradient",extend:b.style.GradientPaint,propertiesDef:{cx:e.FiniteNumber(0.5),cy:e.FiniteNumber(0.5),radius:e.FiniteNumber(0.5)}})}());(function(){b.mixin(b.style.RadialGradient,{cvToStyle:function(e,n){var m=this._properties,o=m.stops,l=o.length,j,g,k,f,h;if(m.useObjectBoundingBox){f=Math.min(e.width,e.height);j=n.createRadialGradient(m.cx*e.width+e.x,m.cy*e.height+e.y,0,m.cx*e.width+e.x,m.cy*e.height+e.y,m.radius*f)}else{j=n.createRadialGradient(m.cx,m.cy,0,m.cx,m.cy,m.radius)}for(h=0;h<l;h++){k=o[h];g=k.getColor();j.addColorStop(k.getOffset(),g.cvToStyle())}return j}})}());(function(){b.declare({name:"oui.style.PatternPaint",extend:b.style.Paint,mixins:[b.lang.PropertiesSupport,b.events.EventSupport],eventsDef:{PATTERN_READY:"patternReady"},membersDef:{init:function(e){this._srcW=0;this._srcH=0;this._initImpl();this._initProperties(e)},onPropChanged:function(){var e=this._properties.src;if(this.prevRequest){b.resourcesManager.removeObserver(this.prevRequest,this);this.prevRequest=null}else{if(this.imageLoader){this.imageLoader.offComplete(this);this.imageLoader=null}}this._onPropChangedImpl();if(e.length>0){if(b.resourcesManager.hasResource(e)){b.resourcesManager.requestResource(e,this);this.prevRequest=e}else{this.imageLoader=new b.utils.ImageLoader();this.imageLoader.onComplete(this);this.imageLoader.load(e)}}},handleEvent:function(e){this._srcW=e.width;this._srcH=e.height;this._patternReadyImpl(e);this.dispatchEvent({type:this.events.PATTERN_READY})},resourceUpdate:function(e){this.handleEvent(e)},_initImpl:function(){},_onPropChangedImpl:function(){},_patternReadyImpl:function(e){}},propertiesDef:{src:b.defs.String("")}})}());(function(){var e=b.style.Paint.prototype;b.mixin(b.style.PatternPaint,{_onPropChangedImpl:function(){this.cvImg=null},_patternReadyImpl:function(f){this.cvImg=f.data},cvToStyle:function(f,g){return this.cvImg?g.createPattern(this.cvImg,"repeat"):e.cvToStyle.call(this,f,g)}})}());(function(){b.ns("oui.style");var t=b.GENERIC_FONTS.SANS_SERIF,q=b.GENERIC_FONTS.SERIF,e=b.GENERIC_FONTS.MONOSPACE,g=b.GENERIC_FONTS.CURSIVE,o,p,h,l,k,r,s,f;o=[["Arial","'Helvetica Neue'","Helvetica",t],["'Arial Black'","Gadget",t],["'Comic Sans MS'","'Comic Sans'","Textile",g],["'Courier New'","Courier",e],["Georgia",q],["Impact","Charcoal",t],["'Lucida Console'","Monaco",e],["'Lucida Sans Unicode'","'Lucida Grande'",t],["'Palatino Linotype'","'Book Antiqua'","Palatino",q],["Tahoma","Geneva","'Liberation Sans'","'Nimbus Sans L'","FreeSans",t],["'Times New Roman'","Times",q],["'Trebuchet MS'","Trebuchet",t],["Verdana","Geneva",t],["'MS Sans Serif'","Geneva",t],["'MS Serif'","'New York'",q]];b.cssFonts={};for(p=0,h=o.length;p<h;p++){r=o[p];for(l=0,k=r.length-1;l<k;l++){f=r[l].replace(/'/gi,"").toLowerCase();if(b.cssFonts.hasOwnProperty(f)===false){s=r.slice();s.splice(l,1);s.unshift(r[l]);b.cssFonts[f]=s.join(",")}}}}());(function(){b.ns("oui.text.locales");b.text.locales.en_US={eras:["BC","AD"],months:[{l:"January",s:"Jan"},{l:"February",s:"Feb"},{l:"March",s:"Mar"},{l:"April",s:"Apr"},{l:"May",s:"May"},{l:"June",s:"Jun"},{l:"July",s:"Jul"},{l:"August",s:"Aug"},{l:"September",s:"Sep"},{l:"October",s:"Oct"},{l:"November",s:"Nov"},{l:"December",s:"Dec"}],days:[{l:"Sunday",s:"Sun"},{l:"Monday",s:"Mon"},{l:"Tuesday",s:"Tue"},{l:"Wednesday",s:"Wed"},{l:"Thursday",s:"Thu"},{l:"Friday",s:"Fri"},{l:"Saturday",s:"Sat"}],ampm:["AM","PM"],timezones:{0:{std:{l:"Greenwich Mean Time",s:"GMT"},dst:{l:"Greenwich Mean Time",s:"GMT"}},480:{std:{l:"Pacific Standard Time",s:"PST"},dst:{l:"Pacific Daylight Time",s:"PDT"}},420:{std:{l:"Mountain Standard Time",s:"MST"},dst:{l:"Mountain Daylight Time",s:"MDT"}},360:{std:{l:"Central Standard Time",s:"CST"},dst:{l:"Central Daylight Time",s:"CDT"}},300:{std:{l:"Eastern Standard Time",s:"EST"},dst:{l:"Eastern Daylight Time",s:"EDT"}},600:{std:{l:"Hawaii Standard Time",s:"HST"},dst:{l:"Hawaii Standard Time",s:"HST"}},540:{std:{l:"Alaska Standard Time",s:"AKST"},dst:{l:"Alaska Standard Time",s:"AKST"}},240:{std:{l:"Atlantic Standard Time",s:"AST"},dst:{l:"Atlantic Daylight Time",s:"ADT"}},210:{std:{l:"Newfoundland Standard Time",s:"NST"},dst:{l:"Newfoundland Daylight Time",s:"NDT"}}},shortDate:"M/d/yy",medDate:"d-MMM-yy",longDate:"MMMM d, yyyy",fullDate:"EEEE MMMM d, yyyy G",date:"d-MMMM-yy",shortTime:"h:mm a",medTime:"h:mm:ss a",longTime:"h:mm:ss a z",fullTime:"h:mm:ss;S 'o''clock' a z",time:"h:mm:ss a"}}());b.text=b.text||{};(function(){var t,e="0",s="#",i="0",j="E",p="+",k="-",v="\u221E";t=function(){};t.prototype={tempMinIntegerDigits:0,minDecimalPlaces:0,maxDecimalPlaces:0,minIntegerPlaces:1,maxIntegerPlaces:1,prefix:"",suffix:"",integerPattern:"",decimalPattern:"",grouping:3,percentMode:false,permilleMode:false,color:null};function f(y){var B,z=0,A=y.length,x=false;if(y.charAt(z)===j&&A>1){x=true;z+=1;B=y.charAt(z);if(B===p||B===k){z+=1}while(z<A){if(y.charAt(z)===e){z++}else{x=false;break}}}return x}function l(D,x,y){var z=false,A=false,F=D.length>0,E,C,B;for(C=0,B=D.length;C<B;C++){E=D.charAt(C);if(E===s||E===e){continue}else{if(E===x){if(z){F=false;break}else{z=true}}else{if(E===y){if(A){F=false;break}else{if(z){F=false;break}else{A=true}}}else{if(E===j){F=f(D.substring(C,B));break}else{F=false;break}}}}}return F}function h(A,y){var B,x,z;B=A.indexOf("[");x=A.indexOf("]");if(B>-1&&x>B){z=A.substring(B+1,x).toLowerCase();if(b.style.CSS_COLORS.hasOwnProperty(z)){y.color=b.style.CSS_COLORS[z]}else{if(z.match(/^(0x)?[0-9a-fA-F]{6}$/)){y.color="#"+z.replace("0x","")}}if(y.color!==null){A=A.substring(0,B)+A.substring(x+1)}}return A}function q(I,D,x){var y=I.length,L=I.indexOf(s),z=I.indexOf(e),C=I.indexOf(x),H=I.indexOf("%"),B=I.indexOf("\u2030"),M,E,F,G,K,A,J;if(L<0){L=y-1}if(z<0){z=y-1}if(C<0){C=y-1}F=I.lastIndexOf(s);G=I.lastIndexOf(e);K=I.lastIndexOf(x);A=Math.min(L,C,z);A=A<0?0:A;J=Math.max(F,G,K);D.prefix=I.substring(0,A);D.suffix=I.substring(J+1,y);if(A>J+1||(H>=0&&B>=0)||(H>=0&&H!==I.lastIndexOf("%"))||(B>=0&&B!==I.lastIndexOf("\u2030"))){I=""}else{I=I.substring(A,J+1);if(H>0){D.percentMode=true;M=H;E="%"}else{if(B>0){D.permilleMode=true;M=B;E="\u2030"}}if(M>=A&&M<=J){I=I.replace(E,"");D.suffix=E+D.suffix}}return I}function g(A,y,x){var z=A.lastIndexOf(x);if(z>0){y.grouping=A.length-z-1}else{y.grouping=-1}}function m(y,x){x.minDecimalPlaces=0;x.maxDecimalPlaces=0;if(y.length>0){x.minDecimalPlaces=y.lastIndexOf(e)>-1?y.lastIndexOf(e)+1:0;x.maxDecimalPlaces=y.length}}function w(B,y,x){var A,D,z,C;y.minIntegerPlaces=0;y.maxIntegerPlaces=0;for(z=0,C=B.length;z<C;z++){D=B.charAt(z);if(D===e){y.minIntegerPlaces++;y.maxIntegerPlaces++}if(D===s){y.maxIntegerPlaces++}}A=B.lastIndexOf(x);y.tempMinIntegerDigits=A;if(y.tempMinIntegerDigits===-1){y.tempMinIntegerDigits=y.minIntegerPlaces}}function o(D,A,z,y){var x=D.split(j),C,E,B;A.exponent=0;if(x.length===2){C=x[1];B=0;E=C.charAt(B);if(E===p){B+=1}A.exponent=C.length-B}else{A.exponent=0}C=x[0].split(z);if(z===y&&C.length===3){A.intPattern=C[0];A.intPattern+=y;A.intPattern+=C[1];A.decPattern=C[2]}else{if(C.length===2){A.intPattern=C[0];A.decPattern=C[1]}else{A.intPattern=x[0];A.decPattern=""}}}function u(A,z,y){var x=new t();A=h(A,x);A=q(A,x,z);if(l(A,z,y)){o(A,x,z,y);g(x.intPattern,x,y);m(x.decPattern,x);w(x.intPattern,x,y)}else{x=null}return x}function n(E,A,z,y){var F="",x="",B,C=0,D=0;if(E>0){x=E.toString()}A-=x.length;if(A>0){for(C=0;C<A;C++){F+=i}x=F+x}if(z>0&&x.length>z){B=[];for(C=x.length-1;C>=0;C--){if(D===z-1&&C>0){B.unshift(y,x.charAt(C));D=0}else{B.unshift(x.charAt(C));D++}}x=B.join("")}return x}function r(D,C,y,x){var E="",z=0,B="",A;if(D>0){A=C-Math.floor(C);for(z=0;z<x;z++){A*=10;if(Math.floor(A)===0){B+=i}else{break}}if(z<x){B+=D.toString()}z=B.length-1;while(B.charAt(z)===i&&z>=y){z--}B=B.substring(0,z+1)}y-=B.length;if(y>0){for(z=0;z<y;z++){E+=i}B+=E}return B}b.text.NumberFormatter=function(B){var z=".",D=",",y=null,x=null,A,C=null;this.applyPattern=function(K){var G,J,F="",I=0,H="",L="",E;if(typeof K==="string"&&K.length>0&&K!==A){G=K.indexOf("{");J=K.indexOf("}");if(G===0&&J>=2){F=K.substring(G+1,J);I=F.length;if(J>2){H=F.charAt(I-1);L=F.charAt(I-2)}else{H="\uFFFF";L=F.charAt(I-1)}if(H!==L&&!H.match(/[0-9a-zA-Z]/)&&!L.match(/[0-9a-zA-Z]/)){z=H;D=L;K=K.substring(J+1)}}E=K.split(";");if(E&&E.length>0){y=u(E[0],z,D);if(E.length>1&&E[1]&&E[1].length>0){x=u(E[1],z,D)}else{x=y}}else{y=null;x=null}A=K}};this.format=function(L){var U,G,H="",R,N,I,O,S,T,K,P,Q,J,F,E,M;if(typeof L!=="number"||y===null){U=""}else{G=L<0?x:y;C=G.color;R=G.exponent;N=G.tempMinIntegerDigits;I=G.minIntegerPlaces;O=G.minDecimalPlaces;S=G.maxDecimalPlaces;if(L<0&&y===x){H+=k}if(L<0){L=-L}if(G.percentMode){L*=100}else{if(G.permilleMode){L*=1000}}T=0;K=0;if(R>0){K=Math.floor(Math.log(L)/Math.log(10));if(K!==Infinity){P=K;if(I!==0){K-=I-1}T=(L/Math.pow(10,K));K=P-(N-1)}else{T=L}}else{T=L}T+=5*Math.pow(10,-S-1);Q=Math.floor(T);J=T-Q;F=Math.pow(10,-S);E=Math.floor(J/F);U=n(Q,I,G.grouping,D);if(O>0||E>0){U+=z}U+=r(E,T,O,S);if(R>0){if(K===Infinity||K===-Infinity){if(Math.abs(L)<1){U=i}else{U=v}}else{U+=j;if(K<0){U+=k}else{U+=p}for(M=1;M<R;M++){U+=i}U+=Math.abs(K).toString()}}if(U.length>0&&D===U.charAt(0)){U=U.substring(1,U.length)}if(U.length===0){U=i}U=(G.prefix+H+U+G.suffix)}return U};this.getColor=function(){return C};this.hasColor=function(){return C!==null};this.applyPattern(B)};b.formatNumber=function(y,x){return new b.text.NumberFormatter(y).format(x)}}());(function(){var e=/\|/,f=/(?:#|<)/;b.declare({name:"oui.text.ChoiceFormatter",membersDef:{init:function(g){this.applyPattern(g)},applyPattern:function(q){var h=q.split(e),m,j,r,g,s,k,l,p,o;if(h&&h.length>0){o=[];for(m=0,j=h.length;m<j;m++){r=h[m];g=r.match(f);if(g){s=r.indexOf(g);k=r.substring(0,s);l=r.substring(s+1);p={format:l,open:(g[0]==="<"),min:parseInt(k,10),max:Number.POSITIVE_INFINITY};if(o.length>0){o[o.length-1].max=p.min}o.push(p)}}}this.choiceElements=o},format:function(m){var g,l=this.choiceElements,h,j,p=l.length,k=l[0],o=l[p-1];if(isNaN(m)||m<=k.min){g=k.format}else{if(m>=o.max){g=o.format}else{for(j=0;j<p;j++){h=l[j];if((h.open===false&&h.min===m)||(h.min<m&&m<h.max)){g=h.format;break}}}}return g}}});b.formatChoice=function(h,g){return new b.text.ChoiceFormatter(h).format(g)}}());(function(){var y=b.text.locales.en_US,n="G",f="y",F="M",z="w",i="W",u="D",p="d",D="F",m="E",C="a",A="H",j="k",E="K",v="h",o="m",s="s",k="S",l="z",x="Z",B="short",r="medium",h="long",t="full",g=24*60*60*1000,q=1,w=4;function e(J,I){var G="",H=J.toString();for(I-=H.length;I>0;I--){G+="0"}return G+H}b.declare({name:"oui.text.DateFormatter",membersDef:{init:function(G,H){this.applyPattern(G,H)},applyPattern:function(I,K){var H,N,M,G,L,J;I=this._fixPattern(I,K);this.dateElements=[];if(I){for(H=0,N=I.length;H<N;H++){M=I.charAt(H);if(!this._isSupportedToken(M)){J=undefined;if(M==="'"){G="";L=H+1;while(L<N){M=I.charAt(L);if(M==="'"){if(I.charAt(L+1)==="'"){G+=M;L+=2}else{break}}else{G+=M;L+=1}}if(L>=N){L=H}else{this.dateElements.push(G)}H=L}else{if((M<"a"||M>"z")&&(M<"A"||M>"Z")){this.dateElements.push(M)}}}else{if(J&&(M===J.type)){J.size++}else{J={type:M,size:1};this.dateElements.push(J)}}}}},_fixPattern:function(H,I){var G;if(H){switch(H){case B:G=I?y.shortTime:y.shortDate;break;case r:G=I?y.medTime:y.medDate;break;case h:G=I?y.longTime:y.longDate;break;case t:G=I?y.fullTime:y.fullDate;break;default:G=H;break}}else{G=I?y.time:y.date}return G},_isSupportedToken:function(G){return(G===n||G===f||G===F||G===z||G===i||G===u||G===p||G===D||G===m||G===C||G===A||G===j||G===E||G===v||G===o||G===s||G===k||G===l||G===x)},format:function(N){var L="",I,H,J,G,K,M,O;if(b.isA(N,Date)){I=N}else{I=new Date();I.setDate(N)}for(J=0,G=this.dateElements.length;J<G;J++){H=this.dateElements[J];if(b.isA(H,Object)){switch(H.type){case n:L+=y.eras[I.getFullYear()>0?1:0];break;case f:K=I.getFullYear().toString();if(H.size<4){L+=K.substring(K.length-2)}else{L+=K}break;case F:K=I.getMonth();if(H.size<3){L+=e(K+1,H.size)}else{if(H.size<4){L+=y.months[K].s}else{L+=y.months[K].l}}break;case z:L+=e(this._getWeekOfYear(I),H.size);break;case i:L+=e(this._getWeekOfMonth(I),H.size);break;case u:L+=e(this._getDayOfYear(I),H.size);break;case p:L+=e(I.getDate(),H.size);break;case D:L+=e(I.getDay(),H.size);break;case m:K=I.getDay();if(H.size<4){L+=y.days[K].s}else{L+=y.days[K].l}break;case C:L+=y.ampm[I.getHours()<12?0:1];break;case A:L+=e(I.getHours(),H.size);break;case j:L+=e(((I.getHours()+23)%24)+1,H.size);break;case E:L+=e(I.getHours()%12,H.size);break;case v:L+=e(((I.getHours()+11)%12)+1,H.size);break;case o:L+=e(I.getMinutes(),H.size);break;case s:L+=e(I.getSeconds(),H.size);break;case k:L+=e(I.getMilliseconds(),H.size);break;case l:K=I.getTimezoneOffset();if(this._isDST(I)){M=(K+60).toString();O="dst"}else{M=K.toString();O="std"}if(y.timezones.hasOwnProperty(M)){K=y.timezones[M];if(H.size<4){L+=K[O].s}else{L+=K[O].l}}else{L+="GMT"+(K>0?"-":"+")+Math.floor(K/60)+":"+e((K%60),2)}break;case x:K=I.getTimezoneOffset();L+=(K>0?"-":"+")+e(Math.floor(K/60),2)+e((K%60),2);break;default:c.error("ERR__FORMAT__ILLEGAL_DATE_PATTERN",H)}}else{L+=H.toString()}}return L},_getWeekOfYear:function(H,G,L){var K,I,J,M;if(!isFinite(G)){G=q}if(!isFinite(L)){L=w}K=(7+H.getDay()-G)%7;I=(this._getDayOfYear(H)-K+6)/7;J=new Date(H.getFullYear(),0,L);M=(7+J.getDay()-G)%7;if(L-M<1){I++}return Math.floor(I)},_getWeekOfMonth:function(I,H,L){var K,G,J,M;if(!isFinite(H)){H=q}if(!isFinite(L)){L=w}K=(7+I.getDay()-H)%7;G=(I.getDate()-K+6)/7;J=new Date(I.getFullYear(),I.getMonth(),L);M=(7+J.getDay()-H)%7;if(L-M<1){G++}return Math.floor(G)},_getDayOfYear:function(I){var J=I.getFullYear(),M=I.getMonth(),G=I.getDate(),H=new Date(J,0,1,12,0,0),L=new Date(J,M,G,12,0,0),K=(L.getTime()-H.getTime())/g;return(Math.round(K)+1)},_isDST:function(H){var G=new Date(H.getFullYear(),0,1,H.getHours(),H.getMinutes(),H.getSeconds(),H.getMilliseconds());return(H.getTimezoneOffset()!==G.getTimezoneOffset())}}});b.text.DateFormatter.setLocale=function(G){if(typeof G==="string"&&b.text.locales.hasOwnProperty(G)===true){y=b.text.locales[G]}};b.formatDate=function(H,G){return new b.text.DateFormatter(H).format(G)}}());(function(){var e={NUMBER:"number",CHOICE:"choice",DATE:"date",TIME:"time"};b.declare({name:"oui.text.FormatElement",membersDef:{init:function(k,j,i){var h,f,g;if(b.isFinitePositiveNumber(k)){this.argIndex=k}else{c.error("ERR__FORMAT__ILLEGAL_ARG_INDEX")}h=b.isA(j,String);f=b.isA(i,String);if(h&&f){switch(j){case e.NUMBER:g=new b.text.NumberFormatter(i);break;case e.CHOICE:g=new b.text.ChoiceFormatter(i);break;case e.DATE:g=new b.text.DateFormatter(i);break;case e.TIME:g=new b.text.DateFormatter(i,true);break;default:c.error("ERR__FORMAT__ILLEGAL_ARG_TYPE",j)}this.type=j}else{if(h&&!f){c.error("ERR__FORMAT__ILLEGAL_ARG_NO_STYLE")}else{if(!h&&f){c.error("ERR__FORMAT__ILLEGAL_ARG_NO_TYPE")}}}this.format=function(m){var l;if(this.accepts(m)){if(g){l=g.format(m)}else{l=(m===null?"null":m.toString())}}else{c.error("ERR__FORMAT__ILLEGAL_ARG_VALUE")}return l}},accepts:function(h){var g=true,f=this.type;if(f){if(f===e.NUMBER||f===e.CHOICE){g=b.isA(h,Number)}else{if(f===e.DATE||f===e.TIME){g=b.isA(h,Date)}}}return g},toString:function(){return"{"+this.argIndex+"}"}}});b.text.FormatElement.TypeEnum=e}());(function(){var e=/\{\d+(?:\,(?:choice|number|date|time)\,(?:[^\{]|\{[^\{]+\})+)?\}/g;b.declare({name:"oui.text.MessageFormatter",membersDef:{init:function(f){this.applyPattern(f)},applyPattern:function(q){var h=q.match(e),p=q.split(e),o,j,m,t,l,r,s,g,f,k,u=[];if(h&&h.length>0&&p&&p.length>0){for(o=0,j=h.length;o<j;o++){m=undefined;l=undefined;r=undefined;s=h[o];g=s.indexOf(",");if(g<0){t=s.substring(1,s.length-1);m=parseInt(t,10)}else{m=parseInt(s.substring(1,g),10);f=s.indexOf(",",g+1);l=s.substring(g+1,f);r=s.substring(f+1,s.length-1)}k=new b.text.FormatElement(m,l,r);u.push(p[o]);u.push(k)}u.push(p[h.length])}else{u.push(q)}this.parsedPattern=u},format:function(){var g="",k,j=this.parsedPattern.length,m,f,h,l;for(k=0;k<j;k++){m=this.parsedPattern[k];if(b.isA(m,b.text.FormatElement)){f=arguments[m.argIndex];if(f!==undefined){h=m.format(f);if(m.type===b.text.FormatElement.TypeEnum.CHOICE){l=new b.text.MessageFormatter(h);h=l.format.apply(l,arguments)}g+=h}else{g+=m.toString()}}else{if(b.isA(m,String)){g+=m}}}return g}}});b.formatMessage=function(h,g){var f=new b.text.MessageFormatter(h);return f.format.apply(f,g)}}());(function(){var f=new RegExp("\\S+","g");function e(k){var i=[],g,j,h=0;while((g=f.exec(k))!==null){j=g[0];i.push({beginIndex:g.index,endIndex:g.index+(j.length-1),length:j.length,value:j,wordIndex:h});h++}return i}b.declare({name:"oui.text.WordIterator",membersDef:{init:function(g){this._words=e(g);this._wordCount=this._words.length;this._currWord=null},first:function(){var g=null;if(this._wordCount>0){g=this._words[0]}this._currWord=g;return g},last:function(){var g=null;if(this._wordCount>0){g=this._words[this._wordCount-1]}this._currWord=g;return g},next:function(){var i=null,j=this._wordCount,h,g;if(j>0){h=this._currWord;g=0;if(h){g=h.wordIndex+1}if(g<j){i=this._words[g]}}this._currWord=i;return i},previous:function(){var i=null,h=this._wordCount,g,j;if(h>0){g=this._currWord;j=h-1;if(g){j=g.wordIndex-1}if(j>=0){i=this._words[j]}}this._currWord=i;return i},current:function(){return this._currWord},wordAt:function(n){var m=this._words,h=this._wordCount,k=null,l=0,j,g=null;if(this._currWord){l=this._currWord.wordIndex}for(j=l;j<h;j++){g=m[j];if(n<g.beginIndex){break}else{if(n<=g.endIndex){k=g;break}}}this._currWord=g;return k}}})}());(function(){var e="\n";b.declare({name:"oui.text.LineBreakMeasurer",membersDef:{init:function(f){this._textValue=f.textValue();this._position=0;this._wordIterator=new b.text.WordIterator(this._textValue);this._wordIterator.first();this._initOffsetLimits();this._initImpl(f)},nextLine:function(g){var f=this._nextLineImpl(g);if(f&&f.leading===undefined){f.leading=this._computeLeadingApproximation(f)}return f},replaceText:function(g,j,i){var h=this._textValue,f=h.length;if(g<0||j>f||g>j){c.error("ERR__LINEBREAK__ILLEGAL_REPLACE_ARG")}this._textValue="";if(g!==0){this._textValue+=h.slice(0,g)}if(i!==null){this._textValue+=i}if(j!==f){this._textValue+=h.slice(j)}this._position=0;this._wordIterator.init(this._textValue);this._wordIterator.first();this._initOffsetLimits();this._replaceTextImpl(g,j,i)},getRawText:function(){return this._textValue},getTextLength:function(){return this._textValue.length},_initImpl:function(f){},_nextLineImpl:function(l){var k=this._getCurrentOffsetLimit(),n=null,i=this._wordIterator,j=this._position,g=j,f=i.current(),m,h;if(f){m=f.endIndex+1;if(m>k||this._measureImpl(j,m)>l){g=this._fitChars(l,k);h=true}else{g=this._fitWords(l,k);h=false}this._updateOffsetLimit(g);if(g>j){n=this._createLineObjImpl(j,g,h);this._position=g}}return n},_measureImpl:function(g,f){return 0},_createLineObjImpl:function(h,f,g){return{textValue:this._textValue.substring(h,f),textBlockBeginIndex:h,lastWordTruncated:g,lineWidth:0,lineHeight:0,ascent:0,descent:0,userData:null}},_replaceTextImpl:function(f,h,g){},_initOffsetLimits:function(){this._offsetLimits=this._findOffsetLimits(this._textValue);this._offsetLimitsCount=this._offsetLimits.length;this._currOffsetLimit=0},_findOffsetLimits:function(g){var f=[],j=0,h=g.length;for(j=0;j<h;j++){if(e===g.charAt(j)){f.push(j+1)}}return f},_getCurrentOffsetLimit:function(){var f=this._textValue.length;if(this._currOffsetLimit<this._offsetLimitsCount){f=this._offsetLimits[this._currOffsetLimit]}return f},_updateOffsetLimit:function(f){if(f===this._offsetLimits[this._currOffsetLimit]){this._currOffsetLimit++}},_fitChars:function(h,g){var j=this._position,i=this._position+1,f=i;while(i<g&&this._measureImpl(j,i)<=h){f=i;i++}return f},_fitWords:function(g,f){var h=this._wordIterator.current(),j=this._position,i=j;while(h&&(h.endIndex+1)<=f&&this._measureImpl(j,h.endIndex+1)<=g){i=h.endIndex+1;h=this._wordIterator.next()}if(h&&i!==j&&i!==f){if(h.beginIndex>f){i=f}else{i=h.beginIndex}}return i},_computeLeadingApproximation:function(f){return(f.ascent+f.descent)*0.2}}})}());(function(){b.mixin(b.text.LineBreakMeasurer,{_initImpl:function(e){this._font=e.cvGetFont();this._fontSize=e.fontSize();this.cvTextMeasurer=b.tree.canvas.getContext("2d")},_measureImpl:function(h,e){var f,g=this.cvTextMeasurer;g.save();g.font=this._font;f=g.measureText(this._textValue.substring(h,e));g.restore();return f.width},_createLineObjImpl:function(i,e,h){var f=this._textValue.substring(i,e),g=b.tree.cvTextMetrics(f,this._font);return{textValue:f,textBlockBeginIndex:i,textBlockEndIndex:e,lastWordTruncated:h,lineWidth:g.width,lineHeight:g.height,ascent:g.ascent,descent:g.descent,leading:0,userData:null}}})}());(function(){var e="FILTER_EVENT";b.declare({name:"oui.filters.AbstractFilter",isAbstract:true,mixins:[b.events.EventSupport],membersDef:{init:function(f){this._style=new this.Style();this.applyStyle(f)},applyStyle:function(f){var g=this._style.updateObject(f),h;if(this.shadowFilter){for(h in g){if(g.hasOwnProperty(h)){this._updateShadowFilter(h)}}}this.dispatchEvent({type:e})},_getFilteredBounds:function(f){return f},_getShadowFilter:function(){if(!this.shadowFilter){this.shadowFilter=this._createShadowFilter()}return this.shadowFilter},_createShadowFilter:function(){},_updateShadowFilter:function(f){}}});b.filters.FILTER_EVENT=e}());(function(){b.mixin(b.filters.AbstractFilter,{cvApplyFX:function(e,f){return e}})}());(function(){var e={RADIUS:"RADIUS"};b.declare({name:"oui.filters.Blur",extend:b.filters.AbstractFilter,membersDef:{_getFilteredBounds:function(g){var f=this._style.radius;return{x:g.x-f,y:g.y-f,width:g.width+2*f,height:g.height+2*f}},_styleTags:e}});b.addStyleSupport(b.filters.Blur,{radius:b.defs.FinitePositiveNumber(3,e.RADIUS)})}());(function(){var e=b.defs,f={COLOR:"COLOR",OPACITY:"OPACITY",RADIUS:"RADIUS",ANGLE:"ANGLE",OFFSET:"OFFSET",KNOCKOUT:"KNOCKOUT"};b.declare({name:"oui.filters.DropShadow",extend:b.filters.AbstractFilter,membersDef:{_getFilteredBounds:function(i){var h=this._style,k=h.angle*Math.PI/180,j=h.offset,g=h.radius;return b.geom.unionRect(i,{x:i.x+j*Math.cos(k)-g,y:i.y+j*Math.sin(k)-g,width:i.width+2*g,height:i.height+2*g})},_styleTags:f},styleDef:{color:e.Color(b.black,f.COLOR),opacity:e.NumberInRange([0,1],0.5,f.OPACITY),radius:e.FinitePositiveNumber(2,f.RADIUS),angle:e.NumberInRange([0,360],45,f.ANGLE),offset:e.FinitePositiveNumber(2,f.OFFSET),knockout:e.Boolean(false,f.KNOCKOUT)}})}());(function(){b.mixin(b.filters.DropShadow,{isInGlobalSpace:true,cvApplyFX:function(h,e){var g,q,r=b.tree.cvPixelRatio,f=this._style,k=f.color,i=f.angle*Math.PI/180,m=f.offset*r,p=f.radius*r,l=m*Math.cos(i),j=m*Math.sin(i),o=Math.floor(e.x+l-p),n=Math.floor(e.y+j-p);g=b.tree.cvCreateBuffer(e.width,e.height);q=g.getContext("2d");q.translate(-o,-n);q.shadowColor="rgba(".concat(k.getRed(),",",k.getGreen(),",",k.getBlue(),",",(f.opacity*k.getOpacity()),")");q.shadowOffsetX=l;q.shadowOffsetY=j;q.shadowBlur=p;q.drawImage(h,o,n);if(f.knockout){q.globalCompositeOperation="destination-out";q.drawImage(h,o,n)}b.tree.cvDisposeBuffer(h);return g}})}());(function(){var e=b.defs,f={STRENGTH:"STRENGTH",COLOR:"COLOR",OPACITY:"OPACITY"};b.declare({name:"oui.filters.Glow",extend:b.filters.AbstractFilter,membersDef:{_getFilteredBounds:function(g){var h=this._style.strength;return{x:g.x-h,y:g.y-h,width:g.width+2*h,height:g.height+2*h}},_styleTags:f}});b.addStyleSupport(b.filters.Glow,{color:e.Color(b.white,f.COLOR),strength:e.FinitePositiveNumber(3,f.STRENGTH)})}());(function(){b.mixin(b.filters.Glow,{isInGlobalSpace:true,cvApplyFX:function(i,e){var g,l,f=this._style,j=f.color,h=f.strength*b.tree.cvPixelRatio,m=Math.floor(e.x-h),k=Math.floor(e.y-h);g=b.tree.cvCreateBuffer(e.width,e.height);l=g.getContext("2d");l.translate(-m,-k);l.shadowColor="rgba(".concat(j.getRed(),",",j.getGreen(),",",j.getBlue(),",",j.getOpacity(),")");l.shadowBlur=h;l.drawImage(i,m,k);b.tree.cvDisposeBuffer(i);return g}})}());(function(){b.mixin(b.filters,{NONE:null,BLUR:new b.filters.Blur(),DROP_SHADOW:new b.filters.DropShadow(),DROP_SHADOW_KNOCKED_OUT:new b.filters.DropShadow({knockout:true}),_onLayoutDir:function(e){var f=e===b.LTR?45:135;b.filters.DROP_SHADOW.setAngle(f);b.filters.DROP_SHADOW_KNOCKED_OUT.setAngle(f)}})}());(function(){var f=b.scene.AbstractNode.prototype,e=b.defs,g=b.TAGS;b.declare({name:"oui.graphics.AbstractGraphicNode",isAbstract:true,extend:b.scene.AbstractNode,mixins:[b.lang.BindingSupport,b.anim.EffectsSupport],membersDef:{init:function(h,i){f.init.call(this,i);this._globalTxf=undefined;this._globalTxfInv=undefined;this._layoutDirty=true;this._layoutPosDirty=true;this._layoutBox=undefined;this._prevLayoutBox=undefined;this._filterFX=null;this._ctrlPts=[];this._style=new this.Style();this._style.transform=new b.geom.Matrix();this._txf=this._style.transform;if(h){this.styleBinding=h.styleBinding;this.dataBinding=h.dataBinding;this.resourcesBinding=h.resourcesBinding}this.applyStyle(h)},notifyNative:function(i){var h=this.parentNode;if(i===g.TRANSFO){this.clearGlobalTransformMatrix();if(h&&this.preventParentInvalidateLayout!==true){h._clearCtrlPts();h.invalidateLayout()}}else{if(i===g.LAYOUT_DIR){this._onLayoutDirChanged();if(b.isA(this._style.tooltip,b.graphics.AbstractGraphicNode)){this._style.tooltip.notifyChildren(i)}}}f.notifyNative.call(this,i)},_onParentChanged:function(){this.clearGlobalTransformMatrix();f._onParentChanged.call(this)},_onChildrenChanged:function(){this._clearCtrlPts();this.invalidateLayout();f._onChildrenChanged.call(this)},onPropertyChanged:function(){},onStyleChanged:function(h){if(h===b.DEFAULT_TAG){this.onPropertyChanged()}else{if(h===g.VISIBILITY||h===g.SENSITIVITY||h===g.DESC){this.notifyNative(h)}else{if(h===g.LAYOUT||h===g.PREF_SIZE){this.invalidateLayout()}else{if(h===g.DISPLAY||h===g.CLIP){this._clearCtrlPts();this.invalidateLayout();this.notifyNative(h)}else{if(h===g.FILTER){this._updateFilterFX();this.notifyNative(h)}else{if(h===g.CURSOR){this._onCursorChanged();this.notifyNative(h)}else{if(h===g.TRANSFO_SET){this._style.transform=this._style.transform.clone();this._txf=this._style.transform;this.notifyNative(g.TRANSFO)}}}}}}}},applyStyle:function(h){var i,j;if(h){i=this._style.updateObject(h);for(j in i){if(i[j]===true){this.onStyleChanged(j)}}}},applyStyleBinding:function(j,i,h){this._applyBinding(j,i,"styleBinding","styleBindingScope",this.applyStyle,h)},applyDataBinding:function(j,i,h){this._applyBinding(j,i,"dataBinding","dataBindingScope",this.applyStyle,h)},applyResourcesBinding:function(j,i,h){this._applyBinding(j,i,"resourcesBinding","resourcesBindingScope",this.applyStyle,h)},requestFocus:function(){if(b.focusManager){b.focusManager.requestFocus(this)}},getDefaultDragAction:function(){return function(h){var i=h.target;if(i&&i.draggable()){i.translate(h.dragUserX,h.dragUserY)}}},translate:function(i,h){if(i!==0||h!==0){this._txf.translate(i,h);this.notifyNative(g.TRANSFO)}return this},scale:function(i,h){this._txf.scale(i,h);this.notifyNative(g.TRANSFO);return this},rotate:function(j,h,k){var i=j/180*Math.PI;this._txf.rotate(i,h,k);this.notifyNative(g.TRANSFO);return this},setTranslation:function(h,i){if(b.isFiniteNumber(h)&&b.isFiniteNumber(i)){this._setTranslation(h,i)}},_setTranslation:function(h,j){var i=this._txf;if(i.tx!==h||i.ty!==j){i.tx=h;i.ty=j;this.notifyNative(g.TRANSFO)}},getTranslation:function(){return{x:this._txf.tx,y:this._txf.ty}},resetTransform:function(){this._style.transform=b.geom.Matrix.IDENTITY.clone();this._txf=this._style.transform;this.notifyNative(g.TRANSFO)},getTransformMatrix:function(){return this._txf.clone()},setTransformMatrix:function(h){this._txf.set(h);this.notifyNative(g.TRANSFO)},getGlobalTransformMatrix:function(){return this._safeGetGlobalTxf().clone()},getGlobalTransformMatrixInv:function(){return this._safeGetGlobalTxfInv().clone()},_safeGetGlobalTxfInv:function(){if(!this._globalTxfInv){this._globalTxfInv=this._safeGetGlobalTxf().inv()}return this._globalTxfInv},_safeGetGlobalTxf:function(){var h=this._globalTxf;if(!h){if(this.parentNode){h=this.parentNode._safeGetGlobalTxf();if(!this._txf.isIdentity()){h=h.clone();h._concat(this._txf)}}else{h=this._txf}this._globalTxf=h}return h},clearGlobalTransformMatrix:function(h){var i;if(this._globalTxf||this._globalTxfInv){this._globalTxf=undefined;this._globalTxfInv=undefined;i=this.firstChild;while(i){i.clearGlobalTransformMatrix(true);i=i.nextSibling}}this._clearGlobalTxfImpl(h)},_clearGlobalTxfImpl:function(h){},_transformCtrlPts:function(i,j){var h=this._getCtrlPts(j);if(h.length>0){if(j===b._BoundsType.RENDER){h=this._filterCtrlPts(h)}h=this._clipCtrlPts(h);if(i&&!i.isIdentity()){h=i.transformAll(h,[])}}return h},_filterCtrlPts:function(i){var h=i,k=this._filterFX,j;if(k){if(k.isInGlobalSpace){h=this._safeGetGlobalTxf().transformAll(i,[])}j=b.geom.computeBounds(h);j=this._filterFX._getFilteredBounds(j);h=b.geom.getBoxCtrlPts(j.x,j.y,j.width,j.height);if(k.isInGlobalSpace){h=this._safeGetGlobalTxfInv().transformAll(h)}}return h},_clipCtrlPts:function(i){var h=i,k=this._style.clip,j;if(k[2]>=0&&k[3]>=0){j=b.geom.computeBounds(h);j=b.geom.intersectRect(j,{x:k[0],y:k[1],width:k[2],height:k[3]});if(j){h=b.geom.getBoxCtrlPts(j.x,j.y,j.width,j.height)}else{h=[]}}return h},getLayoutBounds:function(i){this.layout();var h=this._txf;if(i&&i.getGlobalTransformMatrixInv){h=i.getGlobalTransformMatrixInv();h._concat(this._safeGetGlobalTxf())}return this._getBoundsImpl(h,b._BoundsType.LAYOUT)},getLocalBounds:function(){if(!this._localBoundsCache){this._localBoundsCache=b.geom.computeBounds(this._clipCtrlPts(this._getCtrlPts(b._BoundsType.RENDER)))}return this._localBoundsCache},_getBoundsImpl:function(h,i){return b.geom.computeBounds(this._transformCtrlPts(h,i))},getTransformToNode:function(k){var i=new b.geom.Matrix(),j,h;if(b.isA(k,b.graphics.AbstractGraphicNode)){j=this.getGlobalTransformMatrix();h=k.getGlobalTransformMatrixInv();i.concat(h);i.concat(j)}return i},_getCtrlPts:function(j){var h,i=this._ctrlPts;if(j!==b._BoundsType.LAYOUT||this._style.display){j=this._fixBoundsType(j);if(!i[j]){i[j]=this._computeCtrlPts(j)}h=i[j]}else{h=[]}return h},_fixBoundsType:function(h){return h},_clearCtrlPts:function(){this._ctrlPts.length=0;this._localBoundsCache=undefined;var h=this.parentNode;if(h&&h._ctrlPts.length>0){h._clearCtrlPts()}},localToGlobal:function(h,i){return this._safeGetGlobalTxf().transform(h,i)},globalToLocal:function(h,i){return this._safeGetGlobalTxfInv().transform(h,i)},hitTest:function(i,k){var h=null,j=this._style;if(j.display&&j.visibility&&j.pointerSensitivity){h=this._hitTest(i,k)}return h},_hitTest:function(h,j){var i=this.globalToLocal(h,j);return this._isWithinBounds(i.x,i.y)?this:null},_isWithinBounds:function(i,h,k){var j=this.getLocalBounds();if(typeof k!=="number"){k=0}return j!==undefined&&i>=j.x-k&&i<=j.x+j.width+k&&h>=j.y-k&&h<=j.y+j.height+k},_updateFilterFX:function(){if(!this._filterFXListener){this._filterFXListener=this._getFilterFXListener()}var h=this._style.filter,i=this._filterFX;if(i){i.removeEventListener(this._filterFXListener)}if(h){h.addEventListener(b.filters.FILTER_EVENT,this._filterFXListener)}this._filterFX=h},_getFilterFXListener:function(){var h=this;return function(){h.notifyNative(g.FILTER)}},_onCursorChanged:function(){var i=this,j=this._style.cursor,h;if(typeof j==="object"){this._customCursor=b.load(j.definition)}else{this._customCursor=null}if(this._customCursor){this._customCursor.setPointerSensitivity(false);if(!this._showCustomCursor){h=function(k){i._customCursor._setTranslation(k.clientX-j.hotspotX,k.clientY-j.hotspotY)};this._showCustomCursor=function(k){b.tree.userLayer.appendChild(i._customCursor);h(k);i.onMouseMove(h)};this._hideCustomCursor=function(){i.offMouseMove(h);b.tree.userLayer.removeChild(i._customCursor)}}this.onMouseOver(this._showCustomCursor);this.onMouseOut(this._hideCustomCursor)}else{this.offMouseOver(this._showCustomCursor);this.offMouseOut(this._hideCustomCursor)}},getPreferredLayoutBox:function(j){var i,l=this._style.display,h=this._style.layout,k;j=j||{};if(l){k=h.padding;if(h.preferredWidth>=0){j.width=h.preferredWidth}if(h.preferredHeight>=0){j.height=h.preferredHeight}if(j.width===undefined||j.height===undefined){i=this._getContentPreferredLayoutBox();if(j.width===undefined){j.width=i.width+k.lineBegin+k.lineEnd}if(j.height===undefined){j.height=i.height+k.top+k.bottom}}}else{j.width=0;j.height=0}return j},_getContentPreferredLayoutBox:function(){this.layout();var i={width:0,height:0},h=this._getBoundsImpl(this._txf,b._BoundsType.LAYOUT);if(h){i.width=h.width;i.height=h.height}return i},setLayoutBox:function(i,m,l,h){var k=this._style.layout.padding.lineBegin,j=this._style.layout.padding.top;if(b.layoutDir===b.RTL){k=this._style.layout.padding.lineEnd}this._layoutBox={x:i+k,y:m+j,width:l-this._style.layout.padding.lineBegin-this._style.layout.padding.lineEnd,height:h-j-this._style.layout.padding.bottom};if(this._layoutBox.width<0){this._layoutBox.width=0}if(this._layoutBox.height<0){this._layoutBox.height=0}if(!this._layoutDirty){if(!this._prevLayoutBox){this._layoutDirty=true}else{if(this._prevLayoutBox.width!==this._layoutBox.width||this._prevLayoutBox.height!==this._layoutBox.height){this._layoutDirty=true}else{if(this._prevLayoutBox.x!==this._layoutBox.x||this._prevLayoutBox.y!==this._layoutBox.y){this._layoutPosDirty=true}}}}this._prevLayoutBox=this._layoutBox;this.layout()},layout:function(){if(!this._layingOut){if(this._layoutDirty){this._layingOut=true;if(this._style.display){this._safeLayout()}this._layoutDirty=false;this._layoutPosDirty=false;this._layingOut=false}else{if(this._layoutPosDirty){this._layingOut=true;if(this._style.display){this._positionInLayoutBox()}this._layoutPosDirty=false;this._layingOut=false}}}},_safeLayout:function(){},_positionInLayoutBox:function(){var l=this._txf,j=this._layoutBox,k=this._style.layout,o,n,m,p,i,h;if(j){m=k.hAlign;i=l.tx;h=l.ty;p=this._getBoundsImpl(l,b._BoundsType.LAYOUT)||{x:i,y:h,width:0,height:0};if(k.xAnchor<0){o=k.hAlign}else{o=k.xAnchor}if(b.layoutDir===b.RTL){o=1-o;m=1-m}o*=p.width;if(k.yAnchor<0){n=k.vAlign}else{n=k.yAnchor}n*=p.height;this._setTranslation(i-o-p.x+j.x+m*j.width,h-n-p.y+j.y+k.vAlign*j.height)}},invalidateLayout:function(){if(this._layingOut!==true&&this._layoutDirty!==true){this._layoutDirty=true;this._layoutPosDirty=true;this._layoutBox=undefined;this._prevLayoutBox=undefined;if(this._ctrlPts.length>0){this._clearCtrlPts()}if(this.parentNode&&this.preventParentInvalidateLayout!==true){this.parentNode.invalidateLayout()}}},_onLayoutDirChanged:function(){this.invalidateLayout()}},eventsDef:[b.MouseEvents,b.KeyEvents,b.DragEvents,b.TouchEvents,b.GenericGestureEvents,b.GestureEvents,b.UIEvents]});b.addStyleSupport(b.graphics.AbstractGraphicNode,{transform:e.Matrix(b.geom.Matrix.IDENTITY,g.TRANSFO_SET),clip:e.ArrayOfType({type:Number},4,4,[0,0,-1,-1],g.CLIP,true),cursor:e.Cursor(b.CursorType.AUTO,g.CURSOR),description:e.String("",g.DESC),display:e.Boolean(true,g.DISPLAY),draggable:e.Boolean(false),filter:e.FilterEffect(null,g.FILTER),focusable:e.Boolean(false,g.FOCUSABLE),focusOutlineOffset:e.Number(2),layout:{hAlign:e.NumberInRange([0,1],b.NodeAlign.CENTER,g.LAYOUT),vAlign:e.NumberInRange([0,1],b.NodeAlign.CENTER,g.LAYOUT),hWeight:e.FinitePositiveNumber(0,g.LAYOUT),vWeight:e.FinitePositiveNumber(0,g.LAYOUT),xAnchor:e.FiniteNumber(-1,g.LAYOUT),yAnchor:e.FiniteNumber(-1,g.LAYOUT),padding:e.Padding(0,0,0,0,g.LAYOUT),preferredWidth:e.FiniteNumber(-1,g.PREF_SIZE),preferredHeight:e.FiniteNumber(-1,g.PREF_SIZE),isLayoutChild:e.Boolean(true,g.LAYOUT)},pointerSensitivity:e.Boolean(true,g.SENSITIVITY),tooltip:e.ObjectOfConstraint([function(h){return b.isA(h,String)||b.isA(h,b.graphics.AbstractGraphicNode)}],null,true,false),visibility:e.Boolean(true,g.VISIBILITY),cacheAsBitmap:e.Boolean(false)})}());(function(){var e=b.TAGS;b.mixin(b.graphics.AbstractGraphicNode,{notifyNativeImpl:function(g,f){if(g===e.CURSOR){if(this===b.events.cvGetLastTarget()){b.events.cvSetCursor(this)}}else{if(g!==e.SENSITIVITY&&g!==e.DESC){if(g!==e.TRANSFO){this.cvClearBuffer(!f)}if(!f){b.tree.cvMarkAsDirty(this)}}}},_clearGlobalTxfImpl:function(f){this.cvClearBuffer(!f)},cvPaint:function(m,n){var g=this._style,o,k,l,q,f,i,h=this._filterFX,j,p=b.tree.cvPixelRatio,r=true;if(this.cvIsInView()){q=this._safeGetGlobalTxf();f=this._getBoundsImpl(q,b._BoundsType.RENDER);if(f){r=false;n=b.geom.intersectRect(f,n,true);if(n){m.save();k=this.cvUseBuffer();if(k){i={x:Math.floor(f.x*p),y:Math.floor(f.y*p)}}l=this.cvBuffer;if(!l){if(k){i.width=Math.ceil(f.width*p);i.height=Math.ceil(f.height*p);l=b.tree.cvCreateBuffer(i.width,i.height);o=l.getContext("2d");o.translate(-i.x,-i.y);o.scale(p,p);o.transform(q.a,q.b,q.c,q.d,q.tx,q.ty)}else{o=m;q=this._txf;o.transform(q.a,q.b,q.c,q.d,q.tx,q.ty)}j=g.clip;if(j[2]>=0&&j[3]>=0){o.beginPath();o.rect(j[0],j[1],j[2],j[3]);o.clip()}this.cvPaintSelf(o,n);if(h){l=h.cvApplyFX(l,i)}this.cvBuffer=l}if(l){q=this.parentNode._safeGetGlobalTxfInv();m.transform(q.a,q.b,q.c,q.d,q.tx,q.ty);m.scale(1/p,1/p);this.cvPaintBuffer(m,l,i.x,i.y)}m.restore();this.cvLastDrawBounds=f}}}if(r){this.cvLastDrawBounds=undefined}},cvIsInView:function(){return this._style.display&&this._style.visibility},cvUseBuffer:function(){return(this._filterFX!==null)||this._style.cacheAsBitmap},cvClearBuffer:function(f){if(this.cvBuffer){b.tree.cvDisposeBuffer(this.cvBuffer);this.cvBuffer=undefined;b.tree.cvMarkAsDirty(this)}if(f&&this.parentNode){this.parentNode.cvClearBuffer(f)}},cvPaintSelf:function(){},cvPaintBuffer:function(g,h,f,i){g.drawImage(h,f,i)}})}());(function(){var f=b.graphics.AbstractGraphicNode.prototype,e=b.defs,g=b.TAGS;b.declare({name:"oui.graphics.AbstractShape",isAbstract:true,extend:b.graphics.AbstractGraphicNode,membersDef:{onStyleChanged:function(h){if(h===g.PAINT){this.notifyNative(h)}else{if(h===g.GEOM){this._clearCtrlPts();this.invalidateLayout();this.notifyNative(h)}else{f.onStyleChanged.call(this,h)}}},_fixBoundsType:function(i){var h=this._style;if(i===b._BoundsType.LAYOUT||(i===b._BoundsType.RENDER&&(h.stroke===b.NO_PAINT||h.strokeThickness===0))){i=b._BoundsType.DEFAULT}return i},getFillBounds:function(){return b.geom.computeBounds(this._clipCtrlPts(this._getCtrlPts(b._BoundsType.DEFAULT)))},_isValidChild:function(){return false},_safeLayout:function(){this._positionInLayoutBox()},_hitTest:function(i,m){var h=null,j=this._style,l=true,k;if(j.fill!==b.NO_PAINT){k=this.globalToLocal(i,m);if(this.hitTestOnFill(k.x,k.y)){h=this}else{l=false}}if(!h&&j.stroke!==b.NO_PAINT&&j.strokeThickness>0){k=k||this.globalToLocal(i,m);if(this.hitTestOnStroke(k.x,k.y,l)){h=this}}return h},hitTestOnFill:function(i,h){return false},hitTestOnStroke:function(j,i,h){return false}},styleDef:{htmlExportClassName:e.String(""),fill:e.Paint(b.black,g.PAINT),fillOpacity:e.NumberInRange([0,1],1,g.PAINT),fixedStrokeWidth:e.Boolean(false,g.PAINT),snapToGrid:e.Boolean(true,g.PAINT),stroke:e.Paint(b.NO_PAINT,g.PAINT),strokeOpacity:e.NumberInRange([0,1],1,g.PAINT),strokeThickness:e.FinitePositiveNumber(1,g.PAINT),strokeLineJoin:e.Enum(b.LineJoin,b.LineJoin.MITER,g.PAINT),strokeLineCap:e.Enum(b.LineCap,b.LineCap.BUTT,g.PAINT),strokeMiterLimit:e.FinitePositiveNumber(3,g.PAINT),strokeDashArray:e.ArrayOfType(e.StrictlyPositiveNumber(1),undefined,undefined,[],g.PAINT)}})}());(function(){var e=b.graphics.AbstractGraphicNode.prototype;b.mixin(b.graphics.AbstractShape,{notifyNativeImpl:function(h,f){var g=this._style;if(h===b.TAGS.PAINT){this.cvCheckPatternPaint(g.fill,"_cvPatternFill");this.cvCheckPatternPaint(g.stroke,"_cvPatternStroke")}e.notifyNativeImpl.call(this,h,f)},cvIsInView:function(){var f=this._style;return e.cvIsInView.call(this)&&((f.fill!==b.NO_PAINT&&f.fillOpacity>0)||(f.stroke!==b.NO_PAINT&&f.strokeOpacity>0&&f.strokeThickness>0))},cvSetFill:function(g){var f=this._style;g.globalAlpha=f.fillOpacity;g.fillStyle=f.fill.cvToStyle(this.getFillBounds(),g)},cvSetStroke:function(g){var f=this._style;g.globalAlpha=f.strokeOpacity;g.strokeStyle=f.stroke.cvToStyle(this.getLocalBounds(),g);g.lineWidth=f.strokeThickness;g.lineCap=f.strokeLineCap;g.lineJoin=f.strokeLineJoin;g.miterLimit=f.strokeMiterLimit;if(g.setLineDash){g.setLineDash(f.strokeDashArray)}},cvGetPatternReadyCallback:function(){var f=this;if(!this.cvPatternReadyCallback){this.cvPatternReadyCallback=function(){b.tree.cvMarkAsDirty(f)}}return this.cvPatternReadyCallback},cvCheckPatternPaint:function(h,g){var f=this[g];if(f&&f!==h){f.offPatternReady(this.cvGetPatternReadyCallback());this[g]=undefined}if(h.onPatternReady&&h!==f){h.onPatternReady(this.cvGetPatternReadyCallback());this[g]=h}}})}());(function(){var h="move",k="close",o="line",l="curve",j="quad",q=b.geom.DEG_TO_RAD,m=Math.PI/2,s={M:"moveTo",L:"lineTo",H:"horizontalLineTo",V:"verticalLineTo",Q:"quadTo",T:"smoothQuadTo",C:"curveTo",S:"smoothCurveTo",Z:"closePath",A:"arc",aM:"arcMoveTo",aL:"arcLineTo"},n,i={},f,g;b.graphics.PathType={MOVE_TO:h,CLOSE:k,LINE_TO:o,CURVE_TO:l,QUAD_TO:j};b.declare({name:"oui.graphics.PathCommands",mixins:[b.events.EventSupport],eventsDef:{DATA_UPDATE:"dataUpdate"},membersDef:{init:function(t,p){this._preventEvents=false;this.set(t,p)},_dispatchDataUpdate:function(){if(!this._preventEvents){this.dispatchEvent({type:this.events.DATA_UPDATE})}},set:function(t,p){this._preventEvents=true;this.resetPath();this._preventEvents=false;if(b.isA(t,String)){this._parseString(t,p)}this._dispatchDataUpdate()},resetPath:function(){this.dataTypes=[];this.dataValues=[];this.x=0;this.y=0;this.lastMX=0;this.lastMY=0;this.lastQX=0;this.lastQY=0;this.lastCX=0;this.lastCY=0;this._hasCubics=false;this._hasQuads=false;this._dispatchDataUpdate()},toString:function(A,D,v){var u=this.dataTypes,t=this.dataValues,C,w=u.length,E=[],B=0,I=(A===true)?" ":"",H,G="Z",x="M",y="L",p="Q",F="C";if(typeof D==="function"){H=D}else{if(typeof D==="number"){H=function(z){return z.toFixed(D)}}else{H=function(z){return z}}}if(v){G=v.CLOSE;x=v.MOVE_TO;y=v.LINE_TO;p=v.QUAD_TO;F=v.CURVE_TO}for(C=0;C<w;C++){switch(u[C]){case k:B+=2;E.push(G,I);break;case h:E.push(x,I,H(t[B++]),",",H(t[B++]),I);break;case o:E.push(y,I,H(t[B++]),",",H(t[B++]),I);break;case j:E.push(p,I,H(t[B++]),",",H(t[B++])," ",H(t[B++]),",",H(t[B++]),I);break;case l:E.push(F,I,H(t[B++]),",",H(t[B++])," ",H(t[B++]),",",H(t[B++])," ",H(t[B++]),",",H(t[B++]),I);break;default:break}}return b.trim(E.join(""))},isPointInPath:function(t,v,u){var p=this._countXings(t,v);if(u===b.WindingRuleEnum.NON_ZERO){p=(p!==0)}else{p=(p%2)!==0}return p},_isPointOnStrokedPath:function(I,G,F){var E=false,H=this.flatten(),A=H.dataTypes,u=H.dataValues,D,B=A.length,C=0,K=F*F,z=b.geom.ptSegDistSq,J,w,t,v,p;for(D=0;D<B&&!E;D++){J=A[D];if(J===h){v=u[C++];p=u[C++];E=(I===v&&G===p)}else{w=u[C++];t=u[C++];E=z(v,p,w,t,I,G)<K;v=w;p=t}}return E},_getStrokeCtrlPts:function(R){var ae=[],F=this.flatten(),z=F.dataTypes,y=F.dataValues,Z,Y=z.length,I,E=0,ah,ag,B,A,ac,ab,aa,v,p,V,U,af,X,ad,W,O,K,N,J,w,aj,t,ai,T,Q,S,P,M,H,L,G,D,x,C,u;for(Z=0;Z<Y;Z++){I=z[Z];if(I===h){w=aj=t=ai=T=Q=S=P=M=H=L=G=D=x=C=u=undefined;B=ac=y[E++];A=ab=y[E++];ae.push(B,A)}else{if(I===k){ah=ac;ag=ab}else{ah=y[E++];ag=y[E++]}v=ah-B;p=ag-A;V=R;if(v!==0||p!==0){U=v!==0?p/v:Number.POSITIVE_INFINITY;U=U>0?1:-1;V=V/Math.sqrt(v*v+p*p);v=U*v*V;p=U*p*V;af=B-p;X=A+v;ad=ah-p;W=ag+v;O=ah+p;K=ag-v;N=B+p;J=A-v;ae.push(af,X,ad,W,O,K,N,J);if(w!==undefined){ae.push.apply(ae,b.geom.intersectLine(af,X,ad,W,w,aj,t,ai));ae.push.apply(ae,b.geom.intersectLine(af,X,ad,W,T,Q,S,P));ae.push.apply(ae,b.geom.intersectLine(O,K,N,J,w,aj,t,ai));ae.push.apply(ae,b.geom.intersectLine(O,K,N,J,T,Q,S,P))}w=af;aj=X;t=ad;ai=W;T=O;Q=K;S=N;P=J}if(I===k&&M!==undefined){ae.push.apply(ae,b.geom.intersectLine(w,aj,t,ai,M,H,L,G));ae.push.apply(ae,b.geom.intersectLine(w,aj,t,ai,D,x,C,u));ae.push.apply(ae,b.geom.intersectLine(T,Q,S,P,M,H,L,G));ae.push.apply(ae,b.geom.intersectLine(T,Q,S,P,D,x,C,u))}B=ah;A=ag;if(aa===h){M=af;H=X;L=ad;G=W;D=O;x=K;C=N;u=J}}aa=I}return ae},flatten:function(x,t){var C,u,p,B,v,z,w,y,A;if(this._hasCubics||this._hasQuads){C=new b.graphics.PathCommands();if(typeof x!=="number"){x=5}u=this.dataTypes;p=this.dataValues;v=u.length;for(B=0,y=0,A=[];B<v;B++){switch(u[B]){case k:y+=2;C.closePath();break;case h:C._M(p[y++],p[y++]);break;case o:C._L(p[y++],p[y++]);break;case j:b.geom.flattenQuad(p[y-2],p[y-1],p[y++],p[y++],p[y++],p[y++],A,x,t);z=0;w=A.length;while(z<w){C._L(A[z++],A[z++])}A.length=0;break;case l:b.geom.flattenCubic(p[y-2],p[y-1],p[y++],p[y++],p[y++],p[y++],p[y++],p[y++],A,x,t);z=0;w=A.length;while(z<w){C._L(A[z++],A[z++])}A.length=0;break;default:break}}}else{C=this}return C},snap:function(D,v,E){var w=this.dataTypes,t=this.dataValues,I,H,u,p,G,F,C,J,B,A,z=w.length;if(typeof E!=="number"){E=0}if(v){C=v.inv()}for(B=0,A=0;B<z;B++){switch(w[B]){case h:case k:u=t[A++];p=t[A++];break;case o:I=G=t[A++];H=F=t[A++];if(v){J=v.transform(u,p);u=J.x;p=J.y;J=v.transform(I,H);I=J.x;H=J.y}if(Math.abs(I-u)<=E){if(D===true){u=Math.floor(u)+0.5}else{if(Math.floor(u)!==u){u=Math.round(u)}}if(C){t[A-4]=C.a*u+C.c*p+C.tx;t[A-2]=C.a*u+C.c*H+C.tx}else{t[A-4]=t[A-2]=u}}if(Math.abs(H-p)<=E){if(D===true){p=Math.floor(p)+0.5}else{if(Math.floor(p)!==p){p=Math.round(p)}}if(C){t[A-3]=C.b*u+C.d*p+C.ty;t[A-1]=C.b*I+C.d*p+C.ty}else{t[A-3]=t[A-1]=p}}u=G;p=F;break;case j:A+=2;u=t[A++];p=t[A++];break;case l:A+=4;u=t[A++];p=t[A++];break;default:break}}this._dispatchDataUpdate()},cubicify:function(){var v=this.dataTypes,t=this.dataValues,p,w=0,x=v.length,u;if(this._hasQuads){for(p=0;p<x;p++){switch(v[p]){case h:case k:case o:w+=2;break;case j:u=b.geom.quad2Cubic(t[w-2],t[w-1],t[w],t[w+1],t[w+2],t[w+3]);v[p]=l;t.splice(w,2,u[0],u[1],u[2],u[3]);w+=6;break;case l:w+=6;break}}this._hasQuads=false;this._dispatchDataUpdate()}},closePath:function(){this.dataTypes.push(k);this.dataValues.push(this.lastMX,this.lastMY);this.x=this.lastMX;this.y=this.lastMY;this._dispatchDataUpdate();return this},_safeMoveTo:function(p,u,t){if(t===true){p+=this.x;u+=this.y}this.dataTypes.push(h);this.dataValues.push(p,u);this.x=p;this.y=u;this.lastMX=p;this.lastMY=u;this.lastQX=p;this.lastQY=u;this.lastCX=p;this.lastCY=u;return this},_safeLineTo:function(p,u,t){if(t===true){p+=this.x;u+=this.y}this.dataTypes.push(o);this.dataValues.push(p,u);this.x=p;this.y=u;this.lastQX=p;this.lastQY=u;this.lastCX=p;this.lastCY=u;return this},_safeHorizontalLineTo:function(p,t){if(t===true){p+=this.x}return this._safeLineTo(p,this.y,false)},_safeVerticalLineTo:function(t,p){if(p===true){t+=this.y}return this._safeLineTo(this.x,t,false)},_safeQuadTo:function(t,v,p,u,w){if(w===true){t+=this.x;v+=this.y;p+=this.x;u+=this.y}this.dataTypes.push(j);this.dataValues.push(t,v,p,u);this.x=p;this.y=u;this.lastQX=t;this.lastQY=v;this.lastCX=p;this.lastCY=u;this._hasQuads=true;return this},_safeSmoothQuadTo:function(p,u,w){var t,v;if(w===true){p+=this.x;u+=this.y}t=2*this.x-this.lastQX;v=2*this.y-this.lastQY;return this._safeQuadTo(t,v,p,u,false)},_safeCurveTo:function(v,x,t,w,p,u,y){if(y===true){v+=this.x;x+=this.y;t+=this.x;w+=this.y;p+=this.x;u+=this.y}this.dataTypes.push(l);this.dataValues.push(v,x,t,w,p,u);this.x=p;this.y=u;this.lastQX=p;this.lastQY=u;this.lastCX=t;this.lastCY=w;this._hasCubics=true;return this},_safeSmoothCurveTo:function(t,w,p,v,y){var u,x;if(y===true){t+=this.x;w+=this.y;p+=this.x;v+=this.y}u=2*this.x-this.lastCX;x=2*this.y-this.lastCY;return this._safeCurveTo(u,x,t,w,p,v,false)},_safeArc:function(t,y,u,p,x,w,v){if(v===true){t+=this.x;y+=this.y}u=u*q;p=p*q;this._arcImpl(t,y,u,p,x,w);return this},_arcImpl:function(x,w,v,t,u,p){var A,z=0.523598775598,y=0.506145483078356;if(t>v){while(t-v>z){A=v+y;this._smallArcACW(x,w,v,A,u,p);v=A}this._smallArcACW(x,w,v,t,u,p)}else{if(v>t){while(v-t>z){A=v-y;this._smallArcCW(x,w,v,A,u,p);v=A}this._smallArcCW(x,w,v,t,u,p)}}},_smallArcACW:function(z,y,x,u,w,t){var B=w*Math.cos(u),A=t*Math.sin(u),C=Math.tan((u-x)/2),D=u-m,v=B+w*C*Math.cos(D),p=A+t*C*Math.sin(D);this._safeQuadTo(v+z,p+y,B+z,A+y)},_smallArcCW:function(B,A,z,w,y,v){var D=y*Math.cos(w),C=v*Math.sin(w),u=y*Math.cos(z),p=v*Math.sin(z),E=Math.tan((z-w)/2),F=(z-m),x=u+y*E*Math.cos(F),t=p+v*E*Math.sin(F);this._safeQuadTo(x+B,t+A,D+B,C+A)},_safeArcMoveTo:function(p,y,x,w,v,u){var t=x*q;return this._safeMoveTo(p+w*Math.cos(t),y+v*Math.sin(t),u)},_safeArcLineTo:function(p,y,x,w,v,u){var t=x*q;return this._safeLineTo(p+w*Math.cos(t),y+v*Math.sin(t),u)},_countXings:function(G,F){var E=b.geom,v=this.dataTypes,t=this.dataValues,w=v.length,A,B=0,u=0,p=0,I=0,H=0,z=0,D=false,C;for(C=0;C<w;C++){A=v[C];switch(A){case h:if(C>0&&v[C-1]!==k){z+=E.crossLine(u,p,I,H,G,F)}I=u=t[B++];H=p=t[B++];break;case k:case o:z+=E.crossLine(u,p,t[B++],t[B++],G,F);u=t[B-2];p=t[B-1];break;case j:z+=E.crossQuad(u,p,t[B++],t[B++],t[B++],t[B++],G,F);u=t[B-2];p=t[B-1];break;case l:z+=E.crossCubic(u,p,t[B++],t[B++],t[B++],t[B++],t[B++],t[B++],G,F);u=t[B-2];p=t[B-1];break}if(u===G&&p===F){z=0;D=true;break}}if(!D&&A!==k){z+=E.crossLine(u,p,I,H,G,F)}return z},_parseString:function(u,v){var t=0,y,x,z,w,p=Number;y=u.replace(/^\s+|\s+$/g,"").replace(/([mlhvcsqtz])/gi,",$1,").replace(/\s+/g,",").replace(/,{2,}/g,",").replace(/^,|,$/g,"").split(",");x=y.length;if(v===true){p=function(B){var A=Number(B);if(isNaN(A)){c.error("ERR__PATH__MALFORMED_DATA",y.slice(0,t).join(" "))}return A}}while(t<x){z=y[t++];w=false;switch(z){case"m":w=true;case"M":this._safeMoveTo(p(y[t++]),p(y[t++]),w);while(!isNaN(Number(y[t]))&&t<x){this._safeLineTo(p(y[t++]),p(y[t++]),w)}break;case"l":w=true;case"L":do{this._safeLineTo(p(y[t++]),p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"h":w=true;case"H":do{this._safeHorizontalLineTo(p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"v":w=true;case"V":do{this._safeVerticalLineTo(p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"q":w=true;case"Q":do{this._safeQuadTo(p(y[t++]),p(y[t++]),p(y[t++]),p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"t":w=true;case"T":do{this._safeSmoothQuadTo(p(y[t++]),p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"c":w=true;case"C":do{this._safeCurveTo(p(y[t++]),p(y[t++]),p(y[t++]),p(y[t++]),p(y[t++]),p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"s":w=true;case"S":do{this._safeSmoothCurveTo(p(y[t++]),p(y[t++]),p(y[t++]),p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"a":w=true;case"A":if(v===true){c.error("ERR__PATH__NO_ARCTO")}break;case"z":case"Z":this.closePath();break;default:if(v===true){c.error("ERR__PATH__UNKNOWN_CMD",[z,t])}}}}}});function e(t){var p=t.length-1;return function(){var v=p-1,u=true;do{u=b.isFiniteNumber(arguments[v])}while(v--&&u);if(u){t.apply(this,arguments);this._dispatchDataUpdate()}return this}}n=b.graphics.PathCommands.prototype;for(g in n){if(n.hasOwnProperty(g)&&g.indexOf("_safe")===0){i[g.charAt(5).toLowerCase()+g.substr(6)]=e(n[g])}}b.mixin(b.graphics.PathCommands,i);function r(t,p){return function(){var u=[];u.push.apply(u,arguments);u[t.length-1]=p;return t.apply(this,u)}}for(g in s){if(s.hasOwnProperty(g)){i=s[g];f=n[i];n[g]=r(f,false);n[g.toLowerCase()]=r(f,true);g="_"+g;i="_safe"+i.charAt(0).toUpperCase()+i.substr(1);f=n[i]||f;n[g]=r(f,false);n[g.toLowerCase()]=r(f,true)}}}());(function(){var e=b.graphics.AbstractShape.prototype;b.declare({name:"oui.graphics.AbstractPath",isAbstract:true,extend:b.graphics.AbstractShape,membersDef:{init:function(f,g){this._flattenedPathCache=null;e.init.call(this,f,g)},onStyleChanged:function(f){if(f===b.TAGS.GEOM){this._flattenedPathCache=null}e.onStyleChanged.call(this,f)},_computeCtrlPts:function(h){var g=this.getFlattenedPathCommands(),f=[];if(g){f=b.geom.computeConvexHull(h?g._getStrokeCtrlPts(this._style.strokeThickness/2):g.dataValues)}return f},hitTestOnFill:function(h,g){var f=false,i=this.getFlattenedPathCommands();if(i&&this._isWithinBounds(h,g)){f=i.isPointInPath(h,g,this.getWindingRule())}return f},hitTestOnStroke:function(i,h,g){var f=false,k=this._style.strokeThickness/2,j=this.getFlattenedPathCommands();if(j&&this._isWithinBounds(i,h,k)){f=j._isPointOnStrokedPath(i,h,k)}return f},getPathCommands:function(){c.warn("WARN__PATH__NO_OVERRIDE");return null},getFlattenedPathCommands:function(){var f;if(!this._flattenedPathCache){f=this.getPathCommands();if(f){this._flattenedPathCache=f.flatten(10)}}return this._flattenedPathCache},getWindingRule:function(){return b.WindingRuleEnum.EVEN_ODD}}})}());(function(){var i=b.graphics.PathType,f=i.MOVE_TO,e=i.LINE_TO,g=i.QUAD_TO,h=i.CURVE_TO,j=i.CLOSE;b.mixin(b.graphics.AbstractPath,{cvPaintSelf:function(t,r){var s=this.getPathCommands(),p=0,m,l,q,o,k;if(s){m=s.dataTypes;l=s.dataValues;o=m.length;t.beginPath();for(q=0;q<o;q++){switch(m[q]){case f:t.moveTo(l[p++],l[p++]);break;case e:t.lineTo(l[p++],l[p++]);break;case g:t.quadraticCurveTo(l[p++],l[p++],l[p++],l[p++]);break;case h:t.bezierCurveTo(l[p++],l[p++],l[p++],l[p++],l[p++],l[p++]);break;case j:p+=2;t.closePath();break;default:c.error("ERR__CNV__INV_PATHDATA");break}}k=this._style;if(k.fill!==b.NO_PAINT){this.cvSetFill(t);t.fill()}if(k.stroke!==b.NO_PAINT){this.cvSetStroke(t);t.stroke()}}}})}());(function(){var h=b.graphics.AbstractPath.prototype,e=b.defs,i=b.TAGS,g={markerStart:0,markerEnd:1,markerMid:2},f="pathData";b.declare({name:"oui.graphics.Path",extend:b.graphics.AbstractPath,jsonDef:{type:"path"},membersDef:{init:function(j,k){var l=this;this._markers=[];this._initImpl();this._oldPC=null;this._dataUpdateHandler=function(){l._updateMarkerTxf("markerStart",g.markerStart);l._updateMarkerTxf("markerEnd",g.markerEnd);l.onStyleChanged(b.TAGS.GEOM)};h.init.call(this,j,k)},_initImpl:function(){},_computeCtrlPts:function(m){var k=h._computeCtrlPts.call(this,m),o=this._markers,j,l,p=0;if(k.length>0){for(l=0,p=o.length;l<p;l++){j=o[l];if(j){k.push.apply(k,j._transformCtrlPts(j._txf,m))}}}return p>0?b.geom.computeConvexHull(k):k},onStyleChanged:function(k){var p=this._style,m=p.pathCommands,l,q=this._markers,o,r,j;if(k===f){l=this._oldPC;if(l){l.offDataUpdate(this._dataUpdateHandler)}if(m){m.onDataUpdate(this._dataUpdateHandler)}this._oldPC=m;this._updateMarker("markerStart",g.markerStart);this._updateMarker("markerEnd",g.markerEnd);h.onStyleChanged.call(this,i.GEOM)}else{if(k===i.PAINT){for(o=0,r=q.length;o<r;o++){if(q[o]){q[o].applyStyle({fill:p.stroke,fillOpacity:p.strokeOpacity})}}h.onStyleChanged.call(this,k)}else{if(k===i.MARKER_START_DATA||k===i.MARKER_END_DATA){j=k.substring(0,k.length-4);this._updateMarker(j,g[j]);this.notifyNative(k)}else{if(k===i.MARKER_START||k===i.MARKER_END){this._updateMarkerTxf(k,g[k]);this.notifyNative(k)}else{if(k===i.MARKER_START_PAINT||k===i.MARKER_END_PAINT){j=k.substring(0,k.length-5);this._updateMarkerPaint(j,g[j]);this.notifyNative(k)}else{h.onStyleChanged.call(this,k)}}}}}},_updateMarker:function(k,j){var n=this._style,m=n[k],l=this._markers[j];if(m.d.length===0){this._markers[j]=undefined}else{if(!l){this._markers[j]=new b.graphics.Path({pathCommands:m.d})}else{l.applyStyle({pathCommands:m.d})}this._updateMarkerPaint(k,j);this._updateMarkerTxf(k,j)}},_updateMarkerTxf:function(o,w){var k=this._style[o],m=this._markers[w],t=this._style.pathCommands,j,l,v,r,q=0,p=0,z=k.strokeUnits?this._style.strokeThickness:1,u=k.orient;if(m&&t&&t.dataValues.length>=2){j=t.dataValues;l=j.length;if(w===g.markerStart){v=j[0];r=j[1];if(l>=4){q=j[2]-v;p=j[3]-r}}else{if(w===g.markerEnd){v=j[l-2];r=j[l-1];if(l>=4){q=v-j[l-4];p=r-j[l-3]}}}if(u===b.AUTO){u=Math.atan2(p,q)}else{u*=b.geom.DEG_TO_RAD}m.setTransform(new b.geom.Matrix().translate(v,r).rotate(u).scale(z*k.width,z*k.height).translate(-k.refX,-k.refY))}this._clearCtrlPts()},_updateMarkerPaint:function(k,j){var m=this._style,n={fill:m.stroke,fillOpacity:m.strokeOpacity,stroke:b.NO_PAINT},l=this._markers[j];if(l){b.merge(n,m[k].paint,true);l.applyStyle(n)}}},styleDef:{pathCommands:e.PathData(null,f),windingRule:e.Enum(b.WindingRuleEnum,b.WindingRuleEnum.EVEN_ODD,i.GEOM),markerStart:e.Marker("",0,0,1,1,b.AUTO,true,{},i.MARKER_START,i.MARKER_START_DATA,i.MARKER_START_PAINT),markerEnd:e.Marker("",0,0,1,1,b.AUTO,true,{},i.MARKER_END,i.MARKER_END_DATA,i.MARKER_END_PAINT)}})}());(function(){var e=b.graphics.AbstractPath.prototype;b.mixin(b.graphics.Path,{cvPaintSelf:function(o,k){var g=this._style.pathCommands,l=this._markers,f,j,h,m;e.cvPaintSelf.call(this,o,k);if(g&&g.dataTypes.length>0){for(h=0,m=l.length;h<m;h++){f=l[h];if(f){o.save();j=f._txf;o.transform(j.a,j.b,j.c,j.d,j.tx,j.ty);f.cvPaintSelf(o,k);o.restore()}}}}})}());(function(){var g=b.graphics.AbstractPath.prototype,e=b.defs,h=b.TAGS.GEOM,f;f=function(j,i){if(j>i){j=i}return j};b.declare({name:"oui.graphics.HalfRoundedRectangle",extend:b.graphics.AbstractPath,jsonDef:{type:"hrrect"},membersDef:{init:function(i,j){this._d=new b.graphics.PathCommands();g.init.call(this,i,j)},onStyleChanged:function(i){if(i===h){this._updatePath()}g.onStyleChanged.call(this,i)},getPathCommands:function(){return this._d},_onLayoutDirChanged:function(){this._updatePath();g._onLayoutDirChanged.call(this)},_updatePath:function(){var p=this._style,s=p.x,q=p.y,t=p.width,B=p.height,o=p.rx,m=p.ry,z=p.rounded,D=this._d,C=(b.layoutDir===b.LTR),n=!C,l=(C&&z.topLineBegin)||(n&&z.topLineEnd),i=(C&&z.topLineEnd)||(n&&z.topLineBegin),j=(C&&z.bottomLineBegin)||(n&&z.bottomLineEnd),E=(C&&z.bottomLineEnd)||(n&&z.bottomLineBegin),k=f(o,(l&&i)?t/2:t),A=f(m,(l&&j)?B/2:B),v=f(o,(j&&E)?t/2:t),u=f(m,(i&&E)?B/2:B);D.resetPath();if(l){D._M(s,q+A)._Q(s,q,s+k,q)}else{D._M(s,q)}if(i){D._L(s+t-k,q)._Q(s+t,q,s+t,q+u)}else{D._L(s+t,q)}if(E){D._L(s+t,q+B-u)._Q(s+t,q+B,s+t-v,q+B)}else{D._L(s+t,q+B)}if(j){D._L(s+v,q+B)._Q(s,q+B,s,q+B-A)}else{D._L(s,q+B)}D._Z()},hitTestOnFill:function(i,M){var I=this._style,z=i,v=M,B=I.width,H=I.height,t=I.rx,q=I.ry,p=I.x,E=I.y,u=E+H,K=p+B,A=false,F,J,s,o,k,j,L,m,G,D,C,n,l;if(z>=p&&z<=K&&v>=E&&v<=u){F=I.rounded;J=(b.layoutDir===b.LTR);s=!J;o=(J&&F.topLineBegin)||(s&&F.topLineEnd);k=(J&&F.topLineEnd)||(s&&F.topLineBegin);j=(J&&F.bottomLineBegin)||(s&&F.bottomLineEnd);L=(J&&F.bottomLineEnd)||(s&&F.bottomLineBegin);m=f(t,(o&&k)?B/2:B);G=f(q,(o&&j)?H/2:H);D=f(t,(j&&L)?B/2:B);C=f(q,(k&&L)?H/2:H);if(o&&(z<p+m)&&(v<E+G)){n=p+m;l=E+G;t=m;q=G}else{if(k&&(z>K-m)&&(v<E+C)){n=K-m;l=E+C;t=m;q=C}else{if(L&&(z>K-D)&&(v>u-C)){n=K-D;l=u-C;t=D;q=C}else{if(j&&(z<p+D)&&(v>u-G)){n=p+D;l=u-G;t=D;q=G}}}}if(n!==undefined&&l!==undefined){z=(i-n)/t;v=(M-l)/q;A=((z*z+v*v)<=1)}else{A=true}}return A}},styleDef:{x:e.FiniteNumber(0,h),y:e.FiniteNumber(0,h),width:e.PositiveNumber(0,h),height:e.PositiveNumber(0,h),rx:e.PositiveNumber(10,h),ry:e.PositiveNumber(10,h),rounded:{topLineBegin:e.Boolean(true,h),topLineEnd:e.Boolean(true,h),bottomLineBegin:e.Boolean(false,h),bottomLineEnd:e.Boolean(false,h)}}})}());(function(){var h=b.graphics.AbstractPath.prototype,e=b.defs,i=b.TAGS.GEOM,f=b.geom.DEG_TO_RAD;function g(j){if(j<0){j=360+j}return j}b.declare({name:"oui.graphics.DiskSector",extend:b.graphics.AbstractPath,jsonDef:{type:"diskSector"},membersDef:{init:function(j,k){this._d=new b.graphics.PathCommands();h.init.call(this,j,k)},onStyleChanged:function(j){if(j===i){this._updatePath()}h.onStyleChanged.call(this,j)},getPathCommands:function(){return this._d},_updatePath:function(){var k=this._style,o=this._d,j=k.cx,q=k.cy,n=k.minAngle,p=k.maxAngle,m=k.minRadius,l=k.maxRadius;o.resetPath();o._aM(j,q,n,l,l);o._A(j,q,n,p,l,l);if((p-n)<360){o._aL(j,q,p,m,m);if(m>0){o._A(j,q,p,n,m,m)}}else{if(m>0){o._Z();o._aM(j,q,p,m,m);o._A(j,q,p,n,m,m)}}o._Z()},hitTestOnFill:function(o,n){var k=this._style,s=false,r=o-k.cx,q=n-k.cy,p=Math.sqrt(r*r+q*q),l,j,m;if(p>=k.minRadius&&p<=k.maxRadius){l=k.minAngle;j=k.maxAngle;if(Math.abs(j-l)===360){s=true}else{m=Math.atan2(q,r)*180/Math.PI;m=(m+360)%360;if(l>j){l=j;j=k.minAngle}if(l<0&&j>=0){l=(l+360)%360;s=(m<=360&&m>=l)||m<=j}else{if(l<0&&j<0){l=(l+360)%360;j=(j+360)%360;s=m>=l&&m<=j}else{l=(l+360)%360;j=(j+360)%360;s=m>=l&&m<=j}}}}return s},getInsideGeomPath:function(M){var N=this._style,V=new b.graphics.PathCommands(),H=M/2,I=N.minAngle,O=N.maxAngle,n=N.minRadius,C=N.maxRadius,q,Z,l,w,u,v,B,T,k,K,Q,P,A,r,J,D,j,m,z,E,W,U,S,R,p,o,Y,X,G,F,L,y,x;if(n>C){n=C;C=N.minRadius}if(I>O){I=N.maxAngle;O=N.minAngle}q=f*(O-I);Z=Math.cos(q/2);l=Math.sin(q);w=N.cx;u=N.cy;v=Math.sin(f*I);B=Math.cos(f*I);T=Math.sin(f*O);k=Math.cos(f*O);K=0;if(l!==0){K=M*Z/l}Q=f*(I+(O-I)/2);P=w+K*Math.cos(Q);A=u+K*Math.sin(Q);r=n-K*Z+H;J=r+C-n-M;D=(J+r)/2;C-=H;n+=H;if(r<J){R={x:P+r*B,y:A+r*v};S={x:P+J*B,y:A+J*v};U={x:P+J*k,y:A+J*T};W={x:P+r*k,y:A+r*T};j=g(Math.atan2(R.y-u,R.x-w)/f);m=g(Math.atan2(W.y-u,W.x-w)/f);z=g(Math.atan2(S.y-u,S.x-w)/f);E=g(Math.atan2(U.y-u,U.x-w)/f);if(j>m){m+=360}if(z>E){E+=360}if((E-j)<q/f){if((m-j)>q/f){p=(U.x-W.x);o=(U.y-W.y);Y=(R.x-S.x);X=(R.y-S.y);G=(W.x-S.x);F=(W.y-S.y);L=(p*F-o*G)/(p*X-o*Y);y=S.x+L*Y;x=S.y+L*X;V._M(S.x,S.y)._L(y,x)._L(U.x,U.y);V._A(w,u,E,z,C,C);V._Z()}else{if(O-I<360){V._aM(P,A,O,D,D);V._aL(P,A,O,J,J);V._A(w,u,E,z,C,C);V._aL(P,A,I,r,r);if(n>H){V._A(w,u,j,m,n,n)}V._aL(P,A,O,D,D);V._Z()}else{V._aM(w,u,0,C,C);V._A(w,u,0,360,C,C);if(n>H){V._aM(w,u,360,n,n);V._A(w,u,360,0,n,n)}}}}}return V}},styleDef:{minAngle:e.FiniteNumber(0,i),maxAngle:e.FiniteNumber(360,i),minRadius:e.FinitePositiveNumber(0,i),maxRadius:e.FinitePositiveNumber(100,i),cx:e.Number(0,i),cy:e.Number(0,i)}})}());(function(){var e=b.graphics.AbstractGraphicNode.prototype;b.declare({name:"oui.graphics.Group",extend:b.graphics.AbstractGraphicNode,jsonDef:{type:"group",factory:function(h,j,g,i){var f=new b.graphics.Group(h,h.name);b.load(h.children,f,j,g,i);return f}},membersDef:{onStyleChanged:function(f){if(f===b.TAGS.OPACITY){this.notifyNative(f)}else{e.onStyleChanged.call(this,f)}},_computeCtrlPts:function(h){var f,i,g;if(h===b._BoundsType.LAYOUT){f=this._computeLayoutCtrlPts(h)}else{f=[];i=this.firstChild;while(i){g=i._transformCtrlPts(i._txf,h);f.push.apply(f,g);i=i.nextSibling}f=b.geom.computeConvexHull(f)}return f},_computeLayoutCtrlPts:function(h){var f=[],i=this.firstChild,g;while(i){if(i._style.layout.isLayoutChild){g=i._transformCtrlPts(i._txf,h);f.push.apply(f,g)}i=i.nextSibling}return b.geom.computeConvexHull(f)},_safeLayout:function(){var f=this.firstChild;while(f){f.layout();f=f.nextSibling}this._positionInLayoutBox()},_hitTest:function(g,j){var f=null,h=this.globalToLocal(g,j),i;if(this._isWithinBounds(h.x,h.y)){i=this.lastChild;while(i&&!f){f=i.hitTest(g,j);i=i.previousSibling}}return f}},styleDef:{opacity:b.defs.NumberInRange([0,1],1,b.TAGS.OPACITY)}})}());(function(){var e=b.graphics.AbstractGraphicNode.prototype;b.mixin(b.graphics.Group,{cvIsInView:function(){return e.cvIsInView.call(this)&&this.firstChild!==null},cvUseBuffer:function(){return e.cvUseBuffer.call(this)||this._style.opacity<1},cvPaintSelf:function(f,g){var h=this.firstChild;while(h){h.cvPaint(f,g);h=h.nextSibling}},cvPaintBuffer:function(g,h,f,i){if(this._style.opacity<1){g.globalAlpha=this._style.opacity}e.cvPaintBuffer.call(this,g,h,f,i)}})}());(function(){var f=b.graphics.AbstractGraphicNode.prototype,e=b.defs,g=b.TAGS;b.declare({name:"oui.graphics.Image",extend:b.graphics.AbstractGraphicNode,jsonDef:{type:"image"},membersDef:{init:function(h,i){this._srcWidth=0;this._srcHeight=0;this._actualWidth=0;this._actualHeight=0;f.init.call(this,h,i)},onStyleChanged:function(h){if(h===g.SRC){var i=this._style.src;if(this.prevRequest){b.resourcesManager.removeObserver(this.prevRequest,this);this.prevRequest=null}else{if(this.imageLoader){this.imageLoader.offComplete(this);this.imageLoader=null}}if(b.resourcesManager.hasResource(i)){b.resourcesManager.requestResource(i,this);this.prevRequest=i}else{this.imageLoader=new b.utils.ImageLoader();this.imageLoader.onComplete(this);this.imageLoader.load(i)}}else{if(h===g.GEOM){this._updateActualDimensions();this._clearCtrlPts();this.invalidateLayout();this.notifyNative(h)}else{if(h===g.OPACITY){this.notifyNative(h)}else{f.onStyleChanged.call(this,h)}}}},resourceUpdate:function(h){this._srcWidth=h.width;this._srcHeight=h.height;this._updateActualDimensions();this._resourceUpdateImpl(h)},handleEvent:function(h){this.resourceUpdate(h)},_resourceUpdateImpl:function(h){},_fixBoundsType:function(){return b._BoundsType.DEFAULT},_computeCtrlPts:function(){var h=this._style;return b.geom.getBoxCtrlPts(h.x,h.y,this._actualWidth,this._actualHeight)},_safeLayout:function(){this._positionInLayoutBox()},toDataURL:function(){var i,h=this._style.src;if(b.resourcesManager.hasResource(h)){i=b.resourcesManager._getBase64Data(h)}if(i===undefined){i=this._toDataURLImpl()}if(i===undefined){i=h}return i},_toDataURLImpl:function(){},_isValidChild:function(){return false},_updateActualDimensions:function(){var h=this._style,j=h.preserveAspectRatio,n=this._srcWidth,q=this._srcHeight,l=h.width,k=h.height,i=(l===b.AUTO)?n:l,p=(k===b.AUTO)?q:k,o,m;o=n>0?i/n:1;m=q>0?p/q:1;if(j===b.PreserveAspectRatioEnum.MIN){if(o<m){if(n>0){p=q*o}}else{if(q>0){i=n*m}}}else{if(j===b.PreserveAspectRatioEnum.MAX){if(o<m){if(q>0){i=n*m}}else{if(n>0){p=q*o}}}}if(this._actualWidth!==i||this._actualHeight!==p){this._actualWidth=i;this._actualHeight=p;this._clearCtrlPts();this.invalidateLayout()}}},styleDef:{src:{type:String,constraint:b.isStringNotEmpty,defaultValue:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAEklEQVR4nGNgGAWjYBSMAggAAAQQAAFVN1rQAAAAAElFTkSuQmCC",tag:g.SRC},x:e.FiniteNumber(0,g.GEOM),y:e.FiniteNumber(0,g.GEOM),width:e.Size(b.AUTO,g.GEOM),height:e.Size(b.AUTO,g.GEOM),opacity:e.NumberInRange([0,1],1,g.OPACITY),preserveAspectRatio:e.Enum(b.PreserveAspectRatioEnum,b.PreserveAspectRatioEnum.NONE,g.GEOM)}})}());(function(){b.mixin(b.graphics.Image,{_resourceUpdateImpl:function(e){this.cvImage=e.data;this.cvClearBuffer(true);b.tree.cvMarkAsDirty(this)},_toDataURLImpl:function(){var i,g,f;if(this.cvImage){g=b.tree.cvCreateBuffer(this._srcWidth,this._srcHeight);f=g.getContext("2d");f.drawImage(this.cvImage,0,0);try{i=g.toDataURL()}catch(h){c.warn(h);i=undefined}b.tree.cvDisposeBuffer(g)}return i},cvPaintSelf:function(e,f){var g;if(this.cvImage){g=this._style;if(g.opacity<1){e.globalAlpha=g.opacity}e.drawImage(this.cvImage,g.x,g.y,this._actualWidth,this._actualHeight)}}})}());(function(){var e=b.defs,f=b.TAGS.GEOM;b.declare({name:"oui.graphics.Line",extend:b.graphics.AbstractShape,jsonDef:{type:"line"},membersDef:{_computeCtrlPts:function(k){var i=[],j=this._style,h=j.x1,g=j.x2,n=j.y1,l=j.y2,q=j.strokeThickness,s=j.strokeLineCap,r,p,o,m;if(k){o=q/2;if(s===b.LineCap.SQUARE){m=Math.atan2(l-n,g-h);r=o*Math.cos(m);p=o*Math.sin(m);h-=r;g+=r;n-=p;l+=p}r=g-h;p=l-n;if(s!==b.LineCap.ROUND){if(r!==0||p!==0){o=o/Math.sqrt(r*r+p*p);r=r*o;p=p*o;i.push(h-p,n+r,g-p,l+r,g+p,l-r,h+p,n-r)}else{if(s===b.LineCap.SQUARE){i.push(h-o,n-o,h+o,n-o,h+o,n+o,h-o,n+o)}else{if(s===b.LineCap.BUTT){i.push(h,n)}}}}else{i.push(h-o,n-o,h+o,n+o,h+o,n+o,h+o,n-o,g-o,l-o,g+o,l+o,g+o,l+o,g+o,l-o)}}else{i.push(h,n);if(h!==g||n!==l){i.push(g,l)}}return i},hitTestOnStroke:function(k,j,q){var r=k,n=j,h=this._style,t=h.strokeLineCap,l=h.strokeThickness/2,s=l*l,i=h.x1,p=h.y1,g=h.x2,m=h.y2,w=false,o,v,u;if(t===b.LineCap.SQUARE){o=Math.atan2(m-p,g-i);v=l*Math.cos(o);u=l*Math.sin(o);i-=v;g+=v;p-=u;m+=u}w=b.geom.ptSegDistSq(i,p,g,m,r,n)<=s;if(t!==b.LineCap.ROUND){w=w&&b.geom.dotprod(g-i,m-p,r-i,n-p)>=0&&b.geom.dotprod(g-i,m-p,g-r,m-n)>=0}return w}},styleDef:{x1:e.FiniteNumber(0,f),y1:e.FiniteNumber(0,f),x2:e.FiniteNumber(0,f),y2:e.FiniteNumber(0,f)}})}());(function(){b.mixin(b.graphics.Line,{cvPaintSelf:function(e,f){var g=this._style;if(g.stroke!==b.NO_PAINT){this.cvSetStroke(e);e.beginPath();e.moveTo(g.x1,g.y1);e.lineTo(g.x2,g.y2);e.stroke()}}})}());(function(){var f=b.geom.isPointInEllipse,g=(Math.sqrt(2)-1)/2,e=b.defs,h=b.TAGS.GEOM;b.declare({name:"oui.graphics.Ellipse",extend:b.graphics.AbstractShape,jsonDef:{type:"ellipse"},membersDef:{_computeCtrlPts:function(p){var l,m=this._style,o=m.cx,n=m.cy,j=m.width,s=m.height,q,i,k,r,u,t;if(p){j+=m.strokeThickness;s+=m.strokeThickness}q=n-s/2;i=n+s/2;k=o-j/2;r=o+j/2;if(j===0&&s===0){l=[o,n]}else{if(j===0){l=[o,q,o,i]}else{if(s===0){l=[k,n,r,n]}else{u=j*g;t=s*g;l=[k,n-t,o-u,q,o+u,q,r,n-t,r,n+t,o+u,i,o-u,i,k,n+t]}}}return l},hitTestOnFill:function(j,i){var k=this._style;return f(j,i,k.cx,k.cy,k.width/2,k.height/2)},hitTestOnStroke:function(n,m,q){var j=this._style,r=n,p=m,o=j.cx,l=j.cy,k=j.width/2,i=j.height/2,s=j.strokeThickness/2;q=(q!==false);return f(r,p,o,l,k+s,i+s)&&!(q&&f(r,p,o,l,k-s,i-s))}},styleDef:{cx:e.FiniteNumber(0,h),cy:e.FiniteNumber(0,h),width:e.FinitePositiveNumber(0,h),height:e.FinitePositiveNumber(0,h)}})}());(function(){var f=new b.graphics.PathCommands(),g=new b.graphics.Path({pathCommands:f}),e=2*Math.PI;b.mixin(b.graphics.Ellipse,{cvPaintSelf:function(n,i){var j=this._style,h=j.cx,m=j.cy,l=j.width/2,k=j.height/2;if(l===k){n.beginPath();n.arc(h,m,l,0,e,false);n.closePath();if(j.fill!==b.NO_PAINT){this.cvSetFill(n);n.fill()}if(j.stroke!==b.NO_PAINT){this.cvSetStroke(n);n.stroke()}}else{f.resetPath();f._safeMoveTo(h+l,m)._safeArc(h,m,0,360,l,k).closePath();g.applyStyle(j);g.cvPaintSelf(n,i)}}})}());(function(){var g=b.geom.isPointInEllipse,f=b.geom.isPointInTriangle,e=b.defs,h=b.TAGS.GEOM;b.declare({name:"oui.graphics.Rectangle",extend:b.graphics.AbstractShape,jsonDef:{type:"rect"},membersDef:{_computeCtrlPts:function(n){var l=this._style,k=l.strokeThickness,j=l.x,o=l.y,m=l.width,i=l.height;if(n){j-=k/2;o-=k/2;m+=k;i+=k}return b.geom.getBoxCtrlPts(j,o,m,i)},hitTestOnFill:function(s,o){var k=this._style,w=s,u=o,p=k.x,z=k.y,v=z+k.height,i=p+k.width,m=k.rx,j=k.ry,q,n,A;A=(w>=p&&w<=i&&u>=z&&u<=v);if(A&&m!==0&&j!==0){if(w<p+m){q=p+m}else{if(w>i-m){q=i-m}}if(u<z+j){n=z+j}else{if(u>v-j){n=v-j}}if(q!==undefined&&n!==undefined){A=g(w,u,q,n,m,j)}}return A},hitTestOnStroke:function(i,K,J){var v=false,s=i,p=K,E=this._style,I=E.strokeThickness/2,C=E.x,w=E.y,H=w+E.height,z=C+E.width,n=E.rx,m=E.ry,G=(n!==0&&m!==0),o=E.strokeLineJoin,k,j,B=(G&&n>I)?n:I,A=(G&&m>I)?m:I,u,q,F,D;J=(J!==false);v=(s>=C-I&&s<=z+I&&p>=w-I&&p<=H+I);v=v&&!(J&&((s>=C+B&&s<=z-B&&p>=w+I&&p<=H-I)||(G&&s>=C+I&&s<=z-I&&p>=w+A&&p<=H-A)));if(v){if(G||o===b.LineJoin.ROUND){if(s<C+n){k=C+n}else{if(s>z-n){k=z-n}}if(p<w+m){j=w+m}else{if(p>H-m){j=H-m}}if(k!==undefined&&j!==undefined){v=g(s,p,k,j,n+I,m+I);if(v&&J&&G&&n>I&&m>I){v=!g(s,p,k,j,n-I,m-I)}}}else{if(o===b.LineJoin.BEVEL){if(s<C){u=C-I;F=C;k=C}else{if(s>z){u=z+I;F=z;k=z}}if(p<w){q=w;D=w-I;j=w}else{if(p>H){q=H;D=H+I;j=H}}if(k!==undefined&&j!==undefined){v=f(s,p,u,q,F,D,k,j)}}}}return v}},styleDef:{x:e.FiniteNumber(0,h),y:e.FiniteNumber(0,h),width:e.FinitePositiveNumber(0,h),height:e.FinitePositiveNumber(0,h),rx:e.FinitePositiveNumber(0,h),ry:e.FinitePositiveNumber(0,h)}})}());(function(){var e=new b.graphics.HalfRoundedRectangle({rounded:{topLineBegin:true,topLineEnd:true,bottomLineBegin:true,bottomLineEnd:true}});b.mixin(b.graphics.Rectangle,{cvPaintSelf:function(f,g){var h=this._style;if(h.rx===0&&h.ry===0){if(h.fill!==b.NO_PAINT){this.cvSetFill(f);f.fillRect(h.x,h.y,h.width,h.height)}if(h.stroke!==b.NO_PAINT){this.cvSetStroke(f);f.strokeRect(h.x,h.y,h.width,h.height)}}else{e.applyStyle(h);e.cvPaintSelf(f)}}})}());(function(){var e=b.defs,i=b.TAGS.GEOM,g=b.TextAlignEnum,f=b.GENERIC_FONTS;function h(j){j=j.toLowerCase();return j.indexOf(" ")>=0&&j[0]!=="'"&&j!==f.SERIF&&j!==f.SANS_SERIF&&j!==f.CURSIVE&&j!==f.MONOSPACE}b.declare({name:"oui.graphics.Text",extend:b.graphics.AbstractShape,jsonDef:{type:"text"},membersDef:{_computeCtrlPts:function(){var k=this._style,l,o,n,m,j,p;if(k.textValue.length>0){p=this._getBBoxImpl();if(!p){m=k.fontSize*k.textValue.length/2;j=k.fontSize;o=k.x;if(k.textAlign===g.CENTER){o-=m/2}else{if((b.layoutDir===b.LTR&&k.textAlign===g.LINE_END)||(b.layoutDir===b.RTL&&k.textAlign===g.LINE_BEGIN)){o-=m}}n=k.y-j}else{m=p.width;j=p.height;o=p.x;n=p.y}l=b.geom.getBoxCtrlPts(o,n,m,j)}else{l=[k.x,k.y]}return l},hitTestOnFill:function(k,j){return this._isWithinBounds(k,j)},getBaselineYAnchor:function(){var k=this._style,j=k.layout.yAnchor,l=this._getBBoxImpl();if(l){j=(k.y-l.y)/l.height}return j},_getXAlignOffset:function(l){var k=0,j=(b.layoutDir===b.LTR);switch(this._style.textAlign){case g.JUSTIFY:c.warn("WARN__TEXT__NO_JUSTIFY");case g.LINE_BEGIN:k=j?0:-l;break;case g.CENTER:k=-l/2;break;case g.LINE_END:k=j?-l:0;break}return k},_getCSSFontFamily:function(l){var j=this._style.fontFamily,m,p,k,o;j=j.replace(/\s+/g," ").replace(/\s*,\s*/g,",").replace(/"/g,"'").replace(/^\s+|\s+$/g,"");if(j.indexOf(",")>0){if(l===true){p=j.split(",");for(k=0,o=p.length;k<o;k++){if(h(p[k])){p[k]="'"+p[k]+"'"}}j=p.join(",")}}else{m=j.replace(/'/g,"").toLowerCase();if(b.cssFonts.hasOwnProperty(m)){j=b.cssFonts[m]}else{if(l===true&&h(j)){j="'"+j+"'"}}}if(l!==true){j=j.replace(/'/g,"")}return j},_getBBoxImpl:function(){return null}},styleDef:{textValue:e.String("",i),x:e.FiniteNumber(0,i),y:e.FiniteNumber(0,i),fontFamily:e.String("Verdana",i),fontSize:e.FinitePositiveNumber(12,i),fontWeight:e.Enum(b.FontWeightEnum,b.FontWeightEnum.NORMAL,i),fontStyle:e.Enum(b.FontStyleEnum,b.FontStyleEnum.NORMAL,i),underline:e.Boolean(false,i),textAlign:e.Enum(g,g.LINE_BEGIN,i)}})}());(function(){var e=b.graphics.AbstractShape.prototype,g=new b.graphics.Line(),f=b.TextAlignEnum;b.mixin(b.graphics.Text,{cvPaintSelf:function(h,j){var k=this._style,l=this.cvBBox,i,m;h.font=this.cvGetFont();h.textAlign=this.cvToCSSAlign(this._style.textAlign);if(k.fill!==b.NO_PAINT){this.cvSetFill(h);h.fillText(k.textValue,k.x,k.y);i=k.fill;m=k.fillOpacity}if(k.stroke!==b.NO_PAINT){this.cvSetStroke(h);h.strokeText(k.textValue,k.x,k.y);i=k.stroke;m=k.strokeOpacity}if(k.underline){this.cvPaintUnderline(h,j,l.x,k.y,l.width,i,m)}},cvPaintUnderline:function(p,o,q,n,i,j,m){var h=this._style,l,k;l=Math.round(h.fontSize*5/100);if(l<1){l=1}k=Math.round(n+3*l);if(l%2===1){k+=0.5}g.applyStyle({x1:q,y1:k,x2:q+i,y2:k,strokeThickness:l,stroke:j,strokeOpacity:m});g.cvPaintSelf(p,o)},cvGetBBox:function(){var i=this._style,h=b.tree.cvTextMetrics(i.textValue,this.cvGetFont());return{x:i.x+this._getXAlignOffset(h.width),y:i.y-h.ascent,width:h.width,height:h.height}},notifyNativeImpl:function(h,i){if(h===b.TAGS.GEOM){this.cvCacheFont();this.cvBBox=this.cvGetBBox()}else{if(h===b.TAGS.LAYOUT_DIR){this.cvBBox=this.cvGetBBox()}}e.notifyNativeImpl.call(this,h,i)},cvGetFont:function(){if(!this.cvFont){this.cvCacheFont()}return this.cvFont},cvCacheFont:function(){var i=this._style,h="";if(i.fontStyle===b.FontStyleEnum.ITALIC){h+="italic "}if(i.fontWeight===b.FontWeightEnum.BOLD){h+="bold "}h+=i.fontSize+"px "+this._getCSSFontFamily(true);this.cvFont=h},cvToCSSAlign:function(i){var h=(b.layoutDir===b.LTR);switch(i){case f.CENTER:i="center";break;case f.LINE_END:i=h?"right":"left";break;default:i=h?"left":"right";break}return i}})}());(function(){var e=b.defs,f=b.TAGS.GEOM;b.declare({name:"oui.graphics.TextBlock",extend:b.graphics.Text,jsonDef:{type:"textBlock"},membersDef:{convertToText:function(){var o=[],h=new b.text.LineBreakMeasurer(this),n=this._breakText(h),q=n.length,p,g,k=this._style,j=k.y,m=k.x,l;for(l=0;l<q;l++){g=n[l];if(l!==0){j+=g.leading+g.ascent}p=new b.graphics.Text(k);p.applyStyle({textValue:g.textValue,x:m+this._getXAlignOffset(g.lineWidth),y:j});o.push(p);j+=g.descent}return o},_breakText:function(g){var h=this._style,i=h.textValue,p=h.maxWidth,m=h.maxLines,j=h.autoTooltip,l=h.useEllipsis,n=h.ellipsis,o=false,r=[],q=g.getTextLength(),k;g.replaceText(0,q,i);if(l){q=g.getTextLength();k=this._fitText(g,r,p,m,true);while(k>=1&&k<q){g.replaceText(k-1,q,n);q=g.getTextLength();k=this._fitText(g,r,p,m,true)}o=(k!==i.length)}else{this._fitText(g,r,p,m,false)}if(j&&o){this.setTooltip(i)}else{this.setTooltip(null)}return r},_fitText:function(g,o,m,l,k){var n=0,j=0,h=this._style.minChar,i=g.nextLine(m);o.length=0;while(i){o.push(i);n++;j=i.textBlockEndIndex;if(n===l||(k&&i.lastWordTruncated)){break}i=g.nextLine(m)}if(k){h++}if(n>0&&o[0].lastWordTruncated&&o[0].textValue.length<h){o.length=0;j=0}return j}},styleDef:{maxWidth:e.PositiveNumber(Number.POSITIVE_INFINITY,f),maxLines:e.NumberInRange([1,Number.POSITIVE_INFINITY],Number.POSITIVE_INFINITY,f),minChar:e.FinitePositiveNumber(0,f),useEllipsis:e.Boolean(false),ellipsis:e.Char("\u2026"),autoTooltip:e.Boolean(false)}})}());(function(){b.mixin(b.graphics.TextBlock,{cvPaintSelf:function(l,q){var g=this._style,s,t,k,f,j,e,o=(g.fill!==b.NO_PAINT),r=(g.stroke!==b.NO_PAINT),h=g.underline,p,m;if(o){this.cvSetFill(l);p=g.fill;m=g.fillOpacity}if(r){this.cvSetStroke(l);p=g.stroke;m=g.strokeOpacity}if(o||r){l.font=this.cvGetFont();l.textAlign=this.cvToCSSAlign(this._style.textAlign);s=this.cvTextLines;k=g.x;f=g.y;for(j=0,e=s.length;j<e;j++){t=s[j];if(j!==0){f+=s[j-1].descent+t.leading+t.ascent}if(o){l.fillText(t.textValue,k,f)}if(r){l.strokeText(t.textValue,k,f)}if(h){this.cvPaintUnderline(l,q,g.x+this._getXAlignOffset(t.lineWidth),f,t.lineWidth,p,m)}}}},cvGetBBox:function(){var g=this._style,f=new b.text.LineBreakMeasurer(this),m=this._breakText(f),e=m.length,k=0,l=0,j=0,n,h;for(h=0;h<e;h++){n=m[h];k=Math.max(k,n.lineWidth);l+=n.lineHeight+n.leading}if(e>0){j=m[0].ascent}return{x:g.x+this._getXAlignOffset(k),y:g.y-j,width:k,height:l}},notifyNativeImpl:function(e,g){var f;if(e===b.TAGS.GEOM||e===b.TAGS.LAYOUT_DIR){this.cvCacheFont();f=new b.text.LineBreakMeasurer(this);this.cvTextLines=this._breakText(f);this.cvBBox=this.cvGetBBox()}b.graphics.AbstractShape.prototype.notifyNativeImpl.call(this,e,g)}})}());(function(){var e=b.graphics.Group.prototype,f="background";b.declare({name:"oui.layout.AbstractLayoutBox",isAbstract:true,extend:b.graphics.Group,membersDef:{_computeLayoutCtrlPts:function(){var g=this._box;return b.geom.getBoxCtrlPts(g.x,g.y,g.width,g.height)},invalidateLayout:function(){var g;if(!this._layingOut&&!this._layoutDirty){g=this.getFirstContentChild();this.invalidateLayout=b.NO_OP;while(g){if((g.getLayoutHWeight()!==0)||(g.getLayoutVWeight()!==0)){g.invalidateLayout()}g=g.nextSibling}delete this.invalidateLayout;e.invalidateLayout.call(this)}},_getLayoutInformation:function(){var j,g,h,o,l,i,m,p,k,n;j={maxChildWidth:0,maxChildHeight:0,maxLayoutWidth:Number.MAX_VALUE,maxLayoutHeight:Number.MAX_VALUE,totalChildWidth:0,totalChildHeight:0,totalChildHWeight:0,totalChildVWeight:0,children:[],spacingsCount:0};h=this.getFirstContentChild();while(h){o=h._style;l=h.getPreferredLayoutBox();i=o.layout.hWeight;m=o.layout.vWeight;n=o.display;j.totalChildWidth+=l.width;j.totalChildHWeight+=i;j.totalChildHeight+=l.height;j.totalChildVWeight+=m;if(l.height>j.maxChildHeight){j.maxChildHeight=l.height}if(l.width>j.maxChildWidth){j.maxChildWidth=l.width}j.children.push({node:h,layoutBox:l,hWeight:i,vWeight:m,needSpace:n});if(n){j.spacingsCount++}h=h.nextSibling}if(j.spacingsCount>0){j.spacingsCount--}g=this._layoutBox;if(g){if(j.maxChildHeight>g.height){j.maxChildHeight=g.height}if(j.maxChildWidth>g.width){j.maxChildWidth=g.width}j.maxLayoutWidth=g.width;j.maxLayoutHeight=g.height}p=this._style.layout.preferredWidth;k=this._style.layout.preferredHeight;if(p>=0&&j.maxLayoutWidth>p){j.maxLayoutWidth=p}if(k>=0&&j.maxLayoutHeight>k){j.maxLayoutHeight=k}return j},onStyleChanged:function(g){if(g===f){this._updateBackground()}else{e.onStyleChanged.call(this,g)}},_updateBackground:function(){var g=this._style,h={fill:g.background};if(this._background){this._background.applyStyle(h)}else{this._background=new b.graphics.Rectangle(h);this.insertBefore(this._background,this.firstChild)}},getFirstContentChild:function(){return this._background?this._background.nextSibling:this.firstChild},hasBackground:function(){return(this._background!==undefined)}},styleDef:{background:b.defs.Paint(b.NO_PAINT,f)}})}());(function(){var h=b.defs,n=b.DirectionEnum,o=b.LTR,g=b.RTL,i=b.OrientationEnum.VERTICAL,f=b.OrientationEnum.HORIZONTAL,q=n.UP,p=n.DOWN,e=n.LEFT,m=n.RIGHT,k=n.TO_LINE_BEGIN,l=n.TO_LINE_END,j=b.TAGS.LAYOUT;b.declare({name:"oui.layout.FlowBox",extend:b.layout.AbstractLayoutBox,jsonDef:{type:"flowbox",factory:function(t,v,s,u){var r=new b.layout.FlowBox(t,t.name);b.load(t.children,r,v,s,u);return r}},membersDef:{_safeLayout:function(){var r=this._style.orientation;if(r===f){this._hFlowLayout()}else{this._vFlowLayout()}if(this._background){this._background.applyStyle(this._box)}this._positionInLayoutBox()},_vFlowLayout:function(){var r=this._style,t=0,s=0,A=[],D=0,F=r.wrapLength,z=r.hSpacing,G=r.vSpacing,C,u=this.firstChild,x=0,w=0,E=1,v=0,B=0,y=1;if(this._isRTLLayout()){v=1;E=-1}if(r.vDirection===q){B=1;y=-1}while(u){C=u.getPreferredLayoutBox();if(y*s+C.height>F){this._layoutColumn(A,D,v*E*D);if(x>0){x+=z}x+=D;s=0;t+=E*(D+z);A=[];D=0}A.push({node:u,x:t,y:s+B*y*C.height,width:C.width,height:C.height});if(D<C.width){D=C.width}if(y*s+C.height>w){w=y*s+C.height}s+=y*(C.height+(u._style.display?G:0));u=u.nextSibling}if(A.length>0){this._layoutColumn(A,D,v*E*D);if(x>0){x+=z}x+=D}this._box={x:v*E*x,y:B*y*w,width:x,height:w}},_layoutColumn:function(r,u,t){var s,w,v;for(s=0,w=r.length;s<w;s++){v=r[s];v.node.setLayoutBox(v.x+t,v.y,u,v.height)}},_hFlowLayout:function(){var r=this._style,t=0,s=0,w=[],C=0,F=r.wrapLength,y=r.hSpacing,G=r.vSpacing,B,u=this.firstChild,z=0,E=0,D=1,v=0,A=0,x=1;if(this._isRTLLayout()){v=1;D=-1}if(r.vDirection===q){A=1;x=-1}while(u){B=u.getPreferredLayoutBox();if(D*t+B.width>F){this._layoutRow(w,C,A*x*C);if(z>0){z+=G}z+=C;t=0;s+=x*(C+G);w=[];C=0}w.push({node:u,x:t+v*D*B.width,y:s,width:B.width,height:B.height});if(C<B.height){C=B.height}if(D*t+B.width>E){E=D*t+B.width}t+=D*(B.width+(u._style.display?y:0));u=u.nextSibling}if(w.length>0){this._layoutRow(w,C,A*x*C);if(z>0){z+=G}z+=C}this._box={x:v*D*E,y:A*x*z,width:E,height:z}},_layoutRow:function(u,s,t){var r,w,v=u.length;for(r=0;r<v;r++){w=u[r];w.node.setLayoutBox(w.x,w.y+t,w.width,s)}},_isRTLLayout:function(){var r=this._style.hDirection;return r===e||(r===k&&b.layoutDir===o)||(r===l&&b.layoutDir===g)}},styleDef:{orientation:h.Enum(b.OrientationEnum,i,j),wrapLength:h.PositiveNumber(100,j),hDirection:{type:[e,m,k,l],defaultValue:l,tag:j},vDirection:{type:[q,p],defaultValue:p,tag:j},hSpacing:h.FinitePositiveNumber(5,j),vSpacing:h.FinitePositiveNumber(5,j)}})}());(function(){var f=b.LTR,k=b.RTL,i=b.DirectionEnum,g=i.LEFT,h=i.RIGHT,l=i.TO_LINE_BEGIN,e=i.TO_LINE_END,j=b.TAGS.LAYOUT;b.declare({name:"oui.layout.HBox",extend:b.layout.AbstractLayoutBox,jsonDef:{type:"hbox",factory:function(n,q,m,p){var o=new b.layout.HBox(n,n.name);b.load(n.children,o,q,m,p);return o}},membersDef:{_safeLayout:function(){var y,A,s,m,E,o,u,B,p,w,C,v=this._style,q=0,D=0,z,t=1,n=0,x=v.direction,r=v.spacing;A=this._getLayoutInformation();m=A.maxChildHeight;if(A.maxLayoutHeight!==Number.MAX_VALUE&&((A.totalChildVWeight!==0)||(A.maxLayoutHeight<A.maxChildHeight))){m=A.maxLayoutHeight}p=A.maxLayoutWidth;s=A.children;w=0;E=p;o=s.length;D=A.maxLayoutWidth-A.totalChildWidth-A.spacingsCount*r;if(D<0||A.maxLayoutWidth===Number.MAX_VALUE){D=0}z=A.totalChildHWeight;if(z===0){z=1}if(x===g||(x===l&&b.layoutDir===f)||(x===e&&b.layoutDir===k)){n=1;t=-1}for(C=0;C<o;C++){u=s[C];B=u.node;y=u.layoutBox.width+D*u.hWeight/z;if(y>p){y=p}B.setLayoutBox(w+n*t*y,0,y,m);q=t*w+y;w+=t*(y+(u.needSpace?r:0));if(t*w>E){w=t*E}p=A.maxLayoutWidth-t*w;if(p<0){p=0}}this._box={x:n*t*q,y:0,width:q,height:m};if(this._background){this._background.applyStyle(this._box)}this._positionInLayoutBox()}},styleDef:{spacing:b.defs.FinitePositiveNumber(5,j),direction:{type:[g,h,l,e],defaultValue:e,tag:j}}})}());(function(){var g=b.DirectionEnum,e=g.UP,f=g.DOWN,h=b.TAGS.LAYOUT;b.declare({name:"oui.layout.VBox",extend:b.layout.AbstractLayoutBox,jsonDef:{type:"vbox",factory:function(j,m,i,l){var k=new b.layout.VBox(j,j.name);b.load(j.children,k,m,i,l);return k}},membersDef:{_safeLayout:function(){var p,u,m,n,z,j,o,v,y,r,w,q=this._style,A=0,t=0,k,x=0,s=1,l=q.spacing;u=this._getLayoutInformation();n=u.maxChildWidth;if(u.maxLayoutWidth!==Number.MAX_VALUE&&((u.totalChildHWeight!==0)||(u.maxLayoutWidth<u.maxChildWidth))){n=u.maxLayoutWidth}y=u.maxLayoutHeight;m=u.children;r=0;z=y;j=m.length;t=u.maxLayoutHeight-u.totalChildHeight-u.spacingsCount*l;if(t<0||u.maxLayoutHeight===Number.MAX_VALUE){t=0}k=u.totalChildVWeight;if(k===0){k=1}if(q.direction===e){x=1;s=-1}for(w=0;w<j;w++){o=m[w];v=o.node;p=o.layoutBox.height+t*o.vWeight/k;if(p>y){p=y}v.setLayoutBox(0,r+x*s*p,n,p);A=s*r+p;r+=s*(p+(o.needSpace?l:0));if(s*r>z){r=s*z}y=u.maxLayoutHeight-s*r;if(y<0){y=0}}this._box={x:0,y:x*s*A,width:n,height:A};if(this._background){this._background.applyStyle(this._box)}this._positionInLayoutBox()}},styleDef:{spacing:b.defs.FinitePositiveNumber(5,h),direction:{type:[e,f],defaultValue:f,tag:h}}})}());(function(){var f=b.graphics.Group.prototype,e=b.defs;b.declare({name:"oui.layout.Box",extend:b.graphics.Group,jsonDef:{type:"box",factory:function(h,k,g,j){var i=new b.layout.Box(h,h.name);b.load(h.children,i,k,g,j);return i}},membersDef:{init:function(g,h){f.init.call(this,g,h);this._updateBackground()},onPropertyChanged:function(){this._updateBackground()},_updateBackground:function(){var j=this._style,i=j.border,h=i.rounded,g,k;if((h.topLineBegin===h.topLineEnd&&h.topLineEnd===h.bottomLineBegin&&h.bottomLineBegin===h.bottomLineEnd)){k={stroke:i.stroke,strokeThickness:i.strokeThickness,rx:h.topLineBegin?i.rx:0,ry:h.topLineBegin?i.ry:0,fill:j.background,filter:j.backgroundFilter};if(!this._rect){this._rect=new b.graphics.Rectangle(k)}else{this._rect.applyStyle(k)}g=this._rect}else{k={stroke:i.stroke,strokeThickness:i.strokeThickness,rx:i.rx,ry:i.ry,rounded:i.rounded,fill:j.background,filter:j.backgroundFilter};if(!this._hrrect){this._hrrect=new b.graphics.HalfRoundedRectangle(k)}else{this._hrrect.applyStyle(k)}g=this._hrrect}if(g!==this._background){if(this._background){this.removeChild(this._background)}this.insertBefore(g,this.firstChild);this._background=g}},_safeLayout:function(){var l,h=null,k,g,i,j;if(!this._layoutBox){l=this.getPreferredLayoutBox();this.setLayoutBox(0,0,l.width,l.height)}k=this._layoutBox.width;g=this._layoutBox.height;i=this._style.layout.preferredWidth;j=this._style.layout.preferredHeight;if(i>=0&&i<k){k=i}if(j>=0&&j<g){g=j}if(this._background){h=this._background.nextSibling;this._background.applyStyle({width:k,height:g})}else{h=this.firstChild}while(h){h.setLayoutBox(0,0,k,g);h=h.nextSibling}this._positionInLayoutBox()},_getContentPreferredLayoutBox:function(){var g=null,i,h={width:0,height:0};if(this._background){g=this._background.nextSibling}while(g){i=g.getPreferredLayoutBox();h.width=Math.max(h.width,i.width);h.height=Math.max(h.height,i.height);g=g.nextSibling}return h}},styleDef:{border:{strokeThickness:e.FinitePositiveNumber(1),stroke:e.Paint(b.NO_PAINT),rx:e.PositiveNumber(3),ry:e.PositiveNumber(3),rounded:{topLineBegin:e.Boolean(true),topLineEnd:e.Boolean(true),bottomLineBegin:e.Boolean(false),bottomLineEnd:e.Boolean(false)}},background:e.Paint(b.NO_PAINT),backgroundFilter:e.FilterEffect(null)}})}());(function(){var f=b.graphics.Group.prototype,e=b.defs,g;g={name:"content",type:"box",children:[{name:"shadow",type:"box",background:b.black,border:{stroke:b.black},styleBinding:{display:function(h){return h.shadow!==null},filter:"@shadow",border:{strokeThickness:"@border.strokeThickness",rx:"@border.rx",ry:"@border.ry",rounded:"@border.rounded"}}},{name:"background",type:"box",styleBinding:{border:"@border",background:"@background"}},{name:"data",type:"box",background:b.NO_PAINT,border:{stroke:b.NO_PAINT},styleBinding:{layout:{padding:"@padding"}},children:[{name:"text",type:"textBlock",useEllipsis:true,autoTooltip:false,styleBinding:{fontFamily:"@text.fontFamily",fontSize:"@text.fontSize",fontWeight:"@text.fontWeight",fill:"@text.fill",maxLines:"@text.maxLines",maxWidth:"#_computeMaxWidth"}},{name:"graphics",type:"group"}]}]};b.declare({name:"oui.tooltip.Tooltip",extend:b.graphics.Group,membersDef:{init:function(h,i){f.init.call(this,h,i);this.isShown=false;this._isTextBased=false;this.content=b.load(g);this.appendChild(this.content);this.onPropertyChanged();this.setPointerSensitivity(false);this._viewportResizeHandler=this.handler("_computeMaxWidth")},setContent:function(h){this.content.data.text.setDisplay(false);this.content.data.graphics.setDisplay(false);if(b.isA(h,String)){this._setTextContent(h)}else{if(b.isA(h,b.graphics.AbstractGraphicNode)){this._setGraphicContent(h)}else{if(b.isA(h,Number)){this._setTextContent(h.toString(10))}else{if(b.isA(h,Date)){this._setTextContent(h.toLocaleString())}}}}},show:function(){this.appendChild(this.content);this.isShown=true},hide:function(){this.isShown=false;if(this.firstChild){this.removeChild(this.content)}},onPropertyChanged:function(){if(this.content!==undefined){this.content.applyStyleBinding(this._style,this)}},_setTextContent:function(h){this.content.data.text.applyStyle({display:true,textValue:h,maxWidth:this._computeMaxWidth()});if(!this._isTextBased){b.rootNode.addEventListener(b.ViewEvents.VIEWPORT_RESIZE,this._viewportResizeHandler);this._isTextBased=true}},_setGraphicContent:function(i){var h=this.content.data.graphics;h.removeChildren();h.appendChild(i);h.setDisplay(true);if(this._isTextBased){b.rootNode.removeEventListener(b.ViewEvents.VIEWPORT_RESIZE,this._viewportResizeHandler);this._isTextBased=false}},_computeMaxWidth:function(){var h=this._style,i=h.padding,j=b.viewportWidth-(i.lineBegin+i.lineEnd);return Math.min(h.text.maxWidth,j)}},styleDef:{border:{strokeThickness:e.FinitePositiveNumber(1),stroke:e.Paint(new b.style.Color(204,204,204)),rx:e.PositiveNumber(4),ry:e.PositiveNumber(4),rounded:{topLineBegin:e.Boolean(true),topLineEnd:e.Boolean(true),bottomLineBegin:e.Boolean(true),bottomLineEnd:e.Boolean(true)}},background:e.Paint(new b.style.Color(0,0,0,191)),text:{fontFamily:e.String("Trebuchet MS"),fontSize:e.FinitePositiveNumber(11),fontWeight:e.Enum(b.FontWeightEnum,b.FontWeightEnum.NORMAL),fill:e.Paint(b.white),maxLines:e.NumberInRange([1,Number.POSITIVE_INFINITY],Number.POSITIVE_INFINITY),maxWidth:e.PositiveNumber(Number.POSITIVE_INFINITY,b.TAGS.GEOM)},padding:e.Padding(5,5,5,5),shadow:e.ObjectOfType(b.filters.DropShadow,b.filters.DROP_SHADOW_KNOCKED_OUT,true)}})}());(function(){var e=b.defs;b.declare({name:"oui.tooltip.TooltipManager",mixins:[b.lang.PropertiesSupport],membersDef:{events:{SHOW_TOOLTIP:"showTooltip",HIDE_TOOLTIP:"hideTooltip"},init:function(){var g=this,f=b.tree;this._initProperties();this._initCallbacks();this._initMouseListeners();this._style=new this.Style();this._tooltip=new b.tooltip.Tooltip(this._style);this._ttTarget=null;this._ttX=0;this._ttY=0;if(f.isPlatformAvailable()){this.enableAutoTooltips()}else{f.addEventListener(f.events.PLATFORM_AVAILABLE,function(){f._initShadowTree(g._tooltip);g.enableAutoTooltips()})}},enableAutoTooltips:function(){b.tree.tooltipLayer.appendChild(this._tooltip);this._tooltip.hide();b.rootNode.onMouseOver(this._mouseOverListener)},disableAutoTooltips:function(){b.tree.tooltipLayer.removeChild(this._tooltip);b.rootNode.offMouseOver(this._mouseOverListener)},applyStyle:function(f){this._tooltip.applyStyle(f)},showTooltip:function(h,g,f,i){this.cancelDismissTooltip();this.cancelHideTooltip();if(g!==this._tooltipContent){this._tooltip.setContent(g)}this._tooltip.show();this._positionTooltipTo(f,i);this.scheduleDismissTooltip();this._tooltipContent=g},hideTooltip:function(){this._tooltip.hide()},_initMouseListeners:function(){var j=this,f,i,g;function h(k){var l=null;while(k){l=k.getTooltip();if(l===null||l===""){k=k.parentNode}else{break}}return k}f=function(l){var k=h(l.relatedTarget),m=h(l.target);if(m&&m!==k){m.onMouseMove(g);m.onMouseOut(i)}};i=function(k){var l=k.currentTarget,m=h(k.relatedTarget);if(m!==l){j.cancelShowTooltip();j.cancelDismissTooltip();j.scheduleHideTooltip();l.offMouseMove(g);l.offMouseOut(i)}};g=function(k){j._ttTarget=k.currentTarget;j._ttX=k.clientX;j._ttY=k.clientY;j.cancelShowTooltip();j.scheduleShowTooltip()};this._mouseOverListener=f},_initCallbacks:function(){var f=this;this._showTooltipDefaultAction=function(g){var h=g.target.getTooltip();f.showTooltip(g.target,h,g.tooltipX,g.tooltipY)};this._dispatchShowTooltip=function(){f._ttTarget.dispatchEvent({type:f.events.SHOW_TOOLTIP,tooltipX:f._ttX,tooltipY:f._ttY,cancelable:true,defaultAction:f._showTooltipDefaultAction})};this._hideTooltipDefaultAction=function(){f.hideTooltip()};this._dispatchHideTooltip=function(){if(f._ttTarget){f._ttTarget.dispatchEvent({type:f.events.HIDE_TOOLTIP,defaultAction:f._hideTooltipDefaultAction})}}},scheduleShowTooltip:function(){var f=this._properties.showDelay;if(f===0){this._dispatchShowTooltip()}else{this._showTooltipTimeoutID=setTimeout(this._dispatchShowTooltip,f)}},cancelShowTooltip:function(){if(this._showTooltipTimeoutID){clearTimeout(this._showTooltipTimeoutID);this._showTooltipTimeoutID=undefined}},scheduleHideTooltip:function(){var f=this._properties.hideDelay;if(f===0){this._dispatchHideTooltip()}else{this._hideTooltipTimeoutID=setTimeout(this._dispatchHideTooltip,f)}},cancelHideTooltip:function(){if(this._hideTooltipTimeoutID){clearTimeout(this._hideTooltipTimeoutID);this._hideTooltipTimeoutID=undefined}},scheduleDismissTooltip:function(){var f=this._properties.dismissDelay;if(f===0){this._dispatchHideTooltip()}else{if(isFinite(f)){this._dismissTooltipTimeoutID=setTimeout(this._dispatchHideTooltip,f)}}},cancelDismissTooltip:function(){if(this._dismissTooltipTimeoutID){clearTimeout(this._dismissTooltipTimeoutID);this._dismissTooltipTimeoutID=undefined}},_positionTooltipTo:function(f,k){var j=this._tooltip,i=this._properties,g={x:f,y:k},h;j._setTranslation(f+i.cursorOffset,k+i.cursorOffset);h=j.getLayoutBounds();g=b.geom.getBoundedXY(h,b.viewportBounds,undefined,g);if(g.x!==h.x||g.y!==h.y){j._setTranslation(g.x,g.y)}}},propertiesDef:{showDelay:e.FinitePositiveNumber(200),hideDelay:e.FinitePositiveNumber(250),dismissDelay:e.PositiveNumber(5000),cursorOffset:e.Number(12),followCursor:e.Boolean(false)},styleDef:b.tooltip.Tooltip.StyleDefinition})}());(function(){b.declare({name:"oui.io.JSONExporter",membersDef:{init:function(){this._resources={};this._root={type:"group"};this._containerHierarchy=[this._root];this._curContainer=this._root},snapshotNodes:function(p,s,m,o){var r,q,t;if(b.isA(p,Array)){for(q=0,t=p.length;q<t;q++){this.captureNode(p[q])}r={type:"snapshot",width:m,height:o,viewBox:b.geom.isValidRect(s)?[s.x,s.y,s.width,s.height]:undefined,resources:this._captureResources(),content:this._root}}return r},captureNode:function(m){if(m.jsonNodeExporter!==undefined){m.jsonNodeExporter.captureNode(m,this)}},startNodeExport:function(m){if(this._curContainer.children===undefined){this._curContainer.children=[m]}else{this._curContainer.children.push(m)}this._containerHierarchy.push(m);this._curContainer=m},endNodeExport:function(){var m;this._containerHierarchy.pop();m=this._containerHierarchy.length;this._curContainer=this._containerHierarchy[m-1]},_DEFAULT_RESOURCE_COMPARE:function(n,m){return n===m},getResourceId:function(p,o,t,s){var r=0,m=0,q;if(t===undefined){t=this._DEFAULT_RESOURCE_COMPARE}if(this._resources[o]===undefined){q=[];this._resources[o]=q}else{q=this._resources[o];for(m=0,r=q.length;m<r;m++){if(t(q[m],p)===true){break}}}if(m===r){if(typeof s==="function"){s(p)}q.push(p)}return o.concat(m)},getImgResourceId:function(m,n){return this.getResourceId({type:"imageResource",src:m},"image_",function(p,o){return p.src===o.src},n)},_captureResources:function(){var r=this._resources,m={},o,s,q;for(q in r){if(r.hasOwnProperty(q)===true){m[q]={};for(o=0,s=r[q].length;o<s;o++){m[q][q+o]=this._resourceToJSON(r[q][o])}}}return m},_resourceToJSON:function(n){var m=n;if(b.isA(n.exportValueToJSON,Function)){m=n.exportValueToJSON(this)}return m}}});b.graphics.AbstractGraphicNode.prototype.jsonNodeExporter={exportNode:function(u,o,q){var m,p=u._style,r=u.StyleDefinition.prototype,s=u.jsonExportConfig.styleExporter,t=u.jsonExportConfig.propertiesExporter;for(m in p){if(s.hasOwnProperty(m)){s[m](m,p[m],r[m].defaultValue,o,u,q)}}if(t!==undefined){t(o,u,q)}},captureNode:function(p,o){var m;if(p.shouldCapture()){m={type:p.jsonExportConfig.type,__node:p};this.exportNode(p,m,o);o.startNodeExport(m);this.exportChildren(p,o);o.endNodeExport(m)}},exportChildren:function(m,n){var o=m.firstChild;while(o){n.captureNode(o);o=o.nextSibling}}};var f,l,j,h,e,k,g,i;f=function(n,m){n.prototype.exportToJSON=m};l=function(n,m){n.prototype.exportValueToJSON=m};j=function(n,m){var o=n.prototype.jsonExportConfig;n.prototype.jsonExportConfig=m;if(o!==undefined){b.mixin(m.styleExporter,o.styleExporter)}};b.graphics.AbstractGraphicNode.prototype.shouldCapture=function(){return this._style.display&&this._style.visibility};b.graphics.AbstractPath.prototype.shouldCapture=function(){var m=this.getPathCommands();return this._style.display&&this._style.visibility&&m!==null&&m.dataTypes.length>0};h=function(o,r,m,p,s,q){if(r!==m){p[o]=r}};e=function(o,r,m,p,s,q){if(r!==m){p[o]=r.concat()}};k=function(o,r,m,p,s,q){if(r!==m){p[o]=r.exportToJSON(q)}};g=function(r){var o=[],m,q,p,s=r.length;for(p=0;p<s;p++){q=r[p];m=q.getColor();o.push({type:"stop",offset:q.getOffset(),color:m.exportToJSON(),opacity:m.getOpacity(),origColor:m})}return o};i=function(n,m){return n===m||(n._style.color===m._style.color&&n._style.opacity===m._style.opacity&&n._style.radius===m._style.radius&&n._style.angle===m._style.angle&&n._style.offset===m._style.offset&&n._style.knockout===m._style.knockout)};j(b.graphics.AbstractGraphicNode,{styleExporter:{clip:e,transform:function(o,r,m,p,s,q){if(!r.isIdentity()){p[o]=r.exportToJSON(q)}},filter:function(o,r,m,p,s,q){if(r!==m){s._updateFilterFX();k(o,s._filterFX,m,p,s,q)}}}});j(b.graphics.Group,{type:"group",styleExporter:{opacity:h}});j(b.graphics.AbstractShape,{styleExporter:{fill:k,fillOpacity:h,stroke:k,strokeOpacity:h,strokeThickness:h,strokeLineJoin:h,strokeLineCap:h,strokeMiterLimit:h,htmlExportClassName:h}});j(b.graphics.Ellipse,{type:"ellipse",styleExporter:{cx:h,cy:h,width:h,height:h}});j(b.graphics.Image,{type:"image",styleExporter:{src:function(o,r,m,p,t,q){var s=q.getImgResourceId(r,function(n){n.href=t.toDataURL()});p[o]="#"+s},x:h,y:h,width:h,height:h}});j(b.graphics.Line,{type:"line",styleExporter:{x1:h,y1:h,x2:h,y2:h}});j(b.graphics.AbstractPath,{type:"path",propertiesExporter:function(m,o,n){m.pathCommands=o.getPathCommands().exportToJSON(n)},styleExporter:{}});j(b.graphics.Rectangle,{type:"rect",styleExporter:{x:h,y:h,width:h,height:h,rx:h,ry:h}});j(b.graphics.Text,{type:"text",styleExporter:{x:h,y:h,fontSize:h,fontWeight:h,fontFamily:h,underline:h,textAlign:h,textValue:h}});j(b.graphics.TextBlock,{type:"textBlock",styleExporter:{}});f(b.style.Color,function(){return"#".concat(this.hexRGBA)});f(b.style.GradientPaint,function(m){return"url(#"+m.getResourceId(this,"gradient_")+")"});f(b.style.PatternPaint,function(m){m.getImgResourceId(this._properties.src,function(n){var o=n.src;n.href=b.resourcesManager._getBase64Data(o)||o});return"url(#"+m.getResourceId(this,"pattern_")+")"});f(b.style.Paint,function(){return"none"});f(b.filters.AbstractFilter,function(m){return"url(#"+m.getResourceId(this,"filter_")+")"});f(b.filters.DropShadow,function(m){return"url(#"+m.getResourceId(this,"filter_",i)+")"});l(b.style.LinearGradient,function(){var m=this._properties;return{type:"linearGradient",x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,useObjectBoundingBox:m.useObjectBoundingBox,stops:g(m.stops)}});l(b.style.RadialGradient,function(){var m=this._properties;return{type:"radialGradient",cx:m.cx,cy:m.cy,r:m.radius,useObjectBoundingBox:m.useObjectBoundingBox,stops:g(m.stops)}});l(b.style.PatternPaint,function(m){return{type:"pattern",width:this._srcW,height:this._srcH,src:"#"+m.getImgResourceId(this._properties.src),origSrc:this._properties.src}});l(b.filters.DropShadow,function(){var m=this._style;return{type:"dropShadow",color:m.color.hexRGBA,opacity:m.opacity,radius:m.radius,angle:m.angle,offset:m.offset,knockout:m.knockout}});l(b.filters.Blur,function(){return{type:"blur",radius:this._style.radius}});f(b.geom.Matrix,function(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]});f(b.graphics.PathCommands,function(){return{dataTypes:this.dataTypes.concat(),dataValues:this.dataValues.concat()}})}());(function(){b.ns("oui.io");b.io.XMLConverter={convert:function(f,l){var g,j,h,k,e=l;if(typeof f==="string"){e=e.concat(b.xmlSpecialChars(f))}else{e=e.concat("<",f.__type);g=[];if(f.hasOwnProperty("__style")){for(j in f.__style){if(f.__style.hasOwnProperty(j)===true){g.push("".concat(j,":",f.__style[j],";"))}}f.style=g.join("")}g=[];for(j in f){if(j!=="children"&&j!=="__type"&&j!=="__style"&&f.hasOwnProperty(j)===true){g.push(" ".concat(j,"='",f[j],"'"))}}if(g.length>0){g.sort();e=String.prototype.concat.apply(e,g)}if(f.children!==undefined){e=e.concat(">");k=f.children.length;for(h=0;h<k;h++){e=b.io.XMLConverter.convert(f.children[h],e)}e=e.concat("</"+f.__type+">")}else{if(f.__type==="div"||f.__type==="style"){e=e.concat("></"+f.__type+">")}else{e=e.concat(" />")}}}return e}}}());(function(){var u,e=3*Math.sqrt(2*Math.PI),v={LTR:{LINE_BEGIN:"start",LINE_END:"end",CENTER:"middle",JUSTIFY:"start"},RTL:{LINE_BEGIN:"end",LINE_END:"start",CENTER:"middle",JUSTIFY:"start"}},s={},f={};function h(y){if(s[y]===undefined){s[y]=0}else{s[y]++}return y+s[y]}function q(y){return y.substring(0,7)}function w(z){var y=z;if(z&&z.charAt(0)==="#"){y=q(z)}return y}function p(z){var y=z.substr(7),A=1;if(y!=="FF"){A=parseInt(y,16)/255}return A}function m(z){var y=1;if(z&&z.charAt(0)==="#"){y=p(z)}return y}function r(y){return[parseInt(y.substr(0,2),16),parseInt(y.substr(2,2),16),parseInt(y.substr(4,2),16),parseInt(y.substr(6,2),16)]}function k(z,y){if(z){if(!y.children){y.children=[]}y.children.push(z)}}function x(y){return(y*4-2)/e}function o(z,y,A){return{__type:"feFunc"+z,type:"linear",slope:y,intercept:A}}function l(z){var A={},y;for(y in z){if(z.hasOwnProperty(y)===true&&y!=="children"&&y!=="type"&&y!=="__node"){A[y]=z[y]}}if(z.hasOwnProperty("type")===true){A.__type=z.type}return A}function t(z){var A=l(z),y=A.color;A["stop-color"]=q(y);delete A.color;A["stop-opacity"]=p(y);return A}function n(z){var B=l(z),A=B.stops,y,C;B.gradientUnits=B.useObjectBoundingBox?"objectBoundingBox":"userSpaceOnUse";delete B.useObjectBoundingBox;delete B.stops;if(A){for(y=0,C=A.length;y<C;y++){k(t(A[y]),B)}}return B}function j(y){return{__type:"filter",id:y.id,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[]}}function i(A){var D=l(A),z=D.transform,C=D.clip,B,y;delete D.clip;if(C&&C[2]!==-1){y=h("clipPath_");B={__type:"clipPath",id:y,children:[{__type:"rect",x:C[0],y:C[1],width:C[2],height:C[3]}]};D["clip-path"]="url(#"+y+")";k(B,D)}if(z){D.transform="matrix("+z.join(",")+")"}return D}function g(A){var B=i(A),E=w(B.fill),F=m(B.fill),y=B.fillOpacity,D=w(B.stroke),z=B.strokeOpacity,C=m(B.stroke);if(y===undefined){y=1}y*=F;if(z===undefined){z=1}z*=C;if(E){B.fill=E}if(y!==1){B["fill-opacity"]=y}if(D){B.stroke=D}if(z!==1){B["stroke-opacity"]=z}if(B.strokeThickness!==undefined){B["stroke-width"]=B.strokeThickness}if(B.strokeLineJoin!==undefined){B["stroke-linejoin"]=B.strokeLineJoin.toLowerCase()}if(B.strokeLineCap!==undefined){B["stroke-linecap"]=B.strokeLineCap.toLowerCase()}if(B.strokeMiterLimit!==undefined){B["stroke-miter-limit"]=B.strokeMiterLimit}delete B.strokeOpacity;delete B.fillOpacity;delete B.strokeThickness;delete B.strokeLineJoin;delete B.strokeLineCap;delete B.strokeMiterLimit;return B}u={radialGradient:n,linearGradient:n,pattern:function(y){var z={__type:"pattern",id:y.id,patternUnits:"userSpaceOnUse",width:y.width,height:y.height,children:[]};k({__type:"use","xlink:href":y.src,width:y.width,height:y.height},z);return z},blur:function(y){var z=j(y);k({__type:"feGaussianBlur","in":"SourceGraphic",stdDeviation:x(y.radius)},z);return z},dropShadow:function(F){var y=j(F),B,z,D,G,E,A,C;z={__type:"feComponentTransfer","in":"SourceAlpha",result:"compTransfer"};k(z,y);B=r(F.color);k(o("R",0,B[0]/255),z);k(o("G",0,B[1]/255),z);k(o("B",0,B[2]/255),z);k(o("A",F.opacity*B[3]/255,0),z);D={__type:"feGaussianBlur","in":"compTransfer",result:"blur",stdDeviation:x(F.radius)};k(D,y);A=F.angle*Math.PI/180;C=F.offset;G={__type:"feOffset","in":"blur",result:"castShadow",dx:C*Math.cos(A),dy:C*Math.sin(A)};k(G,y);E={__type:"feComposite"};if(F.knockout===true){E["in"]="castShadow";E.in2="SourceGraphic";E.operator="out"}else{E["in"]="SourceGraphic";E.in2="castShadow";E.operator="over"}k(E,y);return y},group:function(A){var B=i(A),z=A.children,y,C;B.__type="g";if(z!==undefined){for(y=0,C=z.length;y<C;y++){k(u[z[y].type](z[y]),B)}}else{B=undefined}return B},ellipse:function(z){var B=g(z),A=B.width,y=B.height;B.rx=A/2;B.ry=y/2;delete B.width;delete B.height;return B},image:function(z){var B=i(z),y,A;y={__type:"use","xlink:href":B.src};B.__type="g";A=z.__node.getLocalBounds();if(B.x!==undefined){y.x=B.x}if(B.y!==undefined){y.y=B.y}if(A){y.width=A.width;y.height=A.height}B.children=[y];delete B.src;delete B.x;delete B.y;delete B.width;delete B.height;return B},imageResource:function(y){return{__type:"symbol",id:y.id,children:[{__type:"image",width:"100%",height:"100%",preserveAspectRatio:"none","xlink:href":y.href}]}},line:g,path:function(z){var A=g(z),y=A.pathCommands;delete A.pathCommands;if(y){A.d=b.graphics.PathCommands.prototype.toString.call(y)}return A},rect:g,text:function(z){var A=g(z),y=b.layoutDir;if(A.fontSize!==undefined){A["font-size"]=A.fontSize}if(A.fontWeight===b.FontWeightEnum.BOLD){A["font-weight"]="bold"}if(A.underline===true){A["text-decoration"]="underline"}delete A.underline;if(A.textAlign!==undefined){A["text-anchor"]=v[y][A.textAlign]}if(A.textValue!==undefined){k(A.textValue,A);delete A.textValue}if(A.fontFamily!==undefined){A["font-family"]=A.fontFamily}A.direction=(y===b.RTL)?"rtl":"ltr";A["unicode-bidi"]="embed";delete A.fontSize;delete A.fontWeight;delete A.textAlign;delete A.fontFamily;return A},textBlock:function(B){var y=(B.x!==undefined)?B.x:0,D,A,F,C,E,z;delete B.textValue;delete B.x;delete B.y;C=B.__node.convertToText();F=C.length;if(F===1){D=u.text(B);D.__type="text";D.x=y;D.y=C[0]._style.y;k(C[0]._style.textValue,D)}else{if(f.noTspan===true){D={__type:"g"};if(B.transform){D.transform="matrix("+B.transform.join(",")+")";delete B.transform}for(A=0;A<F;A++){E=C[A];z=u.text(B);z.__type="text";z.x=E._style.x;z.y=E._style.y;k(E._style.textValue,z);k(z,D)}}else{D=u.text(B);D.__type="text";for(A=0;A<F;A++){E=C[A];z={__type:"tspan",x:y,y:E._style.y};k(E._style.textValue,z);k(z,D)}}}return D}};b.declare({name:"oui.io.svg.SVGExporter",membersDef:{init:function(){},snapshotNodes:function(A,D,y,z,C){var B=new b.io.JSONExporter().snapshotNodes(A,D,y,z);s={};f={noTspan:C};return this._toSVG(B)},_getSVGBoilerPlate:function(){return{__type:"svg",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",stroke:"none",fill:"black","fill-rule":"evenodd","font-size":12,"font-family":"Verdana","text-anchor":v[b.layoutDir].LINE_BEGIN,children:[{__type:"style",type:"text/css",children:["text {stroke: none;}"]}]}},_toSVG:function(I){var H=I.viewBox,C,G,B=I.resources,z=I.content.children,D,A=z?z.length:0,y,F,E;E=this._getSVGBoilerPlate();E.width=I.width;E.height=I.height;E.viewBox=H.join(" ");C={__type:"defs"};E.children.push(C);for(G in B){if(B.hasOwnProperty(G)===true){F=B[G];for(y in F){if(F.hasOwnProperty(y)){F[y].id=y;this._toSVGNode(F[y],C)}}}}for(D=0;D<A;D++){this._toSVGNode(z[D],E)}return E},_toSVGNode:function(z,y){var A=u[z.type];if(A){k(A(z),y)}}}})}());(function(){var j,o="px",e=[1,0,0,1,0,0];function p(q){c.warn("WARN__IO__HTML_FAIL",q.hasOwnProperty("type")?q.type:q)}function f(q){return q?q.y:0}function h(q){return q.substring(0,7)}function i(r){var q=r;if(r&&r.charAt(0)==="#"){q=h(r)}return q}function n(r,q){if(r){if(!q.children){q.children=[]}q.children.push(r)}}function m(r){var s={},q;for(q in r){if(r.hasOwnProperty(q)===true&&q!=="children"&&q!=="type"&&q!=="__node"){s[q]=r[q]}}if(r.hasOwnProperty("type")===true){s.__type=r.type}s.__style={};return s}function l(D){var F=D.stops,v,s,r="",B,t="",z="to ",y,x,E,A,u,w,C,G,q;if(F&&F.length>1){for(v=0,s=F.length;v<s;v++){B=F[v];r+=B.origColor.toString()+" "+Math.round(B.offset*100)+"%";if(v<s-1){r+=", "}}x="background-image: ";E=");";if(D.type==="linearGradient"){A="linear-gradient(";if(D.x1<D.x2){t+="left";z+="right";C=F[0].color;G=F[s-1].color;q=1}else{if(D.x1>D.x2){t+="right";z+="left";C=F[s-1].color;G=F[0].color;q=1}}if(D.y1<D.y2){t+=" top";z+=" bottom";C=F[0].color;G=F[s-1].color;q=0}else{if(D.y1>D.y2){t+=" bottom";z+=" top";C=F[s-1].color;G=F[0].color;q=0}}}else{A="radial-gradient(";t="center, ellipse cover";z="ellipse at center";C=F[0].color;G=F[s-1].color;q=1}w="progid:DXImageTransform.Microsoft.gradient(";u=A+t+", "+r+E;y=x+"-webkit-"+u;y+=x+"-moz-"+u;y+=x+"-ms-"+u;y+=x+"-o-"+u;y+='-ms-filter: "'+w+"startColorstr='"+h(C)+"', endColorstr='"+h(G)+"', GradientType="+q+')";';y+="filter: "+w+"startColorstr='"+h(C)+"', endColorstr='"+h(G)+"', GradientType="+q+E;y+=x+A+z+", "+r+E}else{y="background-color: black;"}return"."+D.id+"{"+y+"}"}function k(r){var t=m(r),q=t.transform,s=t.clip;t["class"]="ouiNodes";delete t.clip;if(s&&s[2]!==-1){p("clip")}if(q){t.__style.left=q[4]+o;t.__style.top=q[5]+o}delete t.transform;return t}function g(q){var r=k(q),t,s;if(q.htmlExportClassName){r["class"]+=" "+q.htmlExportClassName}else{t=i(r.fill);if(t){if(t.indexOf("url(#")===0){r["class"]+=" "+t.substring(5,t.length-1)}else{if(q.type==="text"||q.type==="textBlock"){r.__style.color=t}else{r.__style["background-color"]=t}}}if(r.fillOpacity){p("fill-opacity")}s=i(r.stroke);if(s){r.__style["border-color"]=s}if(r.strokeOpacity){p("stroke-opacity")}if(r.strokeThickness!==undefined){r.__style["border-width"]=r.strokeThickness}if(r.strokeLineJoin!==undefined){p("stroke-linejoin")}if(r.strokeLineCap!==undefined){p("stroke-linecap")}if(r.strokeMiterLimit!==undefined){p("stroke-miterlimit")}}delete r.htmlExportClassName;delete r.fill;delete r.stroke;delete r.strokeOpacity;delete r.fillOpacity;delete r.strokeThickness;delete r.strokeLineJoin;delete r.strokeLineCap;delete r.strokeMiterLimit;return r}j={radialGradient:l,linearGradient:l,pattern:function(r){var q="."+r.id+"{ ",s=r.origSrc;if(b.resourcesManager.hasResource(s)){q+="background-image: url("+b.resourcesManager._getBase64Data(s)+");"}else{p(r)}q+=" }";return q},blur:p,dropShadow:p,group:function(s){var t=k(s),r=s.children,q,u;t.__type="div";if(r!==undefined){for(q=0,u=r.length;q<u;q++){n(j[r[q].type](r[q]),t)}}else{t=undefined}return t},ellipse:p,image:function(r){var s=k(r),q=r.transform||e;s.__type="img";s.src=r.__node.toDataURL();if(s.width){s.__style.width=s.width+o}if(s.height){s.__style.height=s.height+o}if(s.x){s.__style.left=(s.x+q[4])+o}if(s.y){s.__style.top=(s.y+q[5])+o}delete s.x;delete s.y;delete s.width;delete s.height;return s},imageResource:function(){},line:g,path:p,rect:function(r){var s=g(r),q=r.transform||e;s.__type="div";s.__style.overflow="hidden";if(s.width){s.__style.width=s.width+o}if(s.height){s.__style.height=s.height+o}if(s.x){s.__style.left=(s.x+q[4])+o}if(s.y){s.__style.top=(s.y+q[5])+o}delete s.width;delete s.height;delete s.x;delete s.y;return s},text:function(t){var v=g(t),s=b.layoutDir,r=t.transform||e,u=t.__node._getBBoxImpl(),q=(v.x!==undefined)?v.x:0,w=f(u);v.__type="div";v.__style["white-space"]="pre";q+=r[4];if(s===b.RTL&&u){q-=u.width}if(q){v.__style.left=q+o}if(w){v.__style.top=(w+r[5])+o}if(v.fontFamily!==undefined){v.__style["font-family"]=v.fontFamily}if(v.fontSize!==undefined){v.__style["font-size"]=v.fontSize+o}if(v.fontWeight===b.FontWeightEnum.BOLD){v.__style["font-weight"]="bold"}if(v.underline===true){v.__style["text-decoration"]="underline"}if(v.textAlign!==undefined){p("textAlign")}if(v.textValue!==undefined){n(v.textValue,v)}v.dir=(s===b.RTL)?"rtl":"ltr";delete v.x;delete v.y;delete v.fontFamily;delete v.fontSize;delete v.fontWeight;delete v.underline;delete v.textAlign;delete v.textValue;return v},textBlock:function(B){var A=(B.x!==undefined)?B.x:0,w,s,y,u,z,v,r,q=B.transform||e,C;delete B.textValue;delete B.x;delete B.y;z=B.__node.convertToText();u=z.length;if(u===1){w=j.text(B);s=z[0]._getBBoxImpl();A+=q[4];if(b.layoutDir===b.RTL&&s){A-=s.width}w.__style.left=A+o;w.__style.top=(f(s)+q[5])+o;n(z[0]._style.textValue,w)}else{w={__type:"div",__style:{position:"absolute"}};w.__style.left=q[4]+o;w.__style.top=q[5]+o;for(y=0;y<u;y++){v=z[y];C=j.text(B);r=v._getBBoxImpl();C.__style.left=v._style.x+o;C.__style.top=f(r)+o;n(v._style.textValue,C);n(C,w)}}return w}};b.declare({name:"oui.io.html.HTMLExporter",membersDef:{init:function(){},snapshotNodes:function(s,u,q,r){var t=new b.io.JSONExporter().snapshotNodes(s,u,q,r);return this._toHTML(t)},_getHTMLBoilerPlate:function(){return{__type:"div",__style:{"font-size":12,"font-family":"Verdana"},children:[{__type:"style",type:"text/css",children:[".ouiNodes { position: absolute; left: 0px; }"]}]}},_toHTML:function(A){var v,z,u=A.resources,s=A.content.children,w,t=s?s.length:0,q,y,x;x=this._getHTMLBoilerPlate();x.__style={width:A.width+o,height:A.height+o,position:"relative"};x.dir=(b.layoutDir===b.RTL)?"rtl":"ltr";v={__type:"style",type:"text/css"};x.children.push(v);for(z in u){if(u.hasOwnProperty(z)===true){y=u[z];for(q in y){if(y.hasOwnProperty(q)){y[q].id=q;this._toHTMLNode(y[q],v)}}}}for(w=0;w<t;w++){this._toHTMLNode(s[w],x)}return x},_toHTMLNode:function(r,q){var s=j[r.type];if(s){n(s(r),q)}}}})}());(function(){function e(j,f,i){if(j){if(f===undefined){c.info(i?"INFO__I18N__MISSING":"INFO__I18N__INVALID",i)}else{var g,h;for(g in f){if(f.hasOwnProperty(g)&&f[g]){h=i?i+"."+g:g;if(!j[g]){c.info("INFO__I18N__UNSUPP",h)}else{if(b.isA(j[g],String)){j[g]=f[g]}else{e(j[g],f[g],h)}}}}for(g in j){if(j.hasOwnProperty(g)&&(!f.hasOwnProperty(g)||f[g]===undefined)){h=i?i+"."+g:g;c.info("INFO__I18N__MISSING",h)}}}}}b.addI18nSupport=function(g,f){g.Resources=f;g.prototype.Resources=f;g.updateResources=function(h){var j=this.Resources,i=this.prototype;if(i!==undefined&&i.Resources!==undefined){j=i.Resources}if(h!==undefined){e(j,h)}}}}());(function(){b.ns("oui.net");b.mixin(b.net,{goToURL:function(e,f){c.warn("WARN__NET__UNSUPP")}})}());return b}ouilib={createLiveGraphics:function(b,d){var c={};c.aboutInfo="FortKnox1.0#8348/Canvas (c)2008-2014, Oracle Corp.";if(d!==undefined&&d!==null){c.config=d;if(d.name&&c.aboutInfo){c.aboutInfo=d.name+" _ "+c.aboutInfo}}a(c);c.setUp(b);return c}}}());(function(c,b){var a={version:"12.2.1.3.0",build:"12.2.1.3.0-651-g83be7e7"};a.$=a.$||jQuery;a.RTree=a.RTree||RTree;a.Hammer=a.Hammer||Hammer;a.layer=a.layer||{};a.filter=a.filter||{};a.style=a.style||{};a.util=a.util||{};a.wmts=a.wmts||{};a.proj=a.proj||{};a.event=a.event||{};a.geometry=a.geometry||{};a.universe=a.universe||{};a.visualfilter=a.visualfilter||{};a.infowindow=a.infowindow||{};a.tool=a.tool||{};a.control=a.control||{};a.template=a.template||{};a.lbs=a.lbs||{};a.edit=a.edit||{};a.server=
a.server||{};a.Class=a.Class||function(){};(function(){if(!a.Class.extend){var e=!1;a.Class.extend=function(d){function f(){!e&&this.initialize&&this.initialize.apply(this,arguments)}var g=this.prototype;e=!0;var h=new this;e=!1;d.mixin&&(a.util.MiscUtil.mixin(h,d.mixin),delete d.mixin);var l=null,t=null,G;for(G in d)l=d[G],t=g[G],"function"===typeof l&&"function"===typeof t&&l!==t&&(l.base=t),h[G]=l;f.prototype=h;f.prototype.constructor=f;f.extend=arguments.callee;return f}}})();a.setJQuery=function(e){a.$=
e};a.setRTree=function(e){a.RTree=e};a.setHammer=function(e){a.Hammer=e};a.notNull=function(a){return"undefined"!==typeof a&&null!==a};a.isNotNull=a.notNull;a.isNull=function(a){return"undefined"===typeof a||null===a};a.isUndefined=a.isNull;(function(a){var d=navigator.userAgent.toLowerCase(),f=/webkit/.test(d),g="undefined"!==typeof orientation?!0:!1,h=/android/.test(d),l=/chrome/.test(d),t=/firefox/.test(d),G=/(mozilla)(?:.*? rv:([\w.]+))?/.test(d),I=/(opera)(?:.*version)?[ \/]([\w.]+)/.test(d),
O=/(msie) ([\w.]+)/.test(d);a.browser={msie:O,msie6:O&&!c.XMLHttpRequest,mozilla:G,webkit:f,safari:f,firefox:t,webkit3d:f&&"WebKitCSSMatrix"in c&&"m11"in new c.WebKitCSSMatrix,chrome:l,gecko:-1!==d.indexOf("gecko"),opera:I,android:h,mobileWebkit:g&&f,mobileOpera:g&&I,mobile:g,touchSupported:"ontouchstart"in c||c.DocumentTouch&&document instanceof DocumentTouch};a.browser.android&&(a.browser.androidVersion=parseFloat((d.match(/.+(?:android)[\/: ]([\d.]+)/)||[0,0])[1]))})(a);a.MapContext=function(e){var d=
e.getMapContextToken();return{getUniverse:function(){return d.universe},getPreviousZoomLevel:function(){return d.previousZoomLevel},getZoomLevel:function(){return d.zoomLevel},getPreviousCenterPoint:function(){return d.previousCenterPoint},getCenterPoint:function(){return d.centerPoint},getTransform:function(){if(!d.transform){var e=d.universe.getZoomLevels()[d.zoomLevel],g=this.getDeviceWidth()*e.resolution,e=this.getDeviceHeight()*e.resolution*e.stretchRatio,g={x:d.centerPoint.getX()-g/2,y:d.centerPoint.getY()-
e/2,w:g,h:e},e={x:0,y:0,w:this.getDeviceWidth(),h:this.getDeviceHeight()};d.transform=new a.util.ScreenTransform(g,e)}return d.transform},getDeviceWindow:function(){return d.deviceWindow},getDeviceWidth:function(){return d.deviceWindow.w},getDeviceHeight:function(){return d.deviceWindow.h},getQueryWindow:function(){var e=d.universe.getZoomLevels()[d.zoomLevel],g=d.centerPoint.getX(),h=d.centerPoint.getY();return new a.geometry.Rectangle(g-d.deviceWindow.w*e.resolution/2,h-d.deviceWindow.h*e.resolution*
e.stretchRatio/2,g+d.deviceWindow.w*e.resolution/2,h+d.deviceWindow.h*e.resolution*e.stretchRatio/2,d.universe.getSRID())},getGraphics:function(){return d.graphics},getRoundMapCenterPoint:function(){return d.roundMapCenterPoint},getWholeMapNum:function(){var a=d.universe.getZoomLevels()[d.zoomLevel],g=d.centerPoint.getX(),h=d.universe.getMapBounds().getWidth(),a=Math.ceil((g+d.deviceWindow.w/2*a.resolution-(g-d.deviceWindow.w/2*a.resolution))/h);!1===e.wraparound&&(a=1);return a},getBaseWholeMapIndex:function(){var a=
d.universe.getZoomLevels()[d.zoomLevel],e=d.centerPoint.getX(),h=d.universe.getMapBounds().getWidth(),a=e-d.deviceWindow.w/2*a.resolution,e=this.getWholeMapNum();if(1===e)return 0;for(var l=0,t=0;t<e;t++)a+h*t>=-h/2&&a+h*t<=h/2&&(l=t);return l}}};a.Messages={};a.Messages.getErrorMessage=function(e){var d=a.Messages[e];return d?e+": "+d:e};a.Messages.getString=function(e){var d=a.Messages[e];return d?d:e};a.Messages.fetched=!1;a.Messages.timeoutCount=0;a.$.i18n.map.MAPVIEWER_9001="Map tile layer not found. Check map tile layer name and/or data source name.";
a.$.i18n.map.MAPVIEWER_9002="Register theme failed.";a.$.i18n.map.MAPVIEWER_9003="Error when loading Nokia map lib.";a.$.i18n.map.MAPVIEWER_9004="Please provide TomTom map API key.";a.$.i18n.map.MAPVIEWER_9005="Feature ID is already used, please pick a new ID.";a.$.i18n.map.MAPVIEWER_9006="Error occurred when sending request to data server.";a.$.i18n.map.MAPVIEWER_9007="Cannot get data from data server.";a.$.i18n.map.MAPVIEWER_9008="Error occurred when getting RSS feed";a.$.i18n.map.MAPVIEWER_9009=
"Error occurred when sending request to map cache server.";a.$.i18n.map.MAPVIEWER_9010="Unsupported editing geometry.";a.$.i18n.map.MAPVIEWER_9011="A line needs at least 2 shape points.";a.$.i18n.map.MAPVIEWER_9012="A polygon needs at least 3 shape points.";a.$.i18n.map.MAPVIEWER_9013="Error occurred when parsing JSON format data.";a.$.i18n.map.MAPVIEWER_9014="Error occurred when sending HTTP request.";a.$.i18n.map.MAPVIEWER_9015="Not a valid line or polygon type.";a.$.i18n.map.MAPVIEWER_9016="Error occurred when calculating length in server side.";
a.$.i18n.map.MAPVIEWER_9017="Not a geodetic point.";a.$.i18n.map.MAPVIEWER_9018="One or more parameter is missing or invalid.";a.$.i18n.map.MAPVIEWER_9019="Geometry SRID is null.";a.$.i18n.map.MAPVIEWER_9020="Invalid URL.";a.$.i18n.map.MAPVIEWER_9021="Cannot undo.";a.$.i18n.map.MAPVIEWER_9022="Cannot redo.";a.$.i18n.map.MAPVIEWER_9023="Cannot load style.";a.$.i18n.map.MAPVIEWER_9024="Either a base marker or a set of marker styles must be specified.";a.$.i18n.map.MAPVIEWER_9025="Must specify either a baseColor or a pair of fromColor and toColor.";
a.$.i18n.map.MAPVIEWER_9026="Invalid classification specified.";a.$.i18n.map.MAPVIEWER_9027="Generating buckets.";a.$.i18n.map.MAPVIEWER_9028="Buckets exist, but classification is not 'custom'.";a.$.i18n.map.MAPVIEWER_9029="No styles found in the options.";a.$.i18n.map.MAPVIEWER_9030="Styles and buckets must be arrays of the same length.";a.$.i18n.map.MAPVIEWER_9031="Cannot switch tile layer.";a.$.i18n.map.MAPVIEWER_9032="Error when calling event listener.";a.$.i18n.map.MAPVIEWER_9033="SRID is different.";
a.$.i18n.map.MAPVIEWER_9034="No valid URL in selected text.";a.$.i18n.map.MAPVIEWER_9036="A subclass must implement the method: start";a.$.i18n.map.MAPVIEWER_9037="A subclass must implement the method: clear";a.$.i18n.map.MAPVIEWER_9038="Please select exactly one polygon feature first.";a.$.i18n.map.MAPVIEWER_9039="Invalid zoom level number.";a.$.i18n.map.MAPVIEWER_9040="You are running in SVG mode. To get map image, please include canvg.js(http://code.google.com/p/canvg/), or switch to canvas mode.";
a.$.i18n.map.MAPVIEWER_9041="localStorage is not supported in your browser.";a.$.i18n.map.MAPVIEWER_9042="Must specify style attributes for bucket style.";a.$.i18n.map.MAPVIEWER_9043="Cannot load NSDP data from the specified URL.";a.$.i18n.map.MAPVIEWER_9044="Cannot find the tiles folder. ";a.$.i18n.map.MAPVIEWER_9045="The end point should not be the same with the start point.";a.$.i18n.map.MAPVIEWER_9046="Not a valid geometry for this method.";a.$.i18n.map.MAPVIEWER_9047="Error occurred when calculating area in server side.";
a.$.i18n.map.MAPVIEWER_9048="Toolbar ID is already used, please pick a new ID.";a.$.i18n.map.MAPVIEWER_9049="Cannot load bounding box from vector layer.";a.$.i18n.map.MAPVIEWER_9050="Invalid map container div";a.$.i18n.map.MAPVIEWER_WB_TTILE="Add Text";a.$.i18n.map.MAPVIEWER_WB_TEXT="Text";a.$.i18n.map.MAPVIEWER_WB_X="Orientation value X axis";a.$.i18n.map.MAPVIEWER_WB_Y="Y axis";a.$.i18n.map.MAPVIEWER_WB_BOLD="Bold";a.$.i18n.map.MAPVIEWER_WB_ITALIC="Italic";a.$.i18n.map.MAPVIEWER_WB_ALIGN_LEFT="left align format";
a.$.i18n.map.MAPVIEWER_WB_ALIGN_CENTER="center align format";a.$.i18n.map.MAPVIEWER_WB_ALIGN_RIGHT="right align format";a.$.i18n.map.MAPVIEWER_WB_VALIGN_TOP="top align vertical format";a.$.i18n.map.MAPVIEWER_WB_VALIGN_CENTER="center align vertical format";a.$.i18n.map.MAPVIEWER_WB_VALIGN_BOTTOM="bottom align vertical format";a.$.i18n.map.MAPVIEWER_WB_OK="OK";a.$.i18n.map.MAPVIEWER_WB_PREVIEW="Preview";a.$.i18n.map.MAPVIEWER_LC_TITLE="Vector layer list";a.$.i18n.map.MAPVIEWER_TB_TIP_CLEAR="clear";
a.$.i18n.map.MAPVIEWER_TB_TIP_CIRCLE="circle";a.$.i18n.map.MAPVIEWER_TB_TIP_RECTANGLE="rectangle";a.$.i18n.map.MAPVIEWER_TB_TIP_REDLINE="redline";a.$.i18n.map.MAPVIEWER_TB_TIP_DISTANCE="distance";a.$.i18n.map.MAPVIEWER_TB_TIP_ZOOM="zoom";a.$.i18n.map.MAPVIEWER_SB_KILOMETERS="km";a.$.i18n.map.MAPVIEWER_SB_METERS="m";a.$.i18n.map.MAPVIEWER_SB_MILES="mi";a.$.i18n.map.MAPVIEWER_SB_FEET="ft";a.$.i18n.map.MAPVIEWER_SB_CENTIMETER="cm";a.$.i18n.map.MAPVIEWER_SB_YARD="yd";a.$.i18n.map.MAPVIEWER_SB_TOTAL_DISTANCE=
"Total Distance";a.$.i18n.map.MAPVIEWER_SB_SUB_DISTANCE="Sub Distance";a.CursorTypes={AUTO:"AUTO",MOVE:"MOVE",POINTER:"POINTER",DEFAULT:"DEFAULT",TEXT:"TEXT",WAIT:"WAIT",NONE:"NONE",CUSTOM:"CUSTOM"};a.LayerTypes={TILE:0,VECTOR:1,EXTERNAL:2,DYNAMIC_TILE:3,WMTS_TILE:4};a.LineCaps={BUTT:"BUTT",ROUND:"ROUND",SQUARE:"SQUARE"};a.LineJoins={MITER:"MITER",ROUND:"ROUND",BEVEL:"BEVEL"};a.GeomTypes={POINT:"Point",MULTIPOINT:"MultiPoint",ORIENTEDPOINT:"OrientedPoint",ORIENTEDMULTIPOINT:"OrientedMultiPoint",LINESTRING:"LineString",
MULTILINESTRING:"MultiLineString",POLYGON:"Polygon",MULTIPOLYGON:"MultiPolygon",CIRCLE:"Circle",RECTANGLE:"Rectangle",GEOMETRYCOLLECTION:"GeometryCollection"};a.Text={FONTSTYLE_NORMAL:"NORMAL",FONTSTYLE_ITALIC:"ITALIC",FONTWEIGHT_NORMAL:"NORMAL",FONTWEIGHT_BOLD:"BOLD",HORIZONTALALIGN_LEFT:"LEFT",HORIZONTALALIGN_CENTER:"CENTER",HORIZONTALALIGN_RIGHT:"RIGHT",VERTICALALIGN_TOP:"TOP",VERTICALALIGN_CENTER:"CENTERV",VERTICALALIGN_BOTTOM:"BOTTOM"};a.PaintTypes={NO_PAINT:0};a.gv=a.gv||{};a.gv.proxyPath="/mapviewer/proxy";
a.gv.setProxyPath=function(e){e&&(a.gv.proxyPath=e)};a.gv.getProxyPath=function(){return a.gv.proxyPath};a.gv.proxyEnabled=!1;a.gv.enableProxy=function(e){null!==e&&(a.gv.proxyEnabled=e)};a.gv.isProxyEnabled=function(){return a.gv.proxyEnabled};a.gv._baseURL=document.location.protocol+"//"+document.location.host+"/mapviewer";a.gv.localbaseURL=function(){return a.gv._baseURL};a.gv.setBaseMapViewerURL=function(e){e&&e.indexOf("/mapviewer")&&0===e.indexOf("http")&&(a.gv._baseURL=e)};a.gv.getBaseMapViewerURL=
function(){return a.gv._baseURL};a.gv.defaultDataSource=null;a.gv._resPath=document.location.protocol+"//"+document.location.host+"/mapviewer/jslib/v2/images/";a.gv._cssResPath=document.location.protocol+"//"+document.location.host+"/mapviewer/jslib/v2/css/";a.gv._protoPath=document.location.protocol+"//"+document.location.host+"/mapviewer/jslib/v2/protobuf/";a.gv.getImgResourcePath=function(){return a.gv._resPath};a.gv.resourcePath=a.gv.getImgResourcePath;a.gv.getCSSResourcePath=function(){return a.gv._cssResPath};
a.gv.getProtoResourcePath=function(){return a.gv._protoPath};a.gv.cssResourcePath=a.gv.getCSSResourcePath;a.gv.setResourcePath=function(e){e&&(0>e.indexOf("/",e.length-1)&&(e+="/"),a.gv._cssResPath=e+"css/",a.gv._resPath=e+"images/",a.gv._protoPath=e+"protobuf/",a.gv.messagePath=e+"messages/",a.control.MapDecoration.setIconsPath(),a.tool.WhiteBoardTool&&a.tool.WhiteBoardTool.setIconsPath())};a.gv._secureHttp=document.location.protocol;"file:"===a.gv._secureHttp&&(a.gv._secureHttp="http:");a.gv.secureHttp=
function(){return a.gv._secureHttp};a.gv.setSecureHttp=function(e){a.gv._secureHttp=e?"https:":"http:"};a.gv.useSecureHTTP=function(e){a.gv._secureHttp=e?"https:":"http:"};a.gv.isSecureHTTPEnabled=function(){return"https:"===a.gv._secureHttp};a.gv.CacheConfig=Array(30);a.gv.infoWindowWidth=180;a.gv.infoWindowHeight=100;a.gv.infoWindowTabsWidth=240;a.gv.infoWindowTabsHeight=130;a.gv.decorationCollapseButtonSizeTouch=24;a.gv.decorationCollapseButtonSizeNoTouch=18;a.gv.unitFactors={SQ_MM:1E-6,SQ_KILOMETER:1E6,
SQ_CENTIMETER:1E-4,SQ_MILLIMETER:1E-6,SQ_CH:404.6856,SQ_FT:.09290304,SQ_IN:6.4516E-4,SQ_LI:.04046856,SQ_CHAIN:404.6856,SQ_FOOT:.09290304,SQ_INCH:6.4516E-4,SQ_LINK:.04046856,SQ_MILE:2589988,SQ_ROD:25.29285,SQ_SURVEY_FOOT:.09290341,SQ_YARD:.8361274,ACRE:4046.856,HECTARE:1E4,PERCH:25.29285,ROOD:1011.714,M:1,METER:1,METRE:1,KM:1E3,KILOMETER:1E3,CM:.01,CENTIMETER:.01,MM:.001,MILLIMETER:.001,MILE:1609.344,NAUT_MILE:1852,SURVEY_FOOT:.3048006096012,FOOT:.3048,"U.S FOOT":.3048,FEET:.3048,INCH:.0254,YARD:.9144,
CHAIN:20.1168,ROD:5.0292,LINK:.201166195,MOD_USFT:.304812253,CL_FT:.304797265,IND_FT:.304799518,LINK_BEN:.201167651,LINK_SRS:.201167651,CHN_BEN:20.1167825,CHN_SRS:20.1167651,IND_YARD:.914398554,SRS_YARD:.914398415,FATHOM:1.8288,SQ_M:1,SQ_METER:1,SQ_KM:1E6,SQ_CM:1E-4};a.gv.toolButtonW=14;a.gv.toolButtonH=14;a.gv.DPI=96;a.gv.getUnitFactor=function(e){if(e)e=e.toUpperCase();else return 0;return a.gv.unitFactors[e]?a.gv.unitFactors[e]:0};a.gv.defaultMarkerStyleWidth=15;a.gv.defaultMarkerStyleHeight=15;
a.gv.defaultMarkerStyle={fill:"#ff2244",stroke:"#ff2244",strokeThickness:1,fillOpacity:.5};a.gv.loadingIcon="o_loading.gif";a.gv.defaultTextStyleConfig={fontSize:12,fill:"#ff0000"};a.gv.labelDisplayOrder=["R","L","B","T"];a.gv.orientedLabelDisplayOrder=["R","L"];a.gv.mapInstanceId=0;a.gv.enableSelfDestroy=!0;a.gv.mapInstances=[];a.gv.mvKeyMap=[];a.gv.clearMapInstanceByDiv=function(e){for(var d=a.gv.mapInstances,f=d.length,g=0;g<f;g++){var h=d[g];if(h&&h.$containerDiv){var l=h.$containerDiv[0];if(l===
e)h.destroyMap();else{for(var t=!1;l&&l.parentNode;)if(l=l.parentNode,l===document.body){t=!0;break}t||h.destroyMap()}}}};a.gv.addMapInstance=function(e,d){a.gv.enableSelfDestroy&&a.gv.clearMapInstanceByDiv(d);a.gv.mapInstances.push(e)};a.gv.addCSTransformFunction=function(e,d,f){a.util.CSTransformUtil.addCSTransformFunction(e,d,f)};a.gv.srs={};a.gv.addSRS=function(e,d,f){a.gv.srs[f]={type:e,unit:d,srid:f}};a.gv.getSRS=function(e){return a.gv.srs[e]};a.gv.clearAllMapInstance=function(){if(a.notNull(a.gv.mapInstances))for(var e=
a.gv.mapInstances;0<e.length;){var d=e.pop();d.over||d.destroyMap()}};a.gv.messagePath="/mapviewer/jslib/v2/messages/";a.gv.msgLoaded=!1;a.gv.loadMessage=function(e){a.gv.msgLoaded=!0;var d="en zh-CN ar cs da de el es fi fr hu it iw ja ko nl no pl pt pt-BR ro ru sk sv th tr zh-TW".split(" ");if(a.isNull(e)||""===e)e=(e=c.navigator.languages?c.navigator.languages[0]:null)||c.navigator.language||c.navigator.browserLanguage||c.navigator.userLanguage;e=e&&-1<d.indexOf(e)?e:e&&2<e.length&&d.indexOf(e.substring(0,
2))?e.substring(0,2):"en";var f=a.gv.messagePath;a.$.i18n.properties({name:"Messages",path:f,mode:"both",async:"true",language:e,callback:function(){"undefined"===typeof MAPVIEWER_9001&&a.util.Logger.warning(null,"Cannot load message files from "+f)}})};a.$(c).on("unload",function(){a.gv.clearAllMapInstance()});a.browser.msie&&(document.msCSSOMElementFloatMetrics=!0);a.gv.getLabel=function(e,d){var f=a.$.i18n.prop(e);d&&(f=f.replace(/\s/g,"\x26nbsp;"));return f};a.gv.setHttpMethod=function(e){e&&
"GET"===e.toUpperCase()?a.gv._httpMethod="GET":a.gv._httpMethod="POST"};a.gv.setHttpMethod("POST");a.gv.isWin8Touch=!1;c.navigator.msMaxTouchPoints&&c.navigator.msPointerEnabled&&(a.gv.isWin8Touch=!0);a.gv.tabIndexEnabled=!0;a.gv.setTabIndexEnabled=function(e){a.gv.tabIndexEnabled=e?!0:!1};a.gv.setLogLevel=function(e){a.isNull(e)||(e=e.toLowerCase(),e=a.util.Logger.LEVELS[e],a.isNull(e)?a.util.Logger.warning(null,"OM.gv.setLogLevel","Invalid log level specified."):a.util.Logger.currentLevel=e)};a.gv.getLogLevel=
function(){return a.isNull(a.util.Logger.currentLevel)?"":a.util.Logger.LEVELS_TEXT[a.util.Logger.currentLevel]};a.gv.showManipulator=!0;a.gv.setShowManipulator=function(e){a.gv.showManipulator=e?!0:!1};a.gv.featureDrag=!0;a.gv.enableFeatureDragging=function(e){a.gv.featureDrag=e?!0:!1};a.gv.featureDragDisabled=function(e){var d="Point"===e.geo.type||"OrientedPoint"===e.geo.type;return a.isNull(e.parentFeature)&&!d&&!a.gv.featureDrag};a.gv.internalLayersEnabled=!0;a.gv.useRTree=!0;a.gv.setUseRTree=
function(e){e&&(a.gv.useRTree=e)};a.gv.getUseRTree=function(){return a.gv.useRTree};a.gv.touchMoveThreshold=5;a.gv.setTouchMoveThreshold=function(e){0<=e&&(a.gv.touchMoveThreshold=e)};a.gv.allowFeaturePointsInteraction=!0;a.gv.MAX_ZOOM="MAX_ZOOM";a.gv.MID_ZOOM="MID_ZOOM";a.gv.pointZoomLevel=a.gv.MID_ZOOM;String.prototype.replaceAll||(String.prototype.replaceAll=function(a,d){return this.split(a).join(d)});a.Graphics=function(e,d){this.div=e;var f=a.$(this.div);this.width=f.width();this.height=f.height();
a.notNull(d)&&(this.hiDPI=d.hiDPI);this.oui=ouilib.createLiveGraphics(this.div,{defaultViewportWidth:this.width,defaultViewportHeight:this.height,hiDPI:this.hiDPI,frameRate:60});this.oui.tooltipManager._properties.cursorOffset=10;this.oui.tooltipManager._properties.dismissDelay=5E3;this.oui.tooltipManager.setHideDelay(0);this.setDefaultTooltipStyle()};a.Graphics.EVENT_CLICK="click";a.Graphics.EVENT_DOUBLE_CLICK="doubleClick";a.Graphics.EVENT_MOUSE_DOWN="mouseDown";a.Graphics.EVENT_MOUSE_UP="mouseUp";
a.Graphics.EVENT_MOUSE_OVER="mouseOver";a.Graphics.EVENT_MOUSE_OUT="mouseOut";a.Graphics.EVENT_MOUSE_LEAVE="mouseLeave";a.Graphics.EVENT_MOUSE_MOVE="mouseMove";a.Graphics.EVENT_MOUSE_DRAG="drag";a.Graphics.TYPE_GROUP=1;a.Graphics.TYPE_IMAGE=2;a.Graphics.TYPE_IMAGE_MARKER=3;a.Graphics.TYPE_SIMPLE_VECTOR_MARKER=4;a.Graphics.TYPE_COMPOUND_VECTOR_MARKER=5;a.Graphics.TYPE_PATH=6;a.Graphics.TYPE_RECTANGLE=7;a.Graphics.TYPE_ELLIPSE=8;a.Graphics.prototype.createGroup=function(e){e=new this.oui.graphics.Group(e);
e.vtype=a.Graphics.TYPE_GROUP;return e};a.Graphics.prototype.setTooltipStyle=function(a){this.oui.tooltipManager.applyStyle(a)};a.Graphics.prototype.getTooltipManager=function(){return this.oui.tooltipManager};a.Graphics.prototype.setDefaultTooltipStyle=function(){var e=new a.style.Text({styleName:"title",fill:"#000000",fontStyle:a.Text.FONTSTYLE_NORMAL,fontWeight:a.Text.FONTWEIGHT_BOLD,fontFamily:"Helvetica Neue",fontSize:11,hAlign:0,vAlign:.5}),d=new a.style.Text({styleName:"header",fill:"#B5B5B5",
fontStyle:a.Text.FONTSTYLE_NORMAL,fontFamily:"Helvetica Neue",fontSize:10,hAlign:1,vAlign:.5}),f=new a.style.Text({styleName:"txt",fill:"#000000",fontStyle:a.Text.FONTSTYLE_NORMAL,fontFamily:"Helvetica Neue",fontSize:10,hAlign:0,vAlign:.5});this.defaultTooltipStyle={background:this.oui.WHITE,border:{stroke:"#3B3B3B",rx:0,ry:0,thickness:4},text:{fill:this.oui.BLACK,fontSize:11},shadow:this.getGraphicFilter({type:"DROPSHADOW",offset:5})};this.currentTooltipStyle={titleStyle:e,headerStyle:d,contentStyle:f,
padding:{top:9,lineBegin:9,bottom:9,lineEnd:9}};this.setTooltipStyle(this.defaultTooltipStyle)};a.Graphics.prototype.getInnerTooltipStyle=function(){return this.currentTooltipStyle};a.Graphics.prototype.storeCustomTooltipTextStyle=function(e){a.notNull(e)&&(a.notNull(e.titleStyle)&&0<Object.getOwnPropertyNames(e.titleStyle).length&&(this.currentTooltipStyle.titleStyle=e.titleStyle),a.notNull(e.headerStyle)&&0<Object.getOwnPropertyNames(e.headerStyle).length&&(this.currentTooltipStyle.headerStyle=
e.headerStyle),a.notNull(e.contentStyle)&&0<Object.getOwnPropertyNames(e.contentStyle).length&&(this.currentTooltipStyle.contentStyle=e.contentStyle))};a.Graphics.prototype.addGroup=function(e,d){a.notNull(d)?d.appendChild(e):this.oui.rootNode.appendChild(e)};a.Graphics.prototype.setCursor=function(e,d){if(a.notNull(this.oui.tree.canvas)){for(var f=this.oui.tree.canvas,g="AUTO";e&&"AUTO"===g;)g=d,e=e.parentNode;f.style.cursor="object"===typeof d?"none":g}else a.notNull(this.oui.tree.svgNode)&&this.oui.tree.svgNode.attr("cursor",
"object"===typeof d?"none":d)};a.Graphics.prototype.drawImage=function(e,d,f){if(!e)return null;var g=f.group;g||(g=this.oui.rootNode);this.setId(g,f);d.x=e.x;d.y=e.y;d.width&&d.height&&(d.preserveAspectRatio=!0);if(f&&f.angle){var h=e.x+d.width/2;e=e.y+d.height/2;f=(new this.oui.geom.Matrix).rotate(f.angle,h,e);d.transform=f}d=new this.oui.graphics.Image(d);g.appendChild(d);d.vtype=a.Graphics.TYPE_IMAGE;return d};a.Graphics.prototype.drawImageMarker=function(a,d,f){f.xOffset&&(a.x+=f.xOffset);f.yOffset&&
(a.y+=f.yOffset);return d&&d.src?(d.width&&(a.x-=d.width/2),d.height&&(a.y-=d.height/2),a=this.drawImage(a,d,f)):null};a.Graphics.prototype.drawVectorMarker=function(e,d,f){f.xOffset&&(e.x+=f.xOffset);f.yOffset&&(e.y+=f.yOffset);f.width&&(e.x-=f.width/2);f.height&&(e.y-=f.height/2);f.transform=(new this.oui.geom.Matrix).translate(e.x,e.y);e=f.xScale?f.xScale:1;var g=f.yScale?f.yScale:1;if(1!=e||1!=g)f.transform=f.transform.scale(e,g);f.angle&&f.transform.rotate(f.angle,f.width/2/e,f.height/2/g);if(d&&
0<d.length){var h,l;e=f.group;1<=d.length&&(f.group=this.createGroup({transform:f.transform}),f.transform=null);h=null;for(g=0;g<d.length;g++){h=d[g].shape;l=d[g].style;l.transform=f.transform;a.isNull(l.fill)&&(l.fill="#ffffff",l.fillOpacity=0);a.notNull(f.gradient)&&(l.fill=f.gradient);var t=h.type;h="path"===t?this.drawPath(h.coords,l,f):"rectangle"===t?this.drawRectangle(h,l,f):this.drawEllipse(h,l,f)}if(e===f.group)return h.vtype=a.Graphics.TYPE_SIMPLE_VECTOR_MARKER,h;this.addGroup(f.group,e);
f.group.vtype=a.Graphics.TYPE_COMPOUND_VECTOR_MARKER;d=f.group;f.group=e;return d}return null};a.Graphics.prototype.drawRectangle=function(e,d,f){if(!e||a.isNull(e.x)||a.isNull(e.y)||a.isNull(e.width)&&a.isNull(e.rx)||a.isNull(e.height)&&a.isNull(e.ry))return null;var g=f.group;g||(g=this.oui.rootNode);this.setId(g,f);a.isNull(d.fill)&&(d.fill=this.oui.NO_PAINT);d.x=e.x;d.y=e.y;a.notNull(e.width)&&(d.width=e.width);a.notNull(e.rx)&&(d.rx=e.rx);a.notNull(e.height)&&(d.height=e.height);a.notNull(e.ry)&&
(d.ry=e.ry);e=new this.oui.graphics.Rectangle(d);e.vtype=a.Graphics.TYPE_RECTANGLE;g.appendChild(e);return e};a.Graphics.prototype.drawEllipse=function(e,d,f){if(!e||a.isNull(e.cx)||a.isNull(e.cy)||a.isNull(e.width)||a.isNull(e.height))return null;var g=f.group;g||(g=this.oui.rootNode);this.setId(g,f);a.isNull(d.fill)&&(d.fill=this.oui.NO_PAINT);d.cx=e.cx;d.cy=e.cy;d.width=e.width;d.height=e.height;var h=new this.oui.graphics.Ellipse(d);h.vtype=a.Graphics.TYPE_ELLIPSE;g.appendChild(h);a.notNull(d.inset)&&
(h=a.isNull(d.insetThickness)?1.25/f.xScale:d.insetThickness,f=a.isNull(d.strokeThickness)?1.75/f.xScale:d.strokeThickness,h=new this.oui.graphics.Ellipse({fill:this.oui.NO_PAINT,cx:e.cx,cy:e.cy,width:e.width-2*f-h,height:e.height-2*f-h,stroke:d.inset,strokeThickness:h}),h.vtype=a.Graphics.TYPE_ELLIPSE,g.appendChild(h));return h};a.Graphics.prototype.drawPath=function(e,d,f){for(var g=new this.oui.graphics.PathCommands,h=0,l=e.length;h<l;h++)this.drawSegment(g,e[h],f);e=f.group;e||(e=this.oui.rootNode);
this.setId(e,f);a.isNull(d.fill)&&(d.fill=this.oui.NO_PAINT);d.pathCommands=g;d=new this.oui.graphics.Path(d);e.appendChild(d);d.vtype=a.Graphics.TYPE_PATH;return d};a.Graphics.prototype.drawText=function(a,d){var f=d.group;f||(f=this.oui.rootNode);var g=new this.oui.graphics.Text(a);f.appendChild(g);g.vtype="TEXT";return g};a.Graphics.prototype.attachEventListener=function(e,d,f){a.isNull(f)&&(f=this.oui.rootNode);f.addEventListener(e,d)};a.Graphics.prototype.detachEventListener=function(e,d,f){a.isNull(f)&&
(f=this.oui.rootNode);f.removeEventListener(e,d)};a.Graphics.prototype.getLeftTop=function(a){return a.getTranslation()};a.Graphics.prototype.setLeftTop=function(a,d,f){return a.setTranslation(d,f)};a.Graphics.prototype.setImageMarker=function(a,d,f){if(f){if(d){var g=a.getWidth(),h=a.getHeight();f.width&&(g=f.width);f.height&&(h=f.height);f.x=d.x-g/2;f.y=d.y-h/2}else f.width&&(f.x=a.getX()-(f.width-a.getWidth())/2),f.height&&(f.y=a.getY()-(f.height-a.getHeight())/2);a.applyStyle(f)}else d&&(d.x-=
a.getWidth()/2,d.y-=a.getHeight()/2,a.applyStyle(d))};a.Graphics.prototype.setImage=function(a,d,f){f?(d&&(f.x=d.x,f.y=d.y),f.width&&f.height&&(f.preserveAspectRatio=!0),a.applyStyle(f)):d&&a.applyStyle(d)};a.Graphics.prototype.setRectangle=function(e,d,f){e.vtype==a.Graphics.TYPE_RECTANGLE&&(f?(d&&(f.x=d.x,f.y=d.y,a.notNull(d.width)?f.width=d.width:f.rx=d.rx,a.notNull(d.height)?f.height=d.height:f.ry=d.ry),e.applyStyle(f)):e.applyStyle(d))};a.Graphics.prototype.setEllipse=function(e,d,f){e.vtype===
a.Graphics.TYPE_ELLIPSE&&(f?(d&&(a.notNull(d.cx)&&(f.cx=d.cx),a.notNull(d.cy)&&(f.cy=d.cy),a.notNull(d.width)&&(f.width=d.width),a.notNull(d.height)&&(f.height=d.height)),e.applyStyle(f)):d&&e.applyStyle(d))};a.Graphics.prototype.setPath=function(e,d,f){if(e.vtype===a.Graphics.TYPE_PATH){var g=null;if(d)for(var g=new this.oui.graphics.PathCommands,h=0,l=d.length;h<l;h++)this.drawSegment(g,d[h]);f?(f.pathCommands=g,e.applyStyle(f)):g&&e.applyStyle({pathCommands:g})}};a.Graphics.prototype.remove=function(a){a&&
a.parentNode&&a.parentNode.removeChild(a)};a.Graphics.prototype.removeAll=function(){this.oui.rootNode.removeChildren()};a.Graphics.prototype.bringForward=function(a){a.bringForward()};a.Graphics.prototype.bringToTop=function(a){a.bringToFront()};a.Graphics.prototype.sendBackward=function(a){a.sendBackward()};a.Graphics.prototype.sendToBottom=function(a){a.sendToBack()};a.Graphics.prototype.getDisplayIndex=function(a){return a.parentNode?a.parentNode.getChildIndex(a):-1};a.Graphics.prototype.setDisplayIndex=
function(a,d){a.parentNode&&a.parentNode.setChildIndex(a,d)};a.Graphics.prototype.applyStyle=function(a,d){a.applyStyle(d)};a.Graphics.prototype.drawSegment=function(a,d,f){if(d&&d.length&&!(2>d.length)&&!isNaN(d[0])&&!isNaN(d[1]))if(f&&f.scTransform)f.genThreshold||(f.genThreshold=1),this.drawSegmentWithTransform(a,d,f);else{a._safeMoveTo(Math.round(d[0]),Math.round(d[1]));f=2;for(var g=d.length;f<g;f+=2)a._safeLineTo(Math.round(d[f]),Math.round(d[f+1]));d[0]==d[g-2]&&d[1]==d[g-1]&&a.closePath()}};
a.Graphics.prototype.drawSegmentWithTransform=function(a,d,f){var g=f.scTransform,h=g.transformPoint(d[0],d[1]),l=h.x,t=h.y;a._safeMoveTo(Math.round(h.x),Math.round(h.y));f=f.genThreshold;for(var G=2,I=d.length-2;G<I;G+=2){var h=g.transformPoint(d[G],d[G+1]),O=Math.round(h.x),h=Math.round(h.y),X=O-l,S=h-t;X>f||X<-f||S>f||S<-f||a._safeLineTo(O,h)}h=g.transformPoint(d[I-2],d[I-1]);a._safeLineTo(Math.round(h.x),Math.round(h.y))};a.Graphics.prototype.setId=function(e,d){a.isNull(d.id)&&(d.id=e.length);
d.name=d.id?"path_"+d.id:"path_"+e.length};a.Graphics.prototype.setImageStyleLocation=function(a,d){a.x=d.x;a.y=d.y;a.width&&a.height&&(a.preserveAspectRatio=!0)};a.Graphics.prototype.setImageStyle=function(a){a.width&&a.height&&(a.preserveAspectRatio=!0)};a.Graphics.prototype.zoom=function(e,d){e.curScaleX=d.beginValue;e.curScaleY=d.beginValue;e.zoomPointXOffset=d.zoomPointXOffset;e.zoomPointYOffset=d.zoomPointYOffset;var f=new this.oui.anim.AnimateStyle({targetNode:e,beginValue:d.beginValue,endValue:d.endValue,
dur:d.duration,interpolator:function(f,h,l){f=(h-f)*l+f;l=h=1;var t=0,G=0;a.notNull(d.zoomPointXOffset)&&(t=-(e.zoomPointXOffset/f*e.curScaleX)+e.zoomPointXOffset,h=f/e.curScaleX);a.notNull(d.zoomPointYOffset)&&(G=-(e.zoomPointYOffset/f*e.curScaleY)+e.zoomPointYOffset,l=f/e.curScaleX);e.scale(h,l);e.translate(-t,-G);e.curScaleX=f;e.curScaleY=f}});d.endListener&&f.addEventListener(this.oui.EventTypes.END,function(a){d.endListener(a)});f.beginAt(0)};a.Graphics.prototype.setVisible=function(a,d){a.setVisibility(d)};
a.Graphics.prototype.isVisible=function(a){return a.getVisibility()};a.Graphics.prototype.clearGroup=function(a){a&&a.removeChildren()};a.Graphics.prototype.getGraphicFilter=function(a){if(a&&"DROPSHADOW"==a.type)return new this.oui.filters.DropShadow({opacity:a.opacity,color:a.color,offset:a.offset,radius:a.radius,knockout:a.knockout,angle:a.angle});if(a&&"BLUR"==a.type)return new this.oui.filters.Blur;if(a&&"GLOW"==a.type)return new this.oui.filters.Glow({color:"#ffff00",strength:10})};a.Graphics.prototype.setRotationTransform=
function(e,d){if(e&&d){a.isNull(e.width)&&(e.width=0);a.isNull(e.height)&&(e.height=0);var f=e.x+e.width/2,g=e.y+e.height/2,f=(new this.oui.geom.Matrix).rotate(d,f,g);e.transform=f}return e};a.Graphics.prototype.getWidthHeight=function(e){if(a.isNull(e))return null;e=e.getLocalBounds();return{w:e.width,h:e.height}};a.Graphics.prototype.setOpacity=function(a,d){a&&a.setOpacity(d)};a.Graphics.prototype.getTextSize=function(a,d){var f;f=0<a.indexOf("\n")?this.createTextBlock(a,d,0,0).node:this.createTextNode(a,
d,0,0);this.oui.rootNode.appendChild(f);f.setDisplay(!1);var g=this.getWidthHeight(f);this.remove(f);return g};a.Graphics.prototype.createTextNode=function(a,d,f,g){return d?this.oui.load({type:"text",textValue:a,fontFamily:d.fontFamily,fontSize:d.fontSize,fontStyle:d.fontStyle,fontWeight:d.fontWeight,fill:d.fill,x:f,y:g,textAlign:d.textAlign}):this.oui.load({type:"text",textValue:a,x:f,y:g})};a.Graphics.prototype.drawPieChart=function(e,d,f,g){if(!e||a.isNull(e.cx)||a.isNull(e.cy)||a.isNull(e.width)||
a.isNull(e.height)||a.isNull(d)||0===d.length||a.isNull(f)||f.length!==d.length)return null;var h=g.offsetAngle?g.offsetAngle:0,l=[];l.push(0);var t=0,G=e.width/2,I=e.height/2,O=g.group;O||(O=this.oui.rootNode);this.setId(O,g);var X=this.createGroup();this.addGroup(X,O);for(O=0;O<d.length;O++)t+=d[O],l.push(t);for(O=0;O<d.length;O++){var S=g.orientation&&2==g.orientation?l[O]/t*360+h:-(l[O]/t*360+h),ca=g.orientation&&2==g.orientation?l[O+1]/t*360+h:-(l[O+1]/t*360+h),sa=Math.round(d[O]/t*1E4)/100+
"%",S=this.drawSector(e.cx,e.cy,S,ca,G,I,{fill:f[O],stroke:g.stroke,strokeThickness:g.strokeThickness},g.plugable,g.description&&g.description[O]?g.description[O]+" \n value:"+d[O]+" \n percent:"+sa:null);X.appendChild(S);S.vtype=a.Graphics.TYPE_PATH}X.applyStyle({filter:g.filter});return X};a.Graphics.prototype.drawSector=function(e,d,f,g,h,l,t,G,I){a.isNull(t.fill)&&(t.fill=this.oui.NO_PAINT);t.cx=e;t.cy=d;t.maxAngle=g;t.minAngle=f;t.minRadius=0;t.maxRadius=h;e=new this.oui.graphics.DiskSector(t);
if(!G||G&&!0===G)this.attachEventListener(a.Graphics.EVENT_MOUSE_OVER,function(a){a.target.parentNode.bringToFront();a.target.bringToFront();a.target.applyStyle({maxRadius:1.1*h});for(var e=a.target.parentNode.childrenCount,d=0;d<e;d++)a.target.parentNode.getChildAt(d)!==a.target&&a.target.parentNode.getChildAt(d).applyStyle({fillOpacity:.5})},e),this.attachEventListener(a.Graphics.EVENT_MOUSE_OUT,function(a){a.target.applyStyle({maxRadius:h});for(var e=a.target.parentNode.childrenCount,d=0;d<e;d++)a.target.parentNode.getChildAt(d).applyStyle({fillOpacity:1})},
e),e.applyStyle({tooltip:I});return e};a.Graphics.prototype.drawBarChart=function(e,d,f,g){if(!e||a.isNull(e.cx)||a.isNull(e.cy)||a.isNull(e.width)||a.isNull(e.height)||a.isNull(d)||0===d.length||a.isNull(f)||f.length!==d.length)return null;var h=g.group;h||(h=this.oui.rootNode);this.setId(h,g);var l=this.createGroup();this.addGroup(l,h);for(var t=h=0,G=0;G<d.length;G++)t+=Math.abs(d[G]),h<Math.abs(d[G])&&(h=Math.abs(d[G]));for(var G=e.height,I=e.width/d.length,O,X=function(a){a.target.parentNode.bringToFront();
a.target.bringToFront();a.target.scale(1.1,1.1);for(var e=a.target.parentNode.childrenCount,d=0;d<e;d++)a.target.parentNode.getChildAt(d)!=a.target&&a.target.parentNode.getChildAt(d).applyStyle({fillOpacity:.4})},S=function(a){a.target.scale(1/1.1,1/1.1);for(var e=a.target.parentNode.childrenCount,d=0;d<e;d++)a.target.parentNode.getChildAt(d).applyStyle({fillOpacity:1})},ca=0;ca<d.length;ca++){O=d[ca]/h*G;O=this.drawRectangle({x:0,y:0>O?0:-O,width:I,height:Math.abs(O)},{fill:f[ca],stroke:g.stroke,
strokeThickness:g.strokeThickness},{group:l});O.translate(I*ca,0);if(!g.plugable||g&&!0===g.plugable)this.attachEventListener(a.Graphics.EVENT_MOUSE_OVER,X,O),this.attachEventListener(a.Graphics.EVENT_MOUSE_OUT,S,O);var sa=Math.round(Math.abs(d[ca])/t*1E4)/100+"%";O.applyStyle({tooltip:g.description&&g.description[ca]?g.description[ca]+" \n value:"+d[ca]+" \n percent:"+sa:null})}d=this.getWidthHeight(l);this.setLeftTop(l,e.cx-d.w/2,e.cy+(2*G-d.h)/2);l.applyStyle({filter:g.filter});return l};a.Graphics.prototype.getScaleValue=
function(e){if(a.isNull(e))return null;e=e.getTransformMatrix();if(!a.isNull(e)){var d=e.exportToJSON();e=Math.sqrt(d[0]*d[0]+d[1]*d[1]);d=Math.sqrt(d[2]*d[2]+d[3]*d[3]);return{scaleX:e,scaleY:d}}};a.Graphics.prototype.clearToolTips=function(){this.oui.tooltipManager.hideTooltip()};a.Graphics.prototype.createTextBlock=function(e,d,f,g,h,l){e={textValue:e,maxWidth:h,maxLines:l,x:f,y:g,textAlign:a.Text.HORIZONTALALIGN_CENTER};d&&(e.fontFamily=d.fontFamily,e.fontSize=d.fontSize,e.fontStyle=d.fontStyle,
e.fontWeight=d.fontWeight,e.fill=d.fill);d=new this.oui.graphics.TextBlock(e);d.setDisplay(!1);this.oui.rootNode.appendChild(d);e=d.getLocalBounds();this.remove(d);d.setDisplay(!0);return{node:d,w:e.width,h:e.height}};a.Graphics.prototype.cloneText=function(e){if(e.hasChildNodes()){for(var d=this.createGroup(),f=0;f<e.childrenCount;f++){var g=this.cloneText(e.getChildAt(f));d.appendChild(g)}return d}if(e.vtype===a.Graphics.TYPE_IMAGE)return e={src:e.src(),x:e.x(),y:e.y(),width:e.width(),height:e.height()},
e=new this.oui.graphics.Image(e),e.vtype=a.Graphics.TYPE_IMAGE,e;try{var d=e.getTextValue(),f=e.getTransform(),g=e.getFontStyle(),h=e.getFontFamily(),l=e.getFontWeight(),t=e.getFontSize(),G=e.getX(),I=e.getY(),O=e.getFill();if(e.getMaxWidth){var X=e.getMaxLines(),S=e.getMaxWidth();return new this.oui.graphics.TextBlock({textValue:d,maxWidth:S,maxLines:X,x:G,y:I,textAlign:a.Text.HORIZONTALALIGN_CENTER,fontFamily:h,fontSize:t,fontStyle:g,fontWeight:l,fill:O,transform:f})}return this.oui.load({type:"text",
textValue:d,fontFamily:h,fontSize:t,fontStyle:g,fontWeight:l,fill:O,transform:f,x:G,y:I})}catch(ca){return null}};a.Graphics.prototype.createFillPattern=function(a){return new this.oui.style.PatternPaint({src:a})};a.UndoManager=a.Class.extend({initialize:function(){this.reset()},reset:function(){this.index=0;this.undoStack=[]},addEdit:function(a){this.undoStack[this.index++]=a;this.undoStack.splice(this.index);return this.index-1},undo:function(){try{var e=0;do{var d=this.editToUndo();d.undo();this.index--;
d.type&&(d.type===a.UndoManager.ENDBLOCK?e++:d.type===a.UndoManager.STARTBLOCK&&e--)}while(0<e)}catch(f){a.util.Logger.alert("MAPVIEWER_9021","OM.UndoManager.undo",f.message)}},redo:function(){try{var e=0;do{var d=this.editToRedo();d.redo();this.index++;d.type&&(d.type===a.UndoManager.ENDBLOCK?e--:d.type===a.UndoManager.STARTBLOCK&&e++)}while(0<e)}catch(f){a.util.Logger.alert("MAPVIEWER_9021","OM.UndoManager.redo",f.message)}},editToUndo:function(){return this.undoStack[this.index-1]},editToRedo:function(){return this.undoStack[this.index]},
canUndo:function(){var a=this.editToUndo();try{return a&&a.canUndo()}catch(d){throw d;}},canRedo:function(){var a=this.editToRedo();try{return a&&a.canRedo()}catch(d){throw d;}},canUndoOrRedo:function(){return this.canRedo()||this.canUndo()},trimEdits:function(a,d){a=a||0;d=d||this.undoStack.length;var f=d-a,g=this.undoStack.splice(a,f),h=[],l=0,t;for(t in this.undoStack)h[l++]=this.undoStack[t];this.undoStack=h;this.index>=d?this.index-=f:this.index>=a&&(this.index=a);return g},getRedoPresentationName:function(){var a=
this.editToRedo();try{return a.getPresentationName()}catch(d){throw d;}},getUndoOrRedoPresentationName:function(){var e=this.getUndoPresentationName();a.isNull(e)&&(e=this.getRedoPresentationName());return e},getUndoPresentationName:function(){var a=this.editToUndo();try{return a.getPresentationName()}catch(d){throw d;}},startChangeBlock:function(e){return this.addEdit(new a.UndoManager.SpecialEdit(e||"start change block",a.UndoManager.STARTBLOCK))},endChangeBlock:function(e){return this.addEdit(new a.UndoManager.SpecialEdit(e||
"end change block",a.UndoManager.ENDBLOCK))},destroy:function(){this.undoStack=this.index=b},print:function(){for(var a="Undo stack:\n",d=this.undoStack.length,f=0;f<d;f++){var g=this.undoStack[f],a=f===this.index?a+"\x3e":a+" ",a=a+("["+f+"] ");try{a+=g.getPresentationName()}catch(h){a+=h}a+="\n"}return a}});a.UndoManager.SpecialEdit=a.Class.extend({initialize:function(a,d){this.name=a;this.type=d},canUndo:function(){return!0},canRedo:function(){return!0},undo:function(){},redo:function(){},getPresentationName:function(){return this.name}});
a.UndoManager.STARTBLOCK="START_CHANGE_BLOCK";a.UndoManager.ENDBLOCK="END_CHANGE_BLOCK";a.proj.ProjUtil=a.proj.ProjUtil||{};a.proj.ProjUtil.EPSLN=1E-10;a.proj.ProjUtil.TWO_PI=2*Math.PI;a.proj.ProjUtil.LONG_MAX=Math.pow(2,32)+1;a.proj.ProjUtil.DBLLONG=461168601E10;a.proj.ProjUtil.RADIAN=Math.PI/180;a.proj.ProjUtil.DEGREE=180/Math.PI;a.proj.ProjUtil.radians=function(e){return e*a.proj.ProjUtil.RADIAN};a.proj.ProjUtil.degrees=function(e){return e*a.proj.ProjUtil.DEGREE};a.proj.ProjUtil.adjustLon=function(a){for(;-180>
a;)a+=360;for(;180<a;)a-=360;return a};a.proj.Albers=function(e){this.name=e.name||"ALBERS CONICAL EQUAL-AREA";var d=a.proj.ProjUtil,f=d.radians(e.standardParallel_1),g=d.radians(e.standardParallel_2),h=d.radians(e.latOrigin),l=d.radians(e.lonCenter),t=e.rMajor||6378206.4,G=.5*(Math.sin(f)+Math.sin(g));e=Math.cos(f);var I=e*e+2*G*Math.sin(f),O=Math.sqrt(I-2*G*Math.sin(h))/G;return{forward:function(a,e){var f=G*(d.radians(a)-l),g=Math.sqrt(I-2*G*Math.sin(d.radians(e)))/G;return{x:g*Math.sin(f)*t,y:(O-
g*Math.cos(f))*t}},inverse:function(a,e){a/=t;e/=t;var f=Math.atan(a/(O-e)),g=Math.sqrt(a*a+Math.pow(O-e,2)),f=d.degrees(l+f/G),g=d.degrees(Math.asin((I-g*g*G*G)/(2*G)));return{x:f,y:g}}}};a.proj.ablers_mainland=new a.proj.Albers({standardParallel_1:29.5,standardParallel_2:45.5,lonCenter:-96,latOrigin:23});a.proj.albers_hawaii=new a.proj.Albers({standardParallel_1:8,standardParallel_2:18,lonCenter:-160,latOrigin:20});a.proj.albers_hawaii.forward2=function(a){a.x-=12E5;a.y+=4E5;return a};a.proj.albers_hawaii.inverse2=
function(a,d){return{x:a+12E5,y:d-4E5}};a.proj.albers_alaska=new a.proj.Albers({standardParallel_1:55,standardParallel_2:65,lonCenter:-160,latOrigin:60});a.proj.albers_alaska.forward2=function(a){a.x=.4*a.x-22E5;a.y=.4*a.y+4E5;return a};a.proj.albers_alaska.inverse2=function(a,d){return{x:(a+22E5)/.4,y:(d-4E5)/.4}};a.proj.albers_puertorico=new a.proj.Albers({standardParallel_1:8,standardParallel_2:18,lonCenter:-60,latOrigin:10});a.proj.AlbersUSA=function(){var e=a.proj.albers_alaska,d=a.proj.albers_hawaii,
f=a.proj.albers_puertorico,g=a.proj.ablers_mainland;return{forward:function(a,l){var t=50<l?e:-140>a?d:21>l?f:g,G=t.forward(a,l);return t.forward2?t.forward2(G):G},inverse:function(a,f){var t=null,G=-145E4>a&&93E4>f?e:-65E4>a&&-125E4<a&&66E4>f?d:g;return G.inverse2?(t=G.inverse2(a,f),G.inverse(t.x,t.y)):G.inverse(a,f)}}}();a.proj.Robinson=function(e){var d=a.proj.ProjUtil,f=[[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,
.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1],[.5322,1]],g=0;try{g=parseInt(e,10)||0,g=d.adjustLon(g)}catch(h){}return{forward:function(a,e){var h,I,O;a=d.adjustLon(a);a-=g;a=d.adjustLon(a);90<Math.abs(e)&&(e=90*(0<e?1:-1));h=parseInt(Math.abs(e)/5,10);I=Math.abs(e)/5-h;a=d.radians(a);e=d.radians(e);O=f[h][0]+I*(f[h+1][0]-f[h][0]);h=f[h][1]+I*(f[h+1][1]-f[h][1]);h*=8625154.6651;0>e&&(h=-h);return{x:5413124.8719*O*a,y:h}},inverse:function(a,
e){var h,I,O;h=0;if(8625154.6651<=Math.abs(e))I=90,h=f[18][0];else{I=Math.abs(e/8625154.6651);for(O=0;19>O;O++)if(f[O+1][1]>I){h=O;break}O=(I-f[h][1])/(f[h+1][1]-f[h][1]);I=5*(h+O);h=f[h][0]+O*(f[h+1][0]-f[h][0])}h=d.degrees(a/(5413124.8719*h))+g;h=d.adjustLon(h);0>e&&(I=-I);return{x:h,y:I}}}};a.proj.Winkel3=function(e){var d=a.proj.ProjUtil,f=Math.PI/2,g=0;try{g=parseInt(e,10)||0,g=d.adjustLon(g)}catch(h){g=0}var l=function(a){return 1<a?0:-1>a?Math.PI:Math.acos(a)};return{forward:function(a,e){a=
d.adjustLon(a);a-=g;a=d.adjustLon(a);a=d.radians(a);e=d.radians(e);var h;h=a;var O=e,X=Math.cos(O),S;S=(S=l(X*Math.cos(h/=2)))?S/Math.sin(S):1;h=[2*X*Math.sin(h)*S,Math.sin(O)*S];return{x:(h[0]+a/f)/2*6378137,y:(h[1]+e)/2*6378137}},inverse:function(a,e){a/=6378137;e/=6378137;var h=a,O=e,X=25,S=0,ca,sa;do{var Na=Math.cos(O),Va=Math.sin(O),Jb=Math.sin(2*O),b=Va*Va,ub=Na*Na,zb=Math.sin(h),rb=Math.cos(h/2),Ab=Math.sin(h/2),Eb=Ab*Ab,Da=(sa=1-ub*rb*rb)?l(Na*rb)*Math.sqrt(S=1/sa):S=0;sa=.5*(2*Da*Na*Ab+h/
f)-a;var Fa=.5*(Da*Va+O)-e,Ga=.5*S*(ub*Eb+Da*Na*rb*b)+.5/f;ca=S*(zb*Jb/4-Da*Va*Ab);Va=.125*S*(Jb*Ab-Da*Va*ub*zb);b=.5*S*(b*rb+Da*Eb*Na)+.5;Na=ca*Va-b*Ga;ca=(Fa*ca-sa*b)/Na;sa=(sa*Va-Fa*Ga)/Na;h-=ca;O-=sa}while((1E-6<Math.abs(ca)||1E-6<Math.abs(sa))&&0<--X);h=d.degrees(h)+g;h=d.adjustLon(h);O=d.degrees(O);return{x:h,y:O}}}};a.util.Logger=a.util.Logger||{};a.util.Logger.LEVELS={finest:0,finer:1,fine:2,info:3,config:4,warning:5,severe:6};a.util.Logger.LEVELS_TEXT={0:"finest",1:"finer",2:"fine",3:"info",
4:"config",5:"warning",6:"severe"};a.util.Logger.currentLevel=a.util.Logger.LEVELS.warning;a.util.Logger.NO_ALERT_BOX=!1;a.util.Logger._log=function(a){"object"===typeof console?console.log(a):"object"===typeof opera?opera.postError(a):"object"===typeof java&&"object"===typeof java.lang&&java.lang.System.out.println(a)};a.util.Logger.finest=function(e,d,f){a.util.Logger.LEVELS.finest>=a.util.Logger.currentLevel&&a.util.Logger._log("[FINEST]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.finer=function(e,
d,f){a.util.Logger.LEVELS.finer>=a.util.Logger.currentLevel&&a.util.Logger._log("[FINER]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.fine=function(e,d,f){a.util.Logger.LEVELS.fine>=a.util.Logger.currentLevel&&a.util.Logger._log("[FINE]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.info=function(e,d,f){a.util.Logger.LEVELS.info>=a.util.Logger.currentLevel&&a.util.Logger._log("[INFO]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.config=function(e,d,f){a.util.Logger.LEVELS.config>=a.util.Logger.currentLevel&&
a.util.Logger._log("[CONFIG]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.warning=function(e,d,f){a.util.Logger.LEVELS.warning>=a.util.Logger.currentLevel&&a.util.Logger._log("[WARNING]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.severe=function(e,d,f){a.util.Logger.LEVELS.severe>=a.util.Logger.currentLevel&&a.util.Logger._log("[SEVERE]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.alert=function(e,d,f){e=a.util.Logger._mix(e,d,f);a.util.Logger._log("[ALERT]  "+e);a.util.Logger.errorHandler?a.util.Logger.errorHandler(e):
a.util.Logger.NO_ALERT_BOX||alert(e)};a.util.Logger.throwErr=function(e,d,f){f=a.util.Logger._mix(e,d,f);f=Error(f);f.stack&&a.util.Logger.warning(e,d,f.stack);throw f;};a.util.Logger._mix=function(e,d,f){var g=null;e&&(g=a.$.i18n.prop(e),g=g=="["+e+"]"?a.Messages.getErrorMessage(e):e+":"+g);d&&(g=g?g+("\n    "+a.Messages.getString("Source")+": "+d):a.Messages.getString("Source")+": "+d);f&&(g=g?g+("\n    "+f):f);return g};a.util.ScreenTransform=function(a,d){this.dw=a;this.sw=d;this.sx=d.w/a.w;this.sy=
-d.h/a.h;this.tx=-a.x*this.sx+d.x;this.ty=-a.y*this.sy+d.y+d.h;this.xtr=a.w/d.w;this.ytr=a.h/d.h;this.rsx=1/this.sx;this.rsy=1/this.sy;this.rtx=-d.x*this.rsx+a.x;this.rty=-d.y*this.rsy+a.y+a.h};a.util.ScreenTransform.prototype.toScreenPoint=function(a,d){var f={};f.x=Math.round(a*this.sx+this.tx);f.y=Math.round(d*this.sy+this.ty);return f};a.util.ScreenTransform.prototype.toMapDataPoint=function(a,d){var f={};f.x=a*this.rsx+this.rtx;f.y=d*this.rsy+this.rty;return f};a.util.ScreenTransform.prototype.toScreenXLength=
function(a){return a*this.sx};a.util.ScreenTransform.prototype.toScreenYLength=function(a){return-a*this.sy};a.util.ScreenTransform.prototype.transformSegment=function(e,d,f){a.isNull(f)&&(f=2);if(!e.length||2>=e.length)return null;var g=d*this.xtr;d*=this.ytr;var h=[],l=e[0],t=e[1],G=l,I=t,l=Math.round(l*this.sx+this.tx),t=Math.round(t*this.sy+this.ty);h.push(l);h.push(t);for(var O=f,X=e.length;O<X;O+=f)if(l=e[O],t=e[O+1],Math.abs(l-G)>g||Math.abs(t-I)>d)G=l,I=t,l=Math.round(l*this.sx+this.tx),t=
Math.round(t*this.sy+this.ty),h.push(l,t);if(2>=h.length)return null;e[0]!==e[X-2]||e[1]!==e[X-1]||h[0]===h[h.length-2]&&h[1]===h[h.length-1]||h.push(h[0],h[1]);return h};a.util.ScreenTransform.getScreenCoordinates=function(a,d,f,g,h,l,t,G,I){return{x:(G-d)*l/(g-d)-a.divLeft,y:(h-I)*t/(h-f)-a.divTop}};a.util.ScreenTransform.prototype.toHeatMapPoint=function(a,d,f,g,h){var l={};l.x=Math.round((a*this.sx+this.tx-f)/h);l.y=Math.round((d*this.sy+this.ty-g)/h);return l};a.util.ScreenTransform.prototype.transformHeatMapSegment=
function(e,d,f,g,h,l){a.isNull(f)&&(f=2);if(!e.length||2>=e.length)return null;var t=d*this.xtr;d*=this.ytr;var G=[],I=e[0],O=e[1],X=I,S=O,I=Math.round((I*this.sx+this.tx-g)/l),O=Math.round((O*this.sy+this.ty-h)/l);G.push(I);G.push(O);for(var ca=f,sa=e.length;ca<sa;ca+=f)if(I=e[ca],O=e[ca+1],Math.abs(I-X)>t||Math.abs(O-S)>d)X=I,S=O,I=Math.round(I*this.sx+this.tx),O=Math.round(O*this.sy+this.ty),G.push((I-g)/l,(O-h)/l);if(2>=G.length)return null;e[0]!==e[sa-2]||e[1]!==e[sa-1]||G[0]===G[G.length-2]&&
G[1]===G[G.length-1]||G.push(G[0],G[1]);return G};a.util.GeomUtil=a.util.GeomUtil||{};a.util.GeomUtil.earthRadius=6372795;a.util.GeomUtil.distance=function(a,d,f,g){return Math.sqrt(Math.pow(f-a,2)+Math.pow(g-d,2))};a.util.GeomUtil.pointLineDistance=function(a,d,f,g,h,l){var t=g-l,G=h-f;return Math.abs(t*a+G*d+(f*l-g*h))/Math.sqrt(t*t+G*G)};a.util.GeomUtil.pointSegmentDistance=function(e,d,f,g,h,l){var t=a.util.GeomUtil.distance(e,d,f,g),G=a.util.GeomUtil.distance(e,d,h,l),I=a.util.GeomUtil.distance(f,
g,h,l);if(0===I)return t;I=((e-f)*(h-f)+(d-g)*(l-g))/(I*I);return 0>I||1<I?Math.min(t,G):a.util.GeomUtil.pointLineDistance(e,d,f,g,h,l)};a.util.GeomUtil.pointInRect=function(a,d,f,g,h,l){return a<=h&&a>=f&&d<=l&&d>=g};a.util.GeomUtil.pointInPolygon=function(a,d,f,g,h){var l,t,G=0;l=0;for(t=f-1;l<f;t=l++)h[l]>d!=h[t]>d&&a<(g[t]-g[l])*(d-h[l])/(h[t]-h[l])+g[l]&&(G=!G);return G};a.util.GeomUtil.getPointAtBearing=function(e,d,f,g){d=a.util.GeomUtil.getRadiansFromLatLon(e,d);e=d.x;d=d.y;var h=f/a.util.GeomUtil.earthRadius;
f=Math.asin(Math.sin(d)*Math.cos(h)+Math.cos(d)*Math.sin(h)*Math.cos(g));g=e+Math.atan2(Math.sin(g)*Math.sin(h)*Math.cos(d),Math.cos(h)-Math.sin(d)*Math.sin(f));return a.util.GeomUtil.getLatLonFromRadians(g,f)};a.util.GeomUtil.getRadiansFromLatLon=function(a,d){for(;-180>a;)a+=360;for(;180<a;)a-=360;a=a*Math.PI/180;d=d*Math.PI/180;return{x:a,y:d}};a.util.GeomUtil.getLatLonFromRadians=function(a,d){a=180*a/Math.PI;d=180*d/Math.PI;return{x:a,y:d}};a.util.GeomUtil.densifyOrdinates=function(a,d){if(!a||
4>a.length)return a;for(var f=[],g=0;g<a.length-2;g+=2){var h=a[g],l=a[g+1],t=a[g+2]-h,G=a[g+3]-l;f.push(h);f.push(l);var I=Math.ceil(Math.abs(t)/d),O=Math.ceil(Math.abs(G)/d),I=Math.max(I,O);if(0<I)for(t=1*t/I,G=1*G/I,O=0;O<I-1;O++)h+=t,l+=G,f.push(h),f.push(l)}f.push(a[a.length-2]);f.push(a[a.length-1]);return f};a.util.GeomUtil.SimplifyCoordinates=function(a){for(var d=a.length,f=a[0],g=a[1],h=[f,g],l=2;l<d;l+=2)if(1<=Math.abs(f-a[l])||1<=Math.abs(g-a[l+1]))f=a[l],g=a[l+1],h.push(f),h.push(g);
return h};a.util.GeomUtil.getLength=function(e,d,f){var g=e?e.type:"",h=e.srid,l=null;if("LineString"!==g&&"MultiLineString"!==g&&"Polygon"!==g&&"MultiPolygon"!==g&&"Rectangle"!==g)return a.util.Logger.alert("MAPVIEWER_9015","OM.util.GeomUtil.getLength",""),l=-1;var g=function(a){var e=0,d=2,f=a.length;if(a&&3<f){for(;d<f;d+=2)var g=a[d]-a[d-2],h=a[d+1]-a[d-1],e=e+Math.sqrt(g*g+h*h);return e}return 0},t,G,I,O,X;f&&(t=f.idx?f.idx:0,G=f.unit?f.unit:"METER",I=f.transformToGeodetic,O=f.dataSource?f.dataSource:
a.gv.defaultDataSource,X=!1===f.toServerTranform?!1:!0);if(!h)return l=g(e.coordinates),d&&d(l,t),l;(f=a.gv.getSRS(h))?(a.util.GeomUtil.isGeo(h)&&(f.type="GEODETIC"),f.distConvFactor=a.gv.getUnitFactor(f.unit)):f=a.util.GeomUtil.isGeo(h)?{type:"GEODETIC",distConvFactor:1,maxX:180,maxY:90,minX:-180,minY:-90}:{type:"",distConvFactor:1,maxX:180,maxY:90,minX:-180,minY:-90};var S=null;I&&(S=a.util.CSTransformUtil.getCSTransformFunction(h,8307));if(!I||a.util.GeomUtil.isGeo(h)||I&&S||a.isNull(O)){h=0;G?
(h=a.gv.getUnitFactor(G),f.distConvFactor&&!I&&(h/=f.distConvFactor)):h=1;var ca=e.coordinates.slice(0);S&&(ca=a.util.CSTransformUtil.transformOrdinates(S,ca,e.dimension),f.type="GEODETIC");if(h)return l=f&&f.type&&"GEODETIC"===f.type.toUpperCase()&&I?a.util.GeomUtil.getGreatCircleLength(ca)/h:g(ca)/h,d&&d(l,t),l}a.$("#sub_tr_1")&&!S&&I&&a.$("#sub_tr_1").hide();g=e.toString();e=a.gv.localbaseURL()+"/foi";g={request:"getlength",version:1,figord:g};G&&(g.unit=G);I&&(g.togeodetic=!0===I?"yes":"no");
O&&(g.datasource=O);G=function(a){a*=1;d&&d(a,t);l=a};try{X&&a.util.HttpRequest.send(e,g,G,"text")}catch(sa){a.util.Logger.alert("MAPVIEWER_9016","OM.util.GeomUtil.getLength",sa.stack?sa.message+"\nStack: "+sa.stack:sa.message),l=-1}return l};a.util.GeomUtil.getArea=function(e,d,f){var g=e?e.type:"";if("Polygon"!==g&&"MultiPolygon"!==g)return a.util.Logger.alert("MAPVIEWER_9046","OM.util.GeomUtil.getArea",""),G=-1;var h,l,t;f&&(h=f.unit?f.unit:"SQ_METER",l=f.transformToGeodetic,t=f.dataSource?f.dataSource:
a.gv.defaultDataSource);var G;f=e.toString();e=a.gv.localbaseURL()+"/foi";f={request:"getarea",version:1,figord:f};h&&(f.unit=h);l&&(f.togeodetic=!0===l?"yes":"no");t&&(f.datasource=t);h=function(a){a*=1;d&&d(a);G=a};try{a.util.HttpRequest.send(e,f,h,"text")}catch(I){a.util.Logger.alert("MAPVIEWER_9047","OM.util.GeomUtil.getArea",I.stack?I.message+"\nStack: "+I.stack:I.message),G=-1}return G};a.util.GeomUtil.moveCoordinates=function(e,d,f,g,h){var l=function(e,d,f){if(e){var l=e.length,t=2;a.notNull(h)&&
(t=h);g&&(t+=t);for(var G=0;G<l;G+=t)e[G]+=d,e[G+1]+=f}},t=a.util.ValidationUtil.isNumberArray;if(t(e))l(e,d,f);else for(var G=e.length,I=0;I<G;I++)if(t(e[I]))l(e[I],d,f);else for(var O=e[I].length,X=0;X<O;X++)l(e[I][X],d,f)};a.util.GeomUtil.moveGeometry=function(a,d,f){var g=a.getOrdinates(),h=a.getType(),l=a.getDimension(),t;if("Polygon"===h||"MultiLineString"==h)for(a=0;a<g.length;a++)for(h=0;h<g[a].length;h+=l)g[a][h]+=d,g[a][h+1]+=f;else if("MultiPolygon"===h)for(h=0;h<g.length;h++)for(a=0;a<
g[h].length;a++)for(t=0;t<g[h][a].length;t+=l)g[h][a][t]+=d,g[h][a][t+1]+=f;else if("LineString"===h)for(a=0;a<g.length;a++)g[a]+=d,g[a]+=f;else if("Rectangle"===h)a.move(d,f);else throw Error("Unsupported geometry type:"+h);};a.util.GeomUtil.getGreatCircleLength=function(e){for(var d=0,f=a.util.GeomUtil,g=0;g<e.length-2;g+=2)d+=f.getGreatCircleDistance({x:e[g],y:e[g+1]},{x:e[g+2],y:e[g+3]});return d};a.util.GeomUtil.getGreatCircleDistance=function(e,d){var f=a.util.GeomUtil;e=f.getRadiansFromLatLon(e.x,
e.y);d=f.getRadiansFromLatLon(d.x,d.y);var g=d.x-e.x,h=Math.sin((d.y-e.y)/2),g=Math.sin(g/2),h=h*h+Math.cos(e.y)*Math.cos(d.y)*g*g;return 2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))*f.earthRadius};a.util.GeomUtil.getOGCOrdinateString=function(e,d){var f=2;a.notNull(d)&&(f=d);for(var g=0,h="";g<e.length;g+=f){0<g&&(h+=" ");for(var h=h+(e[g]+","+e[g+1]),l=2;l<f;l++)h+=","+e[g+l]}return h};a.util.GeomUtil.getWktCoordinateStringFromPoint=function(e,d){var f=2;a.notNull(d)&&(f=d);for(var g=0,h="";g<e.length;g+=
f){0<g&&(h+=" ");for(var l=0;l<f;l++)h+=e[g+l],l<f-1&&(h+=" ")}return h};a.util.GeomUtil.getWktCoordinateStringFromOrientedPoint=function(e,d){var f=2;a.notNull(d)&&(f=d);for(var g=0,h="";g<f;g+=f){0<g&&(h+=" ");for(var l=0;l<f;l++)h+=e[g+l],l<f-1&&(h+=" ")}return h};a.util.GeomUtil.getWktCoordinateStringFromLine=function(e,d){var f=2;a.notNull(d)&&(f=d);for(var g=0,h="";g<e.length;g+=f){0<g&&(h+=" ");for(var l=0;l<f;l++)h+=e[g+l],l<f-1&&(h+=" ");h+=","}return h};a.util.GeomUtil.getCurrentDistancePerPixelPrivate=
function(e){var d=e.getUniverse();e=e.getZoomLevel();e=d.getZoomLevels()[e];if(a.notNull(e.distancePerPixel))return e.distancePerPixel;var d=d.getSRID(),f=null,f=a.util.GeomUtil.isGeo(d)?111195*e.resolution:e.resolution;return e.distancePerPixel=f};a.util.GeomUtil.getCurrentDistancePerPixel=function(e,d){var f=a.util.GeomUtil.getCurrentDistancePerPixelPrivate(e);if(!a.isNull(d))if("pixel"===d)f=1;else{var g=a.gv.getUnitFactor(d);0!==g&&(f/=g)}return f};a.util.GeomUtil.calculateGreatCircle=function(e,
d,f,g){var h=e.clone(),l=d.clone(),t=h.getY()*Math.PI/180,G=h.getX()*Math.PI/180,I=l.getY()*Math.PI/180,O=l.getX()*Math.PI/180,l=g,h=[],X=0,S=Math.PI/180;Math.abs(O-G)===Math.PI&&0===t+I&&(I+=Math.PI/18E7);var ca=f*Math.PI/180;for(g*=Math.PI/180;ca<=g;){var sa=Math.atan((Math.sin(t)*Math.cos(I)*Math.sin(ca-O)-Math.sin(I)*Math.cos(t)*Math.sin(ca-G))/(Math.cos(t)*Math.cos(I)*Math.sin(G-O)));h[2*X]=180*ca/Math.PI;h[2*X+1]=180*sa/Math.PI;X++;ca=ca<g&&ca+S>=g?g:ca+S}g=[];if(e.getX()>d.getX()&&180!==l&&
-180!==f){for(t=0;t<h.length/2;t++)g[2*t]=h[h.length-2*t-2],g[2*t+1]=h[h.length-2*t-1];h=g}if(e.getX()<d.getX()&&(180===l||-180===f)){for(t=0;t<h.length/2;t++)g[2*t]=h[h.length-2*t-2],g[2*t+1]=h[h.length-2*t-1];h=g}return new a.geometry.LineString(h,8307)};a.util.GeomUtil.createGreatCircle=function(e,d){var f=a.util.GeomUtil.isGeo;if(f(e.srid)&&f(d.srid)){var f=e.getX(),g=d.getX(),h=[];if(f<g&&180>g-f)return h[0]=a.util.GeomUtil.calculateGreatCircle(e,d,f,g),h[0];if(180>Math.abs(f-g))return h[0]=
a.util.GeomUtil.calculateGreatCircle(e,d,g,f),h[0];f>g?(h[0]=a.util.GeomUtil.calculateGreatCircle(e,d,f,180),h[1]=a.util.GeomUtil.calculateGreatCircle(e,d,-180,g)):(h[0]=a.util.GeomUtil.calculateGreatCircle(e,d,g,180),h[1]=a.util.GeomUtil.calculateGreatCircle(e,d,-180,f));return new a.geometry.MultiLineString([h[0].coordinates,h[1].coordinates],8307)}a.util.Logger.alert("MAPVIEWER_9017","OM.util.GeomUtil.getGreatCircle","")};a.util.GeomUtil.flatten=function(e,d,f){var g=[];if(!e)return null;for(var h=
e.length,l=0,t=0;t<h;t++){var G=e[t];if(!(G instanceof a.geometry.Geometry)||0>G.getType().indexOf(d))return null;var I=G.getSRID();l||(l=I);if(l!==I)return null;f?g.push(G.coordinates):(g.push(G.getX()),g.push(G.getY()))}return{ordinates:g,srid:l}};a.util.GeomUtil.getOutCode=function(a,d,f){return a.minX>d?a.minY>f?3:a.maxY<f?9:1:a.maxX<d?a.minY>f?6:a.maxY<f?12:4:a.minY>f?2:a.maxY<f?8:0};a.util.GeomUtil.clipLineSegment=function(e,d,f,g,h){for(var l=a.util.GeomUtil.getOutCode,t=l(e,d,f),G=l(e,g,h);;){if(0===
(t|G))return{x0:d,y0:f,x1:g,y1:h};if(0!==(t&G))return null;var I=0!==t?t:G,O=null,X=null;0!==(I&8)?(O=d+(g-d)*(e.maxY-f)/(h-f),X=e.maxY):0!==(I&2)?(O=d+(g-d)*(e.minY-f)/(h-f),X=e.minY):0!==(I&4)?(O=e.maxX,X=f+(h-f)*(e.maxX-d)/(g-d)):(O=e.minX,X=f+(h-f)*(e.minX-d)/(g-d));I===t?(d=O,f=X,t=l(e,d,f)):(g=O,h=X,G=l(e,g,h))}};a.util.GeomUtil.clipLine=function(e,d){var f=[];a.util.GeomUtil.concatMultiLine(d);for(var g=0,h=d.length;g<h;g++)if(d[g]&&d[g][0])for(var l=d[g][0],t=3,G=l.length;t<G;t+=2){var I=
a.util.GeomUtil.clipLineSegment(e,l[t-3],l[t-2],l[t-1],l[t]);if(I){var O=f.length-1;if(0<=O){var X=f[O].length;if(1<X&&I.x0===f[O][X-2]&&I.y0===f[O][X-1]){f[O].push(I.x1,I.y1);continue}}f.push([I.x0,I.y0,I.x1,I.y1])}}return f};a.util.GeomUtil.getSegmentLength=function(a,d,f,g){return Math.sqrt((a-f)*(a-f)+(d-g)*(d-g))};a.util.GeomUtil.getScreenLength=function(e){for(var d=0,f=0,g=e.length-3;f<g;f+=2)d+=a.util.GeomUtil.getSegmentLength(e[f],e[f+1],e[f+2],e[f+3]);return d};a.util.GeomUtil.getPointByPercent=
function(e,d,f){for(var g=[],h=a.util.GeomUtil,l=0,t=e.length;l<t;l++){var G=e[l],I=h.getScreenLength(G);I<f/2||(I*=d,(G=h.getPointByLength(I,G))&&g.push(G))}return g};a.util.GeomUtil.getPointByLength=function(e,d){for(var f=a.util.GeomUtil,g=0,h=d.length-3;g<h;g+=2){var l=f.getSegmentLength(d[g],d[g+1],d[g+2],d[g+3]);if(l>=e)return f=e/l,{x:d[g]+(d[g+2]-d[g])*f,y:d[g+1]+(d[g+3]-d[g+1])*f,pos:g,len:l};e-=l}return null};a.util.GeomUtil.getPoinsByLength=function(e,d,f,g,h,l){for(var t=a.util.GeomUtil.getSegmentLength(e[d],
e[d+1],f,g),G=e.length;t<h&&2<=d&&d<G-2;)5<=t&&(h-=t),d+=l,t=a.util.GeomUtil.getSegmentLength(e[d],e[d+1],f,g);return t>=h?(f=h/t,{x:e[d-l]+(e[d]-e[d-l])*f,y:e[d+1-l]+(e[d+1]-e[d+1-l])*f}):{x:e[d],y:e[d+1]}};a.util.GeomUtil.getCircle=function(a,d,f,g,h,l){var t=Math.sqrt((a-f)*(a-f)+(d-g)*(d-g)),G=Math.sqrt((f-h)*(f-h)+(g-l)*(g-l)),I=Math.sqrt((a-h)*(a-h)+(d-l)*(d-l)),O=(t+G+I)/2,O=Math.sqrt(O*(O-t)*(O-G)*(O-I)),t=t*G*I/4/O,G=((a*a-f*f+d*d-g*g)*(d-l)-(a*a-h*h+d*d-l*l)*(d-g))/(2*(d-l)*(a-f)-2*(d-g)*
(a-h)),I=((a*a-f*f+d*d-g*g)*(a-h)-(a*a-h*h+d*d-l*l)*(a-f))/(2*(d-g)*(a-h)-2*(d-l)*(a-f));a=Math.atan2(d-I,a-G);0>a&&(a+=2*Math.PI);h=Math.atan2(l-I,h-G);0>h&&(h+=2*Math.PI);f=Math.atan2(g-I,f-G);0>f&&(f+=2*Math.PI);a<f&&a>h?h+=2*Math.PI:a<f&&f>h?a+=2*Math.PI:a>f&&a<h?h-=2*Math.PI:a>f&&f<h&&(a-=2*Math.PI);return{x:G,y:I,r:t,sAngle:a,eAngle:h}};a.util.GeomUtil.isGeo=function(a){return 8307===a||8265===a||4326===a||4269===a};a.util.GeomUtil.isClockwise=function(e,d){return 0<=a.util.GeomUtil.polygonArea(e,
d)};a.util.GeomUtil.polylineLength=function(a,d){for(var f=a.length/d,g=0,h=0,l,t=1;t<f;t++)l=t*d,h*=d,g+=Math.sqrt((a[l]-a[h])*(a[l]-a[h])+(a[l+1]-a[h+1])*(a[l+1]-a[h+1])),h=t;return g};a.util.GeomUtil.polygonArea=function(a,d){for(var f=d||2,g=a.length/f,h=0,l=g-1,t=0,h=0;h<g;h++)t+=(a[l*f]+a[h*f])*(a[l*f+1]-a[h*f+1]),l=h;return t/2};a.util.GeomUtil.reverseCoordinates=function(a){for(var d=[],f=0;f<a.length-1;f+=2)d.unshift(a[f+1]),d.unshift(a[f]);return d};a.util.GeomUtil.getTransformedGeometry=
function(e,d){var f=[],g=e.getOrdinates(),h=e.getType(),l=e.getDimension(),t,G,I;if("Polygon"===h||"MultiLineString"==h)for(G=0;G<g.length;G++)t=a.util.GeomUtil.getTransformedCoordinates(g[G],l,d),f[G]=t;else if("MultiPolygon"===h)for(I=0;I<g.length;I++)for(f[I]=[],G=0;G<g[I].length;G++)t=a.util.GeomUtil.getTransformedCoordinates(g[I][G],l,d),f[I][G]=t;else f=a.util.GeomUtil.getTransformedCoordinates(g,l,d);if("Polygon"===h)f=new a.geometry.Polygon(f,e.srid,e.dim);else if("MultiPolygon"===h)f=new a.geometry.MultiPolygon(f,
e.srid,e.dim);else if("LineString"===h)f=new a.geometry.LineString(f,e.srid,e.dim);else if("MultiLineString"===h)f=new a.geometry.MultiLineString(f,e.srid,e.dim);else throw Error("Unsupported geometry type:"+h);return f};a.util.GeomUtil.getTransformedCoordinates=function(a,d,f){var g=[];if(2===d)f.transformAll(a,g);else{var h=a.length||0,l,t,G,I,O,X,S,g=g||a;G=f.a;I=f.b;O=f.c;X=f.d;S=f.tx;f=f.ty;for(h=0;h<a.length;h+=d)if(l=a[h],t=a[h+1],g[h]=G*l+O*t+S,g[h+1]=I*l+X*t+f,2<d)for(l=2;l<d;l++)g[h+l]=
a[h+l]}return g};a.util.GeomUtil.parseGeoJson=function(e){if(!e.type)return null;var d=e.coordinates?e.coordinates:e.geometries,f=d.length,g=Array.prototype.concat,h;switch(e.type){case "Point":return e.dimension=f,e;case "OrientedPoint":return"number"!==typeof d[0]&&(e.coordinates=g.apply([],d)),e.dimension=f/2,e;case "MultiPoint":return e.dimension=d[0].length,e;case "OrientedMultiPoint":if("number"!==typeof d[0][0])for(h=0;h<f;h++)e.coordinates[h]=g.apply([],d[h]);e.dimension=d[0].length/2;return e;
case "LineString":return"number"!==typeof d[0]&&(e.dimension=d[0].length,e.coordinates=g.apply([],d)),e;case "MultiLineString":for(h=0;h<f;h++)"number"!==typeof d[h][0]&&(e.dimension=d[h][0].length,e.coordinates[h]=g.apply([],d[h]));return e;case "Polygon":for(h=0;h<f;h++)"number"!==typeof d[h][0]&&(e.dimension=d[h][0].length,e.coordinates[h]=g.apply([],d[h]));return e;case "MultiPolygon":for(h=0;h<f;h++)for(var l=0;l<d[h].length;l++)"number"!==typeof d[h][l][0]&&(e.dimension=d[h][l][0].length,e.coordinates[h][l]=
g.apply([],d[h][l]));return e;case "GeometryCollection":for(h=0;h<f;h++)d[h]=a.util.GeomUtil.parseGeoJson(d[h]);e.dimension=e.geometries[0].dimension;return e;case "Circle":e.dimension=2;for(h=0;h<f;h++)isNaN(d[h][0])&&(e.coordinates[h]=d[h]);return e;case "Rectangle":e.dimension=2;for(h=0;h<f;h++)isNaN(d[h][0])&&(e.coordinates[h]=d[h]);return e}};a.util.GeomUtil.parseCRSName=function(e){e.indexOf("EPSG");var d=e.split(":");1===d.length&&(d=e.split(" "));for(e=d.length-1;-1<e;e--)d[e]=d[e].trim(),
""===d[e]&&d.splice(e,1);for(e=0;e<d.length-1;e++)if("EPSG"===d[e].toUpperCase())return a.util.GeomUtil.EPSG_SDO_Map[d[e+1]];return null};a.util.GeomUtil.concatMultiLine=function(a){for(var d=a.length,f=0,g=d-1;f<g;f++)if(a[f]&&a[f][0])for(var h=f+1;h<d;h++)if(a[h]&&a[h][0]){var l=a[f][0].length,t=a[h][0].length;3>Math.abs(a[f][0][l-2]-a[h][0][0])&&3>Math.abs(a[f][0][l-1]-a[h][0][1])?(Array.prototype.push.apply(a[f][0],a[h][0]),a.splice(h,1),d--,g--,h--):3>Math.abs(a[f][0][0]-a[h][0][t-2])&&3>Math.abs(a[f][0][1]-
a[h][0][t-1])&&(Array.prototype.push.apply(a[h][0],a[f][0]),a[f]=a[h],a.splice(h,1),d--,g--,h--)}};a.util.GeomUtil.distanceToSegment=function(a,d,f,g,h,l){var t=[],G;if(0>=(a-f)*(h-f)+(d-g)*(l-g))return t[0]=Math.sqrt((a-f)*(a-f)+(d-g)*(d-g)),t[1]=0,t;if(0>=(a-h)*(f-h)+(d-l)*(g-l))return t[0]=Math.sqrt((a-h)*(a-h)+(d-l)*(d-l)),t[1]=1,t;t[1]=2;G=Math.sqrt((h-f)*(h-f)+(l-g)*(l-g));if(0===G)return t[0]=Math.sqrt((a-f)*(a-f)+(d-g)*(d-g)),t;t[0]=Math.abs((a-f)*(l-g)-(d-g)*(h-f))/G;return t};a.util.GeomUtil.getSegmentPoint=
function(a,d,f,g,h,l){h-=f;l-=g;0===h?a=d:0===l?(f=a,a=g):(l/=h,f=(a+l*(d-g)+l*l*f)/(1+l*l),a=(a-f)/l+d);return[f,a]};a.util.GeomUtil.poinInPolygonGeometry=function(e,d,f){if(a.isNull(e)||"Polygon"!==e.getType())return!1;var g=e.getDimension(),h=e.coordinates.length,l=e.coordinates[0].length,t=[],G=[],I;for(I=0;I<l;I+=g)t[I/g]=e.coordinates[0][I],G[I/g]=e.coordinates[0][I+1];if(a.util.GeomUtil.pointInPolygon(d,f,l/g,t,G)){for(var O=!1,X=1;X<h;X++){l=e.coordinates[X].length;t=[];G=[];I=l/g;for(var S=
0;S<l;S+=g)t[S/g]=e.coordinates[X][S],G[S/g]=e.coordinates[X][S+1];if(a.util.GeomUtil.pointInPolygon(d,f,I,t,G)){O=!0;break}}if(!1===O)return!0}return!1};a.util.GeomUtil.findGeometryElement=function(e,d,f,g){if(a.isNull(e))return!1;var h=e.getType(),l=e.getDimension(),t=-1,G=Number.MAX_VALUE,I=e.getOrdinates();switch(h){case "Point":l=e.getX()-d;e=e.getY()-f;e=Math.sqrt(l*l+e*e);e<=g&&(t=0);break;case "MultiPoint":for(h=0;h<I.length;h++)l=I[h][0]-d,e=I[h][1]-f,e=Math.sqrt(l*l+e*e),e<=g&&e<G&&(G=e,
t=h);break;case "LineString":for(G=0;G<I.length-l;G+=l)if(e=a.util.GeomUtil.distanceToSegment(d,f,I[G],I[G+1],I[G+l],I[G+l+1]),e[0]<=g){t=0;break}break;case "MultiLineString":for(h=0;h<I.length;h++)for(var O=0;O<I[h].length-l;O+=l)if(e=a.util.GeomUtil.distanceToSegment(d,f,I[h][O],I[h][O+1],I[h][O+l],I[h][O+l+1]),e[0]<=g&&e[0]<G){t=h;G=e[0];break}break;case "Polygon":a.util.GeomUtil.poinInPolygonGeometry(e,d,f)&&(t=0);break;case "MultiPolygon":for(g=0;g<I.length;g++)if(G=new a.geometry.Polygon(I[g],
e.getSRID(),e.dim),a.util.GeomUtil.poinInPolygonGeometry(G,d,f)){t=g;break}}return t};a.util.GeomUtil.removeGeometryElement=function(e,d){if(a.isNull(e)||0>d)return null;var f=e.getType();if("MultiPoint"!==f&&"MultiLineString"!==f&&"OrientedMultiPoint"!==f&&"MultiPolygon"!==f&&"GeometryCollection"!==f)return null;var g=e.getDimension(),h=e.getOrdinates();if(a.isNull(h))return null;var l=h.length;if(d>=l)return null;switch(f){case "MultiPoint":h.splice(d,1);if(2===l&&(e=new a.geometry.Point(h[0][0],
h[0][1],e.getSRID()),2<g))for(f=2;f<g;f++)e.addDimension(h[0][f]);break;case "OrientedMultiPoint":return null;case "MultiLineString":h.splice(d,1);2===l&&(e=new a.geometry.LineString(h[0],e.getSRID(),g));break;case "MultiPolygon":h.splice(d,1);2===l&&(e=new a.geometry.Polygon(h[0],e.getSRID(),g));break;case "GeometryCollection":return null;default:return null}e.mbr=null;e.getMBR();return e};a.util.GeomUtil.cloneGeometryElement=function(e,d){if(a.isNull(e)||0>d)return null;var f=e.getType();if("MultiPoint"!==
f&&"MultiLineString"!==f&&"OrientedMultiPoint"!==f&&"MultiPolygon"!==f&&"GeometryCollection"!==f)return null;var g=e.getDimension(),h=e.getOrdinates();if(a.isNull(h)||d>=h.length)return null;var l=null,l=[],t=function(a){for(var e=[],d=0;d<a.length;d++)e[d]=a[d]instanceof Array?t(a[d]):a[d];return e};switch(f){case "MultiPoint":l=new a.geometry.Point(h[d][0],h[d][1],e.getSRID());if(2<g)for(f=2;f<g;f++)l.addDimension(h[d][f]);break;case "OrientedMultiPoint":return null;case "MultiLineString":l=t(h[d]);
l=new a.geometry.LineString(l,e.getSRID(),g);break;case "MultiPolygon":l=t(h[d]);l=new a.geometry.Polygon(l,e.getSRID(),g);break;case "GeometryCollection":return null;default:return null}l.mbr=null;l.getMBR();return l};a.util.GeomUtil.getSquareDistance=function(a,d){var f=a.x-d.x,g=a.y-d.y;return f*f+g*g};a.util.GeomUtil.getSquareSegmentDistance=function(a,d,f){var g=d.x;d=d.y;var h=f.x-g,l=f.y-d,t;if(0!==h||0!==l)t=((a.x-g)*h+(a.y-d)*l)/(h*h+l*l),1<t?(g=f.x,d=f.y):0<t&&(g+=h*t,d+=l*t);h=a.x-g;l=
a.y-d;return h*h+l*l};a.util.GeomUtil.simplifyRadialDistance=function(a,d){var f,g=a.length,h,l=a[0],t=[l];for(f=1;f<g;f++)h=a[f],this.getSquareDistance(h,l)>d&&(t.push(h),l=h);l!==h&&t.push(h);return t};a.util.GeomUtil.simplifyDouglasPeucker=function(a,d){var f=a.length,g=new (typeof Uint8Array!==b+""?Uint8Array:Array)(f),h=0,l=f-1,t,G,I,O,X=[],S=[],ca=[];for(g[h]=g[l]=1;l;){G=0;for(t=h+1;t<l;t++)I=this.getSquareSegmentDistance(a[t],a[h],a[l]),I>G&&(O=t,G=I);G>d&&(g[O]=1,X.push(h),S.push(O),X.push(O),
S.push(l));h=X.pop();l=S.pop()}for(t=0;t<f;t++)g[t]&&ca.push(a[t]);return ca};a.util.GeomUtil.simplify=function(a,d){var f=d!==b?d*d:1;a=this.simplifyRadialDistance(a,f);return a=this.simplifyDouglasPeucker(a,f)};a.util.GeomUtil.simplifyCoordinates=function(a,d){var f=this.coordinates2points(a),f=this.simplify(f,d);return this.points2coordinates(f)};a.util.GeomUtil.points2coordinates=function(a){for(var d=[],f=0;f<a.length;f++)d.push(a[f].x),d.push(a[f].y);return d};a.util.GeomUtil.coordinates2points=
function(a){for(var d=[],f=0;f<a.length;)d.push({x:a[f],y:a[f+1]}),f+=2;return d};a.util.GeomUtil.toValidCoordinate=function(a,d){for(var f=a.getUniverse().getMapBounds(),g=f.getWidth(),h=f.getMinX(),f=f.getMaxX(),l=0;l<d.length;l++)d[2*l]<h&&(d[2*l]-=Math.floor((d[2*l]+g/2)/g)*g),d[2*l]>f&&(d[2*l]-=Math.ceil((d[2*l]-g/2)/g)*g);return d};a.util.GeomUtil.screenPointsXOffset=function(a,d,f){var g=f.getUniverse().getMapBounds().getWidth(),h=f.getBaseWholeMapIndex(),l=f.getUniverse().getZoomLevels()[f.getZoomLevel()].resolution;
return 1<f.getWholeMapNum()?a+g*(d-h)/l+(f.getRoundMapCenterPoint().getX()-f.getCenterPoint().getX())/l:a+g*(d-h)/l};a.util.GeomUtil.EPSG_SDO_Map={3857:3857,3875:3857,4326:8307,4269:8265,4267:8260,4202:81920,4203:81921,20248:81922,20249:81924,20250:81926,20251:81928,20252:81930,20253:81932,20254:81934,20255:81936,20256:81938,20257:81940,20258:81942,20348:81923,20349:81925,20350:81927,20351:81929,20352:81931,20353:81933,20354:81935,20355:81937,20356:81939,20357:81941,20358:81943,23028:82323,23029:82328,
23030:82337,23031:82340,23032:82343,23033:82346,23034:82349,23035:82352,23036:82355,23037:82358,23038:82361};a.util.BaiduUtil=a.util.BaiduUtil||{};a.util.BaiduUtil.SRID=38578009;a.util.BaiduUtil.transformGeom=function(e){if(a.isNull(e)||a.isNull(e.map))return a.util.Logger.warning("","OM.util.BaiduUtil.transformGeom","No valid map parameter found. Please provide {'map':myMap}."),null;if(a.isNull(e.geom))return a.util.Logger.warning("","OM.util.BaiduUtil.transformGeom","No valid geometry parameter found. Please provide {'geom':myGeometry}."),
null;if(a.notNull(e.toSrid)&&(8307===e.toSrid||4326===e.toSrid)){if(8307===e.geom.srid||4326===e.geom.srid)return a.notNull(e.callBack)&&e.callBack(e.geom),e.geom;if(e.geom.srid===a.util.BaiduUtil.SRID)return a.util.BaiduUtil.transform_PixToBD09LonLat({geom:e.geom,toSrid:e.toSrid,bdutil:e.map.bdutil,callBack:e.callBack});a.util.Logger.warning("","OM.util.BaiduUtil.transformGeom","Transform not supported from "+e.geom.srid+" to "+e.toSrid);return null}if(e.geom.srid===a.util.BaiduUtil.SRID)return a.notNull(e.callBack)&&
e.callBack(e.geom),e.geom;a.isNull(e.toSrid)&&(e.toSrid=a.util.BaiduUtil.SRID);if(e.toSrid===a.util.BaiduUtil.SRID)return a.util.BaiduUtil.transform_BD09LonLatToPix({geom:e.geom,toSrid:a.util.BaiduUtil.SRID,bdutil:e.map.bdutil,callBack:e.callBack,inputIsBD09LonLat:e.inputIsBD09LonLat});a.util.Logger.warning("","OM.util.BaiduUtil.transformGeom","Transform not supported from "+e.geom.srid+" to "+e.toSrid);return null};a.util.BaiduUtil.transform_BD09LonLatToPix=function(e){if(a.isNull(e)||a.isNull(e.geom))return a.util.Logger.warning("",
"OM.util.BaiduUtil.transform_BD09LonLatToPix","No geometry found in the input parameters."),null;if(a.isNull(e.bdutil))return a.util.Logger.warning("","OM.util.BaiduUtil.transform_BD09LonLatToPix","No Baidu conversion utilities found in the input parameters."),null;var d=e.geom,f=a.util.BaiduUtil.SRID,g=e.bdutil,h=e.callBack;e=e.inputIsBD09LonLat;if(8307!==d.srid&&4326!==d.srid)return a.util.Logger.warning("","OM.util.BaiduUtil.transform_BD09LonLatToPix","SRID ["+d.srid+"] is not supported."),null;
if(d.srid===a.util.BaiduUtil.SRID)return h&&h(d,g),d;if(g)switch(d.type){case "Point":return a.util.BaiduUtil.transformLonLatToPix_Point(d,f,g,h,e);case "LineString":return a.util.BaiduUtil.transformLonLatToPix_Line(d,f,g,h,e);case "MultiLineString":return a.util.BaiduUtil.transformLonLatToPix_MultiLine(d,f,g,h,e);case "Rectangle":return a.util.BaiduUtil.transformLonLatToPix_Rectangle(d,f,g,h,e);case "Polygon":return a.util.BaiduUtil.transformLonLatToPix_Polygon(d,f,g,h,e);case "MultiPolygon":return a.util.BaiduUtil.transformLonLatToPix_MultiPolygon(d,
f,g,h,e);default:return a.util.Logger.warning("","OM.util.BaudiUtil.transform_BD09LonLatToPix","Type ["+this.type+"] is not supported yet."),null}else return a.util.Logger.warning("","OM.util.BaudiUtil.transform_BD09LonLatToPix","Baidu BD09 encoding utility is not provided."),null};a.util.BaiduUtil.transformLonLatToPix_Point=function(e,d,f,g,h){return f.enableBD09Encoding&&this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.Point_WGS84ToBaiduPix(e,d,f,g):a.util.BaiduUtil.Point_BD09LonLatToPix(e,d,
f,g)};a.util.BaiduUtil.Point_WGS84ToBaiduPix=function(e,d,f,g){var h=a.geometry,l=null;try{for(var t=f.WGS84ToBD09,G=[],I=0,O=e.coordinates.length;I<O;I+=e.dim)G.push(new BMap.Point(e.coordinates[I],e.coordinates[I+1]));t.translate(G,1,5,function(t){if(0===t.status){t=t.points;for(var G=t.length,I=[],O=0;O<G;O++){var X=f.project.lngLatToPoint(t[O]);I.push(X.x);I.push(X.y);3===e.dim&&I.push(e.coordinates[O*e.dim+2])}l=h.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:I},d);l.dim=e.dim;a.notNull(g)&&
g(l,f)}else a.util.Logger.warning(null,"OM.util.BaudiUtil.transformLonLatToPix_Point","server returned status: Failed.")});return l}catch(X){return a.util.Logger.warning(null,"OM.util.BaiduUtil.transformLonLatToPix_Point","Cannot transform geometry coordinates to SRID: "+d+", due to "+X.message),null}};a.util.BaiduUtil.Point_BD09LonLatToPix=function(e,d,f,g,h){var l=a.geometry,t=null,G,I,O,X=[],S=[],ca,sa;try{G=0;for(O=e.coordinates.length;G<O;G+=e.dim)ca=e.coordinates[G],sa=e.coordinates[G+1],h?
X.push(new BMap.Pixel(ca,sa)):X.push(new BMap.Point(ca,sa));O=X.length;S=[];for(I=0;I<O;I+=e.dim){var Na;h?(Na=f.project.pointToLngLat(X[I]),S.push(Na.lng),S.push(Na.lat)):(Na=f.project.lngLatToPoint(X[I]),S.push(Na.x),S.push(Na.y));3===e.dim&&S.push(e.coordinates[I*e.dim+2])}t=l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:S},d);t.dim=e.dim;a.notNull(g)&&g(t,f);return t}catch(Va){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Point_BD09LonLatToPix","Cannot transform geometry coordinates to SRID: "+
d+", due to "+Va.message),null}};a.util.BaiduUtil.isWithinChinaRect=function(e){var d,f,g,h;switch(e.type){case "Polygon":d=[];for(h=0;h<e.coordinates.length;h++)for(g=0;g<e.coordinates[h].length;g++)d.push(e.coordinates[h][g]);break;case "MultiPolygon":d=[];for(f=0;f<e.coordinates.length;f++){var l=e.coordinates[f];for(h=0;h<l.length;h++)for(g=0;g<l[h].length;g++)d.push(l[h][g])}break;case "MultiLine":d=[];for(h=0;h<e.coordinates.length;h++)for(g=0;g<e.coordinates[h].length;g++)d.push(e.coordinates[h][g]);
break;default:d=e.getOrdinates()}f=e.getDimension();e={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY};e=a.geometry.Geometry.getCoordsMBR(d,f,e);d=a.util.GeomUtil.pointInRect;return d(e.minX,e.minY,73,1,134,53)&&d(e.minX,e.maxY,73,1,134,53)&&d(e.maxX,e.minY,73,1,134,53)&&d(e.maxX,e.maxY,73,1,134,53)?!0:!1};a.util.BaiduUtil.MultiLine_WGS84ToBaiduPix=function(e,d,f,g){var h=a.geometry,l,t,G,I,O,X;try{var S=0,ca=[];for(O=0;O<e.coordinates.length;O+=
1){var sa=e.coordinates[O],Na=Math.ceil(sa.length/200);ca.push(Na);var Va=[],Jb={};G=0;for(X=sa.length;G<X;G+=e.dim){var b=sa[G],ub=sa[G+1];0<G&&0===G%200?(t=Va.join(""),Va=[],a.util.BaiduUtil.doBaiduConversion(t,Jb,S,f),S+=1):G===X-e.dim&&(Va.push(";"+b+","+ub),t=Va.join(""),Va=[],a.util.BaiduUtil.doBaiduConversion(t,Jb,S,f),S+=1);0===G||0===G%200?Va.push(""+b+","+ub):Va.push(";"+b+","+ub)}}var zb=!0,rb,Ab=0;rb=setInterval(function(){a:if(Ab++,100<Ab)clearInterval(rb),a.util.Logger.warning(null,
"OM.util.BaudiUtil.MultiLine_WGS84ToBaiduPix","Failed to assemble the feature.");else{for(O=S=0;O<ca.length;O+=1)for(G=0;G<ca[O];G+=1){if(a.isNull(Jb[S.toString()])){zb=!1;break a}S+=1}if(!0===zb){clearInterval(rb);var t=[];S=0;var X=[];for(G=0;G<ca.length;G+=1){var t=[],sa=S.toString();for(O=0;O<Jb[S].length;O+=1){var va=new BMap.Point(Jb[sa][O].x,Jb[sa][O].y),va=f.project.lngLatToPoint(va);t.push(va.x);t.push(va.y);for(I=2;I<e.dim;I+=1)t.push("")}S+=1;X.push(t)}l=h.Geometry.createGeometry({type:e.type,
dim:e.dim,coordinates:X},d);l.dim=e.dim;g(l,f)}}},1E3);return l}catch(Eb){return a.util.Logger.warning(null,"OM.util.BaiduUtil.MultiLine_WGS84ToBaiduPix","Cannot transform geometry coordinates to SRID: "+d+", due to "+Eb.message),null}};a.util.BaiduUtil.MultiLine_BD09LonLatToPix=function(e,d,f,g,h){var l=a.geometry;try{for(var t=[],G=0;G<e.coordinates.length;G+=1){for(var I=e.coordinates[G],O=[],X=0;X<I.length;X+=e.dim){var S;h?(S=f.project.pointToLngLat(new BMap.Pixel(I[X],I[X+1])),O.push(S.lng),
O.push(S.lat)):(S=f.project.lngLatToPoint(new BMap.Point(I[X],I[X+1])),O.push(S.x),O.push(S.y));for(var ca=2;ca<e.dim;ca+=1)O.push("")}t.push(O)}var sa=l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:t},d);g&&g(sa,f);return sa}catch(Na){return a.util.Logger.warning(null,"OM.util.BaiduUtil.MultiLine_BD09LonLatToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+Na.message),null}};a.util.BaiduUtil.Polygon_WGS84ToPix=function(e,d,f,g){var h=a.geometry,l,t,G,I,O;try{var X=
0,S=[],ca;for(G=0;G<e.coordinates.length;G+=1){var sa=e.coordinates[G],Na=Math.ceil(sa.length/200);S.push(Na);var Va=[],b={};l=0;for(I=sa.length;l<I;l+=e.dim){var c=sa[l],ub=sa[l+1];0<l&&0===l%200?(ca=Va.join(""),Va=[],a.util.BaiduUtil.doBaiduConversion(ca,b,X,f),X+=1):l===I-e.dim&&(Va.push(";"+c+","+ub),ca=Va.join(""),Va=[],a.util.BaiduUtil.doBaiduConversion(ca,b,X,f),X+=1);0===l||0===l%200?Va.push(""+c+","+ub):l!==I-e.dim&&Va.push(";"+c+","+ub)}}var zb=!0,rb,Ab=0;rb=setInterval(function(){a:if(Ab++,
100<Ab)clearInterval(rb),a.util.Logger.warning(null,"OM.util.BaudiUtil.Polygon_WGS84ToPix","Failed to assemble the feature.");else{var I=0;for(G=0;G<S.length;G+=1)for(l=0;l<S[G];l+=1){if(a.isNull(b[I.toString()])){zb=!1;break a}I+=1}if(!0===zb){clearInterval(rb);var X=[],I=0,ca=[];for(l=0;l<S.length;l+=1){var X=[],va=I.toString();for(G=0;G<b[I].length;G+=1){var sa=new BMap.Point(b[va][G].x,b[va][G].y),sa=f.project.lngLatToPoint(sa);X.push(sa.x);X.push(sa.y);for(t=2;t<e.dim;t+=1)X.push("")}I+=1;ca.push(X)}O=
h.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:ca},d);O.dim=e.dim;g(O,f)}}},1E3);return O}catch(Eb){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Polygon_WGS84ToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+Eb.message),null}};a.util.BaiduUtil.Rectangle_WGS84ToPix=function(e,d,f,g){var h=a.geometry,l,t,G,I,O;try{var X=0,S=[],ca;for(G=0;G<e.coordinates.length;G+=1){var sa=e.coordinates[G];S.push(1);var Na=[],Va={};l=0;for(I=sa.length;l<I;l+=e.dim){var b=sa[l],
c=sa[l+1];0<l&&0===l%200?(ca=Na.join(""),Na=[],a.util.BaiduUtil.doBaiduConversion(ca,Va,X,f),X+=1):l===I-e.dim&&(Na.push(";"+b+","+c),ca=Na.join(""),Na=[],a.util.BaiduUtil.doBaiduConversion(ca,Va,X,f),X+=1);0===l?Na.push(""+b+","+c):l!==I-e.dim&&Na.push(";"+b+","+c)}a.util.BaiduUtil.doBaiduConversion(ca,Va,X,f)}var ub=!0,zb,rb=0;zb=setInterval(function(){a:if(rb++,100<rb)clearInterval(zb),a.util.Logger.warning(null,"OM.util.BaudiUtil.Rectangle_WGS84ToPix","Failed to assemble the feature.");else{var I=
0;for(G=0;G<S.length;G+=1)for(l=0;l<S[G];l+=1){if(a.isNull(Va[I.toString()])){ub=!1;break a}I+=1}if(!0===ub){clearInterval(zb);var X=[],I=0,ca=[];for(l=0;l<S.length;l+=1){var X=[],sa=I.toString();for(G=0;G<Va[I].length;G+=1){var va=new BMap.Point(Va[sa][G].x,Va[sa][G].y),va=f.project.lngLatToPoint(va);X.push(va.x);X.push(va.y);for(t=2;t<e.dim;t+=1)X.push("")}I+=1;ca.push(X)}O=h.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:ca},d);O.dim=e.dim;g(O,f)}}},1E3);return O}catch(Ab){return a.util.Logger.warning(null,
"OM.util.BaiduUtil.Rectangle_WGS84ToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+Ab.message),null}};a.util.BaiduUtil.Polygon_BD09LonLatToPix=function(e,d,f,g,h){var l=a.geometry,t;try{for(var G=[],I=0;I<e.coordinates.length;I+=1){for(var O=e.coordinates[I],X=[],S=0;S<O.length;S+=e.dim){var ca;h?(ca=f.project.pointToLngLat(new BMap.Pixel(O[S],O[S+1])),X.push(ca.lng),X.push(ca.lat)):(ca=f.project.lngLatToPoint(new BMap.Point(O[S],O[S+1])),X.push(ca.x),X.push(ca.y));for(var sa=
2;sa<e.dim;sa+=1)X.push("")}G.push(X)}t=l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:G},d);g&&g(t,f);return t}catch(Na){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Polygon_BD09LonLatToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+Na.message),null}};a.util.BaiduUtil.Rectangle_BD09LonLatToPix=function(e,d,f,g,h){var l=a.geometry,t;try{for(var G=e.coordinates,I=[],O=0;O<G.length;O+=e.dim){var X;h?(X=f.project.pointToLngLat(new BMap.Pixel(G[O],G[O+1])),I.push(X.lng),
I.push(X.lat)):(X=f.project.lngLatToPoint(new BMap.Point(G[O],G[O+1])),I.push(X.x),I.push(X.y))}t=l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:I},d);g&&g(t,f);return t}catch(S){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Rectangle_BD09LonLatToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+S.message),null}};a.util.BaiduUtil.MultiPolygon_WGS84LonLatToPix=function(e,d,f,g){var h=a.geometry,l,t,G,I,O;try{var X=0,S=[],ca;for(I=0;I<e.coordinates.length;I+=1){var sa=
e.coordinates[I],Na=Math.ceil(sa.length/200);S.push(Na);var Va=[],b={};t=0;for(O=sa.length;t<O;t+=e.dim){var c=sa[t],ub=sa[t+1];0<t&&0===t%200?(ca=Va.join(""),Va=[],a.util.BaiduUtil.doBaiduConversion(ca,b,X,f),X+=1):t===O-e.dim&&(Va.push(";"+c+","+ub),ca=Va.join(""),Va=[],a.util.BaiduUtil.doBaiduConversion(ca,b,X,f),X+=1);0===t||0===t%200?Va.push(""+c+","+ub):Va.push(";"+c+","+ub)}}var zb=!0,rb,Ab=0;rb=setInterval(function(){a:if(Ab++,100<Ab)clearInterval(rb),a.util.Logger.warning(null,"OM.util.BaudiUtil.MultiPolygon_WGS84LonLatToPix",
"Failed to assemble the feature.");else{var O=0;for(I=0;I<S.length;I+=1)for(t=0;t<S[I];t+=1){if(a.isNull(b[O.toString()])){zb=!1;break a}O+=1}if(!0===zb){clearInterval(rb);var X,O=0,ca=[];for(t=0;t<S.length;t+=1){X=[];var va=O.toString();for(I=0;I<b[O].length;I+=1){var sa=new BMap.Point(b[va][I].x,b[va][I].y),sa=f.project.lngLatToPoint(sa);X.push(sa.x);X.push(sa.y);for(G=2;G<e.dim;G+=1)X.push("")}O+=1;ca.push(X)}l=h.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:ca},d);l.dim=e.dim;g(l,
f)}}},1E3);return l}catch(Eb){return a.util.Logger.warning(null,"OM.util.BaiduUtil.MultiPolygon_WGS84LonLatToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+Eb.message),null}};a.util.BaiduUtil.MultiPolygon_BD09LonLatToPix=function(e,d,f,g,h){var l=a.geometry,t,G,I,O;try{var X=[];for(G=0;G<e.coordinates.length;G+=1){var S=e.coordinates[G][0],ca=[];for(O=0;O<S.length;O+=e.dim){var sa;h?(sa=f.project.pointToLngLat(new BMap.Pixel(S[O],S[O+1])),ca.push(sa.lng),ca.push(sa.lat)):(sa=
f.project.lngLatToPoint(new BMap.Point(S[O],S[O+1])),ca.push(sa.x),ca.push(sa.y));for(I=2;I<e.dim;I+=1)ca.push("")}var Na=[];Na.push(ca);X.push(Na)}t=l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:X},d);g&&g(t,f);return t}catch(Va){return a.util.Logger.warning(null,"OM.util.BaiduUtil.MultiPolygon_BD09LonLatToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+Va.message),null}};a.util.BaiduUtil.Line_WGS84ToBaiduPix=function(e,d,f,g){var h=a.geometry,l,t,G,I,O;try{var X,
S=0,ca=Math.ceil(e.coordinates.length/200),sa=[],Na={};l=0;for(I=e.coordinates.length;l<I;l+=e.dim){var Va=e.coordinates[l],b=e.coordinates[l+1];0<l&&0===l%200?(X=sa.join(""),sa=[],a.util.BaiduUtil.doBaiduConversion(X,Na,S,f),S+=1):l===I-e.dim&&(sa.push(";"+Va+","+b),X=sa.join(""),sa=[],a.util.BaiduUtil.doBaiduConversion(X,Na,S,f),S+=1);0===l||0===l%200?sa.push(""+Va+","+b):sa.push(";"+Va+","+b)}var c=!0,ub,zb=0;ub=setInterval(function(){a:if(zb++,100<zb)clearInterval(ub),a.util.Logger.warning(null,
"OM.util.BaiduUtil.Line_WGS84ToBaiduPix","Failed to assemble the feature.");else{for(l=0;l<ca;l+=1)if(a.isNull(Na[l.toString()])){c=!1;break a}if(!0===c){clearInterval(ub);var I=[];for(l=0;l<ca;l+=1){var S=l.toString();for(G=0;G<Na[S].length;G+=1){var X=new BMap.Point(Na[S][G].x,Na[S][G].y),X=f.project.lngLatToPoint(X);I.push(X.x);I.push(X.y);for(t=2;t<e.dim;t+=1)I.push("")}}O=h.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:I},d);O.dim=e.dim;g(O,f)}}},1E3);return O}catch(rb){return a.util.Logger.warning(null,
"OM.util.BaiduUtil.Line_WGS84ToBaiduPix","Cannot transform geometry coordinates to SRID "+d+", due to "+rb.message),null}};a.util.BaiduUtil.Line_BD09LonLatToPix=function(e,d,f,g,h){var l=a.geometry,t,G,I;try{var O=[];for(I=0;I<e.coordinates.length;I+=e.dim){var X;h?(X=f.project.pointToLngLat(new BMap.Pixel(e.coordinates[I],e.coordinates[I+1])),O.push(X.lng),O.push(X.lat)):(X=f.project.lngLatToPoint(new BMap.Point(e.coordinates[I],e.coordinates[I+1])),O.push(X.x),O.push(X.y));for(G=2;G<e.dim;G+=1)O.push("")}t=
l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:O},d);g&&g(t,f);return t}catch(S){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Line_BD09LonLatToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+S.message),null}};a.util.BaiduUtil.transformLonLatToPix_MultiLine=function(e,d,f,g,h){return f.enableBD09Encoding&&this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.MultiLine_WGS84ToBaiduPix(e,d,f,g):a.util.BaiduUtil.MultiLine_BD09LonLatToPix(e,d,f,g)};a.util.BaiduUtil.transformLonLatToPix_Line=
function(e,d,f,g,h){return f.enableBD09Encoding&&this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.Line_WGS84ToBaiduPix(e,d,f,g):a.util.BaiduUtil.Line_BD09LonLatToPix(e,d,f,g)};a.util.BaiduUtil.transformLonLatToPix_Rectangle=function(e,d,f,g,h){return f.enableBD09Encoding&&this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.Rectangle_WGS84ToPix(e,d,f,g):a.util.BaiduUtil.Rectangle_BD09LonLatToPix(e,d,f,g)};a.util.BaiduUtil.transformLonLatToPix_Polygon=function(e,d,f,g,h){return f.enableBD09Encoding&&
this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.Polygon_WGS84ToPix(e,d,f,g):a.util.BaiduUtil.Polygon_BD09LonLatToPix(e,d,f,g)};a.util.BaiduUtil.transformLonLatToPix_MultiPolygon=function(e,d,f,g,h){return f.enableBD09Encoding&&this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.MultiPolygon_WGS84LonLatToPix(e,d,f,g):a.util.BaiduUtil.MultiPolygon_BD09LonLatToPix(e,d,f,g)};a.util.BaiduUtil.doBaiduConversion=function(e,d,f,g){var h={};h.coords=e;h.from="1";h.to="5";h.ak=g.ak;$.ajax({type:"GET",dataType:"jsonp",
data:h,crossDomain:!0,url:g.BD09_APIURL,success:function(e){if(0===e.status){var g,h=[];for(g=0;g<e.result.length;g++)h.push(e.result[g]);d[f.toString()]=h}else a.util.Logger.warning("","OM.util.BaiduUtil.doBaiduConversion","baidu server returned error: "+e.message)},error:function(){a.util.Logger.warning("","OM.util.BaiduUtil.doBaiduConversion","failed to encode.")}})};a.util.BaiduUtil.isZoomLevelValid=function(e){return e&&3>e?(a.util.Logger.warning("","OM.Map.setMapCenterAndZoomLevel","Baidu Map zoome level cannot be smaller than 3"),
!1):e&&18<e?(a.util.Logger.warning("","OM.Map.setMapCenterAndZoomLevel","Baidu Map zoome level cannot be larger than 18"),!1):!0};a.util.BaiduUtil.transform_PixToBD09LonLat=function(e){a.isNull(e.toSrid)&&(e.toSrid=8307);var d=e.geom;if(a.isNull(d.srid)||a.isNull(e.toSrid))return a.util.Logger.warning("","OM.util.BaiduUtil.transform_BD09LonLatToPix","SRID is not specified."),null;var f=e.geom,g=e.callBack,h=e.bdutil,l=e.toSrid;if(8307===d.srid||4326===d.srid)return g&&g(d,h),f;if(e.bdutil)switch(d.type){case "Point":return a.util.BaiduUtil.Point_BD09LonLatToPix(d,
l,h,g,!0);case "LineString":return a.util.BaiduUtil.Line_BD09LonLatToPix(f,l,h,g,!0);case "MultiLineString":return a.util.BaiduUtil.MultiLine_BD09LonLatToPix(f,l,h,g,!0);case "Rectangle":return a.util.BaiduUtil.Rectangle_BD09LonLatToPix(f,l,h,g,!0);case "Polygon":return a.util.BaiduUtil.Polygon_BD09LonLatToPix(f,l,h,g,!0);case "MultiPolygon":return a.util.BaiduUtil.MultiPolygon_BD09LonLatToPix(f,l,h,g,!0);default:return a.util.Logger.warning("","OM.util.BaudiUtil.transform_PixToBD09LonLat","Type ["+
this.type+"] is not supported yet."),null}else return a.util.Logger.warning("","OM.util.BaudiUtil.transform_PixToBD09LonLat","Baidu BD09 encoding utility is not provided."),null};a.util.DomUtil=function(){};a.util.DomUtil.css=function(e){var d=document.styleSheets,f={},g;for(g in d)try{var h=d[g].rules||d[g].cssRules,l;for(l in h)e.is(h[l].selectorText)&&a.$.extend(f,a.util.DomUtil.css2json(h[l].style))}catch(t){}a.$.extend(f,a.util.DomUtil.css2json(e.attr("style")));return f};a.util.DomUtil.css2json=
function(a){var d={};if(!a)return d;var f;if(a instanceof CSSStyleDeclaration)for(f in a)a[f].toLowerCase&&(d[a[f].toLowerCase()]=a[a[f]]);else if("string"==typeof a)for(f in a=a.split(";"),a){var g=a[f].split(":");d[g[0].toLowerCase()]=g[1]}return d};a.util.DomUtil.getComputedStyle=function(a){var d={};if(c.getComputedStyle){var f=function(a,e){return e.toUpperCase()};a=c.getComputedStyle(a,null);for(var g=0,h=a.length;g<h;g++){var l=a[g],t=l.replace(/\-([a-z])/g,f),l=a.getPropertyValue(l);d[t]=
l}}else if(a.currentStyle)for(f in a=a.currentStyle,a)d[f]=a[f];return d};a.util.DomUtil.setImageSrc=function(e,d,f){var g=a.$(e);d?(g.css("opacity",f),g.attr("src",d)):g.attr("src",a.util.MiscUtil.transparentImgURL);g[0].onerror=function(){g.attr("src",a.gv.resourcePath()+"blank.gif");a.util.Logger.warning("","OM.util.DomUtil.setImageSrc","Failed fetching image from: "+d)}};a.util.DomUtil.changeOpacity=function(e,d){a.$(e).css("opacity",d)};a.util.DomUtil.pixel=function(a){return Math.round(a)+"px"};
a.util.DomUtil.createImageNode=function(e,d){var f=null,f=document.createElement("img");f.src=e;a.browser.msie&&!d&&(f.galleryImg="no");a.browser.mozilla?f.style.MozUserSelect="none":a.browser.safari?f.style.KhtmlUserSelect="none":a.browser.msie&&(f.unselectable="on");return f};a.util.DomUtil.setCursor=function(e,d){try{-1<d.indexOf(".")&&(d='url("'+d+'"),auto'),e.style.cursor=d}catch(f){"pointer"==d&&a.util.DomUtil.setCursor(e,"hand")}};a.util.DomUtil.getTouchCount=function(e){if(a.isNull(e.originalEvent)&&
a.isNull(e.touches))return a.util.Logger.warning("","OM.util.DomUtil.getTouchCount","Received event with no touch information: "),0;e.originalEvent&&(e=e.originalEvent);if("TOUCHSTART"===e.type.toUpperCase())return e.touches.length;if("TOUCHEND"===e.type.toUpperCase())return e.changedTouches.length};a.util.DomUtil.getTouchesPosition=function(a){a.originalEvent&&(a=a.originalEvent);if(a.touches){for(var d=a.touches.length,f=[],g=0;g<d;g++)f.push({x:a.touches[g].pageX,y:a.touches[g].pageY});return 1==
f.length?f[0]:f}return[]};a.util.DomUtil.getTouchesClientPosition=function(a){a.originalEvent&&(a=a.originalEvent);if(a.touches){for(var d=a.touches.length,f=[],g=0;g<d;g++)f.push({x:a.touches[g].clientX,y:a.touches[g].clientY});return 1===f.length?f[0]:f}return[]};a.util.DomUtil.getChangedTouchesPosition=function(a){a.originalEvent&&(a=a.originalEvent);if(a.changedTouches){for(var d=a.changedTouches.length,f=[],g=0;g<d;g++)f.push({x:a.changedTouches[g].pageX,y:a.changedTouches[g].pageY});return f}return[]};
a.util.DomUtil.getTouchesScale=function(a){a.originalEvent&&(a=a.originalEvent);return a.scale};a.util.DomUtil.getElementPos=function(a){if(a)return a.position()};a.util.DomUtil.getPageDirection=function(e){this.$div=a.$("\x3cdiv style\x3d'position:absolute;width:0px;height:0px;z-index:3000'\x3e\x3c/div\x3e");e.$topLayerDIV.append(this.$div);e=document.createElement("table");var d=document.createElement("tr"),f=document.createElement("td"),g=document.createElement("td"),h=document.createElement("tbody");
e.cellSpacing=0;e.cellPadding=0;f.innerHTML="fsdfsds";g.innerHTML="p";h.appendChild(d);e.appendChild(h);d.appendChild(f);d.appendChild(g);this.$div[0].appendChild(e);this.pageDirection=0===f.offsetLeft?!0:!1;this.$div[0].removeChild(e);this.$div.remove();return this.pageDirection};a.util.DomUtil.isHtml=function(a){return 0<=a.indexOf("\x3c!DOCTYPE")||0<=a.toUpperCase().indexOf("\x3cHTML")||0<=a.toUpperCase().indexOf("\x3cBODY")||0<=a.toUpperCase().indexOf("\x3cIMG")||0<=a.toUpperCase().indexOf("\x3cDIV")||
0<=a.toUpperCase().indexOf("\x3cP\x3e")||0<=a.toUpperCase().indexOf("\x3cBR")||0<=a.toUpperCase().indexOf("\x3cA")||0<=a.toUpperCase().indexOf("\x3cTABLE")||0<=a.toUpperCase().indexOf("\x3cTEXTAREA")||0<=a.toUpperCase().indexOf("\x3cINPUT")||0<=a.toUpperCase().indexOf("\x3cFONT")||0<=a.toUpperCase().indexOf("\x3cAREA")||0<=a.toUpperCase().indexOf("\x3cLABEL")||0<=a.toUpperCase().indexOf("\x3cTD")?!0:0<=a.toUpperCase().indexOf("\x3cSPAN")?!0:!1};a.util.DomUtil.setFontIcon=function(e,d,f){if(e)return e=
a.$(e),e.attr("omv2-font-icon",d),a.notNull(f)&&e.css("color",f),e};a.util.XMLUtil={};a.util.XMLUtil.parse="undefined"!==typeof c.DOMParser?function(a){return(new DOMParser).parseFromString(a,"text/xml")}:function(a){var d=new ActiveXObject("Microsoft.XMLDOM");d.async="false";d.loadXML(a);return d};a.util.XMLUtil.xmlToString="undefined"!==typeof XMLSerializer?function(a){return(new XMLSerializer).serializeToString(a)}:function(a){return a.xml};a.util.XMLUtil.getAllTextContent=function(e,d){return a.util.XMLUtil.getAllTextContent_(e,
d,[]).join("")};a.util.XMLUtil.getAllTextContent_=function(e,d,f){if(e.nodeType===Node.CDATA_SECTION_NODE||e.nodeType===Node.TEXT_NODE)d?f.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):f.push(e.nodeValue);else for(e=e.firstChild;e;e=e.nextSibling)a.util.XMLUtil.getAllTextContent_(e,d,f);return f};a.util.XMLUtil.getAttributeNS=function(a,d,f){return a.getAttributeNS(d,f)||""};a.util.XMLUtil.makeArrayPusher=function(a,d){return function(f,g){var h=a.call(d!==b?d:this,f,g);h!==b&&g[g.length-
1].push(h)}};a.util.XMLUtil.makeObjectPropertyPusher=function(a,d,f){return function(g,h){var l=a.call(f!==b?f:this,g,h);if(l!==b){var t=h[h.length-1],G=d!==b?d:g.localName;(G in t?t[G]:t[G]=[]).push(l)}}};a.util.XMLUtil.makeObjectPropertySetter=function(a,d,f){return function(g,h){var l=a.call(f!==b?f:this,g,h);l!==b&&(h[h.length-1][d!==b?d:g.localName]=l)}};a.util.XMLUtil.makeStructureNS=function(a,d,f){f=f!==b?f:{};f[a]=d;return f};a.util.XMLUtil.parseNode=function(a,d,f,g){for(d=d.firstElementChild;d;d=
d.nextElementSibling){var h=a[d.namespaceURI];h!==b&&(h=h[d.localName],h!==b&&h.call(g,d,f))}};a.util.XMLUtil.pushParseAndPop=function(e,d,f,g,h){g.push(e);a.util.XMLUtil.parseNode(d,f,g,h);return g.pop()};a.util.ValidationUtil=a.util.ValidationUtil||{isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isNumber2:function(a){return null!==a&&"number"===typeof a},isObject:function(a){return null!==a&&"object"===typeof a},isNumberArray:function(e){if(!e||"object"!==typeof e)return!1;var d=
e.length;if(0===d)return!1;for(var f=a.util.ValidationUtil.isNumber,g=0;g<d;g++)if(!f(e[g]))return!1;return!0},getColor:function(e){if(a.isNull(e))return null;var d=typeof e;if("string"===d)return/#[0-9a-fA-F]{6}/.test(e)?e:/[0-9a-fA-F]{6}/.test(e)?"#"+e:null;if("number"===d){if(0===e)return"#000000";for(e=Math.round(e).toString(16);6>e.length;)e="0"+e;return"#"+e}return null}};a.util.CSTransformUtil=a.util.CSTransformUtil||function(){var e=[],d=[{srid:54004,params:[0,0,1,0,0]},{srid:8307,params:[6378137,
298.257223563]}],f=new function(){this.getCSTransformFunction=function(d,f){var l=e[d];if(l){if(a.notNull(l[f]))return l[f];var t=l[8307],G=e[8307][f];return a.notNull(t)&&a.notNull(G)?function(a,e){var d=t(a,e);return G(d.x,d.y)}:null}return null};this.addCSTransformFunction=function(a,d,f){var t=e[a];t||(t=e[a]=[]);t[d]=f};this.transOrdinatesArray=function(a,e,d){for(var f=a.length,G=Array(f),I=0;I<f;I+=e){var O=d(a[I],a[I+1]);G[I]=O.x;G[I+1]=O.y;for(O=2;O<e;O++)G[I+O]=a[I+O]}return G};this.transformOrdinates=
function(e,d,f){var t=a.util.ValidationUtil,G=null;f||(f=2);var I=this.transOrdinatesArray;if(t.isNumberArray(d))G=I(d,f,e);else for(var O=d.length,G=Array(O),X=0;X<O;X++)if(t.isNumberArray(d[X]))G[X]=I(d[X],f,e);else{var S=d[X].length;G[X]=Array(S);for(var ca=0;ca<S;ca++)G[X][ca]=I(d[X][ca],f,e)}return G};this.bootstrapTransformations=function(){var e=this,d=e.addCSTransformFunction;d(54004,8307,function(a,d){return e.mercatorToGeodetic(a,d,54004,8307)});d(8307,54004,function(a,d){return e.geodeticToMercator(a,
d,8307,54004)});d(3785,8307,function(a,d){return e.SphereMercatorToGeodetic(a,d,6378137)});d(8307,3785,function(a,d){return e.geodeticToSphereMercator(a,d,6378137)});d(3857,8307,function(a,d){return e.SphereMercatorToGeodetic(a,d,6378137)});d(8307,3857,function(a,d){return e.geodeticToSphereMercator(a,d,6378137)});d(53004,8307,function(a,d){return e.SphereMercatorToGeodetic(a,d,6371E3)});d(8307,53004,function(a,d){return e.geodeticToSphereMercator(a,d,6371E3)});d(54004,4326,function(a,d){return e.mercatorToGeodetic(a,
d,54004,8307)});d(4326,54004,function(a,d){return e.geodeticToMercator(a,d,8307,54004)});d(3785,4326,function(a,d){return e.SphereMercatorToGeodetic(a,d,6378137)});d(4326,3785,function(a,d){return e.geodeticToSphereMercator(a,d,6378137)});d(3857,4326,function(a,d){return e.SphereMercatorToGeodetic(a,d,6378137)});d(4326,3857,function(a,d){return e.geodeticToSphereMercator(a,d,6378137)});d(53004,4326,function(a,d){return e.SphereMercatorToGeodetic(a,d,6371E3)});d(4326,53004,function(a,d){return e.geodeticToSphereMercator(a,
d,6371E3)});d(53004,54004,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6371E3);return e.geodeticToMercator(f.x,f.y,8307,54004)});d(54004,53004,function(a,d){var f=e.mercatorToGeodetic(a,d,54004,8307);return e.geodeticToSphereMercator(f.x,f.y,6371E3)});d(3785,54004,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6378137);return e.geodeticToMercator(f.x,f.y,8307,54004)});d(54004,3785,function(a,d){var f=e.mercatorToGeodetic(a,d,54004,8307);return e.geodeticToSphereMercator(f.x,f.y,6378137)});
d(3857,54004,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6378137);return e.geodeticToMercator(f.x,f.y,8307,54004)});d(54004,3857,function(a,d){var f=e.mercatorToGeodetic(a,d,54004,8307);return e.geodeticToSphereMercator(f.x,f.y,6378137)});d(3785,53004,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6378137);return e.geodeticToSphereMercator(f.x,f.y,6371E3)});d(53004,3785,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6371E3);return e.geodeticToSphereMercator(f.x,f.y,6378137)});d(3857,
53004,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6378137);return e.geodeticToSphereMercator(f.x,f.y,6371E3)});d(53004,3857,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6371E3);return e.geodeticToSphereMercator(f.x,f.y,6378137)});d(3857,3785,function(a,e){return{x:a,y:e}});d(3785,3857,function(a,e){return{x:a,y:e}});var f=new a.proj.Albers({standardParallel_1:29.5,standardParallel_2:45.5,lonCenter:-96,latOrigin:23});d(8307,32775,f.forward);d(32775,8307,f.inverse);d(8307,505050,a.proj.AlbersUSA.forward);
d(505050,8307,a.proj.AlbersUSA.inverse);d(4326,505050,a.proj.AlbersUSA.forward);d(505050,4326,a.proj.AlbersUSA.inverse);f=new a.proj.Winkel3(0);d(8307,1009801,f.forward);d(1009801,8307,f.inverse);f=new a.proj.Robinson(0);d(8307,180224,f.forward);d(180224,8307,f.inverse)};this.geodeticToMercator=function(e,d,f,t){var G=this.getCSParameters(t),I=this.getCSParameters(f);if(!G||!I)return null;d=a.util.GeomUtil.getRadiansFromLatLon(e,d);e=d.x;d=d.y;var O=G[3];f=G[4];t=G[2];var X=G[1],G=I[0],I=1/I[1],I=
Math.sqrt(2*I-I*I);e=O+G*t*(e-X);O=Math.sin(d);d=Math.tan(Math.PI/4+d/2);O=Math.pow((1-I*O)/(1+I*O),I/2);d=f+G*t*Math.log(d*O);return{x:e,y:d}};this.mercatorToGeodetic=function(e,d,f,t){var G=this.getCSParameters(f),I=this.getCSParameters(t);if(!G||!I)return null;t=G[3];var O=G[4];f=G[2];var G=G[1],X=I[0],I=1/I[1],I=Math.sqrt(2*I-I*I);d=Math.pow(Math.E,(O-d)/(X*f));d=Math.PI/2-2*Math.atan2(d,1);var S=Math.pow(I,4),ca=Math.pow(I,6),sa=Math.pow(I,8),I=I*I/2,O=5*S/24,Na=ca/12,Va=13*sa/360,b=Math.sin(2*
d),S=7*S/48,c=29*ca/240,ub=811*sa/11520,zb=Math.sin(2*d),ca=7*ca/120,rb=81*sa/1120,Ab=Math.sin(6*d),sa=4279*sa/161280,Eb=Math.sin(8*d);return a.util.GeomUtil.getLatLonFromRadians((e-t)/(X*f)+G,d+(I+O+Na+Va)*b+(S+c+ub)*zb+(ca+rb)*Ab+sa*Eb)};this.getCSParameters=function(a){for(var e=d.length,f=0;f<e;f++)if(d[f].srid===a)return d[f].params;return null};this.geodeticToSphereMercator=function(e,d,f){85<d?d=85:-85>d&&(d=-85);d=a.util.GeomUtil.getRadiansFromLatLon(e,d);e=d.x;d=d.y;d=Math.sin(d);d=Math.log((1+
d)/(1-d));return{x:f*e,y:d*f/2}};this.SphereMercatorToGeodetic=function(e,d,f){e/=f;d=Math.pow(Math.E,2*d/f);d=Math.asin((d-1)/(d+1));return a.util.GeomUtil.getLatLonFromRadians(e,d)}};f.bootstrapTransformations();return f}();a.util.HttpRequest={};a.util.HttpRequest.localDomain=document.location.protocol+"//"+document.location.host;a.util.HttpRequest.instanceId=Math.round(1E4*Math.random());a.util.HttpRequest.reqCount=0;a.util.HttpRequest.scriptTagCount=0;a.util.HttpRequest.requests=[];a.util.HttpRequest.urlMaxLength=
4E3;a.util.HttpRequest.instanceIdTable={};a.util.HttpRequest.send=function(e,d,f,g,h,l,t){if(e){a.isNull(t)&&(t=a.gv.proxyEnabled);var G=a.util.HttpRequest,I=function(d,f,g){"abort"!==g&&(h?h(d,f,g):(f="URL: "+e,g&&(f+="\nError: "+g),d&&d.responseText&&(f+="\nResponse : "+d.responseText),a.util.Logger.alert("MAPVIEWER_9014","OM.util.HttpRequest.send",f)))},O="POST";"GET"===a.gv._httpMethod&&(O="GET");var X=!1;d.$enableXHR&&(X=!0,delete d.$enableXHR);return G.isLocalDomain(e)||X?"json"===g||"jsonp"===
g?(new G.XHR(a.$.ajax({url:e,data:d,method:O,success:function(e){try{var d=null,d=a.$.parseJSON(e);f(d)}catch(g){e=g.message,g.stack&&(e+="\n  Stack: "+g.stack),a.util.Logger.warning("MAPVIEWER_9013","OM.util.HttpRequest.send",e),h&&h(this.jqXHR,"Error parsing response as JSON data.",g)}},dataType:"text",xhrFields:{withCredentials:!0}}))).setErrorHandler(I):(new G.XHR(a.$.ajax({url:e,method:O,data:d,success:f,dataType:g,xhrFields:{withCredentials:!0}}))).setErrorHandler(I):"jsonp"===g||"xml"===g||
"XML"===g||"Xml"===g?(new G.XHR(a.$.ajax({url:e,method:O,data:d,success:f,dataType:g}))).setErrorHandler(I):t?(l=a.util.HttpRequest.localDomain+a.gv.proxyPath,d.rtarget=e,(new G.XHR(O(l,d,function(a){f(a)},g))).setErrorHandler(I)):G.sendAsScripts(e,d,f,g,l)}};a.util.HttpRequest.sendAsScripts=function(e,d,f,g,h){function l(a){G=a;t.instanceIdTable[e]=a;t.sendAsScriptsWithId(e,d,f,g,G)}if(!e)return null;var t=a.util.HttpRequest,G=t.instanceIdTable[e];if(a.isNull(G)){var I="v2"+t.reqCount++,O=e,O=0<
O.indexOf("?")?O+"\x26":O+"?",O=O+("callback_id\x3d"+I+"\x26"),X="text",S=l;h?(t.instanceIdTable[e]="_1",X=g,S=f):O+="getinstid\x3dtrue";O+="\x26"+a.$.param(d);return t.sendAsScript(O,S,X,I)}return t.sendAsScriptsWithId(e,d,f,g,G)};a.util.HttpRequest.sendAsScriptsWithId=function(e,d,f,g,h){var l=a.util.HttpRequest,t=new l.XHR;h="v2"+h+"_"+l.reqCount++;e=0<e.indexOf("?")?e+"\x26":e+"?";e+="callback_id\x3d"+h+"\x26";var G=e+a.$.param(d);if(G.length>l.urlMaxLength){var G={},I;for(I in d)G[I]=d[I]+"";
d=1;for(e+="ref\x3d"+Math.floor(1E4*Math.random())+"\x26";;){I=e+"pn\x3d"+d;var O=l.getParameters(G,l.urlMaxLength-I.length);if(0<l.getParametersCount(G))I=l.sendAsScript(I+O,f,g,h,d),t.addScriptId(I.getScriptIds()[0]);else{I=l.sendAsScript(e+"pn\x3de"+d+O,f,g,h,d);t.addScriptId(I.getScriptIds()[0]);break}d++}return t}return l.sendAsScript(G,f,g,h)};a.util.HttpRequest.sendAsScript=function(e,d,f,g,h){if(!e)return null;var l=a.util.HttpRequest,t=document.createElement("script");t.id="OMV_XHR_"+l.scriptTagCount++;
t.src=e;t.type="text/javascript";t.charset="utf-8";l.requests.push({jsNode:t,callBack:d,reqId:g,format:f,parts:h});document.body.appendChild(t);e=new l.XHR;e.addScriptId(t.id);return e};a.util.HttpRequest.callBack=function(e,d,f){for(var g=a.util.HttpRequest.requests,h=null;0<g.length&&(h=g[0],!h.callBack&&!h.parts);){if(h.jsNode){try{document.body.removeChild(h.jsNode)}catch(l){}h.jsNode=null}g.shift()}for(var t=0;t<g.length;t++)if(h=g[t],h.reqId===e&&h.parts===f){e=!1;h=g[t];try{document.body.removeChild(h.jsNode)}catch(G){e=
!0}h.jsNode=null;0===t&&g.shift();!e&&a.notNull(d)&&h.callBack&&("json"===h.format?"string"===typeof d?h.callBack(a.$.parseJSON(d)):h.callBack(d):"xml"===h.format?h.callBack(a.util.XMLUtil.parse(d)):h.callBack(d));h.callBack=null;break}};a.util.HttpRequest.isLocalDomain=function(e){var d=a.util.HttpRequest;e=a.$.trim(e);return 0===e.toLowerCase().indexOf("http://")||0===e.toLowerCase().indexOf("https://")?d.getDomain(e)===d.localDomain:!0};a.util.HttpRequest.getDomain=function(a){if(!a)return null;
var d=a.indexOf("://");return 0<d?(d=a.indexOf("/",d+3),0<d?a.substring(0,d):a.substring(0)):null};a.util.HttpRequest.getParameters=function(a,d){var f="",g;for(g in a){var h="\x26"+g+"\x3d";if(f.length+h.length>=d)break;f+=h;d-=f.length;var h=a[g],l=encodeURIComponent(h),t=l.length;if(t<=d)f+=l,delete a[g];else for(t=Math.floor(1*h.length/t*d);0<=t;t--)if(l=h.substring(0,t),l=encodeURIComponent(l),l.length<=d)return a[g]=h.substring(t),f+l}return f};a.util.HttpRequest.getParametersCount=function(a){var d=
0,f;for(f in a)++d;return d};a.util.HttpRequest.XHR=function(a){this.scriptTags=[];this.error=this.jQXHR=null;a&&(this.jQXHR=a)};a.util.HttpRequest.XHR.prototype.addScriptId=function(a){this.scriptTags.push(a)};a.util.HttpRequest.XHR.prototype.getScriptIds=function(){return this.scriptTags};a.util.HttpRequest.XHR.prototype.abort=function(){if(this.jQXHR)this.jQXHR.abort();else for(var a=0;a<this.scriptTags.length;a++){var d=document.getElementById(this.scriptTags[a]);if(d&&d.parentNode)try{d.parentNode.removeChild(d)}catch(f){}}};
a.util.HttpRequest.XHR.prototype.setErrorHandler=function(a){this.jQXHR?this.jQXHR.fail(a):this.error=a;return this};a.util.CoverageGrid=function(a){this.yResolution=this.xResolution=null;this.grid={};this.gridDeviceSize=this.gridHeight=this.gridWidth=128;this.setBox(a)};a.util.CoverageGrid.prototype.setBox=function(e){this.minX=e.minX;this.minY=e.minY;this.maxX=e.maxX;this.maxY=e.maxY;a.notNull(e.gridSize)&&(this.gridDeviceSize=e.gridSize)};a.util.CoverageGrid.prototype.init=function(){this.clear()};
a.util.CoverageGrid.prototype.clear=function(){var a=this.grid,d;for(d in a)delete a[d]};a.util.CoverageGrid.prototype.conflicts=function(a){for(var d=Math.floor((a[1]-this.minY)/this.gridHeight),f=Math.floor((a[2]-this.minX)/this.gridWidth),g=Math.floor((a[3]-this.minY)/this.gridHeight),h=Math.floor((a[0]-this.minX)/this.gridWidth);h<=f;h++)for(var l=d;l<=g;l++)if(this.conflictsWithCell(h,l,a))return!0;return!1};a.util.CoverageGrid.prototype.insert=function(a){for(var d=Math.floor((a[1]-this.minY)/
this.gridHeight),f=Math.floor((a[2]-this.minX)/this.gridWidth),g=Math.floor((a[3]-this.minY)/this.gridHeight),h=Math.floor((a[0]-this.minX)/this.gridWidth);h<=f;h++)for(var l=d;l<=g;l++)this.insertToCell(h,l,a)};a.util.CoverageGrid.prototype.remove=function(a){for(var d=Math.floor((a[1]-this.minY)/this.gridHeight),f=Math.floor((a[2]-this.minX)/this.gridWidth),g=Math.floor((a[3]-this.minY)/this.gridHeight),h=Math.floor((a[0]-this.minX)/this.gridWidth);h<=f;h++)for(var l=d;l<=g;l++)this.removeFromCell(h,
l,a)};a.util.CoverageGrid.prototype.insertToCell=function(a,d,f){this.grid[a]||(this.grid[a]={});this.grid[a][d]||(this.grid[a][d]=[]);this.grid[a][d].push(f)};a.util.CoverageGrid.prototype.conflictsWithCell=function(a,d,f){if(!this.grid[a]||!this.grid[a][d])return!1;a=this.grid[a][d];for(d=0;d<a.length;d++){var g=a[d];if(!(g[2]<=f[0]||g[0]>=f[2]||g[3]<f[1]||g[1]>f[3]))return!0}return!1};a.util.CoverageGrid.prototype.removeFromCell=function(a,d,f){if(this.grid[a]&&this.grid[a][d]){d=this.grid[a][d];
for(var g=0;g<d.length;g++)if(d[g]===f){this.grid[a].splice(g,1);break}}};a.util.MiscUtil=a.util.MiscUtil||{arraysAreEqual:function(e,d){if(!(e===d||a.isNull(e)&&a.isNull(d)||a.isNull(e)&&0===d.length||0===e.length&&a.isNull(d))){if(null===e||null===d||e.length!==d.length)return!1;for(var f=0,g=e.length;f<g;f++)if(e[f]!=d[f])return!1}return!0},mixin:function(a){for(var d=Array.prototype.slice.call(arguments,1),f=d.length,g,h=0;h<f;h++)if(g=d[h])for(var l in g)g.hasOwnProperty(l)&&(a[l]=g[l]);return a},
mark:function(){var a=0;return function(d){d._omapsid_=d._omapsid_||++a;return d._omapsid_}}(),signURL:function(e,d){if(a.isNull(CryptoJS)||a.isNull(e)||a.isNull(d))return null;var f=e.replace("-","+"),f=f.replace("_","/"),f=CryptoJS.enc.Base64.parse(f),f=CryptoJS.HmacSHA1(d,f),f=CryptoJS.enc.Base64.stringify(f),f=f.replace("+","-");return f=f.replace("/","_")},generateUid:function(a){function d(){return(65536*(1+Math.random())|0).toString(16).substring(1)}a=a||"-";return d()+d()+a+d()+a+d()+a+d()+
a+d()+d()+d()},parseNumberAndUnit:function(e){var d={};if(a.isNull(e))return d;if(a.util.ValidationUtil.isNumber(e))return d.value=e,d;e=e.trim();for(var f="",g=null,h=0;h<e.length;h++){var l=e.charAt(h);if(a.util.ValidationUtil.isNumber(l)||"-"===l&&0===h)f+=l;else if("."===l)a.util.ValidationUtil.isNumber(e.charAt(h+1))&&(f+=l);else{g=e.substring(h,e.length).trim();break}}0<f.length&&(d.value=f);a.isNotNull(g)&&(d.unit=g);return d},substituteStr:function(e,d,f){var g=e.toUpperCase().indexOf(d.toUpperCase());
return 0>g?(a.util.Logger.warning("MAPVIEWER_9200","OM.util.MiscUtil.substituteStr","Did not find "+d+" in "+e),e):e.substring(0,g)+f+e.substring(g+d.length)},oddNumberClick:function(e,d){var f,g=0;if(a.isNull(d)||0>=d)d=a.event.MouseEvent.DEBOUNCE_MILI_SEC;return function(){var a=this,l=arguments,t=function(){f=null;e.apply(a,l);g=0};clearTimeout(f);g+=1;0!==g%2&&(f=setTimeout(t,d))}},debounce:function(e,d){var f;if(a.isNull(d)||0>=d)d=a.event.MouseEvent.DEBOUNCE_MILI_SEC;return function(){var a=
this,h=arguments;clearTimeout(f);f=setTimeout(function(){f=null;e.apply(a,h)},d)}},md5Hash:function(){function e(a,e){var f=e[0],g=e[1],h=e[2],X=e[3],S=e[4],ca=e[5],sa=e[6],Na=e[7],Va=e[8],b=e[9],c=e[10],ub=e[11],zb=e[12],rb=e[13],Ab=e[14],Eb=e[15],Da=a[0],Fa=a[1],Ga=a[2],va=a[3],Da=d(Fa&Ga|~Fa&va,Da,Fa,f,7,-680876936),va=d(Da&Fa|~Da&Ga,va,Da,g,12,-389564586),Ga=d(va&Da|~va&Fa,Ga,va,h,17,606105819),Fa=d(Ga&va|~Ga&Da,Fa,Ga,X,22,-1044525330),Da=d(Fa&Ga|~Fa&va,Da,Fa,S,7,-176418897),va=d(Da&Fa|~Da&Ga,
va,Da,ca,12,1200080426),Ga=d(va&Da|~va&Fa,Ga,va,sa,17,-1473231341),Fa=d(Ga&va|~Ga&Da,Fa,Ga,Na,22,-45705983),Da=d(Fa&Ga|~Fa&va,Da,Fa,Va,7,1770035416),va=d(Da&Fa|~Da&Ga,va,Da,b,12,-1958414417),Ga=d(va&Da|~va&Fa,Ga,va,c,17,-42063),Fa=d(Ga&va|~Ga&Da,Fa,Ga,ub,22,-1990404162),Da=d(Fa&Ga|~Fa&va,Da,Fa,zb,7,1804603682),va=d(Da&Fa|~Da&Ga,va,Da,rb,12,-40341101),Ga=d(va&Da|~va&Fa,Ga,va,Ab,17,-1502002290),Fa=d(Ga&va|~Ga&Da,Fa,Ga,Eb,22,1236535329),Da=d(Fa&va|Ga&~va,Da,Fa,g,5,-165796510),va=d(Da&Ga|Fa&~Ga,va,Da,
sa,9,-1069501632),Ga=d(va&Fa|Da&~Fa,Ga,va,ub,14,643717713),Fa=d(Ga&Da|va&~Da,Fa,Ga,f,20,-373897302),Da=d(Fa&va|Ga&~va,Da,Fa,ca,5,-701558691),va=d(Da&Ga|Fa&~Ga,va,Da,c,9,38016083),Ga=d(va&Fa|Da&~Fa,Ga,va,Eb,14,-660478335),Fa=d(Ga&Da|va&~Da,Fa,Ga,S,20,-405537848),Da=d(Fa&va|Ga&~va,Da,Fa,b,5,568446438),va=d(Da&Ga|Fa&~Ga,va,Da,Ab,9,-1019803690),Ga=d(va&Fa|Da&~Fa,Ga,va,X,14,-187363961),Fa=d(Ga&Da|va&~Da,Fa,Ga,Va,20,1163531501),Da=d(Fa&va|Ga&~va,Da,Fa,rb,5,-1444681467),va=d(Da&Ga|Fa&~Ga,va,Da,h,9,-51403784),
Ga=d(va&Fa|Da&~Fa,Ga,va,Na,14,1735328473),Fa=d(Ga&Da|va&~Da,Fa,Ga,zb,20,-1926607734),Da=d(Fa^Ga^va,Da,Fa,ca,4,-378558),va=d(Da^Fa^Ga,va,Da,Va,11,-2022574463),Ga=d(va^Da^Fa,Ga,va,ub,16,1839030562),Fa=d(Ga^va^Da,Fa,Ga,Ab,23,-35309556),Da=d(Fa^Ga^va,Da,Fa,g,4,-1530992060),va=d(Da^Fa^Ga,va,Da,S,11,1272893353),Ga=d(va^Da^Fa,Ga,va,Na,16,-155497632),Fa=d(Ga^va^Da,Fa,Ga,c,23,-1094730640),Da=d(Fa^Ga^va,Da,Fa,rb,4,681279174),va=d(Da^Fa^Ga,va,Da,f,11,-358537222),Ga=d(va^Da^Fa,Ga,va,X,16,-722521979),Fa=d(Ga^
va^Da,Fa,Ga,sa,23,76029189),Da=d(Fa^Ga^va,Da,Fa,b,4,-640364487),va=d(Da^Fa^Ga,va,Da,zb,11,-421815835),Ga=d(va^Da^Fa,Ga,va,Eb,16,530742520),Fa=d(Ga^va^Da,Fa,Ga,h,23,-995338651),Da=d(Ga^(Fa|~va),Da,Fa,f,6,-198630844),va=d(Fa^(Da|~Ga),va,Da,Na,10,1126891415),Ga=d(Da^(va|~Fa),Ga,va,Ab,15,-1416354905),Fa=d(va^(Ga|~Da),Fa,Ga,ca,21,-57434055),Da=d(Ga^(Fa|~va),Da,Fa,zb,6,1700485571),va=d(Fa^(Da|~Ga),va,Da,X,10,-1894986606),Ga=d(Da^(va|~Fa),Ga,va,c,15,-1051523),Fa=d(va^(Ga|~Da),Fa,Ga,g,21,-2054922799),Da=
d(Ga^(Fa|~va),Da,Fa,Va,6,1873313359),va=d(Fa^(Da|~Ga),va,Da,Eb,10,-30611744),Ga=d(Da^(va|~Fa),Ga,va,sa,15,-1560198380),Fa=d(va^(Ga|~Da),Fa,Ga,rb,21,1309151649),Da=d(Ga^(Fa|~va),Da,Fa,S,6,-145523070),va=d(Fa^(Da|~Ga),va,Da,ub,10,-1120210379),Ga=d(Da^(va|~Fa),Ga,va,h,15,718787259),Fa=d(va^(Ga|~Da),Fa,Ga,b,21,-343485551);a[0]=~~(Da+a[0]);a[1]=~~(Fa+a[1]);a[2]=~~(Ga+a[2]);a[3]=~~(va+a[3])}function d(a,d,e,f,g,h){d=~~(~~(d+a)+~~(f+h));return~~((d<<g|d>>>32-g)+e)}function f(a){return h[a>>4&15]+h[a>>0&
15]+h[a>>12&15]+h[a>>8&15]+h[a>>20&15]+h[a>>16&15]+h[a>>28&15]+h[a>>24&15]}var g=[0,8,16,24],h="0123456789abcdef".split("");return function(d){if(a.isNull(d))return"";for(var h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],G=d.length,I=[1732584193,-271733879,-1732584194,271733878],O=64;O<=G;O+=64){var X=h,S=d,ca=O-64;X[0]=S.charCodeAt(ca)+(S.charCodeAt(1+ca)<<8)+(S.charCodeAt(2+ca)<<16)+(S.charCodeAt(3+ca)<<24);X[1]=S.charCodeAt(4+ca)+(S.charCodeAt(5+ca)<<8)+(S.charCodeAt(6+ca)<<16)+(S.charCodeAt(7+ca)<<24);
X[2]=S.charCodeAt(8+ca)+(S.charCodeAt(9+ca)<<8)+(S.charCodeAt(10+ca)<<16)+(S.charCodeAt(11+ca)<<24);X[3]=S.charCodeAt(12+ca)+(S.charCodeAt(13+ca)<<8)+(S.charCodeAt(14+ca)<<16)+(S.charCodeAt(15+ca)<<24);X[4]=S.charCodeAt(16+ca)+(S.charCodeAt(17+ca)<<8)+(S.charCodeAt(18+ca)<<16)+(S.charCodeAt(19+ca)<<24);X[5]=S.charCodeAt(20+ca)+(S.charCodeAt(21+ca)<<8)+(S.charCodeAt(22+ca)<<16)+(S.charCodeAt(23+ca)<<24);X[6]=S.charCodeAt(24+ca)+(S.charCodeAt(25+ca)<<8)+(S.charCodeAt(26+ca)<<16)+(S.charCodeAt(27+ca)<<
24);X[7]=S.charCodeAt(28+ca)+(S.charCodeAt(29+ca)<<8)+(S.charCodeAt(30+ca)<<16)+(S.charCodeAt(31+ca)<<24);X[8]=S.charCodeAt(32+ca)+(S.charCodeAt(33+ca)<<8)+(S.charCodeAt(34+ca)<<16)+(S.charCodeAt(35+ca)<<24);X[9]=S.charCodeAt(36+ca)+(S.charCodeAt(37+ca)<<8)+(S.charCodeAt(38+ca)<<16)+(S.charCodeAt(39+ca)<<24);X[10]=S.charCodeAt(40+ca)+(S.charCodeAt(41+ca)<<8)+(S.charCodeAt(42+ca)<<16)+(S.charCodeAt(43+ca)<<24);X[11]=S.charCodeAt(44+ca)+(S.charCodeAt(45+ca)<<8)+(S.charCodeAt(46+ca)<<16)+(S.charCodeAt(47+
ca)<<24);X[12]=S.charCodeAt(48+ca)+(S.charCodeAt(49+ca)<<8)+(S.charCodeAt(50+ca)<<16)+(S.charCodeAt(51+ca)<<24);X[13]=S.charCodeAt(52+ca)+(S.charCodeAt(53+ca)<<8)+(S.charCodeAt(54+ca)<<16)+(S.charCodeAt(55+ca)<<24);X[14]=S.charCodeAt(56+ca)+(S.charCodeAt(57+ca)<<8)+(S.charCodeAt(58+ca)<<16)+(S.charCodeAt(59+ca)<<24);X[15]=S.charCodeAt(60+ca)+(S.charCodeAt(61+ca)<<8)+(S.charCodeAt(62+ca)<<16)+(S.charCodeAt(63+ca)<<24);e(I,h)}h=d.substring(O-64);O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];X=h.length&-4;for(d=
0;d<X;d+=4)O[d>>2]=h.charCodeAt(d)|h.charCodeAt(d+1)<<8|h.charCodeAt(d+2)<<16|h.charCodeAt(d+3)<<24;X=h.length;for(S=d>>2;d<X;++d)O[S]|=h.charCodeAt(d)<<g[d&3];O[S]|=128<<g[d&3];55<d&&(e(I,O),O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);O[14]=8*G;e(I,O);return f(I[0])+f(I[1])+f(I[2])+f(I[3])}}(),transparentImgURL:"data:image/gif;base64,R0lGODlhBQAFAIAAAP///wAAACH5BAEAAAAALAAAAAAFAAUAAAIEhI+pWAA7"};a.util.LoadFileUtil={};a.util.LoadFileUtil.CssLoaded=!1;a.util.LoadFileUtil.JsLoaded=!1;a.util.LoadFileUtil.JsLoadedTwice=
!1;a.util.LoadFileUtil.LoadCss=function(e){var d=document.getElementsByTagName("head")[0],f=document.createElement("link");f.setAttribute("rel","stylesheet");f.setAttribute("href",e);d.appendChild(f);f.onload=f.onreadystatechange=function(){a.util.LoadFileUtil.CssLoaded=!0;f.onload=f.onreadystatechange=null}};a.util.LoadFileUtil.LoadJs=function(e,d){var f=document.getElementsByTagName("head")[0],g=document.createElement("script");g.setAttribute("type","text/javascript");g.setAttribute("src",e);f.appendChild(g);
g.onload=g.onreadystatechange=function(){a.isNull(d)?a.util.LoadFileUtil.JsLoaded=!0:a.util.LoadFileUtil.JsLoadedTwice=!0;g.onload=g.onreadystatechange=null}};a.util.TimerManager=function(a){var d=function(){var a=this;a.schedule=function(d,e){a.cancel();a.time=e;a.callback=d;a.timeout=setTimeout(a.doCallback,e)};a.reset=function(){a.timeout&&a.schedule(a.callback,a.time)};a.cancel=function(){a.timeout&&(clearTimeout(a.timeout),a.timeout=b)};a.doCallback=function(){try{a.callback()}catch(d){}};return{reset:a.reset,
schedule:a.schedule,cancel:a.cancel}},f=this;f.defaultTime=a?a:2E3;f.timers=[];f.getTimer=function(a){a||(a="NO_NAME");f.timers[a]||(f.timers[a]=new d);return f.timers[a]};f.schedule=function(a,d,e){0===d||d||(d=f.defaultTime);f.getTimer(a).schedule(e,d)};f.reset=function(a){f.getTimer(a).reset()};f.cancel=function(a){f.getTimer(a).cancel()};return{schedule:f.schedule,reset:f.reset,cancel:f.cancel}};a.util.WorldMercatorUtil=a.util.WorldMercatorUtil||function(){var e=12756274*Math.PI/256,d=[e,e/2,
e/4,e/8,e/16,e/32,e/64,e/128,e/256,e/512,e/1024,e/2048,e/4096,e/8192,e/16384,e/32768,e/65536,e/131072,e/262144,e/524288,e/1048576,e/2097152,e/4194304,e/8388608],f=12756274*Math.PI/2;return new function(){this.pixelsToMeters=function(a,e,l){a=d[a];return[e*a-f,l*a-f]};this.metersToLonLat=function(a,d){var e=a/f*180,t=d/f*180,t=180/Math.PI*(2*Math.atan(Math.exp(t*Math.PI/180))-Math.PI/2);return[e,t]};this.lonLatToMeters=function(a,d){var e=a*f/180,t=Math.log(Math.tan((90+d)*Math.PI/360))/(Math.PI/180),
t=t*f/180;return[e,t]};this.metersToPixels=function(a,e,l){a=d[a];e=Math.round((e+f)/a);l=Math.round((l+f)/a);return[e,l]};this.getTileCoverage=function(d,e,f){f=(1<<d)-1-f;var t=this.pixelsToMeters(d,256*e,256*f);d=this.pixelsToMeters(d,256*(e+1),256*(f+1));return new a.geometry.Rectangle(t[0],t[1],d[0],d[1],3857)};this.getTileCoverageLL=function(d,e,f){e=this.getTileCoverage(d,e,f);d=this.metersToLonLat(e.getMinX(),e.getMinY());e=this.metersToLonLat(e.getMaxX(),e.getMaxY());return new a.geometry.Rectangle(d[0],
d[1],e[0],e[1],8307)}}}();a.util.Publisher=a.util.Publisher||{subscribers:{any:[]},subscribe:function(a,d){d=d||"any";"undefined"===typeof this.subscribers[d]&&(this.subscribers[d]=[]);this.subscribers[d].push(a)},unsubscribe:function(a,d){this.visitSubscribers("unsubscribe",a,d)},publish:function(a,d){this.visitSubscribers("publish",{publisher:this,publication:a},d)},visitSubscribers:function(e,d,f){var g=f||"any";f=this.subscribers[g]||[];var h=f.length;0===h&&a.util.Logger.info(0,"OM.util.Publisher",
'No methods subscribed to "'+g+'"');for(g=0;g<h;g++)if("publish"===e)f[g](d);else f[g]===d&&f.splice(g,1)}};a.util.Task=a.Class.extend({mixin:a.util.Publisher,initialize:function(e,d){this.subscribers={any:[]};this.taskType=a.util.Task.types.ANY;for(var f in a.util.Task.types)if(f===d){this.taskType=d;break}this.status=a.util.Task.actions.IDLE;e instanceof a.util.Progress&&this.subscribe(e.updateTask.bind(e))},start:function(){this.updateTask(a.util.Task.actions.START)},update:function(e){isNaN(e)?
a.util.Logger.warn(0,"OM.util.Task.update","Non numeric update!"):0<e&&1>e?this.updateTask(100*e):a.util.Logger.warn(0,"OM.util.Task.update","Update out of range")},updateTask:function(e){100===this.status||this.status===a.util.Task.actions.ERROR||this.status===a.util.Task.actions.FINISH?a.util.Logger.info(0,"OM.util.Task","WARNING: NOT UPDATING AS TASK IS DONE"):(this.status=e,this.publish(e))},complete:function(){this.updateTask(a.util.Task.actions.FINISH)},abort:function(){this.updateTask(a.util.Task.actions.ERROR)}});
a.util.Task.actions={START:"START",IDLE:"IDLE",PENDING:"PENDING",FINISH:"FINISH",ERROR:"ERROR"};a.util.Task.types={ANY:"ANY",DETERMINISTIC:"DETERMINISTIC",INDETERMINISTIC:"INDETERMINISTIC"};a.util.Progress=a.Class.extend({mixin:a.util.Publisher,initialize:function(){this.subscribers={any:[]};this.taskFamilies={any:[]};this.taskFamiliesStatus={any:{advance:0,total:0,pending:0,finished:0,error:0}};this.progress=0;this.mode=a.util.Progress.modes.DETERMINISTIC;if(a.isNull(this.map)||a.isNull(this.container)||
a.isNull(this.progDiv)||a.isNull(this.progSpan))return null},addTask:function(a){var d=a.publication;a=a.publisher;"undefined"===typeof this.taskFamilies.any&&(this.taskFamilies.any=[],this.taskFamiliesStatus.any={});this.taskFamilies.any.push(a);a.status=d},updateTask:function(e){var d=e.publication,f=e.publisher,g=this.mode;d!==a.util.Task.actions.FINISH&&d!==a.util.Task.actions.ERROR&&100!==d&&"100%"!==d||this.isTaskRegistered(f)?(this.isTaskRegistered(f)?f.status=d:this.addTask(e),this.progress=
this.updateProgress(),"100%"!==f.status&&100!==f.status&&f.status!==a.util.Task.actions.FINISH&&f.status!==a.util.Task.actions.ERROR||this.removeCompletedTasks(f),"function"===typeof this.publish&&(this.publish(this.progress,"progress"),g!==this.mode&&this.publish(this.mode,"mode"))):a.util.Logger.warning(0,"OM.util.Progress.update","Cannot finish a task not previously started")},isTaskRegistered:function(a){var d=this.taskFamilies.any;return"undefined"===typeof d||0>d.indexOf(a)?!1:!0},removeCompletedTasks:function(e){if(this.isTaskRegistered(e)){e=
this.taskFamilies.any;for(var d=e.length,f=0;f<d;f++)if(e[f].status!==a.util.Task.actions.FINISH&&e[f].status!==a.util.Task.actions.ERROR&&"100"!==e[f].status&&"100%"!==e[f].status)return;this.taskFamilies.any.length=0;this.taskFamiliesStatus.any.advance=0}},updateProgress:function(){var e=[],d=0,f=0;this.mode=a.util.Progress.modes.DETERMINISTIC;for(var g in this.taskFamilies){var h=this.taskFamilies[g],l=this.taskFamiliesStatus[g],t=h.length;if(0!==t){for(var G=a.util.Task.actions,I=0,O=0,X=0,S=
0,ca=0;ca<t;ca++){var sa=0;h[ca].status===G.FINISH||h[ca].status===G.ERROR?(sa=100,h[ca].status===G.FINISH?O++:S++):isNaN(parseInt(h[ca].status))?(h[ca].taskType===a.util.Task.types.INDETERMINISTIC&&(this.mode=a.util.Progress.modes.INDETERMINISTIC),sa=0,X++):(sa=parseInt(h[ca].status),100>sa?(h[ca].taskType===a.util.Task.types.INDETERMINISTIC&&(this.mode=a.util.Progress.modes.INDETERMINISTIC),X++):O++);I+=sa;f++}0<I&&(I/=t);h=l.advance;if("undefined"===typeof h||I>=h)l.advance=I;l.total=t;l.pending=
X;l.finish=O;l.error=S;e.push(l.advance)}}for(f=0;f<e.length;f++)d+=e[f];0<d&&(d/=e.length);return d},getStatistics:function(){return this.taskFamiliesStatus},getCurrentTasks:function(){return this.taskFamilies}});a.util.Progress.modes={DETERMINISTIC:"DETERMINISTIC",INDETERMINISTIC:"INDETERMINISTIC"};a.util.ProgressBar=a.Class.extend({initialize:function(e,d){a.isNull(e)||a.isNull(e.$oracleMapDiv)?a.util.Logger.warning(0,"OM.util.ProgressBar","Map instance or container is null!"):(this.options=d||
{enable:!0,mode:a.util.Progress.modes.DETERMINISTIC},this.container=e.$oracleMapDiv,this.progressBarDiv=a.$("\x3cdiv class\x3d'omv2_progDiv' id \x3d'progressBarDiv"+e.mapInstanceId+"'\x3e\x3c/div\x3e"),this.indetProgressBarSpan=a.$("\x3cspan class\x3d'omv2_progSpanInd' style\x3d'width:100%'\x3e\x3c/span\x3e"),this.deterProgressBarSpan=a.$("\x3cspan class\x3d'omv2_progSpan' style\x3d'width:0%'\x3e\x3c/span\x3e"),this.progressBarSpan=this.options.mode===a.util.Progress.modes.DETERMINISTIC?this.deterProgressBarSpan:
this.indetProgressBarSpan,this.progressBarDiv.append(this.progressBarSpan),this.container.append(this.progressBarDiv),this.prevStatus=0)},updateUi:function(e){e=e.publication;if(isNaN(e))a.util.Logger.warning(0,"OM.util.ProgressBar.UpdateUi","Wrong update type: ");else if(!0===this.options.enable){this.progressBarDiv.css("visibility","visible");this.progressBarSpan.css("width",this.prevStatus+"%");this.options.mode===a.util.Progress.modes.DETERMINISTIC?this.progressBarSpan.css("width",e+"%"):this.progressBarSpan.css("width",
"100%");this.prevStatus=e;var d=this.progressBarDiv;100<=e&&(e=this.prevStatus=0,this.options.mode===a.util.Progress.modes.DETERMINISTIC&&(e=500),setTimeout(function(){d.css("visibility","hidden")},e))}},switchMode:function(e){e=e.publication;var d;e!==a.util.Progress.modes.DETERMINISTIC&&e!==a.util.Progress.modes.INDETERMINISTIC?a.util.Logger.warning(0,"OM.util.ProgressBar.SwitchMode","Wrong mode: "+e):(d=this.progressBarSpan===this.deterProgressBarSpan?a.util.Progress.modes.DETERMINISTIC:a.util.Progress.modes.INDETERMINISTIC,
e!==d&&(this.progressBarSpan.remove(),this.progressBarSpan=e===a.util.Progress.modes.DETERMINISTIC?this.deterProgressBarSpan:this.indetProgressBarSpan,this.progressBarDiv.append(this.progressBarSpan),this.options.mode=e))}});a.util.ProgressBar.modes={DETERMINATE:"DETERMINATE",INDETERMINATE:"INDETERMINTATE"};a.util.ProgressBar.INDETERMINATE_START="START_INDETERMINATE";a.util.ProgressBar.INDETERMINATE_FINISH="FINISH_INDETERMINATE";a.geometry.Geometry=a.Class.extend({initialize:function(e){this.srid=
this.type=null;if(a.isNull(e))this.srid=8307;else if(a.util.ValidationUtil.isNumber(e))this.srid="number"===typeof e?e:parseInt(e);else return a.util.Logger.throwErr("MAPVIEWER_9018","geom.Geometry","srid:"+e),null;this.mbr=this.geometries=this.coordinates=null;this.dim=2},getMBR:function(){var e=a.geometry;if(!this.mbr){var d=e.Geometry.calculateMBR(this.coordinates,this.type,this.dim);this.mbr=new e.Rectangle(d.minX,d.minY,d.maxX,d.maxY,this.srid)}return this.mbr},getMIR:function(){var e=[];if("GeometryCollection"===
this.type){var d=this.geometries;if(a.isNull(d)||0===d.length)return null;for(var f=-1,g=null,h=null,l=0;l<d.length;l++)g=d[l].getMIR(),a.notNull(g)&&(e=[g.getMinX(),g.getMinY(),g.getMaxX(),g.getMaxY()],e=this.getRectangleArea(e),e>f&&(h=g,f=e));return h}d=this.dim?this.dim:2;f=this.coordinates;g=this.getMBR();e[0]=g.getMinX();e[1]=g.getMinY();e[2]=g.getMaxX();e[3]=g.getMaxY();if("Polygon"===this.type)e=this.getLabelBox(f,d);else if("MultiPolygon"===this.type)for(g=-1,h=null,l=0;l<f.length;l++)h=
this.getLabelBox(f[l],d),this.getRectangleArea(h)>g&&(e=h,g=this.getRectangleArea(e));return a.isNull(e)?null:new a.geometry.Rectangle(e[0],e[1],e[2],e[3],this.srid)},getDimension:function(){return this.dim},_getMeasure:function(e){var d=this.coordinates,f=this.geometries,g=null,h=0;if(a.isNull(d)){if(a.isNull(f))return 0;for(d=0;d<f.length;d++)h+=f[d]._getMeasure(e);return h}"area"===e?g=a.util.GeomUtil.polygonArea:"length"===e&&(g=a.util.GeomUtil.polylineLength);if(a.$.isArray(d[0])){for(e=0;e<
d.length;e++)h+=g(d[e],this.dim);return h}return g(d,this.dim)},getLength:function(){return this._getMeasure("length")},getArea:function(){return this._getMeasure("area")},getLabelBox:function(e,d){for(var f=e[0],g=a.geometry.Geometry.calculateMBR(e,"Polygon",d),g=new a.geometry.Rectangle(g.minX,g.minY,g.maxX,g.maxY,this.srid),h=(g.getMaxY()-g.getMinY())/100,l=[],t=0;100>t;t++)l[t]=this.findIntersections(f,d,g,100,t);var t=Math.floor(50),G=this.findLongestSegment(l[t]),f=null,I,O,X;-1!=G&&(I=t,O=
l[t][G],G=l[t][G+1],X=g.getMinY()+(t+1)*h,f=this.getOptimalBox(l,g,100,O,G,X,I));for(t=0;100>t;t++)G=this.findLongestSegment(l[t]),-1!=G&&(I=t,O=l[t][G],G=l[t][G+1],X=g.getMinY()+(t+1)*h,I=this.getOptimalBox(l,g,100,O,G,X,I),this.getRectangleArea(I)>1*this.getRectangleArea(f)&&(f=I));return f},getOptimalBox:function(e,d,f,g,h,l,t){g=[g,l,h,l];l=h=!0;var G=(d.getMaxY()-d.getMinY())/f,I=t+1;for(--t;h||l;I++,t--){I>=f&&(h=!1);0>t&&(l=!1);var O=null,X=null,S;h&&(S=d.getMinY()+(I+1)*G,O=this.expandBox(g,
e[I],S));l&&(S=d.getMinY()+(t+1)*G,X=this.expandBox(g,e[t],S));S=O;this.getRectangleArea(O)<this.getRectangleArea(X)?(S=X,h&&I--):l&&t++;if(a.isNull(S)||this.getRectangleArea(S)<this.getRectangleArea(g))break;else g=S}return g},expandBox:function(e,d,f){var g=e[0],h=e[2],l=g,t=h,G=0;if(a.isNull(d)||2>d.length)return null;for(var I=1;I<d.length;I+=2){var O=d[I-1],X=d[I];if(O>=h)break;if(!(X<=g)&&(O=Math.max(O,g),X=Math.min(X,h),X>O)){var S=X-O;S>G&&(G=S,l=O,t=X)}}if(0>=G)return null;d=[];d[0]=l;d[1]=
Math.min(e[1],f);d[2]=t;d[3]=Math.max(e[3],f);return d},findLongestSegment:function(e){var d=-1,f=0;if(a.isNull(e)||2>e.length)return-1;for(var g=1;g<e.length;g+=2){var h=e[g]-e[g-1];h>d&&(d=h,f=g-1)}return f},findIntersections:function(a,d,f,g,h){g=(f.getMaxY()-f.getMinY())/g;f=f.getMinY()+(h+1)*g;h=[];for(g=d;g<a.length;g+=d){var l=a[g-d],t=a[g-d+1],G=a[g],I=a[g+1],O,X;t>I&&(O=t,X=l,t=I,l=G,I=O,G=X);f<t||f>I||(t!=I?h.push((G-l)*(f-t)/(I-t)+l):(h.push(l),h.push(G)))}h.sort(function(a,d){return a-
d});return h},getRectangleArea:function(e){return a.isNull(e)?0:(e[2]-e[0])*(e[3]-e[1])},transform:function(e,d,f,g,h){if(a.notNull(h)&&e===a.util.BaiduUtil.SRID)return a.notNull(h.map)?8307!==this.srid&&4326!==this.srid?a.util.Logger.warning("","OM.geometry.Geometry.transform","Only SRID 8307 to Baidu SRS transformation is supported."):a.util.BaiduUtil.transformGeom({geom:this,toSrid:a.util.BaiduUtil.SRID,callBack:d,map:h.map,inputIsBD09LonLat:h.inputIsBD09LonLat}):a.util.Logger.warning("","OM.geometry.Geometry.transform",
"The Map instance is null."),null;var l=a.geometry;if(a.isNull(this.srid)||a.isNull(e))return a.util.Logger.warning("MAPVIEWER_9019","geom.Geometry.transform",""),null;if(this.srid===e){if(d){d(this);return}return this}if(h=a.util.CSTransformUtil.getCSTransformFunction(this.srid,e)){f=null;try{if(this instanceof l.GeometryCollection)f=this.clientTransform(e);else{var t=a.util.CSTransformUtil.transformOrdinates(h,this.coordinates,this.dim);f=l.Geometry.createGeometry({type:this.type,dim:this.dim,coordinates:t},
e);f.dim=this.dim}if(d){d(f);return}return f}catch(G){return a.util.Logger.warning(null,"geom.Geometry.transform","Cannot transform geometry coordinates to SRID "+e+": "+this.toString()+", due to "+G.message),null}}t=a.gv.localbaseURL();if(!f&&t)f=t+"/mcserver";else if(!f){a.util.Logger.warning("MAPVIEWER_9020","geom.Geometry.transform","");return}a.util.HttpRequest.send(f,{request:"cstransform",gformat:"geojson",dstsrid:e,datasource:g,geometry:this.toString()},function(f){f?(f=l.Geometry.createGeometry(f,
e),d(f)):a.util.Logger.warning("MAPVIEWER_9018","geom.Geometry.transform","")},"json",function(d){d?a.util.Logger.warning("MAPVIEWER_9018","geom.Geometry.transform",d.responseText):a.util.Logger.warning("MAPVIEWER_9018","geom.Geometry.transform","")})},clone:function(e){var d=a.geometry,f=this.coordinates;if(e&&f)var g=function(a){for(var d=[],e=0;e<a.length;e++)d[e]=a[e]instanceof Array?g(a[e]):a[e];return d},f=g(this.coordinates);if(this instanceof d.Circle)return new d.Circle(this.getCenterX(),
this.getCenterY(),this.getRadius(),this.srid);switch(this.type){case "Point":return e=new d.Point(this.getX(),this.getY(),this.srid),2<this.dim&&(e.coordinates=f,e.dim=this.dim),e;case "OrientedPoint":return e=new d.Point(this.getX(),this.getY(),this.srid,this.getOrientationX(),this.getOrientationY()),2<this.dim&&(e.coordinates=f,e.dim=this.dim),e;case "MultiPoint":case "OrientedMultiPoint":return new d.MultiPoint(f,this.srid,this.dim);case "LineString":return new d.LineString(f,this.srid,this.dim);
case "MultiLineString":return new d.MultiLineString(f,this.srid,this.dim);case "Polygon":return new d.Polygon(f,this.srid,this.dim);case "MultiPolygon":return new d.MultiPolygon(f,this.srid,this.dim);case "Rectangle":return new d.Rectangle(this.getMinX(),this.getMinY(),this.getMaxX(),this.getMaxY(),this.srid);case "GeometryCollection":for(var f=[],h=0,l=this.geometries;h<l;h++)f.push(this.geometries[h].clone(e));return new d.GeometryCollection(f,this.srid);default:return new d.Geometry(f,this.srid,
this.dim)}},toString:function(){var e;e="{"+('"type":"'+this.type+'",');e=a.isNull(this.srid)?e+'"srid":8307,':e+('"srid":'+this.srid+",");e+='"coordinates":';var d=a.GeomTypes;if(this.type===d.MULTIPOINT||this.type===d.MULTILINESTRING||this.type===d.MULTIPOLYGON||this.type===d.POLYGON||this.type===d.ORIENTEDMULTIPOINT){e+="[";for(var f=this.coordinates.length,g=0;g<f;g++){e+="[";if(this.type===d.MULTIPOLYGON){for(var h=this.coordinates[g].length,l=0;l<h;l++)e+="["+this.coordinates[g][l]+"],";h=e.length;
e=e.substring(0,h-1)}else e+=this.coordinates[g];e+="],"}f=e.length;e=e.substring(0,f-1);e+="]"}else e+="["+this.coordinates+"]";return e+"}"},densify:function(){var e=a.GeomTypes;if(this.type===e.POINT||this.type===e.MULTIPOINT||this.type===e.ORIENTEDPOINT||this.type===e.ORIENTEDMULTIPOINT)return this;var d={type:"GEODETIC",distConvFactor:1};if(8307!==this.srid&&8265!==this.srid&&4326!==this.srid&&4269!==this.srid&&(!d||"GEODETIC"!==d.type&&"PROJECTED"!==d.type))return this;var f=1;d&&"PROJECTED"===
d.type&&(f=1E5*d.distConvFactor);var g=d=null;if(this.type===e.LINESTRING)d=a.util.GeomUtil.densifyOrdinates(this.coordinates,f),g=this.type;else if(this.type===e.RECTANGLE)e=[this.getMinX(),this.getMinY(),this.getMinX(),this.getMaxY(),this.getMaxX(),this.getMaxY(),this.getMaxX(),this.getMinY(),this.getMinX(),this.getMinY()],d=a.util.GeomUtil.densifyOrdinates(e,f),g="Polygon";else{if(this.type===e.GEOMETRYCOLLECTION){f=this.geometries.length;e=Array(f);for(d=0;d<f;d++)e[d]=this.geometries[d].densify();
return new a.geometry.GeometryCollection(e,this.srid)}for(var g=this.coordinates.length,d=Array(g),h=0;h<g;h++)if(this.type===e.MULTIPOLYGON){var l=this.coordinates[h].length;d[h]=Array(l);for(var t=0;t<l;t++)d[h][t]=a.util.GeomUtil.densifyOrdinates(this.coordinates[h][t],f)}else d[h]=a.util.GeomUtil.densifyOrdinates(this.coordinates[h],f);g=this.type}return new a.geometry.Geometry.createGeometry({type:g,coordinates:d},this.srid)},move:function(e,d,f){a.util.GeomUtil.moveCoordinates(this.coordinates,
e,d,"OrientedPoint"===this.type||"OrientedMultiPoint"===this.type?!0:!1,this.dim,f);this.mbr&&this.mbr.move(e,d)},getSRID:function(){return this.srid},getOrdinates:function(){return this.coordinates},getType:function(){return this.type},toJSON:function(){return this.type===a.GeomTypes.GEOMETRYCOLLECTION?{type:this.type,srid:this.srid,geometries:this.geometries}:{type:this.type,srid:this.srid,coordinates:this.coordinates}}});a.geometry.Geometry.createGeometry=function(e,d){var f,g,h=a.geometry;f=a.GeomTypes;
var l=e.type,t=2;e.dim&&(t=e.dim);var G=e.coordinates;g=null;var I=h.Geometry;if(l===f.POINT){if(f=G[0],g=G[1],g=new h.Point(f,g,d),2<t)for(f=2;f<t;f++)g.addDimension(G[f])}else if(l===f.ORIENTEDPOINT){if(f=G[0],g=G[1],g=new h.Point(f,g,d,G[t],G[t+1]),2<t)for(f=2;f<t;f++)g.addDimension(G[f],G[t+f])}else if(l===f.LINESTRING)g=new h.LineString(G,d,t);else if(l===f.RECTANGLE)g=new h.Rectangle(G[0],G[1],G[2],G[3],d);else if(l===f.POLYGON)g=new h.Polygon(G,d,t);else if(l===f.MULTIPOINT||l===f.ORIENTEDMULTIPOINT)g=
new h.MultiPoint(G,d,t);else if(l===f.MULTILINESTRING)g=new h.MultiLineString(G,d,t);else if(l===f.MULTIPOLYGON)g=new h.MultiPolygon(G,d,t);else if(l===f.CIRCLE)g=new h.Circle(G[0],G[1],G[2],d);else if(l===f.GEOMETRYCOLLECTION){t=e.geometries;G=t.length;g=I.createGeometry;for(f=0;f<G;f++)t[f]=g(t[f],d);g=new h.GeometryCollection(t,d)}!e.mbr||e.mbr instanceof I||(g.mbr=new h.Rectangle(e.mbr.minX,e.mbr.minY,e.mbr.maxX,e.mbr.maxY,d));return g};a.geometry.Geometry.calculateMBR=function(e,d,f){var g={minX:Number.POSITIVE_INFINITY,
minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY},h=a.geometry.Geometry.getCoordsMBR,l=e.length;f=f?f:2;if("Polygon"===d)g=h(e[0],f,g);else if("MultiPolygon"===d)for(d=0;d<l;d++)g=h(e[d][0],f,g);else if("LineString"===d)g=h(e,f,g);else if("MultiLineString"===d)for(d=0;d<l;d++)g=h(e[d],f,g);else if("Rectangle"===d)g={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};else if("Point"===d||"OrientedPoint"===d)g={minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]};else if("MultiPoint"===
d)for(d=0;d<l;d++)g=h(e[d],f,g);else if("OrientedMultiPoint"===d)for(d=0;d<l;d++)g=h([e[d][0],e[d][1]],f,g);return g};a.geometry.Geometry.getCoordsMBR=function(a,d,f){a[0]<f.minX&&(f.minX=a[0]);a[0]>f.maxX&&(f.maxX=a[0]);a[1]<f.minY&&(f.minY=a[1]);a[1]>f.maxY&&(f.maxY=a[1]);for(var g=d,h=a.length;g<h;g+=d)a[g]<f.minX?f.minX=a[g]:a[g]>f.maxX&&(f.maxX=a[g]),a[g+1]<f.minY?f.minY=a[g+1]:a[g+1]>f.maxY&&(f.maxY=a[g+1]);return f};a.geometry.Geometry.calculateGeomCollectionMBR=function(e,d){if(!e||0===e.length||
d!==a.GeomTypes.GEOMETRYCOLLECTION)return null;var f,g=null;f=null;for(var h=0;h<e.length;h++)if(f=e[h].coordinates)f=a.geometry.Geometry.calculateMBR(f,e[h].type),g?(g.minX>f.minX&&(g.minX=f.minX),g.minY>f.minY&&(g.minY=f.minY),g.maxX<f.maxX&&(g.maxX=f.maxX),g.maxY<f.maxY&&(g.maxY=f.maxY)):(g={},g.minX=f.minX,g.minY=f.minY,g.maxX=f.maxX,g.maxY=f.maxY);return g};a.geometry.Geometry.findSubstring=function(a,d){var f=d.wkti,g=d.wktStr.substring(f).match(a);return g?(f+=g[0].length,d.wkti=f,d.wktMatch=
g[0],d):null};a.geometry.Geometry.wktGetCoords=function(e){for(var d=[],f,g=a.geometry.Geometry.findSubstring;g(/^[-+]?([0-9]*\.[0-9]+([eE][-+]?[0-9]+)?|[0-9]+([eE][-+]?[0-9]+)?)/,e)||g(/^(\,)/,e);)f=e.wktMatch,","!=f&&d.push(parseFloat(f)),g(/^\s*/,e);e.wktCoords=d;return d.length?e:null};a.geometry.Geometry.wktGetMulticoords=function(e){var d=a.geometry.Geometry.findSubstring;d(/^\s*/,e);for(var f=0,g=[],h=[],l=g,t;d(/^(\()/,e)||d(/^(\))/,e)||d(/^(\,)/,e)||d(/^[-+]?([0-9]*\.[0-9]+([eE][-+]?[0-9]+)?|[0-9]+([eE][-+]?[0-9]+)?)/,
e);){t=e.wktMatch;if("("==t)h.push(l),l=[],h[h.length-1].push(l),f++;else if(")"==t){l=h.pop();if(!l)return null;f--;if(0===f)break}else if(","!==t){if(isNaN(parseFloat(t)))return null;l.push(parseFloat(t))}d(/^\s*/,e)}if(0!==f)return null;e.wktCoords=g[0];return e};a.geometry.Geometry.wktGetMulticoordsPoint=function(e){var d=a.geometry.Geometry.findSubstring;d(/^\s*/,e);for(var f=0,g=[],h=[g],l=g,t;d(/^(\()/,e)||d(/^(\))/,e)||d(/^(\,)/,e)||d(/^[-+]?([0-9]*\.[0-9]+([eE][-+]?[0-9]+)?|[0-9]+([eE][-+]?[0-9]+)?)/,
e);){t=e.wktMatch;if("("==t)h.push(l),l=[],h[h.length-1].push(l),f++;else if(")"==t){l=h.pop();if(!l)return;f--;if(0===f)break}else if(","==t)l=[],h[h.length-1].push(l);else{if(isNaN(parseFloat(t)))return null;l.push(parseFloat(t))}d(/^\s*/,e)}if(0!==f)return null;e.wktCoords=g;return e};a.geometry.Geometry.wktToPoint=function(e){var d=a.geometry,f=d.Geometry.findSubstring;if(!f(/^(point)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));if(!f(/^(\()/,e))return null;var g=[];if(d.Geometry.wktGetCoords(e))g=
e.wktCoords;else return null;f(/^\s*/,e);if(!f(/^(\))/,e))return null;d=new d.Point(g[0],g[1],8307);3==e.wktDim&&d.addDimension(g[2]);return d};a.geometry.Geometry.wktToLinestring=function(e){var d=a.geometry,f=d.Geometry.findSubstring;if(!f(/^(linestring)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));if(!f(/^(\()/,e))return null;var g=[];if(d.Geometry.wktGetCoords(e))g=e.wktCoords;else return null;return g&&f(/^(\))/,e)?2==e.wktDim?new d.LineString(g):new d.LineString(g,8307,
e.wktDim):null};a.geometry.Geometry.wktToPolygon=function(e){var d=a.geometry,f=d.Geometry.findSubstring;if(!f(/^(polygon)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));f=[];if(d.Geometry.wktGetMulticoords(e))f=e.wktCoords;else return null;return 2==e.wktDim?new d.Polygon(f):new d.Polygon(f,8307,e.wktDim)};a.geometry.Geometry.wktToMultipoint=function(e){var d=a.geometry,f=d.Geometry.findSubstring;if(!f(/^(multipoint)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,
e));var g=[];if(d.Geometry.wktGetMulticoordsPoint(e))g=e.wktCoords;else return null;f(/^\s*/,e);return 2==e.wktDim?new d.MultiPoint(g):new d.MultiPoint(g,8307,e.wktDim)};a.geometry.Geometry.wktToMultilinestring=function(e){var d=a.geometry,f=d.Geometry.findSubstring;if(!f(/^(multilinestring)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));f=[];if(d.Geometry.wktGetMulticoords(e))f=e.wktCoords;else return null;return 2==e.wktDim?new d.MultiLineString(f):new d.MultiLineString(f,8307,
e.wktDim)};a.geometry.Geometry.wktToMultipolygon=function(e){var d=a.geometry,f=d.Geometry.findSubstring;if(!f(/^(multipolygon)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));f=[];if(d.Geometry.wktGetMulticoords(e))f=e.wktCoords;else return null;return 2==e.wktDim?new d.MultiPolygon(f):new d.MultiPolygon(f,8307,e.wktDim)};a.geometry.Geometry.wktToGeometrycollection=function(e){var d=a.geometry,f=d.Geometry.findSubstring,g=[],h;if(!f(/^(geometrycollection)/i,e))return null;f(/^\s*/,
e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));if(!f(/^(\()/,e))return null;do if(h=d.Geometry.root(e))g.push(h),f(/^\s*/,e),f(/^(\,)/,e),f(/^\s*/,e);else break;while(h);return f(/^(\))/,e)?new d.GeometryCollection(g):null};a.geometry.Geometry.root=function(e){var d=a.geometry;return d.Geometry.wktToGeometrycollection(e)||d.Geometry.wktToPoint(e)||d.Geometry.wktToLinestring(e)||d.Geometry.wktToPolygon(e)||d.Geometry.wktToMultipoint(e)||d.Geometry.wktToMultilinestring(e)||d.Geometry.wktToMultipolygon(e)};
a.geometry.Geometry.createGeometryFromWKT=function(e){return a.geometry.Geometry.root({wktStr:e,wkti:0,wktMatch:"",wktCoords:[],wktDim:2})};a.geometry.Rectangle=a.geometry.Geometry.extend({initialize:function d(a,g,h,l,t){d.base.call(this,t);this.setRectangle(a,g,h,l)},getCenter:function(){return new a.geometry.Point((this.getMaxX()-this.getMinX())/2+this.getMinX(),(this.getMaxY()-this.getMinY())/2+this.getMinY(),this.srid)},getMinX:function(){return this.coordinates[0]},getMinY:function(){return this.coordinates[1]},
getMaxX:function(){return this.coordinates[2]},getMaxY:function(){return this.coordinates[3]},getWidth:function(){return this.coordinates[2]-this.coordinates[0]},getHeight:function(){return this.coordinates[3]-this.coordinates[1]},setRectangle:function(d,f,g,h){var l=a.util.ValidationUtil.isNumber;l(d)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Rectangle.setRectangle","minX:"+d);l(g)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Rectangle.setRectangle","maxX:"+g);l(f)||a.util.Logger.throwErr("MAPVIEWER_9018",
"geom.Rectangle.setRectangle","minY:"+f);l(h)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Rectangle.setRectangles","maxY:"+h);d=Number(d);f=Number(f);g=Number(g);h=Number(h);d>g&&(l=g,g=d,d=l);f>h&&(l=h,h=f,f=l);this.type="Rectangle";this.coordinates=[d,f,g,h]},getLength:function(){var a=this.coordinates;return 2*(a[2]-a[0])+2*(a[3]-a[1])},getArea:function(){return this.getWidth()*this.getHeight()},move:function(a,f){this.coordinates[0]+=a;this.coordinates[1]+=f;this.coordinates[2]+=a;this.coordinates[3]+=
f},expand:function(a){a&&a.type===this.type&&(this.coordinates[0]>a.coordinates[0]&&(this.coordinates[0]=a.coordinates[0]),this.coordinates[1]>a.coordinates[1]&&(this.coordinates[1]=a.coordinates[1]),this.coordinates[2]<a.coordinates[2]&&(this.coordinates[2]=a.coordinates[2]),this.coordinates[3]<a.coordinates[3]&&(this.coordinates[3]=a.coordinates[3]))},toGML:function(){var a='\x3cgml:Polygon srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',a=a+"\x3cgml:outerBoundaryIs\x3e\x3cgml:LinearRing\x3e\x3cgml:coordinates\x3e"+
(this.getMinX()+","+this.getMinY()+" "+this.getMaxX()+","+this.getMinY()+" "),a=a+(this.getMaxX()+","+this.getMaxY()+" "+this.getMinX()+","+this.getMaxY()+" "),a=a+(this.getMinX()+","+this.getMinY()+"\x3c/gml:coordinates\x3e\x3c/gml:LinearRing\x3e\x3c/gml:outerBoundaryIs\x3e");return a+="\x3c/gml:Polygon\x3e"},toWKT:function(){return"Rectangle"!=this.type?null:"POLYGON ("+this.coordinates[0]+" "+this.coordinates[1]+", "+this.coordinates[0]+" "+this.coordinates[3]+", "+this.coordinates[2]+" "+this.coordinates[3]+
", "+this.coordinates[2]+" "+this.coordinates[1]+", "+this.coordinates[0]+" "+this.coordinates[1]+")"}});a.geometry.Point=a.geometry.Geometry.extend({initialize:function f(g,h,l,t,G){f.base.call(this,l);l=a.util.ValidationUtil.isNumber;l(g)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","x:"+g);l(h)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","y:"+h);a.notNull(t)&&a.notNull(G)?(l(t)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","orientationX:"+t),l(G)||a.util.Logger.throwErr("MAPVIEWER_9018",
"geom.Point","orientationY:"+G),this.type="OrientedPoint",this.coordinates=[Number(g),Number(h),Number(t),Number(G)]):(this.type="Point",this.coordinates=[Number(g),Number(h)])},setPointIndex:function(f){a.notNull(f)&&(this.wraparoundMapIndex=f)},equals:function(f){if(a.isNull(f)||f.type!==this.type||f.srid!==this.srid||f.dim!==this.dim||f.coordinates.length!==this.coordinates.length)return!1;for(var g=0;g<this.coordinates.length;g++)if(this.coordinates[g]!==f.coordinates[g])return!1;return!0},getX:function(){return this.coordinates[0]},
getY:function(){return this.coordinates[1]},getDimensionValue:function(a){return 0>a||a>this.dim-1?b:this.coordinates[a]},getOrientationX:function(){return"OrientedPoint"===this.type?this.coordinates[this.dim]:b},getOrientationY:function(){return"OrientedPoint"===this.type?this.coordinates[this.dim+1]:b},getOrientationValue:function(a){return 0>a||a>this.dim-1||"OrientedPoint"!==this.type?b:this.coordinates[this.dim+a]},isOriented:function(){return this.coordinates.length>this.dim?!0:!1},getLength:function(){return 0},
getArea:function(){return 0},setPoint:function(f,g){var h=a.util.ValidationUtil.isNumber;h(f)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","x:"+f);h(g)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","y:"+g);this.coordinates[0]=Number(f);this.coordinates[1]=Number(g)},setDimensionValue:function(a,g){0>a||a>this.dim-1||(this.coordinates[a]=g)},setOrientationValue:function(a,g){0>a||a>this.dim-1||"OrientedPoint"!==this.type||(this.coordinates[this.dim+a]=g)},move:function g(a,l){this.x+=
a;this.y+=l;g.base.call(this,a,l)},toGML:function(){var g=a.util.GeomUtil.getOGCOrdinateString(this.coordinates,this.dim),h='\x3cgml:Point srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e';return h+g+"\x3c/gml:coordinates\x3e\x3c/gml:Point\x3e"},toWKT:function(){if("Point"!==this.type&&"OrientedPoint"!==this.type)return null;var g,h=this.dim;g="Point"===this.type?a.util.GeomUtil.getWktCoordinateStringFromPoint(this.coordinates,
h):a.util.GeomUtil.getWktCoordinateStringFromOrientedPoint(this.coordinates,h);var l="POINT";if(2==h)l+=" (";else if(3==h)l+=" Z (";else return null;return l+(g+")")},getOrientationPoint:function(g,h,l){if(a.isNull(l))if(this.isOriented())l=Math.atan2(this.coordinates[this.dim+1],this.coordinates[this.dim]);else return null;var t=g*Math.cos(l)*h.resolution;g=g*Math.sin(l)*h.resolution*h.stretchRatio;return new a.geometry.Point(this.coordinates[0]+t,this.coordinates[1]+g,this.srid)},addDimension:function(g,
h){"OrientedPoint"===this.type?(a.isNull(h)?this.coordinates.push(0):this.coordinates.push(h),this.coordinates.splice(this.dim,0,g)):this.coordinates.push(g);this.dim++},removeDimension:function(a){2>a||a>this.dim-1||("OrientedPoint"===this.type&&this.coordinates.splice(this.dim+a,1),this.coordinates.splice(this.dim-1,1),this.dim--)}});a.geometry.LineString=a.geometry.Geometry.extend({initialize:function h(l,t,G){h.base.call(this,t);!a.isNull(l)&&a.util.ValidationUtil.isNumberArray(l)||a.util.Logger.throwErr("MAPVIEWER_9018",
"geom.LineString","ordinates:"+l);4>l.length&&a.util.Logger.throwErr("MAPVIEWER_9011","geom.LineString","ordinates:"+l);this.dim=G||2;this.type="LineString";this.coordinates=l},toGML:function(){var h=a.util.GeomUtil.getOGCOrdinateString(this.coordinates,this.dim),l='\x3cgml:LineString srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e';return l+h+"\x3c/gml:coordinates\x3e\x3c/gml:LineString\x3e"},toWKT:function(){if("LineString"!=
this.type)return null;var h="LINESTRING",l=this.dim;if(2==l)h+=" (";else if(3==l)h+=" Z (";else return null;l=a.util.GeomUtil.getWktCoordinateStringFromLine(this.coordinates,l);h+=l;h=h.substring(0,h.length-1);return h+")"},getFirstPoint:function(){var h=this.coordinates;return 2>h.length?null:new a.geometry.Point(h[0],h[1],this.srid)},getLastPoint:function(){var h=this.coordinates;if(2>h.length)return null;var l=h.length;return new a.geometry.Point(h[l-2],h[l-1],this.srid)}});a.geometry.LineString.create=
function(h){(a.isNull(h)||2>h.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.LineString.create","pointArray:"+h);var l=a.util.GeomUtil.flatten(h,"Point");l||a.util.Logger.throwErr("MAPVIEWER_9018","geom.LineString.create","pointArray:"+h);return new a.geometry.LineString(l.ordinates,l.srid)};a.geometry.Polygon=a.geometry.Geometry.extend({initialize:function l(t,G,I){l.base.call(this,G);G=a.util.ValidationUtil;(a.isNull(t)||0===t.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon",
"ordinates:"+t);G.isNumberArray(t)&&(t=[t]);G.isNumberArray(t[0])||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon","ordinates:"+t);a.notNull(I)&&(this.dim=I);this.type="Polygon";this.coordinates=t},toGML:function(){var l=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[0],this.dim),t='\x3cgml:Polygon srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',t=t+'\x3cgml:outerBoundaryIs\x3e\x3cgml:LinearRing\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e'+
(l+"\x3c/gml:coordinates\x3e\x3c/gml:LinearRing\x3e\x3c/gml:outerBoundaryIs\x3e");if(1<this.coordinates.length)for(l=1;l<this.coordinates.length;l++)var G=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[l],this.dim),t=t+'\x3cgml:innerBoundaryIs\x3e\x3cgml:LinearRing\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e',t=t+(G+"\x3c/gml:coordinates\x3e\x3c/gml:LinearRing\x3e\x3c/gml:innerBoundaryIs\x3e");return t+="\x3c/gml:Polygon\x3e"},toWKT:function(){if("Polygon"!==this.type)return null;
var l=this.coordinates.length,t="POLYGON",G=this.dim;if(2==G)t+=" (";else if(3==G)t+=" Z (";else return null;for(var I=0;I<l;I++)var O=a.util.GeomUtil.getWktCoordinateStringFromLine(this.coordinates[I],G),t=t+("("+O),t=t.substring(0,t.length-1),t=t+"), ";t=t.substring(0,t.length-2);return t+")"}});a.geometry.Polygon.createCirclePolygon=function(l,t,G,I){I||(I=8307);for(var O=[],X=2*Math.PI/480,S=0;480>S;S++){var ca=S*X;O[2*S]=l+G*Math.cos(ca);O[2*S+1]=t+G*Math.sin(ca)}O[960]=O[0];O[961]=O[1];return new a.geometry.Polygon(O,
I)};a.geometry.Polygon.createGeodeticCirclePolygon=function(l,t,G,I){I||(I=8307);for(var O=[],X=0;36>X;X++){var S=a.util.GeomUtil.getPointAtBearing(l,t,G,X*Math.PI/18);O[2*X]=S.x;O[2*X+1]=S.y}O[72]=O[0];O[73]=O[1];return new a.geometry.Polygon(O,I)};a.geometry.Polygon.create=function(l,t){(a.isNull(l)||3>l.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon.create","pointArray:"+l);var G=a.util.GeomUtil.flatten(l,"Point");G||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon.create",
"pointArray:"+l);if(t&&2<t.length){var I=a.util.GeomUtil.flatten(t,"Point");I?G.srid!==I.srid&&a.util.Logger.throwErr("MAPVIEWER_9033","geom.Polygon.create",""):a.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon.create","outerPointArray:"+t);return new a.geometry.Polygon([G.ordinates,I.ordinates],G.srid)}return new a.geometry.Polygon([G.ordinates],G.srid)};a.geometry.Circle=a.geometry.Geometry.extend({initialize:function t(G,I,O,X){t.base.call(this,X);X=a.util.ValidationUtil.isNumber;X(G)||a.util.Logger.throwErr("MAPVIEWER_9018",
"geom.Circle","centerX:"+G);X(I)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle","centerY:"+I);X(O)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle","radius:"+O);this.centerX=Number(G);this.centerY=Number(I);this.radius=Number(O);this.toCirclePolygon();this.type="Polygon"},getRadius:function(){return this.radius},getCenterX:function(){return this.centerX},getLength:function(){return 6.283185307179586*this.radius},getArea:function(){return 3.141592653589793*this.radius*this.radius},getCenterY:function(){return this.centerY},
setCircle:function(t,G,I){var O=a.util.ValidationUtil.isNumber;O(t)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle.setCircle","centerX:"+t);O(G)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle.setCircle","centerY:"+G);O(I)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle.setCircle","radius:"+I);this.centerX=Number(t);this.centerY=Number(G);this.radius=Number(I);this.toCirclePolygon()},toCirclePolygon:function(){this.circlePolygon||(this.circlePolygon=a.geometry.Polygon.createCirclePolygon(this.centerX,
this.centerY,this.radius,this.srid),this.coordinates=this.circlePolygon.coordinates)},move:function G(a,O){this.centerX+=a;this.centerY+=O;G.base.call(this,a,O)},toGML:function(){return this.circlePolygon.toGML()},toWKT:function(){return this.circlePolygon.toWKT()}});a.geometry.MultiPoint=a.geometry.Geometry.extend({initialize:function I(O,X,S){I.base.call(this,X);X=a.util.ValidationUtil;(a.isNull(O)||1>O.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint","ordinates:"+O);X.isNumberArray(O[0])||
a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint","ordinates:"+O);a.notNull(S)&&(this.dim=S);S=O.length;X=!0;for(var ca=0;ca<S;ca++)O[ca].length<2*this.dim&&(X=!1);this.type=X?"OrientedMultiPoint":"MultiPoint";this.coordinates=O},getLength:function(){return 0},getArea:function(){return 0},toGML:function(){for(var I=this.coordinates.length,O='\x3cgml:MultiPoint srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',X=0;X<I;X++)var S=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[X],
this.dim),O=O+"\x3cgml:pointMember\x3e",O=O+('\x3cgml:Point srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e'),O=O+(S+"\x3c/gml:coordinates\x3e\x3c/gml:Point\x3e"),O=O+"\x3c/gml:pointMember\x3e";return O+"\x3c/gml:MultiPoint\x3e"},toWKT:function(){if("MultiPoint"!=this.type)return null;var I=this.coordinates.length,O="MULTIPOINT",X=this.dim;if(2==X)O+=" (";else if(3==X)O+=" Z (";else return null;for(var S=0;S<I;S++)var ca=
a.util.GeomUtil.getWktCoordinateStringFromPoint(this.coordinates[S],X),O=O+(ca+", ");O=O.substring(0,O.length-2);return O+")"}});a.geometry.MultiPoint.create=function(I){(a.isNull(I)||2>I.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint.create","pointArray:"+I);var O=a.util.GeomUtil.flatten(I,"Point",!0);O||a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint.create","pointArray:"+I);return new a.geometry.MultiPoint(O.ordinates,O.srid)};a.geometry.MultiLineString=a.geometry.Geometry.extend({initialize:function O(X,
S,ca){O.base.call(this,S);S=a.util.ValidationUtil;var sa=a.isNull(X)?0:X.length;1>sa&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiLineString","ordinates:"+X);for(var Na=0;Na<sa;Na++)!a.isNull(X[Na])&&S.isNumberArray(X[Na])||a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiLineString","ordinates:"+X);a.notNull(ca)&&(this.dim=ca);this.type="MultiLineString";this.coordinates=X},toGML:function(){for(var O=this.coordinates.length,X='\x3cgml:MultiLineString srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',
S=0;S<O;S++)var X=X+"\x3cgml:lineStringMember\x3e",ca=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[S],this.dim),X=X+('\x3cgml:LineString srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e'),X=X+(ca+"\x3c/gml:coordinates\x3e\x3c/gml:LineString\x3e"),X=X+"\x3c/gml:lineStringMember\x3e";return X+"\x3c/gml:MultiLineString\x3e"},toWKT:function(){if("MultiLineString"!==this.type)return null;var O=this.coordinates.length,
X="MULTILINESTRING",S=this.dim;if(2==S)X+=" (";else if(3==S)X+=" Z (";else return null;for(var ca=0;ca<O;ca++)var sa=a.util.GeomUtil.getWktCoordinateStringFromLine(this.coordinates[ca],S),X=X+("("+sa),X=X.substring(0,X.length-1),X=X+"), ";X=X.substring(0,X.length-2);return X+")"}});a.geometry.MultiLineString.create=function(O){(a.isNull(O)||2>O.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiLineString.create","lineArray:"+O);var X=a.util.GeomUtil.flatten(O,"LineString",!0);X||a.util.Logger.throwErr("MAPVIEWER_9018",
"geom.MultiLineString.create","lineArray:"+O);return new a.geometry.MultiLineString(X.ordinates,X.srid)};a.geometry.MultiPolygon=a.geometry.Geometry.extend({initialize:function X(S,ca,sa){X.base.call(this,ca);ca=a.util.ValidationUtil;var Na=a.isNull(S)?0:S.length;1>Na&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon","ordinates:"+S);for(var Va=0;Va<Na;Va++)(a.isNull(S[Va])||0===S[Va].length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon","ordinates:"+S),ca.isNumberArray(S[Va])&&
(S[Va]=[S[Va]]),ca.isNumberArray(S[Va][0])||a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon","ordinates:"+S);a.notNull(sa)&&(this.dim=sa);this.type="MultiPolygon";this.coordinates=S},_getMeasure:function(X){var S=this.coordinates,ca=S.length,sa=null,Na=0;"area"===X?sa=a.util.GeomUtil.polygonArea:"length"===X&&(sa=a.util.GeomUtil.polylineLength);for(var Va=0;Va<ca;Va++)if(X=S[Va],a.$.isArray(X[0]))for(var b=0;b<X.length;b++)Na+=sa(X[b],this.dim);else Na+=sa(X,this.dim);return Na},toGML:function(){for(var X=
this.coordinates.length,S='\x3cgml:MultiPolygon srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',ca=0;ca<X;ca++){var S=S+"\x3cgml:polygonMember\x3e",sa=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[ca][0],this.dim),S=S+('\x3cgml:Polygon srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e'),S=S+'\x3cgml:outerBoundaryIs\x3e\x3cgml:LinearRing\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e',S=S+(sa+"\x3c/gml:coordinates\x3e\x3c/gml:LinearRing\x3e\x3c/gml:outerBoundaryIs\x3e");
if(1<this.coordinates[ca].length)for(sa=1;sa<this.coordinates[ca].length;sa++)var Na=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[ca][sa],this.dim),S=S+'\x3cgml:innerBoundaryIs\x3e\x3cgml:LinearRing\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e',S=S+(Na+"\x3c/gml:coordinates\x3e\x3c/gml:LinearRing\x3e\x3c/gml:innerBoundaryIs\x3e");S+="\x3c/gml:Polygon\x3e";S+="\x3c/gml:polygonMember\x3e"}return S+"\x3c/gml:MultiPolygon\x3e"},toWKT:function(){if("MultiPolygon"!==this.type)return null;
var X=this.coordinates.length,S="MULTIPOLYGON",ca=this.dim;if(2==ca)S+=" (";else if(3==ca)S+=" Z (";else return null;for(var sa=0;sa<X;sa++){for(var Na=this.coordinates[sa].length,Va=this.coordinates[sa],S=S+"(",b=0;b<Na;b++)var c=a.util.GeomUtil.getWktCoordinateStringFromLine(Va[b],ca),S=S+("("+c),S=S.substring(0,S.length-1),S=S+"), ";S=S.substring(0,S.length-2);S+="), "}S=S.substring(0,S.length-2);return S+")"}});a.geometry.MultiPolygon.create=function(X){(a.isNull(X)||2>X.length)&&a.util.Logger.throwErr("MAPVIEWER_9018",
"geom.MultiPolygon.create","polygonArray:"+X);var S=a.util.GeomUtil.flatten(X,"Polygon",!0);S||a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon.create","polygonArray:"+X);return new a.geometry.MultiPolygon(S.ordinates,S.srid)};a.geometry.GeometryCollection=a.geometry.Geometry.extend({initialize:function S(ca,sa){S.base.call(this,sa);for(var Na=ca.length,b=0;b<Na;b++)ca[b]instanceof a.geometry.Geometry?a.isNull(sa)?ca[b].srid=sa:ca[b].srid!==sa&&(ca[b]=ca[b].transform(sa)):a.util.Logger.throwErr("MAPVIEWER_9018",
"geom.GeometryCollection","geometryArray:"+ca);this.geometries=ca;this.type="GeometryCollection"},getMBR:function(){if(!this.mbr){var S=a.geometry.Geometry.calculateGeomCollectionMBR(this.geometries,this.type);this.mbr=new a.geometry.Rectangle(S.minX,S.minY,S.maxX,S.maxY,this.srid)}return this.mbr},toString:function(){var a;a="{"+('"type":"'+this.type+'",');a+='"srid":'+this.srid+",";a+='"geometries":[';for(var ca=this.geometries.length,sa=0;sa<ca;sa++)a+=this.geometries[sa].toString()+",";ca=a.length;
a=a.substring(0,ca-1);return a+"]}"},clientTransform:function(S){for(var ca=this.geometries.length,sa=Array(ca),Na=0;Na<ca;Na++)sa[Na]=this.geometries[Na].transform(S);return new a.geometry.GeometryCollection(sa,S)},move:function(a,ca){for(var sa=this.geometries.length,Na=0;Na<sa;Na++)this.geometries[Na].move(a,ca);this.mbr&&this.mbr.move(a,ca)},toGML:function(){for(var a=this.geometries.length,ca='\x3cgml:MultiGeometry srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',
sa=0;sa<a;sa++)ca+="\x3cgml:geometryMember\x3e",ca+=this.geometries[sa].toGML(),ca+="\x3c/gml:geometryMember\x3e";return ca+"\x3c/gml:MultiGeometry\x3e"},toWKT:function(){if("GeometryCollection"!=this.type)return null;for(var a=this.geometries.length,ca="GEOMETRYCOLLECTION (",sa=0;sa<a;sa++)ca+=this.geometries[sa].toWKT(),ca+=", ";ca=ca.substring(0,ca.length-2);return ca+")"}});a.event.EventSource={addListener:function(a,ca,sa){var Na=this._omListeners=this._omListeners||{};Na[a]=Na[a]||[];Na[a].push({listener:ca,
context:sa||this});return this},hasListener:function(a){return"_omListeners"in this&&a in this._omListeners&&0<this._omListeners[a].length},getListeners:function(a){return this.hasListener(a)?this._omListeners[a]:[]},deleteListener:function(a,ca,sa){if(!this.hasListener(a))return this;for(var Na=0,b=this._omListeners,c=b[a].length;Na<c;Na++)if(b[a][Na].listener===ca&&(!sa||b[a][Na].context===sa)){b[a].splice(Na,1);break}return this},deleteListeners:function(a){if(!this.hasListener(a))return this;
this._omListeners[a]=[];return this},deleteAllListeners:function(){this._omListeners={};return this},fire:function(S){if(!this.hasListener(S))return this;var ca=this._omListeners[S].slice(),sa=[].slice.apply(arguments),b,Va;2<=sa.length&&sa.splice(0,1);for(var c=0,Qb=ca.length;c<Qb;c++)if(b=ca[c].listener){Va=ca[c].context||this;try{0<sa.length?b.apply(Va,sa):b.call(Va)}catch(ub){b=ub.message,ub.stack&&(b+="\nStack: "+ub.stack),a.util.Logger.warning("MAPVIEWER_9032","EventSource.fire",b)}}return this},
stopEvents:{},initProcessedEventStatus:function(){this.processedStatus={}},setProcessedEventStatus:function(S,ca,sa){ca===a.event.MouseEvent.TOUCH_TAP&&(ca=a.event.MouseEvent.MOUSE_CLICK);ca===a.event.MouseEvent.MOUSE_CLICK&&(this.processedStatus[S.name]=this.processedStatus[S.name]||{},this.processedStatus[S.name][ca]=sa)},getProcessedEventStatus:function(S,ca){if(ca!==a.event.MouseEvent.MOUSE_CLICK||a.isNull(this.processedStatus[S]))return!1;for(var sa=this.processedStatus[S],b=0;b<sa.length;b+=
1){var Va=sa[b];if(a.notNull(Va)&&Va.etype===ca)return Va.etype}return!1},resetProcessedEvent:function(a,ca){this.setProcessedEventStatus(a,ca,!1)},isProcessedEvent:function(S,ca){return a.isNull(this.processedStatus[S.name])?!1:this.processedStatus[S.name][ca]}};a.event.EventSource.on=a.event.EventSource.addListener;a.event.Event=a.Class.extend({initialize:function(S,ca){if(a.isNull(S)||a.isNull(ca))return null;this.type=S;this.target=ca;this.evt=null}});a.event.MapEvent=a.event.Event.extend({initialize:function ca(a,
b){ca.base.call(this,a,b);this.preMapCenter=this.affectedLayer=this.beforeZoomLevel=null}});a.event.MapEvent.I_MAP_CENTER_ZOOM="i_mapCenterZoom";a.event.MapEvent.I_MAP_DRAGGING="i_mapDragging";a.event.MapEvent.MAP_BEFORE_ZOOM="mapBeforeZoom";a.event.MapEvent.MAP_AFTER_ZOOM="mapAfterZoom";a.event.MapEvent.MAP_RECENTERED="mapRecentered";a.event.MapEvent.MAP_INITIALIZED="mapInitialized";a.event.MapEvent.MAP_RESET_UNIVERSE="mapResetUniverse";a.event.MapEvent.MAP_RESIZED="mapResized";a.event.MapEvent.MAP_BEFORE_REFRESH=
"mapBeforeRefresh";a.event.MapEvent.MAP_AFTER_REFRESH="mapAfterRefresh";a.event.MapEvent.MAP_REDRAW="mapRedraw";a.event.MapEvent.LAYER_ADDED="layerAdded";a.event.MapEvent.LAYER_DELETED="layerDeleted";a.event.MapEvent.LAYER_REORDERED="layerReordered";a.event.MapEvent.MAP_DESTROY="mapDestroy";a.event.MapEvent.MAP_RESTRICT_CENTER="mapRestrictCenter";a.event.MapEvent.MAP_STYLE_CHANGED="mapStyleChanged";a.event.MapEvent.MAP_CLEAN="mapClean";a.event.MapEvent.I_MAP_NSDP_MAPPED="mapNSDPMapped";a.event.KeyboardEvent=
a.event.Event.extend({initialize:function sa(a,b){sa.base.call(this,a,b);this.event=null}});a.event.KeyboardEvent.KEY_DOWN="keyDown";a.event.KeyboardEvent.KEY_UP="keyUp";a.event.LayerEvent=a.event.Event.extend({initialize:function Na(a,b){Na.base.call(this,a,b);this.affectedFeature=null}});a.event.LayerEvent.BEFORE_REFRESH="beforeFresh";a.event.LayerEvent.AFTER_REFRESH="afterFresh";a.event.LayerEvent.FEATURE_SELECTED="featureSelected";a.event.LayerEvent.FEATURE_DESELECTED="featureDeselected";a.event.LayerEvent.RENDERING_STYLE_CHANGED=
"renderingStyleChanged";a.event.LayerEvent.LABELING_STYLE_CHANGED="labelingStyleChanged";a.event.LayerEvent.SELECTION_STYLE_CHANGED="selectionStyleChanged";a.event.LayerEvent.HOVER_STYLE_CHANGED="hoverStyleChanged";a.event.LayerEvent.RESULT_STYLE_CHANGED="resultStyleChanged";a.event.LayerEvent.LABEL_VISIBILITY_CHANGED="labelVisibilityChanged";a.event.LayerEvent.LAYER_VISIBILITY_CHANGED="layerVisibilityChanged";a.event.LayerEvent.LAYER_REMOVED="layerRemoved";a.event.LayerEvent.LAYER_INITIALIZED="layerInitialized";
a.event.LayerEvent.FEATURE_MOVING="featureMoving";a.event.LayerEvent.FEATURE_MOVED="featureMoved";a.event.LayerEvent.FEATURE_EDITED="featureEdited";a.event.LayerEvent.FEATURE_ORIENTATION_CHANGING="featureOrientationChanging";a.event.LayerEvent.LAYER_Z_INDEX_CHANGED="layerZIndexChanged";a.event.LayerEvent.LAYER_INIT="layerInit";a.event.LayerEvent.FINISH_GOT_CONFIG="layerFinishGotConfig";a.event.LayerEvent.FINISH_LOAD="layerFinishLoad";a.event.LayerEvent.TILE_IMG_LOADED="tileImgLoaded";a.event.LayerEvent.ALL_TILES_LOADED=
"allTilesImgLoaded";a.event.LayerEvent.TILE_IMG_LOAD_ERROR="tileImgLoadError";a.event.LayerEvent.TILE_IMG_LOADING="tileImgLoading";a.event.LayerEvent.VECTOR_LAYER_LOADING_THEME="GETTING_THEME_DATA";a.event.LayerEvent.VECTOR_LAYER_PARSING_THEME="PARSING_THEME_DATA";a.event.LayerEvent.FEATURES_LOADED="featuresLoad";a.event.LayerEvent.FEATURES_DISPLAYED="featuresDisplay";a.event.LayerEvent.INIT_ERROR="initError";a.event.LayerEvent.NSDP_MAPPED="nsdpMapped";a.event.MapDecorationEvent=a.event.Event.extend({initialize:function Va(a,
b){Va.base.call(this,a,b)}});a.event.MapDecorationEvent.BEFORE_COLLAPSE="beforeCollapse";a.event.MapDecorationEvent.AFTER_COLLAPSE="afterCollapse";a.event.MapDecorationEvent.BEFORE_RESTORE="beforeRestore";a.event.MapDecorationEvent.AFTER_RESTORE="afterRestore";a.event.MapDecorationEvent.DRAG_START="dragStart";a.event.MapDecorationEvent.DRAG="drag";a.event.MapDecorationEvent.DRAG_END="dragEnd";a.event.MapDecorationEvent.DISPLAYED="displayed";a.event.MouseEvent=a.event.Event.extend({initialize:function Jb(a,
b){Jb.base.call(this,a,b);this.feature=this.location=null}});a.event.MouseEvent.MOUSE_DOWN="mouseDown";a.event.MouseEvent.MOUSE_UP="mouseUp";a.event.MouseEvent.MOUSE_MOVE="mouseMove";a.event.MouseEvent.MOUSE_OVER="mouseOver";a.event.MouseEvent.MOUSE_OUT="mouseOut";a.event.MouseEvent.MOUSE_CLICK="click";a.event.MouseEvent.MOUSE_RIGHT_CLICK="rightClick";a.event.MouseEvent.MOUSE_DOUBLE_CLICK="doubleClick";a.event.MouseEvent.WHEEL_SCROLL="wheelScroll";a.event.MouseEvent.TOUCH_TAP="tap";a.event.MouseEvent.TOUCH_LONG_PRESS=
"touchlongpress";a.event.MouseEvent.TOUCH_END="touchend";a.event.MouseEvent.TOUCH_START="touchstart";a.event.MouseEvent.MOUSE_ENTER="mouseEnter";a.event.MouseEvent.MOUSE_LEAVE="mouseLeave";a.event.MouseEvent.DEBOUNCE_MILI_SEC=300;a.event.MouseEvent.DELAY_MILI_SEC=300;a.event.ToolEvent=a.event.Event.extend({initialize:function Qb(a,b){Qb.base.call(this,a,b);this.location=null}});a.event.ToolEvent.TOOL_START="toolStart";a.event.ToolEvent.TOOL_END="toolEnd";a.event.ToolEvent.TOOL_CLEAR="toolClear";a.event.ToolEvent.RECTANGLE_DRAG=
"rectangleDrag";a.event.ToolEvent.CIRCLE_DRAG="circleDrag";a.event.ToolEvent.REDLINE_POINT_CREATE="redlinePointCreate";a.event.ToolEvent.REDLINE_POINT_REMOVE="redlinePointRemove";a.event.ToolEvent.REDLINE_DRAW="redlineDraw";a.event.ToolEvent.REDLINE_EDITED="redlineEdited";a.event.ToolEvent.DISTANCE_UPDATE="distanceUpdate";a.event.ToolEvent.SNAP_POINT="snapPoint";a.event.ToolEvent.MOUSE_RIGHT_CLICK="mouseRightClick";a.event.ToolbarEvent=a.event.Event.extend({initialize:function ub(a,b){ub.base.call(this,
a,b)}});a.event.ToolbarEvent.BUTTON_STATE_CHANGE="buttonStateChange";a.event.ToolbarEvent.BUTTON_DOWN="buttonDown";a.event.ToolbarEvent.BUTTON_UP="buttonUp";a.universe.ZoomLevel=a.Class.extend({initialize:function(b,c){!a.isNull(b)&&a.util.ValidationUtil.isNumber(b)&&(this.resolution=b,this.stretchRatio=1,c&&c.stretchRatio&&(this.stretchRatio=c.stretchRatio),this.infotip=null,c&&c.infotip&&(this.infotip=c.infotip))}});a.universe.Universe=a.Class.extend({initialize:function(b){if(a.isNull(b)||!a.util.ValidationUtil.isObject(b)||
a.isNull(b.srid)||!b.bounds)return null;this.srid=b.srid;this.bound=b.bounds;this.bound.srid!==this.srid&&(this.bound=this.bound.transform(this.srid));this.geodetic=b.geodetic?b.geodetic:this.srid&&8307===this.srid;if(!b.zoomLevels&&b.numberOfZoomLevels){this.zoomLevels=[];var c=this.bound,rb=Math.abs(c.getMaxX()-c.getMinX())/256,c=Math.abs(c.getMaxY()-c.getMinY())/256;c>rb&&(rb=c);for(c=0;c<b.numberOfZoomLevels;c++)this.zoomLevels[c]=new a.universe.ZoomLevel(rb),rb/=2}else this.zoomLevels=b.zoomLevels;
this.homeZoomlevel=this.homeCenter=null},getSRID:function(){return this.srid},getMapBounds:function(){return this.bound},getZoomLevelNumber:function(){return this.zoomLevels.length},getZoomLevels:function(){return this.zoomLevels},equals:function(a){if(this.srid!==a.srid||this.zoomLevels&&a.zoomLevels&&this.zoomLevels.length!==a.zoomLevels.length)return!1;for(var b=this.zoomLevels.length,c=0;c<b;c++)if(this.zoomLevels[c].resolution!==a.zoomLevels[c].resolution||this.zoomLevels[c].stretchRatio!==a.zoomLevels[c].stretchRatio)return!1;
return!0},clone:function(){var b={};a.$.extend(b,this);return b},copy:function(a){this.homeCenter=a.homeCenter;this.homeZoomlevel=a.homeZoomlevel;return this}});a.universe.Universe.EPSG4326={SRID:8307,unites:"degrees",metersPerUnit:6378137*Math.PI/180,bounds:new a.geometry.Rectangle(-180,-90,180,90,8307)};a.universe.Universe.EPSG3857={SRID:3857,unites:"meters",metersPerUnit:1,bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857)};a.universe.Universe.getMPU=function(b){switch(b){case 3857:return a.universe.Universe.EPSG3857.metersPerUnit;
case 8307:return a.universe.Universe.EPSG4326.metersPerUnit;default:return a.util.Logger.warning("","OM.universe.Universe.getMPU","srid's MPU is not found, 1 is returned."),1}};a.universe.Universe.getSpecs=function(b){switch(b){case 3857:return a.universe.Universe.EPSG3857;case 8307:return a.universe.Universe.EPSG4326;case 2180:return a.universe.Universe.EPSG2180}};a.universe.WorldMercatorUniverse=a.universe.Universe.extend({initialize:function zb(){var b=a.universe.ZoomLevel,b={srid:3857,bounds:new a.geometry.Rectangle(-20037508,
-20037508,20037508,20037508,3857),zoomLevels:[new b(78271.515625),new b(39135.7578125),new b(19567.87890625),new b(9783.939453125),new b(4891.9697265625),new b(2445.98486328125),new b(1222.992431640625),new b(611.4962158203125),new b(305.74810791015625),new b(152.87405395507812),new b(76.43702697753906),new b(38.21851348876953),new b(19.109256744384766),new b(9.554628372192383),new b(4.777314186096191),new b(2.3886570930480957),new b(1.1943285465240479),new b(.5971642732620239),new b(.29858213663101196)]};
zb.base.call(this,b)}});a.universe.ElocationUniverse=a.universe.Universe.extend({initialize:function rb(){var b=a.universe.ZoomLevel,b={srid:3857,bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new b(78271.515625),new b(39135.7578125),new b(19567.87890625),new b(9783.939453125),new b(4891.9697265625),new b(2445.98486328125),new b(1222.992431640625),new b(611.4962158203125),new b(305.74810791015625),new b(152.87405395507812),new b(76.43702697753906),new b(38.21851348876953),
new b(19.109256744384766),new b(9.554628372192383),new b(4.777314186096191),new b(2.3886570930480957),new b(1.1943285465240479),new b(.5971642732620239),new b(.29858213663101196)]};rb.base.call(this,b)}});a.universe.SElocationUniverse=a.universe.Universe.extend({initialize:function Ab(){var b=a.universe.ZoomLevel,b={srid:3857,bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new b(52181.010416666664),new b(31308.60625),new b(17393.67013888889),new b(9208.413602941177),
new b(4743.72821969697),new b(2371.864109848485),new b(1185.9320549242425),new b(592.9660274621212),new b(297.04560009487665),new b(148.52280004743832),new b(74.26140002371916),new b(37.12189500829974),new b(18.56314849401162),new b(9.28157424700581),new b(4.640511983458825),new b(2.3201184380187336),new b(1.1599302843826644),new b(.5799651421913322),new b(.2897185251365837)]};Ab.base.call(this,b)}});a.universe.LatLonUniverse=a.universe.Universe.extend({initialize:function Eb(){var b=a.universe.ZoomLevel,
b={srid:8307,bounds:new a.geometry.Rectangle(-180,-90,180,90,8307),zoomLevels:[new b(.703125),new b(.3515625),new b(.17578125),new b(22.5/256),new b(11.25/256),new b(5.625/256),new b(2.8125/256),new b(1.40625/256),new b(.703125/256),new b(.3515625/256),new b(.17578125/256),new b(.087890625/256),new b(.0439453125/256),new b(8.58306884765625E-5),new b(4.291534423828125E-5),new b(2.1457672119140625E-5),new b(1.0728836059570312E-5),new b(5.364418029785156E-6),new b(2.682209014892578E-6)]};Eb.base.call(this,
b)}});a.universe.OSMUniverse=a.universe.Universe.extend({initialize:function Da(){var b=a.universe.ZoomLevel,b={srid:3857,bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new b(156543.03125),new b(78271.515625),new b(39135.7578125),new b(19567.87890625),new b(9783.939453125),new b(4891.9697265625),new b(2445.98486328125),new b(1222.992431640625),new b(611.4962158203125),new b(305.74810791015625),new b(152.87405395507812),new b(76.43702697753906),new b(38.21851348876953),
new b(19.109256744384766),new b(9.554628372192383),new b(4.777314186096191),new b(2.3886570930480957),new b(1.1943285465240479),new b(.5971642732620239)]};Da.base.call(this,b)}});a.universe.TomTomUniverse=a.universe.Universe.extend({initialize:function Fa(){var b=a.universe.ZoomLevel,b={srid:3857,bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new b(19567.9),new b(9783.9),new b(4892),new b(2446),new b(1223),new b(611.5),new b(305.7),new b(152.9),new b(76.4),
new b(38.2),new b(19.1),new b(9.6),new b(4.8),new b(2.4),new b(1.2),new b(.596875)]};Fa.base.call(this,b)}});a.universe.BaiduUniverse=a.universe.Universe.extend({initialize:function Ga(){var va=a.universe.ZoomLevel,va={srid:a.util.BaiduUtil.SRID,bounds:new a.geometry.Rectangle(-2.003772637E7,-1.247410417E7,2.003772637E7,1.247410417E7,a.util.BaiduUtil.SRID),zoomLevels:[new va(262144),new va(131072),new va(65536),new va(32768),new va(16384),new va(8192),new va(4096),new va(2048),new va(1024),new va(512),
new va(256),new va(128),new va(64),new va(32),new va(16),new va(8),new va(4),new va(2),new va(1)]};Ga.base.call(this,va)}});a.universe.LocationBoxUniverse=a.universe.Universe.extend({initialize:function va(){var b=a.universe.ZoomLevel,b={srid:3857,bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new b(4891.9697265625),new b(2445.98486328125),new b(1222.992431640625),new b(611.4962158203125),new b(305.74810791015625),new b(152.87405395507812),new b(76.43702697753906),
new b(38.21851348876953),new b(19.109256744384766),new b(9.554628372192383),new b(4.777314186096191),new b(2.3886570930480957),new b(1.1943285465240479),new b(.5971642732620239),new b(.29858213663101196)]};va.base.call(this,b)}});a.style.Style=a.Class.extend({initialize:function(b){this.origConfig=a.isNull(b)?null:a.$.extend(!0,{},b);this.styleName=b&&b.styleName?b.styleName:this.generateName();this.styleType=b&&b.styleType?b.styleType:"Style";this.effects=b&&b.effects?b.effects:[];this.animation=
b&&b.animationStyle?b.animationStyle:null;this.bindings=null;this.isServerSide=!1},clone:function(){return a.$.extend(!0,{},this)},generateName:function(){var a=0;return function(){return"_om_style"+ ++a}}(),getConfig:function(){return this.origConfig},getStyleName:function(){return this.styleName},draw:function(a,b,Ua){},getBindables:function(){return[]},isBindable:function(a){var b=this.getBindables();if(!a||!b||0===b.length)return!1;for(var Ua=0;Ua<b.length;Ua++)if(a.toUpperCase()===b[Ua].toUpperCase())return!0;
return!1},isBound:function(b){var c=this.bindings;if(a.isNull(b)||a.isNull(c)||0===c.length||b&&!this.isBindable(b))return!1;for(var Ua=0;Ua<c.length;Ua++)if(b.toUpperCase()===c[Ua].attribute.toUpperCase())return!0;return!1},hasBinding:function(){return a.notNull(this.bindings)&&0<this.bindings.length},isFeatureBound:function(b){var c=this.bindings;if(a.isNull(c)||0===c.length)return!1;for(var Ua,Ia=!1,Sa=c.length,Wa=0;Wa<Sa;Wa++)Ua=this.resolveDataValue(c[Wa],b),a.notNull(Ua)&&(Ia=!0);return Ia},
isServerSide:function(){return this.isServerSide},bindData:function(b,c,Ua){if(b&&c&&this.isBindable(b)){a.isNull(this.bindings)&&(this.bindings=[]);var Ia={};Ia.attribute=b.toUpperCase();Ia.column="string"===typeof c?c.toUpperCase():c;a.notNull(Ua)?Ua instanceof a.style.Formatter?Ia.formatter=Ua:(Ia.resolver=Ua.resolver,Ia.attrList=Ua.attrList,Ia.classification=Ua.classification?Ua.classification:"equal"):a.util.Logger.throwErr("MAPVIEWER_9051","style.bindData","Must specify a Formatter.");this.bindings.push(Ia)}else a.util.Logger.warning(null,
"Style.bindData","Invalid binding attribute or column")},unbindData:function(a){if(a&&this.bindings&&this.isBound(a))for(var b=this.bindings,Ua=0;Ua<b.length;Ua++)a.toUpperCase()===b[Ua].attribute.toUpperCase()&&(b.splice(Ua,1),this.initialize(this.origConfig),this.bindings=b)},unbindAllData:function(a){if(a&&this.isBound(a))for(var b=this.bindings,Ua=0;Ua<b.length;Ua++)if(a===b[Ua].attribute){b.splice(Ua,1);this.initialize(this.origConfig);this.bindings=b;break}},resolveDataValue:function(va,c){if("string"===
typeof va.column){var Ua=va._colName=va.column,Ia=c.parentLayer;if(a.isNull(Ia))return b;va.column=new a.Column({data:Ia.getAllFeatures(),keyGetter:function(){return this.id},valueGetter:function(){var a=this.attributes&&this.attributes[Ua]?this.attributes[Ua]:null;return!isNaN(parseFloat(a))&&isFinite(a)?parseFloat(a):a}})}return va.column.getValueOfRow(c.id)},resolveBinding:function(b,c){var Ua,Ia=null,Sa,Wa;Ua=this.resolveDataValue(b,c);if(a.notNull(b.formatter))return Ia=b.formatter.resolve(Ua,
b.column,c);if(a.notNull(b.resolver))Ia=b.resolver(Ua,b.column);else if(Sa=b.column.getMin(),Wa=b.column.getMax(),b.attrList&&0<b.attrList.length){if(Sa===Wa)return b.attrList[0];if("logarithmic"===b.classification){1>Sa&&(Sa=1);var cb=Math.log(Sa);Wa=(Math.log(Wa)-cb)/b.attrList.length;for(var jb=0;jb<b.attrList.length;jb++){var Ya=Math.exp(cb+Wa*(jb+1));if(0===jb&&Ua<=Ya||Ua>=Sa&&Ua<=Ya){Ia=b.attrList[jb];break}Sa=Ya}}else Ua=parseInt((Ua-Sa)/((Wa-Sa)/b.attrList.length)),Ua>=b.attrList.length&&
(Ua=b.attrList.length-1),Ia=b.attrList[Ua]}return Ia}});a.style.Style.calculateStyleSize=function(b,c){if(!(a.isNull(b)||a.notNull(b.realWidth)&&a.notNull(b.realHeight))){var Ua=b.lengthUnit?b.lengthUnit:"pixel",Ua=Ua.toLowerCase(),Ia=a.util.GeomUtil.getCurrentDistancePerPixel(c);if("pixel"!==Ua){var Sa=a.gv.getUnitFactor(Ua);0===Sa?Ua="pixel":Ia/=Sa}"pixel"===Ua?(b.realWidth=b.width,b.realHeight=b.height):b.unitFontSize?b.fontSize=parseFloat(b.unitFontSize/Ia):b.unitFillWidth||b.unitCenterLineWidth||
b.unitStrokeThickness?(b.fillWidth=parseFloat(b.unitFillWidth/Ia),b.centerLineWidth=parseFloat(b.unitCenterLineWidth/Ia),b.strokeThickness=parseFloat(b.unitStrokeThickness/Ia),b.calculateRealSize()):b.unitSpotlightRadius?b.spotlightRadius=parseFloat(b.unitSpotlightRadius/Ia):(Sa=b.height,Ua=parseFloat(b.width/Ia),Ia=parseFloat(Sa/Ia),Ua=Ua<parseFloat(b.minlength)?parseFloat(b.minlength):Ua,Ia=Ia<parseFloat(b.minlength)?parseFloat(b.minlength):Ia,b.realWidth=Ua>parseFloat(b.maxlength)?parseFloat(b.maxlength):
Ua,b.realHeight=Ia>parseFloat(b.maxlength)?parseFloat(b.maxlength):Ia,!a.isNull(b.max_size_in_px)&&0<b.max_size_in_px&&(b.realWidth>b.max_size_in_px||b.realHeight>b.max_size_in_px)&&(Ia=Math.max(b.realWidth,b.realHeight),Ia=b.max_size_in_px/Ia,b.realWidth*=Ia,b.realHeight*=Ia))}};a.style.Style.rgbToHsv=function(a){var b,Ua;Ua=a.r/255;var Ia=a.g/255,Sa=a.b/255,Wa=Math.min(Ua,Ia,Sa);a=Math.max(Ua,Ia,Sa);Wa=a-Wa;0===Wa?b=0:a===Ia?b=60*(Sa-Ua)/Wa+120:a===Sa?b=60*(Ua-Ia)/Wa+240:a===Ua&&(b=Ia>=Sa?60*(Ia-
Sa)/Wa+0:60*(Ia-Sa)/Wa+360);Ua=0===a?0:Wa/a;return{h:Math.round(b),s:Math.round(100*Ua),v:Math.round(100*a)}};a.style.Style.hsvToRgb=function(a){var b=a.h,Ua=a.s;a=a.v;var Ia,Sa,Wa,c,jb,Ya;if(0===Ua)Wa=Sa=Ia=b=Ua=a=Math.round(255*a/100);else{Ua/=100;a/=100;c=Math.floor(b/60)%6;jb=b/60-c;b=a*(1-Ua);Ya=a*(1-Ua*jb);Ua=a*(1-Ua*(1-jb));switch(c){case 0:Ia=a;Sa=Ua;Wa=b;break;case 1:Ia=Ya;Sa=a;Wa=b;break;case 2:Ia=b;Sa=a;Wa=Ua;break;case 3:Ia=b;Sa=Ya;Wa=a;break;case 4:Ia=Ua;Sa=b;Wa=a;break;case 5:Ia=a,Sa=
b,Wa=Ya}Ia=Math.round(255*Ia);Sa=Math.round(255*Sa);Wa=Math.round(255*Wa)}return{r:Ia,g:Sa,b:Wa}};a.style.Style.ColorLuminance=function(a,b){a=String(a).replace(/[^0-9a-f]/gi,"");6>a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);b=b||0;var Ua="#",Ia,Sa;for(Sa=0;3>Sa;Sa++)Ia=parseInt(a.substr(2*Sa,2),16),Ia=Math.round(Math.min(Math.max(0,Ia+Ia*b),255)).toString(16),Ua+=("00"+Ia).substr(Ia.length);return Ua};a.style.colorbrewer={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],
5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:"#ffffcc #d9f0a3 #addd8e #78c679 #31a354 #006837".split(" "),7:"#ffffcc #d9f0a3 #addd8e #78c679 #41ab5d #238443 #005a32".split(" "),8:"#ffffe5 #f7fcb9 #d9f0a3 #addd8e #78c679 #41ab5d #238443 #005a32".split(" "),9:"#ffffe5 #f7fcb9 #d9f0a3 #addd8e #78c679 #41ab5d #238443 #006837 #004529".split(" ")},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:"#ffffcc #c7e9b4 #7fcdbb #41b6c4 #2c7fb8 #253494".split(" "),
7:"#ffffcc #c7e9b4 #7fcdbb #41b6c4 #1d91c0 #225ea8 #0c2c84".split(" "),8:"#ffffd9 #edf8b1 #c7e9b4 #7fcdbb #41b6c4 #1d91c0 #225ea8 #0c2c84".split(" "),9:"#ffffd9 #edf8b1 #c7e9b4 #7fcdbb #41b6c4 #1d91c0 #225ea8 #253494 #081d58".split(" ")},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:"#f0f9e8 #ccebc5 #a8ddb5 #7bccc4 #43a2ca #0868ac".split(" "),7:"#f0f9e8 #ccebc5 #a8ddb5 #7bccc4 #4eb3d3 #2b8cbe #08589e".split(" "),
8:"#f7fcf0 #e0f3db #ccebc5 #a8ddb5 #7bccc4 #4eb3d3 #2b8cbe #08589e".split(" "),9:"#f7fcf0 #e0f3db #ccebc5 #a8ddb5 #7bccc4 #4eb3d3 #2b8cbe #0868ac #084081".split(" ")},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:"#edf8fb #ccece6 #99d8c9 #66c2a4 #2ca25f #006d2c".split(" "),7:"#edf8fb #ccece6 #99d8c9 #66c2a4 #41ae76 #238b45 #005824".split(" "),8:"#f7fcfd #e5f5f9 #ccece6 #99d8c9 #66c2a4 #41ae76 #238b45 #005824".split(" "),
9:"#f7fcfd #e5f5f9 #ccece6 #99d8c9 #66c2a4 #41ae76 #238b45 #006d2c #00441b".split(" ")},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:"#f6eff7 #d0d1e6 #a6bddb #67a9cf #1c9099 #016c59".split(" "),7:"#f6eff7 #d0d1e6 #a6bddb #67a9cf #3690c0 #02818a #016450".split(" "),8:"#fff7fb #ece2f0 #d0d1e6 #a6bddb #67a9cf #3690c0 #02818a #016450".split(" "),9:"#fff7fb #ece2f0 #d0d1e6 #a6bddb #67a9cf #3690c0 #02818a #016c59 #014636".split(" ")},
PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:"#f1eef6 #d0d1e6 #a6bddb #74a9cf #2b8cbe #045a8d".split(" "),7:"#f1eef6 #d0d1e6 #a6bddb #74a9cf #3690c0 #0570b0 #034e7b".split(" "),8:"#fff7fb #ece7f2 #d0d1e6 #a6bddb #74a9cf #3690c0 #0570b0 #034e7b".split(" "),9:"#fff7fb #ece7f2 #d0d1e6 #a6bddb #74a9cf #3690c0 #0570b0 #045a8d #023858".split(" ")},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3",
"#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:"#edf8fb #bfd3e6 #9ebcda #8c96c6 #8856a7 #810f7c".split(" "),7:"#edf8fb #bfd3e6 #9ebcda #8c96c6 #8c6bb1 #88419d #6e016b".split(" "),8:"#f7fcfd #e0ecf4 #bfd3e6 #9ebcda #8c96c6 #8c6bb1 #88419d #6e016b".split(" "),9:"#f7fcfd #e0ecf4 #bfd3e6 #9ebcda #8c96c6 #8c6bb1 #88419d #810f7c #4d004b".split(" ")},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a",
"#7a0177"],6:"#feebe2 #fcc5c0 #fa9fb5 #f768a1 #c51b8a #7a0177".split(" "),7:"#feebe2 #fcc5c0 #fa9fb5 #f768a1 #dd3497 #ae017e #7a0177".split(" "),8:"#fff7f3 #fde0dd #fcc5c0 #fa9fb5 #f768a1 #dd3497 #ae017e #7a0177".split(" "),9:"#fff7f3 #fde0dd #fcc5c0 #fa9fb5 #f768a1 #dd3497 #ae017e #7a0177 #49006a".split(" ")},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:"#f1eef6 #d4b9da #c994c7 #df65b0 #dd1c77 #980043".split(" "),
7:"#f1eef6 #d4b9da #c994c7 #df65b0 #e7298a #ce1256 #91003f".split(" "),8:"#f7f4f9 #e7e1ef #d4b9da #c994c7 #df65b0 #e7298a #ce1256 #91003f".split(" "),9:"#f7f4f9 #e7e1ef #d4b9da #c994c7 #df65b0 #e7298a #ce1256 #980043 #67001f".split(" ")},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:"#fef0d9 #fdd49e #fdbb84 #fc8d59 #e34a33 #b30000".split(" "),7:"#fef0d9 #fdd49e #fdbb84 #fc8d59 #ef6548 #d7301f #990000".split(" "),
8:"#fff7ec #fee8c8 #fdd49e #fdbb84 #fc8d59 #ef6548 #d7301f #990000".split(" "),9:"#fff7ec #fee8c8 #fdd49e #fdbb84 #fc8d59 #ef6548 #d7301f #b30000 #7f0000".split(" ")},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:"#ffffb2 #fed976 #feb24c #fd8d3c #f03b20 #bd0026".split(" "),7:"#ffffb2 #fed976 #feb24c #fd8d3c #fc4e2a #e31a1c #b10026".split(" "),8:"#ffffcc #ffeda0 #fed976 #feb24c #fd8d3c #fc4e2a #e31a1c #b10026".split(" "),
9:"#ffffcc #ffeda0 #fed976 #feb24c #fd8d3c #fc4e2a #e31a1c #bd0026 #800026".split(" ")},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:"#ffffd4 #fee391 #fec44f #fe9929 #d95f0e #993404".split(" "),7:"#ffffd4 #fee391 #fec44f #fe9929 #ec7014 #cc4c02 #8c2d04".split(" "),8:"#ffffe5 #fff7bc #fee391 #fec44f #fe9929 #ec7014 #cc4c02 #8c2d04".split(" "),9:"#ffffe5 #fff7bc #fee391 #fec44f #fe9929 #ec7014 #cc4c02 #993404 #662506".split(" ")},
Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:"#f2f0f7 #dadaeb #bcbddc #9e9ac8 #756bb1 #54278f".split(" "),7:"#f2f0f7 #dadaeb #bcbddc #9e9ac8 #807dba #6a51a3 #4a1486".split(" "),8:"#fcfbfd #efedf5 #dadaeb #bcbddc #9e9ac8 #807dba #6a51a3 #4a1486".split(" "),9:"#fcfbfd #efedf5 #dadaeb #bcbddc #9e9ac8 #807dba #6a51a3 #54278f #3f007d".split(" ")},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7",
"#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:"#eff3ff #c6dbef #9ecae1 #6baed6 #3182bd #08519c".split(" "),7:"#eff3ff #c6dbef #9ecae1 #6baed6 #4292c6 #2171b5 #084594".split(" "),8:"#f7fbff #deebf7 #c6dbef #9ecae1 #6baed6 #4292c6 #2171b5 #084594".split(" "),9:"#f7fbff #deebf7 #c6dbef #9ecae1 #6baed6 #4292c6 #2171b5 #08519c #08306b".split(" ")},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354",
"#006d2c"],6:"#edf8e9 #c7e9c0 #a1d99b #74c476 #31a354 #006d2c".split(" "),7:"#edf8e9 #c7e9c0 #a1d99b #74c476 #41ab5d #238b45 #005a32".split(" "),8:"#f7fcf5 #e5f5e0 #c7e9c0 #a1d99b #74c476 #41ab5d #238b45 #005a32".split(" "),9:"#f7fcf5 #e5f5e0 #c7e9c0 #a1d99b #74c476 #41ab5d #238b45 #006d2c #00441b".split(" ")},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:"#feedde #fdd0a2 #fdae6b #fd8d3c #e6550d #a63603".split(" "),
7:"#feedde #fdd0a2 #fdae6b #fd8d3c #f16913 #d94801 #8c2d04".split(" "),8:"#fff5eb #fee6ce #fdd0a2 #fdae6b #fd8d3c #f16913 #d94801 #8c2d04".split(" "),9:"#fff5eb #fee6ce #fdd0a2 #fdae6b #fd8d3c #f16913 #d94801 #a63603 #7f2704".split(" ")},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:"#fee5d9 #fcbba1 #fc9272 #fb6a4a #de2d26 #a50f15".split(" "),7:"#fee5d9 #fcbba1 #fc9272 #fb6a4a #ef3b2c #cb181d #99000d".split(" "),
8:"#fff5f0 #fee0d2 #fcbba1 #fc9272 #fb6a4a #ef3b2c #cb181d #99000d".split(" "),9:"#fff5f0 #fee0d2 #fcbba1 #fc9272 #fb6a4a #ef3b2c #cb181d #a50f15 #67000d".split(" ")},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:"#f7f7f7 #d9d9d9 #bdbdbd #969696 #636363 #252525".split(" "),7:"#f7f7f7 #d9d9d9 #bdbdbd #969696 #737373 #525252 #252525".split(" "),8:"#ffffff #f0f0f0 #d9d9d9 #bdbdbd #969696 #737373 #525252 #252525".split(" "),
9:"#ffffff #f0f0f0 #d9d9d9 #bdbdbd #969696 #737373 #525252 #252525 #000000".split(" ")},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:"#b35806 #f1a340 #fee0b6 #d8daeb #998ec3 #542788".split(" "),7:"#b35806 #f1a340 #fee0b6 #f7f7f7 #d8daeb #998ec3 #542788".split(" "),8:"#b35806 #e08214 #fdb863 #fee0b6 #d8daeb #b2abd2 #8073ac #542788".split(" "),9:"#b35806 #e08214 #fdb863 #fee0b6 #f7f7f7 #d8daeb #b2abd2 #8073ac #542788".split(" "),
10:"#7f3b08 #b35806 #e08214 #fdb863 #fee0b6 #d8daeb #b2abd2 #8073ac #542788 #2d004b".split(" "),11:"#7f3b08 #b35806 #e08214 #fdb863 #fee0b6 #f7f7f7 #d8daeb #b2abd2 #8073ac #542788 #2d004b".split(" ")},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:"#8c510a #d8b365 #f6e8c3 #c7eae5 #5ab4ac #01665e".split(" "),7:"#8c510a #d8b365 #f6e8c3 #f5f5f5 #c7eae5 #5ab4ac #01665e".split(" "),8:"#8c510a #bf812d #dfc27d #f6e8c3 #c7eae5 #80cdc1 #35978f #01665e".split(" "),
9:"#8c510a #bf812d #dfc27d #f6e8c3 #f5f5f5 #c7eae5 #80cdc1 #35978f #01665e".split(" "),10:"#543005 #8c510a #bf812d #dfc27d #f6e8c3 #c7eae5 #80cdc1 #35978f #01665e #003c30".split(" "),11:"#543005 #8c510a #bf812d #dfc27d #f6e8c3 #f5f5f5 #c7eae5 #80cdc1 #35978f #01665e #003c30".split(" ")},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:"#762a83 #af8dc3 #e7d4e8 #d9f0d3 #7fbf7b #1b7837".split(" "),7:"#762a83 #af8dc3 #e7d4e8 #f7f7f7 #d9f0d3 #7fbf7b #1b7837".split(" "),
8:"#762a83 #9970ab #c2a5cf #e7d4e8 #d9f0d3 #a6dba0 #5aae61 #1b7837".split(" "),9:"#762a83 #9970ab #c2a5cf #e7d4e8 #f7f7f7 #d9f0d3 #a6dba0 #5aae61 #1b7837".split(" "),10:"#40004b #762a83 #9970ab #c2a5cf #e7d4e8 #d9f0d3 #a6dba0 #5aae61 #1b7837 #00441b".split(" "),11:"#40004b #762a83 #9970ab #c2a5cf #e7d4e8 #f7f7f7 #d9f0d3 #a6dba0 #5aae61 #1b7837 #00441b".split(" ")},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],
6:"#c51b7d #e9a3c9 #fde0ef #e6f5d0 #a1d76a #4d9221".split(" "),7:"#c51b7d #e9a3c9 #fde0ef #f7f7f7 #e6f5d0 #a1d76a #4d9221".split(" "),8:"#c51b7d #de77ae #f1b6da #fde0ef #e6f5d0 #b8e186 #7fbc41 #4d9221".split(" "),9:"#c51b7d #de77ae #f1b6da #fde0ef #f7f7f7 #e6f5d0 #b8e186 #7fbc41 #4d9221".split(" "),10:"#8e0152 #c51b7d #de77ae #f1b6da #fde0ef #e6f5d0 #b8e186 #7fbc41 #4d9221 #276419".split(" "),11:"#8e0152 #c51b7d #de77ae #f1b6da #fde0ef #f7f7f7 #e6f5d0 #b8e186 #7fbc41 #4d9221 #276419".split(" ")},
RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:"#b2182b #ef8a62 #fddbc7 #d1e5f0 #67a9cf #2166ac".split(" "),7:"#b2182b #ef8a62 #fddbc7 #f7f7f7 #d1e5f0 #67a9cf #2166ac".split(" "),8:"#b2182b #d6604d #f4a582 #fddbc7 #d1e5f0 #92c5de #4393c3 #2166ac".split(" "),9:"#b2182b #d6604d #f4a582 #fddbc7 #f7f7f7 #d1e5f0 #92c5de #4393c3 #2166ac".split(" "),10:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #d1e5f0 #92c5de #4393c3 #2166ac #053061".split(" "),
11:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #f7f7f7 #d1e5f0 #92c5de #4393c3 #2166ac #053061".split(" ")},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:"#b2182b #ef8a62 #fddbc7 #e0e0e0 #999999 #4d4d4d".split(" "),7:"#b2182b #ef8a62 #fddbc7 #ffffff #e0e0e0 #999999 #4d4d4d".split(" "),8:"#b2182b #d6604d #f4a582 #fddbc7 #e0e0e0 #bababa #878787 #4d4d4d".split(" "),9:"#b2182b #d6604d #f4a582 #fddbc7 #ffffff #e0e0e0 #bababa #878787 #4d4d4d".split(" "),
10:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #e0e0e0 #bababa #878787 #4d4d4d #1a1a1a".split(" "),11:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #ffffff #e0e0e0 #bababa #878787 #4d4d4d #1a1a1a".split(" ")},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:"#d73027 #fc8d59 #fee090 #e0f3f8 #91bfdb #4575b4".split(" "),7:"#d73027 #fc8d59 #fee090 #ffffbf #e0f3f8 #91bfdb #4575b4".split(" "),8:"#d73027 #f46d43 #fdae61 #fee090 #e0f3f8 #abd9e9 #74add1 #4575b4".split(" "),
9:"#d73027 #f46d43 #fdae61 #fee090 #ffffbf #e0f3f8 #abd9e9 #74add1 #4575b4".split(" "),10:"#a50026 #d73027 #f46d43 #fdae61 #fee090 #e0f3f8 #abd9e9 #74add1 #4575b4 #313695".split(" "),11:"#a50026 #d73027 #f46d43 #fdae61 #fee090 #ffffbf #e0f3f8 #abd9e9 #74add1 #4575b4 #313695".split(" ")},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:"#d53e4f #fc8d59 #fee08b #e6f598 #99d594 #3288bd".split(" "),7:"#d53e4f #fc8d59 #fee08b #ffffbf #e6f598 #99d594 #3288bd".split(" "),
8:"#d53e4f #f46d43 #fdae61 #fee08b #e6f598 #abdda4 #66c2a5 #3288bd".split(" "),9:"#d53e4f #f46d43 #fdae61 #fee08b #ffffbf #e6f598 #abdda4 #66c2a5 #3288bd".split(" "),10:"#9e0142 #d53e4f #f46d43 #fdae61 #fee08b #e6f598 #abdda4 #66c2a5 #3288bd #5e4fa2".split(" "),11:"#9e0142 #d53e4f #f46d43 #fdae61 #fee08b #ffffbf #e6f598 #abdda4 #66c2a5 #3288bd #5e4fa2".split(" ")},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],
6:"#d73027 #fc8d59 #fee08b #d9ef8b #91cf60 #1a9850".split(" "),7:"#d73027 #fc8d59 #fee08b #ffffbf #d9ef8b #91cf60 #1a9850".split(" "),8:"#d73027 #f46d43 #fdae61 #fee08b #d9ef8b #a6d96a #66bd63 #1a9850".split(" "),9:"#d73027 #f46d43 #fdae61 #fee08b #ffffbf #d9ef8b #a6d96a #66bd63 #1a9850".split(" "),10:"#a50026 #d73027 #f46d43 #fdae61 #fee08b #d9ef8b #a6d96a #66bd63 #1a9850 #006837".split(" "),11:"#a50026 #d73027 #f46d43 #fdae61 #fee08b #ffffbf #d9ef8b #a6d96a #66bd63 #1a9850 #006837".split(" ")},
Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:"#7fc97f #beaed4 #fdc086 #ffff99 #386cb0 #f0027f".split(" "),7:"#7fc97f #beaed4 #fdc086 #ffff99 #386cb0 #f0027f #bf5b17".split(" "),8:"#7fc97f #beaed4 #fdc086 #ffff99 #386cb0 #f0027f #bf5b17 #666666".split(" ")},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:"#1b9e77 #d95f02 #7570b3 #e7298a #66a61e #e6ab02".split(" "),
7:"#1b9e77 #d95f02 #7570b3 #e7298a #66a61e #e6ab02 #a6761d".split(" "),8:"#1b9e77 #d95f02 #7570b3 #e7298a #66a61e #e6ab02 #a6761d #666666".split(" ")},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c".split(" "),7:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f".split(" "),8:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00".split(" "),
9:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00 #cab2d6".split(" "),10:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00 #cab2d6 #6a3d9a".split(" "),11:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00 #cab2d6 #6a3d9a #ffff99".split(" "),12:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00 #cab2d6 #6a3d9a #ffff99 #b15928".split(" ")},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3",
"#ccebc5","#decbe4","#fed9a6"],6:"#fbb4ae #b3cde3 #ccebc5 #decbe4 #fed9a6 #ffffcc".split(" "),7:"#fbb4ae #b3cde3 #ccebc5 #decbe4 #fed9a6 #ffffcc #e5d8bd".split(" "),8:"#fbb4ae #b3cde3 #ccebc5 #decbe4 #fed9a6 #ffffcc #e5d8bd #fddaec".split(" "),9:"#fbb4ae #b3cde3 #ccebc5 #decbe4 #fed9a6 #ffffcc #e5d8bd #fddaec #f2f2f2".split(" ")},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:"#b3e2cd #fdcdac #cbd5e8 #f4cae4 #e6f5c9 #fff2ae".split(" "),
7:"#b3e2cd #fdcdac #cbd5e8 #f4cae4 #e6f5c9 #fff2ae #f1e2cc".split(" "),8:"#b3e2cd #fdcdac #cbd5e8 #f4cae4 #e6f5c9 #fff2ae #f1e2cc #cccccc".split(" ")},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:"#e41a1c #377eb8 #4daf4a #984ea3 #ff7f00 #ffff33".split(" "),7:"#e41a1c #377eb8 #4daf4a #984ea3 #ff7f00 #ffff33 #a65628".split(" "),8:"#e41a1c #377eb8 #4daf4a #984ea3 #ff7f00 #ffff33 #a65628 #f781bf".split(" "),
9:"#e41a1c #377eb8 #4daf4a #984ea3 #ff7f00 #ffff33 #a65628 #f781bf #999999".split(" ")},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:"#66c2a5 #fc8d62 #8da0cb #e78ac3 #a6d854 #ffd92f".split(" "),7:"#66c2a5 #fc8d62 #8da0cb #e78ac3 #a6d854 #ffd92f #e5c494".split(" "),8:"#66c2a5 #fc8d62 #8da0cb #e78ac3 #a6d854 #ffd92f #e5c494 #b3b3b3".split(" ")},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3",
"#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462".split(" "),7:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69".split(" "),8:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5".split(" "),9:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5 #d9d9d9".split(" "),10:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5 #d9d9d9 #bc80bd".split(" "),11:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5 #d9d9d9 #bc80bd #ccebc5".split(" "),
12:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5 #d9d9d9 #bc80bd #ccebc5 #ffed6f".split(" ")}};a.style.Text=a.style.Style.extend({initialize:function Rb(b){b=b||{};b.styleType="Text";Rb.base.call(this,b);this.fontFamily=a.notNull(b.fontFamily)?b.fontFamily:null;this.fontStyle=a.notNull(b.fontStyle)?b.fontStyle:a.Text.FONTSTYLE_NORMAL;this.fontWeight=a.notNull(b.fontWeight)?b.fontWeight:a.Text.FONTWEIGHT_NORMAL;this.fill=a.notNull(b.fill)?b.fill:null;this.lengthUnit=a.notNull(b.lengthUnit)?
b.lenghtUnit:"pixel";this.lengthUnit=a.notNull(b.sizeUnit)?b.sizeUnit:"pixel";"pixel"===this.lengthUnit?this.fontSize=a.notNull(b.fontSize)?parseInt(b.fontSize):12:this.unitFontSize=a.notNull(b.fontSize)?parseInt(b.fontSize):10;this.hAlign=a.notNull(b.hAlign)?b.hAlign:a.Text.HORIZONTALALIGN_CENTER;this.vAlign=a.notNull(b.vAlign)?b.vAlign:a.Text.VERTICALALIGN_CENTER;this.sticky=a.notNull(b.sticky)?b.sticky:!1},toXMLString:function(){var b="",c="",c=a.notNull(this.fontStyle)&&this.fontStyle===a.Text.FONTSTYLE_ITALIC?
"font-style:italic;":"font-style:plain;",b=a.notNull(this.hAlign)&&this.hAlign===a.HORIZONTALALIGN_LEFT?"text-align:left;":a.notNull(this.hAlign)&&this.hAlign===a.HORIZONTALALIGN_RIGHT?"text-align:right;":"text-align:center;",Ia;Ia=""+('\x3cstyle name\x3d"'+this.getStyleName()+'"\x3e');Ia=Ia+'\x3cg class\x3d"text" style\x3d"'+c;Ia+=a.notNull(this.fontFamily)?"font-family:"+this.fontFamily+";":"";Ia+=a.notNull(this.fontSize)?"font-size:"+this.fontSize+"pt;":"";Ia+=b;Ia+=a.notNull(this.fill)?"fill:"+
this.fill:"";return Ia+='"\x3e\x3c/g\x3e\x3c/style\x3e'},draw:function(b,c,Ia){this.resolve(b);var Sa=b.geo,Wa=b.geo.type;if(Ia.markerPoint&&b.shapeGroup)b.shapeGroup.push(this.drawText(c,Ia.group,Ia.markerPoint,b.markerText));else if(Ia.sPoint)b.shape=this.drawText(c,Ia.group,Ia.sPoint,b.markerText);else if("LineString"!==Wa&&"MultiLineString"!==Wa)if("Polygon"===Wa||"MultiPolygon"===Wa)b.screenPoints||(Wa=null,b.labelBox?Wa=new a.geometry.Point((b.labelBox[0]+b.labelBox[2])/2,(b.labelBox[1]+b.labelBox[3])/
2,Sa.srid):Sa.mbr&&(Wa=new a.geometry.Point((Sa.mbr.getMinX()+Sa.mbr.getMaxX())/2,(Sa.mbr.getMinY()+Sa.mbr.getMaxY())/2,Sa.srid)),Wa=b.transformGeometry(Wa),b.screenPoints||(b.screenPoints=Wa)),b.shape=this.drawText(c,Ia.group,b.screenPoints,b.markerText);else if(b.screenPoints||b.transformGeometry(Sa),"Point"===Wa||"OrientedPoint"===Wa)b.shape=this.drawText(c,Ia.group,b.screenPoints,b.text),a.isNull(b.renderingStyle)||(b.markerWidth=this.realWidthInPx,b.markerHeight=this.realWidthInPx)},drawText:function(b,
c,Ia,Sa){if(0!==this.width&&0!==this.height){var Wa=b.getGraphics();Ia=Wa.createTextNode(Sa,this,Ia.x,Ia.y);c.appendChild(Ia);this.size=Wa.getWidthHeight(Ia);a.style.Style.calculateStyleSize(this,b);c=b=0;if(a.notNull(this.hAlign))switch(this.hAlign){case a.Text.HORIZONTALALIGN_CENTER:b=(0-this.size.w)/2;break;case a.Text.HORIZONTALALIGN_RIGHT:b=-this.size.w}if(a.notNull(this.vAlign))switch(this.hAlign){case a.Text.VERTICALALIGN_CENTER:c=(this.size.h-4)/2;break;case a.Text.VERTICALALIGN_TOP:c=this.size.h}(new Wa.oui.geom.Matrix).translate(b,
c);return Ia}},getBindables:function(){a.isNull(this.bindableAttrs)&&(this.bindableAttrs=["Color","FontSize","FontFamily","FontStyle"]);return this.bindableAttrs},resolve:function(b){if(!this.bindings||0===this.bindings.length)return this;for(var c=0,Ia=this.bindings.length;c<Ia;c++){var Sa=this.bindings[c],Wa=this.resolveBinding(Sa,b);"COLOR"===Sa.attribute?(this.fill=Wa,this.isBound("COLOR")&&1===this.bindings.length&&Wa===a.PaintTypes.NO_PAINT&&(this.width=0)):"FONTSIZE"===Sa.attribute?this.fontSize=
Wa:"FONTFAMILY"===Sa.attribute?this.fontFamily=Wa:"FONSTYLE"===Sa.attribute&&(this.fontStyle=Wa)}return this}});a.style.Gradient=a.style.Style.extend({initialize:function Ua(b){b=b||{};b.styleType=b&&b.styleType?b.styleType:"AbstractGradient";Ua.base.call(this,b);if(a.isNull(b.stops))return a.util.Logger.throwErr(null,"Gradient.initialize","Color stops not provided."),null;this.copyOrigStops();this.useFeatureBoundingBox=b&&a.notNull(b.useFeatureBoundingBox)?b.useFeatureBoundingBox:!0;this.stroke=
b&&a.notNull(b.stroke)?b.stroke:null;this.strokeThickness=b&&a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):1;this.strokeOpacity=b&&a.notNull(b.strokeOpacity)?b.strokeOpacity:1;this.fillOpacity=b&&a.notNull(b.fillOpacity)?b.fillOpacity:1;this.strokeDash=a.notNull(b.strokeDash)?b.strokeDash:[]},copyOrigStops:function(){this.stops1=[];for(var a,b=this.origConfig,c=0;c<b.stops.length;c++)a=b.stops[c],this.stops1.push({offset:a.offset,color:a.color})},createGradientStop:function(a){a=a.oui.style.GradientStop;
if(this.stops1){var b=this.stops1.length;this.stops=[];for(var c=0;c<b;c++)this.stops1[c]instanceof a||(this.stops[c]=new a({offset:this.stops1[c].offset,color:this.stops1[c].color}))}},draw:function(b,c,Sa){var Wa=b.geo,cb=Sa.type?Sa.type:Wa.type;c=c.getGraphics();var jb,Ya,Pa;Sa.screenPoints?Wa=Sa.screenPoints:(b.screenPoints||b.transformGeometry(Wa),Wa=b.screenPoints);this.resolve(b,c);if(("LineString"===cb||"MultiLineString"===cb)&&Wa&&0<Wa.length)if(jb={stroke:this.stroke,strokeOpacity:this.strokeOpacity,
strokeThickness:this.strokeThickness},"LineString"===cb)b.shape=c.drawPath(Wa,jb,Sa);else{Pa=c.createGroup();Sa.group.appendChild(Pa);Sa.group=Pa;cb=0;for(Ya=Wa.length;cb<Ya;cb++)c.drawPath(Wa[cb],jb,Sa);b.shape=Pa}else if(this.createStyle(c),jb={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,fill:this.fill,fillOpacity:this.fillOpacity,strokeDashArray:this.strokeDash},"Point"===cb||"OrientedPoint"===cb||"MultiPoint"===cb||"OrientedMultiPoint"===cb)if(Ya=a.gv.defaultMarkerStyleWidth,
Pa=a.gv.defaultMarkerStyleHeight,jb=[{shape:{type:"circle",cx:Ya/2,cy:Pa/2,width:Ya,height:Pa,scaleX:1,scaleY:1},style:jb}],"MultiPoint"===cb||"OrientedMultiPoint"===cb){Pa=c.createGroup();Sa.group.appendChild(Pa);Sa.group=Pa;cb=0;for(Ya=Wa.length;cb<Ya;cb++)c.drawVectorMarker({x:Wa[cb].x,y:Wa[cb].y},jb,Sa);b.shape=Pa}else b.shape=c.drawVectorMarker({x:Wa.x,y:Wa.y},jb,Sa);else if(Wa&&0!==Wa.length)if("Rectangle"===cb)b.shape=c.drawRectangle(Wa,jb,Sa);else if("Polygon"===cb)b.shape=c.drawPath(Wa,jb,
Sa);else if("MultiPolygon"===cb){cb=c.createGroup();Sa.group.appendChild(cb);Sa.group=cb;Ya=0;for(Pa=Wa.length;Ya<Pa;Ya++)c.drawPath(Wa[Ya],jb,Sa);b.shape=cb}},getBindables:function(){return["StartColor","EndColor"]},resolve:function(b){var c,Sa;if(!this.bindings||0===this.bindings.length)return Sa=this.stops1.length,this.stops1[0].color===this.origConfig.stops[0].color&&this.stops1[Sa-1].color===this.origConfig.stops[Sa-1].color||this.copyOrigStops(),this;c=0;for(Sa=this.bindings.length;c<Sa;c++){var Wa=
this.bindings[c],cb=this.resolveBinding(Wa,b);"STARTCOLOR"===Wa.attribute?a.notNull(cb)&&a.util.ValidationUtil.getColor(cb)?this.stops1[0].color=cb:this.stops1[0].color=this.origConfig.stops[0].color:"ENDCOLOR"===Wa.attribute&&(a.notNull(cb)&&a.util.ValidationUtil.getColor(cb)?(Sa=this.stops1.length,this.stops1[Sa-1].color=cb):(Sa=this.origConfig.stops.length,this.origConfig.stops[Sa-1].color=cb))}return this}});a.style.LinearGradient=a.style.Gradient.extend({initialize:function Ia(a){a.styleType=
"LinearGradient";Ia.base.call(this,a);this.x1=a.x1||0;this.y1=a.y1||0;this.x2=a.x2||0;this.y2=a.y2||0},createStyle:function(a){this.createGradientStop(a);this.fill=new a.oui.style.LinearGradient({x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,stops:this.stops})}});a.style.Color=a.style.Style.extend({initialize:function Sa(b){b=b||{};b.styleType="Color";Sa.base.call(this,b);var c=a.util.ValidationUtil.getColor;this.stroke=a.notNull(b.stroke)&&c(b.stroke)?c(b.stroke):a.PaintTypes.NO_PAINT;this.strokeOpacity=
a.notNull(b.strokeOpacity)?b.strokeOpacity:1;this.strokeThickness=a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):1;this.strokeDash=a.notNull(b.strokeDash)?b.strokeDash:[];this.fill=a.notNull(b.fill)&&c(b.fill)?c(b.fill):a.PaintTypes.NO_PAINT;this.fillOpacity=a.notNull(b.fillOpacity)?b.fillOpacity:1;this.gradient=b.gradient||"off";this.outlineStroke=a.notNull(b.outlineStroke)&&c(b.outlineStroke)?c(b.outlineStroke):null;this.outlineStrokeThickness=a.notNull(b.outlineStrokeThickness)?parseFloat(b.outlineStrokeThickness):
1;this.fill===a.PaintTypes.NO_PAINT?(this.fillOpacity=0,this.noNativeFill=!0):this.noNativeFill=!1;a.notNull(b.stroke)&&(b.stroke=c(b.stroke));a.notNull(b.outlineStroke)&&(b.outlineStroke=c(b.outlineStroke));a.notNull(b.fill)&&(b.fill=c(b.fill))},resolve:function(b){if(!this.bindings||0===this.bindings.length)return this;for(var c=0,cb=this.bindings.length;c<cb;c++){var jb=this.bindings[c],Ya=this.resolveBinding(jb,b);"FILL"===jb.attribute?(this.fill=Ya,Ya&&a.util.ValidationUtil.getColor(Ya))?this.noNativeFill&&
0===this.fillOpacity&&(this.fillOpacity=1):this.fillOpacity=0:"STROKE"===jb.attribute?(this.stroke=Ya,Ya&&a.util.ValidationUtil.getColor(Ya)||(this.stroke=a.PaintTypes.NO_PAINT)):"STROKETHICKNESS"===jb.attribute&&(this.strokeThickness=Number(Ya),isNaN(Ya))}return this},draw:function(b,c,cb){this.resolve(b,Pa);var jb=b.geo,Ya=cb.type?cb.type:jb.type,Pa=c.getGraphics();"off"===this.gradient||0===this.fillOpacity||this.fill instanceof Pa.oui.style.LinearGradient||(this.fill=new Pa.oui.style.LinearGradient({x1:0,
y1:0,x2:1,y2:1,stops:[new Pa.oui.style.GradientStop({offset:0,color:"#eeffffff"}),new Pa.oui.style.GradientStop({offset:1,color:this.fill})]}));var Xa,gb;cb.screenPoints?c=cb.screenPoints:(b.screenPoints||b.transformGeometry(jb),c=b.screenPoints);if("Point"===Ya||"OrientedPoint"===Ya||"MultiPoint"===Ya||"OrientedMultiPoint"===Ya){var eb=a.gv.defaultMarkerStyleWidth;Xa=a.gv.defaultMarkerStyleHeight;jb=[{shape:{type:"circle",cx:eb/2,cy:Xa/2,width:eb,height:Xa,scaleX:1,scaleY:1},style:this}];cb.width=
eb;cb.height=Xa;if("MultiPoint"===Ya||"OrientedMultiPoint"===Ya){Ya=Pa.createGroup();cb.group.appendChild(Ya);cb.group=Ya;Xa=0;for(gb=c.length;Xa<gb;Xa++)Pa.drawVectorMarker({x:c[Xa].x,y:c[Xa].y},jb,cb);b.shape=Ya}else b.shape=Pa.drawVectorMarker({x:c.x,y:c.y},jb,cb)}else if(c&&0!==c.length)if(jb={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,strokeDashArray:this.strokeDash,fill:this.fill,fillOpacity:this.fillOpacity},eb=null,a.notNull(this.outlineStroke)&&
(eb={stroke:this.outlineStroke,strokeThickness:2*this.outlineStrokeThickness+this.strokeThickness,fill:this.fill,fillOpacity:this.fillOpacity}),"LineString"===Ya||"MultiLineString"===Ya?(jb.stroke||(jb.stroke=jb.fill?jb.fill:"#000000"),jb.fill=null):jb.fill===a.PaintTypes.NO_PAINT&&(jb.fill="#ffffff",jb.fillOpacity=0),"LineString"===Ya||"Polygon"===Ya||"Rectangle"===Ya)Xa=Pa.drawPath,"Rectangle"===Ya&&(Xa=Pa.drawRectangle),a.isNull(eb)?b.shape=Xa.call(Pa,c,jb,cb):(Ya=Pa.createGroup(),cb.group.appendChild(Ya),
cb.group=Ya,Xa.call(Pa,c,eb,cb),Xa.call(Pa,c,jb,cb),b.shape=Ya);else if("MultiLineString"===Ya||"MultiPolygon"===Ya){Ya=Pa.createGroup();cb.group.appendChild(Ya);cb.group=Ya;Xa=0;for(gb=c.length;Xa<gb;Xa++)a.notNull(eb)&&Pa.drawPath(c[Xa],eb,cb),Pa.drawPath(c[Xa],jb,cb);b.shape=Ya}},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=["Fill","Stroke","StrokeThickness"]},toXMLString:function(){var b;b=""+('\x3cstyle name\x3d"'+this.getStyleName()+'"\x3e');b=b+'\x3cg class\x3d"color" style\x3d"'+
(a.notNull(this.stroke)?"stroke:"+this.stroke+";":"");b+=a.notNull(this.strokeOpacity)?"stroke-opacity:"+Math.min(Math.round(255*this.strokeOpacity),255)+";":"";b+=a.notNull(this.fill)?"fill:"+this.fill+";":"";b+=a.notNull(this.fillOpacity)?"fill-opacity:"+Math.min(Math.round(255*this.fillOpacity),255)+";":"";return b+='"\x3e\x3c/g\x3e\x3c/style\x3e'}});a.style.Bucket=a.Class.extend({initialize:function(a){this.seq=a.seq||0;a.label&&(this.label=a.label);a.labelStyle&&(this.labelStyle=a.labelStyle)},
evaluate:function(){return!1},clone:function(){return a.$.extend(!0,{},this)}});a.style.RangedBucket=a.style.Bucket.extend({initialize:function Wa(b){Wa.base.call(this,b);this.low=a.notNull(b.low)?b.low:Number.NEGATIVE_INFINITY;this.high=a.notNull(b.high)?b.high:Number.POSITIVE_INFINITY;this.includeHighValue=a.notNull(b.includeHighValue)?b.includeHighValue:!1},evaluate:function(b){if(a.isNull(b))return!1;a.$.isArray(b)&&(b=b[0]);return this.includeHighValue?b>=this.low&&b<=this.high:b>=this.low&&
b<this.high},setIncludeHighValue:function(a){this.includeHighValue=a},toXMLString:function(){var b;b="\x3cRangedBucket"+(a.isNull(this.seq)?"":' seq\x3d"'+this.seq+'"');b+=a.isNull(this.label)?"":' label\x3d"'+this.label+'"';b+=a.isNull(this.labelStyle)?"":' label_style\x3d"'+this.label+'"';b+=a.isNull(this.low)?"":' low\x3d"'+this.low+'"';b+=a.isNull(this.high)?"":' high\x3d"'+this.high+'"';return b+"/\x3e"}});a.style.CollectionBucket=a.style.Bucket.extend({initialize:function cb(a){cb.base.call(this,
a);this.keepWhiteSpace=a.keepWhiteSpace||!1;this.dataType=a.dataType||"string";this.values=a.values||[]},evaluate:function(b){var c=this.values.length;if(a.isNull(b)||0===c)return!1;a.$.isArray(b)&&(b=b[0]);for(var Ya=0;Ya<c;Ya++)if(this.values[Ya]==b)return!0;return!1},toXMLString:function(b){var c;c="\x3cCollectionBucket"+(a.isNull(this.seq)?"":' seq\x3d"'+this.seq+'"');c+=a.isNull(this.dataType)?"":' type\x3d"'+this.dataType+'"';c+=a.isNull(this.keep_white_space)||!0!==this.keep_white_space?"":
' keep_white_space\x3d""true"';c+=a.isNull(b)?"":' style\x3d"'+b+'"';b="";for(var Ya=0,Pa=this.values.length;Ya<Pa;Ya++)b+=this.values[Ya],Ya<Pa-1&&(b+=",");c=c+"\x3e"+b;return c+="\x3c/CollectionBucket\x3e"}});a.style.BucketStyle=a.style.Style.extend({initialize:function jb(c){function Pa(b){var Ma=gb.length+1;gb[Ma-1]=b;Ma===Xa&&(eb.styles=gb,"off"!==eb.gradient&&gb[0]instanceof a.style.Color&&eb.createGradients())}c=c||{};c.styleType=c.styleType||"BucketStyle";jb.base.call(this,c);c.style&&c.buckets&&
c.style!==c.buckets&&a.util.Logger.warning("MAPVIEWER_9030","OM.style.BucketStyle","");this.styles=c.styles||[];0===this.styles.length&&"ColorScheme"!==c.styleType&&"VariableMarker"!==c.styleType&&a.util.Logger.warning("MAPVIEWER_9029","OM.style.BucketStyle","");this.gradient=c.gradient||"off";var Xa=this.styles.length,gb=[],eb=this;if(0!==Xa&&this.styles[0]instanceof a.style.Style)"off"!==this.gradient&&this.styles[0]instanceof a.style.Color&&this.createGradients();else for(var sb=0;sb<Xa;sb++)a.style.StyleStore.getServerSideStyle(this.styles[sb].dataSource,
this.styles[sb].style,{url:this.styles[sb].url,callback:Pa});this.numClasses=c.numClasses||5;this.defaultStyle=c.defaultStyle||null;this.buckets=c.buckets||[];c.classification||c.low===b||c.high===b||(this.buckets=this.createEqualBuckets(c.high,c.low));this.classification=c.classification||"equal";0<this.buckets.length&&"custom"!==this.classification&&(a.util.Logger.info("MAPVIEWER_9028","OM.style.BucketStyle",""),this.classification="custom");this.algorithm=c.algorithm||null;this.effects=c.effects||
null;this.isNumeric="undefined"===typeof c.isNumeric?!0:c.isNumeric;this.gradient=c.gradient||"off";this.checkRangedBuckets()},resolve:function(b){var c=b.parentLayer.styleAttributes;this.generateBuckets(b.parentLayer.featureArray,c,!1);var Pa=b.attributes;if(Pa){var Xa=null,gb=a.notNull(c)?c.length:0;if(0<gb){Xa=Pa[c[0].toUpperCase()];if(1<gb)for(Xa=[Xa],b=1;b<gb;b++)Xa.push(Pa[c[b].toUpperCase()]);return this.getRealStyle(Xa)}if(b.columns)return Xa=Pa[b.columns[0].toUpperCase()],this.getRealStyle(Xa)}return null},
draw:function(a,b,c){var Xa=this.resolve(a);Xa&&Xa.draw(a,b,c)},generateBuckets:function(b,c,Pa){this.buckets&&0<this.buckets.length&&(!Pa||this.buckets[0]instanceof a.style.CollectionBucket)||!b||0===b.length||!(c=c||b[0].columns)||(c=c instanceof Array?c[0]:c,c=c.toUpperCase(),"equal"===this.classification?this.buckets=this.equalRangeMethod(b,c):"quantile"===this.classification||"quantiles"===this.classification?this.buckets=this.quantilesMethod(b,c):"logarithmic"===this.classification?this.buckets=
this.logarithmicMethod(b,c):this.algorithm?this.buckets=this.algorithm.call(this,b,c,this.numClasses):"custom"===this.classification?a.isNull(this.buckets)&&a.util.Logger.warning("MAPVIEWER_9096","OM.style.BucketStyle",""):(a.util.Logger.warning("MAPVIEWER_9026","OM.style.BucketStyle",""),this.buckets=[]),this.checkRangedBuckets())},checkRangedBuckets:function(){var b=this.buckets;if(!(a.isNull(b)||0===b.length||b[0]instanceof a.style.CollectionBucket)){for(var c=-1,Pa,Xa=Number.NEGATIVE_INFINITY,
gb=0;gb<b.length;gb++)Pa=b[gb].high,a.notNull(Pa)&&Pa>Xa&&(Xa=Pa,c=gb);b[c].setIncludeHighValue(!0)}},getDefaultStyle:function(){return this.defaultStyle},setDefaultStyle:function(a){this.defaultStyle=a},getRealStyle:function(a){if(typeof a===b||null===a)return this.defaultStyle;var c=this.buckets,Pa=this.buckets.length;if(c&&0<Pa)for(var Xa=0;Xa<Pa;Xa++)if(c[Xa].evaluate(a))return this.styles[Xa];return this.defaultStyle},logarithmicMethod:function(a,b){var c=this.getMinMaxValues(a,b);return this.createLogarithmicBuckets(c.max,
c.min)},getMinMaxValues:function(b,c){if("_NUMBERINCLUSTER"===c)return this.getMinMaxNumbers(b);for(var Pa=null,Xa=null,gb=b.length,eb,sb=a.util.ValidationUtil.isNumber2,Bb=0;Bb<gb;Bb++)if((eb=b[Bb])&&eb.attributes&&"undefined"!==typeof eb.attributes[c]&&(eb=eb.attributes[c],a.notNull(eb))){this.isNumeric&&!sb(eb)&&(eb=Number(eb));if(a.isNull(Pa)||Pa>eb)Pa=eb;if(a.isNull(Xa)||eb>Xa)Xa=eb}return{min:Pa,max:Xa}},getMinMaxNumbers:function(a){return{min:a[0],max:a[1]}},equalRangeMethod:function(a,b){var c=
this.getMinMaxValues(a,b);return this.createEqualBuckets(c.max,c.min)},createEqualBuckets:function(b,c){for(var Pa=[],Xa=(b-c)/this.numClasses,gb=c,eb=1;eb<=this.numClasses;eb++)Pa[eb-1]=new a.style.RangedBucket({low:gb,high:gb+Xa}),gb+=Xa;Pa[this.numClasses-1].high++;return Pa},createLogarithmicBuckets:function(b,c){for(var Pa=[],Xa=c,gb=Math.log(c),eb=(Math.log(b)-gb)/this.numClasses,sb=1;sb<=this.numClasses;sb++){var Bb=Math.exp(gb+eb*sb);Pa[sb-1]=new a.style.RangedBucket({low:Xa,high:Bb});Xa=
Bb}Pa[this.numClasses-1].high++;return Pa},quantilesMethod:function(){return[]},createGradients:function(){for(var b=this.styles,c,Pa=[],Xa=0;Xa<b.length;Xa++)c=b[Xa],Pa.push(new a.style.LinearGradient({stops:[{offset:0,color:"#eeffffff"},{offset:1,color:c.fill}],x1:0,y1:0,x2:1,y2:1,stroke:c.stroke,fillOpacity:c.fillOpacity,strokeOpacity:c.strokeOpacity}));this.styles=Pa},clearBuckets:function(){if("equal"===this.classification||"quantile"===this.classification||"quantiles"===this.classification||
"logarithmic"===this.classification||this.algorithm)this.buckets=[]},toXMLString_substyles:function(){for(var b="",c="",c=null,Pa=0,Xa=this.styles.length;Pa<Xa;Pa+=1)c=this.styles[Pa],c=a.isNull(c)?"":c.toXMLString(),a.isNull(c)||(b+=c);c=this.defaultStyle;a.notNull(c)&&!this.hasStyle(c)&&(c=c.toXMLString(),b+=c);return b},hasStyle:function(b){for(var c=0,Pa=this.styles.length;c<Pa;c+=1){var Xa=this.styles[c];if(!a.isNull(Xa)&&a.notNull(b.styleName)&&a.notNull(Xa.styleName)&&b.styleName.toUpperCase()===
Xa.styleName.toUpperCase())return!0}return!1},toXMLString_adv:function(){var b="",b="";this.buckets.length!==this.styles.length&&a.util.Logger.warning("","OM.style.BucketStyle","Number of buckets and styles do not match");for(var c=Math.min(this.buckets.length,this.styles.length),b="\x3cBuckets"+(a.notNull(this.defaultStyle)?' default_style\x3d"'+this.defaultStyle.getStyleName()+'"':""),b=b+"\x3e",Pa=null,Xa=null,gb="",Pa=Pa="",eb=0;eb<c;eb+=1)Pa=this.buckets[eb],Xa=this.styles[eb],Pa instanceof a.style.CollectionBucket?
Pa=gb=a.isNull(Pa)?"":Pa.toXMLString(Xa.getStyleName()):(gb=a.isNull(Pa)?"":Pa.toXMLString(),Pa=a.isNull(Pa)?"":Xa.getStyleName(),Pa=gb.substring(0,gb.length-2)+' style\x3d"'+Pa+'"/\x3e'),a.isNull(gb)||(b+=Pa);return b='\x3cstyle name\x3d"'+this.styleName+'"\x3e\x3cAdvancedStyle\x3e\x3cBucketStyle\x3e'+(b+"\x3c/Buckets\x3e")+"\x3c/BucketStyle\x3e\x3c/AdvancedStyle\x3e\x3c/style\x3e"},toXMLString:function(){var a=this.toXMLString_adv();return this.toXMLString_substyles()+a}});a.style.ColorScheme=a.style.BucketStyle.extend({initialize:function Ya(b){b.styleType=
"ColorScheme";Ya.base.call(this,b);this.baseColor=a.notNull(b.baseColor)?b.baseColor:null;this.fromColor=a.notNull(b.fromColor)?b.fromColor:null;this.toColor=a.notNull(b.toColor)?b.toColor:null;this.fillOpacity=a.notNull(b.fillOpacity)?b.fillOpacity:1;this.stroke=a.notNull(b.stroke)?b.stroke:null;this.strokeOpacity=a.notNull(b.strokeOpacity)?b.strokeOpacity:1;this.strokeThickness=a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):1;this.calculateColorStops()},calculateColorStops:function(){this.styles&&
0<this.styles.length||(this.fromColor&&this.toColor?this.calculateMultiHueStops():this.baseColor?this.calculateSingleHueStops():a.util.Logger.warning("MAPVIEWER_9025","OM.style.ColorScheme.calculateColorStops",""))},calculateSingleHueStops:function(){for(var b=a.style.ColorScheme.rgbStringParse(this.baseColor),b=a.style.Style.rgbToHsv(b),c=b.v/this.numClasses,Xa=0;Xa<this.numClasses;Xa++){var gb=a.style.Style.hsvToRgb({h:b.h,s:b.s,v:b.v-Xa*c}),eb=gb.r.toString(16);2!==eb.length&&(eb="0"+eb);var sb=
gb.g.toString(16);2!==sb.length&&(sb="0"+sb);gb=gb.b.toString(16);2!==gb.length&&(gb="0"+gb);eb=new a.style.Color({fill:"#"+eb+sb+gb,fillOpacity:this.fillOpacity,stroke:this.stroke,strokeThickness:this.strokeThickness,strokeOpacity:this.strokeOpacity});this.styles.push(eb)}},calculateMultiHueStops:function(){for(var b=a.style.ColorScheme,c=b.rgbStringParse(this.fromColor),Xa=a.style.Style.rgbToHsv(c),c=b.rgbStringParse(this.toColor),gb=a.style.Style.rgbToHsv(c),b=(gb.h-Xa.h)/this.numClasses,c=(gb.s-
Xa.s)/this.numClasses,gb=(gb.v-Xa.v)/this.numClasses,eb=0;eb<this.numClasses;eb++){var sb=a.style.Style.hsvToRgb({h:Xa.h+b*eb,s:Xa.s+c*eb,v:Xa.v+gb*eb}),Bb=sb.r.toString(16);2!==Bb.length&&(Bb="0"+Bb);var Ma=sb.g.toString(16);2!==Ma.length&&(Ma="0"+Ma);sb=sb.b.toString(16);2!==sb.length&&(sb="0"+sb);Bb=new a.style.Color({fill:"#"+Bb+Ma+sb,fillOpacity:this.fillOpacity,stroke:this.stroke,strokeThickness:this.strokeThickness,strokeOpacity:this.strokeOpacity});this.styles.push(Bb)}},getColorStops:function(){var a=
[];if(!this.styles)return a;for(var b=this.styles.length,c=0;c<b;c++)a.push(this.styles[c].fill);return a}});a.style.ColorScheme.rgbStringParse=function(b){var c={};b=a.$.trim(b);c.r=parseInt(b[1]+b[2],16);c.g=parseInt(b[3]+b[4],16);c.b=parseInt(b[5]+b[6],16);return c};a.style.HeatMap=a.style.Style.extend({initialize:function Pa(b){b=b||{};b.styleType="HeatMap";Pa.base.call(this,b);this.colorStops=a.notNull(b.colorStops)?b.colorStops:null;this.opacity=a.notNull(b.opacity)?b.opacity:1;this.containerVectorLayer=
a.notNull(b.containerVectorLayer)?b.containerVectorLayer:null;this.lengthUnit=a.notNull(b.lengthUnit)?b.lengthUnit:"pixel";"pixel"===this.lengthUnit?this.spotlightRadius=a.notNull(b.spotlightRadius)?b.spotlightRadius:5:this.unitSpotlightRadius=a.notNull(b.spotlightRadius)?b.spotlightRadius:5;this.maxValue=a.notNull(b.maxValue)?b.maxValue:null;this.minValue=a.notNull(b.minValue)?b.minValue:null;this.sampleFactor=a.notNull(b.sampleFactor)?b.sampleFactor:2;this.isTop=a.notNull(b.isTop)?b.isTop:!1},getBindables:function(){return this.bindableAttrs?
this.bindableAttrs:this.bindableAttrs=["Heat"]},getDataValueFromBinding:function(a){return this.bindings&&0!==this.bindings.length?this.resolveDataValue(this.bindings[0],a):null},getIsTop:function(){return this.isTop},setIsTop:function(a){this.isTop=a}});a.style.RadialGradient=a.style.Gradient.extend({initialize:function Xa(a){a=a||{};a.styleType="RadialGradient";Xa.base.call(this,a);this.cx=a.cx||0;this.cy=a.cy||0;this.radius=a.radius||0},createStyle:function(a){this.createGradientStop(a);this.fill=
new a.oui.style.RadialGradient({cx:this.cx,cy:this.cy,radius:this.radius,stops:this.stops})}});a.style.PieSlice=function(a,b){this.name=a;this.color=b};a.style.PieChart=a.style.Style.extend({initialize:function gb(b){b.styleType="PieChart";if(b&&b.pieSlices&&!(1>b.pieSlices.length)){gb.base.call(this,b);var c=b.pieSlices.length;this.colors=[];this.names=[];for(var Bb=0;Bb<c;Bb++){var Ma=b.pieSlices[Bb];this.colors.push(Ma.color);this.names.push(Ma.name)}this.stroke=a.notNull(b.stroke)?b.stroke:"#000000";
this.strokeThickness=a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):1;this.startingAngle=a.notNull(b.startingAngle)?parseFloat(b.startingAngle):0;this.direction=a.notNull(b.direction)?b.direction:"CCW";this.radius=a.notNull(b.radius)?b.radius:50;this.width=2*this.radius;this.height=2*this.radius;this.lengthUnit=a.notNull(b.lengthUnit)?b.lengthUnit:"pixel";this.enableHighlight=b.enableHighlight?b.enableHighlight:!1;this.maxlength=b.radiusPixelRange&&b.radiusPixelRange.max?2*b.radiusPixelRange.max:
5E3;this.minlength=b.radiusPixelRange&&b.radiusPixelRange.min?2*b.radiusPixelRange.min:0;this.showOnPoint=1}},resolve:function(a){if(!this.bindings||0===this.bindings.length)return this;for(var b=0,c=this.bindings.length;b<c;b++){var Bb=this.bindings[b],Ma=this.resolveBinding(Bb,a);"RADIUS"===Bb.attribute?(this.radius=Ma,this.width=2*this.radius,this.height=2*this.radius):"SIZE"===Bb.attribute&&(this.radius=Ma/2,this.height=this.width=Ma)}return this},draw:function(b,c,sb){if(b.attributes){this.resolve(b);
var Bb=c.getGraphics(),Ma=sb.sPoint,Hb=this.colors,fa=this.names;if(fa&&!(1>fa.length)){for(var ga=fa.length,ma=Array(ga),ya=0;ya<ga;ya++){var ka=b.getAttributeValue(fa[ya]);if(a.notNull(ka))ma[ya]=parseFloat(ka);else return}a.style.Style.calculateStyleSize(this,c);c={cx:Ma.x,cy:Ma.y,width:this.realWidth,height:this.realHeight};sb.stroke=this.stroke;sb.strokeThickness=this.strokeThickness;this.enableHighlight&&(sb.plugable=!0,sb.description=fa);sb.offsetAngle=this.startingAngle;sb.orientation="CW"===
this.direction?2:1;b.shape=Bb.drawPieChart(c,ma,Hb,sb)}}},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=["Radius","Size"]}});a.style.VariableMarker=a.style.BucketStyle.extend({initialize:function eb(b){b.styleType="VariableMarker";eb.base.call(this,b);this.marker=a.notNull(b.marker)?b.marker:null;this.startSize=a.notNull(b.startSize)?b.startSize:7;this.increament=a.notNull(b.increment)?b.increment:3;this.createAllMarkerStyles()},createAllMarkerStyles:function(){if(!(this.styles&&
0<this.styles.length))if(this.marker instanceof a.style.Marker){this.styles=[];for(var b=0;b<this.numClasses;b++){var c=this.marker.clone();c.width=this.startSize+this.increament*b;c.height=c.width;c.calculateVectorMarkerScale();this.styles.push(c)}}else a.util.Logger.warning("MAPVIEWER_9024",a.style.VariableMarker.createAllMarkerStyles,"")}});a.style.Bar=function(a,b){this.name=a;this.color=b};a.style.BarChart=a.style.Style.extend({initialize:function sb(b){b.styleType="BarChart";if(b&&b.bars&&!(1>
b.bars.length)){sb.base.call(this,b);var Ma=b.bars.length;this.colors=[];this.names=[];for(var Hb=0;Hb<Ma;Hb++){var c=b.bars[Hb];this.colors.push(c.color);this.names.push(c.name)}this.stroke=a.notNull(b.stroke)?b.stroke:"#000000";this.strokeThickness=a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):1;this.showXAxis=a.notNull(b.showXAxis)?b.showXAxis:!1;this.showYAxis=a.notNull(b.showYAxis)?b.showYAxis:!1;this.backGround=a.notNull(b.background)?b.background:null;this.width=a.notNull(b.width)?
parseFloat((""+b.width).replace(/[^\d.]/g,"")):100;this.height=a.notNull(b.height)?parseFloat((""+b.height).replace(/[^\d.]/g,"")):100;a.isNull(b.lengthUnit)?this.lengthUnit=a.notNull(b.width)?(""+b.width).replace(/[0-9.]/g,""):"pixel":this.lengthUnit=b.lengthUnit;if(a.isNull(this.lengthUnit)||0===this.lengthUnit.length)this.lengthUnit="pixel";this.enableHighlight=a.notNull(b.enableHighlight)?b.enableHighlight:!1;this.maxlength=b.lengthPixelRange&&b.lengthPixelRange.max?b.lengthPixelRange.max:5E3;
this.minlength=b.lengthPixelRange&&b.lengthPixelRange.min?b.lengthPixelRange.min:0;this.showOnPoint=1}},resolve:function(a){if(!this.bindings||0===this.bindings.length)return this;for(var b=0,Ma=this.bindings.length;b<Ma;b++){var Hb=this.bindings[b],c=this.resolveBinding(Hb,a);"SIZE"===Hb.attribute?this.origConfig.width&&this.origConfig.height&&this.origConfig.width!==this.origConfig.height?(this.height=this.origConfig.height*c/this.origConfig.width,this.width=c):this.height=this.width=c:"WIDTH"===
Hb.attribute?this.width=c:"HEIGHT"===Hb.attribute&&(this.height=c)}return this},draw:function(b,c,Ma){this.resolve(b);if(b.attributes){var Hb=c.getGraphics(),fa=Ma.sPoint,ga=this.colors,ma=this.names;if(ma&&!(1>ma.length)){for(var ya=ma.length,ka=Array(ya),za=0;za<ya;za++){var Ca=b.getAttributeValue(ma[za]);if(a.notNull(Ca))ka[za]=parseFloat(Ca);else return}a.style.Style.calculateStyleSize(this,c);c={cx:fa.x,cy:fa.y,width:this.realWidth,height:this.realHeight};Ma.stroke=this.stroke;Ma.strokeThickness=
this.strokeThickness;this.enableHighlight&&(Ma.plugable=!0,Ma.description=ma);b.shape=Hb.drawBarChart(c,ka,ga,Ma)}}},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=["Size","Width","Height"]}});a.style.Line=a.style.Style.extend({initialize:function Bb(b){b=b||{};b.styleType="Line";Bb.base.call(this,b);var c=a.util.ValidationUtil.getColor,fa=a.PaintTypes.NO_PAINT;this.stroke=b.stroke&&c(b.stroke)?c(b.stroke):a.PaintTypes.NO_PAINT;this.strokeOpacity=a.notNull(b.strokeOpacity)?
parseFloat(b.strokeOpacity):1;this.strokeDash=b.strokeDash||[];this.strokeLineCap=b.strokeLineCap||a.LineCaps.ROUND;this.strokeLineJoin=b.strokeLineJoin||a.LineJoins.ROUND;this.fill=a.notNull(b.fill)&&c(b.fill)?c(b.fill):fa;this.fillOpacity=a.notNull(b.fillOpacity)?parseFloat(b.fillOpacity):1;this.centerLine=a.notNull(b.centerLine)&&c(b.centerLine)?c(b.centerLine):fa;this.markerPattern=b.markerPattern||null;a.notNull(b.startMarker)&&(b.startMarker.vectorDef&&b.startMarker.getFNFormat()?this.markerStart=
b.startMarker.getFNFormat():b.startMarker.d?this.markerStart=b.startMarker:this.startMarker=b?b.startMarker:null);a.notNull(b.endMarker)&&(b.endMarker.vectorDef&&b.endMarker.getFNFormat()?this.markerEnd=b.endMarker.getFNFormat():b.endMarker.d?this.markerEnd=b.endMarker:this.endMarker=b?b.endMarker:null);this.oriented=b?b.orientedMarker:!1;this.centerLineDash=b.centerLineDash||[];this.cased=!1;this.lengthUnit=b.lengthUnit?b.lengthUnit:"pixel";"pixel"===this.lengthUnit?(this.fillWidth=b&&a.notNull(b.fillWidth)&&
this.fill!==fa?parseFloat(b.fillWidth):0,this.centerLineWidth=b&&a.notNull(b.centerLineWidth)&&this.centerLine!==fa?parseFloat(b.centerLineWidth):0,this.strokeThickness=b&&a.notNull(b.strokeThickness)&&this.stroke!==fa?parseFloat(b.strokeThickness):1):(this.unitFillWidth=b&&a.notNull(b.fillWidth)&&this.fill!==fa?parseFloat(b.fillWidth):0,this.unitCenterLineWidth=b&&a.notNull(b.centerLineWidth)&&this.centerLine!==fa?parseFloat(b.centerLineWidth):0,this.unitStrokeThickness=b&&a.notNull(b.strokeThickness)&&
this.stroke!==fa?parseFloat(b.strokeThickness):1);this.calculateRealSize()},calculateRealSize:function(){var b=null;this.stylelist=[];var Ma=a.PaintTypes.NO_PAINT;this.stroke!==Ma&&0<this.strokeThickness&&(b={stroke:this.stroke,strokeThickness:0<this.fillWidth?2*this.strokeThickness+this.fillWidth:this.strokeThickness,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDash,strokeOpacity:this.strokeOpacity},this.markerStart&&(b.markerStart=this.markerStart),
this.markerEnd&&(b.markerEnd=this.markerEnd),this.stylelist.push(b));this.fill!==Ma&&0<this.fillWidth&&(b={stroke:this.fill,strokeThickness:this.fillWidth,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDash,strokeOpacity:this.fillOpacity},this.markerStart&&(b.markerStart=this.markerStart),this.markerEnd&&(b.markerEnd=this.markerEnd),this.stylelist.push(b));this.centerLine!==Ma&&0<this.centerLineWidth&&(0===this.fillWidth||this.fill!==this.centerLine)&&
(b={stroke:this.centerLine,strokeThickness:this.centerLineWidth,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.centerLineDash},this.stylelist.push(b));(this.startMarker||this.endMarker)&&this.stylelist.push({})},resolve:function(a){if(!this.bindings||0===this.bindings.length)return this;for(var b=0,c=this.bindings.length;b<c;b++){var fa=this.bindings[b],ga=this.resolveBinding(fa,a);"FILL"===fa.attribute?this.fill=ga:"FILLWIDTH"===fa.attribute&&(this.fillWidth=
ga)}this.calculateRealSize();return this},draw:function(b,Ma,c){this.resolve(b);var fa=this.origConfig;a.notNull(fa.startMarker)&&fa.startMarker.vectorDef&&fa.startMarker.getFNFormat&&(this.markerStart=fa.startMarker.getFNFormat(b));a.notNull(fa.endMarker)&&fa.endMarker.vectorDef&&fa.endMarker.getFNFormat&&(this.markerEnd=fa.endMarker.getFNFormat(b));var ga=b.geo,fa=c.type?c.type:ga.type;if("Point"!==fa&&"OrientedPoint"!==fa&&"MultiPoint"!==fa&&"OrientedMultiPoint"!==fa){var ma=Ma.getGraphics();c.screenPoints?
ga=c.screenPoints:(b.screenPoints||b.transformGeometry(ga),ga=b.screenPoints);if(ga&&0!==ga.length){var ya,ka;a.style.Style.calculateStyleSize(this,Ma);if("LineString"===fa||"Polygon"===fa)this.drawLine(Ma,ga,c.group,"Polygon"===fa,b);else if("Rectangle"===fa)this.drawLine(Ma,[[ga.x,ga.y,ga.x+ga.width,ga.y,ga.x+ga.width,ga.y+ga.height,ga.x,ga.y+ga.height,ga.x,ga.y]],c.group,!0,b);else if("MultiLineString"===fa||"MultiPolygon"===fa){if(this.cased){ya=[];ka=c.group.length;for(var za=0;za<ka;za++)ya[za]=
ma.createGroup(),c.group[za].appendChild(ya[za])}else ya=ma.createGroup(),c.group.appendChild(ya);ka=ga.length;for(c=0;c<ka;c++)this.drawLine(Ma,ga[c],ya,"MultiPolygon"===fa,b);b.shapeGroup=ya}b.shapeGroup&&0<b.shapeGroup.length?(b.shape=b.shapeGroup[0],1===b.shapeGroup.length&&(b.shapeGroup=null)):(b.shape=b.shapeGroup,b.shapeGroup=null)}}},drawLine:function(b,Ma,c,fa,ga){var ma=this.stylelist,ya=ma.length,ka={group:c},za=b.getGraphics();ga.shapeGroup=[];for(var Ca=0;Ca<ya;Ca++){var Oa=ma[Ca];Oa.stroke&&
(this.cased&&(ka.group=c[Ca]),Oa={stroke:Oa.stroke,strokeThickness:Oa.strokeThickness,strokeLineCap:Oa.strokeLineCap,strokeDashArray:Oa.strokeDashArray,strokeOpacity:Oa.strokeOpacity,markerStart:Oa.markerStart,markerEnd:Oa.markerEnd},fa&&(Oa.fill=a.PaintTypes.NO_PAINT,Oa.fillOpacity=0),ga.shapeGroup.push(za.drawPath(Ma,Oa,ka)))}c=c.length?c[Ca-1]:c;this.startMarker&&!this.markerStart&&(ya={x:Ma[0][0],y:Ma[0][1]},ma={group:c,markerPoint:ya},this.oriented&&(fa=Ma[0][0]-Ma[0][2],ka=Ma[0][3]-Ma[0][1],
ya.angle=-Math.atan2(ka,fa)),this.startMarker.draw(ga,b,ma));this.endMarker&&!this.markerEnd&&(ka=Ma[0].length,ya={x:Ma[0][ka-2],y:Ma[0][ka-1]},ma={group:c,markerPoint:ya},Ma.oriented&&(fa=Ma[0][ka-4]-Ma[0][ka-2],ka=Ma[0][ka-1]-Ma[0][ka-3],ya.angle=-Math.atan2(ka,fa)),this.endMarker.draw(ga,b,ma));if(a.notNull(this.markerPattern)&&a.notNull(this.markerPattern.markers)&&0<this.markerPattern.markers.length){fa=[];ma=a.util.GeomUtil;if(a.isNull(this.markerPattern.intervalUnit)||""===this.markerPattern.intervalUnit)this.markerPattern.intervalUnit=
"pixel";ya=this.markerPattern.interval/ma.getCurrentDistancePerPixel(b,this.markerPattern.intervalUnit);Ma=Ma[0];for(var ka=0,ob,y,za=0,Ca=Ma.length;za<Ca-3;)Oa=null,ob=ma.getSegmentLength(Ma[za],Ma[za+1],Ma[za+2],Ma[za+3]),y=ya*fa.length,ka+ob>=y?(Oa=(y-ka)/ob,Oa={x:Ma[za]+(Ma[za+2]-Ma[za])*Oa,y:Ma[za+1]+(Ma[za+3]-Ma[za+1])*Oa}):(ka+=ob,za+=2),Oa&&fa.push(Oa);for(Ma=0;Ma<fa.length;Ma++)ya=fa[Ma],ma={group:c,markerPoint:ya},this.markerPattern.oriented&&Ma!=fa.length-1&&(ka=fa[Ma+1],ya.angle=Math.atan2(ka.y-
ya.y,ka.x-ya.x)),ya=this.markerPattern.markers[Ma%this.markerPattern.markers.length],a.notNull(ya)&&a.notNull(ya.draw)&&ya.draw(ga,b,ma)}},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=["Fill","FillWidth"]},getOverallThickness:function(){1>this.strokeThickness&&(this.strokeThickness=1);var a=1;return a=0<this.fillWidth?2*this.strokeThickness+this.fillWidth:this.strokeThickness},getOverallLine:function(){var b=this.getOverallThickness(),Ma="",c="#000000",c=
a.notNull(this.fill)&&0<this.fillWidth?this.fill:this.stroke,Ma=Ma+("fill:"+c+";")+(a.notNull(this.strokeThickness)?"stroke-width:"+b+";":""),Ma=Ma+(a.notNull(this.strokeOpacity)?"fill-opacity:"+Math.min(Math.round(255*this.strokeOpacity),255)+";":"");return Ma+=a.notNull(this.strokeLineCap)?"stroke-linecap:"+this.strokeLineCap:""},getOverallLine_strokeDash:function(){var b=this.getOverallThickness(),Ma="",c="#000000",c=a.notNull(this.fill)&&0<this.fillWidth?this.fill:this.stroke,Ma=Ma+("fill:"+c+
";");0<this.strokeDash.length&&(a.isNull(this.fill)||0===this.fillWidth)&&(Ma+="fill-opacity:0;");Ma+=a.notNull(this.strokeThickness)?"stroke-width:"+b+";":"";return Ma+=a.notNull(this.strokeLineCap)?"stroke-linecap:"+this.strokeLineCap:""},getParallelLine:function(){var b="",Ma;a.notNull(this.fill)&&0<this.fillWidth?(b='\x3cline class\x3d"parallel"'+(' style\x3d"fill:'+this.stroke+";stroke-width:"+this.strokeThickness+'"'),b+="/\x3e"):a.notNull(this.centerLine)&&0<this.centerLineWidth&&(b='\x3cline class\x3d"parallel"',
Ma=Math.max((this.strokeThickness-this.centerLineWidth)/2,0),b+=' style\x3d"fill:'+this.stroke+";stroke-width:"+Ma+'"/\x3e',b+="/\x3e");return b},getParallelLine_strokeDash:function(){var b="",Ma;a.notNull(this.fill)&&0<this.fillWidth?(b='\x3cline class\x3d"parallel" style\x3d"fill:'+this.stroke,b+=a.notNull(this.strokeOpacity)?";fill-opacity:"+Math.min(Math.round(255*this.strokeOpacity),255)+";":"",b+=";stroke-width:"+this.strokeThickness+'"',b+="/\x3e"):a.notNull(this.centerLine)&&0<this.centerLineWidth&&
(b='\x3cline class\x3d"parallel"',Ma=Math.max((this.strokeThickness-this.centerLineWidth)/2,0),b+=' style\x3d"fill:'+this.stroke,b+=a.notNull(this.strokeOpacity)?";fill-opacity:"+Math.min(Math.round(255*this.strokeOpacity),255)+";":"",b+=";stroke-width:"+Ma+'"',0<this.strokeDash.length&&(b+=' dash\x3d"'+this.strokeDash[0]+","+this.strokeDash[1]+'"'),b+="/\x3e/\x3e");return b},getCenterLine:function(){var b="";a.notNull(this.centerLine)&&0<this.centerLineWidth?(b='\x3cline class\x3d"base" style\x3d"fill:'+
this.centerLine+";stroke-width:"+this.centerLineWidth+'"',0<this.centerLineDash.length&&(b+=' dash\x3d"'+this.centerLineDash[0]+","+this.centerLineDash[1]+'"'),b+="/\x3e"):a.notNull(this.fill)&&0<this.fillWidth?(b='\x3cline class\x3d"base" style\x3d"fill:'+this.fill+";stroke-width:"+this.fillWidth+'"',0<this.centerLineDash.length&&(b+=' dash\x3d"'+this.centerLineDash[0]+","+this.centerLineDash[1]+'"'),b+="/\x3e"):b='\x3cline class\x3d"base"/\x3e';return b},getCenterLine_strokeDash:function(){var b=
"";2===this.strokeDash.length?(b='\x3cline class\x3d"base" style\x3d"fill:'+this.stroke+";",b+=a.notNull(this.strokeOpacity)?"fill-opacity:"+Math.min(Math.round(255*this.strokeOpacity),255)+";":"",b+="stroke-width:"+this.strokeThickness+'"',b+=' dash\x3d"'+this.strokeDash[0]+","+this.strokeDash[1]+'"',b+="/\x3e"):b='\x3cline class\x3d"base"/\x3e';return b},getCenterLine_centerLineDash:function(){var a="";2===this.centerLineDash.length?(a='\x3cline class\x3d"base" style\x3d"fill:'+this.centerLine+
";",a+="stroke-width:"+this.centerLineWidth+'"',a+=' dash\x3d"'+this.centerLineDash[0]+","+this.centerLineDash[1]+'"',a+="/\x3e"):a='\x3cline class\x3d"base"/\x3e';return a},toXMLString:function(){var a="",b="",c="";0===this.strokeDash.length&&0===this.centerLineDash.length?(a=this.getOverallLine(),b=this.getParallelLine(),c=this.getCenterLine()):0!==this.strokeDash.length&&0===this.centerLineDash.length?(a=this.getOverallLine_strokeDash(),b=this.getParallelLine(),c=this.getCenterLine_strokeDash()):
(0===this.strokeDash.length&&0!==this.centerLineDash.length?a=this.getOverallLine():(a=this.getOverallLine_strokeDash(),b=this.getParallelLine_strokeDash()),c=this.getCenterLine_centerLineDash());var fa='\x3cstyle name\x3d"'+this.getStyleName()+'"\x3e';return fa+('\x3cg class\x3d"line" style\x3d"'+a+'"\x3e'+b+c+"\x3c/g\x3e\x3c/style\x3e")}});a.style.Marker=a.style.Style.extend({initialize:function Ma(c){c=c||{};c.styleType="Marker";Ma.base.call(this,c);this.width=a.notNull(c.width)?c.width:null;this.height=
a.notNull(c.height)?c.height:null;this.max_size_in_px=a.notNull(c.max_size_in_px)?c.max_size_in_px:null;this.xOffset=a.notNull(c.xOffset)?c.xOffset:0;this.yOffset=a.notNull(c.yOffset)?c.yOffset:0;this.lengthUnit=a.notNull(c.lengthUnit)?c.lengthUnit:"pixel";this.src=a.notNull(c.src)?c.src:null;this.textStyle=a.notNull(c.textStyle)?c.textStyle:null===c.textStyle?null:b;this.gradient=a.notNull(c.gradient)?c.gradient:null;this.src&&(a.isNull(this.width)||a.isNull(this.height))&&this.loadImgFromSource();
this.nullFill=a.notNull(c.nullFillSrc)?c.nullFillSrc:null;(this.vectorDef=a.notNull(c.vectorDef)?c.vectorDef:null)&&this.calculateVectorMarkerScale();this.textOffset=c.textOffset?c.textOffset:null;this.showOnPoint=2;this.realHeightInPx=this.realWidthInPx=null},loadImgFromSource:function(){var b=this,c=new Image;c.src=this.src;c.onload=function(){a.isNull(b.width)&&(b.width=c.width);a.isNull(b.height)&&(b.height=c.height);b.origConfig&&(b.origConfig.width=c.width,b.origConfig.height=c.height)}},resolve:function(b){if(!this.bindings||
0===this.bindings.length)return this;for(var c=0,fa=this.bindings.length;c<fa;c++){var ga=this.bindings[c],ma=this.resolveBinding(ga,b);"FILL"===ga.attribute?(this.vectorDef&&0<this.vectorDef.length&&(this.vectorDef[0].style.fill=ma),this.isBound("FILL")&&1===this.bindings.length&&(this.width=ma===a.PaintTypes.NO_PAINT?0:a.notNull(this.origConfig.width)?this.origConfig.width:null)):"SIZE"===ga.attribute?this.origConfig.width&&this.origConfig.height&&this.origConfig.width!==this.origConfig.height?
(this.height=this.origConfig.height*ma/this.origConfig.width,this.width=ma):this.height=this.width=ma:"WIDTH"===ga.attribute?this.width=ma:"HEIGHT"===ga.attribute?this.height=ma:"SOURCE"===ga.attribute&&(this.src=ma,this.loadImgFromSource())}(a.isNull(this.width)||isNaN(this.width))&&a.notNull(this.origConfig.width)&&(this.width=this.origConfig.width);(a.isNull(this.height)||isNaN(this.height))&&a.notNull(this.origConfig.height)&&(this.height=this.origConfig.height);this.calculateVectorMarkerScale();
return this},draw:function(b,c,fa){this.resolve(b);var ga=b.geo,ma=b.geo.type;if(fa.markerPoint&&b.shapeGroup)b.shapeGroup.push(this.drawMarker(c,fa.group,fa.markerPoint,b.markerText));else if(fa.sPoint)b.shape=this.drawMarker(c,fa.group,fa.sPoint,b.markerText);else if("LineString"!==ma&&"MultiLineString"!==ma)if("string"===typeof this.nullFill&&(this.nullFill=c.getGraphics().createFillPattern(this.nullFill)),"Polygon"===ma||"MultiPolygon"===ma){if(!b.screenPoints){var ya=null;b.labelBox?ya=new a.geometry.Point((b.labelBox[0]+
b.labelBox[2])/2,(b.labelBox[1]+b.labelBox[3])/2,ga.srid):ga.mbr&&(ya=new a.geometry.Point((ga.mbr.getMinX()+ga.mbr.getMaxX())/2,(ga.mbr.getMinY()+ga.mbr.getMaxY())/2,ga.srid));ya=b.transformGeometry(ya);b.screenPoints||(b.screenPoints=ya)}b.shape=this.drawMarker(c,fa.group,b.screenPoints,b.markerText)}else if(b.screenPoints||b.transformGeometry(ga),"Point"===ma||"OrientedPoint"===ma)b.shape=this.drawMarker(c,fa.group,b.screenPoints,b.markerText),a.isNull(b.renderingStyle)||(b.markerWidth=this.realWidthInPx,
b.markerHeight=this.realWidthInPx),this.markerText&&this.drawMarker(c,ya,b.screenPoints,b.markerText);else if("MultiPoint"===ma||"OrientedMultiPoint"===ma){ya=c.getGraphics().createGroup();fa.group.appendChild(ya);fa=0;for(ga=b.screenPoints.length;fa<ga;fa++)this.drawMarker(c,ya,b.screenPoints[fa],b.markerText);b.shape=ya}},drawMarker:function(b,c,fa,ga){if(0!==this.width&&0!==this.height){var ma={group:c,xOffset:this.xOffset,yOffset:this.yOffset};fa.angle&&(ma.angle=fa.angle);var ya=b.getGraphics(),
ka={lengthUnit:this.lengthUnit,width:this.width,height:this.height,max_size_in_px:this.max_size_in_px},za,Ca;if(this.src)ka.width=this.width,ka.height=this.height,ka.src=this.src,ma.enableCache=!0,a.style.Style.calculateStyleSize(ka,b),this.realWidthInPx=ka.realWidth,this.realHeightInPx=ka.realHeight,ka.width=ka.realWidth,ka.height=ka.realHeight,ma=ya.drawImageMarker({x:fa.x,y:fa.y},ka,ma);else{ka.vectorDef=this.vectorDef;if(!this.vectorDef||!this.vectorDef[0]||!this.vectorDef[0].shape){za=a.gv;Ca=
za.defaultMarkerStyleWidth;var Oa=za.defaultMarkerStyleHeight;a.isNull(ka.width)&&(ka.width=Ca);a.isNull(ka.height)&&(ka.height=Oa);ka.vectorDef=[{shape:{type:"circle",cx:ka.width/2,cy:ka.height/2,width:ka.width,height:ka.height,scaleX:1,scaleY:1},style:a.$.extend(!0,{},za.defaultMarkerStyle,ka)}]}a.style.Style.calculateStyleSize(ka,b);b={};a.$.extend(!0,b,ka.vectorDef);b.length=ka.vectorDef.length;ma.width=ka.realWidth;ma.height=ka.realHeight;this.realWidthInPx=ka.realWidth;this.realHeightInPx=ka.realHeight;
za=ka.realWidth/ka.width*b[0].shape.scaleX;Ca=ka.realHeight/ka.height*b[0].shape.scaleY;b[0].style.strokeThickness&&(b[0].style.strokeThickness/=za);b[0].style.insetThickness&&(b[0].style.insetThickness/=za);if(a.isNull(b[0].style.fill)&&a.notNull(this.nullFill)||b[0].style.fill===a.PaintTypes.NO_PAINT&&a.notNull(this.nullFill))b[0].style.fill=this.nullFill,"string"===typeof b[0].style.fill&&(b[0].style.fill=ya.createFillPattern(b[0].style.fill));za&&Ca&&(ma.xScale=za,ma.yScale=Ca);a.notNull(this.gradient)&&
("object"===typeof this.gradient?ma.gradient=this.gradient:"radial"===this.gradient&&(Oa=this.getRadialGradient(ya,this.vectorDef[0].style.fill),ma.gradient=Oa));ma=ya.drawVectorMarker({x:fa.x,y:fa.y},b,ma)}if(ga){ga=ya.createTextNode(ga,this.textStyle,0,0);b=ya.getWidthHeight(ga);if(ka.src)return ka=ya.createGroup(),ka.appendChild(ma),ka.appendChild(ga),c.appendChild(ka),c=fa.x-b.w/2,fa=fa.y+(b.h-4)/2,this.textOffset&&(c+=this.textOffset.x?this.textOffset.x:0,fa+=this.textOffset.y?this.textOffset.y:
0),ga.translate(c,fa),ka;ma.appendChild(ga);fa=((ka.realWidth?ka.realWidth:ka.width)-b.w)/2;c=((ka.realHeight?ka.realHeight:ka.height)+b.h-4)/2;this.textOffset&&(fa+=this.textOffset.x?this.textOffset.x:0,c+=this.textOffset.y?this.textOffset.y:0);ga.scale(1/za,1/Ca);ga.translate(fa,c)}return ma}},getRadialGradient:function(b,c){if(a.isNull(b)||a.isNull(c))return null;var fa=b.oui;return new fa.style.RadialGradient({cx:.3,cy:.3,radius:.5,stops:[new fa.style.GradientStop({offset:0,color:"#ffffff"}),
new fa.style.GradientStop({offset:.8,color:c})]})},calculateVectorMarkerScale:function(){(a.isNull(this.height)||a.isNull(this.width))&&this.vectorDef&&0<this.vectorDef.length&&a.isNotNull(this.vectorDef[0].shape)&&a.isNotNull(this.vectorDef[0].shape.width)&&a.isNotNull(this.vectorDef[0].shape.height)&&(this.height=this.vectorDef[0].shape.height,this.width=this.vectorDef[0].shape.width);if(this.vectorDef&&0<=this.width&&0<=this.height&&a.isNotNull(this.width)&&a.isNotNull(this.height)){var b,c,fa=
Number.MIN_VALUE,ga=Number.MIN_VALUE,ma=Number.MAX_VALUE,ya=Number.MAX_VALUE;for(b=0;b<this.vectorDef.length;b++)if(c=this.vectorDef[b].shape,c.width=c.width?c.width:this.width,c.height=c.height?c.height:this.height,"circle"===c.type)0===c.cx&&0===c.cy&&(c.cx=c.width/2,c.cy=c.height/2),ma=Math.min(ma,c.cx-c.width/2),ya=Math.min(ya,c.cy-c.height/2),fa=Math.max(fa,c.cx+c.width/2),ga=Math.max(ga,c.cy+c.height/2);else if("rectangle"===c.type)a.isNull(c.x)&&(c.x=0),a.isNull(c.y)&&(c.y=0),c.scaleX=1,c.scaleY=
1,ma=Math.min(ma,c.x),ya=Math.min(ya,c.y),fa=Math.max(fa,c.x+c.width),ga=Math.max(ga,c.y+c.height);else{c=this.vectorDef[b].shape.coords[0];for(var ka=0,za=c.length;ka<za;ka+=2)c[ka]*=1,c[ka+1]*=1,c[ka]<ma&&(ma=c[ka]),c[ka]>fa&&(fa=c[ka]),c[ka+1]<ya&&(ya=c[ka+1]),c[ka+1]>ga&&(ga=c[ka+1])}b=fa-ma;ya=ga-ya;b==Number.MIN_VALUE&&(b=1);ya==Number.MIN_VALUE&&(ya=1);ga=this.width/b;ya=this.height/ya;for(b=0;b<this.vectorDef.length;b++)c=this.vectorDef[b].shape,c.scaleX=ga,c.scaleY=ya,a.notNull(this.vectorDef[b].style)&&
a.notNull(this.vectorDef[b].style.strokeThickness)&&(this.vectorDef[b].style.strokeThickness=parseFloat(this.vectorDef[b].style.strokeThickness))}},getFNFormat:function(a){if(this.src||!this.vectorDef||0===this.vectorDef.length||!this.vectorDef[0].shape||"path"!==this.vectorDef[0].shape.type||!this.vectorDef[0].shape.coords||1>this.vectorDef[0].shape.coords.length||4>this.vectorDef[0].shape.coords[0].length)return null;for(var b=this.vectorDef[0].shape,c=b.coords[0],ga="M "+c[0]+" "+c[1],ma=2,ya=
c.length;ma<ya;ma+=2)ga+=" L "+c[ma]+" "+c[ma+1];a?this.resolve(a):this.calculateVectorMarkerScale();this.vectorDef[0].style&&!this.vectorDef[0].style.fill&&(this.vectorDef[0].style.fillOpacity=0);return{height:b.scaleY,width:b.scaleX,d:ga,refX:this.xOffset,refY:this.yOffset,paint:this.vectorDef[0].style,strokeUnits:!1}},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=this.src?["Size","Width","Height","Source"]:["Fill","Size","Width","Height"]},getShapeString:function(b){var c=
"",fa="";if(b&&"circle"===b.type)c='\x3ccircle cx\x3d"'+b.cx+'" cy\x3d"'+b.cy+'" r\x3d"0"/\x3e';else if(b&&"rectangle"===b.type)fa=""+b.x+","+b.y+",",fa+=b.x+b.width+","+b.y+",",fa+=b.x+b.width+","+(b.y+b.height)+",",fa+=b.x+","+(b.y+b.height)+",",fa+=b.x+","+b.y,c='\x3cpolygon points\x3d"'+fa+'"/\x3e';else if(b&&"path"===b.type){fa="";b=b.coords[0];4>b.length&&a.util.Logger.warning("MAPVIEWER_9106","OM.style.Marker.getShapeString","It only contains ["+b.length+"] vertexes.");for(var c=0,ga=b.length;c<
ga;c+=1)fa+=b[c],c<b.length-1&&(fa+=",");c='\x3cpolygon points\x3d"'+fa+'"/\x3e'}return c},getAnchorString:function(){var b,c,fa=c=b="";a.isNull(this.xOffset)||0===this.xOffset?b="0.5":(b=(this.width+this.xOffset)/this.width,b=Math.max(0,b),b=Math.min(1,b),b=""+b);a.isNull(this.yOffset)||0===this.yOffset?c+="0.5":(c=(this.height+this.yOffset)/this.height,c=Math.max(0,c),c=Math.min(1,c),c=""+c);if("0.5"!==b||"0.5"!==c)fa='\x3canchor x\x3d"'+b+'" y\x3d"'+c+'"/\x3e';return fa},getImageSrcString:function(b){var c=
"";if(a.notNull(b)){var fa,ga=b.lastIndexOf(".");0<ga&&(fa=b.substring(ga+1));0>b.lastIndexOf("http")?(ga=document.URL,a.notNull(ga)?(ga=ga.substring(0,ga.lastIndexOf("/")+1),b=ga+b,c="\x3cimage"+(a.notNull(fa)&&0<fa.trim().length?' markerType\x3d"'+fa+'"':"")+' href\x3d"'+b+'"/\x3e'):a.util.Logger.warning("MAPVIEWER_9107","OM.style.Marker.getImageSrcString")):c="\x3cimage"+(a.notNull(fa)&&0<fa.trim().length?' markerType\x3d"'+fa+'"':"")+' href\x3d"'+b+'"/\x3e'}return c},toXMLString:function(){var b=
"",c="",fa=-1,ga=-1,ma="",ya="",ka="",za="";a.notNull(this.lengthUnit)&&"pixel"!==this.lengthUnit&&(ma=this.lengthUnit);if(a.notNull(this.vectorDef)){this.vectorDef&&this.vectorDef[0]&&this.vectorDef[0].style&&(b=this.vectorDef[0].style.fill,a.notNull(this.vectorDef[0].style.fillOpacity)&&(fa=Math.min(Math.round(255*this.vectorDef[0].style.fillOpacity),255)),c=this.vectorDef[0].style.stroke,a.notNull(this.vectorDef[0].style.strokeOpacity)&&(ga=Math.min(Math.round(255*this.vectorDef[0].style.strokeOpacity),
255)));var Ca=this.vectorDef[0].shape;Ca&&(ya=this.getShapeString(Ca),ka=this.getAnchorString())}else a.notNull(this.src)&&(za=this.getImageSrcString(this.src));Ca=""+('\x3cstyle name\x3d"'+this.getStyleName()+'"\x3e');Ca+='\x3cg class\x3d"marker"'+(a.notNull(this.max_size_in_px)?' max_size_in_px\x3d"'+this.max_size_in_px+'"':"")+' style\x3d"';Ca+=a.notNull(c)&&0<c.length?"stroke:"+c+";":"";Ca+=a.notNull(ga)&&0<=ga?"stroke-opacity:"+ga+";":"";Ca+=a.notNull(b)&&0<b.length?"fill:"+b+";":"";Ca+=a.notNull(fa)&&
0<=fa?"fill-opacity:"+fa+";":"";Ca+=a.notNull(this.width)&&0<this.width?"width:"+this.width+ma+";":"";Ca+=a.notNull(this.height)&&0<this.height?"height:"+this.height+ma+";":"";Ca=Ca+'"\x3e'+ya;Ca+=ka;Ca+=za;return Ca+="\x3c/g\x3e\x3c/style\x3e"},enableNullFillPattern:function(b){a.notNull(b)?this.nullFill=b:this.nullFill=null}});a.style.Marker.isSameShape=function(a,b){if(a.type===b.type)if("circle"===a.type){if(a.cx===b.cx&&a.cy===b.cy&&a.width===b.width&&a.height===b.height)return!0}else if("rectangle"===
a.type){if(a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height)return!0}else{var c=a.coords[0],ga=b.coords[0];if(c.length!==ga.length)return!1;for(var ma=0,ya=c.length;ma<ya;ma+=2)if(c[ma]!==ga[ma])return!1;return!0}return!1};a.style.StyleStore=a.style.StyleStore||{};a.style.StyleStore.styleCache=a.style.StyleStore.styleCache||{};a.style.StyleStore.styleCachePromises=a.style.StyleStore.styleCachePromises||{};a.style.StyleStore.getServerSideStyle=function(b,c,fa){var ga=a.style.StyleStore.styleCachePromises;
if(!b||!c)return a.util.Logger.alert("MAPVIEWER_9018","OM.style.StyleStore.getServerSideStyle","dataSource:"+b+" styleName:"+c),null;var ma=a.style.StyleStore.getCachedStyle(b,c);if(a.isNull(ma)){if(!fa||!fa.callback)return a.util.Logger.alert("MAPVIEWER_9018","OM.style.StyleStore.getServerSideStyle","options.callback:"+fa.callback),null;var ya,ma=function(ga){if(a.isNull(ga)&&fa&&fa.callback)fa.callback(null);else{var ma=null;try{ma=a.style.StyleStore.parseXMLStyle(ga,c,b,ya)}catch(ob){ma=a.style.StyleStore.parseJSONStyle(ga,
c)}a.notNull(ma)&&(ma.isServerSide=!0,a.style.StyleStore.putStyle(b,c,ma));fa&&fa.callback&&("__Invalid__"===ma.styleName?(fa.callback(null),ma=null):fa.callback(ma));return ma}},ka={xml_request:'\x3cnon_map_request\x3e\x3cget_style_definition data_source\x3d"'+b+'" style\x3d"'+c+'"/\x3e\x3c/non_map_request\x3e'};ya=fa&&fa.url?fa.url+"/omserver":a.gv.localbaseURL()+"/omserver";var za=a.style.StyleStore.getKey(b,c);ga[za]||(ga[za]=a.$.Deferred(function(b){a.util.HttpRequest.send(ya,ka,function(a){b.resolve(a)},
"text",function(){a.util.Logger.warning("MAPVIEWER_9023","OM.style.StyleStore.getServerSideStyle");b.reject()})}).promise());return ga[za].done(ma).fail(ma)}if("__Invalid__"===ma.styleName)return fa&&fa.callback&&fa.callback(null),null;fa&&fa.callback&&fa.callback(ma);return ma};a.style.StyleStore.parseXMLStyle=function(b,c,fa,ga){"string"===typeof b&&(b=a.$.trim(b),b=a.$.parseXML(b));b=a.$(b);a.notNull(b.find("oms_error")[0])?(c=new a.style.Style({styleName:"__Invalid__"}),a.util.Logger.alert("MAPVIEWER_9023",
"OM.style.StyleStore.parseXMLStyle",b.find("oms_error").text())):c=a.style.StyleStore.createStyle(b,c,fa,ga);a.isNull(c)&&(c=new a.style.Style({styleName:"__Invalid__"}));return c};a.style.StyleStore.parseJSONStyle=function(b,c){"string"===typeof b&&(b=a.$.parseJSON(b));if(!b.type)return null;var fa=b.type,ga=b.def;ga.styleName=c;var ma;switch(fa){case "color":ma=new a.style.Color(ga);break;case "marker":ma=new a.style.Marker(ga);break;case "pulse_animation":ma=new a.style.PulseAnimation(ga);break;
case "color_animation":fa={};fa.styleName=c;b.beginColorDef&&(fa.beginColor=new a.style.Color(b.beginColorDef.def));b.endColorDef&&(fa.endColor=new a.style.Color(b.endColorDef.def));ga.duration&&(fa.duration=ga.duration);ga.movingDashLine&&(fa.enableMovingDashLine=ga.movingDashLine);ma=new a.style.AnimationColor(fa);break;case "bar_chart":ma=b.barArr;for(var ya=ma.length,ka=[],fa=0;fa<ya;fa++)ka.push(new a.style.Bar(ma[fa].name,ma[fa].color));ga.bars=ka;ma=new a.style.BarChart(ga);break;case "pie_chart":ma=
b.pieArr;ya=ma.length;ka=[];for(fa=0;fa<ya;fa++)ka.push(new a.style.PieSlice(ma[fa].name,ma[fa].color));ga.pieSlices=ka;ma=new a.style.PieChart(ga)}return ma};a.style.StyleStore.createStyle=function(b,c,fa,ga){var ma=a.style.StyleStore,ya;b=b.find("non_map_response \x3e style");for(var ka=0;ka<b.length;ka++){var za=b.eq(ka),Ca=za.attr("name"),za=ma.createSingleStyle(za,fa,ga);a.notNull(za)&&(a.style.StyleStore.putStyle(fa,Ca,za),Ca==c&&(ya=za))}if(a.notNull(ya)&&a.notNull(ya.markerPattern)&&a.notNull(ya.markerPattern.markers))for(c=
ya.markerPattern.markers,ya.markerPattern.markers=[],ga=0;ga<c.length;ga++)ya.markerPattern.markers.push(a.style.StyleStore.getCachedStyle(fa,c[ga]));return ya};a.style.StyleStore.createSingleStyle=function(b,c,fa){var ga=a.style.StyleStore,ma=b.find("AdvancedStyle")[0];return a.isNull(ma)?ga.createSimpleStyle({dataSource:c,data:b,url:fa}):ga.createAdvancedStyle(b.parent(),c,fa)};a.style.StyleStore.createAdvancedStyle=function(b,c,fa){var ga=b.find("AdvancedStyle")[0],ma=a.style.StyleStore;switch(a.$(ga).children()[0].tagName){case "PieChartStyle":return ma.createPieChartStyle(b);
case "BarChartStyle":return ma.createBarChartStyle(b);case "ColorSchemeStyle":return ma.createColorSchemeStyle(b);case "HeatMapStyle":return ma.createHeatMapStyle(b,c);case "BucketStyle":return ma.createBucketStyle(b,c,fa);case "VariableMarkerStyle":return ma.createVariableMarkerStyle(b,c,fa)}};a.style.StyleStore.getCachedStyle=function(b,c){var fa=a.style.StyleStore.styleCache,ga=a.style.StyleStore.getKey(b,c);return fa[ga]};a.style.StyleStore.putStyle=function(b,c,fa){var ga=a.style.StyleStore.styleCache;
a.isNull(b)||a.isNull(c)||(b=a.style.StyleStore.getKey(b,c),ga[b]=fa)};a.style.StyleStore.getKey=function(b,c){a.isNull(b)&&(b="");a.isNull(c)&&(c="");return b.toLowerCase()+"__"+c.toLowerCase()};a.style.StyleStore._styleStringToArray=function(a){a=a.attr("style").split(";");for(var b=[],c=0,ga=a.length;c<ga;c++){var ma=a[c].split(":");ma&&ma[0]&&(b[ma[0]]=ma[1])}return b};a.style.StyleStore._maxSizeInPx=function(b){b=b.attr("max_size_in_px");a.isNull(b)?b="":b.trim();return b};a.style.StyleStore.createSimpleStyle=
function(b){var c=b.data,fa=b.dataSource;b=b.url;var ga=c.find("g"),ma=a.style.StyleStore;if(a.notNull(ga[0]))switch(ga.attr("class")){case "color":return ma.createColorStyle(c);case "line":return ma.createLineStyle(c);case "area":return ma.createAreaStyle(fa,b,c);case "marker":return ma.createMarkerStyle(fa,b,c);case "text":return ma.createTextStyle(c);default:return null}else return null};a.style.StyleStore.createColorStyle=function(b){var c={},fa=a.style.StyleStore;c.styleName=b.attr("name");b.find("g").each(function(b,
ma){var ya=a.$(ma),ya=fa._styleStringToArray(ya);c.fill="function"!==typeof ya.fill?ya.fill:null;c.fillOpacity=ya["fill-opacity"]?parseInt(ya["fill-opacity"])/255:1;c.stroke=ya.stroke;c.strokeThickness=ya["stroke-width"];c.strokeOpacity=ya["stroke-opacity"]?parseInt(ya["stroke-opacity"])/255:1});return new a.style.Color(c)};a.style.StyleStore.createLineStyle=function(b){var c={},fa=a.style.StyleStore;c.styleName=b.attr("name");b.find("g").each(function(b,ma){var ya=a.$(ma),ka=fa._styleStringToArray(ya);
c.fill="function"!==typeof ka.fill?ka.fill:null;c.fillOpacity=ka["fill-opacity"]?parseInt(ka["fill-opacity"])/255:1;c.fillWidth=ka["stroke-width"];c.strokeLineCap=ka["stroke-linecap"];c.strokeLineJoin=ka["stroke-linejoin"];c.cased="true"===ya.attr("cased")?!0:!1;ya.find("line").each(function(b,ga){var ma,ob=a.$(ga);"parallel"===ob.attr("class")?(ma=fa._styleStringToArray(ob),c.stroke="function"!==typeof ma.fill?ma.fill:null,c.strokeThickness=ma["stroke-width"],c.strokeDash=fa.splitDashArray(ob.attr("dash"))):
"base"===ob.attr("class")&&(ma=fa._styleStringToArray(ob),c.centerLine="function"!==typeof ma.fill?ma.fill:null,c.centerLineWidth=ma["stroke-width"],c.centerLineDash=fa.splitDashArray(ob.attr("dash")))});ya.find("marker-pattern").each(function(b,fa){var ma=a.$(fa),ob=ma.attr("offset")||"",y=ma.attr("interval")||"";c.markerPattern={};c.markerPattern.offset=parseInt(ob);c.markerPattern.offsetUnit=ob.replace(/[0-9]/g,"");c.markerPattern.interval=parseInt(y);c.markerPattern.intervalUnit=y.replace(/[0-9]/g,
"");c.markerPattern.markers=[];ma.find("marker").each(function(y,b){var k=a.$(b);c.markerPattern.markers.push(k.html())})})});return new a.style.Line(c)};a.style.StyleStore.createAreaStyle=function(b,c,fa){var ga={},ma=a.style.StyleStore;ga.styleName=fa.attr("name");fa.find("g").each(function(fa,ka){var za=a.$(ka),za=ma._styleStringToArray(za);ga.stroke=za.stroke;ga.strokeThickness=za["stroke-width"];ga.strokeOpacity=za["stroke-opacity"]?parseInt(za["stroke-opacity"])/255:1;ga.fillOpacity=za["fill-opacity"]?
parseInt(za["fill-opacity"])/255:1;ga.src=c+"?sty\x3d"+ga.styleName+"\x26ds\x3d"+b+"\x26w\x3d10\x26h\x3d10"});return new a.style.Area(ga)};a.style.StyleStore.createMarkerStyle=function(b,c,fa){var ga={},ma=a.style.StyleStore,ya={},ka={},za={};ga.styleName=fa.attr("name");fa.find("g").each(function(){var b=a.$(this),y=ma._maxSizeInPx(b);!a.isNull(y)&&0<y.length&&(ga.max_size_in_px=parseInt(y));b=ma._styleStringToArray(b);y=a.util.MiscUtil.parseNumberAndUnit(b.width);a.notNull(y.value)?ga.width=1*y.value:
ga.width=1*b.width;a.notNull(y.unit)&&(ga.lengthUnit=y.unit);y=a.util.MiscUtil.parseNumberAndUnit(b.height);a.notNull(y.value)?ga.height=1*y.value:ga.height=1*b.height;a.notNull(y.unit)&&(ga.lengthUnit=y.unit);b.fill&&"function"!==typeof b.fill&&(ka.fill=b.fill);b["fill-opacity"]&&(ka.fillOpacity=b["fill-opacity"]?parseInt(b["fill-opacity"])/255:1);b.stroke&&(ka.stroke=b.stroke);b["stroke-width"]&&(ka.strokeThickness=b["stroke-width"]);b["stroke-opacity"]&&(ka.strokeOpacity=b["stroke-opacity"]?parseInt(b["stroke-opacity"])/
255:1)});var Ca,Oa=!1;if(0!==fa.find("image").length)"dummy.gif"===fa.find("image").attr("href")?ga.src=c+"?w\x3d"+ga.width+"\x26h\x3d"+ga.height+"\x26sty\x3d"+ga.styleName+"\x26ds\x3d"+b:ga.src=fa.find("image").attr("href");else if(0!==fa.find("svgSymbol").length)ga.src=c+"?w\x3d"+ga.width+"\x26h\x3d"+ga.height+"\x26sty\x3d"+ga.styleName+"\x26ds\x3d"+b;else if(0!==fa.find("ttfSymbol").length)Oa=!0,ga.src=c+"?w\x3d"+ga.width+"\x26h\x3d"+ga.height+"\x26sty\x3d"+ga.styleName+"\x26ds\x3d"+b;else{if(0!==
fa.find("circle").length)za.type="circle",za.cx=1*fa.find("circle").attr("cx"),za.cy=1*fa.find("circle").attr("cy"),za.width=ga.width,za.height=ga.height;else if(0!==fa.find("rect").length){za.type="rectangle";b=fa.find("rect").attr("points").split(",");Ca=0;for(c=b.length;Ca<c;Ca++)b[Ca]*=1;za.width=ga.width;za.height=ga.height;za.x=b[0];za.y=b[1]}else b=fa.find("polygon").attr("points")||fa.find("polyline").attr("points"),za.type="path",b=b.split(","),fa.find("polygon").attr("points")&&2<=b.length&&
(b.push(b[0]),b.push(b[1])),za.coords=[b];ya.shape=za}za=fa.find("anchor").attr("x");fa=fa.find("anchor").attr("y");a.notNull(za)&&a.notNull(ga.width)&&(ga.xOffset=-(Number(za)-.5)*ga.width);a.notNull(fa)&&a.notNull(ga.height)&&(ga.yOffset=-(Number(fa)-.5)*ga.height);if(Oa)ya=new a.style.Marker(ga);else{for(Ca in ka){ya.style=ka;break}if(ya.shape||ya.style)ga.vectorDef=[ya];ya=new a.style.Marker(ga);ya.calculateVectorMarkerScale()}return ya};a.style.StyleStore.createTextStyle=function(b){var c={};
c.styleName=b.attr("name");b.find("g").each(function(b,ga){var ma=a.$(ga),ya=a.Text,ma=a.style.StyleStore._styleStringToArray(ma);c.fill="function"!==typeof ma.fill?ma.fill:null;c.fontStyle="italic"===ma["font-style"]?ya.FONTSTYLE_ITALIC:ya.FONTSTYLE_NORMAL;c.fontFamily=ma["font-family"];var ka=ma["font-size"];if(ka){var za=a.util.MiscUtil.parseNumberAndUnit(ka);a.notNull(za.value)?c.fontSize=1*za.value:c.fontSize=parseInt(ka);a.notNull(za.unit)&&(c.sizeUnit=za.unit,"pt"===za.unit&&(c.fontSize=parseInt(96*
c.fontSize/72),c.sizeUnit=null))}c.fontWeight="bold"===ma["font-weight"]?ya.FONTWEIGHT_BOLD:ya.FONTWEIGHT_NORMAL});return new a.style.Text(c)};a.style.StyleStore.createPieChartStyle=function(b){var c={pieSlices:[]};c.styleName=b.find("style").attr("name");c.radius=b.find("PieChartStyle").attr("pieradius");b.find("PieSlice").each(function(b,ga){var ma=a.$(ga),ya=ma.attr("color"),ma=ma.attr("name");c.pieSlices.push(new a.style.PieSlice(ma,ya))});return new a.style.PieChart(c)};a.style.StyleStore.createBarChartStyle=
function(b){var c={bars:[]};c.styleName=b.find("style").attr("name");var fa=b.find("BarChartStyle");c.width=fa.attr("width");c.height=fa.attr("height");c.showXAxis=fa.attr("show_x_axis");c.maxSize=fa.attr("max_value");b.find("Bar").each(function(b,fa){var ya=a.$(fa),ka=ya.attr("color"),ya=ya.attr("name");c.bars.push(new a.style.Bar(ya,ka))});return new a.style.BarChart(c)};a.style.StyleStore.createColorSchemeStyle=function(b){var c=a.style.StyleStore.createBucketConfig(b);b=b.find("ColorSchemeStyle");
c.baseColor=b.attr("basecolor");var fa=b.attr("basecolor_opacity");c.baseColorOpacity=fa?parseInt(fa)/255:1;c.stroke=b.attr("strokecolor");b.attr("strokewidth")&&(c.strokeThickness=1*b.attr("strokewidth"));fa=b.attr("strokecolor_opacity");c.strokeOpacity=fa?parseInt(fa)/255:1;return new a.style.ColorScheme(c)};a.style.StyleStore.createHeatMapStyle=function(b,c){var fa={},ga=b.find("spot_light_radius").text();fa.styleName=b.find("style").attr("name");var ma=b.find("container_theme").text();ma&&(fa.containerVectorLayer=
new a.layer.VectorLayer("container",{def:{type:a.layer.VectorLayer.TYPE_PREDEFINED,dataSource:c,theme:ma,loadOnDemand:!1}}));fa.spotlightRadius=1*ga.match(/\d+\.?\d+/g);(ga=ga.match(/[a-z]+/g))&&0<ga.length&&(fa.lengthUnit=ga[0]);ga=b.find("color_stops");ma=ga.attr("alpha");fa.opacity=1;ma&&(fa.opacity=parseFloat(ma/256));for(var ga=a.$.trim(ga.text()).split(","),ma=0,ya=ga.length;ma<ya;ma++)ga[ma]=a.util.ValidationUtil.getColor(ga[ma]);fa.colorStops=ga;return new a.style.HeatMap(fa)};a.style.StyleStore.createBucketStyle=
function(b,c,fa){b=a.style.StyleStore.createBucketConfig(b,c,fa);return new a.style.BucketStyle(b)};a.style.StyleStore.createBucketConfig=function(b,c,fa){var ga={};ga.styleName=b.find("style:has('AdvancedStyle')").attr("name");var ma=b.find("Buckets"),ya=a.style.StyleStore,ka=ma.attr("default_style");ka&&(ga.defaultStyle=ya.getSubStyleByName(b,ka,c,fa));ga.buckets=[];ga.styles=[];var za,ka=ma.find("RangedBucket");if(0<ka.length)return za=a.style.RangedBucket,ka.each(function(){ga.classification=
"custom";var y=a.$(this),A={};A.seq=1*y.attr("seq");A.label=y.attr("label");var m=1*y.attr("low"),k=1*y.attr("high");A.low=isNaN(m)?Number.NEGATIVE_INFINITY:m;A.high=isNaN(k)?Number.POSITIVE_INFINITY:k;y=y.attr("style");y=ya.getSubStyleByName(b,y,c,fa);A=new za(A);ga.buckets.push(A);y&&ga.styles.push(y)}),ga.numClasses=ga.buckets.length,ga;ka=ma.find("CollectionBucket");if(0<ka.length)return za=a.style.CollectionBucket,ka.each(function(){ga.classification="custom";var y=a.$(this),A={};A.seq=1*y.attr("seq");
A.label=y.attr("label");var m=y.attr("style"),m=ya.getSubStyleByName(b,m,c,fa),k=y.attr("label_style");A.labelStyle=ya.getSubStyleByName(b,k,c,fa);A.keepWhiteSpace=y.attr("keep_white_space");k=y.attr("type");A.dataType=k;var aa=y.attr("delimiter");aa||(aa=",");for(var y=y.text().split(aa),aa=y.length,u=0;u<aa;u++)if("integer"===k||"short"===k)y[u]=parseInt(y[u]);else if("double"==k||"long"===k)y[u]=parseFloat(y[u]);A.values=y;A=new za(A);ga.buckets.push(A);m&&ga.styles.push(m)}),ga.numClasses=ga.buckets.length,
ga;if(ka=ma.attr("styles"))for(var ka=ka.split(","),Ca=0,Oa=ka.length;Ca<Oa;Ca++){var ob=ya.getSubStyleByName(b,ka[Ca],c,fa);ga.styles.push(ob)}ka=ma.attr("low");Ca=ma.attr("high");ka&&(ga.low=1*ka);Ca&&(ga.high=1*Ca);ma=ma.attr("nbuckets");ga.numClasses=ma?1*ma:null;return ga};a.style.StyleStore.createVariableMarkerStyle=function(b,c,fa){var ga=a.style.StyleStore.createBucketConfig(b,c,fa),ma=b.find("VariableMarkerStyle"),ya=a.style.StyleStore,ka=ma.attr("basemarker");ga.marker=ya.getSubStyleByName(b,
ka,c,fa);b=ma.attr("startsize");ma=ma.attr("increment");b&&(ga.startSize=1*b);ma&&(ga.increament=1*ma);return new a.style.VariableMarker(ga)};a.style.StyleStore.getSubStyleByName=function(b,c,fa,ga){b=b.find('style[name\x3d"'+c+'"]')[0];b=a.$(b);return a.style.StyleStore.createSimpleStyle({dataSource:fa,url:ga,data:b})};a.style.StyleStore.splitDashArray=function(a){if(a){a=a.split(",");for(var b=a.length,c=0;c<b;c++)a[c]=parseInt(a[c]);return a}return null};a.style.StyleStore.defaultMarkerStyle=new a.style.Marker({width:50,
height:50,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAG3klEQVRoQ+2XaWwUZRzG37n26LWUAi0toi1IImhiggqioiEhqYkJH5SEIyECMSAYTCiKHAot5xflC2CQ+EFEjgBRULlrLeEoJKACBakNaaDHUloshXZLa3d8nndmyrZAod3tasgOeTvnzjy///P83xkU8ZgsymPCIWIg/zcnY47EHOmhCsSi1UOF7fZtY450u3Q99MOYI/6bzSMVoWWHW2BTtO5P87mKwr1PtxwpqWjcXXOrafSvl81eQphtGhTczZS7vK0prH0Fa1Med86HHn89U63rk+g5MiQjblw4MF0GKa9t/vzQ6bIZeQUivqG00NLcyRIMEqTjRdi3D7XUVYg18yY0jB3+5IYBKa6c7sJ0GaSkMlD88ffXhx4vPNBWZefhJsoO2VKkaartNYXAKArOWdZJyGfTVPHl/PEXhqR7h0UN5PK1pqqpm6rSLp46bD3TSlFbhSWAs++Ix76qqnYIuQNcRM5E5FRFFxneRrFj5RR/Vqqnf1RBpn3rT7tw6pD1TOiSuulCEBC2x9Yxxsp2BiCOA5Zr1oUm1unegNi1fHL0QaZvrkorPglH7D5HXe9xQfaFqt0VDyAnbmh96ZBc4E4GQHbkTYg+CKNFR6RYRsSxoYMDKsUzUkEahX8QLbd0AuJ3ckaDIx5EK/cdgLijGy2nR6QTVl5k88oYaYrMPY9JoXRFJo5rjdw4bzllOWaKAeiR7YvH+TOjDSKjVZR/1wlqoig6IsVqQtGgnk7ogCIEz2nctvuI7xU7XhlxAbF9wZv/Dcj5ol+cXhcaBEoAiKQ4RcU+QUzbAd2Q0FbjwzHu0xruIW7p7gax7ZOx/sx+RvSjdeEkQDiN2pU2IZKRsqJkOaKohnSDYPKY3SPsG4XXYvpV4F66+5bYkjM6+iCM1vmTBTIqrLEJwW1iIUw1AMA+oXgZM+zLbSt6ElZOEtbsxWbfPOdFgOjRdUT2yCl8njAamtvKOsSzoRXdJYXLinNtO8N9XAiD6AbiJd2y3iMZntti08znogtSWhW48v626if+IAgqyxlINVzSAUUHFPJP0TxmCkO6QwdUuBcEKB1QNDiCbzD2FN/uWQmNYsPUQVcH9dUHWtNZ15cuf2uV+gNb1hXenLh1D16IsicIABBUXzM8gHPJZlawVhgxVJ4QcsZizOx+ke8TvlDRN28NaRWzRidvHZyqT+o6gvWLLoNU1jUPr6hpyJ+xrc5XVXoa1adoCDbcEIxtwKgciJyAK4rtitXsgJIuBuWrR8Of3nFCZD+tiKkjvLmpPm1p1ED4IMJU1gTyZ+6s91WW/AZHLPEOhIZ9xkwwaoBT4ZhB4UiUm5Oa/EA2RYpXFa8NNsS7L+i5ZqBxfVpaYnVUQdpgapsAc9tXVXYJIF6hQbjq9iJdcRCPmAFCh3oPetztUoROGGzrIEnG6VcGGWLi8+FDdCtaoRWTztTeyZ/9wx2fv7xMaG7kBECMFd1xGbqIhxX8EIlDGxFExydML1w26ilDZGcFVu/e/t3Xc+fOvt6JE+ykVox/7DW37/631P5hl3uk4wMlzI2W/A/2mL5qf4VQ3PFwxit0lyHi3Ypwo6O9hircaCOCJCNxI7J0MVQr2bgqd+HOfft++rsTCHzkiBaMAMYtjNsYTTZQO5iwQSji0tWal+pb4g/N39eadLW2QTridasiAeI9cIQghmoiTooYmamLlBtHdy7/bNHBM2eKbj4AgiIJ0YzRiMHrajEI3WC7E1EQFoJfgolr1m18Y1T25G9WFAQTSmuDMlLxBtzQAaGbom+cKiHiyg/uXbls4ZHic+dY4dDFEUYAB4KiCVGDwfjdsB3h+XZLOI44EAm4Y1+M1PdmzRkxPWd13hdHgt6yOlMkoi84S/VLUMXLgPBc+fngquVLjv1Z3A6CAM5g/jnu2E7U2wDXbAhG7B4IEoUDws8sJF4kY/SzYXpPmjJt2Jwla+etPx70XqkLiv5Jmng1SxMJ5XtDIZzoOI3sNDP7gRAUTAg6QDfqHuSEY0skQJJwsxSM3jZUAmCe+XDp2nlfnTC9w9I10af6wP5Vyz49evH8WcbEqTpFcybimr1AADYyIdjUBOFgvHj+npnKgQjXERaBriBAgvHy2YNgibt+PDzlL++otzPrC/esWLqg4OzZ31lVinaqTnEUTfEOABvbOUYwgnYK4MCE40joPRwgvCEEQZLGjHlz4EeLl4zPW5Sz/8SJY5xtKCpUNAWHgjgOPZLwUDfCdaTjvbjvAHmxTSiu+T50ZiEHxKn2fV9u97vxw45FwpEHARGKUzMXpy/uO+M8TOSjnO8pkEd5dkSviYFEtJwRuFnMkQgUMaK3iDkS0XJG4GaPjSP/Al31T1GL6r+HAAAAAElFTkSuQmCC",
yOffset:-12,xOffset:2});a.style.StyleStore.defaultLineStyle=new a.style.Line({stroke:"#000000",strokeThickness:1});a.style.StyleStore.defaultPolygonStyle=new a.style.Color({stroke:"#000000",strokeThickness:1,fill:"#bebebe"});a.style.StyleStore.defaulTextStyle=new a.style.Text({fontSize:12,fill:"#000000"});a.style.BasicAnimation=a.style.Style.extend({initialize:function Hb(b){Hb.base.call(this,b);this.duration=a.notNull(b.duration)?b.duration:5;this.repeatCount=b.repeatCount?b.repeatCount:Number.MAX_VALUE},
isRepeat:function(){return 0<this.repeatCount},getDuration:function(){return this.duration}});a.style.AnimationColor=a.style.BasicAnimation.extend({initialize:function fa(b){b=b||{};b.styleType="AnimationColor";fa.base.call(this,b);this.beginColor=a.notNull(b.beginColor)?b.beginColor:new a.style.Color({strokeThickness:1,stroke:"#000000",fill:"#ffffff"});this.endColor=a.notNull(b.endColor)?b.endColor:new a.style.Color({strokeThickness:1,stroke:"#ffffff",fill:"#000000"});if(this.movingDashLine=a.notNull(b.enableMovingDashLine)?
b.enableMovingDashLine:!1)this.beginColor.strokeDashArray=[10,10];a.isNull(b.repeat)||b.repeat?this.repeatCount=Number.POSITIVE_INFINITY:this.repeatCount=1},draw:function(a,b,c){this.beginColor.draw(a,b,c)},createAnimation:function(a,b,c){this.target=a;if(this.beginColor&&this.endColor){var ya=[],ka={};this.beginColor.stroke!==this.endColor.stroke&&(ka.stroke={beginValue:this.covertColor(this.beginColor.stroke,b),endValue:this.covertColor(this.endColor.stroke,b),interpolator:b.oui.anim.interpolateColor});
this.beginColor.strokeThickness!==this.endColor.strokeThickness&&(ka.strokeThickness={beginValue:this.beginColor.strokeThickness,endValue:this.endColor.strokeThickness});c||(this.beginColor.fill!==this.endColor.fill&&(ka.fill={beginValue:this.covertColor(this.beginColor.fill,b),endValue:this.covertColor(this.endColor.fill,b),interpolator:b.oui.anim.interpolateColor}),this.beginColor.fillOpacity!==this.endColor.fillOpacity&&(ka.fillOpacity={beginValue:this.beginColor.fillOpacity,endValue:this.endColor.fillOpacity}),
this.beginColor.strokeOpacity!==this.endColor.strokeOpacity&&(ka.strokeOpacity={beginValue:this.beginColor.strokeOpacity,endValue:this.endColor.strokeOpacity}));this.movingDashLine&&(ka.strokeDashArray={beginValue:[10,10],endValue:[10,10],interpolator:function(a,b,c){a=parseInt(100*c)%20;b=[10,10];10<a?b=[a-10,10,20-a,.1]:0<a&&(b=10-a,b=[.1,a,10,0===b?.1:b]);return b}});a=new b.oui.anim.AnimateStyle({targetNode:a,dur:this.duration,animValues:ka,repeatCount:this.repeatCount});ya.push(a);return ya}},
covertColor:function(a,b){var c=parseInt(a.substring(1,3),16),ya=parseInt(a.substring(3,5),16),ka=parseInt(a.substring(5),16);return new b.oui.style.Color(c,ya,ka)}});a.style.PulseAnimation=a.style.BasicAnimation.extend({initialize:function ga(b){b=b||{};b.styleType="PulseAnimation";ga.base.call(this,b);this.beginSize=a.notNull(b.beginSize)?b.beginSize:10;this.endSize=a.notNull(b.endSize)?b.endSize:20;this.stroke=a.notNull(b.stroke)?b.stroke:"#000000"},draw:function(a,b,c){var ka=a.geo,za=ka.type;
if("LineString"!==za&&"MultiLineString"!==za&&"Polygon"!==za&&"MultiPolygon"!==za){b=b.getGraphics();a.screenPoints||a.transformGeometry(ka);var ka=a.screenPoints,Ca=[{shape:{type:"circle",cx:0,cy:0,width:this.beginSize,height:this.beginSize,scaleX:1,scaleY:1},style:{stroke:this.stroke}}];if("MultiPoint"===za||"OrientedMultiPoint"===za){za=b.createGroup();c.group.appendChild(za);c.group=za;for(var Oa=0,ob=ka.length;Oa<ob;Oa++)b.drawVectorMarker({x:ka[Oa].x,y:ka[Oa].y},Ca,c);a.shape=za}else a.shape=
b.drawVectorMarker({x:ka.x,y:ka.y},Ca,c)}},createAnimation:function(a,b){this.target=a;var c=[],ka=new b.oui.anim.AnimateStyle({targetNode:a,dur:this.duration,repeatCount:this.repeatCount,animValues:{width:{beginValue:this.beginSize,endValue:this.endSize},height:{beginValue:this.beginSize,endValue:this.endSize},strokeOpacity:{beginValue:1,endValue:0}}});ka.addEventListener(b.oui.SyncEvents.END,this.endListener);c.push(ka);return c},endListener:function(a){var b=a.target;a=b.getTargetNode();b=b.getAnimValues();
a.applyStyle({width:b.width.beginValue,height:b.height.beginValue,strokeOpacity:1})}});a.style.Area=a.style.Style.extend({initialize:function ma(b){b=b||{};b.styleType="Area";ma.base.call(this,b);var c=a.util.ValidationUtil.getColor;this.stroke=a.notNull(b.stroke)&&c(b.stroke)?c(b.stroke):a.PaintTypes.NO_PAINT;this.src=a.notNull(b.src)?b.src:a.PaintTypes.NO_PAINT;this.strokeThickness=a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):1;this.fillOpacity=a.notNull(b.fillOpacity)?b.fillOpacity:
1;this.strokeOpacity=a.notNull(b.strokeOpacity)?b.strokeOpacity:1;this.strokeDashArray=a.notNull(b.strokeDash)?b.strokeDash:[];this.repeatPattern=a.notNull(b.repeatPattern)?b.repeatPattern:!0;a.notNull(this.src)&&this.loadImgFromSource()},loadImgFromSource:function(){var b=this,c=new Image;c.src=this.src;c.onload=function(){a.isNull(b.width)&&(b.width=c.width);a.isNull(b.height)&&(b.height=c.height);b.origConfig&&(b.origConfig.width=c.width,b.origConfig.height=c.height)}},createStyle:function(a){this.fill=
new a.oui.style.PatternPaint({src:this.src})},createFixedImageStyle:function(b,c,ka){c={src:this.src,x:ka.x,y:ka.y,width:ka.width,height:ka.height,preserveAspectRatio:!0,opacity:this.fillOpacity};try{var za=b.createImage(c);this.imgGroup=b.createGroup();this.imgGroup.appendChild(za)}catch(Ca){a.util.Logger.warning("MAPVIEWER","OM.style.Area","Cannot create fixed image. Using pattern fill"),this.fill=b.createFillPattern(this.src)}},draw:function(b,c,ka){var za=b.geo,Ca=a.notNull(ka.type)?ka.type:za.type;
c=c.getGraphics();ka.screenPoints?za=ka.screenPoints:(b.screenPoints||b.transformGeometry(za),za=b.screenPoints);var Oa,ob,y;if(("LineString"===Ca||"MultiLineString"===Ca)&&za&&0<za.length)if(y={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,strokeDashArray:this.strokeDashArray},"LineString"===Ca)b.shape=c.drawPath(za,y,ka);else{Ca=c.createGroup();ka.group.appendChild(Ca);ka.group=Ca;Oa=0;for(ob=za.length;Oa<ob;Oa++)c.drawPath(za[Oa],y,ka);b.shape=Ca}else if(this.repeatPattern&&
a.isNull(this.fill)&&(this.fill=c.createFillPattern(this.src)),"Point"===Ca||"OrientedPoint"===Ca||"MultiPoint"===Ca||"OrientedMultiPoint"===Ca)if(y=a.gv.defaultMarkerStyleWidth,Oa=a.gv.defaultMarkerStyleHeight,y=[{shape:{type:"circle",cx:y/2,cy:Oa/2,width:y,height:Oa,scaleX:1,scaleY:1},style:this}],"MultiPoint"===Ca||"OrientedMultiPoint"===Ca){Ca=c.createGroup();ka.group.appendChild(Ca);ka.group=Ca;Oa=0;for(ob=za.length;Oa<ob;Oa++)c.drawVectorMarker({x:za[Oa].x,y:za[Oa].y},y,ka);b.shape=Ca}else b.shape=
c.drawVectorMarker({x:za.x,y:za.y},y,ka);else if(za&&0!==za.length)if(y={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,strokeDashArray:this.strokeDashArray,fill:this.fill,fillOpacity:this.fillOpacity},"Rectangle"===Ca)if(!1===this.repeatPattern){y.fill=null;Ca={src:this.src,x:za.x,y:za.y,width:za.width,height:za.height,preserveAspectRatio:!0,opacity:this.fillOpacity};Oa=c.createGroup("imageGroup");ka.group.appendChild(Oa);ka.group=Oa;ka.enableCache=!0;try{c.drawImage(za,
Ca,ka)}catch(A){a.util.Logger.warning("MAPVIEWER","OM.style.Area","Cannot create nonpattern area style:"),a.util.Logger.warning("MAPVIEWER",A)}Ca=ka.group;Oa=c.createGroup();ka.group.appendChild(Oa);ka.group=Oa;c.drawRectangle(za,y,ka);Oa.appendChild(Ca);b.shape=Ca}else b.shape=c.drawRectangle(za,y,ka);else if("Polygon"===Ca)b.shape=c.drawPath(za,y,ka);else if("MultiPolygon"===Ca){Ca=c.createGroup();ka.group.appendChild(Ca);ka.group=Ca;Oa=0;for(ob=za.length;Oa<ob;Oa++)c.drawPath(za[Oa],y,ka);b.shape=
Ca}},toXMLString:function(){var b;b=""+('\x3cstyle name\x3d"'+this.getStyleName()+'"\x3e');b=b+'\x3cg class\x3d"area" style\x3d"'+(a.notNull(this.stroke)?"stroke:"+this.stroke+";":"");b+=a.notNull(this.strokeOpacity)?"stroke-opacity:"+Math.min(Math.round(255*this.strokeOpacity),255)+";":"";b+=a.notNull(this.fill)?"fill:"+this.fill+";":"";b+=a.notNull(this.fillOpacity)?"fill-opacity:"+Math.min(Math.round(255*this.fillOpacity),255)+";":"";return b+='"\x3e\x3c/g\x3e\x3c/style\x3e'}});a.style.Formatter=
a.Class.extend({initialize:function(b){this.scale=b&&b.scale||"logarithm";this.style=b?b.style:null;this.numClasses=b&&b.numClasses||7;a.isNull(this.numClasses)&&(this.numClasses=0)},resolve:function(a,b,c){return null},getScale:function(){return this.scale},getStyle:function(){return this.style},getNumClasses:function(){return this.numClasses}});a.style.ColorFormatter=a.style.Formatter.extend({initialize:function ya(b){ya.base.call(this,b);this.baseColors=b.colors;a.isNull(this.baseColors)&&(this.baseColors=
a.style.colorbrewer.PuBuGn["7"]);this.defaultColor=b.defaultColor;a.isNull(this.defaultColor)&&(a.notNull(this.style)&&a.notNull(this.style.fill)?this.defaultColor=this.style.fill:this.defaultColor=a.PaintTypes.NO_PAINT)},resolve:function(b,c){var za=this.baseColors,Ca=this.numClasses||za.length;if(a.isNull(b)||""===b)return this.defaultColor;if(this.scale&&0===this.scale.indexOf("log"))var Oa=c.getMin(),ob=c.getMax(),Oa=Math.log(Oa),Ca=(Math.log(ob)-Oa)/Ca,Ca=parseInt((Math.log(b)-Oa)/Ca);else Ca=
(c.getMax()-c.getMin())/Ca,Ca=parseInt((b-c.getMin())/Ca);return isNaN(Ca)?this.defaultColor:Ca>=za.length?za[za.length-1]:za[Ca]},getBaseColors:function(a){return this.baseColors},setColors:function(a){this.baseColors=a},getDefaultColor:function(){return this.defaultColor},setDefaultColor:function(a){this.defaultColor=a}});a.style.SizeFormatter=a.style.Formatter.extend({initialize:function ka(b){ka.base.call(this,b);this.startingSize=b.startingSize;a.isNull(this.startingSize)&&(a.notNull(this.style)?
this.startingSize=this.style.origConfig.width:this.startingSize=15);this.defaultSize=b.defaultSize;a.isNull(this.defaultSize)&&(this.defaultSize=0);this.delta=b.delta||5;this.lengthUnit=a.notNull(b.lengthUnit)?b.lengthUnit:"pixel"},resolve:function(b,c,Ca){b=this.doResolve(b,c);c=this.lengthUnit.toLowerCase();"pixel"!==c&&a.notNull(Ca)&&a.notNull(Ca.parentLayer)&&a.notNull(Ca.parentLayer.parentMap)&&(Ca=a.util.GeomUtil.getCurrentDistancePerPixel(Ca.parentLayer.parentMap.getMapContext()),c=a.gv.getUnitFactor(c),
0!==c&&(Ca/=c),b/=Ca);return b},doResolve:function(b,c){if(a.isNull(b)||""===b)return this.defaultSize;var Ca=this.delta,Oa=this.numClasses,ob=this.startingSize;if(this.scale&&0===this.scale.indexOf("log")){var y=c.getMin(),A=c.getMax();if(0>=y){var m=1-y,y=y+m,A=A+m;b+=m}y=Math.log(y);Oa=(Math.log(A)-y)/Oa;Oa=parseInt((Math.log(b)-y)/Oa)}else Oa=(c.getMax()-c.getMin())/Oa,Oa=parseInt((b-c.getMin())/Oa);isNaN(Oa)&&(Oa=0);return ob+Ca*Oa},getStartingSize:function(){return this.minSize},getDefaultSize:function(){return this.defaultSize}});
a.style.Div=a.style.Style.extend({initialize:function za(b){za.base.call(this,b);b=b||{};this.showOnPoint=1;this.lengthUnit=a.notNull(b.lengthUnit)?b.lengthUnit:"pixel";this.width=b.width;this.height=b.height;this.callback=b.customRenderer;this.html=b.html},draw:function(b,c,Oa){!1!==this.appliable(b)&&(Oa=this.getCustomLayerDiv(b),this.setPosition(Oa,b,c),a.notNull(this.html)?Oa.html(this.html):this.callback(Oa[0],b))},appliable:function(a){switch(a.getGeometry().getType()){case "Point":case "MultiPoint":case "OrientedMultiPoint":case "Polygon":case "MultiPolygon":return!0}return!1},
resolve:function(b,c){if(this.bindings&&0!==this.bindings.length){for(var Oa=0,ob=this.bindings.length;Oa<ob;Oa++){var y=this.bindings[Oa],A=this.resolveBinding(y,b);"SIZE"===y.attribute?this.origConfig.width&&this.origConfig.height&&this.origConfig.width!==this.origConfig.height?(this.height=this.origConfig.height*A/this.origConfig.width,this.width=A):this.height=this.width=A:"WIDTH"===y.attribute?this.width=A:"HEIGHT"===y.attribute&&(this.height=A)}(a.isNull(this.width)||isNaN(this.width))&&a.notNull(this.origConfig.width)&&
(this.width=this.origConfig.width);(a.isNull(this.height)||isNaN(this.height))&&a.notNull(this.origConfig.height)&&(this.height=this.origConfig.height);this.realWidth=this.width;this.realHeight=this.height}else a.style.Style.calculateStyleSize(this,c)},setPosition:function(a,b,c){this.resolve(b,c);var ob=this.realWidth,y=this.realHeight,A=c.getTransform(),m=b.parentLayer;c=c.getCenterPoint();var k=this.getCenterPoint(b);b=A.toScreenXLength(k.getX()-c.getX())+m.orgWidth/2;var k=A.toScreenYLength(-(k.getY()-
c.getY()))+m.orgHeight/2,aa=A.toScreenXLength(m.dataBufferWindow.x+m.dataBufferWindow.w/2-c.getX()),A=A.toScreenYLength(-(m.dataBufferWindow.y+m.dataBufferWindow.h/2-c.getY()));a.parent().css({left:aa,top:A});a.css({left:b-aa+"px",top:k-A+"px",width:ob+"px",height:y+"px"})},getCenterPoint:function(b){b=b.getGeometry().getMIR();return new a.geometry.Point((b.getMinX()+b.getMaxX())/2,(b.getMinY()+b.getMaxY())/2,b.srid)},getCustomLayerDiv:function(b){var c=b.parentLayer,Oa=c.getDivId("f_"+b.id),ob=a.$("#"+
Oa);0>=ob.length&&a.notNull(c.parentMap)&&(Oa=a.$("\x3cdiv id\x3d'"+Oa+"' style\x3d'position:absolute;overflow:hidden'\x3e"),Oa.css({display:"block"}),c.getCustomLayerDiv().append(Oa),ob=b.$customDiv=Oa);ob.data("f",b);return ob},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=["Size","Width","Height"]}});a.style.SourceImageFormatter=a.style.Formatter.extend({initialize:function Ca(b){Ca.base.call(this,b);this.defaultSource=b?b.defaultSource:null;a.isNull(this.defaultSource)&&
(a.notNull(this.style)&&a.notNull(this.style.src)?this.defaultSource=this.style.src:this.defaultSource=a.PaintTypes.NO_PAINT);this.baseSources=b?b.sources:null;a.isNull(this.baseSources)&&(this.baseSources=[this.defaultSource])},resolve:function(a,b,c){},getBaseSources:function(a){return this.baseSources},setSources:function(a){this.baseSources=a},getDefaultSource:function(){return this.defaultSource},setDefaultSource:function(a){this.defaultSource=a}});a.style.StackedMarker=a.style.Marker.extend({initialize:function Oa(c){c=
c||{};c.styleType="StackedMarker";Oa.base.call(this,c);c.styleType="StackedMarker";this.width=a.notNull(c.width)?c.width:null;this.height=a.notNull(c.height)?c.height:null;this.xOffset=a.notNull(c.xOffset)?c.xOffset:0;this.yOffset=a.notNull(c.yOffset)?c.yOffset:0;this.lengthUnit=a.notNull(c.lengthUnit)?c.lengthUnit:"pixel";this.src=a.notNull(c.src)?c.src:null;this.textStyle=a.notNull(c.textStyle)?c.textStyle:null===c.textStyle?null:b;if(this.src&&(a.isNull(this.width)||a.isNull(this.height))){var y=
this,A=new Image;A.src=this.src;A.onload=function(){a.isNull(y.width)&&(y.width=A.width);a.isNull(y.height)&&(y.height=A.height);y.origConfig&&(y.origConfig.width=A.width,y.origConfig.height=A.height)}}(this.markerArray=a.notNull(c.markerArray)?c.markerArray:null)?this.validateMarkers():a.util.Logger.warning(null,"OM.style.StackedMarker","ERROR: Invalid marker array");this.textOffset=c.textOffset?c.textOffset:null;this.showOnPoint=2},validateMarkers:function(){for(var b=0;b<this.markerArray.length;b++){if(!this.markerArray[b]instanceof
a.style.Marker){a.util.Logger.warning(null,"OM.style.StackedMarker","ERROR: Invalid marker array");break}this.markerArray[b].calculateVectorMarkerScale()}},resolve:function(){return this},draw:function(b,c,y){for(var A=c.getGraphics().createGroup(),m=0;m<this.markerArray.length;m++){var k=this.markerArray[m];k.resolve(b);var aa=b.geo,u=b.geo.type;if(y.markerPoint&&b.shapeGroup)y.group.appendChild(A),0!==k.width&&0!==k.height&&k.drawMarker(c,A,y.markerPoint,b.markerText);else if(y.sPoint)y.group.appendChild(A),
k.drawMarker(c,A,y.sPoint,b.markerText);else{if("LineString"===u||"MultiLineString"===u)break;if("Polygon"===u||"MultiPolygon"===u)b.screenPoints||(u=null,b.labelBox?u=new a.geometry.Point((b.labelBox[0]+b.labelBox[2])/2,(b.labelBox[1]+b.labelBox[3])/2,aa.srid):aa.mbr&&(u=new a.geometry.Point((aa.mbr.getMinX()+aa.mbr.getMaxX())/2,(aa.mbr.getMinY()+aa.mbr.getMaxY())/2,aa.srid)),u=b.transformGeometry(u),b.screenPoints||(b.screenPoints=u)),y.group.appendChild(A),k.drawMarker(c,A,b.screenPoints,b.markerText);
else if(b.screenPoints||b.transformGeometry(aa),"Point"===u||"OrientedPoint"===u)if(y.group.appendChild(A),k.drawMarker(c,A,b.screenPoints,b.markerText),k.markerText)k.drawMarker(c,A,b.screenPoints,b.markerText);else if("MultiPoint"===u||"OrientedMultiPoint"===u)for(y.group.appendChild(A),m=0,aa=b.screenPoints.length;m<aa;m++)k.drawMarker(c,A,b.screenPoints[m],b.markerText)}}b.shape=A}});a.style.GlyphMarker=a.style.Marker.extend({initialize:function ob(y){y=y||{};y.styleType="GlyphMarker";ob.base.call(this,
y);y.styleType="GlyphMarker";this.width=a.notNull(y.width)?y.width:null;this.height=a.notNull(y.height)?y.height:null;this.xOffset=a.notNull(y.xOffset)?y.xOffset:0;this.yOffset=a.notNull(y.yOffset)?y.yOffset:0;this.lengthUnit=a.notNull(y.lengthUnit)?y.lengthUnit:"pixel";this.src=a.notNull(y.src)?y.src:null;this.textStyle=a.notNull(y.textStyle)?y.textStyle:null===y.textStyle?null:b;this.glyph=a.notNull(y.glyph)?y.glyph:"?";if(this.src&&(a.isNull(this.width)||a.isNull(this.height))){var A=this,m=new Image;
m.src=this.src;m.onload=function(){a.isNull(A.width)&&(A.width=m.width);a.isNull(A.height)&&(A.height=m.height);A.origConfig&&(A.origConfig.width=m.width,A.origConfig.height=m.height)}}this.textOffset=y.textOffset?y.textOffset:null;this.showOnPoint=2;this.calculateSurrogates(y.glyph)},calculateSurrogates:function(a){if("U"===a.charAt(0)&&"+"===a.charAt(1)){a="0x"+a.substr(2,a.length-1);a=parseInt(a);var b=Math.floor((a-65536)/1024)+55296,b="0x"+b.toString(16);a="0x"+((a-65536)%1024+56320).toString(16);
b=String.fromCharCode(b);this.glyph=b+=String.fromCharCode(a)}},drawMarker:function(a,b,A,m){if(0!==this.width&&0!==this.height)return a=a.getGraphics().createTextNode(this.glyph,this.textStyle,A.x,A.y),b.appendChild(a),a}});a.Column=a.Class.extend({mixin:a.event.EventSource,initialize:function(b){this.keyGetter=b.keyGetter;this.valueGetter=b.valueGetter;this.valueType=b.type||"number";this.measureName=b.measureName||"Measure";this.measureIndex=a.isNull(b.measureIndex)?1:b.measureIndex;b=b.data;var y;
this.numRows=b.length;this.hash=[];this.min=Number.POSITIVE_INFINITY;this.max=Number.NEGATIVE_INFINITY;for(var A,m=0,k=b.length;m<k;m++)y=b[m],A=this.keyGetter.call(y),y=this.valueGetter.call(y,this.measureIndex),a.isNull(y)||(this.hash[A]=y,y<this.min&&(this.min=y),y>this.max&&(this.max=y))},getSize:function(){return this.numRows},getValueOfRow:function(b){return a.isNull(b)||a.isNull(this.hash)?null:this.hash[b]},getValueType:function(){return this.valueType},getMin:function(){return this.min},
getMax:function(){return this.max},getAverage:function(){return 0},getKeys:function(){return[]},getKeyNames:function(){},isMeasure:function(){return!0},getSampleData:function(a){},getMeasureName:function(){return this.measureName},getMeasureIndex:function(){return this.measureIndex}});a.Feature=a.Class.extend({mixin:a.event.EventSource,initialize:function(b,y,A){this.id=b;this.activeIdx=null;this.geo=y?y:null;this.geo instanceof a.geometry.Geometry||!this.geo||(this.geo=a.geometry.Geometry.createGeometry(this.geo,
this.geo.srid));this.shape=this.group=this.graphics=null;this.attributes=A&&a.notNull(A.attributes)?A.attributes:null;this.renderingStyle=A&&a.notNull(A.renderingStyle)?A.renderingStyle:null;this.label=A&&a.notNull(A.label)?A.label:null;this.labelStyle=A&&a.notNull(A.labelStyle)?A.labelStyle:null;this.labelStyleName=A&&a.notNull(A.labelStyleName)?A.labelStyleName:null;this.draggable=A&&a.notNull(A.draggable)?A.draggable:null;this.customContent=A&&a.notNull(A.customContent)?A.customContent:null;this.displayed=
!1;this.visible=!0;this.editable=!1;this.screenTransformObj=null;this.labelOffsetY=this.labelOffsetX=2;this.hover=this.selected=!1;this.tooltipNode=this.tooltipCache=null;this.scaleY=this.scaleX=1;if(this.attributes)for(var m in this.attributes)b=m.toUpperCase(),b!==m&&(this.attributes[b]=this.attributes[m],this.attributes[m]=null,delete this.attributes[m]);this.columnMap=null;this.tiledFeature=!1;this.tileGeometries={};this.clipMap={};this.zoomLevelsGeometries={};this.zoomLevelsGeomClipArea={}},
setGeometry:function(b){if(a.isNull(b))return!1;a.notNull(this.parentLayer)&&this.parentLayer.useRTree&&this.parentLayer.removeFromRtree(this);if(!this.displayed)return this.geo=b,this.screenPoints=null,!0;var y=this.geo.srid;if(b.srid!==y){var A=this;b.transform(y,function(a){A.setGeometry(a)});return!0}this.clearInfoWindow();this.geo=b;this.getShapeIndex();this.remove();this.screenPoints=null;y=this.parentLayer;b=[];var m=y.getFeatureStyles(this);m&&b.push(m);y.otherStyles&&(b=b.concat(y.otherStyles));
if(0===b.length)if(m=y.getDefaultRenderingStyle(this.geo.type))b.push(m);else return!1;b=this.getAllStyles(b);if(this.parentLayer.featureGroupArr&&0<this.parentLayer.featureGroupArr.length)for(this.shapeArray=[],y=0;y<this.parentLayer.featureGroupArr.length;y++){if(a.isNull(this.activeIdx)||this.activeIdx===y)this.group=this.parentLayer.featureGroupArr[y],this.displayFeature(b,-1),this.shapeArray[y]=this.labelShape}else this.displayFeature(b,-1);this.parentLayer.parentMap.wraparound&&this.parentLayer.refresh();
this.startAnimation();return!0},getGeometry:function(){var b=a.geometry.Geometry;this.geo instanceof b||!this.geo||(this.geo=b.createGeometry(this.geo,this.geo.srid));return this.geo},getAttributes:function(){return this.attributes},getAttributeValue:function(b){if("string"!==typeof b||!this.attributes)return null;var y=this.attributes,A=b.toUpperCase();return a.notNull(y[A])?y[A]:(b=this.getAliasColumnName(b))?(b=b.toUpperCase(),y[b]):null},hasAttributes:function(){return this.attributes?!0:!1},
getAliasColumnName:function(b){if("string"!==typeof b||!this.columnMap)return null;var y=this.columnMap;b=b.toUpperCase();return y&&a.notNull(y[b])?y[b]:null},getRealColumnName:function(a){if("string"!==typeof a)return null;var b=this.columnMap;a=a.toUpperCase();if(b)for(var A in b)if(b.hasOwnProperty(A)&&b[A].toUpperCase()===a)return A;return null},getAllStyles:function(b){for(var y=[],y=[],A=0;A<b.length;A++)a.notNull(b[A].animation)&&y.push(b[A].animation);return y=b.concat(y)},setRenderingStyle:function(b){if((!a.isNull(b)||
!a.isNull(this.parentLayer)&&!a.isNull(this.parentLayer.otherStyles)&&0!==this.parentLayer.otherStyles.length)&&this.renderingStyle!==b&&(this.renderingStyle=b,this.displayed)){this.getShapeIndex();var y=this;a.notNull(this.shape)&&this.shape.addEventListener(a.event.MouseEvent.MOUSE_OUT,function(a){try{a.target=y.shape,y.shape.dispatchEvent(a)}catch(b){}});this.remove();b=[b];this.parentLayer.otherStyles&&(b=b.concat(this.parentLayer.otherStyles));b=this.getAllStyles(b);if(this.parentLayer.featureGroupArr&&
0<this.parentLayer.featureGroupArr.length){this.shapeArray=[];for(var A=0;A<this.parentLayer.featureGroupArr.length;A++)if(a.isNull(this.activeIdx)||this.activeIdx===A)this.group=this.parentLayer.featureGroupArr[A],this.displayFeature(b,-1),this.shapeArray[A]=this.shape}else this.displayFeature(b,-1);this.setShapeIndex()}},getRenderingStyle:function(){return this.renderingStyle},setLabel:function(b){a.isNull(b)||(this.label=b,this.applyToolTip())},setLabelingStyle:function(b){a.isNull(b)||(this.labelStyle=
b)},getLabelingStyle:function(){return this.labelStyle},isVisible:function(){return this.visible},setVisible:function(b){if(!a.isNull(b))if(this.visible=b,this.displayed){var y=this.graphics;y.setVisible(this.shape,b);this.ghostShape&&y.setVisible(this.ghostShape,b);this.labelShape&&y.setVisible(this.labelShape,b)}else b&&this.displayFeature(this.renderingStyle)},bringForward:function(){this.parentLayer&&this.parentLayer.bringFeatureForward(this)},sendBackward:function(){this.parentLayer&&this.parentLayer.sendFeatureBackward(this)},
bringToTop:function(){this.parentLayer&&this.parentLayer.bringFeatureToTop(this)},sendToBottom:function(){this.parentLayer&&this.parentLayer.sendFeatureToBottom(this)},displayFeature:function(b,y,A){var m=this.geo,k=null,c=null;this.tiledFeature&&(k=this.parentLayer.parentMap.getMapContext(),c=k.getZoomLevel(),a.notNull(A)?this.geo=this.tileGeometries[A][this.id]:this.geo=this.getGeometry());var k=this.geo,u=this.typeIs(k);if((!this.editing||"OrientedPoint"!==u)&&b&&0!==b.length){var C=b[0];if(C&&
!(C instanceof a.style.Style)&&C.dataSource&&C.name){var E=this;b=C.url;a.isNull(b)&&(b=this.parentLayer.type===a.layer.VectorLayer.TYPE_JDBC||this.parentLayer.type===a.layer.VectorLayer.TYPE_PREDEFINED?this.parentLayer.serverURL:this.parentLayer.parentMap.mapviewerURL);a.style.StyleStore.getServerSideStyle(C.dataSource,C.name,{url:b,callback:function(a){E.displayFeature([a],y,A)}})}else{var C=this.graphics,P=this.renderingStyle&&this.renderingStyle.cased?this.parentLayer.getLineGroup():this.group,
W=this.screenTransformObj;if(!(a.isNull(C)||a.isNull(P)||a.isNull(k)||a.isNull(W))){1<b.length&&(W=C.createGroup(),P.appendChild(W),P=W);var W=b.length,M=[],r=null;a.notNull(A)&&a.notNull(this.clipMap)&&a.notNull(this.clipMap[A])&&(r=this.transformGeometry(this.clipMap[A]));for(var q=0;q<W;q++){var N=b[q],Z=N.styleType;if(N.showOnPoint)N.realWidth=null,N.realHeight=null,M.push(N);else{if("GeometryCollection"===u){var ba=this.zoomLevelsGeomClipArea["zoomlevel_"+c],Y=C.createGroup(),qa=Y;P.appendChild(Y);
for(var la=0,oa=k.geometries.length;la<oa;la++){var wa=this.transformGeometry(k.geometries[la]);a.isNull(A)&&this.tiledFeature&&(r=this.transformGeometry(ba[la]),Y=C.createGroup(),qa.appendChild(Y));a.notNull(r)&&Y.setClip([r.x,r.y,r.width+.5,r.height+.5]);N.draw(this,this.parentLayer.parentMap.getMapContext(),{group:Y,type:k.geometries[la].type,screenPoints:wa})}this.shape=qa}else ba=null,a.notNull(A)&&this.tiledFeature&&(ba=this.shape,a.isNull(ba)&&(ba=C.createGroup(),P.appendChild(ba)),P=C.createGroup(),
ba.appendChild(P)),a.notNull(r)&&P.setClip([r.x,r.y,r.width+.5,r.height+.5]),N.draw(this,this.parentLayer.parentMap.getMapContext(),{group:P,idx:y}),a.notNull(r)&&P.setClip(null),a.notNull(A)&&this.tiledFeature&&(this.shape=ba);"AnimationColor"!=Z&&"PulseAnimation"!=Z||!a.notNull(this.shape)||(this.animations=[],this.createAnimation(this.shape,N,"MultiLineString"==u||"LineString"==u))}}0<M.length&&(c=this.parentLayer.parentMap.getMapContext().getUniverse().getSRID(),a.notNull(A)&&this.tiledFeature?
(a.isNotNull(this.chartGroup)&&(this.chartGroup.parentNode&&this.chartGroup.parentNode.removeChild(this.chartGroup),this.chartGroup=null),this.chartGroup=C.createGroup(),P.appendChild(this.chartGroup),P=this.chartGroup,this.labelBox=null,this.createLabelBox(m),this.getPointPosition(M,this.labelBox,P,c,m)):(a.isNull(this.labelBox)&&this.createLabelBox(),this.getPointPosition(M,this.labelBox,P,c)));1<W&&(this.shape=P);this.displayed=!0;this.applyToolTip();this.ghostGeom&&(this.drawGhostGeom(this.ghostGeom,
b),this.drawGhostLabel(this.ghostGeom));if(this.shapeGroup&&!this.visible)for(q=1;q<this.shapeGroup.length;q++)this.graphics.setVisible(this.shapeGroup[q],!1);else this.shape&&!this.visible&&this.graphics.setVisible(this.shape,!1);this.ghostShape&&!this.visible&&this.graphics.setVisible(this.ghostShape,!1);this.resumeMoveAnimation();a.notNull(this.parentLayer)&&this.parentLayer.useRTree&&(this.tiledFeature?a.notNull(A)&&(this.parentLayer.addToRtree(this,k),this.parentLayer.updatedSearchWindow(this,
u)):(this.parentLayer.addToRtree(this),this.parentLayer.updatedSearchWindow(this,u)));this.tiledFeature&&(this.geo=m)}}}},getFeatureScreenPosition:function(){return this.featurePosition},transformGeometry:function(a){var b=this.parentLayer.parentMap.getMapContext().getTransform(),A=a.dim?a.dim:2,m=a.type,k=a.coordinates,c,u,C,E,P,W;if("Point"===m)c=b.toScreenPoint(k[0],k[1]);else if("OrientedPoint"===m)c=b.toScreenPoint(k[0],k[1]),u=k[A],C=k[A+1],u=-Math.atan2(C,u),c.angle=u;else if("MultiPoint"===
m||"OrientedMultiPoint"===m)for(c=[],E=0,W=k.length;E<W;E++)P=b.toScreenPoint(k[E][0],k[E][1]),"OrientedMultiPoint"===m&&(u=k[E][A],C=k[E][A+1],u=-Math.atan2(C,u),P.angle=u),c.push(P);else if("LineString"===m)c=(u=b.transformSegment(k,2,A))?[u]:null;else if("MultiLineString"===m)for(c=[],P=0,m=k.length;P<m;P++)(u=b.transformSegment(k[P],2,A))&&c.push([u]);else if("Polygon"==m)for(c=[],E=0,W=k.length;E<W;E++)(u=b.transformSegment(k[E],1,A))&&c.push(u);else if("MultiPolygon"===m)for(c=[],P=0,m=k.length;P<
m;P++){C=[];E=0;for(W=k[P].length;E<W;E++)(u=b.transformSegment(k[P][E],2,A))&&C.push(u);0<C.length&&c.push(C)}else"Rectangle"===m&&(P=b.toScreenPoint(k[0],k[3]),A=b.toScreenXLength(k[2]-k[0]),b=b.toScreenYLength(k[3]-k[1]),c={x:P.x,y:P.y,width:A,height:b});this.geo===a&&(this.screenPoints=c);return this.featurePosition=c},drawSinglePoint:function(a,b,A,m){var k={group:b,id:"pot"};A.angle&&(k.angle=A.angle);k.xOffset=m.xOffset;k.yOffset=m.yOffset;var c;m&&m.src?(k.enableCache=!0,c=a.drawImageMarker({x:A.x,
y:A.y},m,k)):m&&m.resolve&&(m.resolve(this),c=m.drawMarker(this.parentLayer.parentMap.getMapContext(),b,A,null));return c},drawRectangle:function(a,b,A,m,k){var c,u,C,E;if(!this.screenPoints||k)A=A.coordinates,u=this.screenTransformObj.toScreenPoint(A[0],A[3]),c=u.x,u=u.y,C=this.screenTransformObj.toScreenXLength(A[2]-A[0]),E=this.screenTransformObj.toScreenYLength(A[3]-A[1]),k||(this.screenPoints={x:c,y:u,width:C,height:E});C=a.drawRectangle({x:c,y:u,width:C,height:E},m,{group:b,id:"rec"});A=(this.geo.getMBR().getMinX()+
this.geo.getMBR().getMaxX())/2;E=(this.geo.getMBR().getMinY()+this.geo.getMBR().getMaxY())/2;A=this.screenTransformObj.toScreenPoint(A,E);this.parentLayer.leadLine&&(this.line=a.drawPath([[c,u,A.x,A.y]],m,{group:b}),this.line.feature=this);k||(this.shape=C);return C},remove:function(){var a=this.shape;if(a){this.graphics.remove(a);this.shape=null;if(this.shapeGroup)for(var a=this.shapeGroup.length,b=0;b<a;b++)this.shapeGroup[b]&&this.graphics.remove(this.shapeGroup[b]);this.shapeGroup=null;if(this.shapeArray){a=
this.shapeArray.length;for(b=0;b<a;b++)this.shapeArray[b]&&(this.shapeArray[b].feature=null,this.graphics.remove(this.shapeArray[b]));this.shapeArray=null}}},typeIs:function(b){var y=a.geometry;return b instanceof y.Circle?"Circle":b instanceof y.Rectangle?"Rectangle":b.type},move:function(b,y,A){var m=this.parentLayer;a.notNull(m)&&m.removeFromRtree(this);b=-b;var k,c;if(this.displayed){c=this.geo.type;if("GeometryCollection"!=c){var u=this.screenPoints;k=c;if("Point"==k||"OrientedPoint"==k||"Rectangle"==
k)u.x+=b,u.y-=y;else if("MultiPoint"==k||"OrientedMultiPoint"==k){var C=u.length;for(k=0;k<C;k++)u[k].x+=b,u[k].y-=y}else a.util.GeomUtil.moveCoordinates(u,b,-y,null,null,this.parentLayer.parentMap.getMapContext())}b*=A.resolution;u=y*A.resolution*A.stretchRatio;if(this.geo instanceof a.geometry.Geometry)this.geo.move(b,u,this.parentLayer.parentMap.getMapContext());else if("GeometryCollection"!=c)a.util.GeomUtil.moveCoordinates(this.geo.coordinates,b,u,"OrientedPoint"==c||"OrientedMultiPoint"==c?
!0:!1,this.geo.dim,this.parentLayer.parentMap.getMapContext());else for(k=this.geo.geometries,A=k.length,y=0;y<A;y++)c=k[y].type,c="OrientedPoint"==c||"OrientedMultiPoint"==c?!0:!1,a.util.GeomUtil.moveCoordinates(k[y].coordinates,b,u,c,k[y].dim,this.parentLayer.parentMap.getMapContext());this.labelBox&&(this.labelBox=[this.labelBox[0]+b,this.labelBox[1]+u,this.labelBox[2]+b,this.labelBox[3]+u]);a.notNull(m)&&m.addToRtree(this);return this.geo}},addLabel:function(b){if(this.displayed&&this.parentLayer){if(!this.label){if(!this.attributes)return;
this.label=this.parentLayer.labelColumn?this.attributes[this.parentLayer.labelColumn.toUpperCase()]:this.attributes._LABEL_}if(this.label){var y=this.getLabelingStyle();a.isNull(y)&&(y=a.style.StyleStore.defaulTextStyle,this.setLabelingStyle(y));var A=this.geo.type;if(a.notNull(y))if(y.resolve(this),a.style.Style.calculateStyleSize(this.labelStyle,this.parentLayer.parentMap.getMapContext()),"Point"==A||"OrientedPoint"==A)this.addPointLabel(b);else if("Polygon"==A||"MultiPolygon"==A){if(this.addPolygonLabel(b),
!this.labelShape&&(b=this.parentLayer.createShadowGeometry(this)))this.drawGhostGeom(b,[this.renderingStyle]),this.drawGhostLabel(b)}else"LineString"!=A&&"MultiLineString"!=A||this.addLineLabel(b);else a.util.Logger.warning(null,"Feature","No labeling style present for feature")}}},addPointLabel:function(b){var y=this.graphics.getTextSize(this.label,this.labelStyle);y.w=parseInt(y.w)-2;y.h=parseInt(y.h)-4;var A=this.screenPoints.x,m=this.screenPoints.y,k=this.markerSize?this.markerSize.w:this.renderingStyle.width,
c=this.markerSize?this.markerSize.h:this.renderingStyle.height;a.isNull(k)&&!a.isNull(this.markerWidth)&&(k=this.markerWidth);a.isNull(c)&&!a.isNull(this.markerHeight)&&(c=this.markerHeight);var u;"OrientedPoint"===this.geo.type&&(u=-Math.atan2(this.geo.getOrientationY(),this.geo.getOrientationX()));var C={},E=A-k/2-this.labelOffsetX,P=E-y.w,W=m-y.h/2,M=m+y.h/2;C.L=[P,W,E,M];u&&(0>=u&&u>=-Math.PI/2&&(P=A-(k/2+this.labelOffsetX+y.w)*Math.cos(-u),W=m+(k/2+this.labelOffsetX)*Math.sin(-u),E=A-(k/2+this.labelOffsetX)*
Math.cos(-u),M=m+(k/2+this.labelOffsetX+y.w)*Math.sin(-u),C.L=[P,W,E,M],C.LL=[P,M]),u>=-Math.PI&&u<-Math.PI/2&&(P=A+(k/2+this.labelOffsetX)*Math.cos(Math.PI+u),W=m+(k/2+this.labelOffsetX)*Math.sin(Math.PI+u),E=A+(k/2+this.labelOffsetX+y.w)*Math.cos(Math.PI+u),M=m+(k/2+this.labelOffsetX+y.w)*Math.sin(Math.PI+u),C.L=[P,W,E,M],C.LL=[P,W]),u<=Math.PI&&u>=Math.PI/2&&(P=A+(k/2+this.labelOffsetX)*Math.cos(Math.PI-u),W=m-(k/2+this.labelOffsetX+y.w)*Math.sin(Math.PI-u),E=A+(k/2+this.labelOffsetX+y.w)*Math.cos(Math.PI-
u),M=m-(k/2+this.labelOffsetX)*Math.sin(Math.PI-u),C.L=[P,W,E,M],C.LL=[P,M]),u<Math.PI/2&&0<u&&(P=A-(k/2+this.labelOffsetX+y.w)*Math.cos(u),W=m-(k/2+this.labelOffsetX+y.w)*Math.sin(u),E=A-(k/2+this.labelOffsetX)*Math.cos(u),M=m-(k/2+this.labelOffsetX)*Math.sin(u),C.L=[P,W,E,M],C.LL=[P,W]));P=A+k/2+this.labelOffsetX;E=P+y.w;C.R=[P,W,E,M];u&&(0>=u&&u>=-Math.PI/2&&(P=A+(k/2+this.labelOffsetX)*Math.cos(-u),W=m-(k/2+this.labelOffsetX+y.w)*Math.sin(-u),E=A+(k/2+this.labelOffsetX+y.w)*Math.cos(-u),M=m-(k/
2+this.labelOffsetX)*Math.sin(-u),C.R=[P,W,E,M],C.RR=[P,M]),u>=-Math.PI&&u<-Math.PI/2&&(P=A-(k/2+this.labelOffsetX+y.w)*Math.cos(u+Math.PI),W=m-(k/2+this.labelOffsetX+y.w)*Math.sin(u+Math.PI),E=A-(k/2+this.labelOffsetX)*Math.cos(u+Math.PI),M=m-(k/2+this.labelOffsetX)*Math.sin(u+Math.PI),C.R=[P,W,E,M],C.RR=[P,W]),u<=Math.PI&&u>=Math.PI/2&&(P=A-(k/2+this.labelOffsetX+y.w)*Math.cos(Math.PI-u),W=m+(k/2+this.labelOffsetX)*Math.sin(Math.PI-u),E=A-(k/2+this.labelOffsetX)*Math.cos(Math.PI-u),M=m+(k/2+this.labelOffsetX+
y.w)*Math.sin(Math.PI-u),C.R=[P,W,E,M],C.RR=[P,M]),u<Math.PI/2&&0<u&&(P=A+(k/2+this.labelOffsetX)*Math.cos(u),W=m+(k/2+this.labelOffsetX)*Math.sin(u),E=A+(k/2+this.labelOffsetX+y.w)*Math.cos(u),M=m+(k/2+this.labelOffsetX+y.w)*Math.sin(u),C.R=[P,W,E,M],C.RR=[P,W]));P=A-y.w/2;E=P+y.w;M=m-c/2-this.labelOffsetY;W=M-y.h;C.T=[P,W,E,M];P=A-y.w/2;E=P+y.w;W=m+c/2+this.labelOffsetY;M=W+y.h;C.B=[P,W,E,M];m=a.gv.labelDisplayOrder;A=a.gv.orientedLabelDisplayOrder;if(u)for(m=0;m<A.length&&(y=C[A[m]],E=C[A[m]+A[m]],
!this.addLabelNode(b,y,E[0],E[1],{angle:u,w:k,h:c}));m++);else for(k=0;k<m.length&&(y=C[m[k]],!this.addLabelNode(b,y,y[0],y[3]-1));k++);},createLabelBox:function(b){var y=null;if(y=a.notNull(b)?b.getMIR():this.getGeometry().getMIR())this.labelBox=[y.getMinX(),y.getMinY(),y.getMaxX(),y.getMaxY()]},addPolygonLabel:function(a){this.labelBox||this.createLabelBox();if(this.labelBox){var b=this.graphics.getTextSize(this.label,this.labelStyle),A=0<this.label.indexOf("\n")?!0:!1;b.w=parseInt(b.w)-2;b.h=parseInt(b.h)-
4;var m=this.screenTransformObj.toScreenPoint((this.labelBox[0]+this.labelBox[2])/2,(this.labelBox[1]+this.labelBox[3])/2),k=m.x,c=m.y,u=k-b.w/2,C=k+b.w/2,m=c-b.h/2,E=c+b.h/2,P=this.screenTransformObj.toScreenPoint(this.labelBox[0],this.labelBox[1]),W=this.screenTransformObj.toScreenPoint(this.labelBox[2],this.labelBox[3]),M=W.x-P.x,P=P.y-W.y;this.labelStyle.sticky&&(M*=3,P*=1.5);if(!(b.h>P||(b.w<=M&&b.h<=P&&!A&&(C=[u-5,m-5,C+5,E+5],this.addLabelNode(a,C,u,E-1),this.labelShape&&(this.labelShape.feature=
this)),this.labelShape))){u=this.label.split(" ");C=E=0;for(W=u.length;C<W;C++)b=this.graphics.getTextSize(u[C],this.labelStyle),b.w>E&&(E=b.w);if(E>M)if(this.labelStyle.sticky&&A)M*=3,P*=1.5;else return;A=this.graphics.createTextBlock(this.label,this.labelStyle,k,c,M);A.h>P||(C=[k-A.w/2-5,m-5,k+A.w/2+5,m+A.h+5],a.conflicts(C)||(a.insert(C),A.node.translate(0,(b.h-A.h)/2),this.parentLayer.labelGroup.appendChild(A.node),this.labelShape=A.node,this.labelShape.feature=this))}}},addLineLabel:function(a){var b,
A,m;if(this.labelStyle&&"Marker"==this.labelStyle.styleType){b=this.labelStyle.width/2;A=this.labelStyle.height/2;m=4*Math.max(b,A);m=this.getLabelMarkerPos(m);for(var k=0,c=m?3<m.length?3:m.length:0;k<c;k++)this.addMarkerLabelNode(a,[m[k].x-b,m[k].y-A,m[k].x+b,m[k].y+A],m[k])}else A=this.graphics.getTextSize(this.label,this.labelStyle),b=A.w/2,A=A.h/2-2,m=4*Math.max(b,A),this.getLineTextPos(m,b,A,a)},addLabelNode:function(b,y,A,m,k){k&&k.angle&&(y=[y[0]+3,y[1]+3,y[2],y[3]]);if(b.conflicts(y))return!1;
var c,u=this.label,C=0;k&&k.angle?(c=new this.graphics.oui.geom.Matrix,C=k.angle,k.angle>=-Math.PI&&k.angle<-Math.PI/2&&(C=k.angle+Math.PI,u=this.label.split(" ").reverse().join(" ")),k.angle<Math.PI&&k.angle>=Math.PI/2&&(C=k.angle-Math.PI,u=this.label.split(" ").reverse().join(" ")),c.rotate(C,A,m)):k&&k.transform&&(c=k.transform);0<=u.indexOf("\n")?(u=y[3]-y[1],A+=(y[2]-y[0])/2,A=this.graphics.createTextBlock(this.label,this.labelStyle,A,m-u/2).node):A=this.graphics.createTextNode(u,this.labelStyle,
A,m);a.notNull(c)&&A.applyStyle({transform:c});b.insert(y);k&&k.group?k.group.appendChild(A):(this.parentLayer.labelGroup.appendChild(A),this.labelShape=A);return!0},addMarkerLabelNode:function(a,b,A){if(a.conflicts(b))return!1;this.labelShape=this.graphics.createGroup();this.parentLayer.labelGroup.appendChild(this.labelShape);this.labelShape.feature=this;this.labelShape.applyStyle({cursor:this.parentLayer.mouseCursor});this.drawSinglePoint(this.graphics,this.labelShape,A,this.labelStyle);if(null!==
this.labelStyle.textStyle){var m=this.graphics.getTextSize(this.label,{});A=this.graphics.createTextNode(this.label,this.labelStyle.textStyle,A.x-m.w/2,A.y+m.h/2-2);this.labelShape.appendChild(A);a.insert(b)}return!0},getTip:function(){if("string"===typeof this.id&&0===this.id.indexOf("_mul"))return null;var b=this.parentLayer;return!a.isNull(b)&&b.showToolTip?b.toolTipCustomizer?(b=b.toolTipCustomizer(this),"string"===typeof b?b+"":b):this.label?this.label+"":b.labelColumn&&a.notNull(this.attributes)&&
a.notNull(this.attributes[b.labelColumn.toUpperCase()])?this.attributes[b.labelColumn.toUpperCase()]+"":this.attributes&&a.notNull(this.attributes._LABEL_)?this.attributes._LABEL_+"":null:null},applyToolTip:function(){if(this.displayed){var b;b=this.getTip();"string"!==typeof b?a.isNull(this.tooltipCache)||this.tooltipCache.toString()!=b.toString()?(this.tooltipCache=b,this.tooltipNode=b=this.buildVaTooltip(b)):b=this.tooltipNode:a.isNull(this.tooltipNode)||this.tooltipNode!=b?this.tooltipNode=b:
b=this.tooltipNode;if(this.shapeGroup)for(var y=0;y<this.shapeGroup.length;y++)!b||this.renderingStyle&&this.renderingStyle.enableHighlight||this.shapeGroup[y].applyStyle({tooltip:b}),this.shapeGroup[y].feature=this;else this.shape&&(!b||this.renderingStyle&&this.renderingStyle.enableHighlight||this.shape.applyStyle({tooltip:b}),this.shape.feature=this)}},buildVaTooltip:function(b){var y=this.graphics;a.isNull(y)&&(y=this.parentLayer.parentMap.getMapContext().getGraphics());var A=y.createGroup({opacity:1,
visibility:"visible"}),m,k,c;if(a.isNull(b)||a.isNull(b.titlesArray)||a.isNull(b.headersArray)||a.isNull(b.contentsArray))return null;m=b.titlesArray;k=b.headersArray;c=b.contentsArray;Array.isArray(m)||(m=[],m.push(b.title));Array.isArray(k)||(k=[],k.push(b.title));Array.isArray(c)||(c=[],c.push(b.title));if(c.length!==k.length)return null;var u=y.getInnerTooltipStyle(),C=u.titleStyle;b=u.headerStyle;for(var u=u.contentStyle,E={hAlign:b.hAlign},P={hAlign:u.hAlign},y=y.oui.load({name:"mainVBox",type:"vbox",
children:[{name:"titleBox",type:"hbox",layout:{hAlign:C.hAlign}},{name:"headerAndContentBox",type:"hbox",children:[{name:"headerBox",type:"vbox"},{name:"contentBox",type:"vbox"}]}]}),W=0,M=m.length;W<M;W++)y.titleBox.load([{type:"text",textValue:m[W]+" ",fontWeight:C.fontWeight,fontFamily:C.fontFamily,fontStyle:C.fontStyle,fontSize:C.fontSize,fill:C.fill}]);m=0;for(C=k.length;m<C;m++)y.headerAndContentBox.headerBox.load([{type:"text",textValue:k[m]+" ",fontWeight:b.fontWeight,fontFamily:b.fontFamily,
fontStyle:b.fontStyle,fontSize:b.fontSize,fill:b.fill,layout:E}]),y.headerAndContentBox.contentBox.load([{type:"text",textValue:c[m]+" ",fontWeight:u.fontWeight,fontFamily:u.fontFamily,fontStyle:u.fontStile,fontSize:u.fontSize,fill:u.fill,layout:P}]);A.appendChild(y);return A},createAnimation:function(a,b,A){if(a.hasChildNodes())for(a=a.firstChild;a;)this.createAnimation(a,b,A),a=a.nextSibling;else Array.prototype.push.apply(this.animations,b.createAnimation(a,this.graphics,A))},startAnimation:function(){if(this.animations)for(var a=
this.animations.length,b=0;b<a;b++)this.animations[b].beginAt(0)},stopAnimation:function(){if(this.animations)for(var a=this.animations.length,b=0;b<a;b++)this.animations[b].endAt(0)},clearAnimation:function(){if(this.animations)for(var a=this.animations.length,b=0;b<a;b++)this.animations[b].unplug(),this.animations[b].endAt(0)},animateToNewLocation:function(b,y){if(this.moveAnimation)this.stopMoveAnimation();else{this.originalGeo=this.geo;var A=b.coordinates,m,k,c;if("Point"==b.type||"OrientedPoint"==
b.type)this.movePoints=[A[0],A[1]];else if("MultiPoint"==b.type||"OrientedMultiPoint"==b.type){m=A.length;k=[];for(c=0;c<m;c++)k=k.concat(A[c][0],A[c][1]);this.movePoints=k}else if("LineString"==b.type||"MultiLineString"==b.type){m=A.length;k=[];for(c=0;c<m;c++)k.push(A[c]);this.movePoints=k}A=1;try{var u=this.parentLayer.parentMap,C=u.getMapContext(),E=C.getUniverse(),P=C.getZoomLevel();if(E&&E.zoomLevels)var P=u.checkZoomLevel(P),W=E.zoomLevels[P].resolution,M=E.zoomLevels[P].stretchRatio,A=Math.sqrt(Math.pow(W,
2)+Math.pow(W*M,2))/2}catch(r){}(this.movePoints=a.util.GeomUtil.simplifyCoordinates(this.movePoints,A))&&2<=this.movePoints.length&&(this.moveTime=y&&a.notNull(y.time)?y.time:300,this.moveLoop=y&&y.loop,this.moveBound=y&&y.bounce,this.moveOriented="OrientedPoint"===this.geo.type?!0:!1,this.moveStep=y&&y.step?y.step:5,this.animateToNewPoint(0))}},animateToNewPoint:function(b){var y=this.movePoints[b],A=this.movePoints[b+1];this.currentTarget=b;if(this.displayed&&this.shape){var m=this.screenPoints,
k=this.screenTransformObj.toScreenPoint(y,A);b=k.x-m.x;k=k.y-m.y;if(Math.abs(b)<=this.moveStep&&Math.abs(k)<=this.moveStep)this.movePoints&&!this.reverse&&this.movePoints.length>=this.currentTarget+4?this.animateToNewPoint(this.currentTarget+2):this.movePoints&&this.reverse&&0<this.currentTarget?this.animateToNewPoint(this.currentTarget-2):(this.geo=this.moveOriented?new a.geometry.Point(y,A,this.geo.srid,this.geo.coordinates[2],this.geo.coordinates[3]):new a.geometry.Point(y,A,this.geo.srid),this.finishAnimation());
else{var c;if(this.moveOriented){this.geo=new a.geometry.Point(this.geo.getX(),this.geo.getY(),this.geo.srid,b,-k);var u=this.parentLayer;c=u.getFeatureStyles(this);if(a.notNull(this.animations)&&0<this.animations.length){this.screenPoints=null;for(var C={},E=0;E<this.animations.length;E++){var P=this.animations[E].getTargetNode();a.notNull(P)&&(C[P.parentNode._id]=P.parentNode._id)}E=new this.graphics.oui.geom.Matrix;a.style.Style.calculateStyleSize(c,u.parentMap.getMapContext());for(var W,u=0;u<
this.shape.childrenCount;u++)if(P=this.shape.getChildAt(u),a.isNull(C[P._id])){W=P;break}C=W.getLocalBounds();E.rotate(Math.atan2(k,b),C.x+c.realWidth/2,C.y+c.realHeight/2);W.setTransformMatrix(E);this.displayed=!0}else this.remove(),this.screenPoints=null,c.draw(this,this.parentLayer.parentMap.getMapContext(),{group:this.group}),this.displayed=!0,this.applyToolTip()}c=this.shape._style;W=m.x;if(c.width||c.x)W-=c.width/2+c.x;m=m.y;if(c.height||c.y)m-=c.height/2+c.y;this.moveAnimationDef={startX:W,
startY:m,endX:W+b,endY:m+k,moveX:b,moveY:k};m=Math.sqrt(b*b+k*k)/10*this.moveTime/1E3;c=this.shape.getTransformMatrix();W=c.clone();this.moveOriented?(this.moveAnimationDef.angleInRadius=Math.atan2(k,b),1!=this.scaleX&&1!=this.scaleY?(C=this.renderingStyle.realWidth/2,E=this.renderingStyle.realHeight/2,W.rotate(-this.moveAnimationDef.angleInRadius,C,E),W.translate(b/this.scaleX,k/this.scaleY),W.rotate(this.moveAnimationDef.angleInRadius,C,E)):1===c.a&&0===c.b&&0===c.c&&1===c.d?W.translate(b,k):(this.dis=
Math.sqrt(b*b+k*k),W.translate(this.dis,0))):W.translate(b/this.scaleX,k/this.scaleY);this.moveAnimation=new this.graphics.oui.anim.AnimateStyle({targetNode:this.shape,dur:m,animValues:{transform:{beginValue:c,endValue:W,interpolator:function(a,b,y){var A=a.tx,A=(b.tx-A)*y+A,k=a.ty;y=(b.ty-k)*y+k;a=a.clone();a.tx=A;a.ty=y;a.b=b.b;a.c=b.c;a.a=b.a;a.b=b.b;return a}}}});this.moveAnimation.beginAt(0);var M=this;this.moveAnimation.addEventListener(this.graphics.oui.SyncEvents.END,function(){if(!a.isNull(M.moveAnimation)){var b=
M.moveAnimationDef,k=0,m=0,c;if(a.notNull(M.progress)){k=parseInt(b.moveX*M.progress);m=parseInt(b.moveY*M.progress);if(0!==k||0!==m)c=b.startX+k,b=b.startY+m,M.shape&&M.moveOriented&&(new M.graphics.oui.geom.Matrix).translate(c,b),M.parentLayer&&M.parentLayer.parentMap&&M.screenTransformObj&&(c=M.parentLayer.parentMap.getMapContext(),c=c.getUniverse().getZoomLevels(0)[c.getZoomLevel()],b=M.getGeometry(),k=b.getX()+k*c.resolution,m=b.getY()-m*c.resolution*c.stretchRatio,M.moveOriented?(c=M.moveAnimationDef.angleInRadius,
c=M.getOrientation(c),M.geo=new a.geometry.Point(k,m,M.geo.srid,c.x,c.y)):M.geo=new a.geometry.Point(k,m,M.geo.srid),M.screenPoints=M.screenTransformObj.toScreenPoint(M.geo.getX(),M.geo.getY()));M.progress=null}else M.screenTransformObj&&(M.screenPoints=M.screenTransformObj.toScreenPoint(y,A)),M.moveOriented?(c=M.moveAnimationDef.angleInRadius,M.screenPoints.angle=c,c=M.getOrientation(c),M.geo=new a.geometry.Point(y,A,M.geo.srid,c.x,c.y)):M.geo=new a.geometry.Point(y,A,M.geo.srid),M.moveAnimation=
null,M.movePoints&&!M.reverse&&M.movePoints.length>=M.currentTarget+4?M.animateToNewPoint(M.currentTarget+2):M.movePoints&&M.reverse&&0<M.currentTarget?M.animateToNewPoint(M.currentTarget-2):M.finishAnimation()}})}}},finishAnimation:function(){if((this.moveLoop||this.moveBound)&&4<=this.movePoints.length)if(this.moveBound)(this.reverse=!this.reverse)?this.animateToNewPoint(this.movePoints.length-2):this.moveLoop?this.animateToNewPoint(2):this.currentTarget=this.moveTime=this.movePoints=null;else{var b=
this.screenTransformObj.toScreenPoint(this.movePoints[0],this.movePoints[1]),y=b.x-this.screenPoints.x,A=b.y-this.screenPoints.y;this.screenPoints.angle&&this.shape.rotate(180*-this.screenPoints.angle/Math.PI,12.5,5);this.shape.translate(y/this.scaleX,A/this.scaleY);this.screenPoints=b;this.screenPoints.angle=0;this.geo=new a.geometry.Point(this.movePoints[0],this.movePoints[1],this.geo.srid);this.animateToNewPoint(2)}else this.currentTarget=this.moveTime=this.movePoints=null},pauseMoveAnimation:function(){if(this.displayed&&
this.shape&&this.moveAnimation){var a=this.moveAnimation._progress(),b=this.graphics.getLeftTop(this.shape);this.shape.stopPos=b;this.moveAnimation.endAt(0,!1);this.progress=a}},resumeMoveAnimation:function(){this.movePoints&&a.notNull(this.currentTarget)&&this.animateToNewPoint(this.currentTarget)},stopMoveAnimation:function(){this.pauseMoveAnimation();this.moveAnimation=this.currentTarget=this.moveTime=null;a.notNull(this.originalGeo)&&this.setGeometry(this.originalGeo);this.progress=this.movePoints=
this.originalGeo=null},getOrientation:function(a){var b=0,A=0,A=Math.PI/2;a>-A&&a<A?(b=1,A=b*Math.tan(a)):a>A||a<-A?(b=1,A=b*Math.tan(a)):A=a==A?1:-1;return{x:b,y:A}},getPointPosition:function(b,y,A,m,k){var c=null,c=a.notNull(k)?k.type:this.geo.type;this.tiledFeature&&"GeometryCollection"===c&&(c=this.parentLayer.getFeatureGeometryType());if("LineString"!==c&&"MultiLineString"!==c){var u,C,E,P=b.length,W=this.parentLayer.parentMap.getMapContext();if("Point"===c||"MultiPoint"===c||"OrientedPoint"===
c||"OrientedMultiPoint"===c)for(u=0;u<P;u++)if(1===b[u].showOnPoint){m=this.geo;this.tiledFeature&&a.notNull(k)&&"GeometryCollection"===k.type&&(m=k.geometries[0]);y=this.transformGeometry(m);if("MultiPoint"===m.type||"OrientedMultiPoint"===m.type)y=y[0];b[u].draw(this,this.parentLayer.parentMap.getMapContext(),{group:A,sPoint:y})}else b[u].draw(this,this.parentLayer.parentMap.getMapContext(),{group:A});else if(!a.isNull(y))if(2>P)C=(y[0]+y[2])/2,E=(y[1]+y[3])/2,y=new a.geometry.Point(C,E,m),y=this.transformGeometry(y),
b[0].draw(this,W,{group:A,sPoint:y});else{var M=0,r=0,q=0;for(u=c=0;u<P;u++){a.style.Style.calculateStyleSize(b[u],this.parentLayer.parentMap.getMapContext());var M=M+b[u].realWidth,r=r+b[u].realHeight,N=b[u].realWidth*b[u].realHeight;N>q&&(q=N,c=u)}u=W.getUniverse().getZoomLevels()[W.getZoomLevel()];var N=(y[2]-y[0])/u.resolution,Z=(y[3]-y[1])/u.resolution/u.stretchRatio,q=0,ba;M<=N?(ba="H",q=(N-M)/(P+1)):r<=Z?(ba="V",q=(Z-r)/(P+1)):ba=M-N>r-Z?"V":"H";P=[];a.$.extend(!0,P,y);"H"==ba?(M=b[c].realWidth/
2*u.resolution,C=N>b[c].realWidth?y[0]+M+q*u.resolution:(y[0]+y[2])/2-M,E=(y[1]+y[3])/2,P[0]=C+M):"V"==ba&&(M=b[c].realHeight/2*u.resolution*u.stretchRatio,E=Z>b[c].realHeight?y[1]+M+q*u.resolution:(y[1]+y[3])/2-M,C=(y[0]+y[2])/2,P[1]=E+M);y=new a.geometry.Point(C,E,m);y=this.transformGeometry(y);b[c].draw(this,W,{group:A,sPoint:y});this.displayed=!0;this.applyToolTip();b.splice(c,1);this.getPointPosition(b,P,A,m,k)}}},enableFeatureEditing:function(b){if(this.editable!=b&&!(this.geo instanceof a.geometry.Circle)){if("Rectangle"===
this.geo.type){var y=this.geo.coordinates[0],A=this.geo.coordinates[1],m=this.geo.coordinates[2],k=this.geo.coordinates[3];this.geo=new a.geometry.Polygon([[y,A,m,A,m,k,y,k,y,A]])}(this.editable=b)?(this.startDrag||(b=new a.layer.EditableFeature,this.init=b.init,this.startDrag=b.startDrag,this.featureDragging=b.featureDragging,this.endDrag=b.endDrag,this.addEditProperties=b.addEditProperties,this.startEditing=b.startEditing,this.endEditing=b.endEditing,this.deleteEditingProperties=b.deleteEditingProperties,
this.shapePointMoved=b.shapePointMoved,this.possiblePointMoved=b.possiblePointMoved,this.deleteShapePoint=b.deleteShapePoint,this.featurePointMoved=b.featurePointMoved,this.showContextMenu=b.showContextMenu,this.shapePointMoving=b.shapePointMoving,this.possiblePointMoving=b.possiblePointMoving,this.featurePointMoving=b.featurePointMoving,this.calRelatedFeature=b.calRelatedFeature,this.setParentThat=b.setParentThat,this.addResizeHandles=b.addResizeHandles,this.calDistance=b.calDistance,this.isEditProperties=
b.isEditProperties,this.focusProperties=b.focusProperties,this.registerUpdate=b.registerUpdate,this.init(),this.setParentThat(this)),this.startEditing()):(this.setParentThat(this),this.endEditing(),this.relatedFeature=this.edit=null,this.parentLayer.parentMap.enableMapDrag(!0))}},enableFeatureDragging:function(b){this.draggable&&(b=new a.layer.EditableFeature,this.init=b.init,this.startDrag=b.startDrag,this.featureDragging=b.featureDragging,this.endDrag=b.endDrag,this.addEditProperties=b.addEditProperties,
this.startEditing=b.startEditing,this.endEditing=b.endEditing,this.deleteEditingProperties=b.deleteEditingProperties,this.shapePointMoved=b.shapePointMoved,this.possiblePointMoved=b.possiblePointMoved,this.deleteShapePoint=b.deleteShapePoint,this.featurePointMoved=b.featurePointMoved,this.showContextMenu=b.showContextMenu,this.shapePointMoving=b.shapePointMoving,this.possiblePointMoving=b.possiblePointMoving,this.featurePointMoving=b.featurePointMoving,this.calRelatedFeature=b.calRelatedFeature,this.setParentThat=
b.setParentThat,this.addResizeHandles=b.addResizeHandles,this.calDistance=b.calDistance,this.isEditProperties=b.isEditProperties,this.focusProperties=b.focusProperties,this.registerUpdate=b.registerUpdate,this.init(),this.setParentThat(this))},isEditable:function(){return this.editable},clone:function(){var b={};a.$.extend(!0,b,this.geo);var y={};a.$.extend(!0,y,this.attributes);b=this.text?new a.TextFeature(this.id,b,this.text,this.renderingStyle):new a.Feature(this.id,b,{attributes:y,renderingStyle:this.renderingStyle,
label:this.label,labelStyle:this.labelStyle,labelStyleName:this.labelStyleName});this.columns&&(b.columns={},a.$.extend(!0,b.columns,this.columns));!this.renderingStyle&&this.styleName&&(b.styleName=this.styleName);this.mapping&&(b.mapping=!0);return b},clearInfoWindow:function(){var a=this.parentLayer.parentMap;a.infoLayer&&a.infoLayer.deleteInfoWindows()},getLabelMarkerPos:function(b){if(!this.parentLayer.mask){var y=this.parentLayer.parentMap.getMapContext(),A=y.getCenterPoint(),y=y.getDeviceWindow(),
A=this.screenTransformObj.toScreenPoint(A.getX(),A.getY());this.parentLayer.mask={minX:A.x-y.w,minY:A.y-y.h,maxX:A.x+y.w,maxY:A.y+y.h}}if(this.screenPoints&&(A="LineString"==this.geo.type?a.util.GeomUtil.clipLine(this.parentLayer.mask,[this.screenPoints]):a.util.GeomUtil.clipLine(this.parentLayer.mask,this.screenPoints),0<A.length))return a.util.GeomUtil.getPointByPercent(A,.5,b)},getLineTextPos:function(b,y,A,m){if(!this.parentLayer.mask){var k=this.parentLayer.parentMap.getMapContext(),c=k.getCenterPoint(),
k=k.getDeviceWindow(),c=this.screenTransformObj.toScreenPoint(c.getX(),c.getY());this.parentLayer.mask={minX:c.x-k.w,minY:c.y-k.h,maxX:c.x+k.w,maxY:c.y+k.h}}if(this.screenPoints){c="LineString"==this.geo.type?a.util.GeomUtil.clipLine(this.parentLayer.mask,[this.screenPoints]):a.util.GeomUtil.clipLine(this.parentLayer.mask,this.screenPoints);this.labelShape=this.graphics.createGroup();this.parentLayer.labelGroup.appendChild(this.labelShape);for(var k=[],u=c.length,C,E=0;E<u;E++){C=a.util.GeomUtil.getScreenLength(c[E]);
for(var P=!1,W=0,M=k.length;W<M;W++)if(C>k[W].len){P=!0;k.splice(W,0,{idx:E,len:C});break}P||k.push({idx:E,len:C})}E=u=0;for(P=k.length;E<P&&(W=c[k[E].idx],C=k[E].len,C<b/2||(this.testLabelByPercent(W,C,.5,y,A,m)?u++:this.testLabelByPercent(W,C,.4,y,A,m)?u++:this.testLabelByPercent(W,C,.6,y,A,m)&&u++,!(3<u)));E++);return!!u}return!1},testLabelByPercent:function(b,y,A,m,k,c){A=a.util.GeomUtil.getPointByLength(y*A,b);var u=A.pos,C,E;if(A.len>2*m){y=(b[u]+b[u+2])/2;A=(b[u+1]+b[u+3])/2;b=-Math.atan2(b[u+
1]-b[u+3],b[u+2]-b[u]);if(b<-Math.PI/2||b>=Math.PI/2)b+=Math.PI;var P=new this.graphics.oui.geom.Matrix;P.rotate(b,y,A);E=[y-m,A-k,y+m,A+k];E=P.transformAll([E[0],E[1],E[0],E[3],E[2],E[3],E[2],E[1]]);b=Math.ceil(Math.min(E[0],E[2],E[4],E[6]));C=Math.floor(Math.max(E[0],E[2],E[4],E[6]));u=Math.ceil(Math.min(E[1],E[3],E[5],E[7]));E=Math.floor(Math.max(E[1],E[3],E[5],E[7]));E=[b,u,C,E];return this.addLabelNode(c,E,y-m,A+k,{transform:P,group:this.labelShape})}P=a.util.GeomUtil;y=P.getPoinsByLength(b,
u,A.x,A.y,4*m,-2);var W=P.getPoinsByLength(b,u,A.x,A.y,4*m,2);y.x>W.x&&(b=y,y=W,W=b);if(A.x<y.x||A.x>W.x||y.y>W.y&&(A.y>y.y||A.y<W.y)||y.y<W.y&&(A.y<y.y||A.y>W.y))return!1;b=Math.min(y.x,W.x,A.x);C=Math.max(y.x,W.x,A.x);u=Math.min(y.y,W.y,A.y);E=Math.max(y.y,W.y,A.y);var M=Math.max(m/4,k);E=[b-M,u-M,C+M,E+M];return c.conflicts(E)?!1:(c.insert(E),c=P.getCircle(y.x,y.y,A.x,A.y,W.x,W.y),this.addLabelAlongCurve(c,m,k,-Math.atan2((y.y-W.y)/(W.x-y.x))),!0)},addLabelAlongCurve:function(a,b,A,m){var k=this.label.length;
if(!(2>k)&&a.eAngle&&a.sAngle){m=(a.eAngle-a.sAngle)/(k-1);b/=k;for(var c=0;c<k;c++){var u=a.sAngle+m*c,C=Math.cos(u)*a.r+a.x-b,u=Math.sin(u)*a.r+a.y+A-1,C=this.graphics.createTextNode(this.label[c],this.labelStyle,C,u),u=new this.graphics.oui.geom.Matrix;C.applyStyle({transform:u});this.labelShape.appendChild(C)}}},getLabelPosBySlope:function(a){for(var b=[],A=0,m=a.length;A<m;A++){for(var k=a[A],c=k.length,u=(k[c-2]-k[0])/(k[c-1]-k[1]),C=Number.POSITIVE_INFINITY,E=0,P=0;P<c-1;P+=2){var W=(k[P+2]-
k[P])/(k[P+3]-k[P+1]);Math.abs(u-W)<C&&(C=Math.abs(u-W),E=P)}c=(k[E]+k[E+2])/2;u=(k[E+1]+k[E+3])/2;k=-Math.atan2(k[E+1]-k[E+3],k[E+2]-k[E]);if(k<=-Math.PI/2||k>Math.PI/2)k+=Math.PI;b.push({x:c,y:u,angle:k})}return b},isCluster:function(){return this.id&&0===this.id.indexOf("-CL")&&this.cluster?!0:!1},getFeaturesInCluster:function(){return this.isCluster()?this.cluster.featureArray:null},drawGhostGeom:function(b,y){if(b&&y&&0!==y.length){this.removeGhostShape();var A={};this.ghostGeom=b;a.$.extend(!0,
A,y[0]);this.ghostShape=this.drawRectangle(this.graphics,this.group,b,A,!0);this.ghostShape.feature=this;A=this.getTip();this.ghostShape.applyStyle({tooltip:A})}},drawGhostLabel:function(a){if(a&&this.label){var b=(a.getMinX()+a.getMaxX())/2;a=(a.getMinY()+a.getMaxY())/2;b=this.screenTransformObj.toScreenPoint(b,a);this.labelShape=this.graphics.createTextNode(this.label,this.labelStyle,b.x,b.y);b=this.graphics.getWidthHeight(this.labelShape);this.labelShape.translate(-b.w/2,b.h/2-2);this.parentLayer.labelGroup.appendChild(this.labelShape);
this.labelShape.feature=this}},removeGhostShape:function(){this.ghostShape&&(this.ghostShape.feature=null,this.graphics.remove(this.ghostShape),this.graphics.remove(this.line),this.parentLayer.leadLine&&(this.line=this.line.feature=null),this.ghostShape=this.ghostShape.feature=null,this.labelShape&&(this.graphics.remove(this.labelShape),this.labelShape=this.labelShape.feature=null))},enableMarkerDraggable:function(a){this.draggable=a},setMarkerText:function(a){this.markerText=a},getMarkerText:function(){return this.markerText},
setInfoWindowContent:function(a){this.InfoHtml=a},getShapeIndex:function(){this.idx=this.shape&&this.shape.parentNode?this.shape.parentNode.getChildIndex(this.shape):-1},setShapeIndex:function(){if(this.shape&&this.shape.parentNode&&0<=this.idx&&this.shape.parentNode.getChildIndex(this.shape)!=this.idx)if(this.shapeGroup&&1<this.shapeGroup.length)for(var a=this.shapeGroup.length-1;-1<a;a--)this.shapeGroup[a].parentNode.setChildIndex(this.shapeGroup[a],this.idx);else this.shape.parentNode.setChildIndex(this.shape,
this.idx)},isInCluster:function(){return this.inCluster&&this.clusterId?!0:!1},getClusterId:function(){return this.inCluster&&this.clusterId?this.clusterId:null},getClusterFeature:function(){var b=this.clusterFeature;return a.isNull(b)?null:b},getClusteredFeatures:function(){var b=this.cluster;return a.notNull(b)?b.featureArray:null}});a.MapMarker=a.Feature.extend({initialize:function y(b){var m;a.notNull(b)?(b.position&&(m=a.isNull(b.position.srid)?8307:b.position.srid,m=new a.geometry.Point(b.position.x,
b.position.y,m)),this.markerText=b&&a.notNull(b.markerText)?b.markerText:null,this.markerTextStyle=b&&a.notNull(b.markerTextStyle)?b.markerTextStyle:null,y.base.call(this,b.id,m,{renderingStyle:b.renderingStyle,label:b.label,labelStyle:b.labelStyle,draggable:b.draggable}),b.dragStart&&(this.dragStartListener=b.dragStart),b.dragEnd&&(this.dragEndListener=b.dragEnd),b.dragging&&(this.draggingListener=b.dragging)):y.base.call(this)},getLabel:function(){return this.label},setMarkerTextStyle:function(a){this.renderingStyle&&
(this.renderingStyle.textStyle=a)},setID:function(b){a.notNull(b)&&""!==b&&(this.id=b)},getID:function(){return this.id},isDraggable:function(){return!0===this.draggable},setDraggable:function(a){this.draggable=!0===a},setStyle:function(b){a.notNull(b)&&""!==b&&(this.renderingStyle=b)},getStyle:function(){return this.renderingStyle},setPosition:function(b,A,m){var k,c;b&&A?(k=b,c=A,b=a.isNull(m)?8307:m,k=new a.geometry.Point(k,c,b),this.setGeometry(k)):a.util.Logger.warning("MAPVIEWER_9073","OM.MapMarker.setPosition",
"The ["+k+","+c+"],values are not properly specified.")},getPosition:function(){return{x:this.getGeometry().getX(),y:this.getGeometry().getY(),srid:this.getGeometry().getSRID()}},getMarkerX:function(){return this.getGeometry().getX()},getMarkerY:function(){return this.getGeometry().getY()},getMarkerSRID:function(){return this.getGeometry().getSRID()},setDragStartListener:function(a){this.dragStartListener=a},setDraggingListener:function(a){this.draggingListener=a},setDragEndListener:function(a){this.dragEndListener=
a},toJSON:function(){return{position:{x:this.getGeometry().getX(),y:this.getGeometry().getY(),srid:this.getGeometry().getSRID()},renderingStyle:a.isNull(this.renderingStyle)?"undefined":this.renderingStyle,draggable:a.isNull(this.draggable)?"undefined":this.draggable,label:a.isNull(this.label)?"":this.label,labelStyle:a.isNull(this.labelStyle)?null:this.labelStyle,markerText:a.isNull(this.markerText)?"":this.markerText,markerTextStyle:a.isNull(this.markerTextStyle)?null:this.markerTextStyle}}});a.TextFeature=
a.Feature.extend({initialize:function(b,A,m,k){this.id=b;this.geo=A;this.text=m;this.renderingStyle=k?k:new a.style.Text(a.gv.defaultTextStyleConfig);this.editRenderingStyle=a.layer.EditableFeature.textStyle;k instanceof a.style.Style||(this.attributes=k&&a.notNull(k.attributes)?k.attributes:null,this.renderingStyle=k.style?k.style:new a.style.Text(a.gv.defaultTextStyleConfig),this.editRenderingStyle=k.editStyle?k.editStyle:a.layer.EditableFeature.textStyle);this.displayed=!1;this.visible=!0;this.editable=
!1},setText:function(b){a.notNull(b)&&""!==b&&(this.text=b,this.displayed&&(this.remove(),this.displayFeature()))},getText:function(){return this.text},setGeometry:function(a){!a||"Point"!==a.type&&"OrientedPoint"!==a.type||(this.geo=a,this.displayed&&(this.remove(),this.screenPoints=null,this.displayFeature()))},setRenderingStyle:function(b){if((!a.isNull(b)||!a.isNull(this.parentLayer)&&!a.isNull(this.parentLayer.otherStyles)&&0!==this.parentLayer.otherStyles.length)&&this.renderingStyle!==b&&(this.renderingStyle=
b,this.displayed)){this.getShapeIndex();var A=this;a.notNull(this.shape)&&this.shape.addEventListener(a.event.MouseEvent.MOUSE_OUT,function(a){try{a.target=A.shape,A.shape.dispatchEvent(a)}catch(b){}});this.remove();b=[b];this.parentLayer.otherStyles&&(b=b.concat(this.parentLayer.otherStyles));b=this.getAllStyles(b);if(this.parentLayer.featureGroupArr&&0<this.parentLayer.featureGroupArr.length){this.shapeArray=[];for(var m=0;m<this.parentLayer.featureGroupArr.length;m++)if(a.isNull(this.activeIdx)||
this.activeIdx===m)this.group=this.parentLayer.featureGroupArr[m],this.displayFeature(b,-1),this.shapeArray[m]=this.shape}else this.displayFeature(b,-1);this.setShapeIndex()}},setEditRenderingStyle:function(b){a.notNull(b)&&b instanceof a.style.Text&&(this.editRenderingStyle=b)},displayFeature:function(b,A){var m=this.geo,k=this.typeIs(m);if((!this.editing||"OrientedPoint"!==k)&&b&&0!==b.length){var c=b[0];if(c&&!(c instanceof a.style.Style)&&c.dataSource&&c.name){var u=this,k=c.url;a.isNull(k)&&
(k=this.parentLayer.type===a.layer.VectorLayer.TYPE_JDBC||this.parentLayer.type===a.layer.VectorLayer.TYPE_PREDEFINED?this.parentLayer.serverURL:this.parentLayer.parentMap.mapviewerURL);a.style.StyleStore.getServerSideStyle(c.dataSource,c.name,{url:k,callback:function(a){u.displayFeature([a],A)}})}else{var C=this.graphics,c=this.renderingStyle&&this.renderingStyle.cased?this.parentLayer.getLineGroup():this.group,E=this.screenTransformObj;if(!(a.isNull(C)||a.isNull(c)||a.isNull(m)||a.isNull(E))){1<
b.length&&(m=C.createGroup(),c.appendChild(m),c=m);m=b.length;C=[];for(E=0;E<m;E++){var P=b[E],W=P.styleType;P.showOnPoint?(P.realWidth=null,P.realHeight=null,C.push(P)):(P.draw(this,this.parentLayer.parentMap.getMapContext(),{group:c,idx:A}),"AnimationColor"!==W&&"PulseAnimation"!==W||!a.notNull(this.shape)||(this.animations=[],this.createAnimation(this.shape,P,"MultiLineString"==k||"LineString"==k)))}0<C.length&&(E=this.parentLayer.parentMap.getMapContext().getUniverse().getSRID(),a.isNull(this.labelBox)&&
this.createLabelBox(),this.getPointPosition(C,this.labelBox,c,E));1<m&&(this.shape=c);this.displayed=!0;this.applyToolTip();this.ghostGeom&&(this.drawGhostGeom(this.ghostGeom,b),this.drawGhostLabel(this.ghostGeom));if(this.shapeGroup&&!this.visible)for(E=1;E<this.shapeGroup.length;E++)this.graphics.setVisible(this.shapeGroup[E],!1);else this.shape&&!this.visible&&this.graphics.setVisible(this.shape,!1);this.ghostShape&&!this.visible&&this.graphics.setVisible(this.ghostShape,!1);this.resumeMoveAnimation();
a.notNull(this.parentLayer)&&this.parentLayer.useRTree&&(this.parentLayer.addToRtree(this),this.parentLayer.updatedSearchWindow(this,k))}}}},remove:function(){var a=this.shape;if(a){this.graphics.remove(a);this.shape=null;if(this.shapeGroup)for(var a=this.shapeGroup.length,b=0;b<a;b++)this.shapeGroup[b]&&this.graphics.remove(this.shapeGroup[b]);this.shapeGroup=null;if(this.shapeArray){a=this.shapeArray.length;for(b=0;b<a;b++)this.shapeArray[b]&&(this.shapeArray[b].feature=null,this.graphics.remove(this.shapeArray[b]));
this.shapeArray=null}}},toJSON:function(){var b={id:this.id,styleConfig:this.getRenderingStyle().getConfig(),text:this.getText()};b.geometry=this.geo instanceof a.geometry.Geometry?this.geo.toJSON():this.geo;return b}});a.Map=a.Class.extend({mixin:a.event.EventSource,initialize:function(b,A){A&&a.notNull(A.autoLoadCss)&&!1===A.autoLoadCss||(a.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Auto loading "+a.gv.cssResourcePath()+"oraclemapsv2.css"),a.util.LoadFileUtil.LoadCss(a.gv.cssResourcePath()+
"oraclemapsv2.css"));a.gv.msgLoaded||a.gv.loadMessage();var c=this;this._decoration={};this.wraparound=!1;A&&!0===A.wraparound&&(this.wraparound=A.wraparound);this.mapBBox=[];a.gv.addMapInstance(this,b);A?(this.vectorlayerInfoWindowMouseEType=A.vectorlayerInfoWindowTrigger===a.event.MouseEvent.MOUSE_OVER||A.vectorlayerInfoWindowTrigger===a.event.MouseEvent.MOUSE_MOVE?a.event.MouseEvent.MOUSE_MOVE:a.event.MouseEvent.MOUSE_CLICK,this.hiDPI=A.hiDPI,this.applicationID=A.applicationID):this.vectorlayerInfoWindowMouseEType=
a.event.MouseEvent.MOUSE_CLICK;this.$containerDiv=a.$(b);this.$containerDiv.empty();this.zoomComplete=!0;this.utfgridHTMLArray=[];this.vctinfoHTMLArray=[];this.vctinfoFeatures={};"CSS1Compat"===document.compatMode&&(0===this.$containerDiv.width()&&(a.isNull(a.util.DomUtil.css(a.$("html")).width)&&(a.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Set html width to 100%"),a.$("html").css("width","100%")),a.isNull(a.util.DomUtil.css(a.$("body")).width)&&(a.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize",
"Set body width to 100%"),a.$("body").css("width","100%"))),0===this.$containerDiv.height()&&(a.isNull(a.util.DomUtil.css(a.$("html")).height)&&(a.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Set html height to 100%"),a.$("html").css("height","100%")),a.isNull(a.util.DomUtil.css(a.$("body")).height)&&(a.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Set body height to 100%"),a.$("body").css("height","100%"))));0!==this.$containerDiv.width()&&0!==this.$containerDiv.height()||a.util.Logger.warning("MAPVIEWER_9050",
"OM.Map.initialize","Size is "+this.$containerDiv.width()+"*"+this.$containerDiv.height());this.$containerDiv.css("-webkit-user-select","none");this.$containerDiv.css({"-moz-user-select":"none"});this.$containerDiv.css({"-ms-touch-action":"none"});a.browser.touchSupported&&this.$containerDiv.css({"-webkit-tap-highlight-color":"rgba(0, 0, 0, 0)"});"absolute"!==this.$containerDiv.css("position")&&this.$containerDiv.css("position","relative");this.mapInstanceId=this.generateMapInstanceId();var k="\x3cdiv id\x3d'oracleMapDiv"+
this.mapInstanceId+"' ";a.gv.tabIndexEnabled&&(k+=" tabindex\x3d'1' ");this._rootDivPos={normal:"position:relative; width:100%; height:100%;",va:"width:100%; height:100%;"};k+="style\x3d'"+this._rootDivPos.normal+"left:0px; top:0px; -moz-user-select: none;-webkit-user-select:none; overflow: hidden;z-index:auto;opacity:1'\x3e\x3c/div\x3e";this.$oracleMapDiv=a.$(k);this.$oracleMapDiv.addClass("omapsv2-root");this.$oracleMapDiv.css("position","relative");this.$containerDiv.append(this.$oracleMapDiv);
this.$topLayerDIV=a.$("\x3cdiv id \x3d'topLayerDIV"+this.mapInstanceId+"'\x3e\x3c/div\x3e");this.$fkGraphicLayersDiv=a.$("\x3cdiv id \x3d'fkGraphicLayersDiv"+this.mapInstanceId+"'\x3e\x3c/div\x3e");this.$tileLayersDiv=a.$("\x3cdiv id \x3d'tileLayersDiv"+this.mapInstanceId+"'\x3e\x3c/div\x3e");this.$oracleMapDiv.append(this.$topLayerDIV);this.$oracleMapDiv.append(this.$fkGraphicLayersDiv);this.$oracleMapDiv.append(this.$tileLayersDiv);this.$topLayerDIV.css({"z-index":"auto",position:"absolute",left:"0px",
top:"0px",width:"100%",height:"100%"});this.$fkGraphicLayersDiv.css({"z-index":"4",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",overflow:"hidden"});this.$tileLayersDiv.css({"z-index":"1",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",overflow:"hidden"});for(var k=[],aa,u=1;6>=u;u+=1)aa="\x3cdiv id\x3d'omv2_anchorBox"+u+"_"+this.mapInstanceId+"' class\x3d'omv2_anchorBox"+u+"'\x3e\x3c/div\x3e",k.push(aa);this.anchors=[a.$(k[0]),a.$(k[1]),a.$(k[2]),a.$(k[3]),
a.$(k[4]),a.$(k[5])];this.$heatMapDiv=a.$("\x3cdiv id \x3d'heatMapDiv"+this.mapInstanceId+"'\x3e\x3c/div\x3e");this.$oracleMapDiv.append(this.$heatMapDiv);this.$heatMapDiv.css({"z-index":"2",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",overflow:"hidden"});this.graphics=new a.Graphics(this.$fkGraphicLayersDiv[0],{hiDPI:this.hiDPI});this.$fkGraphicLayersDiv.find("svg,canvas").attr("unselectable","on");this.$fkGraphicLayersDiv.find("svg,canvas").css({outline:"none"});this.draggableGroup=
this.graphics.createGroup();this.fixedGroup=this.graphics.createGroup();this.blockerGroup=this.graphics.createGroup();this.graphics.addGroup(this.fixedGroup);this.graphics.addGroup(this.draggableGroup);this.graphics.addGroup(this.blockerGroup);this.useRTree=a.notNull(A&&A.useRTree)?A.useRTree:a.gv.useRTree;(this.updateBlocker=function(){if(c.useRTree&&!a.isNull(c.blockerGroup)){0===c.blockerGroup.childrenCount&&c.graphics.drawRectangle({x:0,y:0,width:c.$containerDiv.width(),height:c.$containerDiv.height()},
{fill:"orange",fillOpacity:0},{group:c.blockerGroup});var b=c.blockerGroup.firstChild;a.notNull(b)&&b.applyStyle({x:0,y:0,width:c.$containerDiv.width(),height:c.$containerDiv.height()})}}).call();c.iterateVectorLayers=function(a){for(var b=c.svgLayers,y=b.length-1;0<=y&&!0!==a(b[y]);y--);};c.search=function(b){var y=null;c.iterateVectorLayers(function(c){y=c.findFeature(b,!1);if(a.notNull(y))return!0});a.isNull(y)&&c.iterateVectorLayers(function(c){y=c.findFeature(b,!0);if(a.notNull(y))return!0});
return y};var C="none",E=function(b,y){if(!a.isNull(b)&&(C!==b._id||"mouseUp"!==y.type||2!==y.button)&&(C=b._id,a.notNull(b))){for(var c=b,A=c.feature;a.isNull(A)&&c.parentNode;)c=c.parentNode,A=c.feature;a.isNull(A)||(A.shape===b||A===b.feature?a.notNull(A.shape)&&A.shape.dispatchEvent(y):(a.notNull(A.shape)&&A.shape.dispatchEvent(y),b.dispatchEvent(y)))}},k=function(b){var y=c.search(b),A=y?y.fkNode:null;a.notNull(y)?a.notNull(y.parentLayer)&&c.graphics.setCursor(c.blockerGroup,y.parentLayer.mouseCursor):
c.graphics.setCursor(c.blockerGroup,c.cursorStyleDefault);a.notNull(y)&&E(A,b);b.type===a.event.MouseEvent.MOUSE_MOVE?(A!==c.lastMoveTarget&&(a.notNull(c.lastMoveTarget)&&(b.target=c.lastMoveTarget,b.relatedTarget=A,E(c.lastMoveTarget,a.$.extend({},b,{type:a.event.MouseEvent.MOUSE_OUT})),E(c.lastMoveTarget,a.$.extend({},b,{type:a.event.MouseEvent.MOUSE_LEAVE}))),a.notNull(A)&&(b.target=A,b.relatedTarget=c.lastMoveTarget,E(A,a.$.extend({},b,{type:a.event.MouseEvent.MOUSE_ENTER})),E(A,a.$.extend({},
b,{type:a.event.MouseEvent.MOUSE_OVER})))),c.lastMoveTarget=A):b.type===a.event.MouseEvent.MOUSE_LEAVE&&(c.lastMoveTarget=null)};c.lastMoveTarget=null;!0===c.useRTree&&(a.browser.touchSupported&&(this.graphics.attachEventListener(a.event.MouseEvent.TOUCH_TAP,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.TOUCH_LONG_PRESS,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.TOUCH_END,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.TOUCH_START,
k,this.blockerGroup)),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_MOVE,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_CLICK,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_UP,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_DOWN,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_LEAVE,
k,this.blockerGroup));this.divTop=this.divLeft=0;this.undoManager=new a.UndoManager;this.mouseWheelZoomBehavior=a.Map.ZOOM_CENTER_ON_MOUSE;A&&A.mapviewerURL&&(this.mapviewerURL=A.mapviewerURL);k=function(b){b?a.util.Logger.warning(0,"OM.Map.initialize",b.responseText):a.util.Logger.warning(0,"OM.Map.initialize","")};try{a.notNull(this.mapviewerURL)&&a.isNull(a.gv.defaultDataSource)&&a.util.HttpRequest.send(this.mapviewerURL+"/omserver",{xml_request:'\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e\x3cnon_map_request\x3e\x3clist_data_sources/\x3e\x3c/non_map_request\x3e'},
function(b){b=a.$(b).find("map_data_source");a.notNull(b)&&(a.gv.defaultDataSource=b.attr("name"))},"xml",k)}catch(P){a.util.Logger.warning(0,"OM.Map.initialize",P.stack?P.message+"\nStack: "+P.stack:P.message)}a.isNull(this.mapviewerURL)?this.mapviewerURL=a.gv.localbaseURL():0===this.mapviewerURL.indexOf("http")&&a.gv.setBaseMapViewerURL(this.mapviewerURL);this.disableOverviewMap=!0;A&&!1===A.disableOverviewMap&&(this.disableOverviewMap=A.disableOverviewMap);this.getMapContextToken=function(){var a=
{};return function(){return a}}();var W=this.getMapContextToken();W.universe={};W.graphics=this.graphics;A&&A.universe&&(W.universe=A.universe);W.deviceWindow={x:0,y:0,w:this.$containerDiv.width(),h:this.$containerDiv.height()};this.typeArray=[];this.nameArray=[];this.divLayers=[];this.svgLayers=[];this.layerQueue=[];this.touchStartLocs=[];this.touchStartLocs_backup=[];this.mLocY=this.mLocX=null;this.decorationArray=[];this.toolFeatureLayer=this.defaultFeatureLayer=null;this.enableMapAction={mouse:!0,
click:!0,drag:!0,dbclick:!0,mousewheel:!0};this.zoomEnabled=!0;this._mapCenter=this._zoomLevel=null;this.universeLayerIndex=-1;this.boundingLayerName=null;this.hasExternal=this.resetTag=this.moveflag=this.boundingThemeLoaded=this.boundingThemeLoading=this.initialized=this.displayed=this.inited=!1;this.tileLayerZoomAnimation=!0;this.maskOutInfoWindow=this.infoWindowEventPropogation=!1;this.over=A&&A.over?!0:!1;this.template=null;this.cursorStyleDragging=a.CursorTypes.MOVE;this.cursorStyleDefault=a.CursorTypes.DEFAULT;
if(!1===this.over&&"undefined"===typeof this.mainmap&&(a.isNull(A)||a.notNull(A)&&a.isNull(A.magnifier)))for(k=0;k<this.anchors.length;k++)this.$topLayerDIV.append(this.anchors[k]);this.resizeFun=function(){if(!c.over&&c.$containerDiv&&(W.deviceWindow.w!==c.$containerDiv.width()||W.deviceWindow.h!=c.$containerDiv.height())){W.deviceWindow.w=c.$containerDiv.width();W.deviceWindow.h=c.$containerDiv.height();c.updateBlocker();c.redrawMap();var b=new a.event.MapEvent(a.event.MapEvent.MAP_RESIZED,c);c.fire(b.type,
b)}};this.resizeTimer=setInterval(this.resizeFun,300);this.$oracleMapDiv[0].addEventListener("mouseover",function(b){var y=a.event,y=new y.MapEvent(y.MouseEvent.MOUSE_OVER,c);y.evt=b;c.fire(y.type,y)},!0);this.$oracleMapDiv[0].addEventListener("mouseout",function(b){var y=a.event,y=new y.MapEvent(y.MouseEvent.MOUSE_OUT,c);y.evt=b;c.fire(y.type,y)},!0);if(!A||!A.magnifier){this.$oracleMapDiv.dblclick(function(b){c.isStoppedEvent(b)||(c.displayed&&c.enableMapAction.dbclick&&c.setMapCenterAndZoomLevel(c.getCursorLocation(),
W.zoomLevel+1,!0),b=new a.event.MapEvent(a.event.MouseEvent.MOUSE_DOUBLE_CLICK,c),c.fire(b.type,b))});this.$oracleMapDiv[0].oncontextmenu=function(a){a.preventDefault()};var M=!1;this.$oracleMapDiv.on("mousewheel DOMMouseScroll",function(a){!c.isStoppedEvent(a)&&c.enableMapAction.mousewheel&&(a.preventDefault(),M||r(a,a.deltaY))});var r=function(b,y){M=!0;setTimeout(function(){M=!1;var A=c.getMapContext(),k=A.getUniverse(),q=k.getZoomLevels(),W=A.getZoomLevel(),r=W;0<y?W++:W--;if(!(0>W||W>=q.length||
this.divLayers&&1===this.divLayers.length&&!0===this.divLayers[0].isBaiduMap&&!1===a.util.BaiduUtil.isZoomLevelValid(W))){b.preventDefault();var u=c.getCursorLocation();if((!c.mouseWheelZoomBehavior||c.mouseWheelZoomBehavior===a.Map.ZOOM_KEEP_MOUSE_POINT)&&c.graphics){var u=q[W].resolution,q=q[r].resolution,A=A.getCenterPoint(),da=c.getCursorLocation(),r=da.getX(),da=da.getY(),ia=new c.graphics.oui.geom.Matrix;ia.translate(r,da);ia.scale(u/q);ia.translate(-r,-da);u=ia.transform(A.getX(),A.getY());
u=new a.geometry.Point(u.x,u.y,k.srid)}c.setMapCenterAndZoomLevel(u,W,!0);k=new a.event.MapEvent(a.event.MouseEvent.WHEEL_SCROLL,c);k.delta=y;c.fire(k.type,k)}},350)};this.$oracleMapDiv.mousedown(function(b){if(!c.isStoppedEvent(b)){1===b.which&&c.enableMapAction.drag&&(c.moveflag=!0);c.mLocX=b.pageX-c.$oracleMapDiv.offset().left;c.mLocY=b.pageY-c.$oracleMapDiv.offset().top;c.mouseDownLocX=c.mLocX;c.mouseDownLocY=c.mLocY;var y=new a.event.MapEvent(a.event.MouseEvent.MOUSE_DOWN,c);y.evt=b;c.fire(y.type,
y)}});this.$oracleMapDiv.mousemove(function(b){if(!c.isStoppedEvent(b)){var y=b.pageX-c.$topLayerDIV.offset().left-c.mLocX,A=b.pageY-c.$topLayerDIV.offset().top-c.mLocY;c.mLocX=b.pageX-c.$oracleMapDiv.offset().left;c.mLocY=b.pageY-c.$oracleMapDiv.offset().top;c.moveflag&&c.enableMapAction.drag&&(c.changeCursor(c.cursorStyleDragging),c.pan(y,A,!1));var k=new a.event.MapEvent(a.event.MouseEvent.MOUSE_MOVE,c);k.evt=b;c.fire(k.type,k);c.utfgridMouseEType!==a.event.MouseEvent.MOUSE_MOVE||0===y&&0===A||
c.utfgridMouseEListener(a.event.MouseEvent.MOUSE_MOVE);c.vectorlayerInfoWindowMouseEType!==a.event.MouseEvent.MOUSE_MOVE||0===y&&0===A||c.vectorLayerInfoWindowListener(a.event.MouseEvent.MOUSE_MOVE)}});this.$oracleMapDiv.mouseup(function(b){if(!c.isStoppedEvent(b)){var y=a.event,A=new y.MapEvent(y.MouseEvent.MOUSE_UP,c);A.evt=b;c.fire(A.type,A);c.mouseUpLocX=c.mLocX;c.mouseUpLocY=c.mLocY;c.mouseDownLocX&&c.mouseDownLocY&&c.moveflag&&c.enableMapAction.drag&&(1<Math.abs(c.mouseUpLocX-c.mouseDownLocX)||
1<Math.abs(c.mouseUpLocY-c.mouseDownLocY))?(A=new y.MapEvent(y.MapEvent.MAP_RECENTERED,c),c.fire(A.type,A)):c.mouseDownLocX&&c.mouseDownLocY&&1>=Math.abs(c.mouseUpLocX-c.mouseDownLocX)&&1>=Math.abs(c.mouseUpLocY-c.mouseDownLocY)&&c.handleMouseClick(b,c);c.mouseDownLocX=null;c.mouseDownLocY=null;c.moveflag=!1;c.changeCursor(c.cursorStyleDefault)}});c.displayUTFGridInfoWindow=function(){var b=null,y=0,A=function(){if(c.utfgridHTMLArray.length<c.utfgrid_lyr_cnt)10<=y?(clearTimeout(b),a.util.Logger.warning("MAPVIEWER_9081",
"OM.Map.initialize")):(clearTimeout(b),b=setTimeout(A,50),y+=1);else{for(var k="",q=0,W=c.utfgridHTMLArray.length;q<W;q++){var M=c.utfgridHTMLArray[q];!a.isNull(M)&&0<M.trim().length&&(k+=M.trim())}0<k.trim().length?(k="\x3ctable align\x3d'left' cellspacing\x3d'4' style\x3d'margin: auto;border-collapse: separate;'\x3e"+k+"\x3c/table\x3e",q=c.getCursorLocation(),c.displayInfoWindow(q,k,{title:"Feature Info",builtInInfoWindow:!0})):c.closeInfoWindows();c.utfgridHTMLArray=[]}};A()};c.displayVectorLayersInfoWindow=
function(b){var y=!1;if(a.isNull(b)||1>b.length)c.closeInfoWindows();else{var A,k;if(!0===c.showAllVecFeatureInfo)for(A=0,k=b.length;A<k;A+=1)b[A]&&b[A].feature_layer&&!0===b[A].feature_layer.getEnableInfoWindow()&&b[A].feature_layer.insertFeatureInfo(b[A]);else for(A=b.length-1;0<=A;--A)if(b[A]&&b[A].feature_layer&&!0===b[A].feature_layer.getEnableInfoWindow()){b[A].feature_layer.insertFeatureInfo(b[A]);break}b="";A=0;for(k=c.vctinfoHTMLArray.length;A<k;A++){var q=c.vctinfoHTMLArray[A];!a.isNull(q)&&
0<q.trim().length&&(b+=q.trim())}0<b.trim().length&&(b="\x3ctable align\x3d'left' cellspacing\x3d'4' style\x3d'margin: auto;border-collapse: separate;'\x3e"+b+"\x3c/table\x3e",y=c.getCursorLocation(),c.displayInfoWindow(y,b,{title:"Feature Info",builtInInfoWindow:!0}),y=!0);c.vctinfoHTMLArray=[];c.vctinfoFeatures={};return y}};c.fireUTFGridEvent=function(b){for(var y=0;y<c.divLayers.length;y++){var A=c.divLayers[y];if((A.layerType===a.LayerTypes.TILE||A.layerType===a.LayerTypes.DYNAMIC_TILE)&&!0===
A.enableUTFGrid&&A.mouseETypeUTFGrid===b&&!0===A.getEnableInfoWindow()){var k=new a.event.MapEvent(A.mouseETypeUTFGrid,A);A.fire(k.type,A)}}};c.getVectorLayerHitFeatures=function(b,y){a.isNull(y)&&(y={type:b,clientX:c.mLocX,clientY:c.mLocY});for(var A=[],k,q,W,M=0;M<c.svgLayers.length;M++)if(k=c.svgLayers[M],q=k.findFeatures(y),!a.isNull(q)){var r,da;r=0;for(da=q.length;r<da;r++)W=q[r],a.isNull(W)||W.cluster||(W.feature_layer=k,A.push(W))}return A};this.mapDragOutDiv=function(){if(c.moveflag&&c.enableMapAction.drag){if(c.mouseDownLocX&&
c.mouseDownLocY&&c.moveflag&&c.enableMapAction.drag&&(1<Math.abs(c.mouseUpLocX-c.mouseDownLocX)||1<Math.abs(c.mouseUpLocY-c.mouseDownLocY))){var b=new a.event.MapEvent(a.event.MapEvent.MAP_RECENTERED,c);c.fire(b.type,b)}c.moveflag=!1;c.changeCursor(c.cursorStyleDefault);c.mouseDownLocX=null;c.mouseDownLocY=null}};a.$(document).mouseup(this.mapDragOutDiv).mouseout(this.mapDragOutDiv);this.$fkGraphicLayersDiv.mouseout(function(a){a.stopPropagation()});this.graphics.oui.rootNode.addEventListener(a.event.MouseEvent.MOUSE_LEAVE,
function(){c.graphics.oui&&c.graphics.oui.tree&&c.graphics.oui.tree.canvas&&(c.graphics.oui.tree.canvas.style.cursor=c.cursorStyleDefault)});a.browser.touchSupported&&(this.$oracleMapDiv.bind("touchstart",function(a){c.isStoppedEvent(a)||c.touchStart(a)}),this.$oracleMapDiv.bind("touchmove",function(a){a.preventDefault();c.isStoppedEvent(a)||c.touchMove(a)}),this.$oracleMapDiv.bind("touchend",function(a){c.isStoppedEvent(a)||c.touchEnd(a)}));if(a.gv.isWin8Touch){var q=this;a.Hammer(this.$oracleMapDiv[0]).on("transformstart",
function(a){q.touchStartLocs=[];q.pinchZoomScale=1;var b=q.touchStartLocs;b[0]={x:a.gesture.touches[0].pageX,y:a.gesture.touches[0].pageY};b[1]={x:a.gesture.touches[1].pageX,y:a.gesture.touches[1].pageY};a=b[1].x-b[0].x;b=b[1].y-b[0].y;q.pinchZoomStartDist=Math.sqrt(a*a+b*b)});a.Hammer(this.$oracleMapDiv[0]).on("pinch",function(b){var y=a.util.DomUtil,c=y.getTouchesScale(b);a.isNull(c)&&(b=y.getTouchesPosition(b.gesture),c=b[0].x-b[1].x,b=b[0].y-b[1].y,c=Math.sqrt(c*c+b*b)/q.pinchZoomStartDist);q.pinchZoomScale=
c;if(!(1===c||0>=c||(b=q.zoomLevel,1<c&&b>=q.maxZoom||1>c&&0>=b)))for(q.pinchZooming=!0,q.graphics.setVisible(q.draggableGroup,!1),q.$heatMapDiv.css({visibility:"hidden"}),b=0;b<q.divLayers.length;b++)q.divLayers[b].zoomControl&&q.divLayers[b].zoomControl.scaleTiles(c)});a.Hammer(this.$oracleMapDiv[0]).on("transformend",function(){var a=q.pinchZoomScale;q.pinchZooming&&(a=q.getScaleZoomLevel(a),q.setMapZoomLevel(a),q.pinchZoomScale=1,q.pinchZooming=!1,q.graphics.setVisible(q.draggableGroup,!0),q.doubleTap=
!1)})}this._keyboardSupport={xPanOffset:5,yPanOffset:5,useSmoothPan:!0,actionMap:{tab:function(){},zoomIn:function(){c.zoomIn()},zoomOut:function(){c.zoomOut()},panLeft:function(){c.pan(c._keyboardSupport.xPanOffset,0,c._keyboardSupport.useSmoothPan)},panUp:function(){c.pan(0,c._keyboardSupport.yPanOffset,c._keyboardSupport.useSmoothPan)},panRight:function(){c.pan(-c._keyboardSupport.xPanOffset,0,c._keyboardSupport.useSmoothPan)},panDown:function(){c.pan(0,-c._keyboardSupport.yPanOffset,c._keyboardSupport.useSmoothPan)},
toggleOverview:function(){var a=c.overview;a.minimized?a.restore():a.collapse()},toggleLayerControl:function(){},toggleDecoration:function(){}},keyMap:{107:"zoomIn",109:"zoomOut",37:"panLeft",38:"panUp",39:"panRight",40:"panDown",79:"toggleOverview"}};k=function(a){if(!c.isStoppedEvent(a)&&"keydown"===a.type){var b=c._keyboardSupport.actionMap;if((a=c._keyboardSupport.keyMap[a.keyCode])&&b[a])b[a]()}};this.$oracleMapDiv.keypress(k);this.$oracleMapDiv.keydown(k);this.$oracleMapDiv.keyup(k)}this.newLayerConfigLoaded=
function(b){b.target instanceof a.layer.Layer&&(b.target.lastEvent=b.type);c.initLayers(b)};this.listenerElocationCopyright=function(){var b=new a.control.CopyRight({anchorPosition:a.control.MapDecoration.POSITION_LOWER_RIGHT,textValue:'\x26copy; 2017 Oracle Corporation \x26nbsp;\x26nbsp; \x3ca target\x3d"_blank" href\x3d"http://elocation.oracle.com/elocation/legal.html"\x3eTerms\x3c/a\x3e \x26nbsp;\x26nbsp; Map data \x26copy; 2016 HERE',fontSize:10,fontFamily:"Arial",fontColor:"black"});c.addMapDecoration(b);
this.deleteListener(a.event.LayerEvent.FINISH_GOT_CONFIG,c.listenerElocationCopyright)};this.layerFinish=function(b){b.target.loaded=!0;b.target.lastEvent=b.type;var y;if(a.Map.isTileLayer(b.target.layerType)){if(!c.divLayers)return;for(y=0;y<c.divLayers.length;y++)if(!c.divLayers[y].loaded)return;b=new a.control.CopyRight({anchorPosition:6,textValue:b.target.tileLayerConfig.copyright,fontSize:12,fontFamily:"Arial"});!c.over&&a.isNull(b.textValue)&&0<b.textValue.trim().length&&c.addMapDecoration(b);
"CopyRight"===b.type&&(c.copyRight=b);c.graphics&&c.graphics.setVisible(c.draggableGroup,!0);c.$heatMapDiv&&c.$heatMapDiv.css({visibility:"visible"})}if(c.divLayers)for(y=0;y<c.divLayers.length;y++)if(!c.divLayers[y].loaded)return;if(c.svgLayers)for(y=0;y<c.svgLayers.length;y++)if(!c.svgLayers[y].loaded&&!c.svgLayers[y].loadError)return;c.boundingLayerName=null;c.boundingThemeLoaded=!1;try{c.refreshVectorLayerLabels(),c.getToolFeatureLayer()}catch(A){a.util.Logger.warning(0,"OM.Map.layerFinish",A.stack?
A.message+"\nStack: "+A.stack:A.message)}finally{b=new a.event.MapEvent(a.event.MapEvent.MAP_AFTER_REFRESH,c),c.fire(b.type,b)}};this.layerErr=function(b){c.overviewLayer===b.target&&(c.overviewLayerErr=!0);c.removeLayer(b.target);a.Map.isTileLayer(b.target.layerType)?0<c.divLayers.length&&c.divLayers[c.universeLayerIndex].getLayerConfig():(b.target.isBoundingTheme()&&(c.boundingLayerName=null,0<=c.universeLayerIndex&&c.divLayers[c.universeLayerIndex].getLayerConfig()),c.layerFinish(b),0>c.universeLayerIndex&&
c.overviewLayerErr&&c.overview&&0<c.svgLayers.length&&(c.overviewLayer=c.svgLayers[c.svgLayers.length-1],c.overview.setOverviewMapOptions({overviewLayer:c.overviewLayer}),c.overview.errLoadLayer()))};this.layerStyleChanged=function(b){var y=new a.event.MapEvent(a.event.MapEvent.MAP_STYLE_CHANGED,c);y.affectLayer=b.target;y.newStyle=b.newStyle;y.attributes=b.attributes;c.fire(y.type,y)};this.nsdpMapped=function(b){var y=new a.event.MapEvent(a.event.MapEvent.I_MAP_NSDP_MAPPED,c);y.affectLayer=b.target;
c.fire(y.type,y)};this.disableOverviewMap||A.magnifier||(this.overview=new a.control.OverviewMap({}),this.overview.mainmap=this,this.addMapDecoration(this.overview),k=this.overview,aa=a.event.MapEvent,this.$topLayerDIV.append(this.overview.$DecorationDiv),this.on(aa.MAP_RECENTERED,this.overview.setCenterAndZoomlevel,k),this.on(aa.I_MAP_CENTER_ZOOM,this.overview.setCenterAndZoomlevel,k),this.on(aa.I_MAP_DRAGGING,this.overview.setRectangleFeature,k),this.on(aa.MAP_BEFORE_REFRESH,this.overview.setCenterAndZoomlevel,
k),this.on(aa.MAP_RESIZED,this.overview.resize,k),this.on(aa.MAP_STYLE_CHANGED,this.overview.styleChange,k),this.on(aa.I_MAP_NSDP_MAPPED,this.overview.nsdpMapped,k),this.on(aa.LAYER_DELETED,this.overview.layerDel,k),this.on(a.event.MapEvent.MAP_DESTROY,this.overview.destroy),this.overviewLayer=null);k=a.event.MapEvent;this.on(k.MAP_INITIALIZED,function(){var b=c.getLabelGridBox();c.grid=new a.util.CoverageGrid(b);for(b=0;b<c.svgLayers.length;b++)c.svgLayers[b].loaded=!1},this);this.on(k.LAYER_REORDERED,
this.changeOverView,this);this.getToolFeatureLayer();!1===this.over&&"undefined"===typeof this.mainmap&&(a.isNull(A)||a.notNull(A)&&a.isNull(A.magnifier))&&(this.progressService=new a.util.Progress,this.progressBar=new a.util.ProgressBar(this),"function"===typeof this.progressService.subscribe&&(this.progressService.subscribe(this.progressBar.updateUi.bind(this.progressBar),"progress"),this.progressService.subscribe(this.progressBar.switchMode.bind(this.progressBar),"mode")));a.event.EventSource.initProcessedEventStatus()},
setUTFGridMouseEType:function(b){for(var c=0;c<this.divLayers.length;c++){var m=this.divLayers[c];m.layerType!==a.LayerTypes.TILE&&m.layerType!==a.LayerTypes.DYNAMIC_TILE||!0!==m.enableUTFGrid||!0!==m.getEnableInfoWindow()||(this.utfgridMouseEType=b===a.event.MouseEvent.MOUSE_OVER||b===a.event.MouseEvent.MOUSE_MOVE?a.event.MouseEvent.MOUSE_MOVE:a.event.MouseEvent.MOUSE_CLICK)}},updateUTFGridLayerListener:function(){this.utfgrid_lyr_cnt=this.getUTFGridLayerCount();this.utfgridMouseEType=this.getUTFGridMouseEType();
this.utfgridMouseEListener=a.util.MiscUtil.debounce(function(a){a===this.utfgridMouseEType&&0<this.utfgrid_lyr_cnt&&(this.fireUTFGridEvent(a),setTimeout(this.displayUTFGridInfoWindow(),10))},500)},vectorLayerInfoWindowListener:a.util.MiscUtil.debounce(function(a){this.displayVectorLayersInfoWindow(this.getVectorLayerHitFeatures(a))},500),updateUTFGridLayerCount:function(){this.utfgrid_lyr_cnt=this.getUTFGridLayerCount()},generateMapInstanceId:function(){var a=0;return function(){return+ ++a}}(),getUndoManager:function(){return this.undoManager},
getMapContext:function(){return a.MapContext(this)},initLayers:function(b){var c=this,m=a.event,k=this.getMapContextToken(),aa=function(){for(var b=[],y=0;a.notNull(c.layerQueue)&&y<c.layerQueue.length;y++){var r=c.layerQueue[y];if(a.Map.isTileLayer(r[0].layerType)){for(var q=r[0].getZIndex()-1,u=!1,m=0;m<q;m++)if(!c.divLayers[m].initCalled){u=!0;break}if(u){b.push(c.layerQueue[y]);continue}else{if(!r[1].equals(k.universe)){c.resetUniverse(r[1],r[0],r[0].tileLayerConfig);return}if(c.divLayers[c.universeLayerIndex]==
r[0]&&!c.boundingLayerName&&!c.extentRect&&r[0].initCalled){a.util.Logger.config("","OM.Map.initLayers.deLayerQueue","["+r[0].name+"] layer's initLayer() skipped");continue}}}a.util.Logger.finest("","OM.Map.initLayers.deLayerQueue","Initializing layer: "+r[0].name+" ["+(y+1)+" of "+c.layerQueue.length+"]");r[0].initLayer()}c.overviewLayerErr&&c.overview&&(-1!==c.universeLayerIndex?c.overviewLayer=c.divLayers[c.universeLayerIndex]:0<c.svgLayers.length&&(c.overviewLayer=c.svgLayers[c.svgLayers.length-
1]),c.overview.setOverviewMapOptions({overviewLayer:c.overviewLayer}),c.overview.errLoadLayer());c.layerQueue=b},u=function(b){if(!a.isNull(c.layerQueue)){for(var y=0;y<c.layerQueue.length;y++)if(c.layerQueue[y][0].name===b.target.name)return;y=[b.target];a.Map.isTileLayer(b.target.layerType)&&a.notNull(b.config)&&y.push(new a.universe.Universe(b.config));c.layerQueue.push(y)}};c.extentRect&&(c.boundingLayerName=null);var C,E;if(a.notNull(c.extentRect)&&-1!==c.universeLayerIndex)if(c.displayed||c.divLayers[c.universeLayerIndex]!=
b.target)if(!b&&c.displayed)c.checkCenter(),C=new m.MapEvent(m.MapEvent.MAP_INITIALIZED,c),c.initialized=!0,c.inited=!1,c.fire(C.type,C),aa();else if(c.initialized){if(a.Map.isTileLayer(b.target.layerType)&&(u=new a.universe.Universe(b.config),!u.equals(k.universe))){c.resetUniverse(u,b.target,b.config);return}b.target.initLayer();aa()}else u(b);else k.universe=(new a.universe.Universe(b.config)).copy(k.universe),c.displayed=!0,c.setAllInitialParams(),k.zoomLevel=c.checkZoomLevel(k.zoomLevel),u(b),
c.zoomToExtent(c.extentRect);else if(a.notNull(c.extentRect))c.displayed?!b&&c.displayed?(C=new m.MapEvent(m.MapEvent.MAP_INITIALIZED,c),c.initialized||(c.initialized=!0,c.inited=!1,c.fire(C.type,C)),aa()):c.initialized?b.target.initLayer():u(b):(c.displayed=!0,k.zoomLevel=c.checkZoomLevel(k.zoomLevel),c.setAllInitialParams(),u(b),c.zoomToExtent(c.extentRect));else if(c.boundingLayerName&&-1!=c.universeLayerIndex)if(c.divLayers[c.universeLayerIndex]!=b.target||c.displayed)if(c.boundingLayerName==
b.target.name&&c.displayed)c.boundingThemeLoading?(C=b.bbox,C=b.target.calculateCenterAndZoomLevel(C[0],C[1],C[2],C[3]),c.initialized?(c.setMapCenterAndZoomLevel(C[1],C[0]),b.target.initLayer()):(k.centerPoint=C[1],k.homeCenter=k.centerPoint,k.zoomLevel=c.checkZoomLevel(C[0]),k.homeMapCenter||(k.homeMapCenter=k.homeCenter),c.wraparound&&(k.roundMapCenterPoint=k.homeCenter.clone()),k.homeMapZoomlevel||(k.homeMapZoomlevel=k.zoomLevel),c.checkCenter(),c.boundingThemeLoaded=!0,C=new m.MapEvent(m.MapEvent.MAP_INITIALIZED,
c),c.initialized=!0,c.inited=!1,c.fire(C.type,C),u(b)),aa(),c.boundingThemeLoading=!1):(c.boundingThemeLoading=!0,b.target.loadBoundingTheme());else if(c.initialized&&c.boundingThemeLoaded){if(a.Map.isTileLayer(b.target.layerType)&&(u=new a.universe.Universe(b.config),!u.equals(k.universe))){c.resetUniverse(u,b.target,b.config);return}b.target.initLayer();aa()}else u(b);else for(k.universe=(new a.universe.Universe(b.config)).copy(k.universe),c.displayed=!0,u(b),u=0;u<c.layerQueue.length;u++){if(C=
c.layerQueue[u],C[0].layerType==a.LayerTypes.VECTOR&&C[0].name==c.boundingLayerName){c.boundingThemeLoading=!0;C[0].loadBoundingTheme();break}}else if(-1!=c.universeLayerIndex)if(c.divLayers&&c.divLayers[c.universeLayerIndex]===b.target&&!c.displayed)k.universe=(new a.universe.Universe(b.config)).copy(k.universe),k.zoomLevel=c.checkZoomLevel(k.zoomLevel),c.displayed=!0,E=function(){c.checkCenter();var a=new m.MapEvent(m.MapEvent.MAP_INITIALIZED,c);c.initialized||(c.initialized=!0,c.inited=!1,c.resetTag&&
(a=new m.MapEvent(m.MapEvent.MAP_RESET_UNIVERSE,c)),c.fire(a.type,a));b.target.initLayer();aa()},c.setAllInitialParams(),k.centerPoint.srid===k.universe.srid?(k.homeCenter=k.centerPoint.clone(),c.wraparound&&(k.roundMapCenterPoint=k.homeCenter.clone()),E()):k.universe.srid===a.util.BaiduUtil.SRID?a.notNull(c.bdutil)&&a.util.BaiduUtil.transformGeom({geom:k.centerPoint,toSrid:a.util.BaiduUtil.SRID,callBack:function(a){k.centerPoint=a;k.homeCenter=k.centerPoint.clone();c.wraparound&&(k.roundMapCenterPoint=
k.homeCenter.clone());E()},map:c}):k.centerPoint.transform(k.universe.srid,function(a){k.centerPoint=a;k.homeCenter=k.centerPoint.clone();c.wraparound&&(k.roundMapCenterPoint=a);E()});else if(c.initialized){if(a.Map.isTileLayer(b.target.layerType)){C=b.target.getZIndex()-1;for(var P=0;P<C;P++)if(!c.divLayers[P].initCalled){u(b);return}u=new a.universe.Universe(b.config);if(!u.equals(k.universe)){c.resetUniverse(u,b.target,b.config);return}}b.target.initLayer();aa()}else u(b);else c.boundingLayerName?
b.target.name==c.boundingLayerName&&b.bbox?(c.displayed=!0,k.homeMapCenter=k.centerPoint,k.homeMapZoomlevel=k.zoomLevel,a.notNull(b.bbox[0])&&a.notNull(b.bbox[1])&&a.notNull(b.bbox[2])&&a.notNull(b.bbox[3])?(C=b.target.calculateCenterAndZoomLevel(b.bbox[0],b.bbox[1],b.bbox[2],b.bbox[3]),k.homeCenter=C[1],k.homeMapCenter||(k.homeMapCenter=C[1]),k.homeMapZoomlevel||(k.homeMapZoomlevel=C[0]),c.setMapCenterAndZoomLevel(C[1],C[0])):c.setMapZoomLevel(0),c.checkCenter(),c.boundingThemeLoaded=!0,C=new m.MapEvent(m.MapEvent.MAP_INITIALIZED,
c),c.initialized||(c.initialized=!0,c.inited=!1,c.fire(C.type,C)),a.notNull(b.bbox[0])&&a.notNull(b.bbox[1])&&a.notNull(b.bbox[2])&&a.notNull(b.bbox[3])&&u(b),aa()):b.target.name==c.boundingLayerName?(c.boundingThemeLoading=!0,b.target.loadBoundingTheme()):c.initialized&&c.boundingThemeLoaded?(b.target.initLayer(),aa()):u(b):(u=this.getMapContext().getUniverse(),c.displayed=!0,k.zoomLevel=c.checkZoomLevel(k.zoomLevel),c.setAllInitialParams(),E=function(){var a=new m.MapEvent(m.MapEvent.MAP_INITIALIZED,
c);c.checkCenter();c.initialized||(c.initialized=!0,c.inited=!1,c.fire(a.type,a));b&&b.target.initLayer();aa()},k.centerPoint.srid==u.srid?(k.homeCenter=k.centerPoint.clone(),c.wraparound&&(k.roundMapCenterPoint=k.homeCenter.clone()),E()):k.centerPoint.transform(u.srid,function(a){k.centerPoint=a;k.homeCenter=k.centerPoint.clone();c.wraparound&&(k.roundMapCenterPoint=k.homeCenter.clone());E()}))},init:function(){this.on(a.event.MapEvent.MAP_INITIALIZED,function(a){var b=a.target;b.getMapContext().getTransform();
b.changeCursor(b.cursorStyleDefault);a=b.getMapContext().getUniverse().getMapBounds().getWidth();for(var c=b.getMapContext().getWholeMapNum(),b=b.getMapContext().getBaseWholeMapIndex(),y=0;y<c;y++)this.mapBBox[y]={minX:(y-b)*a-a/2,maxX:(y-b)*a+a/2}});var b=a.event,c=this.getMapContextToken();this.layerQueue=[];if(this.initialized)this.cleanMap();else{var m=this.getMapContextToken();a.notNull(m.centerPoint)&&(m.homeMapCenter=m.centerPoint);this.wraparound&&a.notNull(m.homeMapCenter)&&(c.roundMapCenterPoint=
m.homeMapCenter.clone());m.homeMapZoomlevel=m.zoomLevel}if(0===this.divLayers.length&&0===this.svgLayers.length)this.displayed=!0,c.zoomLevel=this.checkZoomLevel(c.zoomLevel),this.initialized||(this.initialized=!0,this.inited=!1,c=new b.MapEvent(b.MapEvent.MAP_INITIALIZED,this),this.resetTag&&(c=new b.MapEvent(b.MapEvent.MAP_RESET_UNIVERSE,this)),this.fire(c.type,c));else{if(-1!==this.universeLayerIndex&&0<this.divLayers.length)for(b=this.divLayers[this.universeLayerIndex],b.layerType===a.LayerTypes.EXTERNAL&&
(b.loaded=!0,b.setContainer(this.$tileLayersDiv[0])),a.isNull(this.overviewLayer)&&(this.overviewLayer=b),this.graphics.setVisible(this.draggableGroup,!1),this.$heatMapDiv.css({visibility:"hidden"}),b.getLayerConfig(),c=this.universeLayerIndex+1;c<this.divLayers.length;c++)b=this.divLayers[c],b.layerType===a.LayerTypes.EXTERNAL&&(b.loaded=!0,b.setContainer(this.$tileLayersDiv[0])),b.getLayerConfig();for(c=0;c<=this.svgLayers.length-1;c++)a.isNull(this.overviewLayer)&&this.svgLayers[c]!==this.toolFeatureLayer&&
this.svgLayers[c]!==this.defaultFeatureLayer&&(this.overviewLayer=this.svgLayers[c]),this.svgLayers[c].getLayerConfig();this.inited=!0;this.updateUTFGridLayerListener()}},validateUTFGridLayerTriggers:function(){for(var b=null,c=0;c<this.divLayers.length;c++){var m=this.divLayers[c];m.layerType!==a.LayerTypes.TILE&&m.layerType!==a.LayerTypes.DYNAMIC_TILE||!0!==m.enableUTFGrid||!0!==m.getEnableInfoWindow()||!a.notNull(m.mouseETypeUTFGrid)||(a.isNull(b)?b=m.mouseETypeUTFGrid:(m.mouseETypeUTFGrid=b,a.util.Logger.warning("",
"OM.Map.getUTFGridMouseEType","UTFGrid info window trigger is set to:["+b+"]")))}},getUTFGridMouseEType:function(){for(var b=0;b<this.divLayers.length;b++){var c=this.divLayers[b];if((c.layerType===a.LayerTypes.TILE||c.layerType===a.LayerTypes.DYNAMIC_TILE)&&!0===c.enableUTFGrid&&!0===c.getEnableInfoWindow()&&a.notNull(c.mouseETypeUTFGrid))return c.mouseETypeUTFGrid}return a.event.MouseEvent.MOUSE_CLICK},getUTFGridLayerCount:function(){for(var b=0,c=0;c<this.divLayers.length;c++){var m=this.divLayers[c];
m.layerType!==a.LayerTypes.TILE&&m.layerType!==a.LayerTypes.DYNAMIC_TILE||!0!==m.enableUTFGrid||!0!==m.getEnableInfoWindow()||!0!==m.isVisible()||(b+=1)}return b},refreshMap:function(){if(this.initialized){var b=new a.event.MapEvent(a.event.MapEvent.MAP_BEFORE_REFRESH,this);this.fire(b.type,b)}},redrawMap:function(){if(this.initialized){this.getMapContextToken().transform=null;this.getMapContext().getTransform();this.wraparound&&(this.getMapContextToken().roundMapCenterPoint=this.getMapContextToken().centerPoint);
this.graphics.setLeftTop(this.draggableGroup,0,0);var b=new a.event.MapEvent(a.event.MapEvent.MAP_REDRAW,this);this.fire(b.type,b)}},destroyMap:function(){a.util.Logger.info(null,"Destorying map instance "+this.mapInstanceId);var b=new a.event.MapEvent(a.event.MapEvent.MAP_DESTROY,this);this.fire(b.type,b);this.deleteAllListeners();this.template&&this.template.destroy();this.graphics&&(this.graphics.clearGroup(this.draggableGroup),this.graphics.clearGroup(this.blockerGroup),this.graphics.clearGroup(this.fixedGroup),
this.graphics.removeAll());this.graphics=this.fixedGroup=this.blockerGroup=this.draggableGroup=null;this.undoManager&&this.undoManager.destroy();this.undoManager=null;this.loadingIcon&&a.$(this.loadingIcon).remove();this.$topLayerDIV&&this.$topLayerDIV.remove();this.$fkGraphicLayersDiv&&this.$fkGraphicLayersDiv.remove();this.$tileLayersDiv&&this.$tileLayersDiv.remove();this.$heatMapDiv&&this.$heatMapDiv.remove();this.loadingIcon&&a.$(this.loadingIcon).empty();this.$oracleMapDiv&&this.$oracleMapDiv.remove();
this.$containerDiv&&this.$containerDiv.unbind().empty();this.mapDragOutDiv&&a.$(document).unbind("mouseup",this.mapDragOutDiv).unbind("mouseout",this.mapDragOutDiv);this.dropOnDoc&&a.$(document).unbind("drop",this.dropOnDoc);this.$heatMapDiv=this.$containerDiv=this.$oracleMapDiv=this.$tileLayersDiv=this.$fkGraphicLayersDiv=this.$topLayerDIV=this.loadingIcon=this.dropOnDoc=this.mapDragOutDiv=null;this.divLayers=[];this.svgLayers=[];this.overview=this.overviewLayer=this.toolFeatureLayer=this.defaultFeatureLayer=
null;this.decorationArray=[];this.layerQueue=[];for(var b=a.gv.mapInstances,c=b.length,m=0;m<c;m++)if(b[m]==this){b.splice(m,1);break}},getUniverse:function(){return this.getMapContext().getUniverse()},setMapCenter:function(a,b){!1!==b&&(b=!0);this.wraparound?this.setMapCenterAndZoomLevel(a,this.getMapContext().getZoomLevel(),b):this.setMapCenterAndZoomLevel(a,null,b)},getMapCenter:function(b){if(a.isNull(b))return this.getMapContext().getCenterPoint();this._noZoomInOut=!0;this.zoomToExtent(b);this._noZoomInOut=
!1;return this._mapCenter},setMapZoomLevel:function(a){this.setMapCenterAndZoomLevel(null,a,!0)},getMapZoomLevel:function(b){if(a.isNull(b))return this.getMapContext().getZoomLevel();this._noZoomInOut=!0;this.zoomToExtent(b);this._noZoomInOut=!1;return this._zoomLevel},setMapScale:function(b,c){var m=this,k=function(){m.deleteListener(a.event.MapEvent.MAP_INITIALIZED,k);var aa=m.getMapContext().getUniverse().getSRID();m.setMapResolution(8307==aa||8265==aa||4326==aa?.0254*b/111195/a.gv.DPI:.0254*b/
a.gv.DPI,c)};if(this.initialized)k();else this.on(a.event.MapEvent.MAP_INITIALIZED,k)},getMapScale:function(){var b=this.getMapContext(),c=b.getZoomLevel(),b=b.getUniverse().getZoomLevels()[c].resolution;return a.gv.DPI*b/.0254},setMapResolution:function(a,b,c){var k=this.getMapContext().getUniverse().getZoomLevels();b||(b=null);if(a>k[0].resolution)this._zoomLevel=0,this._noZoomInOut||this.setMapCenterAndZoomLevel(b,0);else{for(var aa=0;aa<k.length-1;aa++)if(k[aa+1].resolution<=a&&k[aa].resolution>=
a){c?(this._zoomLevel=aa,this._noZoomInOut||this.setMapCenterAndZoomLevel(b,aa)):a/k[aa].resolution>=k[aa+1].resolution/a?(this._zoomLevel=aa,this._noZoomInOut||this.setMapCenterAndZoomLevel(b,aa)):(this._zoomLevel=aa+1,this._noZoomInOut||this.setMapCenterAndZoomLevel(b,aa+1));return}this._zoomLevel=aa;this._noZoomInOut||this.setMapCenterAndZoomLevel(b,aa)}},zoomToExtent:function(a){var b=this,c=this.getMapContextToken(),k=c.universe;if(0!==a.getWidth()&&0!==a.getHeight()){var aa=function(a){var y=
a.getWidth()/c.deviceWindow.w,aa=a.getHeight()*k.zoomLevels[c.zoomLevel].stretchRatio/c.deviceWindow.h;b._mapCenter=a.getCenter();y>aa?b.setMapResolution(y,a.getCenter(),!0):b.setMapResolution(aa,a.getCenter(),!0);b.initialized||b.initLayers()};b.extentRect=a;this.displayed&&(a.srid==k.srid?aa(a):a.transform(k.srid,function(a){aa(a)}))}},zoom_debounce:a.util.MiscUtil.debounce(function(a){this.setMapZoomLevel(a);this.curZmLvl=null},500),zoomIn:function(){a.isNull(this.curZmLvl)?this.curZmLvl=this.getMapContext().getZoomLevel():
this.curZmLvl+=1;this.zoom_debounce(this.curZmLvl+1)},zoomOut:function(){a.isNull(this.curZmLvl)?this.curZmLvl=this.getMapContext().getZoomLevel():--this.curZmLvl;this.zoom_debounce(this.curZmLvl-1)},pan:function(b,c,m){if(0!==b||0!==c){var k=b,aa=c,u=0,C=this.getMapContextToken(),E=C.universe,P=C.zoomLevel,W=E.zoomLevels[P].resolution,M=E.zoomLevels[P].stretchRatio,r=b*W,q=c*W*M,N=E.bound.getMinX(),Z=E.bound.getMaxX(),u=E.bound.getMinY(),ba=E.bound.getMaxY(),P=C.centerPoint.clone(),Y=new a.geometry.Point(C.centerPoint.getX()-
r,C.centerPoint.getY()+q,E.srid),qa;this.wraparound&&(qa=new a.geometry.Point(C.roundMapCenterPoint.getX()-r,C.roundMapCenterPoint.getY()+q,E.srid));var la=C.deviceWindow,oa=la.w*W,wa=la.h*W*M,la=C.universe.getMapBounds().getWidth();if(Y.getX()+oa/2<Z&&Y.getY()+wa/2<ba&&Y.getX()-oa/2>N&&Y.getY()-wa/2>u||this.wraparound){if(this.wraparound){if(Y.getY()>la/6||Y.getY()<-la/6)if(Y.getY()<u+wa/2||Y.getY()>ba-wa/2)return;Y=C.centerPoint.getX()>la/2?new a.geometry.Point(C.centerPoint.getX()-r-la,C.centerPoint.getY()+
q,E.srid):C.centerPoint.getX()<-la/2?new a.geometry.Point(C.centerPoint.getX()-r+la,C.centerPoint.getY()+q,E.srid):new a.geometry.Point(C.centerPoint.getX()-r,C.centerPoint.getY()+q,E.srid);C.roundMapCenterPoint=qa}C.centerPoint=Y;C.homeCenter=Y.clone();k=this.getMapContext().getWholeMapNum();aa=this.getMapContext().getBaseWholeMapIndex();this.mapBBox=[];for(C=0;C<k;C++)this.mapBBox[C]={minX:(C-aa)*la-la/2,maxX:(C-aa)*la+la/2}}else qa=Y.getX(),la=Y.getY(),Y.getY()+wa/2<ba&&Y.getY()-wa/2>u||(Y.getY()-
wa/2<u?(u=(u+wa/2-P.getY())/(W*M),Math.abs(u)<Math.abs(aa)&&(c=u,la=P.getY()+c*W*M)):Y.getY()+wa/2>ba?(u=(P.getY()-(ba-wa/2))/(W*M),Math.abs(u)<Math.abs(aa)&&(c=u,la=P.getY()+c*W*M)):(c=0,la=P.getY())),Y.getX()+oa/2<Z&&Y.getX()-oa/2>N||(Y.getX()-oa/2<N?this.wraparound?(u=(N+oa/2-P.getX())/W*-1,Math.abs(u)<Math.abs(k)&&(b=u,qa=P.getX()+b*W)):(b=0,qa=P.getX()):Y.getX()+oa/2>Z&&(this.wraparound?(u=(P.getX()-(Z-oa/2))/W,Math.abs(u)<Math.abs(k)&&(b=u,qa=P.getX()+b*W)):(b=0,qa=P.getX()))),C.centerPoint.setPoint(qa,
la),C.homeCenter.setPoint(qa,la);0===b&&0===c||!this.initialized||(k=new a.event.MapEvent(a.event.MapEvent.I_MAP_DRAGGING,this),k.xOffset=b,k.yOffset=c,k.preCenter=P,this.doSmoothPan(k,m))}},doSmoothPan:function(b,c){var m=b.xOffset,k=b.yOffset,aa=this,u=this.graphics,C=null,E=0,P=0,W=0,M=function(){aa.graphics&&(Math.abs(m)>r?(b.xOffset=r*(Math.abs(m)/m),m-=r*(Math.abs(m)/m)):(b.xOffset=m,m=0),Math.abs(k)>r?(b.yOffset=r*(Math.abs(k)/k),k-=r*(Math.abs(k)/k)):(b.yOffset=k,k=0),C=u.getLeftTop(aa.draggableGroup),
u.setLeftTop(aa.draggableGroup,C.x+b.xOffset,C.y+b.yOffset),aa.fire(b.type,b),W++,W<P?setTimeout(M,20):aa.moveflag||(b=new a.event.MapEvent(a.event.MapEvent.MAP_RECENTERED,aa),aa.fire(b.type,b)))},r=Math.floor(a.MapContext(this).getDeviceWidth()/10);!c||Math.abs(m)<r&&Math.abs(k)<r?(C=u.getLeftTop(aa.draggableGroup),u.setLeftTop(aa.draggableGroup,C.x+m,C.y+k),aa.fire(b.type,b),aa.moveflag||(b=new a.event.MapEvent(a.event.MapEvent.MAP_RECENTERED,aa),aa.fire(b.type,b))):(E=Math.abs(m)>Math.abs(k)?m:
k,P=Math.abs(E/r),setTimeout(M,20))},checkZoomLevel:function(b){var c=this.getMapContextToken().universe;c&&c.getZoomLevelNumber&&(a.notNull(b)?(c=c.getZoomLevelNumber()-1,b>c&&(b=c),0>b&&(b=0)):b=0);return b},setMapCenterAndZoomLevel:function(b,c,m){this.zoomComplete=!1;this.divLayers&&1===this.divLayers.length&&"google"===this.divLayers[0].tileSource&&this.divLayers[0].mapType===a.layer.GoogleTileLayer.TYPE_SHADED&&15<=c&&(c=14);if(!this.divLayers||1!==this.divLayers.length||!0!==this.divLayers[0].isBaiduMap||
!1!==a.util.BaiduUtil.isZoomLevelValid(c)){if(!c&&this.wraparound||!c&&this.over)c=0;var k=this,aa=this.getMapContextToken();!this.initialized||a.isNull(b)||aa.centerPoint.srid===b.srid?this.do_setMapCenterAndZoomLevel(b,c,m):aa.centerPoint.srid!==a.util.BaiduUtil.SRID?b.transform(aa.universe.srid,function(a){k.do_setMapCenterAndZoomLevel(a,c,m)}):b.transform(aa.universe.srid,function(a){k.do_setMapCenterAndZoomLevel(a,c,m)},null,null,{map:k,inputIsBD09LonLat:!0});setTimeout(function(){if(k.wraparound)for(var b=
0;b<k.divLayers.length;b++)k.divLayers[b].mapType!==a.layer.BingTileLayer.TYPE_ROAD&&k.divLayers[b].mapType!==a.layer.BingTileLayer.TYPE_AERIAL||k.redrawMap()},100)}},do_setMapCenterAndZoomLevel:function(b,c,m){var k=null,aa=null,u=this.getMapContextToken(),C;this.on(a.event.MapEvent.MAP_AFTER_ZOOM,function(){this.wraparound&&this.pan(0,0);var a=u.universe.getMapBounds().getWidth(),b=this.getMapContext().getWholeMapNum(),c=this.getMapContext().getBaseWholeMapIndex();this.mapBBox=[];for(var y=0;y<
b;y++)this.mapBBox[y]={minX:(y-c)*a-a/2,maxX:(y-c)*a+a/2};this.zoomComplete=!0},this);if(this.initialized){if(!a.notNull(c)||!1!==this.zoomEnabled)if(a.notNull(c)&&this.checkZoomLevel(c)!==u.zoomLevel){this.grid&&(this.grid.clear(),m=this.getLabelGridBox(c),this.grid.setBox(m));C=new a.event.MapEvent(a.event.MapEvent.I_MAP_CENTER_ZOOM,this);k=u.zoomLevel;u.transform=null;u.zoomLevel=this.checkZoomLevel(c);C.beforeZoomLevel=k;C.afterZoomLevel=u.zoomLevel;m=new a.event.MapEvent(a.event.MapEvent.MAP_BEFORE_ZOOM,
this);m.beforeZoomLevel=k;m.afterZoomLevel=u.zoomLevel;this.fire(m.type,m);C.preMapCenter=u.centerPoint.clone();b&&b!=u.homeCenter&&(u.centerPoint=b,u.homeCenter=u.centerPoint.clone(),this.wraparound&&(u.roundMapCenterPoint=b));this.checkCenter();for(m=0;m<this.svgLayers.length;m++)this.svgLayers[m].loaded=!1,this.svgLayers[m].clearFeatureShapes();0<this.divLayers.length&&(this.graphics.setVisible(this.draggableGroup,!1),this.$heatMapDiv.css({visibility:"hidden"}));for(m=0;m<this.divLayers.length;m++)this.divLayers[m].loaded=
!1;var E=this;this.graphics&&this.graphics.clearToolTips();setTimeout(function(){if(!a.isNull(E.graphics)){E.graphics.setLeftTop(E.draggableGroup,0,0);E.getMapContext().getTransform();E.fire(C.type,C);var b=new a.event.MapEvent(a.event.MapEvent.MAP_AFTER_ZOOM,E);b.beforeZoomLevel=k;b.afterZoomLevel=u.zoomLevel;E.fire(b.type,b)}},0)}else{if(b){aa=u.centerPoint.clone();u.centerPoint=b;u.homeCenter=u.centerPoint.clone();this.wraparound&&(u.roundMapCenterPoint=b);b=this.checkCenter(u.centerPoint);var P=
u.centerPoint;c=Math.round((aa.getX()-P.getX())/u.universe.zoomLevels[u.zoomLevel].resolution);P=Math.round((P.getY()-aa.getY())/u.universe.zoomLevels[u.zoomLevel].resolution*u.universe.zoomLevels[u.zoomLevel].stretchRatio);if(0===c&&0===P){m=new a.event.MapEvent(a.event.MapEvent.MAP_RESTRICT_CENTER,this);this.fire(m.type,m);this.zoomComplete=!0;return}Math.abs(c)>u.deviceWindow.w||Math.abs(P)>u.deviceWindow.h?(this.graphics.setLeftTop(this.draggableGroup,0,0),u.transform=null,C=new a.event.MapEvent(a.event.MapEvent.MAP_BEFORE_REFRESH,
this),C.preMapCenter=aa,C.restrictCenter=b,C.bigPan=!0,this.fire(C.type,C)):(C=new a.event.MapEvent(a.event.MapEvent.I_MAP_DRAGGING,this),C.xOffset=Math.round(c),C.yOffset=Math.round(P),C.preCenter=aa,C.restrictCenter=b,this.doSmoothPan(C,m))}else for(m=0;m<this.divLayers.length;m++)this.divLayers[m].zoomControl&&this.divLayers[m].zoomControl.reset&&this.divLayers[m].zoomControl.endScaling&&(this.divLayers[m].zoomControl.reset(),this.divLayers[m].zoomControl.endScaling());this.zoomComplete=!0}}else this.zoomComplete=
!0,b&&(u.centerPoint=b,u.homeCenter=u.centerPoint.clone(),this.wraparound&&(u.roundMapCenterPoint=b)),a.notNull(c)&&(u.zoomLevel=this.checkZoomLevel(c))},addLayer:function(b,c,m){var k=this;b.parentMap=this;if(k.inited&&!k.initialized)setTimeout(function(){k.addLayer(b,c)},50);else if(this.getLayerByName(b.name))a.util.Logger.warning("MAPVIEWER_9102","OM.Map.addLayer");else{a.isNull(c)&&(c="undefined");this.typeArray.push(c);b.customType=c;a.isNull(this.nameArray[c])&&(this.nameArray[c]=[]);this.nameArray[c].push(b.name);
var aa=a.event;this.on(aa.MapEvent.I_MAP_DRAGGING,b.panEvent,b);this.on(aa.MapEvent.MAP_RECENTERED,b.recenter,b);this.on(aa.MapEvent.I_MAP_CENTER_ZOOM,b.setCenterAndZoomlevel,b);this.on(aa.MapEvent.MAP_BEFORE_REFRESH,b.refreshEvent,b);this.on(aa.MapEvent.MAP_REDRAW,b.redraw,b);this.on(aa.MapEvent.MAP_DESTROY,b.destroy,b);if(b instanceof a.layer.VectorLayer&&b.useRTree)this.on(aa.MapEvent.MAP_BEFORE_ZOOM,b.beforeZoom,b);b.addListener(aa.LayerEvent.FINISH_GOT_CONFIG,k.newLayerConfigLoaded);b.addListener(aa.LayerEvent.FINISH_LOAD,
k.layerFinish);b.addListener(aa.LayerEvent.ALL_TILES_LOADED,k.layerFinish);b.addListener(aa.LayerEvent.INIT_ERROR,k.layerErr);b.addListener(aa.LayerEvent.RENDERING_STYLE_CHANGED,k.layerStyleChanged);b.addListener(aa.LayerEvent.NSDP_MAPPED,k.nsdpMapped);b.dataSource&&"ELOCATION_MERCATOR"===b.dataSource.toUpperCase()&&b.tileLayer&&"WORLD_MAP"===b.tileLayer.toUpperCase()&&b.serverURL&&0<=b.serverURL.toLowerCase().indexOf("//elocation.oracle.com/mapviewer/mcserver")&&b.addListener(aa.LayerEvent.FINISH_GOT_CONFIG,
k.listenerElocationCopyright);a.isNull(b.serverURL)&&(b.serverURL=this.mapviewerURL);if("invalid url"===b.serverURL)a.util.Logger.alert("MAPVIEWER_9020","OM.Map.addLayer","");else{a.Map.isTileLayer(b.layerType)?(b.layerType===a.LayerTypes.EXTERNAL&&(this.hasExternal=!0),-1===this.universeLayerIndex&&(this.universeLayerIndex=this.divLayers.length),!a.isNull(m)&&m<this.divLayers.length?this.divLayers.splice(m,0,b):(this.divLayers.push(b),this.updateUTFGridLayerListener())):(b.initGroup(),b.isBoundingTheme()&&
!this.initialized?this.boundingLayerName=b.name:b.isBoundingTheme()&&(this.boundingThemeLoading=this.boundingThemeLoaded=!1,this.boundingLayerName=b.name),b.getEnableInfoWindow()&&b.addListener(this.vectorlayerInfoWindowMouseEType,b.insertFeatureInfo),this.svgLayers.push(b));this.initialized&&(b.layerType==a.LayerTypes.EXTERNAL&&(b.loaded=!0),b.layerType==a.LayerTypes.EXTERNAL&&b.setContainer(this.$tileLayersDiv[0]),k.grid&&k.grid.clear(),b.getLayerConfig(),this.overview&&(this.changeOverView(),this.overview.overFeatureLayer&&
this.overview.overFeatureLayer.bringToTop()));m=null;m=a.Map.isTileLayer(b.layerType)?this.divLayers.length:this.svgLayers.length+this.divLayers.length-2;aa=new aa.MapEvent(aa.MapEvent.LAYER_ADDED,k);aa.affectedLayer=b;this.fire(aa.type,aa);for(aa=0;aa<this.decorationArray.length;aa++){var u=this.decorationArray[aa];"LayerControl"==u.type&&(u.left=parseInt(u.$DecorationDiv.css("left")),u.top=parseInt(u.$DecorationDiv.css("top")),u.width=u.currentWidth,this.removeMapDecoration(u),this.addMapDecoration(u))}this.$oracleMapDiv.keydown(function(c){17!=
c.keyCode&&91!=c.keyCode&&93!=c.keyCode||!b.selectionEnable||b.multiSelect||(b.multiSelect=!0,b.enableFeatureSelection(!0,a.layer.VectorLayer.MULTIPLE_SELECTION))});this.$oracleMapDiv.keyup(function(c){17!=c.keyCode&&91!=c.keyCode&&93!=c.keyCode||!b.selectionEnable||(b.multiSelect=!1,b.enableFeatureSelection(!0,a.layer.VectorLayer.SINGLE_SELECTION))});this.resetTileLayerZIndex();return m}}},resetTileLayerZIndex:function(){var b;for(b=0;b<this.divLayers.length;b++){var c;this.divLayers[b].zIndex=b;
c=this.divLayers[b].container;a.isNull(c)?(c=this.divLayers[b].jqLayerDiv,a.isNull(c)||(c=c[0].style,a.isNull(c)||(c.zIndex=b))):(c=c.style,a.isNull(c)||(c.zIndex=b))}},removeAllFeatureLayers:function(){for(var a=this.svgLayers,b=a.length-1;0<=b;b--){var c=a[b].name;"ii_oracle_maps_internal_editing"!=c&&"ii_oracle_maps_internal_others"!=c&&this.removeLayer(a[b])}},removeLayer:function(b){var c,m,k;if(b){m=new a.event.MapEvent(a.event.MapEvent.LAYER_DELETED,b.parentMap);m.affectedLayer=b;b===this.overviewLayer&&
(this.userSetOL=!1);c=0;for(k=this.svgLayers.length;c<k;c++)if(this.svgLayers[c]===b){this.deleteLayerListener(b);var aa=-1;for(k=0;k<this.nameArray[this.svgLayers[c].customType].length;k++)this.nameArray[this.svgLayers[c].customType][k]===this.svgLayers[c].name&&(aa=k);-1<aa&&this.nameArray[this.svgLayers[c].customType].splice(aa,1);this.svgLayers.splice(c,1);this.fire(m.type,m);this.refreshVectorLayerLabels();b.parentMap=null;for(c=0;c<this.decorationArray.length;c++)m=this.decorationArray[c],"LayerControl"===
m.type&&(m.left=parseInt(m.$DecorationDiv.css("left")),m.top=parseInt(m.$DecorationDiv.css("top")),m.width=m.currentWidth,this.removeMapDecoration(m),this.addMapDecoration(m));return b}c=0;for(k=this.divLayers.length;c<k;c++)if(this.divLayers[c]===b){this.deleteLayerListener(b);this.divLayers.splice(c,1);this.fire(m.type,m);b.parentMap=null;for(k=0;k<this.decorationArray.length;k++)m=this.decorationArray[k],"LayerControl"===m.type&&(this.removeMapDecoration(m),this.addMapDecoration(m));for(k=0;k<
this.typeArray.length;k++)if(c=this.typeArray[k],this.nameArray[c][k]===b.name){this.nameArray[c].splice(k,1);this.typeArray.splice(k,1);break}return b}c=0;for(k=this.divLayers.length;c<k;c++)if(this.divLayers[c].layerType===a.LayerTypes.EXTERNAL){this.hasExternal=!0;break}else this.hasExternal=!1;for(c=0;c<this.decorationArray.length;c++)m=this.decorationArray[c],"LayerControl"===m.type&&(this.removeMapDecoration(m),this.addMapDecoration(m))}this.resetTileLayerZIndex();this.updateUTFGridLayerListener()},
deleteLayerListener:function(b){if(b){this.deleteListener(a.event.MapEvent.I_MAP_DRAGGING,b.panEvent,b);this.deleteListener(a.event.MapEvent.MAP_RECENTERED,b.recenter,b);this.deleteListener(a.event.MapEvent.I_MAP_CENTER_ZOOM,b.setCenterAndZoomlevel,b);this.deleteListener(a.event.MapEvent.MAP_BEFORE_REFRESH,b.refreshEvent,b);this.deleteListener(a.event.MapEvent.MAP_REDRAW,b.redraw,b);this.deleteListener(a.event.MapEvent.MAP_DESTROY,b.destroy,b);var c=a.event.LayerEvent;b.deleteListener(c.FINISH_GOT_CONFIG,
this.newLayerConfigLoaded);b.deleteListener(c.FINISH_LOAD,this.layerFinish);b.deleteListener(c.ALL_TILES_LOADED,this.layerFinish);b.deleteListener(c.INIT_ERROR,this.layerErr);b.deleteListener(c.RENDERING_STYLE_CHANGED,this.layerStyleChanged);b.deleteListener(c.NSDP_MAPPED,this.nsdpMapped);b.clearLayer&&b.clearLayer();b.destroy&&b.destroy();(new a.event.MapEvent(a.event.MapEvent.LAYER_DELETED,this)).affectedLayer=b}},addToolBar:function(c){a.notNull(c)&&(c.map=this,a.$("#div_"+c.innerID).attr("id")!==
b?a.util.Logger.warning("MAPVIEWER-9048","OM.Map.addToolBar","Toolbar ID is already used, please pick a new ID."):(this.addMapDecoration(c.toolBarDecoration),c.positionPending&&c.setPosition(),c.initBuiltInTools(),c.initCustomBts(),this.on(a.event.MapEvent.MAP_CLEAN,c.clearTools,this)))},addMagnifier:function(b){a.notNull(b)&&(this.addMapDecoration(b),b.map=this)},removeToolbar:function(a){this.removeMapDecoration(a.toolBarDecoration);a.destroy();a.map=null},addNavigationPanelBar:function(){var b=
new a.control.NavigationPanelBar;this.addMapDecoration(b)},addScaleBar:function(){var b=new a.control.ScaleBar;this.addMapDecoration(b)},addScaleBarValue:function(b,c){this.ScaleBar||this.addMapDecoration(c);c.$DecorationDiv.css({display:"none"});a.$(b).html(c.getTopScaleValue()+"\x3cbr\x3e"+c.getBottomScaleValue());this.on(a.event.MapEvent.MAP_AFTER_REFRESH,function(){a.$(b).html(c.getTopScaleValue()+"\x3cbr\x3e"+c.getBottomScaleValue())})},addScaleBarUnit:function(b,c){this.ScaleBar||this.addMapDecoration(c);
c.$DecorationDiv.css({display:"none"});a.$(b).html(c.getTopScaleUnit()+"\x3cbr\x3e"+c.getBottomScaleUnit());this.on(a.event.MapEvent.MAP_AFTER_REFRESH,function(){a.$(b).html(c.getTopScaleUnit()+"\x3cbr\x3e"+c.getBottomScaleUnit())})},addScaleBarDiv:function(b,c){this.ScaleBar||this.addMapDecoration(c);c.$DecorationDiv.css({display:"none"});c.getBottomScaleBar()?a.$(b).html(c.getTopScaleBar().prop("outerHTML")+c.getBottomScaleBar().prop("outerHTML")):a.$(b).html(c.getTopScaleBar().prop("outerHTML"));
this.on(a.event.MapEvent.MAP_AFTER_REFRESH,function(){c.getBottomScaleBar()?a.$(b).html(c.getTopScaleBar().prop("outerHTML")+c.getBottomScaleBar().prop("outerHTML")):a.$(b).html(c.getTopScaleBar().prop("outerHTML"))})},addMapDecoration:function(b,c){c?(this._decoration[b.type]=c,b.collapsible=!1,b.draggable=!1):this._decoration[b.type]=null;if(this.graphics&&a.notNull(b)){this.decorationArray=this.decorationArray||[];for(var m=0;m<this.decorationArray.length;m++)if(b.id===this.decorationArray[m].id||
b.mapType===this.decorationArray[m].mapType&&"mapTypeControl"==b.mapType)return;this.decorationArray.push(b);b.map=this;this.initialized||"ToolBar"==b.type?b.display():("CopyRight"===b.type&&(this.copyRight=b),this.on(a.event.MapEvent.MAP_INITIALIZED,b.display,b),this.on(a.event.MapEvent.MAP_RESET_UNIVERSE,b.display,b));this.on(a.event.MapEvent.MAP_DESTROY,b.remove,b);this.on(a.event.MapEvent.MAP_CLEAN,b.clean,b)}},removeMapDecoration:function(b){if(this.decorationArray&&0!==this.decorationArray.length&&
b)for(var c=0;c<this.decorationArray.length;c++)if(this.decorationArray[c].id===b.id){this.decorationArray.splice(c,1);this.deleteListener(a.event.MapEvent.MAP_CLEAN,b._cleanMapDecoration);this.deleteListener(a.event.MapEvent.MAP_DESTROY,b._removeMapDecoration);this.deleteListener(a.event.MapEvent.MAP_INITIALIZED,b.display);this.deleteListener(a.event.MapEvent.MAP_RESET_UNIVERSE,b.display);b.remove();break}},showOverviewMap:function(){this.setOverviewMapOptions({display:!0})},hideOverviewMap:function(){this.setOverviewMapOptions({display:!1})},
setOverviewMapOptions:function(a){a&&a.overviewLayer&&(-1==this.getLayerCurrentIndex(a.overviewLayer)?a.overviewLayer=null:this.userSetOL=!0);this.overview&&this.overview.setOverviewMapOptions(a)},getCursorLocation:function(){return this.getScreenPointLocation(this.mLocX,this.mLocY)},getAbsoluteCursorLocation:function(){return this.getScreenPointLocation(this.mLocX,this.mLocY,!0)},getACL:function(b,c){var m=this.getMapContext(),k=m.getBaseWholeMapIndex(),m=m.getUniverse().getMapBounds().getWidth(),
k=b.getX()+(c-k)*m;return new a.geometry.Point(k,b.getY(),b.srid)},getScreenPointLocation:function(b,c,m){var k=this.getMapContext().getBaseWholeMapIndex(),aa=k,u=a.MapContext(this),C=u.getUniverse(),E=u.getZoomLevel(),P=u.getCenterPoint();b-=u.getDeviceWidth()/2;c-=u.getDeviceHeight()/2;var W=null;if(C&&C.zoomLevels){var E=this.checkZoomLevel(E),M=C.zoomLevels[E].resolution,W=C.zoomLevels[E].stretchRatio;b=P.getX()+b*M;c=P.getY()-c*M*W;return this.wraparound?(u=u.getUniverse().getMapBounds().getWidth(),
b<-u/2&&(aa=k+Math.floor((b+u/2)/u)),b>u/2&&(aa=k+Math.ceil((b-u/2)/u)),m||(b<-u/2&&(b-=u*Math.floor((b+u/2)/u)),b>u/2&&(b-=u*Math.ceil((b-u/2)/u))),m=new a.geometry.Point(b,c,C.srid),m.setPointIndex(aa),m):isNaN(b)||isNaN(c)?null:new a.geometry.Point(b,c,C.srid)}return null},getScreenLocation:function(b){var c=a.MapContext(this),m=c.getUniverse();if(m&&m.zoomLevels){var k=this.checkZoomLevel(c.getZoomLevel()),aa=m.zoomLevels[k].resolution,m=m.zoomLevels[k].stretchRatio,k=c.getCenterPoint(),u=b.getX();
b=b.getY();u=(u-k.getX())/aa+c.getDeviceWidth()/2;c=(k.getY()-b)/aa*m+c.getDeviceHeight()/2;return{x:Math.round(u),y:Math.round(c)}}},getMapWindowBoundingBox:function(){var b=a.MapContext(this).getDeviceWindow(),c=this.getScreenPointLocation(0,0),b=this.getScreenPointLocation(b.w,b.h);return a.isNull(c)?null:new a.geometry.Rectangle(c.getX(),c.getY(),b.getX(),b.getY(),b.srid)},getMaxResolution:function(){},getMinResolution:function(){},setMaxResolution:function(){},setMinResolution:function(){},backToHomeMap:function(){var b=
this.getMapContextToken();a.isNull(b.homeMapZoomlevel)&&(b.homeMapZoomlevel=b.zoomLevel);b.homeMapCenter||(b.homeMapCenter=b.centerPoint);this.setMapCenterAndZoomLevel(b.homeMapCenter,b.homeMapZoomlevel,!0)},setLayerIndex:function(b,c){var m=this.divLayers.length,k=this.svgLayers.length,aa=this.getLayerCurrentIndex(b);if(aa==c)return c;if(a.Map.isTileLayer(b.layerType)){if(1>=c)return this.sendToBottom(b);if(c>=m)return this.bringToTop(b);aa--;this.divLayers.splice(aa,1);this.divLayers.splice(c-1,
0,b);for(m=0;m<this.divLayers.length;m++)a.$("#tilelayer_"+this.divLayers[m].name).css({"z-index":m})}else{if(c<=m+1)return this.sendToBottom(b);if(c>=m+k-2)return this.bringToTop(b);if(a.isNotNull(b.heatMap)&&null!==b.getRenderingStyle()&&b.getRenderingStyle()instanceof a.style.HeatMap)return c<aa?this.sendToBottom(b):this.bringToTop(b);k=c-m-1;this.svgLayers.splice(aa-m-1,1);this.svgLayers.splice(k,0,b);this.graphics.setDisplayIndex(b.group,k)}m=new a.event.MapEvent(a.event.MapEvent.LAYER_REORDERED,
this);m.affectedLayer=b;this.fire(m.type,m);return c},getLayerCurrentIndex:function(b){var c,m;if(a.Map.isTileLayer(b.layerType)){m=this.divLayers.length;if(0===m)return-1;for(c=0;c<m;c++)if(this.divLayers[c]==b)return c+1}else{m=this.svgLayers.length;if(0===m)return-1;for(c=0;c<m;c++)if(this.svgLayers[c]==b)return c+this.divLayers.length+1}return-1},bringForward:function(b){var c=this.getLayerCurrentIndex(b);if(!(0>c)){var m=null,k=new a.event.MapEvent(a.event.MapEvent.LAYER_REORDERED,this);k.affectedLayer=
b;if(a.Map.isTileLayer(b.layerType)){if(this.divLayers[this.divLayers.length-1]===b)return this.fire(k.type,k),this.divLayers.length;m=this.divLayers[c];this.divLayers[c]=b;this.divLayers[c-1]=m;for(b=0;b<this.divLayers.length;b++)a.$("#tilelayer_"+this.divLayers[b].name).css({"z-index":b});this.fire(k.type,k);return c+1}if(!(3>this.svgLayers.length)){if(this.svgLayers[this.svgLayers.length-3]==b)return this.fire(k.type,k),this.svgLayers.length-3+this.divLayers.length;if(a.isNotNull(b.heatMap)&&null!==
b.getRenderingStyle()&&b.getRenderingStyle()instanceof a.style.HeatMap)return this.bringToTop(b);m=this.svgLayers[c-this.divLayers.length];this.svgLayers[c-this.divLayers.length]=b;this.svgLayers[c-1-this.divLayers.length]=m;this.graphics.bringForward(b.group);this.fire(k.type,k);return c+1}}},sendBackward:function(b){var c=this.getLayerCurrentIndex(b);if(!(0>c)){var m=new a.event.MapEvent(a.event.MapEvent.LAYER_REORDERED,this);m.affectedLayer=b;var k=null;if(a.Map.isTileLayer(b.layerType)){if(this.divLayers[0]==
b)return this.fire(m.type,m),1;k=this.divLayers[c-2];this.divLayers[c-2]=b;this.divLayers[c-1]=k;for(b=0;b<this.divLayers.length;b++)a.$("#tilelayer_"+this.divLayers[b].name).css({"z-index":b})}else{if(this.svgLayers[0]==b)return this.fire(m.type,m),1+this.divLayers.length;if(a.isNotNull(b.heatMap)&&null!==b.getRenderingStyle()&&b.getRenderingStyle()instanceof a.style.HeatMap)return this.sendToBottom(b);k=this.svgLayers[c-this.divLayers.length-2];this.svgLayers[c-2-this.divLayers.length]=b;this.svgLayers[c-
1-this.divLayers.length]=k;this.graphics.sendBackward(b.group)}this.fire(m.type,m);return c-1}},bringToTop:function(b,c){var m=this.getLayerCurrentIndex(b,c);if(!(0>m)){var k=new a.event.MapEvent(a.event.MapEvent.LAYER_REORDERED,this);k.affectedLayer=b;if(a.Map.isTileLayer(b.layerType)){if(this.divLayers[this.divLayers.length-1]==b)return this.fire(k.type,k),this.divLayers.length;this.divLayers.splice(m-1,1);this.divLayers.push(b);for(m=0;m<this.divLayers.length;m++)a.$("#tilelayer_"+this.divLayers[m].name).css({"z-index":m});
this.fire(k.type,k);return this.divLayers.length}var aa=this.divLayers.length;if(this.svgLayers[this.svgLayers.length-2]==b)return c||this.fire(k.type,k),this.svgLayers.length-2+aa;c?(this.svgLayers.splice(m-aa-1,1),this.svgLayers.push(b)):(this.svgLayers.splice(m-aa-1,1),this.svgLayers.splice(this.svgLayers.length-2,0,b));if(b.group)return this.graphics.bringToTop(b.group),a.isNotNull(b.heatMap)&&null!==b.getRenderingStyle()&&b.getRenderingStyle()instanceof a.style.HeatMap&&b.getRenderingStyle().setIsTop(!0),
c?this.svgLayers.length+aa:(this.graphics.bringToTop(this.getDefaultFeatureLayer().group),this.graphics.bringToTop(this.getToolFeatureLayer().group),this.fire(k.type,k),this.svgLayers.length+aa-2)}},sendToBottom:function(b){var c=this.getLayerCurrentIndex(b);if(!(0>c)){var m=new a.event.MapEvent(a.event.MapEvent.LAYER_REORDERED,this);m.affectedLayer=b;if(a.Map.isTileLayer(b.layerType)){if(this.divLayers[0]===b)return this.fire(m.type,m),1;this.divLayers.splice(c-1,1);this.divLayers.splice(0,0,b);
for(b=0;b<this.divLayers.length;b++)a.$("#tilelayer_"+this.divLayers[b].name).css({"z-index":b});this.fire(m.type,m);return 1}var k=this.divLayers.length;if(2<this.svgLayers.length&&this.svgLayers[0]==b)return this.fire(m.type,m),1+k;if(2>this.svgLayers.length)return-1;this.svgLayers.splice(c-k-1,1);this.svgLayers.splice(0,0,b);this.graphics.sendToBottom(b.group);a.isNotNull(b.heatMap)&&null!==b.getRenderingStyle()&&b.getRenderingStyle()instanceof a.style.HeatMap&&b.getRenderingStyle().setIsTop(!1);
this.fire(m.type,m);return 1+k}},setInfoWindowStyle:function(a){this.infoWindowOptions=a},displayInfoWindow:function(b,c,m){this.isCustomInfoWindow=m&&m.builtInInfoWindow?!1:!0;this.infoWindowOptions&&a.$.each(this.infoWindowOptions,function(a,b){m[a]||(m[a]=b)});this.infoLayer||(this.infoLayer=new a.infowindow.InfoWindow(this,"1",m),this.tab=!1);if(!b||!c)return null;var k=this,aa=function(){var u=k.getMapContext().getUniverse();k.deleteListener(a.event.MapEvent.MAP_INITIALIZED,aa);(m?m:{}).universe=
u;var C=function(a){a&&(b=a);k.infoLayer.showInfoWindow(c,b,m)};u.srid!=b.srid?b.transform(u.srid,C):C()};if(k.initialized)aa();else this.on(a.event.MapEvent.MAP_INITIALIZED,aa)},displayTabbedInfoWindow:function(b,c,m){this.infoLayer||(this.infoLayer=new a.infowindow.InfoWindow(this,"1",m),this.tab=!0);if(!b||!c)return null;var k=this,aa=this.getMapContext().getUniverse(),u=function(){k.deleteListener(a.event.MapEvent.MAP_INITIALIZED,u);(m?m:{}).universe=aa;var C=function(a){a&&(b=a);k.infoLayer.showTabInfoWindow(b,
c,m)};aa.srid!=b.srid?b.transform(aa.srid,C):C()};if(k.initialized)u();else this.on(a.event.MapEvent.MAP_INITIALIZED,u,this)},printReset:function(){this.$oracleMapDiv[0].className="";this.$printMapDiv&&this.$printMapDiv.empty()},getLabelGridBox:function(a){var b=this.getMapContext();a=b.getUniverse();var b=b.getZoomLevel(),b=a.getZoomLevels()[b],c=a.bound;a=c.getWidth()/b.resolution;b=c.getHeight()/b.resolution/b.stretchRatio;return{minX:0,minY:0,maxX:a,maxY:b}},refreshVectorLayerLabels:function(){if(this.svgLayers&&
!(0>=this.svgLayers.length)){var a=!1,b=this.svgLayers.length,c;for(c=0;c<b;c++)if(this.svgLayers[c].labelsVisible()){a=!0;break}if(a){this.grid.clear();for(c=0;c<b;c++)a=this.svgLayers[c],a.labelsVisible()&&a.clearAllLabels(),a.addMarkerBoundToGrid();for(c=b-1;-1<c;c--)a=this.svgLayers[c],a.isVisible()&&a.labelsVisible()&&a.addLabels()}}},getLayerByName:function(a){for(var b=this.svgLayers.length;b--;)if(this.svgLayers[b].name===a)return this.svgLayers[b];for(b=this.divLayers.length;b--;)if(this.divLayers[b].name===
a)return this.divLayers[b]},getFeatureLayers:function(){return this.svgLayers},getTileLayers:function(){return this.divLayers},getDefaultFeatureLayer:function(){if(!a.gv.internalLayersEnabled)return{};a.notNull(this.defaultFeatureLayer)?this.defaultFeatureLayer.bringToTop(!0):(this.defaultFeatureLayer=new a.layer.VectorLayer("ii_oracle_maps_internal_editing",{def:{type:a.layer.VectorLayer.TYPE_LOCAL}}),this.defaultFeatureLayer.selectionEnable=!1,this.defaultFeatureLayer.setBringToTopOnMouseOver(!1),
this.addLayer(this.defaultFeatureLayer));return this.defaultFeatureLayer},getToolFeatureLayer:function(){if(!a.gv.internalLayersEnabled)return{};a.notNull(this.toolFeatureLayer)?(this.toolFeatureLayer.bringToTop(!0),this.defaultFeatureLayer&&this.getDefaultFeatureLayer()):(this.toolFeatureLayer=new a.layer.VectorLayer("ii_oracle_maps_internal_others",{def:{type:a.layer.VectorLayer.TYPE_LOCAL}}),this.toolFeatureLayer.selectionEnable=!1,this.toolFeatureLayer.setBringToTopOnMouseOver(!1),this.toolFeatureLayer.enableFeatureEditing(!0),
this.addLayer(this.toolFeatureLayer),this.getDefaultFeatureLayer());return this.toolFeatureLayer},touchStart:function(b){b.preventDefault();var c=a.util.DomUtil;this.touchCount=c.getTouchCount(b);if(!(2<this.touchCount)){this.pinchZoomScale=1;var m=this.touchStartLocs;if(1==this.touchCount){c=c.getTouchesPosition(b);m.length=0;m.push(c);this.touchStartLocs_backup.push({x:c.x,y:c.y});var c=this.lastTouchTimeStamp,k=b.timeStamp;this.lastTouchTimeStamp=k;500>k-c&&this.initialized?(this.doubleTap=!0,
b.preventDefault()):this.doubleTap=!1;this.tStartLocsX=m[0].x;this.tStartLocsY=m[0].y}else 2==this.touchCount&&(b=c.getChangedTouchesPosition(b),1==b.length?m.push(b[0]):2==b.length&&(m.length=0,m.push(b[0]),m.push(b[1])),this.doubleTap=!1);2==m.length&&(b=m[1].x-m[0].x,c=m[1].y-m[0].y,this.pinchZoomStartDist=Math.sqrt(b*b+c*c));this.moveflag=!0;b=this.$oracleMapDiv.offset();this.mLocX=m[0].x-b.left;this.mLocY=m[0].y-b.top}},touchMove:function(b){b.preventDefault();if(0!==this.touchStartLocs.length){var c=
a.util.DomUtil,m=this.$oracleMapDiv.offset();this.mLocX=this.touchStartLocs[0].x-m.left;this.mLocY=this.touchStartLocs[0].y-m.top;if(2==this.touchCount||c.getTouchesPosition(b).length){if(m=c.getTouchesScale(b),a.isNull(m)&&(b=c.getTouchesPosition(b),m=b[0].x-b[1].x,b=b[0].y-b[1].y,m=Math.sqrt(m*m+b*b)/this.pinchZoomStartDist),this.pinchZoomScale=m,!(1==m||0>=m||(b=this.getMapZoomLevel(),1<m&&b>=this.maxZoom||1>m&&0>=b)))for(this.pinchZooming=!0,this.graphics.setVisible(this.draggableGroup,!1),this.$heatMapDiv.css({visibility:"hidden"}),
b=0;b<this.divLayers.length;b++)this.divLayers[b].zoomControl&&this.divLayers[b].zoomControl.scaleTiles(m)}else m=c.getTouchesPosition(b),b=m.x-this.touchStartLocs[0].x,c=m.y-this.touchStartLocs[0].y,this.touchStartLocs[0].x=m.x,this.touchStartLocs[0].y=m.y,this.moveflag&&this.enableMapAction.drag&&this.pan(b,c,!1)}},touchEnd:function(b){if(!(b.isDefaultPrevented()||(b.preventDefault(),this.touchCount-=a.util.DomUtil.getTouchCount(b),0<this.touchCount))){var c=this.pinchZoomScale;this.pinchZooming?
(b=this.getScaleZoomLevel(c),this.setMapZoomLevel(b),this.pinchZoomScale=1,this.pinchZooming=!1,this.graphics.setVisible(this.draggableGroup,!0),this.$heatMapDiv.css({visibility:"visible"}),this.doubleTap=!1):(this.doubleTap&&this.enableMapAction.dbclick?(this.setMapCenterAndZoomLevel(this.getCursorLocation(),a.MapContext(this).getZoomLevel()+1,!0),b.preventDefault()):this.moveflag&&(this.moveflag=!1,b=this.touchStartLocs_backup[0].x-this.touchStartLocs[0].x,c=this.touchStartLocs_backup[0].y-this.touchStartLocs[0].y,
Math.sqrt(b*b+c*c)<a.gv.touchMoveThreshold&&this.pan(b,c,!1),this.touchStartLocs_backup.length=0,b=new a.event.MapEvent(a.event.MapEvent.MAP_RECENTERED,this),this.fire(b.type,b)),1===this.touchStartLocs.length&&this.touchStartLocs[0]&&0===this.tStartLocsX-this.touchStartLocs[0].x&&0===this.tStartLocsY-this.touchStartLocs[0].y&&this.handleTouchEnd(this));this.touchStartLocs.length=0}},getScaleZoomLevel:function(a){var b=this.getMapContext(),c=b.getZoomLevel();if(0<a&&(1>a&&.9<a||1<a&&1.1>a))return c;
var k=b.getUniverse().getZoomLevels(),aa=k.length-1,b=k[c].resolution/a;if(1>a){for(a=c-1;0<=a;a--)if(c=k[a].resolution,b<=c){k=b/k[a+1].resolution;b=c/b;if(k>b)return a;break}return a+1}for(a=c+1;a<=aa;a++)if(c=k[a].resolution,b>=c){k=k[a-1].resolution/b;b/=c;if(k>b)return a;break}return a-1},cleanMap:function(){this.initialized=this.displayed=!1;var b=new a.event.MapEvent(a.event.MapEvent.MAP_CLEAN,this);this.fire(b.type,b);b=0;if(this.graphics)for(this.graphics.clearGroup(this.draggableGroup),
this.graphics.clearGroup(this.blockerGroup),this.graphics.clearGroup(this.fixedGroup),b=0;b<this.svgLayers.length;b++)this.graphics.clearGroup(this.svgLayers[b].group);this.$tileLayersDiv.empty();this.$fkGraphicLayersDiv.unbind();for(b=0;b<this.decorationArray.length;b++){var c=this.decorationArray[b];"OverviewMap"===c.type&&(c.$DecorationBtnDiv.remove(),c.$DecorationDiv.remove())}},checkCenter:function(){if(this.overview||!this.hasExternal){var b=this.getMapContextToken(),c=b.universe,m=b.zoomLevel,
k=c.zoomLevels[m].resolution,m=c.zoomLevels[m].stretchRatio,aa=c.bound;b.homeCenter||(b.homeCenter=new a.geometry.Point((aa.getMinX()+aa.getMaxX())/2,(aa.getMinY()+aa.getMaxY())/2,c.srid));b.centerPoint=b.homeCenter.clone();this.wraparound&&(b.roundMapCenterPoint=b.homeCenter.clone());var u=b.centerPoint,c=b.deviceWindow,C=u.getX()-c.w/2*k,E=u.getX()+c.w/2*k,P=u.getY()-c.h/2*k*m,u=u.getY()+c.h/2*k*m,W={x:!0,y:!0},M=b.centerPoint.getX(),r=b.centerPoint.getY();this.wraparound||(C<aa.getMinX()&&E>aa.getMaxX()||
E-C>aa.getWidth()?M=(aa.getMinX()+aa.getMaxX())/2:C<aa.getMinX()?M=aa.getMinX()+c.w/2*k:E>aa.getMaxX()?M=aa.getMaxX()-c.w/2*k:W.x=!1);P<aa.getMinY()&&u>aa.getMaxY()||u-P>aa.getHeight()?r=(aa.getMinY()+aa.getMaxY())/2:P<aa.getMinY()?r=aa.getMinY()+c.h/2*k*m:u>aa.getMaxY()?r=aa.getMaxY()-c.h/2*k*m:W.y=!1;b.centerPoint.setPoint(M,r);this.wraparound&&b.roundMapCenterPoint.setPoint(M,r);return W}},resetUniverse:function(b,c){var m=this.getMapContextToken();m.universe.srid!==b.srid&&this.iterateVectorLayers(function(a){a.rtree=
null});m.universe=b;m.transform=null;this.graphics.setLeftTop(this.draggableGroup,0,0);for(var k=this.divLayers.length,k=c.getZIndex()-1;0<k;)this.removeLayer(this.divLayers[0]),k--;this.universeLayerIndex=0;for(var k=this.svgLayers.length,aa=0;aa<k;aa++){var u=this.svgLayers[aa];u.dataLoaded=!1;u.loaded=!1;u.heatMap=null;u.renderingStyle&&"HeatMap"==u.renderingStyle.styleType&&u.renderingStyle.containerVectorLayer&&(u.renderingStyle.containerVectorLayer.dataLoaded=!1);u.boundingTheme&&(u.loadedBoundingTheme=
!1)}k=m.universe;if(this.overview){var C=this.overview.submap.getMapContextToken(),aa=C.universe;if(this.overview.submap){aa.zoomLevels=k.zoomLevels;aa.srid=k.srid;aa.bound=k.bound;this.overview.layer&&this.overview.layer.parentMap&&(k=this.overview.layer,k.copyFeatures&&this.overview.mainmap.overviewLayer.deleteListener(a.event.LayerEvent.FEATURES_LOADED,k.copyFeatures),this.overview.submap.removeLayer(this.overview.layer));var E=this;m.centerPoint.transform(m.universe.srid,function(a){m.centerPoint=
a;C.centerPoint=m.centerPoint;C.homeCenter=m.centerPoint;C.zoomLevel=m.zoomLevel-E.overview.calMapZoomDiff()})}}this.boundingThemeLoaded=this.boundingThemeLoading=!1;this.extentRect=this.boundingLayerName=null;this.resetTag=!0;this.init()},getMapAsSVG:function(b){var A=this.graphics,m=A.oui,k=m.viewportBounds,aa=k.width,u=k.height,C=this.divLayers.length,E=this,P=A.createGroup({x:0,y:0}),W;for(W=0;W<C;W++)this.divLayers[W].exportToSVG(P,aa,u);var M=[P,this.draggableGroup];for(W=0;W<this.decorationArray.length;W++){var r=
this.decorationArray[W];(r instanceof a.control.ScaleBar||r instanceof a.control.CopyRight)&&r.defaultGroup&&M.push(r.defaultGroup)}var q=function(){if(E.graphics){for(var a=0;a<C;a++)if(0!==E.divLayers[a].loadImg){c.setTimeout(q,200);return}a=(new m.io.svg.SVGExporter).snapshotNodes(M,k,aa,u);a.style="overflow:hidden";a=m.io.XMLConverter.convert(a,"");A.clearGroup(P);b(a)}};c.setTimeout(q,0)},getFlattenedCanvas:function(c,A,m,k){var aa=this.graphics.oui.viewportBounds,u=Math.round(aa.width),aa=Math.round(aa.height);
A||(A=u);m||(m=aa);k=k||{};k.navigationPanelBar=k.navigationPanelBar||!1;k.scaleBar===b&&(k.scaleBar=!0);this.getTileCanvas(A,m);var C=this;this.drawVectorInPrintCanvas(A,m,function(b){C.drawImageEnd(A,m,b,function(b,k){a.$("#printVC"+C.mapInstanceId).remove();c(b,k)})},k)},getTileCanvas:function(a,b){for(var c=0,k=this.divLayers.length;c<k;c++)this.divLayers[c].isVisible()&&(this.divLayers[c].canvas=document.createElement("canvas"),this.divLayers[c].canvas.width=a,this.divLayers[c].canvas.height=
b,this.divLayers[c].drawTilesImages(a,b))},drawVectorInPrintCanvas:function(b,c,m,k){var aa=a.$("\x3cdiv id \x3d'printVC"+this.mapInstanceId+"' style\x3d'visibility:hidden;width:"+b+"px;height:"+c+"px'\x3e\x3c/div\x3e");a.$(document.body).append(aa);for(var u=new a.Map(aa[0],{universe:this.getMapContext().getUniverse(),hiDPI:!0}),aa=this.svgLayers.length,C=0,E=0,P=this.svgLayers.length;E<P;E++){var W=this.svgLayers[E];if("ii_oracle_maps_internal_editing"!==W.name&&"ii_oracle_maps_internal_others"!==
W.name)if(W.isVisible()){if(W.clustering&&W.dataBufferWindow){var M=W.maxClusteringLevel,r=W.vCluster.minPointCount,q=W.vCluster.threshold,N=W.vCluster.clusterStyle,Z=W.zoomInLevels,ba;!1===Z||0===Z?(Z=0,ba=!1):ba=!0;W=W.clone();if("undefined"!==typeof N){var Y=N.marker,Y=new a.style.VariableMarker(N.origConfig);W.enableClustering(!0,{clusterStyle:Y,minPointCount:r,maxClusteringLevel:M,threshold:q,enableZoomIn:ba,zoomInLevels:Z})}else a.util.Logger.severe("CLUSTER_ERROR","OM.Map","Cluster configuration lost")}else W=
W.clone();u.addLayer(W);C++}else aa--}u.setMapCenter(this.getMapCenter());u.setMapZoomLevel(this.getMapZoomLevel());for(aa=0;aa<this.decorationArray.length&&!a.isNull(k);aa++)C=this.decorationArray[aa],k.navigationPanelBar&&C instanceof a.control.NavigationPanelBar&&C.isVisible()?(E=new a.control.NavigationPanelBar({orientation:C.orientation,style:C.style,anchorPosition:C.anchorPosition}),E.setStyle({position:C.position,backgroundColor:C.backgroundColor,buttonColor:C.buttonColor}),u.addMapDecoration(E)):
k.scaleBar&&C instanceof a.control.ScaleBar&&C.isVisible()?(E=new a.control.ScaleBar({format:C.format,anchorPosition:C.anchorPosition}),E.setStyle({fontSize:C.fontSize,scalebar_color:C.scalebar_color,thickness:C.thickness,maxLength:C.maxLength}),u.addMapDecoration(E)):k.copyRight&&C instanceof a.control.CopyRight&&C.isVisible()&&(C=new a.control.CopyRight({textValue:C.textValue,anchorPosition:C.anchorPosition,fontSize:C.fontSize,fontFamily:C.fontFamily,fill:C.fontColor}),u.addMapDecoration(C));u.on(a.event.MapEvent.MAP_AFTER_REFRESH,
function(){u.getVectorCanvas(b,c,m,k)});u.init()},getVectorCanvas:function(b,A,m,k){var aa=document.createElement("canvas");aa.width=b;aa.height=A;var u=aa.getContext("2d"),C,E,P=this;C=0;for(E=this.svgLayers.length;C<E;C++){var W=this.svgLayers[C];W.checkVisible()&&W.heatMap&&(W=W.getHeatmapDivId()+"\x3ecanvas",W=a.$(W)[0],u.drawImage(W,W.offsetLeft,W.offsetTop))}var M=this.$fkGraphicLayersDiv.children()[0];if("CANVAS"==M.tagName){var r=[];for(C=0;C<this.decorationArray.length;C++)if(b=this.decorationArray[C],
k&&!1===k.navigationPanelBar&&b instanceof a.control.NavigationPanelBar&&b.isVisible()||k&&!1===k.scaleBar&&b instanceof a.control.ScaleBar&&b.isVisible()||k&&!1===k.copyRight&&b instanceof a.control.CopyRight&&b.isVisible())b.setVisible(!1),r.push(b);setTimeout(function(){var a=1;!1!==this.hiDPI&&(a=(c.devicePixelRatio||1)/(u.webkitBackingStorePixelRatio||u.mozBackingStorePixelRatio||u.msBackingStorePixelRatio||u.oBackingStorePixelRatio||u.backingStorePixelRatio||1));u.save();u.scale(1/a,1/a);u.drawImage(M,
M.offsetLeft,M.offsetTop);u.restore();for(a=r.pop();a;)a.setVisible(!0),a=r.pop();2!==P.svgLayers.length||"ii_oracle_maps_internal_editing"!==P.svgLayers[0].name&&"ii_oracle_maps_internal_editing"!==P.svgLayers[1].name||"ii_oracle_maps_internal_others"!==P.svgLayers[0].name&&"ii_oracle_maps_internal_others"!==P.svgLayers[1].name||(aa=null);m(aa)},50)}else{C=[this.draggableGroup,this.fixedGroup];k=this.graphics.oui;C=(new k.io.svg.SVGExporter).snapshotNodes(C,k.viewportBounds,b,A);C.style="overflow:hidden";
k=k.io.XMLConverter.convert(C,"");try{u.drawSvg(k,0,0,b,A)}catch(q){a.util.Logger.alert("MAPVIEWER_9040","OM.Map.getMapAsImage")}m(aa)}},drawImageEnd:function(b,c,m,k){var aa=document.createElement("canvas"),u=document.createElement("canvas"),C=!0,E=!0;aa.width=b;aa.height=c;u.width=b;u.height=c;var P=aa.getContext("2d"),W=u.getContext("2d"),M=this,r=function(){for(var b=0,c=M.divLayers.length;b<c;b++)if(M.divLayers[b].canvas&&M.divLayers[b].loadingImg){setTimeout(r,100);return}b=0;for(c=M.divLayers.length;b<
c;b++)M.divLayers[b].canvas&&(P.drawImage(M.divLayers[b].canvas,0,0),C=!1);a.notNull(m)&&(W.drawImage(m,0,0),E=!1);!0===C&&(aa=null);!0===E&&(u=null);k(aa,u)};setTimeout(r,100)},getMapAsServerImage:function(b,c,m,k){var aa=this.mapviewerURL+"/omserver";this.getMapAsXML("GIF_URL",function(c){a.util.HttpRequest.send(aa,{xml_request:c},function(k){k=a.$(k).find("map_content");a.isNull(k)?a.util.Logger.alert("MAPVIEWER_9009","OM.Map.getMapAsServerImage",c):(k=k.attr("url"),b(k))},"xml")},c,m,k)},deleteFeatureInfoWindow:function(a){this.infoLayer&&
this.infoLayer.deleteInfoWindowById(a)},build_decos_xml:function(b){for(var c="",m=0;m<this.decorationArray.length;m++){var k=this.decorationArray[m];"ScaleBar"!=k.type||!a.isNull(b)&&!1===b.scaleBar||(c+=this.build_scale_bar(k))}return a.notNull(c)&&0<c.length?"\x3cscale_bar"+c+"/\x3e":""},build_scale_bar:function(b){var c="";switch(b.anchorPosition){case a.control.MapDecoration.POSITION_LOWER_LEFT:c+=' position\x3d"SOUTH_WEST"';break;case a.control.MapDecoration.POSITION_LOWER_RIGHT:c+=' position\x3d"SOUTH_EAST"';
break;case a.control.MapDecoration.POSITION_UPPER_LEFT:c+=' position\x3d"NORTH_WEST"';break;case a.control.MapDecoration.POSITION_UPPER_RIGHT:c+=' position\x3d"NORTH_EAST"';break;case a.control.MapDecoration.POSITION_LOWER_CENTER:c+=' position\x3d"SOUTH"';break;case a.control.MapDecoration.POSITION_UPPER_CENTER:c+=' position\x3d"NORTH"'}c="METRIC"===b.format?c+' mode\x3d"METRIC_MODE"':"IMPERIAL"===b.format?c+' mode\x3d"US_MODE"':c+' mode\x3d"DUAL_MODES"';c+=' length_hint\x3d"'+b.maxLength+'"';c=c+
' label_font_family\x3d"Serif"'+(' label_font_size\x3d"'+(a.notNull(b.fontSize)?b.fontSize:12)+'"');c+=' color1\x3d"'+b.scaleBarColor+'"';c+=' label_color\x3d"'+b.fontColor+'"';return c+=' label_font_weight\x3d"'+b.fontWeight+'"'},build_copy_right:function(){return""},getMapAsXML:function(b,c,m,k,aa){var u=a.MapContext(this);b||(b="GIF_URL");var C=u.getUniverse().getMapBounds().getWidth();if(u.getQueryWindow().getMinX()<-C/2||u.getQueryWindow().getMaxX()>C/2)m=u.getZoomLevel(),m=this.getLabelGridBox(m).maxX;
m||(m=u.getDeviceWidth());k||(k=u.getDeviceHeight());C=a.gv.defaultDataSource;a.isNull(C)&&(aa&&aa.dataSource?C=aa.dataSource:a.util.Logger.warning("MAPVIEWER_9104","OM.Map.getMapAsXML"));var E='\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e',E=E+'\x3cmap_request datasource\x3d"'+C+'" format\x3d"'+b+'" width\x3d"'+m+'" height\x3d"'+k+'" antialiase\x3d"true" transparent\x3d"true" srid\x3d"'+u.getUniverse().getSRID()+'"';b=!1;for(var P,C=this.divLayers.length-1;-1<C;C--){var W=this.divLayers[C];
if(W.isVisible()&&W.getStaticMapURL&&W.layerType!==a.LayerTypes.DYNAMIC_TILE){b=!0;P=W.getStaticMapURL(m,k);break}}var M=this.getAndCombineDTLURLs(m,k),r=this.build_decos_xml(aa),u=u.getQueryWindow().getHeight(),C=this.getMapCenter(),q='\x3ccenter size\x3d"'+u+'"\x3e\x3cgeoFeature\x3e\x3cgeometricProperty typeName\x3d"center"\x3e\x3cPoint\x3e\x3ccoordinates\x3e'+C.getX()+","+C.getY()+"\x3c/coordinates\x3e\x3c/Point\x3e\x3c/geometricProperty\x3e\x3c/geoFeature\x3e\x3c/center\x3e";b?(P=P.replace(/&/g,
"\x26amp;"),P=P.replace(/</g,"\x26lt;"),P=P.replace(/>/g,"\x26gt;"),this.drawVectorInPrintCanvas(m,k,function(b){E+=" bgimage\x3d'"+P+"'";a.isNull(M)||0===M.trim().length?(E+=a.notNull(b)?' bgimage2\x3d"'+b.toDataURL()+'"':"",E+="\x3e"+q):(E+=a.notNull(b)?' fgimage\x3d"'+b.toDataURL()+'"':"",E+="\x3e"+q+M);E+=r+"\x3c/map_request\x3e";c(E)},aa)):this.getFlattenedCanvas(function(b,k){a.isNull(M)||0===M.trim().length?(a.notNull(b)?(E+=' bgimage\x3d"'+b.toDataURL()+'"',a.notNull(k)&&(E+=' fgimage\x3d"'+
k.toDataURL()+'"')):a.notNull(k)&&(E+=' bgimage\x3d"'+k.toDataURL()+'"'),E+="\x3e"+q):(a.notNull(b)&&(E+=' bgimage\x3d"'+b.toDataURL()+'"'),a.notNull(k)&&(E+=' fgimage\x3d"'+k.toDataURL()+'"'),E+="\x3e"+q+M);E+=r+"\x3c/map_request\x3e";c(E)},m,k,aa)},getDTLURLs:function(b,c){for(var m=[],k=null,aa=0;aa<this.divLayers.length;aa++)k=this.divLayers[aa],k.isVisible()&&k.getStaticMapURL&&k.layerType===a.LayerTypes.DYNAMIC_TILE&&(k=k.getStaticMapURL(b,c),m.push(k));return m},getAndCombineDTLURLs:function(b,
c){var m=this.getDTLURLs(b,c);return a.layer.DynamicTileLayer.combineDTLURLs(m)},print:function(){a.$(document.body).css("cursor","wait");this.$oracleMapDiv.css("cursor","wait");var b=this;this.getMapAsSVG(function(A){a.$(document.body).css("cursor","");b.$oracleMapDiv.css("cursor","");var m=c.open();m.document.write(A);m.print()})},enableMapDrag:function(a){this.enableMapAction.drag=a},enableMapWraparound:function(a){this.wraparound=a},enableMouseWheelZooming:function(a){this.enableMapAction.mousewheel=
a},enableMapZoom:function(a){this.zoomEnabled=a;this.overview&&this.overview.enableOverViewMapZoom(a)},enableDoubleClick:function(a){this.enableMapAction.dbclick=a},setMouseWheelZoomBehavior:function(a){this.mouseWheelZoomBehavior=a},setHomeMap:function(a,b){var c=this.getMapContextToken();a&&(c.homeMapCenter=a);b&&(c.homeMapZoomlevel=b)},enableZoomAnimation:function(a){this.tileLayerZoomAnimation=a},setEnabledZoomLevels:function(b){this.universe&&(this.getMapContextToken().universe=this.universe);
if(a.util.ValidationUtil.isNumberArray(b)&&(b.sort(function(a,b){return a-b}),this.enableZoomLevels=b,0===this.divLayers.length&&2<this.svgLayers.length)){b={};for(var c=[],m,k,aa=this.getMapContext().getUniverse().getZoomLevels().length,u=0;u<this.enableZoomLevels.length;u++)aa-1<this.enableZoomLevels[u]?(m=this.getMapContext().getUniverse().getZoomLevels()[aa-1].resolution,k=this.getMapContext().getUniverse().getZoomLevels()[aa-1].stretchRatio):(m=this.getMapContext().getUniverse().getZoomLevels()[this.enableZoomLevels[u]].resolution,
k=this.getMapContext().getUniverse().getZoomLevels()[this.enableZoomLevels[u]].stretchRatio),c[u]=new a.universe.ZoomLevel(m,{stretchRatio:k});b.zoomLevels=c;b.srid=this.getMapContext().getUniverse().getSRID();b.bounds=this.getMapContext().getUniverse().getMapBounds();b.numberOfZoomLevels=this.enableZoomLevels.length;b=new a.universe.Universe(b);this.universe=this.getMapContext().getUniverse();this.getMapContextToken().universe=b}},enableInfoWindowEventPropagation:function(a){this.infoWindowEventPropogation=
a},closeInfoWindows:function(){this.infoLayer&&(this.infoLayer.closeInfoWindows(),this.isCustomInfoWindow=this.infoLayer=null)},replaceLayer:function(b,c){for(var m=0,k=this.divLayers.length;m<k;m++)if(this.divLayers[m]==b){this.divLayers[m]=c;c.parentMap=this;this.overviewLayer=c;m=a.event.MapEvent;k=a.event.LayerEvent;this.on(m.I_MAP_DRAGGING,c.panEvent,c);this.on(m.MAP_RECENTERED,c.recenter,c);this.on(m.I_MAP_CENTER_ZOOM,c.setCenterAndZoomlevel,c);this.on(m.MAP_BEFORE_REFRESH,c.refreshEvent,c);
this.on(m.MAP_REDRAW,c.redraw,c);this.on(m.MAP_DESTROY,c.destroy,c);c.addListener(k.FINISH_GOT_CONFIG,this.newLayerConfigLoaded);c.addListener(k.FINISH_LOAD,this.layerFinish);c.addListener(k.ALL_TILES_LOADED,this.layerFinish);c.addListener(k.INIT_ERROR,this.layerErr);c.addListener(k.RENDERING_STYLE_CHANGED,this.layerStyleChanged);c.addListener(k.NSDP_MAPPED,this.nsdpMapped);c.setContainer&&c.setContainer(this.$tileLayersDiv[0]);this.deleteLayerListener(b);break}},setAllInitialParams:function(){var b=
this.getMapContextToken();a.isNull(b.centerPoint)&&(b.centerPoint=new a.geometry.Point((b.universe.bound.getMinX()+b.universe.bound.getMaxX())/2,(b.universe.bound.getMinY()+b.universe.bound.getMaxY())/2,b.universe.srid));a.isNull(b.homeCenter)&&(b.homeCenter=b.centerPoint);a.isNull(b.zoomLevel)&&(b.zoomLevel=0);b.homeMapCenter||(b.homeMapCenter=b.centerPoint);b.homeMapZoomlevel||(b.homeMapZoomlevel=b.zoomLevel)},changeOverView:function(){if(!this.userSetOL&&this.overview){for(var b=this.divLayers.length-
1;0<=b;b--)if(a.notNull(this.divLayers[b].tileLayerConfig)&&!this.divLayers[b].tileLayerConfig.isTransparentImage&&this.overviewLayer!==this.divLayers[b]&&(this.divLayers[b].layerType!==a.LayerTypes.DYNAMIC_TILE||!1===this.divLayers[b].hideInOverviewMap)&&this.divLayers[b].isVisible()){this.overviewLayer=this.divLayers[b];this.overview.setOverviewMapOptions({overviewLayer:this.overviewLayer});return}if(0<this.divLayers.length)this.overviewLayer!==this.divLayers[0]&&(this.overviewLayer=this.divLayers[0],
this.overview.setOverviewMapOptions({overviewLayer:this.overviewLayer}));else if(2<this.svgLayers.length)for(var b=0,c=this.svgLayers.length;b<c;b++)if(this.svgLayers[b]!=this.toolFeatureLayer&&this.svgLayers[b]!=this.defaultFeatureLayer){this.overviewLayer!==this.svgLayers[b]&&(this.overviewLayer=this.svgLayers[b],this.overview.setOverviewMapOptions({overviewLayer:this.overviewLayer}));break}}},addVectorLayerByURL:function(b,c,m){this.addLayer(new a.layer.VectorLayer(this.generateLayerName(),{def:{type:a.layer.VectorLayer.TYPE_DATAPACK,
url:b},renderingStyle:c,boundingTheme:m}),"URL_Layer")},generateLayerName:function(){var a=0;return function(){return"URL_Layer_"+ ++a}}(),enableURLDragDrop:function(a,b){this.drapDrop=a;b&&(b.style&&(this.ddStyle=b.style),b.zoomToTheme&&(this.ddZoom=b.zoomToTheme))},setMouseCursorStyle:function(b,c){"hand"==b&&(b=a.CursorTypes.POINTER);"dragging"==c?this.cursorStyleDragging=b:"default"==c&&(this.cursorStyleDefault=b,this.changeCursor(b))},changeCursor:function(a){this.$oracleMapDiv.css("cursor",
a);this.graphics.oui&&this.graphics.oui.tree&&this.graphics.oui.tree.canvas&&(this.graphics.oui.tree.canvas.style.cursor=a)},isStoppedEvent:function(b){return b.type&&a.event.EventSource.stopEvents[b.type]?(a.event.EventSource.stopEvents[b.type]=!1,!0):!1},setStoppedEvent:function(b){a.notNull(b)&&(a.event.EventSource.stopEvents[b]=!0)},setTooltipStyle:function(b){if(a.notNull(b)){var c={border:{},text:{},padding:{}},m={titleStyle:{},headerStyle:{},contentStyle:{}};a.notNull(b.titleStyle)&&(m.titleStyle=
b.titleStyle,m.titleStyle.hAlign="LEFT"==b.titleStyle.hAlign?0:"CENTER"==b.titleStyle.hAlign?.5:1);a.notNull(b.headerStyle)&&(m.headerStyle=b.headerStyle,m.headerStyle.hAlign="LEFT"==b.headerStyle.hAlign?0:"CENTER"==b.headerStyle.hAlign?.5:1);a.notNull(b.contentStyle)&&(m.contentStyle=b.contentStyle,m.contentStyle.hAlign="LEFT"==b.contentStyle.hAlign?0:"CENTER"==b.contentStyle.hAlign?.5:1);a.notNull(b.opacity)&&(c.opacity=b.opacity);a.notNull(b.background)&&(c.background=b.background);a.notNull(b.padding)&&
(c.padding=b.padding);a.notNull(b.borderColor)&&(c.border.stroke=b.borderColor);a.notNull(b.textColor)&&(c.text.fill=b.textColor);a.notNull(b.rx)&&(c.border.rx=b.rx);a.notNull(b.ry)&&(c.border.ry=b.ry);a.notNull(b.fontSize)&&(c.text.fontSize=b.textSize);a.notNull(b.fontWeight)&&(c.text.fontWeight=b.fontWeight);a.notNull(b.strokeThickness)&&(c.border.strokeThickness=b.strokeThickness);a.notNull(b.shadow)?c.shadow=b.shadow:c.shadow=null;this.graphics.setTooltipStyle(c);this.graphics.storeCustomTooltipTextStyle(m)}},
appendUTFGridLayerHTML:function(b){a.isNull(this.utfgridHTMLArray)?a.util.Logger.warning("MAPVIEWER_9103","OM.Map.appendUTFGridLayerHTML"):this.utfgridHTMLArray.push(b)},enableMultiLayerInfoWindow:function(a){this.showAllVecFeatureInfo=a?!0:!1},setVectorLayerInfoWindowTrigger:function(b){this.vectorlayerInfoWindowMouseEType=b===a.event.MouseEvent.MOUSE_OVER||b===a.event.MouseEvent.MOUSE_MOVE?a.event.MouseEvent.MOUSE_MOVE:a.event.MouseEvent.MOUSE_CLICK},cleanupVctLyrSelections:function(b){for(var c,
m=0;m<this.svgLayers.length;m++)c=this.svgLayers[m],!0!==a.event.EventSource.isProcessedEvent(c,b)?c.deselectFeatures():a.event.EventSource.resetProcessedEvent(c,b)},handleTouchEnd:a.util.MiscUtil.oddNumberClick(function(b){var c=new a.event.MapEvent(a.event.MouseEvent.MOUSE_CLICK,b);b.fire(c.type,c);b.handleInfoWindow();b.cleanupVctLyrSelections(a.event.MouseEvent.MOUSE_CLICK)}),handleMouseClick:a.util.MiscUtil.oddNumberClick(function(b,c){var m;3==b.which?(m=new a.event.MapEvent(a.event.MouseEvent.MOUSE_RIGHT_CLICK,
c),c.fire(m.type,m)):(m=new a.event.MapEvent(a.event.MouseEvent.MOUSE_CLICK,c),c.fire(m.type,m),c.handleInfoWindow(),c.cleanupVctLyrSelections(a.event.MouseEvent.MOUSE_CLICK))}),isVecLayerCustomInfoWindowDisplayed:function(b){if(a.isNull(b)||1>b.length)return!1;var c,m;c=0;for(m=b.length;c<m;c+=1)if(b[c]&&b[c].feature_layer&&!1===b[c].feature_layer.getEnableInfoWindow()){if(b[c].hasListener(a.event.MouseEvent.MOUSE_CLICK)&&this.infoLayer&&this.isCustomInfoWindow)return!0;var k=b[c].feature_layer;
if(k.hasListener(a.event.MouseEvent.MOUSE_CLICK)&&a.event.EventSource.isProcessedEvent(k,a.event.MouseEvent.MOUSE_CLICK)&&this.infoLayer&&this.isCustomInfoWindow)return!0}return!1},setMaskOutInfoWindow:function(a){this.maskOutInfoWindow=a},getMaskOutInfoWindow:function(){return this.maskOutInfoWindow},handleInfoWindow:function(){var b=!1;if(!0!==this.maskOutInfoWindow){if(this.vectorlayerInfoWindowMouseEType===a.event.MouseEvent.MOUSE_CLICK){var c=this.getVectorLayerHitFeatures(a.event.MouseEvent.MOUSE_CLICK);
if(this.isVecLayerCustomInfoWindowDisplayed(c)){a.util.Logger.finest("A custom infowindow is still open.");return}c&&0<c.length&&(b=this.displayVectorLayersInfoWindow(c))}!1===b&&this.closeInfoWindows();!0!==b&&this.utfgridMouseEType===a.event.MouseEvent.MOUSE_CLICK&&(this.fireUTFGridEvent(a.event.MouseEvent.MOUSE_CLICK),setTimeout(this.displayUTFGridInfoWindow(),10))}}});a.Map.setProxyPath=function(b){b&&0===b.indexOf("/")&&(a.gv.proxyPath=b)};a.Map.getProxyPath=function(){return a.gv.proxyPath};
a.Map.isTileLayer=function(b){return b===a.LayerTypes.TILE||b===a.LayerTypes.DYNAMIC_TILE||b===a.LayerTypes.WMTS_TILE||b===a.LayerTypes.EXTERNAL};a.Map.setErrorHandler=function(b){a.util.Logger.errorHandler=b};a.Map.setAPIKey=function(b,c){var m=a.util.HttpRequest.getDomain(c);a.gv.mvKeyMap[m]=b};a.Map.setLocale=function(b,c){var m;m=a.notNull(c)?b+"-"+c:b;a.gv.loadMessage(m)};a.Map.ZOOM_KEEP_MOUSE_POINT=1;a.Map.ZOOM_CENTER_ON_MOUSE=2;a.Map.ZOOM_KEEP_CENTER=3;a.server.ServerMapRequest=a.Class.extend({initialize:function(b){a.isNull(b)&&
(b="http://"+document.location.host+"/mapviewer");this.baseURL=b;this.basemap=this.bgcolor=this.transparent=this.antialiase=this.datasource=null;this.themesArray=[];this.stylesArray=[];this.enableUTFGrid=this.format=this.tileServerURL=this.isclienttilereq=this.height=this.width=null;this.grid_res=4;this.srid=this.maxY=this.maxX=this.minY=this.minX=null},setImageFormat:function(a){this.format=a},setImageWidth:function(a){this.width=a},setImageHeight:function(a){this.height=a},setBasemap:function(a){this.basemap=
a},setUTFGridResolution:function(a){this.grid_res=a},setClientTileRequest:function(a){this.isclienttilereq=a},setBBox:function(b,c,m,k,aa){this.minX=b;this.minY=c;this.maxX=m;this.maxY=k;this.srid=a.notNull(aa)?aa:8307},setEnableUTFGrid:function(a){this.enableUTFGrid=a},setMapServerURL:function(a){this.baseURL=a},validateTheme:function(b){if(a.notNull(this.themesArray)&&0<this.themesArray.length)for(var c=0,m=this.themesArray.length;c<m;c++)if(b.name===this.themesArray[c].name)return a.util.Logger.warning("MAPVIEWER_9085",
"OM.server.ServerMapRequest","Theme ["+b.name+"] already existed."),!1;return!0},validateStyle:function(b){if(a.notNull(this.stylesArray)&&0<this.stylesArray.length)for(var c=0,m=this.stylesArray.length;c<m;c++)if(b.styleName===this.stylesArray[c].styleName)return a.util.Logger.warning("MAPVIEWER_9086","OM.server.ServerMapRequest","Style ["+b.styleName+"] already existed."),!1;return!0},addTheme:function(b){a.notNull(b)&&"[object Object]"===Object.prototype.toString.call(b)?this.validateTheme(b)&&
this.themesArray.push(b):a.util.Logger.warning("MAPVIEWER_9087","OM.server.ServerMapRequest",b)},addThemes:function(b){if(a.notNull(b)&&"[object Array]"===Object.prototype.toString.call(b))for(var c=0,m=b.length;c<m;c++)this.addTheme(b[c]);else a.util.Logger.warning("MAPVIEWER_9088","OM.server.ServerMapRequest",b.stringify())},addStyle:function(b){a.notNull(b)&&"[object Object]"===Object.prototype.toString.call(b)?this.validateStyle(b)&&this.stylesArray.push(b):a.util.Logger.warning("MAPVIEWER_9089",
"OM.server.ServerMapRequest",b)},addStyles:function(b){if(a.notNull(b)&&"[object Array]"===Object.prototype.toString.call(b))for(var c=0,m=b.length;c<m;c++)this.addStyle(b[c]);else a.util.Logger.warning("MAPVIEWER_9088","OM.server.ServerMapRequest",b.stringify())},setProperties:function(a){for(var b in a)if(a.hasOwnProperty(b))if("datasource"===b||"dataSource"===b)this.datasource=a[b];else if("antialiase"===b||"antiAliase"===b)this.antialiase=a[b];else if("transparent"===b)this.transparent=a[b];else if("bgcolor"===
b||"bgColor"===b)this.bgcolor=a[b];else if("basemap"===b||"baseMap"===b)this.basemap=a[b];else if("width"===b||"imageWidth"===b)this.width=Number(a[b]);else if("height"===b||"imageHeight"===b)this.height=Number(a[b]);else if("utfgridresolution"===b||"UTFGridResolution"===b)this.greid_res=a[b];else if("enableutfgrid"===b||"enableUTFGrid"===b)this.enableUTFGrid=a[b];else if("isclienttilereq"===b||"isClientTileReq"===b)this.isclienttilereq=a[b];else if("applicationId"===b||"applicationID"===b)this.applicationID=
a[b];else if("tileserverurl"===b||"tileServerURL"===b)this.tileServerURL=a[b]},toXMLString_Themes:function(b){if(a.isNull(this.themesArray)||1>this.themesArray.length)return"";for(var c="\x3cthemes\x3e",m=0,k=this.themesArray.length;m<k;m++){var aa=this.themesArray[m];a.notNull(aa)&&(c=aa.type===a.server.ServerTheme.TYPE_GEORASTER?c+aa.toXMLString(b):c+aa.toXMLString())}return c+"\x3c/themes\x3e"},toXMLString_Styles:function(){if(a.isNull(this.stylesArray)||1>this.stylesArray.length)return"";for(var b=
"\x3cstyles\x3e",c=0,m=this.stylesArray.length;c<m;c++)b+=this.stylesArray[c].toXMLString();return b+"\x3c/styles\x3e"},hasTheme:function(b){"string"!==typeof b&&a.util.Logger.warning("MAPVIEWER_9090","OM.server.ServerMapRequest",b);if(a.isNull(this.themesArray))return!1;for(var c=0,m=this.themesArray.length;c<m;c++)if(this.themesArray[c].name.toLowerCase()===b.toLowerCase())return!0},getTheme:function(b){for(var c=0,m=this.themesArray.length;c<m;c++)if(b===this.themesArray[c].name)return this.themesArray[c];
a.util.Logger.warning("MAPVIEWER_9091","OM.server.ServerMapRequest","Theme ["+b+"] not found.");return null},getThemes:function(){return this.themesArray},setBindingParameters:function(b){for(var c=null,m=0,k=b.length;m<k;m++){var c=b[m],aa;for(aa in c){var u=this.getTheme(aa.trim());a.notNull(u)&&u.setBindingParameters(c[aa.trim()])}}},clone:function(){var b={};a.$.extend(b,this);return b},getServerURL:function(){return!0===this.isclienttilereq||"true"===this.isclienttilereq?a.notNull(this.tileServerURL)?
this.tileServerURL:this.baseURL+"/omserver":a.isNull(this.baseURL)?"http://"+document.location.host+"/mapviewer/omserver":this.baseURL+"/omserver"},toXMLString:function(){var b=this.getServerURL(),c;c='\x3cmap_request width\x3d"'+(a.notNull(this.width)?this.width+'"':'"600"');c+=' height\x3d"'+(a.notNull(this.height)?this.height+'"':'"400"');c+=!0===this.isclienttilereq||"true"===this.isclienttilereq?' isclienttilereq\x3d"true"':"";c+=' format\x3d"'+(a.isNull(this.format)?'PNG_STREAM"':this.format+
'"');c+=a.isNull(this.datasource)?"":' datasource\x3d"'+this.datasource+'"';c+=a.isNull(this.bgcolor)?"":' bgcolor\x3d"'+encodeURIComponent(this.bgcolor)+'"';c+=a.isNull(this.basemap)?"":' basemap\x3d"'+this.basemap+'"';c+=a.isNull(this.transparent)?"":' transparent\x3d"'+this.transparent+'"';c+=a.isNull(this.antialiase)?"":' antialiase\x3d"'+this.antialiase+'"';c+=a.isNull(this.applicationID)?"":' applicationID\x3d"'+this.applicationID+'"';c=c+"\x3e"+('\x3cbox srsName\x3d"'+(a.isNull(this.srid)?
"SDO:8307":"SDO:"+this.srid+'"\x3e'));c+="\x3ccoordinates\x3e"+this.minX+","+this.minY+","+this.maxX+","+this.maxY+"\x3c/coordinates\x3e";c+="\x3c/box\x3e";var m=this.srid;a.isNull(m)&&(m=8307);var m=new a.geometry.Rectangle(this.minX,this.minY,this.maxX,this.maxY,m),m=this.toXMLString_Themes(m),k=this.toXMLString_Styles(),b=b+'?xml_request\x3d\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e'+c+encodeURIComponent(m)+encodeURIComponent(k);this.enableUTFGrid&&(c=' grid_id\x3d"'+a.util.MiscUtil.md5Hash(b)+
'" grid_res\x3d"'+this.grid_res+'"',m=b.indexOf("PNG_STREAM"),b=b.substring(0,m+11)+c+b.substring(m+11));return b+"\x3c/map_request\x3e"}});a.server.ServerFeature=a.Class.extend({initialize:function(a){this.name=a;this.dataSource=null},setDataSourceName:function(a){this.dataSource=a},getDataSourceName:function(){return this.dataSource},toXMLString:function(){return"\x3cfeature /\x3e"}});a.server.ServerTheme=a.Class.extend({initialize:function(a,b){this.name=a;this.type=b;this.dataSource=null},setDataSourceName:function(a){this.dataSource=
a},getDataSourceName:function(){return this.dataSource},setName:function(a){this.name=a}});a.server.ServerTheme.TYPE_JDBC="jdbc";a.server.ServerTheme.TYPE_PREDEFINED="predefined";a.server.ServerTheme.TYPE_GEORASTER="georaster";a.server.ServerTheme.TYPE_IMAGE="image";a.server.ServerTheme.TYPE_NETWORK="network";a.server.ServerTheme.TYPE_TOPOLOGY="topology";a.server.ServerTheme.TYPE_WFS="wfs";a.server.ServerTheme.TYPE_WMS="wms";a.server.ServerTheme.TYPE_WMTS="wmts";a.server.ServerTheme.TYPE_MAPCACHE=
"mapcache";a.server.ServerPredefinedTheme=a.server.ServerTheme.extend({initialize:function A(b){A.base.call(this,b,a.server.ServerTheme.TYPE_PREDEFINED);this.bindingParams=null},toXMLString:function(){var b=this.name;if(a.isNull(b))a.util.Logger.warning("MAPVIEWER_9092","OM.server.ServerPredefinedTheme");else{var c=this.bindingParams,b='\x3ctheme name\x3d"'+b.toUpperCase()+'"\x3e';if(a.notNull(c)){for(var k="",aa=0,u=c.length;aa<u;aa++){var C=c[aa],E=C.value,C=C.type;a.notNull(E)&&a.notNull(C)?k+=
'\x3cparameter value\x3d"'+E+'" type\x3d"'+C+'"/\x3e':a.util.Logger.warning("MAPVIEWER_9093","OM.server.ServerPredefinedTheme")}a.notNull(k)&&(k="\x3cbinding_parameters\x3e"+k+"\x3c/binding_parameters\x3e");b+=k}return b+"\x3c/theme\x3e"}},setBindingParameters:function(b){a.isNull(b)||0===b.length?a.util.Logger.warning("MAPVIEWER_9094","OM.server.ServerPredefinedTheme",b.stringify()):this.bindingParams=b}});a.server.ServerJDBCTheme=a.server.ServerTheme.extend({initialize:function m(b){m.base.call(this,
b,a.server.ServerTheme.TYPE_JDBC);this.sql=this.executeAsis=this.label_style=this.label_column=this.jdbc_srid=this.yColumn=this.xColumn=this.geomColumn=null;this.executeAsis=!1;this.geomColumn=null;this.infoColumns=[];a.util.Logger.warning("MAPVIEWER_9083","OM.server.ServerJDBCTheme.initialize")},addInfoColumn:function(a){this.infoColumns.push(a)},setQuery:function(a){this.sql=a},setExecuteAsis:function(a){this.executeAsis=!0===a||"true"===a},setXColumnName:function(a){this.xColumn=a},setYColumnName:function(a){this.yColumn=
a},setRenderingStyleName:function(a){this.renderingStyleName=a},setLabelColumnName:function(a){this.label_column=a},setLabelStyleName:function(a){this.label_style=a},setRenderingStyleValueColumns:function(a){this.renderingStyleValueColumns=a},setSRID:function(a){this.jdbc_srid=a},setGeometryColumnName:function(a){this.geomColumn=a},toXMLString_JDBC_Query:function(){var b;b="\x3cjdbc_query"+(a.notNull(this.dataSource)?' datasource\x3d"'+this.dataSource+'"':"");b+=a.notNull(this.geomColumn)?' spatial_column\x3d"'+
this.geomColumn+'"':"";b+=a.notNull(this.xColumn)?' x_column\x3d"'+this.xColumn+'"':"";b+=a.notNull(this.yColumn)?' y_column\x3d"'+this.yColumn+'"':"";b+=a.notNull(this.jdbc_srid)?' jdbc_srid\x3d"'+this.jdbc_srid+'"':"";b+=a.notNull(this.label_column)?' label_column\x3d"'+this.label_column+'"':"";b+=a.notNull(this.label_style)?' label_style\x3d"'+this.label_style+'"':"";b+=!0===this.executeAsis?' asis\x3d"true"':"";b=b+"\x3e"+(a.notNull(this.sql)?this.sql:"");var c="";if(0<this.infoColumns.length){for(var aa=
this.infoColumns,u=0,C=aa.length;u<C;u++)var E=aa[u],c=c+('\x3cfield column\x3d"'+E.column+'" name\x3d"'+E.name+'"/\x3e');c="\x3chidden_info\x3e"+c+"\x3c/hidden_info\x3e"}b+=c;return b+="\x3c/jdbc_query\x3e"},toXMLString_Rendering:function(){if(a.isNull(this.renderingStyleName))return"";var b;b="\x3crendering\x3e\x3cstyle "+('name\x3d"'+this.renderingStyleName+'"');a.notNull(this.renderingStyleValueColumns)&&(b+=' value_columns\x3d"'+this.renderingStyleValueColumns+'"');return b+"/\x3e\x3c/rendering\x3e"},
toXMLString:function(){if(a.isNull(this.name))return a.util.Logger.warning("MAPVIEWER_9095","OM.server.ServerJDBCTheme"),"";var b=this.name,c=this.toXMLString_JDBC_Query(),aa=this.toXMLString_Rendering(),b='\x3ctheme name\x3d"'+b.toUpperCase()+'"\x3e';return b+(c+aa+"\x3c/theme\x3e")}});a.server.ServerJDBCGeorasterTheme=a.server.ServerTheme.extend({initialize:function k(b){k.base.call(this,b,a.server.ServerTheme.TYPE_GEORASTER);this.polygonMaskSRID=this.polygonMask=this.rasterBands=this.rasterPyramid=
this.rasterTable=this.rasterId=this.jdbc_srid=this.georColumn=this.baseTable=null;this.transparentNoData=!1;this.pmaskJoinGeorColumn=this.pmaskJoinColumn=this.pmaskQCondition=this.pmaskGeomColumn=this.pmaskTable=this.alphaBand=null;this.reprojMode="BILINEAR";this.filterReprojResult=!1;this.renderInterpolationHint="NEAREST_NEIGHBOR";this.sql=null;this.executeAsis=!1;this.bitmapMasks=this.imgOperationParameters=this.imgOperationNames=this.bindingParameters=null;this.isVirtualMosaic=!1;this.vmParams=
{tables:null,sql:null,colorBalance:"NONE",fillGap:!0,noData:!0,resampling:"BILINEAR",resamplingTolerance:.5,resolutionFilter:!0,minStretchValue:0,maxStretchValue:255,mean:1,standardDeviation:1,commonPointRule:"START",srid:8307}},setQuery:function(a){this.sql=a},setExecuteAsis:function(a){this.executeAsis=!0===a||"true"===a},setSRID:function(a){this.jdbc_srid=a},setBaseTable:function(a){this.baseTable=a},setGeorasterColumn:function(a){this.georColumn=a},setRasterId:function(a){this.rasterId=a},setRasterDataTable:function(a){this.rasterTable=
a},setRasterPyramid:function(a){this.rasterPyramid=a},setRasterBands:function(a){this.rasterBands=a},setAlphaBand:function(a){this.alphaBand=a},setPolygonMaskCoordinates:function(a){this.polygonMask=a},setPolygonMaskSRID:function(a){this.polygonMaskSRID=a},clearPolygonMaskTableParameters:function(){this.pmaskJoinGeorColumn=this.pmaskJoinColumn=this.pmaskQCondition=this.pmaskGeomColumn=this.pmaskTable=null},setPolygonMaskTableParameters:function(a,b,c,C,E){this.pmaskTable=a;this.pmaskGeomColumn=b;
this.pmaskQCondition=c;this.pmaskJoinColumn=C;this.pmaskJoinGeorColumn=E},setImageOperations:function(a,b){this.imgOperationNames=a;this.imgOperationParameters=b},setBindingParameters:function(b){a.isNull(b)||0===b.length?a.util.Logger.warning("MAPVIEWER_9094","OM.server.ServerJDBCGeorasterTheme",b.stringify()):this.bindingParameters=b},setAsVirtualMosaic:function(a){this.isVirtualMosaic=a},setVMapplyResolutionFilter:function(a){this.vmParams.resolutionFilter=a},setVMcolorBalance:function(a){this.vmParams.colorBalance=
a},setVMcommonPointRule:function(a){this.vmParams.commonPointRule=a},setVMfillGap:function(a){this.vmParams.fillGap=a},setVMincludeNODATA:function(a){this.vmParams.noData=a},setVMmaxStretchValue:function(a){this.vmParams.maxStretchValue=a},setVMmean:function(a){this.vmParams.mean=a},setVMminStretchValue:function(a){this.vmParams.minStretchValue=a},setVMresamplingMode:function(a){this.vmParams.resampling=a},setVMresamplingTolerance:function(a){this.vmParams.resamplingTolerance=a},setVMsql:function(a){this.vmParams.sql=
a},setVMsrid:function(a){this.vmParams.srid=a},setVMstandardDeviation:function(a){this.vmParams.standardDeviation=a},setVMtables:function(a){this.vmParams.tables=a},toXMLString_JDBC_Query:function(){var b;b="\x3cjdbc_georaster_query"+(a.notNull(this.dataSource)?' datasource\x3d"'+this.dataSource+'"':"");b+=a.notNull(this.baseTable)?' georaster_table\x3d"'+this.baseTable+'"':"";b+=a.notNull(this.georColumn)?' georaster_column\x3d"'+this.georColumn+'"':"";b+=a.notNull(this.jdbc_srid)?' jdbc_srid\x3d"'+
this.jdbc_srid+'"':"";b+=a.notNull(this.rasterId)?' raster_id\x3d"'+this.rasterId+'"':"";b+=a.notNull(this.rasterTable)?' raster_table\x3d"'+this.rasterTable+'"':"";b+=a.notNull(this.rasterPyramid)?' raster_pyramid\x3d"'+this.rasterPyramid+'"':"";b+=a.notNull(this.rasterBands)?' raster_bands\x3d"'+this.rasterBands+'"':"";b+=a.notNull(this.polygonMask)?' polygon_mask\x3d"'+this.polygonMask+'"':"";b+=a.notNull(this.polygonMaskSRID)?' polygon_mask_srid\x3d"'+this.polygonMaskSRID+'"':"";b+=a.notNull(this.pmaskTable)?
' polygon_mask_table\x3d"'+this.pmaskTable+'"':"";b+=a.notNull(this.pmaskGeomColumn)?' polygon_mask_geomcolumn\x3d"'+this.pmaskGeomColumn+'"':"";b+=a.notNull(this.pmaskQCondition)?' polygon_mask_condition\x3d"'+this.pmaskQCondition+'"':"";b+=a.notNull(this.pmaskJoinColumn)?' polygon_mask_joingeomcolumn\x3d"'+this.pmaskJoinColumn+'"':"";b+=a.notNull(this.pmaskJoinGeorColumn)?' polygon_mask_joingeorcolumn\x3d"'+this.pmaskJoinGeorColumn+'"':"";b+=!0===this.transparentNoData?' transparent_nodata\x3d"true"':
"";b+=a.notNull(this.alphaBand)?' alpha_band\x3d"'+this.alphaBand+'"':"";b+=a.notNull(this.reprojMode)&&"BILINEAR"!==this.reprojMode?' reproj_mode\x3d"'+this.reprojMode+'"':"";b+=!0===this.filterReprojResult?' filter_reproj\x3d"true"':"";b+=a.notNull(this.renderInterpolationHint)&&"NEAREST_NEIGHBOR"!==this.renderInterpolationHint?' render_interpolation_hint\x3d"'+this.renderInterpolationHint+'"':"";b+=!0===this.executeAsis?' asis\x3d"true"':"";b=b+"\x3e"+(a.notNull(this.sql)?this.sql:"");return b+=
"\x3c/jdbc_georaster_query\x3e"},toXMLString_Binding_Parameters:function(b){var c="",u=this.bindingParameters;if(a.notNull(u)){for(var C=0,E=u.length;C<E;C++){var P=u[C],W=P.value,P=P.type;a.notNull(W)&&a.notNull(P)?"tile_mbr"!==P.toLowerCase()?c+='\x3cparameter value\x3d"'+W+'" type\x3d"'+P+'"/\x3e':a.isNull(b)?c+='\x3cparameter value\x3d"'+W+'" type\x3d"'+P+'"/\x3e':(W="srid\x3d"+b.getSRID()+":coords\x3d"+b.getMinX()+","+b.getMinY()+","+b.getMaxX()+","+b.getMaxY(),c+='\x3cparameter value\x3d"'+
W+'" type\x3d"Rectangle"/\x3e'):a.util.Logger.warning("MAPVIEWER_9093","OM.server.ServerJDCGeorasterTheme")}a.notNull(c)&&0<c.length&&(c="\x3cbinding_parameters\x3e"+c+"\x3c/binding_parameters\x3e")}return c},toXMLString_Image_Operations:function(){var b="";if(a.notNull(this.imgOperationNames)&&0<this.imgOperationNames.length){for(var b=b+"\x3coperations\x3e",c=0;c<this.imgOperationNames.length;c++){var u=this.imgOperationNames[c],b=b+('\x3coperation name\x3d"'+u+'"\x3e');if(a.notNull(this.imgOperationParameters)&&
(u=this.imgOperationParameters[u],a.notNull(u)))for(var C=0;C<u.length;C++)b+='\x3cparameter name\x3d"'+u[C].name+'" value\x3d"'+u[C].value+'"/\x3e';b+="\x3c/operation\x3e"}b+="\x3c/operations\x3e"}return b},toXMLString_Virtual_Mosaic_Parameters:function(){var a="";if(this.isVirtualMosaic){a=a+"\x3cvirtual_mosaic"+(' srid\x3d"'+this.vmParams.srid+'"');this.vmParams.colorBalance&&"NONE"!==this.vmParams.colorBalance.toUpperCase()&&(a+=' color_balance\x3d"'+this.vmParams.colorBalance+'"',"LINEARSTRETCHING"===
this.vmParams.colorBalance.toUpperCase()?(a+=' min_stretch_value\x3d"'+this.vmParams.minStretchValue+'"',a+=' max_stretch_value\x3d"'+this.vmParams.maxStretchValue+'"'):"NORMALIZATION"===this.vmParams.colorBalance.toUpperCase()&&(a+=' mean\x3d"'+this.vmParams.mean+'"',a+=' standard_deviation\x3d"'+this.vmParams.standardDeviation+'"'));this.vmParams.commonPointRule&&"START"!==this.vmParams.commonPointRule.toUpperCase()&&(a+=' common_point_rule\x3d"'+this.vmParams.commonPointRule+'"');this.vmParams.fillGap||
(a+=' fill_gap\x3d"false"');this.vmParams.noData&&(a+=' nodata_cell\x3d"true"');this.vmParams.resolutionFilter||(a+=' resolution_filter\x3d"false"');this.vmParams.resampling&&"BILINEAR"!==this.vmParams.resampling.toUpperCase()&&(a+=' resampling_mode\x3d"'+this.vmParams.resampling+'"');.5!==this.vmParams.resamplingTolerance&&(a+=' resampling_tolerance\x3d"'+this.vmParams.resamplingTolerance+'"');a+="\x3e";if(null!==this.vmParams.sql)a+="\x3csql\x3e"+this.vmParams.sql+"\x3c/sql\x3e";else{for(var a=
a+"\x3ctables\x3e",b=0;b<this.vmParams.tables.length;b++)a+='\x3ctable name\x3d"'+this.vmParams.tables[b].name+'" georaster_column\x3d"'+this.vmParams.tables[b].georaster_column+'"',null!==this.vmParams.tables[b].query_condition&&"undefined"!==typeof this.vmParams.tables[b].query_condition&&(a+=' query_condition\x3d"'+this.vmParams.tables[b].query_condition+'"'),a+=" /\x3e";a+="\x3c/tables\x3e\n"}a+="\x3c/virtual_mosaic\x3e"}return a},toXMLString:function(b){if(a.isNull(this.name))return a.util.Logger.warning("MAPVIEWER_9095",
"OM.server.ServerJDBCGeorasterTheme"),"";var c=this.name,u=this.toXMLString_JDBC_Query(),C=this.toXMLString_Image_Operations();b=this.toXMLString_Binding_Parameters(b);var E=this.toXMLString_Virtual_Mosaic_Parameters(),c='\x3ctheme name\x3d"'+c.toUpperCase()+'"\x3e\n';return c+(u+C+b+E+"\x3c/theme\x3e")}});a.wmts.WMTSUtil=a.wmts.WMTSUtil||{};a.wmts.WMTSUtil.deriveSRID=function(b){if(a.isNull(b))console.log("warning");else{var c=b.replace(/urn:(.-)?ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$2:$4"),u=c.indexOf(":");
if(0>u)return-1;b=c.substring(0,u).toUpperCase();c=c.substring(u+1).toUpperCase();if("OGC"===b||"CRS"===b){if("84"===c||"CRS84"===c)return 8307}else if("EPSG"===b)return"3857"===c?3857:"4326"===c?8307:parseInt(c)}};a.wmts.WMTSUtil.findIndex=function(a,b){var c;return a.every(function(C,E){c=E;return!b(C,E,a)})?-1:c};a.wmts.WMTSUtil.find=function(b,c){if(a.isNull(b))return null;for(var u=b.length>>>0,C,E=0;E<u;E++)if(C=b[E],c(C,E,b))return C;return null};a.wmts.WMTSUtil.includes=function(a,b){return 0<=
a.indexOf(b)};a.wmts.WMTSUtil.linearFindNearest=function(a,b,c){var C=a.length;if(a[0]<=b)return 0;if(!(b<=a[C-1]))if(0<c)for(c=1;c<C;++c){if(a[c]<b)return c-1}else if(0>c)for(c=1;c<C;++c){if(a[c]<=b)return c}else for(c=1;c<C;++c){if(a[c]==b)return c;if(a[c]<b)return a[c-1]-b<b-a[c]?c-1:c}return C-1};a.wmts.WMTSUtil.isSorted=function(a,b,c){var C=b||ol.array.numberSafeCompareFunction;return a.every(function(b,P){if(0===P)return!0;var W=C(a[P-1],b);return!(0<W||c&&0===W)})};a.wmts.WMTSUtil.RequestEncoding=
{KVP:"KVP",REST:"REST"};a.wmts.WMTSUtil.readHref=function(a){return a.getAttributeNS("http://www.w3.org/1999/xlink","href")};a.wmts.WMTSUtil.boundingExtent=function(b){for(var c=[Infinity,Infinity,-Infinity,-Infinity],u=0,C=b.length;u<C;++u)a.wmts.WMTSUtil.extendCoordinate(c,b[u]);return c};a.wmts.WMTSUtil.extendCoordinate=function(a,b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[2]&&(a[2]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[3]&&(a[3]=b[1])};a.wmts.WMTSUtil.TileGrid=function(c){this.resolutions_=c.resolutions;
console.assert(a.wmts.WMTSUtil.isSorted(this.resolutions_,function(a,b){return b-a},!0),17);this.origin_=c.origin!==b?c.origin:null;this.origins_=null;c.origins!==b&&(this.origins_=c.origins,console.assert(this.origins_.length==this.resolutions_.length,20));var aa=c.extent;aa===b||this.origin_||this.origins_||(this.origin_=a.wmts.Extent.getTopLeft(aa));console.assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18);this.tileSizes_=null;c.tileSizes!==b&&(this.tileSizes_=c.tileSizes,console.assert(this.tileSizes_.length==
this.resolutions_.length,19));this.tileSize_=c.tileSize!==b?c.tileSize:this.tileSizes_?null:256;console.assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22);this.extent_=aa!==b?aa:null};a.wmts.WMTSUtil.optionsFromCapabilities=function(c,aa){console.assert(aa.layer,'config "layer" must not be null');var u=a.wmts.WMTSUtil.find(c.Contents.Layer,function(a,b,c){return a.Identifier==aa.layer});console.assert(u,"found a matching layer in Contents/Layer");console.assert(0<u.TileMatrixSetLink.length,
"layer has TileMatrixSetLink");var C=c.Contents.TileMatrixSet,E,P;E=1<u.TileMatrixSetLink.length?"projection"in aa?a.wmts.WMTSUtil.findIndex(u.TileMatrixSetLink,function(b,c,k){return a.wmts.WMTSUtil.find(C,function(a){return a.Identifier==b.TileMatrixSet}).SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")==aa.projection}):a.wmts.WMTSUtil.findIndex(u.TileMatrixSetLink,function(a,b,c){return a.TileMatrixSet==aa.matrixSet}):0;0>E&&(E=0);P=u.TileMatrixSetLink[E].TileMatrixSet;console.assert(P,
"TileMatrixSet must not be null");var W=u.Format[0];"format"in aa&&(W=aa.format);E=a.wmts.WMTSUtil.findIndex(u.Style,function(a,b,c){return"style"in aa?a.Title==aa.style:a.isDefault});0>E&&(E=0);E=u.Style[E].Identifier;var M={};"Dimension"in u&&u.Dimension.forEach(function(c,k,q){k=c.Identifier;q=c.Default;q!==b?console.assert(a.wmts.WMTSUtil.includes(c.Value,q),"default value contained in values"):q=c.Value[0];console.assert(q!==b,"value could be found");M[k]=q});var r=a.wmts.WMTSUtil.find(c.Contents.TileMatrixSet,
function(a,b,c){return a.Identifier==P});console.assert(r,"found matrixSet in Contents/TileMatrixSet");var q=a.wmts.WMTSUtil.deriveSRID(r.SupportedCRS),N=a.universe.Universe.getSpecs(q),Z=u.WGS84BoundingBox,ba=u.BoundingBox;a.isNull(Z)&&a.isNull(ba)&&(ba=a.notNull(N.bounds)?N.bounds.coordinates:null,ba=a.notNull(ba)?[ba[0],ba[1],ba[2],ba[3]]:null);console.assert(a.notNull(Z)||a.notNull(ba),"Data bounding box cannot be retrieved");var q=a.notNull(Z)?new a.geometry.Rectangle(Z[0],Z[1],Z[2],Z[3],8307):
new a.geometry.Rectangle(ba[0],ba[1],ba[2],ba[3],q),r=a.wmts.WMTSUtil.createFromCapabilitiesMatrixSet(r,q.getMBR()),Y=[],q=aa.requestEncoding,q=q!==b?q:"";console.assert(a.wmts.WMTSUtil.includes(["REST","RESTful","KVP",""],q),'requestEncoding (%s) is one of "REST", "RESTful", "KVP" or ""',q);if("OperationsMetadata"in c&&"GetTile"in c.OperationsMetadata){Z=c.OperationsMetadata.GetTile.DCP.HTTP.Get;console.assert(1<=Z.length);for(var ba=0,qa=Z.length;ba<qa;++ba){var la=a.wmts.WMTSUtil.find(Z[ba].Constraint,
function(a){return"GetEncoding"==a.name}).AllowedValues.Value;console.assert(1<=la.length);""===q&&(q=la[0]);if(q===a.wmts.WMTSUtil.RequestEncoding.KVP)a.wmts.WMTSUtil.includes(la,a.wmts.WMTSUtil.RequestEncoding.KVP)&&Y.push(Z[ba].href);else break}}0===Y.length&&(q=a.wmts.WMTSUtil.RequestEncoding.REST,u.ResourceURL.forEach(function(a){"tile"===a.resourceType&&(W=a.format,Y.push(a.template))}));console.assert(0<Y.length,"At least one URL found");return{urls:Y,layer:aa.layer,matrixSet:P,format:W,projection:N,
requestEncoding:q,tileGrid:r,style:E,dimensions:M}};a.wmts.WMTSUtil.readDecimal=function(b){b=a.util.XMLUtil.getAllTextContent(b,!1);return parseFloat(b)};a.wmts.WMTSUtil.readNonNegativeInteger=function(b){b=a.util.XMLUtil.getAllTextContent(b,!1);return parseInt(b)};a.wmts.WMTSUtil.readString=function(b){return a.util.XMLUtil.getAllTextContent(b,!1).trim()};a.wmts.WMTSUtil.createFromCapabilitiesMatrixSet=function(b,c){var u=[],C=[],E=[],P=[],W=[],M=a.wmts.WMTSUtil.deriveSRID(b.SupportedCRS),r=a.universe.Universe.getMPU(M);
b.TileMatrix.sort(function(a,b){return b.ScaleDenominator-a.ScaleDenominator});b.TileMatrix.forEach(function(a,b,c){C.push(a.Identifier);b=2.8E-4*a.ScaleDenominator/r;c=a.TileWidth;var k=a.TileHeight;E.push(a.TopLeftCorner);u.push(b);P.push(c===k?c:[c,k]);W.push([a.MatrixWidth,-a.MatrixHeight])});return{extent:c,origins:E,resolutions:u,matrixIds:C,tileSizes:P,sizes:W}};a.wmts.WMTSOws=a.wmts.OWSFormat||{};a.wmts.WMTSOws.NAMESPACE="http://www.opengis.net/ows/1.1";a.wmts.WMTSOws.readFromDocument=function(a){console.assert(a.nodeType==
Node.DOCUMENT_NODE,"doc.nodeType should be DOCUMENT");for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType==Node.ELEMENT_NODE)return this.readFromNode(a);return null};a.wmts.WMTSOws.readFromNode=function(b){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");return(b=a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.PARSERS_,b,[]))?b:null};a.wmts.WMTSOws.readAddress_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Address"==
b.localName,"localName should be Address");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.ADDRESS_PARSERS_,b,c)};a.wmts.WMTSOws.readAllowedValues_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("AllowedValues"==b.localName,"localName should be AllowedValues");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.ALLOWED_VALUES_PARSERS_,b,c)};a.wmts.WMTSOws.readConstraint_=function(c,aa){console.assert(c.nodeType==Node.ELEMENT_NODE,
"node.nodeType should be ELEMENT");console.assert("Constraint"==c.localName,"localName should be Constraint");var u=c.getAttribute("name");return u?a.util.XMLUtil.pushParseAndPop({name:u},a.wmts.WMTSOws.CONSTRAINT_PARSERS_,c,aa):b};a.wmts.WMTSOws.readContactInfo_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("ContactInfo"==b.localName,"localName should be ContactInfo");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.CONTACT_INFO_PARSERS_,
b,c)};a.wmts.WMTSOws.readDcp_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("DCP"==b.localName,"localName should be DCP");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.DCP_PARSERS_,b,c)};a.wmts.WMTSOws.readGet_=function(c,aa){console.assert(c.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Get"==c.localName,"localName should be Get");var u=a.wmts.WMTSUtil.readHref(c);return u?a.util.XMLUtil.pushParseAndPop({href:u},
a.wmts.WMTSOws.REQUEST_METHOD_PARSERS_,c,aa):b};a.wmts.WMTSOws.readHttp_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("HTTP"==b.localName,"localName should be HTTP");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.HTTP_PARSERS_,b,c)};a.wmts.WMTSOws.readOperation_=function(c,aa){console.assert(c.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Operation"==c.localName,"localName should be Operation");
var u=c.getAttribute("name"),C=a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.OPERATION_PARSERS_,c,aa);if(!C)return b;aa[aa.length-1][u]=C};a.wmts.WMTSOws.readOperationsMetadata_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("OperationsMetadata"==b.localName,"localName should be OperationsMetadata");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.OPERATIONS_METADATA_PARSERS_,b,c)};a.wmts.WMTSOws.readPhone_=function(b,c){console.assert(b.nodeType==
Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Phone"==b.localName,"localName should be Phone");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.PHONE_PARSERS_,b,c)};a.wmts.WMTSOws.readServiceIdentification_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("ServiceIdentification"==b.localName,"localName should be ServiceIdentification");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.SERVICE_IDENTIFICATION_PARSERS_,
b,c)};a.wmts.WMTSOws.readServiceContact_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("ServiceContact"==b.localName,"localName should be ServiceContact");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.SERVICE_CONTACT_PARSERS_,b,c)};a.wmts.WMTSOws.readServiceProvider_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("ServiceProvider"==b.localName,"localName should be ServiceProvider");
return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.SERVICE_PROVIDER_PARSERS_,b,c)};a.wmts.WMTSOws.readValue_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Value"==b.localName,"localName should be Value");return a.wmts.WMTSUtil.readString(b)};a.wmts.WMTSOws.PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{ServiceIdentification:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readServiceIdentification_),ServiceProvider:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readServiceProvider_),
OperationsMetadata:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readOperationsMetadata_)});a.wmts.WMTSOws.ADDRESS_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{DeliveryPoint:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),City:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),AdministrativeArea:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),PostalCode:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),
Country:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),ElectronicMailAddress:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)});a.wmts.WMTSOws.ALLOWED_VALUES_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Value:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSOws.readValue_)});a.wmts.WMTSOws.CONSTRAINT_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{AllowedValues:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readAllowedValues_)});
a.wmts.WMTSOws.CONTACT_INFO_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Phone:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readPhone_),Address:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readAddress_)});a.wmts.WMTSOws.DCP_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{HTTP:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readHttp_)});a.wmts.WMTSOws.HTTP_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Get:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSOws.readGet_),
Post:b});a.wmts.WMTSOws.OPERATION_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{DCP:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readDcp_)});a.wmts.WMTSOws.OPERATIONS_METADATA_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Operation:a.wmts.WMTSOws.readOperation_});a.wmts.WMTSOws.PHONE_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Voice:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),Facsimile:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)});
a.wmts.WMTSOws.REQUEST_METHOD_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Constraint:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSOws.readConstraint_)});a.wmts.WMTSOws.SERVICE_CONTACT_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{IndividualName:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),PositionName:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),ContactInfo:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readContactInfo_)});
a.wmts.WMTSOws.SERVICE_IDENTIFICATION_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Title:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),ServiceTypeVersion:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),ServiceType:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)});a.wmts.WMTSOws.SERVICE_PROVIDER_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{ProviderName:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),
ProviderSite:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readHref),ServiceContact:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readServiceContact_)});a.wmts.WMTSContents=a.wmts.WMTSContents||{};a.wmts.WMTSContents.NAMESPACE="http://www.opengis.net/wmts/1.0";a.wmts.WMTSContents.readFromDocument=function(a){console.assert(a.nodeType==Node.DOCUMENT_NODE,"doc.nodeType should be DOCUMENT");for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType==Node.ELEMENT_NODE)return this.readFromNode(a);
return null};a.wmts.WMTSContents.readFromNode=function(b){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Capabilities"==b.localName,"localName should be Capabilities");var c=b.getAttribute("version").trim(),u=a.wmts.WMTSOws.readFromNode(b);if(!u)return null;u.version=c;return(u=a.util.XMLUtil.pushParseAndPop(u,a.wmts.WMTSContents.PARSERS_,b,[]))?u:null};a.wmts.WMTSContents.readContents_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");
console.assert("Contents"==b.localName,"localName should be Contents");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.CONTENTS_PARSERS_,b,c)};a.wmts.WMTSContents.readLayer_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Layer"==b.localName,"localName should be Layer");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.LAYER_PARSERS_,b,c)};a.wmts.WMTSContents.readTileMatrixSet_=function(b,c){return a.util.XMLUtil.pushParseAndPop({},
a.wmts.WMTSContents.TMS_PARSERS_,b,c)};a.wmts.WMTSContents.readStyle_=function(c,aa){var u=a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.STYLE_PARSERS_,c,aa);if(!u)return b;var C="true"===c.getAttribute("isDefault");u.isDefault=C;return u};a.wmts.WMTSContents.readTileMatrixSetLink_=function(b,c){return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.TMS_LINKS_PARSERS_,b,c)};a.wmts.WMTSContents.readDimensions_=function(b,c){return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.DIMENSION_PARSERS_,
b,c)};a.wmts.WMTSContents.readResourceUrl_=function(a,b){var c=a.getAttribute("format"),C=a.getAttribute("template"),E=a.getAttribute("resourceType"),P={};c&&(P.format=c);C&&(P.template=C);E&&(P.resourceType=E);return P};a.wmts.WMTSContents.readWgs84BoundingBox_=function(c,aa){var u=a.util.XMLUtil.pushParseAndPop([],a.wmts.WMTSContents.WGS84_BBOX_READERS_,c,aa);return 2!=u.length?b:a.wmts.WMTSUtil.boundingExtent(u)};a.wmts.WMTSContents.readBoundingBox_=function(c,aa){var u=a.util.XMLUtil.pushParseAndPop([],
a.wmts.WMTSContents.BBOX_READERS_,c,aa);return 2!=u.length?b:a.wmts.WMTSUtil.boundingExtent(u)};a.wmts.WMTSContents.readLegendUrl_=function(b,c){var u={};u.format=b.getAttribute("format");u.href=a.notNull(a.wmts.WMTSContents.XLink)?a.wmts.WMTSContents.XLink.readHref(b):null;return u};a.wmts.WMTSContents.readCoordinates_=function(c,aa){var u=a.wmts.WMTSUtil.readString(c).split(" ");if(!u||2!=u.length)return b;var C=+u[0],u=+u[1];return isNaN(C)||isNaN(u)?b:[C,u]};a.wmts.WMTSContents.readTileMatrix_=
function(b,c){return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.TM_PARSERS_,b,c)};a.wmts.WMTSContents.PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{Contents:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSContents.readContents_)});a.wmts.WMTSContents.CONTENTS_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{Layer:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readLayer_),TileMatrixSet:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readTileMatrixSet_)});
a.wmts.WMTSContents.LAYER_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{Style:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readStyle_),Format:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSUtil.readString),TileMatrixSetLink:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readTileMatrixSetLink_),Dimension:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readDimensions_),ResourceURL:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readResourceUrl_)},
a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Title:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),Abstract:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),WGS84BoundingBox:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSContents.readWgs84BoundingBox_),BoundingBox:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSContents.readBoundingBox_),Identifier:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)}));a.wmts.WMTSContents.STYLE_PARSERS_=
a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{LegendURL:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readLegendUrl_)},a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Title:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),Identifier:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)}));a.wmts.WMTSContents.TMS_LINKS_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{TileMatrixSet:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)});
a.wmts.WMTSContents.DIMENSION_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{Default:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),Value:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSUtil.readString)},a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Identifier:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)}));a.wmts.WMTSContents.WGS84_BBOX_READERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{LowerCorner:a.util.XMLUtil.makeArrayPusher(a.wmts.WMTSContents.readCoordinates_),
UpperCorner:a.util.XMLUtil.makeArrayPusher(a.wmts.WMTSContents.readCoordinates_)});a.wmts.WMTSContents.BBOX_READERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{LowerCorner:a.util.XMLUtil.makeArrayPusher(a.wmts.WMTSContents.readCoordinates_),UpperCorner:a.util.XMLUtil.makeArrayPusher(a.wmts.WMTSContents.readCoordinates_)});a.wmts.WMTSContents.TMS_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{WellKnownScaleSet:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),
TileMatrix:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readTileMatrix_)},a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{SupportedCRS:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),Identifier:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)}));a.wmts.WMTSContents.TM_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{TopLeftCorner:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSContents.readCoordinates_),ScaleDenominator:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readDecimal),
TileWidth:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readNonNegativeInteger),TileHeight:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readNonNegativeInteger),MatrixWidth:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readNonNegativeInteger),MatrixHeight:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readNonNegativeInteger)},a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Identifier:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)}));
a.layer.Layer=a.Class.extend({mixin:a.event.EventSource,initialize:function(a){this.name=a;this.group=null;this.visible=!0;this.minVisibleLevel=0;this.maxVisibleLevel=100;this.minVisibleScale=0;this.maxVisibleScale=1E9;this.zIndex=this.parentMap=this.visibleBound=null;this.opacity=1;this.layerType=null;this.customType="";this.loaded=!1;this.serverURL=null;this.infoWindow=!0},init:function(){},initLayer:function(b){this.initCalled=!0;this.init(b);b=a.event.LayerEvent;var c=new b(b.LAYER_INITIALIZED,
this);this.parentMap&&(c.mapContext=this.parentMap.getMapContext(),this.fire(b.LAYER_INITIALIZED,c))},panEvent:function(a){this.pan(a.xOffset,a.yOffset)},refreshEvent:function(a){this.refresh(a,!0)},setCenterAndZoomlevel:function(){},recenter:function(){},pan:function(){},enableInfoWindow:function(a){this.infoWindow=a},getEnableInfoWindow:function(){return this.infoWindow},destroy:function(){this.parentMap=null;this.deleteAllListeners()},isVisible:function(b){if(this.real)return this.real.isVisible();
if(a.isNull(b)||isNaN(b))b=this.parentMap.getMapContext().getZoomLevel();return this.isInZoomLevelRange(b)?this.visible:!1},setVisible:function(b){if(!b||this.isInZoomLevelRange()){if(this.real)return this.real.setVisible(b);var c=a.event.LayerEvent,u=new c(c.LAYER_VISIBILITY_CHANGED,this),C=this.visible;this.visible!==b&&(this.visible=b,this.setVisibleImpl?this.setVisibleImpl():this.visible?(this.group&&this.parentMap&&this.parentMap.graphics&&this.parentMap.graphics.applyStyle(this.group,{display:!0}),
this.parentMap&&this.parentMap.displayed&&this.refresh(null,!1)):this.group&&this.parentMap&&this.parentMap.graphics&&this.parentMap.graphics.applyStyle(this.group,{display:!1}),u.newVisibility=b,u.oldVisibility=C,this.parentMap&&(u.mapContext=this.parentMap.getMapContext()),this.fire(c.LAYER_VISIBILITY_CHANGED,u))}},refresh:function(){if(this.real)return this.real.refresh();var b=0<arguments.length?arguments[0]:null;if(1<arguments.length&&arguments[1]){var c=a.event.LayerEvent,b=new c(c.BEFORE_REFRESH,
this);this.parentMap&&(b.mapContext=this.parentMap.getMapContext());this.fire(c.BEFORE_REFRESH,b)}},redraw:function(){if(this.real)return this.real.redraw(arguments);0<arguments.length&&this.refresh(arguments[0],!1)},setZoomLevelRange:function(a,b){if(this.real)return this.real.setZoomLevelRange(a,b);this.minVisibleLevel=a;this.maxVisibleLevel=b;this.displayed&&this.refresh(null,!1)},isInZoomLevelRange:function(b){if(a.isNull(this.parentMap)||a.isNull(this.parentMap.getMapContext()))return!1;if(a.isNull(b)||
isNaN(b))b=this.parentMap.getMapContext().getZoomLevel();return b>=this.minVisibleLevel&&b<=this.maxVisibleLevel},setVisibleBound:function(b){if(this.real)return this.real.setVisibleBound(b);!b instanceof a.geometry.Rectangle||(this.visibleBound=b,this.displayed&&(this.changeVisibleBound?this.changeVisibleBound():this.refresh()))},bringForward:function(){if(this.real)return this.real.bringForward();if(this.parentMap)return this.parentMap.bringForward(this)},sendBackward:function(){if(this.real)return this.real.sendBackward();
if(this.parentMap)return this.parentMap.sendBackward(this)},bringToTop:function(){if(this.real)return this.real.bringToTop();var a=!1;0<arguments.length&&(a=arguments[0]);if(this.parentMap)return this.parentMap.bringToTop(this,a)},sendToBottom:function(){if(this.real)return this.real.sendToBottom();if(this.parentMap)return this.parentMap.sendToBottom(this)},setZIndex:function(a){if(this.real)return this.real.setZIndex(a);if(this.parentMap)return this.parentMap.setLayerIndex(this,a)},getZIndex:function(){if(this.real)return this.real.getZIndex();
if(this.parentMap)return this.parentMap.getLayerCurrentIndex(this)},getName:function(){return this.name},setName:function(a){this.name=a},setOpacity:function(b){if(a.util.ValidationUtil.isNumber(b)){if(this.real)return this.real.setOpacity(b);1<b||0>b||(this.opacity=b,this.displayed&&this.changeOpacity&&this.changeOpacity())}},getOpacity:function(){return this.real?this.real.getOpacity():this.opacity},getLayerConfig:function(){},getDataSouce:function(){return this.dataSource},clone:function(b){var c=
{};a.$.extend(c,this);c.name=b?b:c.name+"_clone"+Math.round(1E3*Math.random());c.deleteAllListeners();this.layerType===a.LayerTypes.VECTOR&&this.renderingStyle&&this.renderingStyle.styleType&&"Area"===this.renderingStyle.styleType&&(this.renderingStyle.fill=null);return c},startNewTask:function(){var b=new a.util.Task(this.parentMap.progressService);b.start();return b}});a.layer.TileLayer=a.layer.Layer.extend({initialize:function aa(b,c){aa.base.call(this,b,c);if(c){this.dataSource=c.dataSource;this.tileLayer=
c.tileLayer;if(a.notNull(c.tileServerURL)&&(this.serverURL=c.tileServerURL,a.notNull(c.subdomains))){var E=[],P=this.serverURL;c.subdomains.forEach(function(a){E.push(P.replace("://","://"+a+"."))});this.serverArray=E;this.serverCounter=0}this.tileImagesURL=c.tileImagesURL;this.tileLayerConfig=c.tileLayerConfig;this.getTileURL=c.getTileURL;this.mapSource=this.dataSource+"."+this.tileLayer;(this.isLocalTileLayer=c.isLocalTileLayer)&&c.isInZXYOrder&&(this.isInZXYOrder=c.isInZXYOrder);!0===c.enableUTFGrid||
"true"===c.enableUTFGrid?(this.enableUTFGrid=!0,this.mouseETypeUTFGrid=c.infoWindowTrigger===a.event.MouseEvent.MOUSE_OVER||c.infoWindowTrigger===a.event.MouseEvent.MOUSE_MOVE?a.event.MouseEvent.MOUSE_MOVE:a.event.MouseEvent.MOUSE_CLICK,this.utfgridResolution=this.getUTFGridResolution(c.utfGridResolution),this.enableInfoWindow(!0)):(this.enableUTFGrid=!1,this.enableInfoWindow(!1));!1!==c.enableUTFGridInfoWindow&&"false"!==c.enableUTFGridInfoWindow||this.enableInfoWindow(!1)}this.layerType=a.notNull(this.layerType)?
this.layerType:a.LayerTypes.TILE;this.zIndex=0;this.initError=!1;this.TILING_FACTOR=20;this.UTFGRID_RESOLUTION=4;this.maxMeshY=this.meshLength=0;this.xFactors=[];this.yFactors=[];this.addListener(a.event.LayerEvent.TILE_IMG_LOADED,this.tileImgLoadedHandler);this.addListener(a.event.LayerEvent.TILE_IMG_LOAD_ERROR,this.tileImgLoadedHandler);this.initRequiredBinds=this.requiredBinds=this.tilesPercent=this.tilesImgLoaded=0;this.initTask=null},setCenterAndZoomlevel:function(b){var c=this.parentMap.getMapContext().getCenterPoint(),
C=b.preMapCenter;a.notNull(b.beforeZoomLevel)&&this.zoom(b.beforeZoomLevel,b.afterZoomLevel,C,c)},getLayerConfig:function(a,b){this.getTileLayerConfig(a,b)},getTileLayerConfig:function(b,c){null===this.initTask&&(this.initTask=new a.util.Task(this.parentMap.progressService),this.initTask.start());var C;if(!this.tileLayerConfig){C=this.dataSource+"."+this.tileLayer;var E=a.gv.CacheConfig[C];E&&(this.tileLayerConfig=E)}if(this.tileLayerConfig)if(E=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,
this),E.config=this.getEnabledConfig(this.tileLayerConfig),E.mapContext=this.parentMap.getMapContext(),this.initTask.update(.25),this.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,E),c)c(this.tileLayerConfig);else return this.tileLayerConfig;else{var P=this,E=this.parentMap,W;if(P.layerType===a.LayerTypes.WMTS_TILE)P.getTileLayerConfigFromWMTS(b,c);else if(this.isLocalTileLayer){var M=this.tileImagesURL+"/instance.json",P=this;W=function(){if(P.parentMap&&P.parentMap.graphics){P.initError=!0;a.util.Logger.alert("MAPVIEWER_9044",
"OM.layer.Tilelayer.getTileLayerConfig","["+M+"]");var b=a.event,c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,P);P.parentMap&&(c.mapContext=P.parentMap.getMapContext(),P.initTask.abort(),P.fire(b.LayerEvent.INIT_ERROR,c))}};a.util.HttpRequest.send(M,{},function(b){if(P.parentMap&&P.parentMap.graphics){try{b=JSON.parse(b)}catch(W){a.util.Logger.alert("MAPVIEWER_9044","OM.layer.Tilelayer.getTileLayerConfig","")}var M=b[0].coordSys,r=new a.layer.TileLayerConfig;r.bounds=new a.geometry.Rectangle(M.minX,
M.minY,M.maxX,M.maxY,M.srid);r.srid=M.srid;r.tileImageFormat=b[0].format;r.isTransparentImage=b[0].transparent;r.copyright=b[0].copyright;var M=b[0].zoomLevels,C=M.length;if(M&&0<C){r.tileImageWidth=M[0].tileImageWidth;r.tileImageHeight=M[0].tileImageHeight;r.zoomLevels=Array(C);for(var E=0;E<C;E++){var aa=M[E].tileWidth/r.tileImageWidth;r.zoomLevels[E]={resolution:aa,stretchRatio:M[E].tileHeight/r.tileImageHeight/aa,infotip:""}}}b[0].customTags&&(r.customTags=b[0].customTags);r.isXYZStorageScheme=
"true"===b[0].xyzStorageScheme||!0===b[0].xyzStorageScheme;r.isInZXYOrder="true"===b[0].inZXYOrder||!0===b[0].inZXYOrder;P.tileLayerConfig=r;b=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,P);b.config=P.getEnabledConfig(r);b.mapContext=P.parentMap.getMapContext();P.initTask.update(.25);P.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,b);c&&c(r)}},"text",W)}else{var r='\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e\x3cmap_cache_admin_request\x3e\x3cget_client_config map_cache_names\x3d"'+
C+'" format\x3d"JSON"'+(a.notNull(E.applicationID)?' applicationID\x3d"'+E.applicationID+'"':"")+"/\x3e\x3c/map_cache_admin_request\x3e",E=this.serverURL=this.getTileServerURL();W=function(){if(P.parentMap&&P.parentMap.graphics){P.initError=!0;a.util.Logger.alert("MAPVIEWER_9001","OM.layer.Tilelayer.getTileLayerConfig","["+C+"]");var b=a.event,c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,P);P.parentMap&&(c.mapContext=P.parentMap.getMapContext(),P.initTask.abort(),P.initTask=null,P.fire(b.LayerEvent.INIT_ERROR,
c))}};r={xml_request:r};if(0<=E.indexOf("elocation.oracle.com")||0<=E.indexOf("maps.oracle.com"))r.$enableXHR=!0;a.util.HttpRequest.send(E,r,function(b){if(P.parentMap&&P.parentMap.graphics)if(b&&b[0]){a.gv&&a.isNull(a.gv.defaultDataSource)&&(a.gv.defaultDataSource=P.dataSource);var M=b[0].coordSys,r=new a.layer.TileLayerConfig;r.bounds=new a.geometry.Rectangle(M.minX,M.minY,M.maxX,M.maxY,M.srid);r.srid=M.srid;r.tileImageFormat=b[0].format;r.isTransparentImage=b[0].transparent;r.copyright=b[0].copyright;
var M=b[0].zoomLevels,E=M.length;if(M&&0<E){r.tileImageWidth=M[0].tileImageWidth;r.tileImageHeight=M[0].tileImageHeight;r.zoomLevels=Array(E);!P.enableUTFGrid||!0!==b[0].utfgrid&&"true"!==b[0].utfgrid?P.enableUTFGrid=!1:P.getUTFGridResolution(b[0].utfGridResolution);for(var aa=0;aa<E;aa++){var qa=M[aa].tileWidth/r.tileImageWidth;r.zoomLevels[aa]={resolution:qa,stretchRatio:M[aa].tileHeight/r.tileImageHeight/qa,infotip:""}}}b[0].customTags&&(r.customTags=b[0].customTags);P.setTileLayerConfig(r);if(b[0].clientTileAccess){var la;
b=b[0].clientTileAccess;a.isNull(b.mapTypeList)&&a.notNull(b.map_type_values)&&(b.mapTypeList=b.map_type_values);b.lib_url&&b.key&&(b.lib_url=b.lib_url.replace("\x3d$$key$$","\x3d"+b.key));b.mapTypeVisible="false"==b.mapTypeVisible||"false"==b.map_type_visible?!1:!0;var oa;if("google"==b.type)oa={libURL:b.lib_url,mapTypeList:b.mapTypeList.replace(/MVGoogleTileLayer/g,"OM.layer.GoogleTileLayer"),mapTypeVisible:b.mapTypeVisible},b.appID&&(oa.appID=b.appID),b.key&&(oa.key=b.key),b.client&&(oa.clientID=
b.client),la=new a.layer.GoogleTileLayer(P.name,oa);else if("tomtom"==b.type)a.util.Logger.alert("MAPVIEWER_9201","OM.layer.Tilelayer.getTileLayerConfig","["+C+"]");else if("bing"==b.type||"bingV7"==b.type)oa={key:b.key,libURL:b.lib_url,mapTypeList:b.mapTypeList.replace(/MVBingTileLayer/g,"OM.layer.BingTileLayer"),mapTypeVisible:b.mapTypeVisible},b.appID&&(oa.appID=b.appID),la=new a.layer.BingTileLayer(P.name,oa);else if("mapviewer"==b.type){b.appID&&(oa.appID=b.appID);la=b.dataSource||"";oa=b.tile_layer_name;
M=b.tileServerURL;E=-1;a.notNull(oa)&&(E=oa.indexOf("."),0<E&&(la=oa.substring(0,E),oa=oa.substring(E+1)));E=M.length;E-=9;aa=M.indexOf("/mcserver",E);if(-1===aa||aa!==E)E=M.indexOf("/mcserver"),M=M.substring(0,E+9);E={};a.notNull(la)&&(E.dataSource=la);E.tileLayer=oa;E.tileServerURL=M;la=new a.layer.TileLayer(P.name,E)}else"here"==b.type?(oa={appID:b.appID,appCode:b.appCode,libURL:b.libURL,mapTypeList:b.mapTypeList.replace(/MVHereTileLayer/g,"OM.layer.HereTileLayer"),mapTypeVisible:b.mapTypeVisible},
la=new a.layer.HereTileLayer(P.name,oa)):"openstreetmap"==b.type?la=new a.layer.OSMTileLayer(P.name,oa):"locationbox"==b.type&&a.util.Logger.alert("MAPVIEWER_9201","OM.layer.Tilelayer.getTileLayerConfig","["+C+"]");b.default_map_type&&("OM.layer.GoogleTileLayer.TYPE_ROAD"==b.default_map_type&&la.setMapType(a.layer.GoogleTileLayer.TYPE_ROAD),"OM.layer.GoogleTileLayer.TYPE_SATELLITE"==b.default_map_type&&la.setMapType(a.layer.GoogleTileLayer.TYPE_SATELLITE),"OM.layer.GoogleTileLayer.TYPE_SHADED"==b.default_map_type&&
la.setMapType(a.layer.GoogleTileLayer.TYPE_SHADED),"OM.layer.BingTileLayer.TYPE_ROAD"==b.default_map_type&&la.setMapType(a.layer.BingTileLayer.TYPE_ROAD),"OM.layer.BingTileLayer.TYPE_SATELLITE"==b.default_map_type&&la.setMapType(a.layer.BingTileLayer.TYPE_SATELLITE),"OM.layer.BingTileLayer.TYPE_HYBRID"==b.default_map_type&&la.setMapType(a.layer.BingTileLayer.TYPE_HYBRID),"OM.layer.BingTileLayer.TYPE_SHADED"==b.default_map_type&&la.setMapType(a.layer.BingTileLayer.TYPE_SHADED),"OM.layer.NokiaTileLayer.TYPE_ROAD"==
b.default_map_type&&la.setMapType(a.layer.NokiaTileLayer.TYPE_ROAD),"OM.layer.NokiaTileLayer.TYPE_HYBRID"==b.default_map_type&&la.setMapType(a.layer.NokiaTileLayer.TYPE_HYBRID),"OM.layer.NokiaTileLayer.TYPE_TERRAIN"==b.default_map_type&&la.setMapType(a.layer.NokiaTileLayer.TYPE_TERRAIN));la.tileLayerConfig=r;oa=P.parentMap;oa.replaceLayer(P,la);P.real=la;b=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,la);b.config=la.getEnabledConfig(r);b.mapContext=oa.getMapContext();P.initTask.complete();
P.initTask=null;la.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,b)}else b=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,P),b.config=P.getEnabledConfig(r),b.mapContext=P.parentMap.getMapContext(),P.initTask.update(.25),P.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,b);c&&c(r)}else return W(),null},"json",function(b){if(P.parentMap&&P.parentMap.graphics){P.initError=!0;if(b&&b.responseText)try{var c=a.$(a.$.parseXML(b.responseText)).find("oms_error");0<c.length&&a.util.Logger.alert("MAPVIEWER_9009",
"OM.layer.Tilelayer.getTileLayerConfig",c.text())}catch(M){a.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig",b.responseText)}else a.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig","["+C+"]");b=a.event;c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,P);P.parentMap&&(c.mapContext=P.parentMap.getMapContext(),P.initTask.abort(),P.fire(b.LayerEvent.INIT_ERROR,c))}})}}},init:function(){null===this.initTask&&(this.initTask=this.startNewTask());var b=0,c=this.parentMap.getMapContext();
this.winWidth=c.getDeviceWidth();this.winHeight=c.getDeviceHeight();var C=c.getCenterPoint(),E=C.getX(),P=C.getY(),W=this.getRealZoomLevel(c.getZoomLevel());if(this.checkVisible(W)){this.tileImageWidth=this.tileLayerConfig.tileImageWidth;this.tileImageHeight=this.tileLayerConfig.tileImageHeight;this.bufferX=Math.ceil(this.tileImageWidth/2);this.bufferY=Math.ceil(this.tileImageHeight/2);this.tileNumX=Math.ceil((this.winWidth+2*this.bufferX)/this.tileImageWidth);this.centerMesh=null;this.centerMesh=
new a.layer.Mesh(this.tileLayerConfig,E,P,W);var M=this.tileLayerConfig.bounds;this.tileNumInCSBoun=Math.ceil((M.getMaxX()-M.getMinX())/this.centerMesh.mw);var W=this.tileLayerConfig.zoomLevels[W],r=W.resolution,q=W.resolution*W.stretchRatio;this.pixPerX=this.tileImageWidth/this.centerMesh.mw;this.pixPerY=this.tileImageHeight/this.centerMesh.mh;this.coverPixel=(this.centerMesh.mw*this.tileNumInCSBoun-(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX()))*this.pixPerX;this.parentMap.wraparound&&
(this.tileNumX=this.tileNumX+Math.ceil(this.tileNumX/this.tileNumInCSBoun*this.coverPixel/(this.tileImageWidth/2))+1);this.tileNumY=Math.ceil((this.winHeight+2*this.bufferY)/this.tileImageHeight);this.tileMinY=this.tileMinX=0;this.initTileArray();W=Math.floor(this.tileNumX/2);M=Math.floor(this.tileNumY/2);E=this.winWidth/2-(E-this.centerMesh.minX)/r;for(P=this.winHeight/2+(P-this.centerMesh.minY)/q-this.tileImageHeight;;){var N=E-W*this.tileImageWidth;if(0<N)W++;else if(r=P-M*this.tileImageHeight,
0<r)M++;else{var Z=E+(this.tileNumX-W)*this.tileImageWidth-this.winWidth;if(0>Z)W--;else if(q=P+(this.tileNumY-M)*this.tileImageHeight-this.winHeight,0>q)M--;else if(N=Z+N,r=q+r,N>this.tileImageWidth)W++;else if(N<-1*this.tileImageWidth)W--;else if(r>this.tileImageHeight)M++;else if(r<-1*this.tileImageHeight)M--;else break}}this.origLeft=E-W*this.tileImageWidth;this.origTop=P-M*this.tileImageHeight;this.divLeft=this.origLeft;this.divTop=this.origTop;C=c.getTransform().toScreenPoint(C.getX(),C.getY());
this.offsetX=C.x-c.getDeviceWidth()/2;this.offsetY=C.y-c.getDeviceHeight()/2;this.jqLayerDiv.css({left:this.divLeft,top:this.divTop});this.createImageNode(W,M,this.tileImageWidth,this.tileImageHeight,W*this.tileImageWidth,M*this.tileImageHeight);b++;this.centerMesh.moveMeshCode(-1,1);c=Math.max(W,this.tileNumX-W);C=Math.max(M,this.tileNumY-M);for(r=1;r<=Math.max(c,C);r++){E=W-r;for(P=M-r;E<=W+r;E++)0>E||E>=this.tileNumX||0>P||P>=this.tileNumY||(this.createImageNode(E,P,this.tileImageWidth,this.tileImageHeight,
E*this.tileImageWidth,P*this.tileImageHeight),b++),this.centerMesh.moveMeshCode(1,0);this.centerMesh.moveMeshCode(-(2*r+1),-1);E=W-r;for(P=M-r+1;P<=M+r-1;P++)0>E||E>=this.tileNumX||0>P||P>=this.tileNumY||(this.createImageNode(E,P,this.tileImageWidth,this.tileImageHeight,E*this.tileImageWidth,P*this.tileImageHeight),b++),this.centerMesh.moveMeshCode(0,-1);E=W-r;for(P=M+r;E<=W+r;E++)0>E||E>=this.tileNumX||0>P||P>=this.tileNumY||(this.createImageNode(E,P,this.tileImageWidth,this.tileImageHeight,E*this.tileImageWidth,
P*this.tileImageHeight),b++),this.centerMesh.moveMeshCode(1,0);this.centerMesh.moveMeshCode(-1,1);E=W+r;for(P=M+r-1;P>=M-r+1;P--)0>E||E>=this.tileNumX||0>P||P>=this.tileNumY||(this.createImageNode(E,P,this.tileImageWidth,this.tileImageHeight,E*this.tileImageWidth,P*this.tileImageHeight),b++),this.centerMesh.moveMeshCode(0,1);this.centerMesh.moveMeshCode(-(2*r+1),1)}this.centerMesh.moveMeshCode(r,-r);this.centerMesh.moveMeshCode(-W+Math.floor(this.tileNumX/2),M-Math.floor(this.tileNumY/2));this.zoomControl||
(this.zoomControl=new a.layer.TileZoomAnimation(this));this.zoomControl.tileInitialized();this.displayed=!0;if(!this.hasListener(this.mouseETypeUTFGrid))this.on(this.mouseETypeUTFGrid,this.getAndStoreUTFGridAttr);this.initRequiredBinds=b}else this.jqLayerDiv&&(this.visible=!1,this.jqLayerDiv.css("visibility","hidden")),b=a.event,W=new b.LayerEvent(b.LayerEvent.FINISH_LOAD,this),W.mapContext=this.parentMap.getMapContext(),null!==this.initTask&&(this.initTask.complete(),this.initTask=null),this.fire(b.LayerEvent.FINISH_LOAD,
W)},getAndStoreUTFGridAttr:function(){if(!a.isNull(this.isVisible())&&!1!==this.isVisible()){var b=this.getFeatureInfo(),c="";if(b&&!a.$.isEmptyObject(b))for(var C in b)if("string"===typeof C&&0<C.trim().length){var E=b[C];if(!a.isNull(E)){var c=c+("\x3ctr bgcolor\x3d'#bbbbbb'\x3e\x3ctd colspan\x3d'2' align\x3d'left'\x3e"+C+"\x3c/td\x3e\x3c/tr\x3e"),P;for(P in E)c+="\x3ctr bgcolor\x3d'#dddddd'\x3e\x3ctd align\x3d'right'\x3e"+P+"\x3c/td\x3e\x3ctd align\x3d'left'\x3e"+E[P]+"\x3c/td\x3e\x3c/tr\x3e"}}this.parentMap.appendUTFGridLayerHTML(c)}},
buildUTFGridReq:function(a){var b=a.indexOf("/omserver");if(-1==b)return null;var c=a.substring(0,b),b=a.indexOf(" grid_id\x3d")+9,E=a.indexOf(" grid_res");a=a.substring(b+1,E-1);return c+"/images/utfgrid/utfgrid"+a+".json"},getUpperLeftTileCode:function(a,b){var c=this.centerMesh.mX,E=this.centerMesh.mY,P=Math.max(a,this.tileNumX-a),W=Math.max(b,this.tileNumY-b),P=Math.max(P,W),c=c-Math.min(a,P),E=E+Math.min(b,P),P=[];P.push(c);P.push(E);return P},initTileArray:function(){this.clearLayer();this.jqLayerDiv=
a.$("\x3cdiv id \x3d'tilelayer_"+this.name+"'\x3e\x3c/div\x3e");this.jqLayerDiv.css({position:"absolute","z-index":this.getZIndex()-1});this.parentMap.$tileLayersDiv.append(this.jqLayerDiv);this.transImgURL=a.util.MiscUtil.transparentImgURL;var b,c,C;for(b=0;b<this.tileNumX;b++){C=[];for(c=0;c<this.tileNumY;c++)C.push(this.initTileNode());this.tileArray.push(C)}},initTileNode:function(b){var c=function(a){a.preventDefault();return!1},C=function(a){a.preventDefault()},E=a.util.DomUtil.createImageNode(this.transImgURL,
this.tileLayerConfig.isTransparentImage),E=a.$(E);a.browser.touchSupported?(E.bind("click",c),E.bind("focus",c)):(E.bind("mouseout",c),E.bind("mousedown",C));a.notNull(b)&&(a.$(E).css("top",a.$(b.node).css("top")),a.$(E).css("left",a.$(b.node).css("left")),a.$(E).css("position",a.$(b.node).css("position")),a.$(E).css("z-index",a.$(b.node).css("z-index")),a.$(E).css("opacity",a.$(b.node).css("opacity")));this.jqLayerDiv.append(E);b={};b.node=E;b.grid=null;b.gridsrc=null;return b},createImageNode:function(b,
c,C,E,P,W){0===b&&0===c&&this.transImgURL&&(this.leftNum=this.centerMesh.mX,this.topNum=this.centerMesh.mY);var M=this.meshImgPath(this.centerMesh.mX,this.centerMesh.mY),r=this.tileArray[b][c].node;a.isNull(r)&&(r=a.util.DomUtil.createImageNode(null,this.isTransparent),r=a.$(r),this.jqLayerDiv.append(r),this.tileArray[b][c].node=r);r.css({position:"absolute",left:P,top:W});a.browser.msie&&r.css({width:C,height:E});this.zoomControl&&this.zoomControl.zooming&&r.css("display","none");a.browser.mobileWebkit&&
!a.browser.android&&r.css("-webkit-transform","translate3d(0,0,0)");this.enableUTFGrid&&(C=this.isDynamicTileLayer?this.buildUTFGridReq(M):this.meshUTFGridPath(this.centerMesh.mX,this.centerMesh.mY),this.tileArray[b][c].gridsrc=C);this.bindAndLoadTile(this.tileArray[b][c]);a.util.DomUtil.setImageSrc(r,M,this.opacity);r[0].mx=this.centerMesh.mX;r[0].my=this.centerMesh.mY},fetchUTFGrid:function(b){a.isNull(b.gridsrc)?b.grid={}:a.$.ajax({dataType:"text",url:b.gridsrc,data:"",cache:!0,success:function(c){a.isNull(c)?
a.util.Logger.warning("MAPVIEWER_9065","OM.layer.TileLayer.fetchUTFGrid",b.gridsrc):b.grid=c}})},cloneGrid:function(b){var c;if(a.isNull(b)||"object"!=typeof b)return b;if(b instanceof Object){c={};for(var C in b)b.hasOwnProperty(C)&&(c[C]=this.cloneGrid(b[C]));return c}throw Error("Unable to copy utfgrid Object{grid:'', src:''}! Its type isn't supported.");},decodeCharVal:function(b){if(a.notNull(b))return b=b.charCodeAt(0),93<=b&&b--,35<=b&&b--,b-32},featureInfoToJSON:function(b,c,C){if(b.length!==
c.length&&b.length!==C.length)return a.util.Logger.warning("MAPVIEWER_9080","OM.layer.Tilelayer.featureInfoToJSON"),null;c={};for(var E=0;E<C.length;E++)C[E]&&(c[b[E]]=C[E]);return c},getFeatureInfo:function(){var b,c,C,E,P,W,M,r=[],q=[],N=[];b=this.parentMap.mLocX-this.divLeft;c=this.parentMap.mLocY-this.divTop;W=parseInt(b/this.tileImageWidth);P=parseInt(c/this.tileImageHeight);b-=W*this.tileImageWidth;c-=P*this.tileImageHeight;try{M=JSON.parse(this.tileArray[W][P].grid);if(a.isNull(M))return;var Z=
parseInt(M.resolution);C=parseInt(b/Z);E=parseInt(c/Z)}catch(ba){return}for(var Y in M)if("rows"!==Y&&"columns"!==Y&&"resolution"!==Y){r.push(Y);try{var qa=this.decodeCharVal(M[Y].grid[E][C]);if(a.notNull(qa)){q.push(qa);var la=M[Y].data[qa];a.isNull(la)?N.push(""):N.push(la)}}catch(oa){}}return this.featureInfoToJSON(r,q,N)},meshImgPath:function(b,c){if(this.parentMap.wraparound){if(0>c||c>=(this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh)return this.transImgURL;
if(0>b)for(;!(b=parseInt(Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw))+b,0<=b););else if(b>=(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw)for(;!(b-=parseInt(Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw)),b<(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw););}else if(0>b||b>=(this.tileLayerConfig.bounds.getMaxX()-
this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw||0>c||c>=(this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh)return this.transImgURL;if(this.visibleBound){var C=Math.floor((this.visibleBound.getMinX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw),E=Math.ceil((this.visibleBound.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw),P=Math.floor((this.visibleBound.getMinY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh),
W=Math.ceil((this.visibleBound.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh);if(b<C||b>=E||c<P||c>=W)return this.transImgURL}C=this.centerMesh.zoom;if(this.getTileURL){var E=this.tileLayerConfig.zoomLevels[C],W=this.tileLayerConfig.tileImageWidth*E.resolution,E=this.tileLayerConfig.tileImageHeight*E.resolution*E.stretchRatio,P=this.tileLayerConfig.bounds.getMinX()+b*W,W=P+W,M=this.tileLayerConfig.bounds.getMinY()+c*E,E=new a.geometry.Rectangle(P,M,W,M+E,this.tileLayerConfig.srid);
return(C=this.getTileURL(C,b,c,E))?C:this.transImgURL}P=E=null;if(this.isLocalTileLayer)return E=Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw)-1,this.maxMeshY=P=Math.ceil((this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh)-1,this.tileLayerConfig.isXYZStorageScheme?(P=this.tileImagesURL+"/"+C+"/",P=this.tileLayerConfig.isInZXYOrder?P+(b+"/"+(this.maxMeshY-c)+"."+this.tileLayerConfig.tileImageFormat):
P+(this.maxMeshY-c+"/"+b+"."+this.tileLayerConfig.tileImageFormat)):(E=Math.max(E,P),this.calcMeshCode(b,c,E),P=this.tileImagesURL+"/"+this.getMeshStr(C)+"."+this.tileLayerConfig.tileImageFormat),P;if(this.isDynamicTileLayer)return this.getDynamicTL_URL(b,c,C);if(this.isWMSTileLayer)return this.getWMSTL_URL(b,c,C);if(this.layerType===a.LayerTypes.WMTS_TILE)return this.getWMTS_URL(b,c,C);E=this.mapSource?this.mapSource.toUpperCase():this.dataSource.toUpperCase()+"."+this.tileLayer.toUpperCase();P=
this.serverURL;a.notNull(this.serverArray)&&(P=this.serverArray[this.serverCounter],this.serverCounter+=1,this.serverCounter%=this.serverArray.length);P=P+"?request\x3dgettile\x26format\x3d"+this.tileLayerConfig.tileImageFormat;P+="\x26zoomlevel\x3d"+C+"\x26mapcache\x3d"+E+"\x26mx\x3d"+b+"\x26my\x3d"+c;this.reloadNumber&&(P+="\x26reload\x3d"+this.reloadNumber);return P},meshUTFGridPath:function(b,c){var C=this.tileLayerConfig.bounds,E=C.getMinX(),P=C.getMaxX(),W=C.getMinY(),M=C.getMaxY();if(this.parentMap.wraparound){if(0>
c||c>=(M-W)/this.centerMesh.mh)return this.transUTFGridURL;if(0>b)for(;!(b=parseInt(Math.ceil((P-E)/this.centerMesh.mw))+b,0<=b););else if(b>=(P-E)/this.centerMesh.mw)for(;!(b-=parseInt(Math.ceil((P-E)/this.centerMesh.mw)),b<(P-E)/this.centerMesh.mw););}else if(0>b||b>=(P-E)/this.centerMesh.mw||0>c||c>=(M-W)/this.centerMesh.mh)return this.transUTFGridURL;if(this.visibleBound){var C=Math.floor((this.visibleBound.getMinX()-E)/this.centerMesh.mw),r=Math.ceil((this.visibleBound.getMaxX()-E)/this.centerMesh.mw),
q=Math.floor((this.visibleBound.getMinY()-W)/this.centerMesh.mh),N=Math.ceil((this.visibleBound.getMaxY()-W)/this.centerMesh.mh);if(b<C||b>=r||c<q||c>=N)return this.transUTFGridURL}C=this.centerMesh.zoom;if(this.getTileURL)return M=this.tileLayerConfig.zoomLevels[C],P=this.tileLayerConfig.tileImageWidth*M.resolution,E+=b*P,W+=c*this.tileLayerConfig.tileImageHeight*M.resolution*M.stretchRatio,W=new a.geometry.Rectangle(E,W,E+P,W+P,this.tileLayerConfig.srid),(W=this.getTileURL(C,b,c,W))?W:this.transUTFGridURL;
r=r=null;this.isLocalTileLayer?(E=Math.ceil((P-E)/this.centerMesh.mw)-1,this.maxMeshY=W=Math.ceil((M-W)/this.centerMesh.mh)-1,this.tileLayerConfig.isXYZStorageScheme?(r=this.tileImagesURL+"/"+C+"/",r=this.tileLayerConfig.isInZXYOrder?r+(b+"/"+(this.maxMeshY-c)+".json"):r+(this.maxMeshY-c+"/"+b+".json")):(W=Math.max(E,W),this.calcMeshCode(b,c,W),r=this.tileImagesURL+"/"+this.getMeshStr(C)+".json")):(r=this.mapSource?this.mapSource.toUpperCase():this.dataSource.toUpperCase()+"."+this.tileLayer.toUpperCase(),
W=this.serverURL,a.notNull(this.serverArray)&&(W=this.serverArray[this.serverCounter],this.serverCounter+=1,this.serverCounter%=this.serverArray.length),r=W+"?request\x3dgetutfgrid\x26format\x3djson"+("\x26zoomlevel\x3d"+C+"\x26mapcache\x3d"+r+"\x26mx\x3d"+b+"\x26my\x3d"+c),this.reloadNumber&&(r+="\x26reload\x3d"+this.reloadNumber));return r},bindAndLoadTile:function(b){null===this.initTask&&(this.initTask=this.startNewTask());var c=this,C=a.$(b.node);C.imgLoadFinished=!1;C.bind("load",function(){C.imgLoadFinished=
!0;C.unbind("load");C.css("display","");c.enableUTFGrid&&c.fetchUTFGrid(b);var E=new a.event.LayerEvent(a.event.LayerEvent.TILE_IMG_LOADED,c);c.fire(a.event.LayerEvent.TILE_IMG_LOADED,E)});C.bind("error",function(){C.unbind("error");C.imgLoadFinished=!0;var b=new a.event.LayerEvent(a.event.LayerEvent.TILE_IMG_LOAD_ERROR,c);c.fire(a.event.LayerEvent.TILE_IMG_LOAD_ERROR,b)})},getTileXOffset:function(a){a+=this.tileMinX;for(var b=0;;){var c=a-b*this.tileImageWidth;if(0<c)b++;else{var E=a+(this.tileNumX-
b)*this.tileImageWidth-this.winWidth;if(0>E)b--;else if(c=E+c,c>this.tileImageWidth)b++;else if(c<-1*this.tileImageWidth)b--;else return b}}},getTileYOffset:function(a){a+=this.tileMinY;for(var b=0;;){var c=a-b*this.tileImageHeight;if(0<c)b++;else{var E=a+(this.tileNumY-b)*this.tileImageHeight-this.winHeight;if(0>E)b--;else if(c=E+c,c>this.tileImageHeight)b++;else if(c<-1*this.tileImageHeight)b--;else return b}}},pan:function(){null===this.initTask&&(this.initTask=this.startNewTask());if(!a.isNull(this.parentMap)){var b=
this.getRealZoomLevel(this.parentMap.getMapContext().getZoomLevel());if(this.checkVisible(b)){var b=this.parentMap.getMapContext(),c=b.getCenterPoint(),b=b.getTransform().toScreenPoint(c.getX(),c.getY()),C=this.origLeft-b.x+this.winWidth/2+this.offsetX,E=this.origTop-b.y+this.winHeight/2+this.offsetY,b=this.getTileXOffset(C),c=this.getTileYOffset(E),P=this.tileMinY-c*this.tileImageHeight;this.divLeft=C+(this.tileMinX-b*this.tileImageWidth);this.divTop=E+P;this.jqLayerDiv.css({left:C,top:E});if(0!==
b||0!==c){var C=this.centerMesh.mX-Math.floor(this.tileNumX/2),E=this.centerMesh.mY+Math.floor(this.tileNumY/2),P=0,W,M,r,q,N,Z,ba,Y,qa=this.tileArray[0].length;if(0!==b)for(W=0;0<b?W<b:W>b;0<b?W++:W--)if(N=0<b?this.tileMinX-(W+1)*this.tileImageWidth:this.tileMinX+(this.tileNumX-W)*this.tileImageWidth,0<b?this.leftNum--:this.leftNum++,0<b){r=this.tileArray.pop();q=[];for(M=0;M<qa;M++)Z=r[M],q.push(this.initTileNode(Z));for(M=0;M<qa;M++){ba=q[M];a.util.DomUtil.setImageSrc(ba.node,null);if(0===c||0<
c&&M<q.length-c||0>c&&M>=-c)Y=C-W-1,r=E-M,Z=this.meshImgPath(Y,r),a.util.DomUtil.setImageSrc(ba.node,Z),ba.node[0].mx=Y,ba.node[0].my=r,this.enableUTFGrid&&(r=this.isDynamicTileLayer?this.buildUTFGridReq(Z):this.meshUTFGridPath(Y,r),ba.gridsrc=r),this.bindAndLoadTile(ba),P++;this.parentMap.wraparound?(Z=this.tileArray[0][M],r=Y,ba.node[0].style.left=0===r%this.tileNumInCSBoun?parseInt(Z.node[0].style.left)-this.tileImageWidth+this.coverPixel+"px":parseInt(Z.node[0].style.left)-this.tileImageWidth+
"px"):a.$(ba.node).css("left",N)}this.tileArray.unshift(q)}else{r=this.tileArray.shift();q=[];for(M=0;M<qa;M++)Z=r[M],q.push(this.initTileNode(Z));for(M=0;M<qa;M++){ba=q[M];a.util.DomUtil.setImageSrc(ba.node,null);if(0===c||0<c&&M<q.length-c||0>c&&M>=-c)Y=C+this.tileNumX-W,r=E-M,Z=this.meshImgPath(Y,r),a.util.DomUtil.setImageSrc(ba.node,Z),ba.node[0].mx=Y,ba.node[0].my=r,this.enableUTFGrid&&(r=this.isDynamicTileLayer?this.buildUTFGridReq(Z):this.meshUTFGridPath(Y,r),ba.gridsrc=r),this.bindAndLoadTile(ba),
P++;this.parentMap.wraparound?(Z=this.tileArray[this.tileArray.length-1][M],r=Y,ba.node[0].style.left=r%this.tileNumInCSBoun==this.tileNumInCSBoun-1||-1==r%this.tileNumInCSBoun?parseInt(Z.node[0].style.left)+this.tileImageWidth-this.coverPixel+"px":parseInt(Z.node[0].style.left)+this.tileImageWidth+"px"):a.$(ba.node).css("left",N)}this.tileArray.push(q)}if(0!==c)for(M=0;0<c?M<c:M>c;0<c?M++:M--)for(0<c?(qa=this.tileMinY-(M+1)*this.tileImageHeight,this.topNum++):(qa=this.tileMinY+(this.tileNumY-M)*
this.tileImageHeight,this.topNum--),W=0;W<this.tileArray.length;W++)q=this.tileArray[W],0<c?(Y=C-b+W,r=E+M+1,Z=q.pop(),Z=this.initTileNode(Z),N=Z.node,a.util.DomUtil.setImageSrc(N,null),q.unshift(Z),a.$(N).css("top",qa),Z=this.meshImgPath(Y,r),a.util.DomUtil.setImageSrc(N,Z),N[0].mx=Y,N[0].my=r,this.enableUTFGrid&&(r=this.isDynamicTileLayer?this.buildUTFGridReq(Z):this.meshUTFGridPath(Y,r),q[0].gridsrc=r),this.bindAndLoadTile(q[0])):(Y=C-b+W,r=E-this.tileNumY+M,Z=q.shift(),Z=this.initTileNode(Z),
N=Z.node,a.util.DomUtil.setImageSrc(N,null),q.push(Z),a.$(N).css("top",qa),Z=this.meshImgPath(Y,r),a.util.DomUtil.setImageSrc(N,Z),N[0].mx=Y,N[0].my=r,this.enableUTFGrid&&(r=this.isDynamicTileLayer?this.buildUTFGridReq(Z):this.meshUTFGridPath(Y,r),q[q.length-1].gridsrc=r),this.bindAndLoadTile(q[q.length-1])),P++;this.requiredBinds+=P;this.tileMinX=this.parentMap.wraparound?parseInt(this.tileArray[0][0].node[0].style.left):this.tileMinX-b*this.tileImageWidth;this.tileMinY-=c*this.tileImageHeight;this.centerMesh.moveMeshCode(-b,
c)}}else Y=a.event,b=new Y.MapEvent(Y.LayerEvent.FINISH_LOAD,this),b.mapContext=this.parentMap.getMapContext(),this.fire(Y.LayerEvent.FINISH_LOAD,b)}},refresh:function u(b,c){if(!a.isNull(this.parentMap)&&(a.isNull(c)&&(c=!0),u.base.call(this,b,c),this.reloadNumber=Math.round(1E10*Math.random()),this.parentMap&&(this.parentMap.getMapContext().getTransform(),this.clearLayer(),this.init()),c)){var P=new a.event.LayerEvent(a.event.LayerEvent.AFTER_REFRESH,this);this.parentMap&&(P.mapContext=this.parentMap.getMapContext());
this.fire(a.event.LayerEvent.AFTER_REFRESH,P)}},checkVisible:function(a){if(this.initError||!this.isVisible(a)||a>=this.tileLayerConfig.zoomLevels.length)return!1;if(this.parentMap.enableZoomLevels){for(var b=0;b<this.parentMap.enableZoomLevels.length;b++)if(this.parentMap.enableZoomLevels[b]==a)return!0;return!1}return!0},clearLayer:function(){this.jqLayerDiv&&this.zoomControl&&!this.zoomControl.zooming&&(this.jqLayerDiv.remove(),this.jqLayerDiv=null);this.tileArray=[]},changeOpacity:function(){for(var b=
this.tileArray.length,c=a.util.DomUtil.changeOpacity,E=0;E<b;E++)for(var P=this.tileArray[E].length,W=0;W<P;W++)c(this.tileArray[E][W].node,this.opacity)},zoom:function(b,c,E,P){b=this.getRealZoomLevel(b);c=this.getRealZoomLevel(c);this.checkVisible(b)?(this.zoomControl||(this.zoomControl=new a.layer.TileZoomAnimation(this)),this.checkVisible(c)?this.parentMap.tileLayerZoomAnimation?this.zoomControl.scaling?(this.init(),this.zoomControl.endScaling()):this.zoomControl.showTiles(b,c,E,P):(this.init(),
this.zoomControl.tileInitialized()):(this.clearLayer(),this.zoomControl.tileInitialized())):this.init()},getTileServerURL:function(){this.serverURL==this.parentMap.mapviewerURL&&(this.serverURL+="/mcserver");return this.serverURL},setVisibleImpl:function(){this.jqLayerDiv&&this.jqLayerDiv.css("visibility",this.visible?"visible":"hidden");this.visible&&this.init()},getCustomTags:function(){return this.tileLayerConfig&&this.tileLayerConfig.customTags?this.tileLayerConfig.customTags:{}},destroy:function C(){this.clearLayer();
this.zoomContorl&&this.zoomControl.destroy();this.zoomControl=this.initError=null;C.base.call(this)},getEnabledConfig:function(b){if(this.parentMap.enableZoomLevels){var c=new a.layer.TileLayerConfig;c.bounds=b.bounds;c.srid=b.srid;c.tileImageFormat=b.tileImageFormat;c.isTransparentImage=b.isTransparentImage;c.tileImageWidth=b.tileImageWidth;c.tileImageHeight=b.tileImageHeight;c.customTags=b.customTags;c.zoomLevels=[];for(var P=[],W=0;W<this.parentMap.enableZoomLevels.length;W++)if(!(b.zoomLevels.length<=
this.parentMap.enableZoomLevels[W]||0>this.parentMap.enableZoomLevels[W])){var M=b.zoomLevels[this.parentMap.enableZoomLevels[W]];M?(P.push(this.parentMap.enableZoomLevels[W]),c.zoomLevels.push(M)):a.util.Logger.warning("MAPVIEWER_9039","OM.layer.Tilelayer.setEnabledZoomLevels","["+this.parentMap.enableZoomLevels[W]+"]")}this.parentMap.enableZoomLevels=P;return c}return b},getRealZoomLevel:function(a){return this.parentMap.enableZoomLevels?(a>=this.parentMap.enableZoomLevels.length&&(a=this.parentMap.enableZoomLevels.length),
this.parentMap.enableZoomLevels[a]):a},exportToSVG:function(b){var c=parseInt(this.jqLayerDiv.css("left")),P=parseInt(this.jqLayerDiv.css("top")),W=this.parentMap.graphics;W.setLeftTop(b,c,P);var M=this;M.loadImg=0;this.jqLayerDiv.find("img").each(function(){var r=this.src,q=a.$(this);c=parseInt(q.css("left"));P=parseInt(q.css("top"));M.loadImg++;W.drawImage({x:c,y:P},{src:r,width:256,height:256},{group:b}).handleEvent=function(a){this.resourceUpdate(a);M.loadImg--}});return b},drawTilesImages:function(a,
b){var c=this.parentMap.getMapCenter(),c=this.serverURL+"?request\x3dgetmap\x26mapcache\x3d"+this.dataSource+"."+this.tileLayer+"\x26zoomlevel\x3d"+this.parentMap.getMapZoomLevel()+"\x26cx\x3d"+c.getX()+"\x26cy\x3d"+c.getY()+"\x26width\x3d"+a+"\x26height\x3d"+b;this.loadingImg=!0;var W=this,M=new Image;M.onload=function(){W.loadingImg=!1;W.canvas.getContext("2d").drawImage(M,0,0,a,b)};M.onerror=function(){W.loadingImg=!1;W.canvas=null};M.src=c},clone:function E(a){a=E.base.call(this,a);a.displayed&&
(a.jqLayerDiv=null,a.displayed=!1,a.zoomControl=null);return a},prepareDrag:function(){var a=this.jqLayerDiv[0];this.downLoc={l:a.offsetLeft,t:a.offsetTop}},calcMeshCode:function(a,b,c){c=Math.ceil(Math.log(c)/Math.log(this.TILING_FACTOR));this.meshLength=Math.max(1,c);this.xFactors.length=this.meshLength;this.yFactors.length=this.meshLength;this.factors(a,this.xFactors);this.factors(b,this.yFactors)},factors:function(a,b){for(var c=0;c<this.meshLength;c++){var M=a/this.TILING_FACTOR;b[this.meshLength-
1-c]=Math.floor(a%this.TILING_FACTOR);a=M}},getMeshStr:function(a){a="/"+a;for(var b=0;b<this.meshLength;b++)b<this.meshLength&&(a+="/"),a+=this.xFactors[b]+"_"+this.yFactors[b];return a},tileImgLoadedHandler:function(b){if(b instanceof a.event.LayerEvent&&(b.type===a.event.LayerEvent.TILE_IMG_LOADED||b.type===a.event.LayerEvent.TILE_IMG_LOAD_ERROR)){b=this.requiredBinds+this.initRequiredBinds;0===b&&(b=1);this.tilesImgLoaded++;this.tilesPercent=this.tilesImgLoaded/b*100;if(this.tilesImgLoaded>=b)b=
new a.event.LayerEvent(a.event.LayerEvent.ALL_TILES_LOADED,this),this.initRequiredBinds=this.requiredBinds=this.tilesImgLoaded=0,null!==this.initTask&&(this.initTask.complete(),this.initTask=null);else if(b=new a.event.LayerEvent(a.event.LayerEvent.TILE_IMG_LOADING,this),null!==this.initTask){var c=this.getTilesPercentStatus();0<c?this.initTask.update(c/100):this.initTask.update(.25)}this.lastEvent=b.type}},getTilesPercentStatus:function(){return this.tilesPercent},setEnableUTFGridInfoWindow:function(a){this.enableUTFGridInfoWindow(a)},
enableUTFGridInfoWindow:function(b){this.enableInfoWindow(b);this.parentMap&&a.notNull(this.isVisible())&&!0===this.isVisible()&&this.parentMap.updateUTFGridLayerCount()},setInfoWindowTrigger:function(b){this.mouseETypeUTFGrid=b===a.event.MouseEvent.MOUSE_OVER||b===a.event.MouseEvent.MOUSE_MOVE?a.event.MouseEvent.MOUSE_MOVE:a.event.MouseEvent.MOUSE_CLICK;this.parentMap.validateUTFGridLayerTriggers();this.parentMap.updateUTFGridLayerListener()},setVisible:function P(a){P.base.call(this,a);this.parentMap&&
(this.parentMap.changeOverView(),this.parentMap.updateUTFGridLayerCount())},getUTFGridResolution:function(b){var c;if(a.isNull(b))return this.UTFGRID_RESOLUTION;try{return c=parseInt(b),a.isNull(c)||1>c?this.UTFGRID_RESOLUTION:c}catch(M){return this.UTFGRID_RESOLUTION}},setTileLayerConfig:function(a){this.tileLayerConfig=a},getTileLayerConfigFromWMTS:function(b,c){var M=this;a.util.HttpRequest.send(this.getCapabilitiesURL,"request\x3dwmts\x26service\x3dgetCapabilites",function(b){if(M.parentMap&&
M.parentMap.graphics)if(b){b=a.wmts.WMTSContents.readFromDocument(b);b=a.wmts.WMTSUtil.optionsFromCapabilities(b,{layer:M.layerID,matrixSet:M.matrixSetID});b=M.buildConfig(b);M.setTileLayerConfig(b);var q=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,M);q.config=b;q.mapContext=M.parentMap.getMapContext();M.initTask.update(.25);M.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,q);c&&c(b)}else return M.parentMap&&M.parentMap.graphics&&(M.initError=!0,a.util.Logger.alert("MAPVIEWER_9001","OM.layer.Tilelayer.getTileLayerConfigFromWMTS",
"["+M.name+"]"),b=a.event,q=new b.LayerEvent(b.LayerEvent.INIT_ERROR,M),M.parentMap&&(q.mapContext=M.parentMap.getMapContext(),M.initTask.abort(),M.initTask=null,M.fire(b.LayerEvent.INIT_ERROR,q))),null},"XML",function(b){if(M.parentMap&&M.parentMap.graphics){M.initError=!0;if(b&&b.responseText)try{var c=a.$(a.$.parseXML(b.responseText)).find("oms_error");0<c.length&&a.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig",c.text())}catch(W){a.util.Logger.alert("MAPVIEWER_9009",
"OM.layer.Tilelayer.getTileLayerConfig",b.responseText)}else a.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig","["+M.name+"]");b=a.event;c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,M);M.parentMap&&(c.mapContext=M.parentMap.getMapContext(),M.initTask.abort(),M.fire(b.LayerEvent.INIT_ERROR,c))}})}});a.layer.TileLayerConfig=function(a){this.tileImageHeight=this.tileImageWidth=256;this.tileImageFormat="PNG";this.enableUTFGrid=this.isInZXYOrder=this.isXYZStorageScheme=this.isTransparentImage=
!1;this.utfgridResolution=4;a&&(this.srid=a.srid,this.zoomLevels=a.zoomLevels,this.bounds=a.bounds,a.tileImageWidth&&(this.tileImageWidth=a.tileImageWidth),a.tileImageHeight&&(this.tileImageHeight=a.tileImageHeight),a.tileImageFormat&&(this.tileImageFormat=a.tileImageFormat),a.isTransparentImage&&(this.isTransparentImage=a.isTransparentImage),a.customTags&&(this.customTags=a.customTags),a.isXYZStorageScheme&&(this.isXYZStorageScheme=a.isXYZStorageScheme,a.isInZXYOrder&&(this.isInZXYOrder=a.isInZXYOrder)),
a.enableUTFGrid&&(this.enableUTFGrid=!0,this.utfgridResolution=a.utfgridResolution))};a.layer.TileLayerConfig.prototype.equals=function(a){if(this.srid!=a.srid||this.zoomLevels&&a.zoomLevels&&this.zoomLevels.length!=a.zoomLevels.length)return!1;for(var b=this.zoomLevels.length,c=0;c<b;c++)if(this.zoomLevels[c].resolution!=a.zoomLevels[c].resolution||this.zoomLevels[c].stretchRatio!=a.zoomLevels[c].stretchRatio)return!1;return!0};a.layer.TileLayerConfig.CONFIG_ELOCATION=new a.layer.TileLayerConfig;
a.layer.TileLayerConfig.CONFIG_S_ELOCATION=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_GOOGLE=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_TOMTOM=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_LOCATIONBOX=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_WGS84_WORLD=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_OSM=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_BAIDU=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.setConstants=
function(){var b=a.layer.TileLayerConfig,c=new a.universe.WorldMercatorUniverse;b.CONFIG_ELOCATION.zoomLevels=c.getZoomLevels();b.CONFIG_ELOCATION.srid=c.getSRID();b.CONFIG_ELOCATION.bounds=c.getMapBounds();b.CONFIG_ELOCATION.tileImageFormat="PNG";b.CONFIG_ELOCATION.isTransparentImage=!1;c=new a.universe.WorldMercatorUniverse;b.CONFIG_S_ELOCATION.zoomLevels=c.getZoomLevels();b.CONFIG_S_ELOCATION.srid=c.getSRID();b.CONFIG_S_ELOCATION.bounds=c.getMapBounds();b.CONFIG_S_ELOCATION.tileImageFormat="PNG";
b.CONFIG_S_ELOCATION.isTransparentImage=!1;c=new a.universe.WorldMercatorUniverse;b.CONFIG_GOOGLE.zoomLevels=c.getZoomLevels();b.CONFIG_GOOGLE.srid=c.getSRID();b.CONFIG_GOOGLE.bounds=c.getMapBounds();c=new a.universe.BaiduUniverse;b.CONFIG_BAIDU.zoomLevels=c.getZoomLevels();b.CONFIG_BAIDU.srid=c.getSRID();b.CONFIG_BAIDU.bounds=c.getMapBounds();a.notNull(a.universe.TomTomUniverse)&&(c=new a.universe.TomTomUniverse,b.CONFIG_TOMTOM.zoomLevels=c.getZoomLevels(),b.CONFIG_TOMTOM.srid=c.getSRID(),b.CONFIG_TOMTOM.bounds=
c.getMapBounds());a.notNull(a.universe.LocationBoxUniverse)&&(c=new a.universe.LocationBoxUniverse,b.CONFIG_LOCATIONBOX.zoomLevels=c.getZoomLevels(),b.CONFIG_LOCATIONBOX.srid=c.getSRID(),b.CONFIG_LOCATIONBOX.bounds=c.getMapBounds());c=new a.universe.LatLonUniverse;b.CONFIG_WGS84_WORLD.zoomLevels=c.getZoomLevels();b.CONFIG_WGS84_WORLD.srid=c.getSRID();b.CONFIG_WGS84_WORLD.bounds=c.getMapBounds();c=new a.universe.OSMUniverse;b.CONFIG_OSM.zoomLevels=c.getZoomLevels();b.CONFIG_OSM.srid=c.getSRID();b.CONFIG_OSM.bounds=
c.getMapBounds()};a.layer.TileLayerConfig.setConstants();a.layer.TileZoomAnimation=a.Class.extend({initialize:function(b){this.tdiff=this.ldiff=0;this.tileLayer=b;this.aniDiv=this.tileArray=null;this.zooming=!1;this.timeouts=[];this.imageWidth=b.tileLayerConfig.tileImageWidth;this.imageHeight=b.tileLayerConfig.tileImageHeight;this.animate=!a.browser.msie||"transition"in document.documentElement.style?!0:!1},computeTilesOffset:function(){var b=this.tileLayer.jqLayerDiv;b&&(b=a.util.DomUtil.getElementPos(b),
this.ldiff=-b.left,this.tdiff=-b.top)},getScreenXY:function(a,b,c){var r=this.tileLayer.tileLayerConfig.zoomLevels[c];c=1/r.resolution;var r=c/r.stretchRatio,q=this.newCenter;return{x:(a-q.getX())*c,y:(q.getY()-b)*r}},copyTiles:function(a){if(this.aniDiv&&this.aniDiv.parent())return!1;this.oldLevel=a;this.aniDiv=this.tileLayer.jqLayerDiv;this.tileArray=this.tileLayer.tileArray;this.aniDiv.css("zIndex",this.tileLayer.zIndex+1);return!0},transformTiles:function(b,c){var M=this.getScreenXY(this.oldCenter.getX(),
this.oldCenter.getY(),b),r=this.getScreenXY(this.newCenter.getX(),this.newCenter.getY(),b),q=this.tileLayer.tileLayerConfig,N=q.zoomLevels[b],Z=q.zoomLevels[c],ba=q.bounds,q=this.getLeftTopTile(),Y=q.x*this.imageWidth*N.resolution+ba.getMinX(),qa=(q.y+1)*this.imageHeight*N.resolution*N.stretchRatio+ba.getMinY(),ba=this.getScreenXY(Y,qa,b),Y=this.getScreenXY(Y,qa,c),N=N.resolution/Z.resolution,M="translate3d("+(-1*(r.x-M.x+ba.x-Y.x)-q.l*(N-1))+"px,"+(-1*(r.y-M.y+ba.y-Y.y)-q.t*(N-1))+"px, 0px) scale("+
N+")",la=this;a.browser.webkit3d?(this.aniDiv.css("-webkit-transition","-webkit-transform 0.25s cubic-bezier(0,0,0.5,1)"),this.aniDiv.bind("webkitTransitionEnd",function(){la.zooming=!1}),this.aniDiv.css("-webkit-transform",M)):(this.aniDiv.css("transition","transform 0.25s cubic-bezier(0,0,0.5,1)"),this.aniDiv.bind("transitionend",function(){la.zooming=!1}),this.aniDiv.css("transform",M));this.zooming=!0},getLeftTopTile:function(){var a=this.tileArray,a=a[0][0].node[0].src!==this.tileLayer.transImgURL?
a[0][0].node:a[1][0].node[0].src!==this.tileLayer.transImgURL?a[1][0].node:a[0][1].node[0].src!==this.tileLayer.transImgURL?a[0][1].node:a[1][1].node,b=a.position();return{x:a[0].mx,y:a[0].my,l:b.left,t:b.top}},showTiles:function(b,c,M,r){if(!this.tileLayer.isVisible()||a.isNull(this.tileLayer.tileArray)||this.tileLayer.tileLayerConfig.isTransparentImage)this.reset();else{var q=new a.util.Task(this.tileLayer.parentMap.progressService);q.start();this.newCenter=r;this.oldCenter=M;this.animate?(q.update(.2),
this.computeTilesOffset(),q.update(.35),this.copyTiles(b),q.update(.5),this.transformTiles(this.oldLevel,c),this.tileLayer.init(),this.tileLayer.jqLayerDiv.css("visibility","hidden")):(this.tileLayer.jqLayerDiv.css("visibility","hidden"),this.tileLayer.init());q.update(.7);q.complete()}},reset:function(){this.tdiff=this.ldiff=0;this.aniDiv&&this.aniDiv.parent()&&this.aniDiv.remove();this.aniDiv=this.tileArray=null;this.zooming=!1;for(var a=0;a<this.timeouts.length;a++)clearTimeout(this.timeouts[a]);
this.timeouts=[];this.tileLayer.isVisible()&&this.tileLayer.init()},tileInitialized:function(){if(this.tileLayer&&this.tileLayer.parentMap)if(!this.hasTilesLoadFinished()&&!this.tileLayer.isLocalTileLayer||this.zooming){var b=this,c=setTimeout(function(){b.tileInitialized()},70);this.timeouts.push(c)}else{this.aniDiv&&this.startClear();this.tileLayer.jqLayerDiv&&this.tileLayer.jqLayerDiv.css("visibility",this.tileLayer.visible?"visible":"hidden");var c=a.event,M=new c.LayerEvent(c.LayerEvent.FINISH_LOAD,
this.tileLayer);M.mapContext=this.tileLayer.parentMap.getMapContext();this.tileLayer.fire(c.LayerEvent.FINISH_LOAD,M)}},hasTilesLoadFinished:function(){if(!this.tileArray&&!this.tileLayer.tileArray)return!0;if(!this.tileLayer.isLocalTileLayer)for(var a=0;a<this.tileLayer.tileArray.length;a++)for(var b=0;b<this.tileLayer.tileArray[a].length;b++)if(!this.hasTileLoaded(this.tileLayer.tileArray[a][b].node))return!1;return!0},hasTileLoaded:function(b){return b[0].src===a.util.MiscUtil.transparentImgURL?
!0:a.browser.msie?b.imgLoadFinished:1>=Math.abs(b[0].offsetWidth-this.imageWidth)},startClear:function(){if(a.browser.msie)for(var b=0;b<this.tileLayer.tileArray.length;b++)for(var c=0;c<this.tileLayer.tileArray[b].length;c++)this.tileLayer.tileArray[b][c].node.css("display","");this.aniDiv&&this.aniDiv.css("zIndex",this.tileLayer.zIndex);this.clearCloneTiles()},clearCloneTiles:function(){if(this.tileLayer&&this.tileLayer.parentMap)if(this.hasTilesLoadFinished()){var b;for(b=0;b<this.tileLayer.tileArray.length;b++)for(var c=
0;c<this.tileLayer.tileArray[b].length;c++)this.tileLayer.tileArray[b][c].node.css("display","");this.removeCloneTiles();for(b=0;b<this.timeouts.length;b++)clearTimeout(this.timeouts[b]);this.timeouts=[];b=a.event;c=new b.LayerEvent(b.LayerEvent.FINISH_LOAD,this.tileLayer);c.mapContext=this.tileLayer.parentMap.getMapContext();this.tileLayer.fire(b.LayerEvent.FINISH_LOAD,c)}else{var M=this;b=setTimeout(function(){M.clearCloneTiles()},70);this.timeouts.push(b)}},removeCloneTiles:function(){this.aniDiv&&
this.aniDiv.parent()&&(this.aniDiv.remove(),this.aniDiv=null);this.zooming=!1},scaleTiles:function(b){if(this.scaling||this.tileLayer.isVisible()&&!a.isNull(this.tileLayer.tileArray)){var c,M,r;if(!this.scaling)for(this.computeTilesOffset(),this.copyTiles(),this.scaling=!0,c=0;c<this.tileArray.length;c++)for(M=0;M<this.tileArray[c].length;M++){r=this.tileArray[c][M].node;var q=a.util.DomUtil.getElementPos(a.$(r));r.origLeft=q.left;r.origTop=q.top}c=this.tileLayer.tileLayerConfig;var q=c.tileImageWidth*
b,N=c.tileImageWidth*b;c=this.tileLayer.parentMap.getMapContext();var Z=c.getDeviceWidth()/2+this.ldiff,ba=c.getDeviceHeight()/2+this.tdiff;for(c=0;c<this.tileArray.length;c++)for(M=0;M<this.tileArray[c].length;M++)r=this.tileArray[c][M].node,this.scaleTile(r,b,q,N,Z,ba)}else this.reset()},scaleTile:function(b,c,M,r,q,N){b.zoomFinished=!0;1!=c&&(q-=(q-b.origLeft)*c,c=N-(N-b.origTop)*c,a.$(b).css({left:q,top:c,width:M+1,height:r+1}))},endScaling:function(){this.scaling=!1;var b=this.tileLayer.jqLayerDiv;
if(b){var c=a.util.DomUtil.getElementPos(b),M=c.left,c=c.top,r=a.util.DomUtil.getElementPos(b.parent().parent());b.css({left:M+r.left,top:c+r.Top})}this.startClear()},destroy:function(){this.tileLayer=null}});a.layer.Mesh=function(a,b,c,r){var q=a.zoomLevels[r];this.mw=a.tileImageWidth*q.resolution;this.mh=a.tileImageHeight*q.resolution*q.stretchRatio;a=a.bounds;this.mX=Math.floor((b-a.getMinX())/this.mw);this.mY=Math.floor((c-a.getMinY())/this.mh);this.zoom=r;this.minX=this.mX*this.mw+a.getMinX();
this.minY=this.mY*this.mh+a.getMinY()};a.layer.Mesh.prototype.moveMeshCode=function(a,b){this.mX+=a;this.mY+=b};a.layer.VectorLayer=a.layer.Layer.extend({initialize:function W(b,c){if(a.isNull(c)||a.isNull(c.def)||a.isNull(c.def.type))throw Error("Invalid or null VectorLayer options found.");this.displayFeaturesTask=this.initTask=this.boundingDataTask=null;var q=c.def;this.options=c;W.base.call(this,b);this.useRTree=a.notNull(c&&c.useRTree)?c.useRTree:a.gv.useRTree;this.layerType=a.LayerTypes.VECTOR;
this.initError=this.dataLoaded=this.cachingEnabled=!1;this.name=b;var N=a.layer.VectorLayer;this.type=q.type;a.isNull(q.xRatio)||!a.util.ValidationUtil.isNumber(q.xRatio)||1>q.xRatio?this.xRatio=2:this.xRatio=q.xRatio;a.isNull(q.yRatio)||!a.util.ValidationUtil.isNumber(q.yRatio)||1>q.yRatio?this.yRatio=2:this.yRatio=q.yRatio;this.searchBuffer=a.browser.touchSupported?10:5;this.enableXHR=q&&q.enableXHR?!0:!1;this.selectArray=[];this.jsonp=!1;"undefined"!==typeof q.jsonp&&(this.jsonp=q.jsonp);this.flag=
!0;this.bfMbr=this.mbr=null;var Z=q.dataSource||q.datasource;if(this.type===N.TYPE_PREDEFINED)this.dataSource=Z,this.themeName=q.theme,q.url&&(this.serverURL=q.url),a.isNull(q.loadOnDemand)?this.loadOnDemand=!0:this.loadOnDemand=q.loadOnDemand,this.workspace=q.workspace,this.featureArray=[];else if(this.type===N.TYPE_LOCAL)for(this.featureArray=[],N=q.features?q.features.length:0,Z=0;Z<N;Z++){var ba=q.features[Z];this.isValidId(ba.id)?this.featureArray.push(ba):a.util.Logger.warning("MAPVIEWER_9005",
"OM.layer.VectorLayer")}else this.type===N.TYPE_JDBC?(this.dataSource=Z,this.sql=q.sql,this.serverURL=q.url,this.featureArray=[],this.geometryColumn=q.geometryColumn,this.labelColumn=q.labelColumn?q.labelColumn.toUpperCase():null,this.keyColumn=q.keyColumn?q.keyColumn.toUpperCase():null,this.baseTable=q.baseTable?q.baseTable.toUpperCase():null,a.isNull(q.loadOnDemand)?this.loadOnDemand=!0:this.loadOnDemand=q.loadOnDemand,this.workspace=q.workspace,this.jdbcSrid=a.notNull(q.jdbcSrid)?q.jdbcSrid:8307):
this.type===N.TYPE_DATAPACK?(this.serverURL=(N=q.dataPackUrl||q.url)?N:"invalid url",this.featureArray=[],this.geometryColumn=q.geometryColumn,this.labelColumn=q.labelColumn?q.labelColumn.toUpperCase():null):this.type===N.TYPE_GEORSS&&(this.serverURL=q.url);c.renderingStyle&&c.renderingStyle.effects&&0<c.renderingStyle.effects.length&&(this.visualFilter=c.renderingStyle.effects[0]);if(this.renderingStyle=c.renderingStyle)this.renderingStyle=c.renderingStyle;this.styleAttributes=c.styleAttributes;
this.boundingTheme=c.boundingTheme;this.enableInfoWindow(a.isNull(c.infoWindow)?!0:c.infoWindow);this.boundingZoomLevel=null;this.selectionEnable=!1;this.selectionMode=a.layer.VectorLayer.SINGLE_SELECTION;this.keepSelected=!1;this.bringToTopFlag=!0;this.selectedFeatures=[];this.featureEditable=!1;this.hoverStyle=this.hoverFeature=null;this.mapping=this.hoverEnable=!1;this.showToolTip=!0;this.mouseCursor=a.CursorTypes.POINTER;this.areaIdx=this.loadingStyle=0;this.attributeTypes=this.undoManager=this.changeManager=
null;this.notNullAttributes=[];this.rtree=null;this.segmentRtree={};this.sharedBoundary=!1;this.selectionChecker=null;this.pointerSensitivity=!0;this.tileFeatureGroup={}},setRenderingStyle:function(b,c){if(b)if(this.parentMap&&this.isServerSideStyle(b,"rendering"))c&&(this.styleAttributes=c);else{var r=this.renderingStyle,q=this.styleAttributes;this.renderingStyle=b;this.heatMap=null;c&&(this.styleAttributes=c,b instanceof a.style.BucketStyle&&!b.isServerSide&&(this.loadOnDemand?b.generateBuckets(this.featureArray,
this.styleAttributes,!0):b.generateBuckets(this.featureArray,this.styleAttributes,!1)));b.effects&&0<b.effects.length&&this.setVisualFilter(b.effects[0]);!this.visible&&this.displayed&&(this.parentMap.graphics.remove(this.realGroup),this.clearFeatureShapes(),this.displayed=!1);this.displayed&&(this.parentMap.graphics.remove(this.realGroup),this.clearFeatureShapes(),this.displayFeatures(!1),"POINT"!=this.getFeatureGeometryType()&&"PieChart"!=this.renderingStyle.styleType&&"BarChart"!=this.renderingStyle.styleType||
this.parentMap.refreshVectorLayerLabels());r==b&&a.util.MiscUtil.arraysAreEqual(q,this.styleAttributes)||(r=new a.event.LayerEvent(a.event.LayerEvent.RENDERING_STYLE_CHANGED,this),r.newStyle=b,r.attributes=c,this.parentMap&&(r.mapContext=this.parentMap.getMapContext()),this.fire(a.event.LayerEvent.RENDERING_STYLE_CHANGED,r))}},getAllFeatures:function(){return this.featureArray},size:function(){return this.featureArray?this.featureArray.length:0},getRenderingStyle:function(){return this.renderingStyle},
setLabelingStyle:function(b){if(b&&(!this.parentMap||!this.isServerSideStyle(b,"label"))){this.labelingStyle=b;this.setLabelsVisible(!0);if(this.displayed){for(var c=this.featureArray?this.featureArray.length:0,r=0;r<c;r++)this.featureArray[r].setLabelingStyle(this.labelingStyle);this.parentMap.refreshVectorLayerLabels()}c=a.event.LayerEvent;r=new c(c.LABELING_STYLE_CHANGED,this);r.style=b;this.parentMap&&(r.mapContext=this.parentMap.getMapContext());this.fire(c.LABELING_STYLE_CHANGED,r)}},getLabelingStyle:function(){return this.labelingStyle},
setLabelColumn:function(a){this.labelColumn=a},getLabelColumn:function(){return this.labelColumn},getSelectedFeatures:function(){return this.selectedFeatures},setSelectStyle:function(b){if(b&&(!this.parentMap||!this.isServerSideStyle(b,"select"))){this.enableFeatureSelection(!0);this.selectionStyle=b;b.effects&&0<b.effects.length&&this.setSelectVisualFilter(b.effects[0]);var c=a.event.LayerEvent,r=new c(c.SELECTION_STYLE_CHANGED,this);r.style=b;this.parentMap&&(r.mapContext=this.parentMap.getMapContext());
this.fire(c.SELECTION_STYLE_CHANGED,r)}},getSelectStyle:function(){return this.selectionStyle},setHoverStyle:function(b){if(b&&(!this.parentMap||!this.isServerSideStyle(b,"hover"))){this.enableFeatureHover(!0);b.effects&&0<b.effects.length&&this.setHoverVisualFilter(b.effects[0]);this.hoverStyle=b;var c=a.event.LayerEvent,r=new c(c.SELECTION_STYLE_CHANGED,this);r.style=b;this.parentMap&&(r.mapContext=this.parentMap.getMapContext());this.fire(c.HOVER_STYLE_CHANGED,r)}},getHoverStyle:function(){return this.hoverStyle},
setHoverVisualFilter:function(a){this.hoverFilter=a},clearSelectedFeatures:function(){for(var a=this.selectedFeatures?this.selectedFeatures.length:0;0<a;a--){var b=this.selectedFeatures.pop();b.enableFeatureEditing(!1);this.resetFeatureStates(b)}},resetFeatureStates:function(a){a.selected=!1;a.hover=!1;a.selectShape&&(a.graphics.remove(a.selectShape),a.selectShape=null);a.hoverShape&&(a.graphics.remove(a.hoverShape),a.hoverShape=null);a.setRenderingStyle(a.oldStyle);var b=this.parentMap.graphics;
a.shape&&(this.graphicFilter&&!this.visualFilter.applyToLayer?b.applyStyle(a.shape,{filter:this.graphicFilter}):b.applyStyle(a.shape,{filter:b.oui.filters.NONE}))},setSelectionChecker:function(a){"function"===typeof a&&(this.selectionChecker=a)},getSelectionChecker:function(){return this.selectionChecker},setPointerSensitivity:function(a){this.pointerSensitivity=a;this.realGroup&&this.realGroup.applyStyle({pointerSensitivity:a})},getPointerSensitivy:function(){return this.pointerSensitivity},selectFeature:function(b){if(!b||
!b.draggable)if(!this.selectionEnable||!this.selectionStyle&&!this.featureEditable)return;var c;if(!a.notNull(this.selectionChecker)||this.selectionChecker.call(this,b)){if(b.parentFeature)return b=b.parentFeature,b.parentLayer.selectFeature(b),b;if(!b.selected&&b.displayed){this.selectionMode===a.layer.VectorLayer.SINGLE_SELECTION&&this.clearSelectedFeatures();b.hoverShape&&(b.graphics.remove(b.hoverShape),b.hoverShape=null);this.selectionStyle&&(b.oldStyle||(b.oldStyle=b.renderingStyle?b.renderingStyle:
this.getDefaultRenderingStyle(b.geo.type)),"PulseAnimation"==this.selectionStyle.styleType||"AnimationColor"==this.selectionStyle.styleType?(c=b.shape,b.displayFeature([this.selectionStyle]),b.selectShape=b.shape,b.shape=c):(c=this.getHoverSelectStyle(this.selectionStyle,b),b.setRenderingStyle(c)));if(b.displayed&&b.shape){c=this.parentMap.graphics;if(this.selectVisualFilter){var r=c.getGraphicFilter(this.selectVisualFilter);c.applyStyle(b.shape,{filter:r})}else c.applyStyle(b.shape,{filter:c.oui.filters.NONE});
b.startAnimation()}this.featureEditable&&b.enableFeatureEditing(!0);b.draggable&&b.enableFeatureDragging(!0);this.selectedFeatures.push(b);b.selected=!0;this.bringToTopFlag&&(b.getShapeIndex(),b.bringToTop());c=a.event.LayerEvent;r=new c(c.FEATURE_SELECTED,this);r.selectedFeature=b;r.mapContext=this.parentMap.getMapContext();this.fire(c.FEATURE_SELECTED,r)}else this.keepSelected||this.deselectFeature(b);return b}},hover:function(a){if(!this.hoverEnable||a.hover||a.selected)return null;this.deHover(this.hoverFeature);
a.oldStyle||(a.oldStyle=a.renderingStyle?a.renderingStyle:this.getDefaultRenderingStyle(a.geo.type));if(this.hoverStyle)if("PulseAnimation"===this.hoverStyle.styleType||"AnimationColor"===this.hoverStyle.styleType){var b=a.shape;a.displayFeature([this.hoverStyle]);a.hoverShape=a.shape;a.shape=b}else b=this.getHoverSelectStyle(this.hoverStyle,a),a.setRenderingStyle(b);a.displayed&&a.shape&&(this.hoverFilter?(b=this.parentMap.graphics.getGraphicFilter(this.hoverFilter),this.parentMap.graphics.applyStyle(a.shape,
{filter:b})):this.parentMap.graphics.applyStyle(a.shape,{filter:this.parentMap.graphics.oui.filters.NONE}),a.startAnimation());this.hoverFeature=a;a.hover=!0;return a},deHover:function(a){if(a&&a.hover){var b=a.selected;a.editable||(a.hoverShape?(a.graphics.remove(a.hoverShape),a.hoverShape=null):b||(a.setRenderingStyle(a.oldStyle),this.bringSelectedFeaturesToTop(),a.displayed&&a.shape&&(b=this.parentMap.graphics,this.graphicFilter&&!this.visualFilter.applyToLayer?b.applyStyle(a.shape,{filter:this.graphicFilter}):
b.applyStyle(a.shape,{filter:b.oui.filters.NONE}))),this.hoverFeature&&(this.hoverFeature.hover=!1,this.hoverFeature=null))}},bringSelectedFeaturesToTop:function(){var b=this.getSelectedFeatures();if(a.notNull(b))for(var c=0;c<b.length;c++){var r=b[c];if(a.isNull(r.parentLayer)){a.util.Logger.warning(null,"VectorLayer.bringSelectedFeaturesToTop","Feature has no parent layer, possibly because feature ID is no longer valid: "+r.id);break}this.bringFeatureToTop(r)}},deselectFeature:function(b){var c;
if(b.selected){b.enableFeatureEditing(!1);b.selectShape&&(b.graphics.remove(b.selectShape),b.selectShape=null);b.hover?(this.hoverStyle&&("PulseAnimation"===this.hoverStyle.styleType||"AnimationColor"===this.hoverStyle.styleType?(c=b.shape,b.displayFeature([this.hoverStyle]),b.hoverShape=b.shape,b.shape=c):(c=this.getHoverSelectStyle(this.hoverStyle,b),b.setRenderingStyle(c))),b.displayed&&b.shape&&(c=this.parentMap.graphics,this.hoverFilter?c.applyStyle(b.shape,{filter:this.hoverGraphicFilter}):
c.applyStyle(b.shape,{filter:c.oui.filters.NONE}),b.startAnimation())):(b.oldStyle&&b.setRenderingStyle(b.oldStyle),b.displayed&&b.shape&&(c=this.parentMap.graphics,this.graphicFilter&&!this.visualFilter.applyToLayer?c.applyStyle(b.shape,{filter:this.graphicFilter}):c.applyStyle(b.shape,{filter:c.oui.filters.NONE})));b.selected=!1;this.bringSelectedFeaturesToTop();c=this.selectedFeatures?this.selectedFeatures.length:0;for(var r=0;r<c;r++)if(this.selectedFeatures[r]===b){this.selectedFeatures.splice(r,
1);break}c=a.event.LayerEvent;r=new c(c.FEATURE_DESELECTED,this);r.deselectedFeature=b;r.mapContext=this.parentMap.getMapContext();this.fire(c.FEATURE_DESELECTED,r)}return b},enableFeatureSelection:function(b,c){if(this.selectionEnable=b)this.selectionMode=c==a.layer.VectorLayer.MULTIPLE_SELECTION||c==a.layer.VectorLayer.SINGLE_SELECTION?c:a.layer.VectorLayer.SINGLE_SELECTION},getSelectionMode:function(){return this.selectionMode},setKeepSelected:function(a){this.keepSelected=a},enableFeatureHover:function(a){this.hoverEnable=
a},enableFeatureEditing:function(b){if(this.featureEditable===b)return!0;var c=a.layer.VectorLayer;if(b){if(this.parentMap&&this.parentMap.wraparound)return a.util.Logger.warning("MAPVIEWER_9105","OM.layer.VectorLayer.enableFeatureEditing"),!1;if(this.type===c.TYPE_JDBC||this.type===c.TYPE_PREDEFINED){if(a.isNull(this.keyColumn)||a.isNull(this.baseTable)||a.isNull(this.geometryColumn))return a.util.Logger.alert("MAPVIEWER_9052","OM.layer.VectorLayer.enableFeatureEditing",""),!1;if("ROWID"===this.keyColumn.toUpperCase())return a.util.Logger.alert("MAPVIEWER_9053",
"OM.layer.VectorLayer.enableFeatureEditing",""),!1}}if(this.featureEditable=b)return this.selectionEnable=!0,this.changeManager=new a.edit.EditChangeManager({layer:this}),this.undoManager=new a.UndoManager,this.createRtree(),!0;if(this.selectedFeatures)for(b=this.selectedFeatures.length,c=0;c<b;c++)this.selectedFeatures[c].enableFeatureEditing(!1);this.undoManager=this.changeManager=null;!1===this.useRTree&&(this.rtree=null);this.segmentRtree={};return!0},getUndoManager:function(){return this.undoManager},
isFeatureEditable:function(){return this.featureEditable},saveEditing:function(b){if(a.notNull(this.changeManager)&&this.changeManager.hasChanges){var c=a.layer.VectorLayer;if(this.type===c.TYPE_PREDEFINED||this.type===c.TYPE_JDBC){var c=this.serverURL+"/dataserver/"+this.dataSource,r={},q=a.util.HttpRequest.getDomain(this.serverURL);q||(q=a.util.HttpRequest.localDomain);if(q=a.gv.mvKeyMap[q])r.key=q;this.sessionId&&(r.ssid=this.sessionId);var q='\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e\n\x3cedit_request\x3e\n\t\x3csave_session_layer',
q=q+(' data_source\x3d"'+this.dataSource+'"'),q=q+' editor\x3d"dummy"\x3e\n',q=q+"\t\t\x3clayer ",q=q+('base_table\x3d"'+this.baseTable+'" '),q=q+('key_column\x3d"'+this.keyColumn+'" '),q=q+('spatial_column\x3d"'+this.geometryColumn+'" '),N="geometry";a.notNull(this.spatialType)&&(N=this.spatialType);var q=q+('spatial_type\x3d"'+this.spatialType+'" '),q=a.isNull(this.workspace)?q+'workspace\x3d"LIVE"\x3e\n':q+('workspace\x3d"'+this.workspace+'"\x3e\n'),q=q+"\t\t\t\x3cinsert_features\x3e\n",Z=this.changeManager.getNewFeatures(),
ba="string";if(a.notNull(Z)&&0<Z.length)for(var Y=0;Y<Z.length;Y++){var qa=Z[Y];if(!a.isNull(qa)){q+='\t\t\t\t\x3cfeature key\x3d"'+qa.id+'"\x3e\n';ba="string";a.notNull(this.attributeTypes[this.keyColumn])&&(ba=this.attributeTypes[this.keyColumn]);q+='\t\t\t\t\t\x3cattribute name\x3d"'+this.keyColumn+'" type\x3d"'+ba+'"\x3e\n';q+="\t\t\t\t\t\t\x3cvalue\x3e"+qa.id+"\x3c/value\x3e\n";q+="\t\t\t\t\t\x3c/attribute\x3e\n";if(a.notNull(this.attrNames))for(var la=0;la<this.attrNames.length;la++)if(this.attrNames[la]!==
this.keyColumn){var oa=qa.getAttributeValue(this.attrNames[la]);if(a.notNull(oa)){ba="string";a.notNull(this.attributeTypes[this.attrNames[la]])&&(ba=this.attributeTypes[this.attrNames[la]]);var wa=this.attrNames[la],da=qa.getRealColumnName(wa);a.notNull(da)&&(wa=da);q+='\t\t\t\t\t\x3cattribute name\x3d"'+wa+'" type\x3d"'+ba+'"\x3e\n';q+="\t\t\t\t\t\t\x3cvalue\x3e"+oa+"\x3c/value\x3e\n";q+="\t\t\t\t\t\x3c/attribute\x3e\n"}}q+='\t\t\t\t\t\x3cattribute name\x3d"'+this.geometryColumn+'" type\x3d"'+N.toLowerCase()+
'"\x3e\n';q+="\t\t\t\t\t\t\x3cvalue\x3e"+qa.geo.toGML()+"\x3c/value\x3e\n";q+="\t\t\t\t\t\x3c/attribute\x3e\n";q+="\t\t\t\t\x3c/feature\x3e\n"}}q+="\t\t\t\x3c/insert_features\x3e\n";q+="\t\t\t\x3cupdate_features\x3e\n";Z=this.changeManager.getModifiedFeatures();if(a.notNull(Z)&&0<Z.length)for(Y=0;Y<Z.length;Y++)if(qa=Z[Y],!a.isNull(qa)){q+='\t\t\t\t\x3cfeature key\x3d"'+qa.id+'"\x3e\n';ba="string";a.notNull(this.attributeTypes[this.keyColumn])&&(ba=this.attributeTypes[this.keyColumn]);q+='\t\t\t\t\t\x3cattribute name\x3d"'+
this.keyColumn+'" type\x3d"'+ba+'"\x3e\n';q+="\t\t\t\t\t\t\x3cvalue\x3e"+qa.id+"\x3c/value\x3e\n";q+="\t\t\t\t\t\x3c/attribute\x3e\n";la=this.changeManager.getChangedAttributesOfModifiedFeature(qa.id);if(a.notNull(la))for(oa=0;oa<la.length;oa++)if(la[oa]!==this.keyColumn&&(wa=qa.getAttributeValue(la[oa]),a.notNull(wa))){ba="string";a.notNull(this.attributeTypes[la[oa]])&&(ba=this.attributeTypes[la[oa]]);var da=la[oa],ia=qa.getRealColumnName(da);a.notNull(ia)&&(da=ia);q+='\t\t\t\t\t\x3cattribute name\x3d"'+
da+'" type\x3d"'+ba+'"\x3e\n';q+="\t\t\t\t\t\t\x3cvalue\x3e"+wa+"\x3c/value\x3e\n";q+="\t\t\t\t\t\x3c/attribute\x3e\n"}this.changeManager.hasSpatialAttributeChanged(qa.id)&&(q+='\t\t\t\t\t\x3cattribute name\x3d"'+this.geometryColumn+'" type\x3d"'+N+'"\x3e\n',q+="\t\t\t\t\t\t\x3cvalue\x3e"+qa.geo.toGML()+"\x3c/value\x3e\n",q+="\t\t\t\t\t\x3c/attribute\x3e\n");q+="\t\t\t\t\x3c/feature\x3e\n"}q+="\t\t\t\x3c/update_features\x3e\n";q+="\t\t\t\x3cdelete_features\x3e\n";N=this.changeManager.getRemovedFeatures();
if(a.notNull(N)&&0<N.length)for(ba=0;ba<N.length;ba++)Z=N[ba],a.isNull(Z)||(q+='\t\t\t\t\x3cfeature key\x3d"'+Z.id+'"/\x3e\n');q+="\t\t\t\x3c/delete_features\x3e\n";q+="\t\t\x3c/layer\x3e\n";q+="\t\x3c/save_session_layer\x3e\n";q+="\x3c/edit_request\x3e\n";r.xml_request=q;var x=this;r.refresh=Math.round(1E5*Math.random());a.notNull(this.saveDataRequest)&&this.saveDataRequest.abort();this.saveDataRequest=this.sendHttpRequest(c,r,function(c){c=c.documentElement.getElementsByTagName("save_session_layer");
var r=!1;if(a.notNull(c)){var J=c[0].attributes.getNamedItem("data_source").value,M=c[0].attributes.getNamedItem("layer").value,r=c[0].attributes.getNamedItem("success").value;"true"===r?(x.changeManager.clearChanges(),x.undoManager=new a.UndoManager,a.util.Logger.info("MAPVIEWER_9058","OM.layer.VectorLayer.saveEditing","["+J+","+M+","+r+"]")):a.util.Logger.warning("MAPVIEWER_9057","OM.layer.VectorLayer.saveEditing","["+J+","+M+","+r+","+c[0].childNodes[1].childNodes[1].textContent+"]")}else a.util.Logger.warning("MAPVIEWER_9057",
"OM.layer.VectorLayer.saveEditing","Unexpected response.");x.saveDataRequest=null;a.notNull(b)&&b(r)},"xml",function(b){x.saveDataRequest=null;b&&a.util.Logger.alert("MAPVIEWER_9057","OM.layer.VectorLayer.saveEditing",b.responseText)},!1)}else a.util.Logger.warning("MAPVIEWER_9056","OM.layer.VectorLayer.saveEditing",""),a.notNull(b)&&b(!1)}else a.notNull(b)&&b(!1)},setBoundingTheme:function(a){this.boundingTheme=a},zoomToTheme:function(){var a=this;this.parentMap&&this.parentMap.initialized?(this.bfMbr=
this.mbr=null,this.loadBoundingTheme(function(b,c,q,N){(b=a.calculateCenterAndZoomLevel(b,c,q,N))&&1<b.length&&a.parentMap.setMapCenterAndZoomLevel(b[1],b[0])})):setTimeout(function(){a.zoomToTheme()},300)},centerToTheme:function(){var a=this;this.parentMap&&this.parentMap.initialized?this.loadBoundingTheme(function(b,c,q,N){(b=a.calculateCenterAndZoomLevel(b,c,q,N))&&1<b.length&&a.parentMap.setMapCenter(b[1])}):setTimeout(function(){a.centerToTheme()},300)},setBringToTopOnMouseOver:function(a){this.bringToTopFlag=
a},getFeatureGeometryType:function(){if(this.type!=a.layer.VectorLayer.TYPE_LOCAL&&this.featureArray&&0<this.featureArray.length){var b=this.featureArray[0].geo;if("Point"==b.type||"OrientedPoint"==b.type||"MultiPoint"==b.type||"OrientedMultiPoint"==b.type)return"POINT";if("LineString"==b.type||"MultiLineString"==b.type)return"LINESTRING";if("Polygon"==b.type||"MultiPolygon"==b.type)return"POLYGON"}return""},setSelectVisualFilter:function(a){this.selectVisualFilter=a},setVisualFilter:function(b){this.visualFilter=
b;if(this.displayed&&this.visualFilter)if(this.graphicFilter=this.parentMap.graphics.getGraphicFilter(this.visualFilter),this.visualFilter.applyToLayer)this.parentMap.graphics.applyStyle(this.realGroup,{filter:this.graphicFilter});else{b=this.featureArray?this.featureArray.length:0;for(var c=0;c<b;c++){var r=this.featureArray[c];r.shape&&this.parentMap.graphics.applyStyle(r.shape,{filter:this.graphicFilter})}}else this.displayed&&a.isNull(this.visualFilter)&&(this.graphicFilter=null,this.parentMap.graphics.applyStyle(this.realGroup,
{filter:this.parentMap.graphics.oui.filters.NONE}))},getSelectVisualFilter:function(){return this.selectVisualFilter},getVisualFilter:function(){return this.visualFilter},setLabelsVisible:function(a){this.showLabels=a},labelsVisible:function(){return this.showLabels},getExtent:function(){if(!this.mbr){var b=this.featureArray?this.featureArray.length:0,c={minX:null,minY:null,maxX:null,maxY:null},r={minX:null,minY:null,maxX:null,maxY:null},q=a.geometry.Geometry.calculateMBR,N=this.renderingStyle,Z=
a.notNull(N)&&a.notNull(N.hasBinding)&&N.hasBinding(),ba=a.notNull(this.nsdpData)&&a.notNull(this.nsdpKey),Y=function(a,b){var c,r,M,da;a.getMBR?(da=a.getMBR(),c=da.getMinX(),M=da.getMinY(),r=da.getMaxX(),da=da.getMaxY()):(da=q(a.coordinates,a.type,a.dimension),c=da.minX,M=da.minY,r=da.maxX,da=da.maxY);if(null===b.minX||c<b.minX)b.minX=c;if(null===b.minY||M<b.minY)b.minY=M;if(null===b.maxX||r>b.maxX)b.maxX=r;if(null===b.maxY||da>b.maxY)b.maxY=da},qa=this.parentMap.getMapContext().getUniverse().getSRID(),
la=!1,oa=!1,wa=function(a){Y(a,c);(la||oa)&&Y(a,r)},da,ia,x=a.util.BaiduUtil.SRID;for(da=0;da<b;da++)ia=this.featureArray[da],la=Z&&N.isFeatureBound(ia),oa=ba?a.notNull(this.getNsdpDataForFeature(ia)):!1,ia=ia.getGeometry(),qa!==ia.srid?qa!==x?ia.transform(qa,wa):ia.transform(qa,wa,null,null,{map:this.parentMap,inputIsBD09LonLat:!0}):(Y(ia,c),(la||oa)&&Y(ia,r));a.notNull(c.minX)&&a.notNull(c.minY)&&a.notNull(c.maxX)&&a.notNull(c.maxY)?this.mbr=new a.geometry.Rectangle(c.minX,c.minY,c.maxX,c.maxY,
qa):this.mbr=null;Z||ba?a.notNull(r.minX)&&a.notNull(r.minY)&&a.notNull(r.maxX)&&a.notNull(r.maxY)?this.bfMbr=new a.geometry.Rectangle(r.minX,r.minY,r.maxX,r.maxY,qa):this.bfMbr=null:this.bfMbr=this.mbr}return this.mbr},getAttributeNames:function(){return this.attrNames},setNSDP:function(b){if(b&&b.keyColumn){this.clearNSDP();this.nsdpKey=b.keyColumn;this.nsdpKey=this.nsdpKey.toUpperCase();this.nsdp=b;"undefined"===typeof this.nsdp.ignoreCase&&(this.nsdp.ignoreCase=!0);a.isNull(this.nsdp.fullDisplay)&&
(this.nsdp.fullDisplay=!1);var c=this,r=function(b){a.util.Logger.finest("","OM.VectorLayer.setNSDP","parsing NSDP XML data...");var r=null;"string"===typeof b&&(b=a.$.trim(b),b=a.$.parseXML(b));var r=a.$(b),q=0;c.nsdpTitleArray=[];r.find("th").each(function(){var b=a.$(this).text();c.nsdpTitleArray.push(b);a.util.Logger.finest("title["+q+"]:"+b);q+=1});a.util.Logger.finest("Total "+q+" column(s) found");q=0;c.nsdpData={};r.find("tr").each(function(){var b=0,r=null,N={};a.$(this).find("td").each(function(){if(0===
b)r=a.$(this).text();else{var q=c.nsdpTitleArray[b].toUpperCase();N[q]=a.$(this).text()}b++});r&&(r=c.nsdp.ignoreCase?r.toUpperCase():r,c.nsdpData[r]=N,a.util.Logger.finest("Values for key '"+r+"' added into layer '"+c.name+"'"),q+=1)});a.util.Logger.finest("Total "+q+" key/value pair(s) added into layer '"+c.name+"'");c.parentMap&&c.name===c.parentMap.boundingLayerName&&c.loadBoundingTheme();c.displayed&&(c.renderingStyle instanceof a.style.BucketStyle&&c.renderingStyle.clearBuckets(),c.redraw(!1))},
q=function(r){a.util.Logger.finest("JSON data to be parsed: "+JSON.stringify(r));a.util.Logger.finest("parsing NSDP JSON data...");"string"===typeof r&&(r=a.$.parseJSON(r));if(r.items&&0!==r.items.length){r=r.items;var q=r.length,N=0;c.nsdpData={};c.nsdpTitleArray=[];var qa=b.keyAttr,la=!1;a.isNull(qa)&&(qa=b.keyColumn);a.notNull(r[0][qa])&&(la=!0);for(var oa in r[0])c.nsdpTitleArray.push(oa),a.util.Logger.finest("attribute["+N+"]:"+oa),N+=1,la||oa.toUpperCase()!=qa.toUpperCase()||(la=!0,qa=oa);a.util.Logger.finest("Total "+
N+" attribute(s) found");for(la=N=0;la<q;la++){var wa=r[la][qa];if(!a.isNull(wa)){var da={};for(oa in r[la])oa!=qa&&(da[oa.toUpperCase()]=r[la][oa]);wa=c.nsdp.ignoreCase&&wa.toUpperCase?wa.toUpperCase():wa;c.nsdpData[wa]=da;a.util.Logger.finest("Values for key '"+wa+"' added into layer '"+c.name+"'");N+=1}}a.util.Logger.finest("Total "+N+" key/value pair(s) added into layer '"+c.name+"'");c.displayed&&(c.renderingStyle instanceof a.style.BucketStyle&&c.renderingStyle.clearBuckets(),c.redraw(!1))}};
if(b&&b.url){a.$.ajaxSetup({async:!1});try{a.$.get(b.url,null,function(a){try{r(a)}catch(b){q(a)}},"text").fail(function(){a.util.Logger.warning("MAPVIEWER_9042","OM.layer.VectorLayer.setNSDP",b.url)})}catch(N){a.util.Logger.warning(null,"OM.layer.VectorLayer.setNSDP","Exception when loading nsdp url data.")}finally{a.$.ajaxSetup({async:!0})}}else b&&b.xml?(a.util.Logger.finest("XML string to be parsed: "+b.xml),r(a.util.XMLUtil.parse(b.xml))):b&&b.json&&q(b.json)}},getNSDPString:function(){if(!this.nsdp)return"";
var b;b='{"nsdp_id":"defaultNSDP",'+('"nsdp_theme":"'+this.name+'",');b+='"nsdp_keycol":"'+this.nsdpKey+'"';a.notNull(this.fullDisplay)&&!1===this.fullDisplay&&(b+=',"nsdp_smfo":"true"');b+=',"nsdp_params":[';var c,r;a.notNull(this.nsdp.xml)?(c="xml",r=this.nsdp.xml,r=r.replaceAll('"','\\"')):a.notNull(this.nsdp.json)?(c="json",r=this.nsdp.json,"object"===typeof r&&(r=JSON.stringify(r)),r=r.replaceAll('"','\\"')):a.notNull(this.nsdp.url)&&(c="url",r=this.nsdp.url,r=r.replaceAll('"','\\"'));b+='{"'+
c+'":"'+r+'"}';return b+="]}"},applyFilter:function(b,c){if("undefined"===typeof c||c){if(b.filterMode===a.filter.Filter.CLIENT_SIDE)return this.filterArray||(this.filterArray=[]),this.filterArray.push(b),this.replace=!1,this.doFilter(),this.loadOnDemand=!1,this}else if(b.filterMode==a.filter.Filter.CLIENT_SIDE){var r=this.clone();r.loadOnDemand=!1;r.filterArray=this.filterArray?a.$.extend([],this.filterArray):[];r.filterArray.push(b);this.replace=!1;r.doFilter();return r}},removeFilter:function(a){if(this.filterArray)for(var b=
this.filterArray.length;-1<b;b--)if(a==this.filterArray[b]){this.filterArray.splice(b,1);break}},removeFilterAll:function(){this.filterArray=[]},doFilter:function(a,b){if(this.filterArray&&0!==this.filterArray.length||b){var c=this.filterArray;this.replace&&(c=[b]);for(var q=0;q<c.length;q++){var N=c[q];if(a){if(!N.evaluate(a))return!0}else if(this.featureArray&&0!==this.featureArray.length)for(var Z=this.featureArray.length-1;-1<Z;Z--){var ba=this.featureArray[Z];this.replace&&ba.selected||(N.evaluate(ba)?
this.replace&&this.selectFeature(ba):this.replace||this.removeFeature(ba))}else break}}},selectFeatureByFilter:function(b){if(b&&(this.enableFeatureSelection(!0,a.layer.VectorLayer.MULTIPLE_SELECTION),b.filterMode==a.filter.Filter.CLIENT_SIDE))return this.replace=!0,this.doFilter(null,b),this.loadOnDemand=this.replace=!1,this},addToRtree:function(b,c){if(!(!1===this.featureEditable&&!1===this.useRTree||a.isNull(b))){var r=a.isNull(c)?b.getGeometry():c;a.isNull(r)||(r=a.notNull(r.mbr)?r.mbr:a.notNull(r.getMBR)?
r.getMBR():null,r={x:r.getMinX(),y:r.getMinY(),w:r.getWidth(),h:r.getHeight()},this.containsKey(b,r)||(a.isNull(this.rtree)&&(this.rtree=new a.RTree(10)),this.rtree.insert(r,b),b.rtreeKeys.push(r)))}},containsKey:function(b,c){a.isNull(b.rtreeKeys)&&(b.rtreeKeys=[]);a.isNull(c)&&(c={});for(var r=b.rtreeKeys,q=0;q<r.length;q++)if(r[q].x===c.x&&r[q].y===c.y&&r[q].w===c.w&&r[q].h===c.h)return!0;return!1},removeFromRtree:function(b){if(!(!1===this.useRTree||a.isNull(b)||a.isNull(this.rtree)||a.isNull(b.rtreeKeys))){for(var c=
b.rtreeKeys,r=0;r<c.length;r++)this.rtree.remove(c[r],b);b.rtreeKeys=[]}},beforeZoom:function(){this.pixMaxYDistance=this.pixMaxXDistance=null},updatedSearchWindow:function(b,c){if(a.notNull(b.shape)&&(c===a.GeomTypes.POINT||c===a.GeomTypes.ORIENTEDPOINT||c===a.GeomTypes.MULTIPOINT||c===a.GeomTypes.ORIENTEDMULTIPOINT)){var r=b.getGeometry(),q=b.shape.getLayoutBounds();if(c===a.GeomTypes.MULTIPOINT||c===a.GeomTypes.ORIENTEDMULTIPOINT)r=r.coordinates,r=new a.geometry.Point(r[0][0],r[0][1]),1<b.shape.childrenCount&&
(q=b.shape.getChildAt(0).getLayoutBounds());if(a.notNull(q)&&a.notNull(this.parentMap)){var N=this.parentMap,r=N.getScreenLocation(r),N=N.graphics.getLeftTop(N.draggableGroup);q.x=N.x+q.x;q.y=N.y+q.y;N=Math.abs(q.x-r.x)+q.width/2;q=Math.abs(q.y-r.y)+q.height/2;if(a.isNull(this.pixMaxXDistance)||this.pixMaxXDistance<N)this.pixMaxXDistance=N;if(a.isNull(this.pixMaxYDistance)||this.pixMaxYDistance<q)this.pixMaxYDistance=q}}},getSearchWindow:function(b){var c,r;c=a.notNull(this.pixMaxXDistance)?2*this.pixMaxXDistance:
this.searchBuffer;r=a.notNull(this.pixMaxYDistance)?2*this.pixMaxYDistance:this.searchBuffer;r=this.pixToCoord(c,r);return a.notNull(r)?(c=r.width,r=r.height,{x:b.getX()-c/2,y:b.getY()-r/2,w:c,h:r,srid:this.parentMap.getMapContext().getUniverse().srid}):null},pixToCoord:function(a,b){var c=this.parentMap,q=c.getMapContext(),N=q.getUniverse(),q=q.getZoomLevel();if(N&&N.zoomLevels)return q=c.checkZoomLevel(q),c=N.zoomLevels[q].resolution,N=N.zoomLevels[q].stretchRatio,{width:Math.abs(a*c),height:Math.abs(b*
c*N)}},findFeature:function(b,c){if(a.isNull(this.rtree))return null;try{var r=null,q=a.util.DomUtil.getTouchesClientPosition(b);a.notNull(q.x)&&(b.clientX=q.x,b.clientY=q.y);if(a.isNull(b.clientX)||a.isNull(b.clientY))return null;for(var N=this.parentMap.getScreenPointLocation(b.clientX,b.clientY),Z=this.getSearchWindow(N),ba=this.rtree.search(Z),q=0;q<ba.length;q++)if(r=ba[q],this.pointInFeature(b.clientX,b.clientY,r))return r;if(!1===c)return null;for(q=0;q<ba.length;q++)if(r=ba[q],this.pointNearFeature(N,
r))return r.fkNode=r.shape,r}catch(Y){}return null},findFeatures:function(b,c){!0!==c&&(c=!1);if(a.isNull(this.rtree))return null;var r=[],q=null;try{var N=a.util.DomUtil.getTouchesClientPosition(b);a.notNull(N.x)&&(b.clientX=N.x,b.clientY=N.y);for(var Z=this.parentMap.getScreenPointLocation(b.clientX,b.clientY),ba=this.getSearchWindow(Z),Y=this.rtree.search(ba),N=0;N<Y.length;N++)q=Y[N],this.pointInFeature(b.clientX,b.clientY,q)&&r.push(q);if(0<r.length)return r;if(!1===c)return null;for(N=0;N<Y.length;N++)q=
Y[N],this.pointNearFeature(Z,q)&&(q.fkNode=q.shape,r.push(q))}catch(qa){}return 0<r.length?r:null},pointInFeature:function(b,c,r){if(a.notNull(r)&&a.notNull(r.shape)){if(this.pointInShape(b,c,r.shape,r)||this.pointInShape(b,c,r.ghostShape,r))return!0;if(a.notNull(r.shapeArray))for(var q=0;q<r.shapeArray.length;q++)if(this.pointInShape(b,c,r.shapeArray[q],r))return!0}return!1},pointInShape:function(b,c,r,q){return a.isNull(r)?!1:(b=r.hitTest(b,c))?(q.fkNode=b,b.feature=q,!0):!1},pointNearFeature:function(b,
c){var r=c.getGeometry(),q=r.coordinates,N=r.getType(),Z=null,ba=Number.MAX_VALUE,Y=[];switch(N){case a.GeomTypes.POINT:case a.GeomTypes.ORIENTEDPOINT:Z=this.minDistance({x:b.getX(),y:b.getY()},[{x:r.getX(),y:r.getY()}]);break;case a.GeomTypes.MULTIPOINT:case a.GeomTypes.ORIENTEDMULTIPOINT:Y=[];for(r=0;r<q.length;r++)for(N=q[r],Z=0;Z<N.length;Z+=2)Y.push({x:N[Z],y:N[Z+1]});Z=this.minDistance({x:b.getX(),y:b.getY()},Y);break;case a.GeomTypes.LINESTRING:for(r=0;r<q.length-2;r+=2)Y.push([{x:q[r],y:q[r+
1]},{x:q[r+2],y:q[r+3]}]);Z=this.minPointSegmentDistance({x:b.getX(),y:b.getY()},Y);break;case a.GeomTypes.MULTILINESTRING:for(r=0;r<q.length;r++)for(N=q[r],Z=0;Z<N.length-2;Z+=2)Y.push([{x:N[Z],y:N[Z+1]},{x:N[Z+2],y:N[Z+3]}]);Z=this.minPointSegmentDistance({x:b.getX(),y:b.getY()},Y)}a.notNull(Z)&&a.notNull(c.parentLayer)&&a.notNull(c.parentLayer.parentMap)&&(ba=c.parentLayer.parentMap.getMapContext().getTransform().toScreenXLength(Z));return ba<=this.searchBuffer},minDistance:function(b,c){for(var r=
Number.MAX_VALUE,q=0;q<c.length;q++)r=Math.min(r,a.util.GeomUtil.distance(b.x,b.y,c[q].x,c[q].y));return r},minPointSegmentDistance:function(b,c){for(var r=Number.MAX_VALUE,q=0;q<c.length;q++)r=Math.min(r,a.util.GeomUtil.pointSegmentDistance(b.x,b.y,c[q][0].x,c[q][0].y,c[q][1].x,c[q][1].y));return r},addFeature:function(b){if(!this.doFilter(b))if(this.featureArray||(this.featureArray=[]),this.isValidId(b.id)){if(this.featureArray.push(b),b.parentLayer=this,this.addToRtree(b),this.displayed){var c=
b.geo,r=this,q=function(c){var q=a.notNull(c.mbr)?c.mbr:a.notNull(c.getMBR)?c.getMBR():null;b.geo=c;c=r.parentMap.getMapZoomLevel();r.clustering&&c<=r.maxClusteringLevel&&r.vCluster.addFeature(b);if(!b.displayed){c=r.parentMap.getMapContext();var M=c.getWholeMapNum(),N=c.getBaseWholeMapIndex();a.notNull(r.featureGroupArr)&&0<r.featureGroupArr.length&&(a.notNull(b.activeIdx)?r.realGroup=r.featureGroupArr[b.activeIdx]:r.realGroup=r.featureGroupArr[0]);a.isNull(r.realGroup)&&(r.realGroup=r.parentMap.graphics.createGroup(),
r.realGroup.applyStyle({cursor:r.mouseCursor}),r.pointerSensitivity||r.realGroup.applyStyle({pointerSensitivity:!1}),r.group.appendChild(r.realGroup));b.group=r.realGroup;b.screenTransformObj=r.parentMap.getMapContext().getTransform();b.graphics=r.parentMap.graphics;b.parentLayer=r;r.display(b,q);var la,oa,wa;if(1<M&&(a.isNull(r.featureGroupArr)&&(r.featureGroupArr=[]),a.notNull(b.activeIdx)&&(M=b.activeIdx+1),a.isNull(r.featureGroupArr[M-1])&&(r.featureGroupArr[M-1]=r.realGroup,la=c.getUniverse().getZoomLevels()[c.getZoomLevel()].resolution,
oa=c.getUniverse().getMapBounds().getWidth(),wa=(c.getCenterPoint().getX()-c.getRoundMapCenterPoint().getX())/la,r.realGroup.translate((M-1-N)*oa/la-wa,0)),!a.notNull(b.activeIdx)))for(var da=1;da<M;da++)b.shapeArray||(b.shapeArray=[]),b.shapeArray.push(b.shape),a.notNull(r.featureGroupArr[da])?r.realGroup=r.featureGroupArr[da]:(r.realGroup=r.parentMap.graphics.createGroup(),r.realGroup.applyStyle({cursor:r.mouseCursor}),r.pointerSensitivity||r.realGroup.applyStyle({pointerSensitivity:!1}),r.group.appendChild(r.realGroup),
r.featureGroupArr[da]=r.realGroup,la=c.getUniverse().getZoomLevels()[c.getZoomLevel()].resolution,oa=c.getUniverse().getMapBounds().getWidth(),wa=(c.getCenterPoint().getX()-c.getRoundMapCenterPoint().getX())/la,r.realGroup.translate((da-N)*oa/la-wa,0)),r.display(b,q)}},N=this.parentMap.getMapContext().getUniverse().getSRID();N!=c.srid?N!==a.util.BaiduUtil.SRID?c.transform(N,q):c.transform(N,q,null,null,{map:this.parentMap}):q(c);this.labelsVisible()&&b.label&&this.parentMap.refreshVectorLayerLabels()}}else a.util.Logger.warning("MAPVIEWER_9005",
"OM.layer.VectorLayer.addFeature")},addFeatures:function(b){this.featureArray||(this.featureArray=[]);for(var c=b?b.length:0,r=0;r<c;r++)this.isValidId(b[r].id)&&!this.doFilter(b[r])?this.featureArray.push(b[r]):a.util.Logger.warning("MAPVIEWER_9005","OM.layer.VectorLayer.addFeatures")},clearFeature:function(b){this.parentMap&&this.parentMap.deleteFeatureInfoWindow(this.name+"_"+b.id);b.clearAnimation();b.animations=null;b.moveAnimation&&b.pauseMoveAnimation();b.selected&&this.deselectFeature(b);
b.shape&&(b.shape.feature=null,this.parentMap.graphics.remove(b.shape),b.shape=null);if(b.shapeArray){for(var c=b.shapeArray.length,r=0;r<c;r++)b.shapeArray[r]&&(b.shapeArray[r].feature=null,this.parentMap.graphics.remove(b.shapeArray[r]));b.shapeArray=null}if(b.shapeGroup){c=b.shapeGroup.length;for(r=1;r<c;r++)b.shapeGroup[r].feature=null,this.parentMap.graphics.remove(b.shapeGroup[r]);b.shapeGroup=null}b.labelShape&&(b.labelShape.feature=null,this.parentMap.graphics.remove(b.labelShape));if(b.labelShapeArr){for(c=
0;c<b.labelShapeArr.length;c++)this.parentMap.graphics.remove(b.labelShapeArr[c]);b.labelShapeArr=null}b.group=null;b.screenTransformObj=null;b.graphics=null;b.parentLayer=null;b.displayed=!1;b.inCluster=!1;this.removeFromRtree(b);a.notNull(b.$customDiv)&&(b.$customDiv.remove(),b.$customDiv=null)},removeFeature:function(b){var c,r;b&&b.editable&&b.featureEditingProperties&&b.deleteEditingProperties();c=this.featureArray?this.featureArray.length:0;for(r=0;r<c;r++)if(this.featureArray[r]===b)return this.featureArray.splice(r,
1),a.notNull(this.rtree)&&a.notNull(b.geo)&&(c=a.notNull(b.geo.mbr)?b.geo.mbr:a.notNull(b.geo.getMBR)?b.geo.getMBR():null,a.notNull(c)&&(c={x:c.getMinX(),y:c.getMinY(),w:c.getWidth(),h:c.getHeight()},this.rtree.remove(c,b),a.notNull(this.segmentRtree)&&a.notNull(this.segmentRtree[b.id])&&delete this.segmentRtree[b.id])),this.clearFeature(b),b;return null},removeAllFeatures:function(){var b=this.featureArray?this.featureArray.length:0;a.isNotNull(this.parentMap)&&this.parentMap.graphics.clearGroup(this.group);
for(var c=b-1;0<=c;c--){var r=this.featureArray.pop();this.clearFeature(r)}a.notNull(this.rtree)&&(this.rtree=new a.RTree(10));this.segmentRtree={};this.realGroup=null;this.featureArray=[];return b},initGroup:function(){this.parentMap&&this.parentMap.graphics&&(this.group=this.parentMap.graphics.createGroup({opacity:this.opacity,visibility:!0}),this.parentMap.draggableGroup.appendChild(this.group))},init:function(){var b=this.parentMap.getMapContext(),c=b.getDeviceWidth(),b=b.getDeviceHeight();this.serverURL||
this.type!=a.layer.VectorLayer.TYPE_JDBC&&this.type!=a.layer.VectorLayer.TYPE_PREDEFINED||(this.serverURL=this.parentMap.mapviewerURL);this.renderingStyle&&this.isServerSideStyle(this.renderingStyle,"rendering");this.labelStyle&&this.isServerSideStyle(this.labelStyle,"label");this.hoverStyle&&this.isServerSideStyle(this.hoverStyle,"hover");this.selectionStyle&&this.isServerSideStyle(this.selectionStyle,"select");if(this.otherStyles&&0<this.otherStyles.length)for(var r=0;r<this.otherStyles.length;r++)this.isServerSideStyle(this.otherStyles[r],
"secondary")&&(this.otherStyles.splice(r,1),r--);var q=this.parentMap.graphics;this.group&&(this.clearFeatureShapes(),0===this.group.childrenCount&&this.parentMap.draggableGroup.appendChild(this.group));var r=a.event.MouseEvent,N=this;N.timeStamp=0;if(this.useRTree){this.tooltipTimer=new a.util.TimerManager;var Z=q.oui.tooltipManager._properties.showDelay,ba=q.oui.tooltipManager._properties.hideDelay,Y=q.oui.tooltipManager._properties.dismissDelay;this.on(a.event.MouseEvent.MOUSE_MOVE,function(){N.showToolTip&&
N.tooltipTimer.reset("show")});this.on(a.event.MouseEvent.MOUSE_OUT,function(){N.showToolTip&&(N.tooltipTimer.cancel("show"),N.tooltipTimer.cancel("dismiss"),N.tooltipTimer.schedule("hide",ba,function(){q.oui.tooltipManager.hideTooltip()}))});this.on(a.event.MouseEvent.MOUSE_OVER,function(b){if(N.showToolTip){var c=b.feature,r=b.evt;N.tooltipTimer.cancel("hide");N.tooltipTimer.cancel("dismiss");N.tooltipTimer.schedule("show",Z,function(){if(N.showToolTip){var b=c.getTip();b&&0<b.length?(N.parentMap.graphics.oui.tooltipManager.showTooltip(r.target,
b,r.clientX,r.clientY),N.tooltipTimer.schedule("dismiss",Y,function(){q.oui.tooltipManager.hideTooltip()})):a.util.Logger.info("","layer.tooltipTimer.schedule","Tooltip string is not defined properly.")}})}})}var qa=function(b){var c=b.type;a.event.EventSource.setProcessedEventStatus(N,c,!0);var r=N.getTargetFeature(b.target),q=N.parentMap.getMapContext();if(!a.isNull(r)){var M=a.event.MouseEvent;if((c===M.MOUSE_CLICK||c===M.MOUSE_DOWN)&&2===b.button||c===M.TOUCH_LONG_PRESS)c=M.MOUSE_RIGHT_CLICK;
if(N.parentMap.enableMapAction.mouse){var L=new M(c,r);L.evt=b;L.mapContext=q;r.fire(c,L);L=new M(c,N);L.evt=b;L.feature=r;if((c===M.MOUSE_OVER||c===M.MOUSE_OUT)&&null!==b.relatedTarget){var J=N.getTargetFeature(b.relatedTarget);if(r===J)return}c===M.MOUSE_OVER?(N.hoverEnable&&N.hover(r),N.bringToTopFlag&&(r.getShapeIndex(),r.bringToTop())):c===M.MOUSE_OUT?(N.bringToTopFlag&&r.setShapeIndex(),N.hoverEnable&&N.deHover(r)):c!==M.MOUSE_CLICK||r.multi?c===M.TOUCH_END&&N.parentMap.enableMapAction.mouse?
(N.endFeatureDragging(b),b.stopPropagation()):c===M.MOUSE_UP&&"overview_rectangle"===L.feature.id&&!0===L.feature.dragging&&(N.endFeatureDragging(b),b.stopPropagation()):N.handleVectorMouseClick(oa,N,r);b.type===M.TOUCH_TAP&&N.handleVectorTouchTap(oa,N,r,"touch tapped");L.mapContext=q;setTimeout(function(){N.fire(c,L)},a.event.MouseEvent.DELAY_MILI_SEC)}}};q.attachEventListener(r.MOUSE_OVER,qa,this.group);q.attachEventListener(r.MOUSE_OUT,qa,this.group);var la=function(b){if(2!==b.button){N.lastMouseDown=
N.parentMap.getCursorLocation();var c=N.getTargetFeature(b.target);c&&(c&&c.editable?(N.focusFeature=c,c.startDrag(b,!0)):c&&c.draggable?(N.selectFeature(c),N.focusFeature=c,c.startDrag&&(c.startDrag(b,!0),c.dragStartListener&&(b.markerX=c.getMarkerX(),b.markerY=c.getMarkerY(),b.markerSRID=c.getMarkerSRID(),c.dragStartListener.call(this,b)))):c&&a.notNull(c.parentFeature)&&(N.focusFeature=c.parentFeature,c.parentFeature.startDrag(b,!1)),N.curTopFeature=c)}};a.browser.touchSupported&&(q.attachEventListener(r.TOUCH_TAP,
qa,this.group),q.attachEventListener(r.TOUCH_LONG_PRESS,qa,this.group),q.attachEventListener(r.TOUCH_END,qa,this.group),q.attachEventListener(r.TOUCH_START,function(b){b.preventDefault();var c=a.util.DomUtil;1==c.getTouchCount(b)&&(b.button=0,c=c.getTouchesClientPosition(b),b.clientX=c.x,b.clientY=c.y,la(b))},this.group));q.attachEventListener(r.MOUSE_CLICK,qa,this.group);q.attachEventListener(r.MOUSE_RIGHT_CLICK,qa,this.group);q.attachEventListener(r.MOUSE_UP,qa,this.group);q.attachEventListener(r.MOUSE_DOWN,
qa,this.group);q.attachEventListener(a.event.MouseEvent.MOUSE_DOWN,la,this.group);q.attachEventListener(r.MOUSE_MOVE,qa,this.group);N.draggingFeature=function(b){if(a.notNull(N.focusFeature)&&(N.focusFeature.featureDragging(b),N.focusFeature.draggingListener)){var c=N.focusFeature.parentLayer.parentMap.getMapContext(),r=c.getUniverse().getZoomLevels(0)[c.getZoomLevel()],c=(N.focusFeature.mouseLocX-N.focusFeature.startX)*r.resolution,r=-(N.focusFeature.mouseLocY-N.focusFeature.startY)*r.resolution;
b.markerX=N.focusFeature.getMarkerX()+c;b.markerY=N.focusFeature.getMarkerY()+r;b.markerSRID=N.focusFeature.getMarkerSRID();N.focusFeature.draggingListener.call(this,b)}};N.draggingFeature_touch=function(b){var c=a.util.DomUtil.getTouchesPosition(b);b.pageX=c.x;b.pageY=c.y;N.draggingFeature(b)};N.draggingFeature_win8Touch=function(a){a.pageX=a.gesture.touches[0].pageX;a.pageY=a.gesture.touches[0].pageY;N.draggingFeature(a)};this.parentMap.$oracleMapDiv.mousemove(N.draggingFeature);if(a.gv.isWin8Touch)a.Hammer(this.parentMap.$oracleMapDiv[0]).on("drag",
N.draggingFeature_win8Touch);this.parentMap.$oracleMapDiv.bind("touchmove",N.draggingFeature_touch);N.endFeatureDragging=function(b){if(a.notNull(N.focusFeature)){var c=N.focusFeature;c.endDragOrietation?(b.focusFeature=c,c.endDragOrietation(b)):(c.endDrag(b),c.dragEndListener&&(b.markerX=c.getMarkerX(),b.markerY=c.getMarkerY(),b.markerSRID=c.getMarkerSRID(),c.draggingListener?setTimeout(function(){c.dragEndListener.call(this,b)},100):c.dragEndListener.call(this,b)));a.notNull(N.curTopFeature)&&(c.focusProperties(N.curTopFeature),
N.curTopFeature=null);N.focusFeature=null}};N.endFeatureDragging_touch=function(b){var c=a.util.DomUtil.getTouchesPosition(b);b.pageX=c.x;b.pageY=c.y;N.endFeatureDragging(b)};a.$(document).mouseup(N.endFeatureDragging);a.$(document).mouseout(N.endFeatureDragging);this.parentMap.$oracleMapDiv.bind("touchend",N.endFeatureDragging_touch);this.orgWidth=c;this.orgHeight=b;if(this.type!==a.layer.VectorLayer.TYPE_PREDEFINED&&this.type!==a.layer.VectorLayer.TYPE_JDBC&&this.type!==a.layer.VectorLayer.TYPE_DATAPACK&&
this.type!==a.layer.VectorLayer.TYPE_GEORSS&&this.type!==a.layer.VectorLayer.TYPE_MAPBOX||this.boundingTheme&&this.loadedBoundingTheme)if(this.setWindow(),this.checkVisible())this.displayFeatures();else{var oa=new a.event.LayerEvent(a.event.LayerEvent.FINISH_LOAD,this);oa.mapContext=this.parentMap.getMapContext();this.initTask.complete();this.initTask=null;this.fire(a.event.LayerEvent.FINISH_LOAD,oa)}else this.setWindow(),this.refreshImpl()},redrawFeature:function(a){this.removeFeature(a);this.addFeature(a)},
setWindow:function(){var a=this.parentMap.getMapContext(),b=a.getUniverse(),c=b.getZoomLevels();c&&(c=c[a.getZoomLevel()],b=b.bound,this.minX=b.getMinX(),this.minY=b.getMinY(),this.windowW=b.getWidth(),this.windowH=b.getHeight(),this.orgDraggbleGroupPos=this.parentMap.graphics.getLeftTop(this.parentMap.draggableGroup),a=a.getCenterPoint(),this.parentMap.graphics.setLeftTop(this.group,0,0),b=this.orgWidth*this.xRatio*c.resolution,c=this.orgHeight*this.yRatio*c.resolution*c.stretchRatio,this.dataBufferWindow=
{x:a.getX()-b/2,y:a.getY()-c/2,w:b,h:c})},refresh:function M(b,c){a.isNull(c)&&(c=!0);M.base.call(this,b,c);this.reloadNumber=Math.round(1E10*Math.random());this.refreshImpl(b,c)},emptyCustomLayer:function(){var b=this.getCustomLayerDiv();0<b.length&&b.children().each(function(b,c){a.$(c).data("f").displayed=!1;a.$(c).remove()})},refreshImpl:function(b,c,q){if(!a.isNull(this.group)){var N=b&&b.type===a.event.MapEvent.MAP_BEFORE_REFRESH?b.bigPan:!1;c?(N||(this.loaded=!1),this.clearFeatureShapes(),
this.clearAllLabels(),N||(this.dataLoaded=!1)):b&&null!==b.beforeZoomLevel&&null!==b.afterZoomLevel&&b.beforeZoomLevel!==b.afterZoomLevel?this.setWindow():this.loadOnDemand?(this.loaded=!1,this.clearFeatureShapes(),this.clearAllLabels(),this.dataLoaded=!1):this.clearAllLabels();if(this.checkVisible()){b=this.parentMap.getMapContext();var Z=b.getUniverse(),N=Z.getZoomLevels()[b.getZoomLevel()],ba=b.getCenterPoint();b=this.orgWidth*this.xRatio*N.resolution;N=this.orgHeight*this.yRatio*N.resolution*
N.stretchRatio;this.dataBufferWindow={x:ba.getX()-b/2,y:ba.getY()-N/2,w:b,h:N};this.emptyCustomLayer();var Y=this,Z=Z.getSRID(),ba=null;if(this.loadOnDemand){var ba=this.visibleBound?Math.max(this.dataBufferWindow.x,this.visibleBound.getMinX()):this.dataBufferWindow.x,qa=this.visibleBound?Math.max(this.dataBufferWindow.y,this.visibleBound.getMinY()):this.dataBufferWindow.y;b=this.visibleBound?Math.min(this.dataBufferWindow.x+b,this.visibleBound.getMaxX()):this.dataBufferWindow.x+b;N=this.visibleBound?
Math.min(this.dataBufferWindow.y+N,this.visibleBound.getMaxY()):this.dataBufferWindow.y+N;ba=new a.geometry.Rectangle(ba,qa,b,N,Z)}(this.loadOnDemand||!this.dataLoaded&&this.type!==a.layer.VectorLayer.TYPE_LOCAL)&&!1!==q?(a.isNull(this.boundingDataTask)&&(this.boundingDataTask=this.startNewTask()),a.isNull(Y.getDataRequest)&&this.getThemeData(ba,function(){a.notNull(Y.boundingDataTask)&&(Y.boundingDataTask.complete(),Y.boundingDataTask=null);Y.mapping=!1;Y.renderingStyle instanceof a.style.BucketStyle&&
!Y.renderingStyle.isServerSide&&Y.renderingStyle.generateBuckets(Y.featureArray,Y.styleAttributes,!0);Y.displayFeatures(c)})):this.displayFeatures(c)}else q=a.event,b=new q.MapEvent(q.LayerEvent.FINISH_LOAD,this),b.mapContext=this.parentMap.getMapContext(),null!==this.initTask&&(this.initTask.complete(),this.initTask=null),this.fire(q.LayerEvent.FINISH_LOAD,b)}},delayDisplayFeatures:function(a){var b=this,c=function(a){0<b.loadingStyle?setTimeout(c,100,a):b.displayFeatures(a)};c(a)},displayFeatures:function(b){a.util.Logger.finest(null,
"VectorLayer","["+this.name+"] displayFeatures called.");if(0<this.loadingStyle)this.delayDisplayFeatures(b);else{a.isNull(this.displayFeaturesTask)&&(this.displayFeaturesTask=this.startNewTask());this.loading=!0;this.loaded=!1;this.displayCount=0;a.util.Logger.fine("","OM.VectorLayers.displayFeatures","["+this.name+"] displaying Features");this.visualFilter&&(this.graphicFilter=this.parentMap.graphics.getGraphicFilter(this.visualFilter));var c=this.parentMap.graphics,q=!1;a.isNull(this.realGroup)&&
(q=!0,this.realGroup=c.createGroup(),this.realGroup.applyStyle({cursor:this.mouseCursor}),this.pointerSensitivity||this.realGroup.applyStyle({pointerSensitivity:!1}));this.graphicFilter&&this.visualFilter.applyToLayer&&this.parentMap.graphics.applyStyle(this.realGroup,{filter:this.graphicFilter});this.renderingStyle&&"HeatMap"==this.renderingStyle.styleType?(this.displayHeatMap(),a.notNull(this.displayFeaturesTask)&&(this.displayFeaturesTask.complete(),this.displayFeaturesTask=null)):(c=this.parentMap.getMapContext().getZoomLevel(),
this.clustering&&c<=this.maxClusteringLevel&&this.vCluster.displayAsCluster(this.dataBufferWindow),this.mappingNSDP(),this.mfMarker&&(this.vmf||(this.vmf=new a.layer.VectorLayerMultiFeature(this),this.vmf.checkLocation()),this.vmf.display()),a.notNull(this.displayFeaturesTask)&&this.displayFeaturesTask.update(.65),this.displayBatch(0,q,this,b))}},displayBatch:function(b,r,q,N){a.util.Logger.finest(null,"VectorLayer","["+this.name+"] displayBatch called with start\x3d"+b+".");if(q.group){q.renderingStyle&&
q.renderingStyle instanceof a.style.BucketStyle&&(!q.styleAttributes||0===q.styleAttributes.length)&&(!q.nsdpTitleArray||1>q.nsdpTitleArray.length)&&a.util.Logger.warning("MAPVIEWER_9042","OM.layer.VectorLayer.displayBatch","");var Z,ba=q.featureArray?q.featureArray.length:0;a.util.Logger.finest(null,"VectorLayer","["+this.name+"] feature count: "+ba+".");var Y=q.parentMap.getMapContext().getUniverse().getSRID(),qa,la,oa=a.util.BaiduUtil.SRID,wa=function(b){return function(){var c=b.getGeometry(),
J=function(J){var r=a.notNull(J.mbr)?J.mbr:a.notNull(J.getMBR)?J.getMBR():null;b.srid=Y;b.geo=J;if(la.labelBox){J=b.labelBox;J=new a.geometry.LineString([J[0],J[1],J[2],J[3]],c.srid);var x=function(a){a=a.coordinates;b.labelBox=[a[0],a[1],a[2],a[3]];q.display(b,r)};Y!==oa?J.transform(Y,x):J.transform(Y,x,null,null,{map:q.parentMap})}else q.display(b,r)};Y!==oa?c.transform(Y,J):c.transform(Y,J,null,null,{map:q.parentMap})}()},da=function(){ia(qa,!1,q,N)};a.notNull(q.featureArray)&&a.util.Logger.finest("",
"OM.VectorLayer.displayBatch","Number of features in layer: "+q.featureArray.length);console&&console.time&&"finest"===a.gv.getLogLevel()&&a.util.Logger.finest("","OM.VectorLayer.displayBatch",console.time("["+this.name+"] displayFeatures"));for(qa=b;qa<ba;qa+=1)if(la=q.featureArray[qa],(la.displayed||la.multi)&&1==q.parentMap.getMapContext().getWholeMapNum()||a.notNull(la.activeIdx)&&la.activeIdx!==this.areaIdx||la.inCluster)la.removeGhostShape();else{if(q.enableBatch&&(q.displayCount++,q.displayCount>
q.numberInBatch)){if(r)q.group.appendChild(q.realGroup);else for(;b<=qa;b++)la=q.featureArray[b],la.displayed&&la.startAnimation();q.displayCount=0;var ia=q.displayBatch;c.setTimeout(da,1E3);return}var x=la.geo;la.displayed&&(la.shapeArray?la.shapeArray.push(la.shape):la.shapeArray=[la.shape]);Y!==x.srid?wa(la):this.type!==a.layer.VectorLayer.TYPE_LOCAL?("Circle"===x.type&&(x=la.getGeometry()),Z=null,q.loadOnDemand||x.mbr||(Z=x.coordinates?a.geometry.Geometry.calculateMBR(x.coordinates,x.type):a.geometry.Geometry.calculateGeomCollectionMBR(x.geometries,
x.type),x.mbr=new a.geometry.Rectangle(Z.minX,Z.minY,Z.maxX,Z.maxY,x.srid)),q.display(la,x.mbr)):(Z=a.notNull(x.mbr)?x.mbr:a.notNull(x.getMBR)?x.getMBR():null,q.display(la,Z))}q.displayed=!0;console&&console.timeEnd&&"finest"===a.gv.getLogLevel()&&a.util.Logger.finest("","OM.VectorLayer.displayBatch",console.timeEnd("["+this.name+"] displayFeatures"));r&&q.group.appendChild(q.realGroup);for(qa=b;qa<ba;qa++)la=q.featureArray[qa],la.displayed&&la.startAnimation();q.displayEnd(N)}},displayEnd:function(b){a.util.Logger.finest(null,
"VectorLayer","["+this.name+"] displayEnd called.");this.bringSelectedFeaturesToTop();this.getShadowArea();var c=this.parentMap.getMapContext(),q=c.getWholeMapNum();if(1<q){var N=c.getBaseWholeMapIndex();a.isNull(this.areaIdx)&&(this.areaIdx=0);this.featureGroupArr||(this.featureGroupArr=[]);this.featureGroupArr.push(this.realGroup);var Z=c.getUniverse().getZoomLevels()[c.getZoomLevel()].resolution,ba=c.getUniverse().getMapBounds().getWidth(),c=(c.getCenterPoint().getX()-c.getRoundMapCenterPoint().getX())/
Z;this.realGroup.translate((this.areaIdx-N)*ba/Z-c,0);this.areaIdx++;if(this.areaIdx<q){this.realGroup=this.parentMap.graphics.createGroup();this.lineGroup=null;this.realGroup.applyStyle({cursor:this.mouseCursor});this.pointerSensitivity||this.realGroup.applyStyle({pointerSensitivity:!1});this.displayBatch(0,!0,this,!1);return}}q=this.parentMap.getMapContext().getZoomLevel();this.clustering&&q<=this.maxClusteringLevel&&this.vCluster.showClusterInWrapAround();a.util.Logger.finest("","OM.VectorLayer.displayEnd",
"["+this.name+"] display features completed");this.loading=!1;q=a.event.LayerEvent;N=this.parentMap.getMapContext();null!==this.initTask&&(this.initTask.complete(),this.initTask=null);a.notNull(this.displayFeaturesTask)&&(this.displayFeaturesTask.complete(),this.displayFeaturesTask=null);Z=new q(q.FINISH_LOAD,this);Z.mapContext=N;this.fire(q.FINISH_LOAD,Z);Z=new q(q.FEATURES_DISPLAYED,this);Z.mapContext=N;this.fire(q.FEATURES_DISPLAYED,Z);b&&(Z=new q(q.FEATURES_DISPLAYED,this),Z.mapContext=this.parentMap.getMapContext(),
this.fire(q.AFTER_REFRESH,Z))},display:function(b,c,q){var N=this.dataBufferWindow;if(a.notNull(c)&&(c.getMaxX()<N.x||c.getMaxY()<N.y||c.getMinX()>N.x+N.w||c.getMinY()>N.y+N.h))if(this.parentMap.wraparound){var Z=this.parentMap.getMapContext().getUniverse().getMapBounds().getWidth();if(!(a.notNull(c)&&c.getMaxX()<N.x&&c.getMaxX()+Z>N.x||a.notNull(c)&&c.getMinX()>N.x+N.w&&c.getMinX()-Z<N.x+N.w))return}else return;if(!(a.notNull(c)&&this.visibleBound&&(c.getMinX()>this.visibleBound.getMaxX()||c.getMinY()>
this.visibleBound.getMaxY()||c.getMaxX()<this.visibleBound.getMinX()||c.getMaxY()<this.visibleBound.getMinY())||this.mapping&&!b.mapping&&!this.nsdp.fullDisplay)){b.group=this.realGroup;b.screenTransformObj=this.parentMap.getMapContext().getTransform();b.screenPoints=null;b.graphics=this.graphics?this.graphics:this.parentMap.graphics;b.parentLayer=this;var ba=this.getFeatureStyles(b);b.oldStyle=null;b.hover=!1;b.selected&&(b.oldStyle=ba,b.selected&&this.selectionStyle&&(c={},"PulseAnimation"===this.selectionStyle.styleType||
"AnimationColor"===this.selectionStyle.styleType?(c=b.shape,b.displayFeature([this.selectionStyle],null,q),b.selectShape=b.shape,b.shape=c,c=b.oldStyle):c=this.getHoverSelectStyle(this.selectionStyle,b),ba=c,this.parentMap.wraparound&&(b.renderingStyle=ba)));null!==ba?(b.setRenderingStyle(ba),ba=[ba]):ba=[];this.otherStyles&&(ba=ba.concat(this.otherStyles));if(0===ba.length)if(c=this.getDefaultRenderingStyle(b.geo.type))ba.push(c),b.setRenderingStyle(c);else return;ba=b.getAllStyles(ba);a.notNull(this.labelingStyle)?
a.isNull(b.getLabelingStyle())&&b.setLabelingStyle(this.labelingStyle):!b.labelStyle&&b.labelStyleName&&(c=a.style.StyleStore.getServerSideStyle(this.dataSource,b.labelStyleName),b.setLabelingStyle(c));var Y=this,qa=function(){if("Marker"!==ba[0].styleType||!ba[0].src||null!==ba[0].width&&null!==ba[0].height)if(b.displayFeature(ba,null,q),b.startAnimation(),Y.selectVisualFilter&&b.selected){var a=Y.parentMap.graphics.getGraphicFilter(Y.selectVisualFilter);Y.parentMap.graphics.applyStyle(b.shape,{filter:a})}else Y.graphicFilter&&
!Y.visualFilter.applyToLayer&&b.shape&&Y.parentMap.graphics.applyStyle(b.shape,{filter:this.graphicFilter});else setTimeout(qa,300)};qa()}},mappingNSDP:function(){if(!this.mapping&&(this.nsdpTitleArray&&(this.attrNames?(this.nsdpTitleArray[0].toUpperCase()==this.nsdpKey&&this.nsdpTitleArray.shift(),this.attrNames=this.attrNames.concat(this.nsdpTitleArray)):this.nsdpTitleArray[0].toUpperCase()==this.nsdpKey&&(this.attrNames=this.nsdpTitleArray.slice(1))),this.nsdpData&&this.nsdpKey)){for(var b=this.featureArray?
this.featureArray.length:0,c=0;c<b;c++){var q=this.featureArray[c],N=this.getNsdpDataForFeature(q);if(a.notNull(N)){a.$.extend(q.attributes,N);q.columns=[];for(var Z in N)q.columns.push(Z);q.mapping=!0}else q.mapping=!1}this.mapping=!0;b=a.event.LayerEvent;c=new b(b.NSDP_MAPPED,this);this.fire(b.NSDP_MAPPED,c)}},getNsdpDataForFeature:function(b){var c=null;a.notNull(b.attributes)&&(c=b.getAttributeValue(this.nsdpKey));a.isNull(c)&&(c=b.id);var c=this.nsdp.ignoreCase?c.toUpperCase():c,q=this.nsdpData[c];
a.isNull(q)&&(c=b.attributes._LABEL_,a.notNull(c)&&(c=this.nsdp.ignoreCase?c.toUpperCase():c,q=this.nsdpData[c]));return q},clearNSDP:function(){if(this.nsdpTitleArray){var a=this.nsdpTitleArray.length;this.attrNames.splice(this.attrNames.length-a,a);if(this.nsdpData&&this.mapping){for(var b=this.featureArray?this.featureArray.length:0,c=0;c<b;c++){var N=this.featureArray[c];if(N.mapping)for(var Z=0;Z<a;Z++)N.attributes[this.nsdpTitleArray[Z].toUpperCase()]=null;N.mapping=!1}this.mapping=!1}}},isValidId:function(a){for(var b=
this.featureArray?this.featureArray.length:0,c=0;c<b;c++)if(this.featureArray[c].id==a)return!1;return!0},getFeature:function(a){for(var b=this.featureArray?this.featureArray.length:0,c=0;c<b;c++)if(this.featureArray[c].id==a)return this.featureArray[c];return null},getFeaturesByAttribute:function(a,b){var c,N,Z,ba=!1,Y,qa,la,oa=this.featureArray?this.featureArray.length:0;if(0===oa)return null;a=a.toUpperCase();this.getAttributeNames().forEach(function(b){a===b.toUpperCase()&&(ba=!0)});if(!ba)return null;
var wa=b instanceof Array;wa&&(la=b.length);c=[];for(Z=0;Z<oa;Z++)if(N=this.featureArray[Z],(qa=N.getAttributeValue(a))&&wa)for(Y=0;Y<la;Y++)b[Y]===qa&&c.push(N);return c},getAllThemeData:function(a,b){this.getThemeData(null,a,b)},sendHttpRequest:function(b,c,q,N,Z,ba,Y){return a.util.HttpRequest.send(b,c,q,N,Z,ba,Y)},getThemeData:function(b,c,q){if(!this.usedInOverview)if(this.initError)c();else if(this.type===a.layer.VectorLayer.TYPE_GEORSS)this.getGeoRss(b,c,q);else if(this.type!==a.layer.VectorLayer.TYPE_LOCAL&&
this.loadOnDemand&&a.isNull(this.sessionId))this.getSessionId(b,c);else{a.notNull(this.getDataRequest)&&this.getDataRequest.abort();this.loading=!0;var N=this,Z=this.serverURL;this.type!==a.layer.VectorLayer.TYPE_DATAPACK&&(Z+="/dataserver/"+this.dataSource);var ba={};N.lastEvent=a.event.LayerEvent.VECTOR_LAYER_LOADING_THEME;(N.type===a.layer.VectorLayer.TYPE_PREDEFINED||N.type===a.layer.VectorLayer.TYPE_JDBC)&&N.parentMap&&a.notNull(N.boundingDataTask)&&N.boundingDataTask.update(.5);var Y=this.parentMap;
Y&&Y.applicationID&&(ba.applicationID=Y.applicationID);this.options&&(this.options.simplify&&(ba.simplify=this.options.simplify,this.options.threshold&&(ba.threshold=this.options.threshold),this.options.simplifyAlgorithm&&(ba.simplifyAlgorithm=this.options.simplifyAlgorithm)),this.options.dadp&&(ba.dadp=this.options.dadp));this.type===a.layer.VectorLayer.TYPE_PREDEFINED?(ba.t=this.themeName,a.notNull(this.workspace)&&(ba.workspace=this.workspace)):this.type===a.layer.VectorLayer.TYPE_JDBC&&(a.notNull(this.workspace)&&
(ba.workspace=this.workspace),ba.t=this.name,ba.sql=this.sql,this.keyColumn&&(ba.id_col=this.keyColumn),this.baseTable&&(ba.base_table=this.baseTable),this.geometryColumn&&(ba.geom_col=this.geometryColumn),this.jdbcSrid&&(ba.jdbc_srid=this.jdbcSrid));a.$.extend(ba,this.queryParameter);if(b)if(b.srid===a.util.BaiduUtil.SRID){var qa=new BMap.Pixel(b.getMinX(),b.getMinY());b=new BMap.Pixel(b.getMaxX(),b.getMaxY());qa=Y.bdutil.project.pointToLngLat(qa);Y=Y.bdutil.project.pointToLngLat(b);ba.bbox=qa.lng+
","+qa.lat+","+Y.lng+","+Y.lat}else ba.bbox=b.getMinX()+","+b.getMinY()+","+b.getMaxX()+","+b.getMaxY();Y=a.util.HttpRequest.getDomain(this.serverURL);Y||(Y=a.util.HttpRequest.localDomain);if(Y=a.gv.mvKeyMap[Y])ba.key=Y;this.type!==a.layer.VectorLayer.TYPE_DATAPACK&&(ba.include_label_box="true",Y=null,this.parentMap&&(Y=this.parentMap.getMapContext().getUniverse().getSRID()),Y&&(Y===a.util.BaiduUtil.SRID?(ba.to_srid=8307,ba.bbox_srid=8307):(ba.to_srid=Y,ba.bbox_srid=Y)),this.sessionId&&(ba.ssid=this.sessionId),
this.nsdp&&(ba.nsdp=this.getNSDPString()));this.type!==a.layer.VectorLayer.TYPE_DATAPACK&&(ba.refresh=Math.round(1E5*Math.random()));var Y=N.type===a.layer.VectorLayer.TYPE_DATAPACK?!0:!1,la=function(b){N.initError=!0;N.getDataRequest=null;b&&a.util.Logger.alert("MAPVIEWER_9006","OM.layer.VectorLayer.getThemeData",b.responseText);q&&q();b=a.event;var c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,N);a.notNull(N.parentMap)&&(c.mapContext=N.parentMap.getMapContext());null!==N.initTask&&(N.initTask.abort(),
N.initTask=null);N.fire(b.LayerEvent.INIT_ERROR,c)};this.enableXHR&&(ba.$enableXHR=!0);qa=this.jsonp?"jsonp":"text";a.util.Logger.fine("","VectorLayer.getThemeData","["+N.name+"] Sending data loading request.");this.getDataRequest=this.sendHttpRequest(Z,ba,function(b){if(N.parentMap&&N.parentMap.graphics){N.dataLoaded=!0;var q,da=!1;"string"===typeof b&&(N.lastEvent=a.event.LayerEvent.VECTOR_LAYER_PARSING_THEME,a.notNull(N.boundingDataTask)||(N.boundingDataTask=N.startNewTask()),N.boundingDataTask.update(.75),
b=b.trim(),da=0===b.indexOf("{")||0===b.indexOf("["));try{"object"!==typeof b&&(b=a.$.parseJSON(b))}catch(ia){a.notNull(N.boundingDataTask)&&N.boundingDataTask.abort();da&&a.util.Logger.warning(null,"OM.layer.VectorLayer.getThemeData",ia);try{b=a.$(a.$.parseXML(b));var x=b.find("oms_error");if(0<x.length){a.util.Logger.alert("MAPVIEWER_9007","OM.layer.VectorLayer.getThemeData",x.text());la();return}q=new a.layer.KMLParser(N);var B=q.parse(b,c);B||(q=new a.layer.GeoRSSParser(N),B=q.parse(b,c),B||(a.util.Logger.alert("MAPVIEWER_9008",
"OM.layer.VectorLayer.getThemeData"),la()));return}catch(M){la();return}}N.getDataRequest=null;try{q=new a.layer.GeoJSONParser(N);q.parse(b,c,la);a.notNull(N.boundingDataTask)&&(N.boundingDataTask.complete(),N.boundingDataTask=null);var J=new a.event.LayerEvent(a.event.LayerEvent.FEATURES_LOADED,N);N.fire(a.event.LayerEvent.FEATURES_LOADED,J)}catch(K){a.util.Logger.warning("MAPVIEWER_9101","OM.layer.VectorLayer.getThemeData",K.message),la()}}},qa,la,Y)}},getGeoRss:function(b,c,q){if(this.initError)c();
else{this.loading=!0;var N=this;b=this.serverURL;var Z=function(b){N.initError=!0;N.getDataRequest=null;b&&a.util.Logger.alert("MAPVIEWER_9008","OM.layer.VectorLayer.getThemeData",b.responseText);q&&q();b=a.event;var c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,N);c.mapContext=N.parentMap.getMapContext();N.fire(b.LayerEvent.INIT_ERROR,c)};this.attrNames=["link","updated","content","summary"];this.getDataRequest=this.sendHttpRequest(b,{},function(b){var M=a.$(b).find("oms_error");0<M.length?(a.util.Logger.alert("MAPVIEWER_9008",
"OM.layer.VectorLayer.getThemeData",M.text()),Z()):(new a.layer.GeoRSSParser(N)).parse(b,c,q)||Z()},"xml",Z,!0,!0)}},isBoundingTheme:function(){return this.boundingTheme},loadBoundingTheme:function(b){var c=this,q=this.parentMap.getMapContext();this.orgWidth=this.orgWidth?this.orgWidth:q.getDeviceWidth();this.orgHeight=this.orgHeight?this.orgHeight:q.getDeviceHeight();var N=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,this);a.notNull(this.boundingDataTask)&&(this.boundingDataTask=this.startNewTask());
var Z=c.renderingStyle&&c.renderingStyle.hasBinding(),ba=a.notNull(c.nsdpData)&&a.notNull(c.nsdpKey),q=function(q){q||(q=(q=c.getExtent())?q.coordinates:null,(Z||ba)&&a.notNull(c.bfMbr)&&(q=c.bfMbr.coordinates));q?(c.dataLoaded=!0,b?b(q[0],q[1],q[2],q[3]):(N.bbox=[q[0],q[1],q[2],q[3]],N.mapContext=c.parentMap.getMapContext(),c.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,N),a.notNull(c.boundingDataTask)&&(c.boundingDataTask.complete(),c.boundingDataTask=null))):(c.dataLoaded=!1,Y())},Y=function(){c.loadedBoundingTheme=
!0;a.util.Logger.warning("MAPVIEWER_9049","OM.layer.VectorLayer.loadBoundingTheme",c.name);var q=c.parentMap.getMapContext(),Y=q.getUniverse().getMapBounds();b?b(Y.getMinX(),Y.getMinY(),Y.getMaxX(),Y.getMaxY()):(N.bbox=[Y.getMinX(),Y.getMinY(),Y.getMaxX(),Y.getMaxY()],N.mapContext=q,a.notNull(c.boundingDataTask)&&(c.boundingDataTask.abort(),c.boundingDataTask=null),c.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,N))},qa;this.mbr?(qa=this.mbr,q([qa.getMinX(),qa.getMinY(),qa.getMaxX(),qa.getMaxY()])):!this.loadOnDemand&&
this.dataLoaded||this.type===a.layer.VectorLayer.TYPE_LOCAL?(qa=this.getExtent(),(Z||ba)&&a.notNull(this.bfMbr)&&(qa=this.bfMbr),a.isNull(qa)&&(qa=this.parentMap.getMapContext().getUniverse().getMapBounds()),q([qa.getMinX(),qa.getMinY(),qa.getMaxX(),qa.getMaxY()])):this.getAllThemeData(q,Y)},calculateCenterAndZoomLevel:function(b,c,q,N){var Z=this.parentMap.getMapContext(),ba=Z.getUniverse();if(0===b&&0===c&&0===q&&0===N)return[Z.getZoomLevel(),Z.getCenterPoint()];if(this.type===a.layer.VectorLayer.TYPE_LOCAL)N=
this.getExtent(),this.renderingStyle&&this.renderingStyle.hasBinding()&&a.notNull(this.bfMbr)&&(N=this.bfMbr),a.isNull(N)&&(N=this.parentMap.getMapContext().getUniverse().getMapBounds()),b=N.getMinX(),c=N.getMinY(),q=N.getMaxX(),N=N.getMaxY();else if(a.isNull(this.mbr)){var Y=ba.getSRID();this.mbr=new a.geometry.Rectangle(b,c,q,N,Y)}for(var Y=(q-b)/Z.getDeviceWidth(),Z=(N-c)/Z.getDeviceHeight(),qa=ba.getZoomLevels(),la=ba.getZoomLevelNumber(),oa=null,wa=0;wa<la;wa++)if(Y>qa[wa].resolution||Z>qa[wa].resolution*
qa[wa].stretchRatio){oa=0===wa?0:wa-1;break}a.isNull(oa)&&(oa=a.gv.pointZoomLevel===a.gv.MID_ZOOM?Math.floor(la/2):la-1);this.loadedBoundingTheme=!0;this.boundingZoomLevel=oa;return[oa,new a.geometry.Point((b+q)/2,(c+N)/2,ba.getSRID())]},getLayerConfig:function(){var b=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,this);b.mapContext=this.parentMap.getMapContext();this.initTask=this.startNewTask();this.initTask.update(.25);this.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,b)},setCenterAndZoomlevel:function(a){this.refreshImpl(a,
!1)},recenter:function(a){if(this.displayed){var b=this.dataBufferWindow,c=b.x+b.w/2,N=b.y+b.h/2,b=this.parentMap.getMapContext(),Z=b.getUniverse(),ba=b.getRoundMapCenterPoint(),Y=b.getCenterPoint(),Z=Z.getZoomLevels()[b.getZoomLevel()];this.refreshCenterX||(this.refreshCenterX=c);c=this.parentMap.wraparound?Math.abs(ba.getX()-this.refreshCenterX)/Z.resolution:Math.abs(Y.getX()-c)/Z.resolution;N=Math.abs(Y.getY()-N)/Z.resolution*Z.stretchRatio;Y=(this.orgHeight*this.yRatio-this.orgHeight)/2;(this.orgWidth*
this.xRatio-this.orgWidth)/2<c||Y<N?(this.clearFeatureShapes(),this.featureGroupArr?this.featureGroupArr.length=0:this.featureGroupArr=[],this.parentMap.wraparound&&(this.refreshCenterX=b.getRoundMapCenterPoint().getX()),this.loaded=!1,this.areaIdx=0,this.refreshImpl(a,!1)):this.refreshShadowGeom()}else this.parentMap&&this.parentMap.initialized&&(this.loaded=!1,this.refreshImpl(a,!1))},checkVisible:function(){return this.isInZoomLevelRange()&&this.isVisible()?!0:!1},clearFeatureShapes:function(){this.parentMap.graphics.clearGroup(this.group);
for(var b=(this.featureArray?this.featureArray.length:0)-1;0<=b;b--){var c=this.featureArray[b];c.clearAnimation();c.animations=null;c.moveAnimation&&(this.parentMap.wraparound?c.stopMoveAnimation():c.pauseMoveAnimation());c.group=null;c.screenTransformObj=null;c.graphics=null;c.displayed=!1;c.inCluster=!1;c.markerSize=null;if(c.shapeGroup){for(var q=c.shapeGroup.length,N=0;N<q;N++)c.shapeGroup[N].feature=null;c.shapeGroup=null}else c.shape&&(this.parentMap.graphics.remove(c.shape),c.shape.feature=
null,c.shape=null);c.labelShape&&(c.labelShape.feature=null);c.labelShape=null;c.ghostShape&&(c.ghostShape.feature=null);c.ghostShape=null;c.ghostGeom=null;a.notNull(c.shapeArray)&&(c.shapeArray=null);a.notNull(c.chartGroup)&&(c.chartGroup=null)}this.featureGroupArr=this.labelGroup=this.realGroup=this.lineGroup=null;this.vCluster&&this.vCluster.clearAllClusterFeatures();this.heatMap&&(b=a.$(this.getHeatmapDivId()),0<b.length&&b.empty());this.areaIdx=0;this.emptyCustomLayer();this.displayed=!1;this.tileFeatureGroup=
{}},getCustomLayerDiv:function(){var b=this.getCustomLayerDivId(),c=a.$("#"+b);0>=c.length&&a.notNull(this.parentMap)&&(b=a.$("\x3cdiv id\x3d'"+b+"' style\x3d'position:absolute;'\x3e"),b.css({display:"block",left:"0px",top:"0px",width:"0px",height:"0px","z-index":5}),this.parentMap.$topLayerDIV.append(b),b.on("mouseout",function(a){a.stopPropagation()}),c=b);return c},getHeatmapDivId:function(){return"#"+this.getDivId("heatmap_")},getCustomLayerDivId:function(){return this.getDivId("customDiv")},
getDivId:function(a){return(a+this.parentMap.mapInstanceId+"_"+this.name).replace(/([ #;?%&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")},showInfoWindow:function(b,c){var q="",N=b.attributes;if(N||this.type===a.layer.VectorLayer.TYPE_LOCAL){var Z=0,ba,Y;if(b.InfoHtml)q=b.InfoHtml;else if(this.attrNames&&0<this.attrNames.length){for(var qa=this.attrNames.length,la=[],oa=0;oa<qa;oa++){ba=this.attrNames[oa];var wa=ba.toUpperCase();Y="#bbbbbb";0===Z%2&&(Y="#dddddd");"_LABEL_"!=wa&&b.attributes[wa]&&-1===la.indexOf(wa)&&
(Z++,(da=b.attributes[wa])?"string"!==typeof da||a.util.DomUtil.isHtml(da)||(da=da.replace(/\s/g,"\x26nbsp;")):da="",q+="\x3ctr bgcolor\x3d'"+Y+"'\x3e\x3ctd align\x3d'right'\x3e"+ba+"\x3c/td\x3e\x3ctd align\x3d'left'\x3e"+da+"\x3c/td\x3e\x3c/tr\x3e",la.push(wa))}q="\x3ctable cellspacing\x3d'2' style\x3d'margin: auto;border-spacing: 2px;border-collapse: separate;'\x3e"+q+"\x3c/table\x3e"}else if(this.type===a.layer.VectorLayer.TYPE_DATAPACK||this.type===a.layer.VectorLayer.TYPE_LOCAL){for(ba in b.attributes){var da=
b.attributes[ba];da&&("string"===typeof da&&(da=da.replace(/\s/g,"\x26nbsp;")),Y="#bbbbbb",0===Z%2&&(Y="#dddddd"),Z++,"_LABEL_"!==ba&&(q+="\x3ctr bgcolor\x3d'"+Y+"'\x3e\x3ctd align\x3d'right'\x3e"+ba+"\x3c/td\x3e\x3ctd align\x3d'left'\x3e"+da+"\x3c/td\x3e\x3c/tr\x3e"))}if(0===Z)return;q="\x3ctable cellspacing\x3d'2' style\x3d'margin: auto;border-spacing: 2px;border-collapse: separate;'\x3e"+q+"\x3c/table\x3e"}else return;Z={};b.label?(N=(b.label+"").replace(/ /g,"\x26nbsp;"),Z.title=N):N&&a.notNull(N._LABEL_)&&
(N=(b.attributes._LABEL_+"").replace(/ /g,"\x26nbsp;"),Z.title=N);N=this.parentMap;c||(c=N.getCursorLocation());Z.id=this.name+"_"+b.id;a.notNull(c)?N.displayInfoWindow(c,q,Z):N.displayInfoWindow(b.getGeometry(),q,Z)}},getSessionId:function(a,b){var c=this;this.sendHttpRequest(this.serverURL+"/dataserver/"+this.dataSource,{get_session_id:"yes"},function(N){c.sessionId=N;c.getThemeData(a,b)},"text")},removeGraphics:function(){this.clearSelectedFeatures();if(this.group){var a=this.parentMap.graphics;
this.clearFeatureShapes();a.remove(this.group);this.group=null}},changeVisibleBound:function(){this.type!=a.layer.VectorLayer.TYPE_PREDEFINED||this.loadOnDemand||this.clearFeatureShapes();this.refreshImpl()},changeOpacity:function(){this.parentMap&&this.parentMap.graphics&&this.parentMap.graphics.applyStyle(this.group,{opacity:this.opacity})},getNSDPXML:function(){if(!this.nsdp)return"";var a;a='\x3cns_data_provider provider_id\x3d"defaultNSDP"\x3e'+('\x3cfor_theme name\x3d"'+this.name+'"/\x3e');
a+='\x3cjoin spatial_key_column\x3d"'+this.nsdpKey+'"/\x3e';a+="\x3cparameters\x3e";this.nsdp.xml?a+='\x3cparameter name\x3d"xml" value\x3d"'+this.nsdp.xml.replace(/</g,"\x26lt;")+'"/\x3e':this.nsdp.url&&(a+='\x3cparameter name\x3d"xml_url" value\x3d"'+this.nsdp.url+'"/\x3e');return a+="\x3c/parameters\x3e\x3c/ns_data_provider\x3e"},selectAllFeatures:function(){for(var a=this.featureArray?this.featureArray.length:0,b=0;b<a;b++){var c=this.featureArray[b];this.selectionEnable&&!c.selected&&(c.oldStyle||
(c.oldStyle=c.renderingStyle),c.setRenderingStyle(this.selectionStyle),this.selectedFeatures?this.selectedFeatures.push(c):this.selectedFeatures=Array(c),c.selected=!0)}return null},addMarkerBoundToGrid:function(){var b=this.getFeatureGeometryType();if(""!==b&&"LINESTRING"!==b&&"POLYGON"!==b){for(var b=this.featureArray?this.featureArray.length:0,c=0;c<b;c++){var q=this.featureArray[c];if(q.displayed&&q.screenPoints){var N=q.screenPoints.x,Z=q.screenPoints.y,ba,Y;q.markerSize?(ba=q.markerSize.w,Y=
q.markerSize.h):(Y=q.renderingStyle?q.renderingStyle:this.otherStyles&&0<this.otherStyles.length?this.otherStyles[0]:this.getDefaultRenderingStyle(q.geo.type),a.notNull(Y.lengthUnit)?(ba=Y.realWidthInPx?Y.realWidthInPx:Y.width,Y=Y.realHeightInPx?Y.realHeightInPx:Y.height):(ba=Y.realWidth?Y.realWidth:Y.width,Y=Y.realHeight?Y.realHeight:Y.height),q.markerSize={w:ba,h:Y});this.parentMap.grid.insert([N-ba/2,Z-Y/2,N+ba/2,Z+Y/2])}}this.vCluster&&this.vCluster.addClusterFeatureToLabelGrid()}},addLabels:function(){if(this.group){var a=
this.featureArray?this.featureArray.length:0,b=this.parentMap.getMapContext(),c=b.getWholeMapNum(),N=b.getBaseWholeMapIndex();this.labelGroupArray?this.labelGroupArray.length=0:this.labelGroupArray=[];for(var Z=0;Z<c;Z++)if(this.labelGroup||(this.labelGroup=this.parentMap.graphics.createGroup({opacity:this.opacity,visibility:!0}),this.group.appendChild(this.labelGroup)),1<c){var ba=b.getUniverse().getZoomLevels()[b.getZoomLevel()].resolution,Y=b.getUniverse().getMapBounds().getWidth(),qa=(b.getCenterPoint().getX()-
b.getRoundMapCenterPoint().getX())/ba;this.labelGroup.translate((Z-N)*Y/ba-qa,0);this.labelGroupArray||(this.labelGroupArray=[]);this.labelGroupArray.push(this.labelGroup);this.labelGroup=null}this.shadow&&this.getShadowArea();1<c&&(this.labelGroup=this.labelGroupArray[0]);for(b=0;b<a;b++)if(N=this.featureArray[b],!N.labelShape&&(N.addLabel(this.parentMap.grid),N.labelShape))for(N.labelShapeArr=[],Z=1;Z<c;Z++)if(ba=this.parentMap.graphics.cloneText(N.labelShape))ba.applyStyle({cursor:this.mouseCursor}),
ba.feature=N,this.labelGroupArray[Z].appendChild(ba),N.labelShapeArr.push(ba)}},clearAllLabels:function(){this.mask=null;this.labelGroup&&this.parentMap.graphics.clearGroup(this.labelGroup);if(this.labelGroupArray){for(var a=0;a<this.labelGroupArray.length;a++)this.parentMap.graphics.clearGroup(this.labelGroupArray[a]);this.labelGroupArray.length=0}for(var a=this.featureArray?this.featureArray.length:0,b=0;b<a;b++){var c=this.featureArray[b];c.labelShape&&(c.labelShape.feature=null,c.labelShape=null)}},
enableDisplayInBatch:function(a,b){if(this.enableBatch=a)this.batchInterval=b&&b.interval?b.interval:200,this.numberInBatch=b&&b.numberInBatch?b.numberInBatch:100},enableClustering:function(b,c){if(this.clustering=b)this.vCluster=new a.layer.VectorLayerCluster(this,c),a.notNull(c)?a.notNull(c.clickBehavior)&&"select"===c.clickBehavior?this.vClusterClickToZoomToMBR=!1:this.vClusterClickToZoomToMBR=!0:this.vClusterClickToZoomToMBR=!0;this.maxClusteringLevel=c&&c.maxClusteringLevel?c.maxClusteringLevel:
100;this.clickZoomInLevels=-1;c&&!1===c.enableZoomIn?this.clickZoomInLevels=0:c&&c.zoomInLevels&&(this.clickZoomInLevels=parseInt(c.zoomInLevels))},getFeatureIndex:function(a){var b=this.featureArray.length;if(0===b)return-1;for(var c=0;c<b;c++)if(this.featureArray[c]==a)return c+1;return-1},bringFeatureForward:function(a){var b=a.parentLayer.parentMap.getMapContext().getGraphics();if(a.displayed&&a.shape){if(a.shapeGroup&&1<a.shapeGroup.length)for(var c=0;c<a.shapeGroup.length;c++)b.bringForward(a.shapeGroup[c]);
else b.bringForward(a.shape);a.labelShape&&b.bringForward(a.labelShape)}},sendFeatureBackward:function(a){var b=a.parentLayer.parentMap.getMapContext().getGraphics();if(a.displayed&&a.shape)if(a.labelShape&&b.sendBackward(a.labelShape),a.shapeGroup&&1<a.shapeGroup.length)for(var c=0;c<a.shapeGroup.length;c++)b.sendBackward(a.shapeGroup[c]);else b.sendBackward(a.shape)},bringFeatureToTop:function(a){var b=a.parentLayer.parentMap.getMapContext().getGraphics();if(a.displayed&&a.shape){if(a.shapeGroup&&
1<a.shapeGroup.length)for(var c=0;c<a.shapeGroup.length;c++)b.bringToTop(a.shapeGroup[c]);else b.bringToTop(a.shape);a.labelShape&&b.bringToTop(a.labelShape)}},sendFeatureToBottom:function(a){var b=a.parentLayer.parentMap.getMapContext().getGraphics();if(a.displayed&&a.shape)if(a.labelShape&&b.sendToBottom(a.labelShape),a.shapeGroup&&1<a.shapeGroup.length)for(var c=0;c<a.shapeGroup.length;c++)b.sendToBottom(a.shapeGroup[c]);else b.sendToBottom(a.shape)},getTargetFeature:function(b){if(a.isNull(b))return null;
for(var c=b.feature;a.isNull(c)&&b.parentNode;)b=b.parentNode,c=b.feature;return c},getLineGroup:function(){if(!this.lineGroup){this.lineGroup=[];for(var a=this.parentMap.graphics,b=0;4>b;b++)this.lineGroup[b]=a.createGroup(),this.realGroup.appendChild(this.lineGroup[b])}return this.lineGroup},redraw:function(a){var b=this.parentMap.getMapContext();this.orgWidth=b.getDeviceWidth();this.orgHeight=b.getDeviceHeight();this.setWindow();this.clearFeatureShapes();this.refreshImpl(null,null,a)},calculateLayerGradientBound:function(){var a=
this.parentMap.getMapContext(),b=a.getUniverse(),c=a.getMapCenter(),b=b.getZoomLevels()[a.getZoomLevel()],a=(c.getX()-this.minX)/b.resolution,c=(c.getY()-this.minY)/b.resolution/b.stretchRatio;return{x1:a-this.orgWidth/2,y1:c-this.orgHeight/2,x2:a+this.orgWidth/2,y2:c+this.orgHeight/2,useObjectBoundingBox:!1}},clearLayer:function(){this.removeGraphics();var b=this.featureArray?this.featureArray.length:0;if(this.type===a.layer.VectorLayer.TYPE_LOCAL)for(--b;0<=b;b--)this.featureArray[b].deleteAllListeners();
else this.featureArray=null;this.transform=null;this.dataLoaded=!1;this.bfMbr=this.mbr=this.vCluster=null;this.vmf&&(this.vmf.destroy(),this.vmf=null);this.draggingFeature&&(this.parentMap.$oracleMapDiv.unbind("mousemove",this.draggingFeature),this.parentMap.$oracleMapDiv.unbind("touchmove",this.draggingFeature_touch),a.Hammer(this.parentMap.$oracleMapDiv[0]).off("drag",this.draggingFeature_win8Touch));this.draggingFeature=null;this.endFeatureDragging&&(a.$(document).unbind("mouseup",this.endFeatureDragging),
a.$(document).unbind("mouseout",this.endFeatureDragging),this.parentMap.$oracleMapDiv.unbind("touchend",this.endFeatureDragging_touch));this.toolTipCustomizer=this.endFeatureDragging=null},destroy:function r(){this.clearLayer();r.base.call(this)},addSecondaryStyle:function(a){this.parentMap&&this.isServerSideStyle(a,"secondary")||(this.otherStyles?this.otherStyles.push(a):this.otherStyles=[a])},removeSecondaryStyle:function(a){if(null===this.otherStyles)return null;for(var b=this.otherStyles.length,
c=0;c<b;c++)if(this.otherStyles[c]===a)return this.otherStyles.splice(c,1),a;return null},setVisibleImpl:function(){a.isNull(this.parentMap)||(this.heatMap&&a.$(this.getHeatmapDivId()).toggle(this.visible),this.getCustomLayerDiv().toggle(this.visible),this.group&&this.parentMap&&this.parentMap.graphics&&this.parentMap.graphics.applyStyle(this.group,{display:this.visible}),this.visible&&this.parentMap&&this.parentMap.displayed&&!this.displayed&&(this.type===a.layer.VectorLayer.TYPE_LOCAL||this.dataLoaded||
this.initError?this.displayFeatures():this.refresh(null,!1)),this.parentMap&&this.parentMap.displayed&&this.parentMap.refreshVectorLayerLabels())},clone:function q(b,c,ba){var Y=q.base.call(this,b);Y.getDataRequest=null;Y.boundingTheme=!1;Y.sessionId=null;this.renderingStyle&&"HeatMap"==this.renderingStyle.styleType&&this.renderingStyle.containerVectorLayer&&(Y.renderingStyle=this.renderingStyle.clone(),Y.renderingStyle.containerVectorLayer=Y.renderingStyle.containerVectorLayer.clone("over_"+Y.renderingStyle.containerVectorLayer.name,
!0,!0),Y.heatMap=null);if(Y.displayed||Y.dataLoaded)for(Y.featureArray=[],b=this.featureArray.length,c=0;c<b;c++)ba=this.featureArray[c].clone(),ba.parentLayer=Y,Y.featureArray.push(ba);else c&&(Y.usedInOverview=!0,Y.containerLayer=ba,b=a.event,Y.copyFeatures=function(a){a=a.target;Y.featureArray=[];for(var b=a.featureArray.length,c=0;c<b;c++){var q=a.featureArray[c].clone();Y.featureArray.push(q)}Y.dataLoaded=!0;Y.containerLayer||Y.displayFeatures()},this.on(b.LayerEvent.FEATURES_LOADED,Y.copyFeatures));
Y.displayed=!1;Y.group=null;Y.realGroup=null;Y.labelGroup=null;Y.lineGroup=null;Y.graphics=null;return Y},displayHeatMap:function(){this.loaded=!1;var b=this.featureArray?this.featureArray.length:0,c=this.parentMap.getMapContext(),Z=c.getUniverse().getSRID(),ba=c.getTransform();this.yRatio=this.xRatio=1.2;this.setWindow();var Y=this.orgWidth*this.xRatio,qa=this.orgHeight*this.yRatio,la=ba.toScreenPoint(this.dataBufferWindow.x,this.dataBufferWindow.y+this.dataBufferWindow.h);this.heatMap||(this.heatMap=
new a.layer.VectorLayerHeatMap(this.renderingStyle,this));this.styleAttributes&&0<this.styleAttributes.length&&(this.heatMap.isValued=!0);a.style.Style.calculateStyleSize(this.renderingStyle,c);this.heatMap.init(Y,qa,la.x,la.y,this.renderingStyle.spotlightRadius);for(var oa=this,wa=0,c=function(a){return function(){da.transform(Z,function(b){wa--;a.srid=Z;a.geo=b;oa.addFeatureToHeatMap(a,la)})}()},ba=0;ba<b;ba++){var Y=this.featureArray[ba],da=Y.getGeometry();if(this.type===a.layer.VectorLayer.TYPE_MAPBOX){if("POINT"!==
this.getFeatureGeometryType())continue}else if("Point"!=da.type&&"OrientedPoint"!=da.type&&"MultiPoint"!=da.type&&"OrientedMultiPoint"!=da.type)continue;Z!==da.srid?(wa++,c(Y)):oa.addFeatureToHeatMap(Y,la)}var ia=function(b){var c="heatmap_"+oa.parentMap.mapInstanceId+"_"+oa.name,J=a.$("#"+c);0===J.length?(J=a.$("\x3cdiv id\x3d'"+c+"' style\x3d'position:absolute;'\x3e"),oa.parentMap.$heatMapDiv.append(J)):J.empty();oa.renderingStyle.isTop?oa.parentMap.$heatMapDiv.css({"z-index":"5"}):oa.parentMap.$heatMapDiv.css({"z-index":"2"});
J.css({display:"block",left:"0px",top:"0px",width:oa.orgWidth+"px",height:oa.orgHeight+"px"});var c=oa.parentMap.getMapContext(),q=c.getUniverse(),x=c.getZoomLevel(),x=q.getZoomLevels()[x],da=c.getCenterPoint(),q=(oa.dataBufferWindow.x-da.getX())/x.resolution+c.getDeviceWidth()/2,c=(da.getY()-oa.dataBufferWindow.y-oa.dataBufferWindow.h)/x.resolution/x.stretchRatio+c.getDeviceHeight()/2;b.style.cssText="position:absolute;left:"+q+"px;top:"+c+"px;";J[0].appendChild(b);oa.displayed=!0;a.util.Logger.finest("",
"OM.VectorLayer.displayHeatMap","["+oa.name+"] display heat map completed");oa.displayEnd()},x=function(){0!==wa||oa.heatMap.loadingBoundaray?setTimeout(x,100):oa.heatMap.drawHeatMap(ia)};x()},addFeatureToHeatMap:function(b){b.parentLayer=this;var c=1,c=b.geo;if(!a.isNull(c)){var Z=[c];"GeometryCollection"===c.type&&(Z=a.notNull(c.geometries)&&0<c.geometries.length?c.geometries:null);if(!a.isNull(Z)){var ba=this.parentMap.getMapContext().getTransform(),c=a.notNull(this.styleAttributes)&&0<this.styleAttributes.length?
Number(b.getAttributeValue(this.styleAttributes[0])):this.renderingStyle.getDataValueFromBinding(b);if(isNaN(c)||a.isNull(c))c=1;for(var Y=this.dataBufferWindow,qa,la,oa=this.parentMap.getMapContext().getZoomLevel(),wa=0;wa<Z.length;wa++){var da=Z[wa];if("Point"===da.type||"OrientedPoint"===da.type){if(qa=da.coordinates[0],la=da.coordinates[1],!(qa<Y.x||la<Y.y||qa>Y.x+Y.w||la>Y.y+Y.h)){if(b.tiledFeature&&(da=b.zoomLevelsGeomClipArea["zoomlevel_"+oa][wa],qa<da.getMinX()||qa>da.getMaxX()||la<da.getMinY()||
la>da.getMaxY()))continue;qa=ba.toHeatMapPoint(qa,la,0,0,this.heatMap.scale);this.heatMap.addData(qa.x,qa.y,c)}}else if("MultiPoint"==da.type||"OrientedMultiPoint"==da.type)for(var ia=da.coordinates.length,x=0;x<ia;x++)if(qa=da.coordinates[x][0],la=da.coordinates[x][1],!(qa<Y.x||la<Y.y||qa>Y.x+Y.w||la>Y.y+Y.h)){if(b.tiledFeature){var B=b.zoomLevelsGeomClipArea["zoomlevel_"+oa][wa];if(qa<B.getMinX()||qa>B.getMaxX()||la<B.getMinY()||la>B.getMaxY())continue}qa=this.screenTransformObj.toHeatMapPoint(qa,
la,0,0,this.heatMap.scale);this.heatMap.addData(qa.x,qa.y,c)}}}}},pan:function(){if(!a.isNull(this.parentMap)&&this.displayed){var b=this.parentMap.getMapContext(),c=b.getCenterPoint(),Z=this.dataBufferWindow.x+this.dataBufferWindow.w/2-c.getX(),c=this.dataBufferWindow.y+this.dataBufferWindow.h/2-c.getY(),b=b.getTransform(),Z=b.toScreenXLength(Z),c=b.toScreenYLength(-c);this.heatMap&&(b=a.$(this.getHeatmapDivId()),0<b.length&&b.css({left:Z,top:c}));b=this.getCustomLayerDiv();0<b.length&&b.css({left:Z,
top:c})}},getHoverSelectStyle:function(b,c){if("Color"!=b.styleType)return b;var Z=c.oldStyle,ba=c.geo.type;if(Z.resolve){var Y=Z.resolve(c);Y&&(Z=Y)}Y={};"Marker"!=Z.styleType||"Point"!=ba&&"MultiPoint"!=ba&&"OrientedPoint"!=ba&&"OrientedMultiPoint"!=ba?"Line"!=Z.styleType||"LineString"!=ba&&"MultiLineString"!=ba?"LinearGradient"==Z.styleType||"RadialGradient"==Z.styleType?(a.$.extend(Y,Z,b.origConfig),Y.stops1&&(Y.stops=Y.stops1)):(a.$.extend(Y,Z,b.origConfig),Y.bindings=b.bindings):(ba={},a.$.extend(ba,
Z,b.origConfig),Y=new a.style.Line(ba)):Z.vectorDef&&0<Z.vectorDef.length&&Z.vectorDef[0].style?(a.$.extend(!0,Y,Z),a.$.extend(Y.vectorDef[0].style,b.origConfig),Y.bindings=[]):Y=b;return Y},setToolTipCustomizer:function(a){a&&"function"===typeof a&&(this.toolTipCustomizer=a)},enableToolTip:function(a){this.showToolTip=a;this.displayed&&this.redraw()},enableIndicatorFeatures:function(a,b){if(this.shadow=a)this.setLabelsVisible(!0),this.leadLine=b&&b.leadLine?b.leadLine:!1,this.maxIndicators=b&&b.maxIndicators?
b.maxIndicators:8,0===b.maxIndicators&&(this.maxIndicators=0),this.shadowLev={},this.shadowLev.min=b&&b.enabledZoomLevels&&b.enabledZoomLevels.min?b.enabledZoomLevels.min:0,this.shadowLev.max=b&&b.enabledZoomLevels&&b.enabledZoomLevels.max?b.enabledZoomLevels.max:9,this.indicatorSize={},this.indicatorSize.w=b&&b.indicatorSize&&b.indicatorSize.width/10?b.indicatorSize.width/10:4,this.indicatorSize.h=b&&b.indicatorSize&&b.indicatorSize.height/10?b.indicatorSize.height/10:3,this.indicatorPos=b&&b.position?
b&&b.position:3,"object"!=typeof this.indicatorPos&&(this.shadowAnchor=this.indicatorPos)},getShadowArea:function(){if(this.shadow){this.ghostNum=-1;var b=this.parentMap.getMapContext(),c=b.getUniverse(),Z,ba;if(b.getZoomLevel()<=this.shadowLev.max&&b.getZoomLevel()>=this.shadowLev.min){if(1===this.shadowAnchor||3===this.shadowAnchor)Z=b.getDeviceWidth()/2-5,ba=b.getDeviceHeight()/2;if(4===this.shadowAnchor||6===this.shadowAnchor)Z=b.getDeviceWidth()/2-5,ba=b.getDeviceHeight()/2-10;var Y=b.getZoomLevel();
Z*=c.getZoomLevels()[Y].resolution;ba=ba*c.getZoomLevels()[Y].resolution*c.getZoomLevels()[Y].stretchRatio;this.transformLon=10*c.getZoomLevels()[Y].resolution;this.transformLat=10*c.getZoomLevels()[Y].resolution*c.getZoomLevels()[Y].stretchRatio;b=b.getCenterPoint();Y=Math.round(this.maxIndicators/2);1===this.shadowAnchor?this.shadowArea=new a.geometry.Rectangle(b.getX()-Z,b.getY()+ba,b.getX()-Z+this.indicatorSize.w*this.transformLon,b.getY()+ba+this.indicatorSize.h*this.transformLat,c.srid):3===
this.shadowAnchor?this.shadowArea=new a.geometry.Rectangle(b.getX()+Z-this.indicatorSize.w*this.transformLon,b.getY()+ba,b.getX()+Z,b.getY()+ba+this.indicatorSize.h*this.transformLat,c.srid):4===this.shadowAnchor?this.shadowArea=new a.geometry.Rectangle(b.getX()+Z-this.indicatorSize.w*this.transformLon,b.getY()-ba+Y*this.indicatorSize.h*this.transformLat+Y*this.transformLat,b.getX()+Z,b.getY()-ba+Y*this.indicatorSize.h*this.transformLat+Y*this.transformLat+this.indicatorSize.h*this.transformLat,c.srid):
6===this.shadowAnchor?this.shadowArea=new a.geometry.Rectangle(b.getX()-Z,b.getY()-ba+Y*this.indicatorSize.h*this.transformLat+Y*this.transformLat,b.getX()-Z+this.indicatorSize.w*this.transformLon,b.getY()-ba+Y*this.indicatorSize.h*this.transformLat+Y*this.transformLat+this.indicatorSize.h*this.transformLat,c.srid):this.indicatorPos&&this.indicatorPos instanceof a.geometry.Point&&(this.shadowArea=new a.geometry.Rectangle(this.indicatorPos.getX(),this.indicatorPos.getY(),this.indicatorPos.getX()+this.indicatorSize.w*
this.transformLon,this.indicatorPos.getY()+this.indicatorSize.h*this.transformLat))}else this.shadowArea=null}},createShadowGeometry:function(b){if(!this.shadowArea)return null;var c=this.maxIndicators,Z=b.getGeometry(),ba=Z.getMBR();if(Z.getType()===a.GeomTypes.POLYGON||Z.getType()===a.GeomTypes.MULTIPOLYGON||Z.mbr){var Y=this.parentMap.getMapContext().getQueryWindow();if(!(ba.getMaxX()>Y.getMaxX()||ba.getMinX()<Y.getMinX()||ba.getMinY()<Y.getMinY()||ba.getMaxY()>Y.getMaxY())){this.ghostNum++;var qa;
if(0!==c){if(this.ghostNum<Math.round(c/2)||this.leadLine&&this.ghostNum<c)qa=new a.geometry.Rectangle(this.shadowArea.getMinX(),this.shadowArea.getMinY()-(this.indicatorSize.h+1)*this.transformLat,this.shadowArea.getMaxX(),this.shadowArea.getMaxY()-(this.indicatorSize.h+1)*this.transformLat,Z.srid);else if(this.ghostNum==Math.round(c/2)&&1!==c){if(3==this.shadowAnchor||4==this.shadowAnchor)qa=new a.geometry.Rectangle(this.shadowArea.getMinX()-(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMinY(),
this.shadowArea.getMaxX()-(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMaxY(),Z.srid);1!=this.shadowAnchor&&6!=this.shadowAnchor&&this.shadowAnchor||(qa=new a.geometry.Rectangle(this.shadowArea.getMinX()+(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMinY(),this.shadowArea.getMaxX()+(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMaxY(),Z.srid))}else Math.round(c/2)<this.ghostNum&&this.ghostNum<c&&(qa=new a.geometry.Rectangle(this.shadowArea.getMinX(),
this.shadowArea.getMinY()+(this.indicatorSize.h+1)*this.transformLat,this.shadowArea.getMaxX(),this.shadowArea.getMaxY()+(this.indicatorSize.h+1)*this.transformLat,Z.srid));this.shadowArea=qa;this.addToRtree(b,qa);return qa}}}},refreshShadowGeom:function(){if(this.shadow&&this.showLabels){var a=this.featureArray,b=a.length;this.getShadowArea();for(var c=0;c<b;c++){var ba=a[c];if(ba.displayed&&ba.label&&(ba.removeGhostShape(),!ba.labelShape)){var Y=this.createShadowGeometry(ba);Y&&(ba.drawGhostGeom(Y,
[ba.renderingStyle]),ba.drawGhostLabel(Y))}}}},createRtree:function(){if(!a.notNull(this.rtree)){console&&console.time&&"finest"===a.gv.getLogLevel()&&a.util.Logger.finest("","OM.VectorLayer.createRtree",console.time("start of createRtree"));this.rtree=new a.RTree(10);for(var b=this.featureArray.length,c=0;c<b;c++)this.addToRtree(this.featureArray[c]);console&&console.timeEnd&&"finest"===a.gv.getLogLevel()&&a.util.Logger.finest("","OM.VectorLayer.createRtree",console.timeEnd("end of createRtree"))}},
searchFeatures:function(b){return a.isNull(this.rtree)||a.isNull(b)?null:this.rtree.search(b)},setQueryParameters:function(){if(!(0>=arguments.length)){this.queryParameter={paramnum:arguments.length};for(var b=0;b<arguments.length;b++)if(a.isNull(arguments[b]))this.queryParameter["param"+(b+1)]=null;else{var c=arguments[b];if("object"!==typeof c)this.queryParameter["param"+(b+1)]=c;else if(c instanceof a.geometry.Geometry)this.queryParameter["param"+(b+1)]=c.toString(),this.queryParameter["paramtype"+
(b+1)]="geometry";else{if(a.isNull(c.type)){var Z=a.util.ValidationUtil;"object"===typeof c.value?Z.isNumberArray(c.value)?c.type="narray":c.type="sarray":Z.isNumber2(c.value)?c.type="number":c.type="string"}a.isNull(c.sqlType)&&("sarray"===c.type?c.sqlType="MV_STRINGLIST":"narray"===c.type&&(c.sqlType="MV_NUMBERLIST"));"sarray"===c.type?this.queryParameter["param"+(b+1)]='"'+c.value.join('","')+'"':"narray"===c.type&&(this.queryParameter["param"+(b+1)]=c.value.join(","));this.queryParameter["sqltype"+
(b+1)]=c.sqlType;this.queryParameter["paramtype"+(b+1)]=c.type}}}},setMultiFeatureMarker:function(a){this.mfMarker=a},getFeatureStyles:function(b){var c=null,c=this.renderingStyle?this.renderingStyle:b.styleName?a.style.StyleStore.getServerSideStyle(this.dataSource,b.styleName):b.oldStyle?b.oldStyle:b.renderingStyle;if(this.loadOnDemand)for(var Z=this.selectedFeatures.length,ba=0;ba<Z;ba++)this.selectedFeatures[ba].id==b.id&&(b.selected=!0,this.selectedFeatures[ba]=b);c&&c.stylelist&&1<c.stylelist.length&&
(b.lineGroup=this.getLineGroup());return c},getDefaultRenderingStyle:function(b){switch(b){case "Point":case "MultiPoint":case "OrientedPoint":case "OrientedMultiPoint":return a.style.StyleStore.defaultMarkerStyle;case "LineString":case "MultiLineString":return a.style.StyleStore.defaultLineStyle;case "Polygon":case "MultiPolygon":case "Rectangle":case "GeometryCollection":return a.style.StyleStore.defaultPolygonStyle}return null},setMouseCursorStyle:function(a){this.mouseCursor="object"===typeof a?
{definition:[{type:"image",src:a.src}],hotspotX:a.hotspotX,hotspotY:a.hotspotY}:a;this.realGroup&&this.realGroup.applyStyle({cursor:this.mouseCursor})},isServerSideStyle:function(b,c){if(!(b instanceof a.style.Style)&&b.dataSource&&b.name){var Z=this,ba=b.url;a.isNull(ba)&&(ba=this.type===a.layer.VectorLayer.TYPE_JDBC||this.type===a.layer.VectorLayer.TYPE_PREDEFINED||this.type===a.layer.VectorLayer.TYPE_MAPBOX?this.serverURL:this.parentMap.mapviewerURL);Z.loadingStyle++;a.style.StyleStore.getServerSideStyle(b.dataSource,
b.name,{url:ba,callback:function(b){Z.loadingStyle--;"rendering"===c?a.isNull(b)?Z.renderingStyle=b:Z.setRenderingStyle(b,Z.styleAttributes):"hover"===c?Z.setHoverStyle(b):"select"===c?Z.setSelectStyle(b):"secondary"===c?Z.otherStyles.push(b):"label"===c&&Z.setLabelingStyle(b)}});return!0}return!1},getAttributeType:function(b){if("string"!==typeof b)return null;var c=this.attributeTypes;b=b.toUpperCase();return c&&a.notNull(c[b])?c[b]:null},hasSharedBoundary:function(){return this.sharedBoundary},
setSharedBoundary:function(a){this.sharedBoundary=a},getFeatureAttributesInHTML:function(b){var c="",Z="";if(b.attributes||this.type===a.layer.VectorLayer.TYPE_LOCAL){var ba=0,Y;if(b.InfoHtml)Z=b.InfoHtml;else if(this.attrNames&&0<this.attrNames.length)for(var qa=this.attrNames.length,la=[],oa=0;oa<qa;oa++){Y=this.attrNames[oa];var wa=Y.toUpperCase(),c="\x3ctr bgcolor\x3d'#bbbbbb'\x3e\x3ctd colspan\x3d'2' align\x3d'left'\x3eLAYER NAME: "+this.name+"\x3c/td\x3e\x3c/tr\x3e";b.attributes[wa]&&-1===la.indexOf(wa)&&
((wa=b.attributes[wa])?"string"!==typeof wa||a.util.DomUtil.isHtml(wa)||(wa=wa.replace(/\s/g,"\x26nbsp;")):wa="",Z+="\x3ctr bgcolor\x3d'#dddddd'\x3e\x3ctd align\x3d'right'\x3e"+Y.toUpperCase()+"\x3c/td\x3e\x3ctd align\x3d'left'\x3e"+wa+"\x3c/td\x3e\x3c/tr\x3e",ba+=1)}else if(this.type===a.layer.VectorLayer.TYPE_DATAPACK||this.type===a.layer.VectorLayer.TYPE_LOCAL){c="\x3ctr bgcolor\x3d'#bbbbbb'\x3e\x3ctd colspan\x3d'2' align\x3d'left'\x3eLAYER NAME: "+this.name+"\x3c/td\x3e\x3c/tr\x3e";for(Y in b.attributes)if(wa=
b.attributes[Y])"string"===typeof wa&&(wa=wa.replace(/\s/g,"\x26nbsp;")),Z+="\x3ctr bgcolor\x3d'#dddddd'\x3e\x3ctd align\x3d'right'\x3e"+Y.toUpperCase()+"\x3c/td\x3e\x3ctd align\x3d'left'\x3e"+wa+"\x3c/td\x3e\x3c/tr\x3e",ba+=1;if(0===ba)return}return 0<Z.trim().length?c+Z.trim():null}},isInternalUtilLayer:function(){if("ii_oracle_maps_internal_editing"===this.name||"ii_oracle_maps_internal_others"===this.name)return!0},insertFeatureInfo:function(b){if(!a.isNull(b)&&!a.isNull(b.id)){var c=this.parentMap;
if(!0===this.getEnableInfoWindow()&&!a.isNull(b)&&!a.isNull(c)&&!a.notNull(c.vctinfoFeatures[b.id])){var Z=this.getFeatureAttributesInHTML(b);a.isNull(Z)||0>=Z.trim().length||(c.vctinfoHTMLArray.push(Z),c.vctinfoFeatures[b.id]=b.id)}}},deselectFeatures:function(){for(var a=this.selectedFeatures?this.selectedFeatures.length:0;0<a;a--){var b=this.selectedFeatures.pop();this.deselectFeature(b);b.enableFeatureEditing(!1);this.resetFeatureStates(b)}},handleVectorTouchTap:a.util.MiscUtil.oddNumberClick(function(b,
c,Z){c.selectionEnable&&!Z.cluster&&c.selectFeature(Z);c.featureEditable&&(a.event.EventSource.stopEvents[b.type]=!0);Z.parentFeature&&"OrientedPoint"===Z.parentFeature.getGeometry().type&&(b=Z.parentFeature,b.parentLayer.deselectFeature(b))}),handleVectorMouseClick:a.util.MiscUtil.oddNumberClick(function(b,c,Z){c.selectionEnable&&(Z.cluster?(a.isNull(c.vClusterClickToZoomToMBR)||!0!==c.vClusterClickToZoomToMBR)&&c.selectFeature(Z):c.selectFeature(Z));c.featureEditable&&a.notNull(b)&&a.notNull(b.type)&&
(a.event.EventSource.stopEvents[b.type]=!0);Z.parentFeature&&"OrientedPoint"===Z.parentFeature.getGeometry().type&&(b=Z.parentFeature,b.parentLayer.deselectFeature(b))})});a.layer.VectorLayer.SINGLE_SELECTION=0;a.layer.VectorLayer.MULTIPLE_SELECTION=1;a.layer.VectorLayer.TYPE_PREDEFINED=0;a.layer.VectorLayer.TYPE_JDBC=1;a.layer.VectorLayer.TYPE_DATAPACK=2;a.layer.VectorLayer.TYPE_LOCAL=3;a.layer.VectorLayer.TYPE_GEORSS=4;a.layer.VectorLayer.TYPE_WFS=5;a.layer.VectorLayer.TYPE_MAPBOX=6;a.layer.VectorLayer.ERROR_COUNT=
5;a.layer.MarkerLayer=a.layer.VectorLayer.extend({initialize:function N(b){N.base.call(this,b,{def:{type:a.layer.VectorLayer.TYPE_LOCAL}});this.markerStyle=new a.style.Marker({width:50,height:50,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAG3klEQVRoQ+2XaWwUZRzG37n26LWUAi0toi1IImhiggqioiEhqYkJH5SEIyECMSAYTCiKHAot5xflC2CQ+EFEjgBRULlrLeEoJKACBakNaaDHUloshXZLa3d8nndmyrZAod3tasgOeTvnzjy///P83xkU8ZgsymPCIWIg/zcnY47EHOmhCsSi1UOF7fZtY450u3Q99MOYI/6bzSMVoWWHW2BTtO5P87mKwr1PtxwpqWjcXXOrafSvl81eQphtGhTczZS7vK0prH0Fa1Med86HHn89U63rk+g5MiQjblw4MF0GKa9t/vzQ6bIZeQUivqG00NLcyRIMEqTjRdi3D7XUVYg18yY0jB3+5IYBKa6c7sJ0GaSkMlD88ffXhx4vPNBWZefhJsoO2VKkaartNYXAKArOWdZJyGfTVPHl/PEXhqR7h0UN5PK1pqq pm6rSLp46bD3TSlFbhSWAs++Ix76qqnYIuQNcRM5E5FRFFxneRrFj5RR/Vqqnf1RBpn3rT7tw6pD1TOiSuulCEBC2x9Yxxsp2BiCOA5Zr1oUm1unegNi1fHL0QaZvrkorPglH7D5HXe9xQfaFqt0VDyAnbmh96ZBc4E4GQHbkTYg+CKNFR6RYRsSxoYMDKsUzUkEahX8QLbd0AuJ3ckaDIx5EK/cdgLijGy2nR6QTVl5k88oYaYrMPY9JoXRFJo5rjdw4bzllOWaKAeiR7YvH+TOjDSKjVZR/1wlqoig6IsVqQtGgnk7ogCIEz2nctvuI7xU7XhlxAbF9wZv/Dcj5ol+cXhcaBEoAiKQ4RcU+QUzbAd2Q0FbjwzHu0xruIW7p7gax7ZOx/sx+RvSjdeEkQDiN2pU2IZKRsqJkOaKohnSDYPKY3SPsG4XXYvpV4F66+5bYkjM6+iCM1vmTBTIqrLEJwW1iIUw1AMA+oXgZM+zLbSt6ElZOEtbsxWbfPOdFgOjRdUT2yCl8njAamtvKOsSzoRXdJYXLinNtO8N9XAiD6AbiJd2y3iMZntti08znogtSWhW48v626if+IAgqyxlINVzSAUUHFPJP0TxmCkO6QwdUuBcEKB1QNDiCbzD2FN/uWQmNYsPUQVcH9dUHWtNZ15cuf2uV+gNb1hXenLh1D16IsicIABBUXzM8gHPJZlawVhgxVJ4QcsZizOx+ke8TvlDRN28NaRWzRidvHZyqT+o6gvWLLoNU1jUPr6hpyJ+xrc5XVXoa1adoCDbcEIxtwKgciJyAK4rtitXsgJIuBuWrR8Of3nFCZD+tiKkjvLmpPm1p1ED4IMJU1gTyZ+6s91WW/AZHLPEOhIZ9xkwwaoBT4ZhB4UiUm5Oa/EA2RYpXFa8NNsS7L+i5ZqBxfVpaYnVUQdpgapsAc9tXVXYJIF6hQbjq9iJdcRCPmAFCh3oPetztUoROGGzrIEnG6VcGGWLi8+FDdCtao RWTztTeyZ/9wx2fv7xMaG7kBECMFd1xGbqIhxX8EIlDGxFExydML1w26ilDZGcFVu/e/t3Xc+fOvt6JE+ykVox/7DW37/631P5hl3uk4wMlzI2W/A/2mL5qf4VQ3PFwxit0lyHi3Ypwo6O9hircaCOCJCNxI7J0MVQr2bgqd+HOfft++rsTCHzkiBaMAMYtjNsYTTZQO5iwQSji0tWal+pb4g/N39eadLW2QTridasiAeI9cIQghmoiTooYmamLlBtHdy7/bNHBM2eKbj4AgiIJ0YzRiMHrajEI3WC7E1EQFoJfgolr1m18Y1T25G9WFAQTSmuDMlLxBtzQAaGbom+cKiHiyg/uXbls4ZHic+dY4dDFEUYAB4KiCVGDwfjdsB3h+XZLOI44EAm4Y1+M1PdmzRkxPWd13hdHgt6yOlMkoi84S/VLUMXLgPBc+fngquVLjv1Z3A6CAM5g/jnu2E7U2wDXbAhG7B4IEoUDws8sJF4kY/SzYXpPmjJt2Jwla+etPx70XqkLiv5Jmng1SxMJ5XtDIZzoOI3sNDP7gRAUTAg6QDfqHuSEY0skQJJwsxSM3jZUAmCe+XDp2nlfnTC9w9I10af6wP5Vyz49evH8WcbEqTpFcybimr1AADYyIdjUBOFgvHj+npnKgQjXERaBriBAgvHy2YNgibt+PDzlL++otzPrC/esWLqg4OzZ31lVinaqTnEUTfEOABvbOUYwgnYK4MCE40joPRwgvCEEQZLGjHlz4EeLl4zPW5Sz/8SJY5xtKCpUNAWHgjgOPZLwUDfCdaTjvbjvAHmxTSiu+T50ZiEHxKn2fV9u97vxw45FwpEHARGKUzMXpy/uO+M8TOSjnO8pkEd5dkSviYFEtJwRuFnMkQgUMaK3iDkS0XJG4GaPjSP/Al31T1GL6r+HAAAAAElFTkSuQmCC",
yOffset:-12,xOffset:2,textStyle:{fontSize:15,fill:"#ffffff"},textOffset:{x:0,y:-15}});this.labelStyle=new a.style.Text({styleName:"defaultMMLabelStyle",fill:"#000000",fontStyle:a.style.Text.FONTSTYLE_ITALIC,fontSize:12,sticky:!1})},addMapMarker:function(b){a.isNull(b)||(a.isNull(b.renderingStyle)&&(b.renderingStyle=this.markerStyle.clone()),a.notNull(b.label)&&a.isNull(b.labelStyle)&&(b.labelStyle=this.labelStyle),a.notNull(b.markerTextStyle)&&(b.renderingStyle.textStyle=b.markerTextStyle),this.addFeature(b))},
removeMapMarker:function(a){this.removeFeature(a)},addMapMarkers:function(b){if(!a.isNull(b))for(var c=0;c<b.length;c++)this.addMapMarker(b[c])}});a.layer.BuiltinExternalTileLayer=a.layer.TileLayer.extend({initialize:function Z(b,c,qa){Z.base.call(this,b);this.layerType=a.LayerTypes.EXTERNAL;b=a.layer.BuiltinExternalTileLayer;c&&b.tileLayerConfigs&&b.tileLayerConfigs[c]&&(this.tileLayerConfig=b.tileLayerConfigs[c]);qa&&(this.customParameters=qa)},init:function(a){},pan:function(a,b){},setCenterAndZoomlevel:function(){var b=
a.event,c=new b.MapEvent(b.LayerEvent.FINISH_LOAD,this);c.mapContext=this.parentMap.getMapContext();this.fire(b.LayerEvent.FINISH_LOAD,c);this.setMapCenterAndZoomlevel()},setMapCenterAndZoomlevel:function(){},setMapType:function(a){},resize:function(){},setVisibleImpl:function(){if(this.container){var b=a.$(this.container);b.css("visibility",this.visible?"visible":"hidden");b.css("display",this.visible?"":"none")}this.visible&&this.parentMap.displayed&&this.init(this.container)},checkVisible:function(){if(!this.isVisible())return!1;
if(this.parentMap){var a=this.parentMap.getMapZoomLevel();if(a>=this.tileLayerConfig.zoomLevels.length||a<this.minVisibleLevel||a>this.maxVisibleLevel)return!1}return!0},setContainer:function(){var b=a.$("\x3cdiv id \x3d'tilelayer_"+this.name+"'\x3e\x3c/div\x3e");b.css({position:"absolute",left:"0px","z-index":this.getZIndex()-1,top:"0px",width:"100%",height:"100%",overflow:"hidden"});this.parentMap.$tileLayersDiv.append(b);var c=a.$("\x3cdiv id \x3d'transparent_tilelayer_"+this.name+"'\x3e\x3c/div\x3e");
c.css({position:"absolute",left:"0px","z-index":this.getZIndex(),top:"0px",width:"100%",height:"100%",background:"white",opacity:"0",overflow:"hidden"});b.append(c);this.container=b[0]},getLayerConfig:function(){var b=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,this);b.config=this.getEnabledConfig(this.tileLayerConfig);this.parentMap&&(b.mapContext=this.parentMap.getMapContext());var ba=this,Y=function(){ba.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,b);var c=a.event,wa=new c.MapEvent(c.LayerEvent.FINISH_LOAD,
ba);wa.mapContext=ba.parentMap.getMapContext();ba.fire(c.LayerEvent.FINISH_LOAD,wa)};if(a.isNull(ba.isBaiduMap)||!1===ba.isBaiduMap)Y();else var qa=1,la=c.setInterval(function(){a.notNull(ba.bdutil)?(a.notNull(ba.parentMap)&&(ba.parentMap.bdutil=ba.bdutil),Y(),clearInterval(la),a.util.Logger.finest("waited "+qa+" cycles")):(a.util.Logger.finest("waiting for baidu to load converter functions."),qa+=1,60<qa&&(clearInterval(la),a.utul.Logger.warning("","OM.layer.BuiltinExternalTileLayer.getLayerConfig",
"Failed to get Baidu Map transform utilities")))},1E3)},destroy:function(){this.mapTypeControl&&this.mapTypeControl.destroy();this.container&&a.$(this.container).empty().remove()},refresh:function ba(b,c){a.isNull(c)&&(c=!0);ba.base.call(this,b,c);this.reloadNumber=Math.round(1E10*Math.random());this.parentMap&&this.map&&this.setCenterAndZoomlevel();if(c){var la=new a.event.LayerEvent(a.event.LayerEvent.AFTER_REFRESH,this);this.parentMap&&(la.mapContext=this.parentMap.getMapContext());this.fire(a.event.LayerEvent.AFTER_REFRESH,
la)}},exportToSVG:function(a,b,c){var la=0,oa=0;this.maxWidth&&b>this.maxWidth?(la=(b-this.maxWidth)/2,b=this.maxWidth):this.minWidth&&b<this.minWidth&&(la=(this.minWidth-b)/2,b=this.minWidth);this.maxHeight&&c>this.maxHeight?(oa=(c-this.maxHeight)/2,c=this.maxHeight):this.minHeight&&c<this.minHeight&&(oa=(this.minHeight-c)/2,c=this.minHeight);var wa=this;wa.loadImg=0;var da=this.getStaticMapURL(b,c),ia=this.parentMap.graphics;wa.loadImg++;ia.drawImage({x:la,y:oa},{src:da,width:b,height:c},{group:a}).handleEvent=
function(a){this.resourceUpdate(a);wa.loadImg--};return a},drawTilesImages:function(a,b){var c=0,la=0;this.maxWidth&&a>this.maxWidth?(c=(a-this.maxWidth)/2,a=this.maxWidth):this.minWidth&&a<this.minWidth&&(c=(this.minWidth-a)/2,a=this.minWidth);this.maxHeight&&b>this.maxHeight?(la=(b-this.maxHeight)/2,b=this.maxHeight):this.minHeight&&b<this.minHeight&&(la=(this.minHeight-b)/2,b=this.minHeight);var oa=this;oa.loadImg=0;var wa=this.getStaticMapURL(a,b);oa.loadingImg=!0;var da=new Image;da.onload=function(){oa.loadingImg=
!1;oa.canvas.getContext("2d").drawImage(da,c,la)};da.onerror=function(){oa.loadingImg=!1;oa.canvas=null};da.src=wa},clone:function(b){var c={};a.$.extend(c,this);c.name=b?b:c.name+"_clone";c.deleteAllListeners();c.map=null;return c}});a.layer.BuiltinExternalTileLayer.register=function(b,c){var qa=a.layer.BuiltinExternalTileLayer;"undefined"===typeof qa.tileLayerConfigs&&(qa.tileLayerConfigs=[]);qa.tileLayerConfigs[b]=c};a.layer.BingTileLayer=a.layer.BuiltinExternalTileLayer.extend({initialize:function Y(b,
la){Y.base.call(this,b);this.key=la&&la.key?la.key:"your_bing_api_key";this.libURL=null;this.over=2<arguments.length?arguments[2]:!1;var oa=a.layer.BingTileLayer;this.over||"undefined"===typeof Microsoft||c.OM_finishLoadBingJsV7();this.over||oa.LOADEDJS||oa.LOADING||(oa.LOADING=!0,la&&la.libURL?(this.libURL=la.libURL,a.$.getScript(this.libURL+"\x26onscriptload\x3dOM_finishLoadBingJsV7")):a.$.getScript(a.gv.secureHttp()+"//ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v\x3d7.0\x26onscriptload\x3dOM_finishLoadBingJsV7"));
this.mapType=la&&la.mapType?la.mapType:oa.TYPE_ROAD;this.mapTypeList=la&&la.mapTypeList?la.mapTypeList:null;a.isNull(this.mapTypeList)&&(this.mapTypeList=la&&la.map_type_values?la.map_type_values:null);this.tileLayerConfig=a.layer.TileLayerConfig.CONFIG_GOOGLE;this.mapTypeVisible=la&&a.notNull(la.mapTypeVisible)?la.mapTypeVisible:!0;this.maxWidth=900;this.maxHeight=834;this.minHeight=this.minWidth=80},init:function(){if(this.container){var b=this,c,la=function(wa){if(b.parentMap){var da=b.parentMap.getMapContext(),
ia=function(x){x=a.notNull(x)?new Microsoft.Maps.Location(x.getY(),x.getX()):new Microsoft.Maps.Location(da.getCenterPoint().getY(),da.getCenterPoint().getX());b.checkMapType();try{if(b.map=new Microsoft.Maps.Map(wa,{credentials:b.key,center:x,mapTypeId:a.layer.BingTileLayer.TYPES[b.mapType],zoom:b.getRealZoomLevel(da.getZoomLevel())+1,animate:!1,labelOverlay:Microsoft.Maps.LabelOverlay.hidden,showDashboard:!1,showCopyright:!1,showScalebar:!1,disableKeyboardInput:!0}),b.mapTypeList&&!b.over){var ia=
[];"string"===typeof b.mapTypeList?ia=b.mapTypeList.split(";"):Array.isArray(b.mapTypeList)&&(ia=b.mapTypeList);x={road:null,satellite:null,mercator:null};for(var L=0;L<ia.length;L++)if("OM.layer.BingTileLayer.TYPE_ROAD"===ia[L]||ia[L]===a.layer.BingTileLayer.TYPE_ROAD)x.road=a.layer.BingTileLayer.TYPE_ROAD;else if("OM.layer.BingTileLayer.TYPE_AERIAL"===ia[L]||ia[L]===a.layer.BingTileLayer.TYPE_AERIAL)x.satellite=a.layer.BingTileLayer.TYPE_AERIAL;var ia=null,J;for(J in x)x[J]===b.mapType&&(ia=J);
b.mapTypeControl=new a.control.MapTypeControl(b.parentMap,b,{enableTypes:x,type:ia});b.mapTypeControl.infoDecoration&&b.mapTypeControl.infoDecoration.setVisible(b.mapTypeVisible)}}catch(K){}c.update(.85);Microsoft.Maps.Events.addHandler(b.map,"viewchangeend",function(){var J=a.event,x=new J.MapEvent(J.LayerEvent.FINISH_LOAD,b);x.mapContext=da;setTimeout(function(){null!==c&&(c.complete(),c=null)},1E3);b.fire(J.LayerEvent.FINISH_LOAD,x)})};da.getCenterPoint().transform(8307,function(a){c.update(.5);
ia(a)})}else c.abort(),c=null},oa=function(){a.isNull(c)&&(c=b.startNewTask());a.layer.BingTileLayer.LOADEDJS?(c.update(.25),la(b.container)):setTimeout(oa,500)};oa()}},pan:function(a,b){if(this.map){var c=this.map.getOptions();c.center=this.map.getCenter();c.animate=!1;c.centerOffset=new Microsoft.Maps.Point(a,b);this.map.setView(c)}},setCenterAndZoomlevel:function(){var b=this.startNewTask();if(this.map){var c=this.parentMap.getMapContext(),la=this.getRealZoomLevel(c.getZoomLevel()),oa=this,wa=
function(c){var ia=oa.map.getOptions();ia.zoom=la+1;ia.center=new Microsoft.Maps.Location(c.getY(),c.getX());oa.map.setView(ia);setTimeout(function(){a.notNull(b)&&(b.complete(),b=null)},1E3)};b.update(.25);c.getCenterPoint().transform(8307,function(a){b.update(.5);wa(a)})}},setMapType:function(b){this.mapType=b;b=null;this.map&&(this.checkMapType(),b=a.layer.BingTileLayer.TYPES[this.mapType],this.map.setMapType(b),this.cloneLayer&&this.cloneLayer.setMapType(this.mapType))},resize:function(){if(this.map){var a=
this.parentMap.getMapContext();this.map.setOptions({height:a.getDeviceWidth(),width:a.getDeviceHeight()})}},getMapType:function(){return this.mapType},checkMapType:function(){a.layer.BingTileLayer.TYPES[this.mapType]||(this.mapType=a.layer.BingTileLayer.TYPE_ROAD)},getStaticMapURL:function(b,c){var la="http://dev.virtualearth.net/REST/V1/Imagery/Map/",oa=this.map.getCenter(),oa=oa.latitude+","+oa.longitude,wa;wa=a.layer.BingTileLayer;switch(this.mapType){case wa.TYPE_AERIAL:wa="Aerial";break;case wa.TYPE_MERCATOR:wa=
"AerialWithLabels";break;default:wa="Road"}var da=this.map.getZoom();return la=la+wa+"/"+oa+"/"+da+"?"+("mapSize\x3d"+b+","+c)+"\x26"+("key\x3d"+this.key)},clone:function(b){b||(b=this.name+"_clone");return this.cloneLayer=new a.layer.BingTileLayer(b,{key:this.key,libURL:this.libURL,mapType:this.mapType},!0)}});a.layer.BingTileLayer.TYPE_ROAD="road";a.layer.BingTileLayer.TYPE_AERIAL="aerial";a.layer.BingTileLayer.TYPE_AUTO="auto";a.layer.BingTileLayer.TYPE_MERCATOR="mercator";a.layer.BingTileLayer.TYPES=
[];a.layer.BingTileLayer.LOADEDJS=!1;a.layer.BingTileLayer.LOADING=!1;c.OM_finishLoadBingJsV7=c.OM_finishLoadBingJsV7||function(){a.layer.BingTileLayer.LOADEDJS=!0;a.layer.BingTileLayer.TYPES[a.layer.BingTileLayer.TYPE_ROAD]=Microsoft.Maps.MapTypeId.road;a.layer.BingTileLayer.TYPES[a.layer.BingTileLayer.TYPE_AERIAL]=Microsoft.Maps.MapTypeId.aerial;a.layer.BingTileLayer.TYPES[a.layer.BingTileLayer.TYPE_AUTO]=Microsoft.Maps.MapTypeId.auto;a.layer.BingTileLayer.TYPES[a.layer.BingTileLayer.TYPE_MERCATOR]=
Microsoft.Maps.MapTypeId.mercator};a.layer.ElocationTileLayer=a.layer.TileLayer.extend({initialize:function qa(b){qa.base.call(this,b,{dataSource:"ELOCATION_MERCATOR",tileLayer:"world_map",tileServerURL:a.gv.secureHttp()+"//elocation.oracle.com/mapviewer/mcserver",tileLayerConfig:a.layer.TileLayerConfig.CONFIG_ELOCATION})},getStaticMapURL:function(b,c){var oa="http://elocation.oracle.com/mapviewer/omserver?",wa='width\x3d"'+b+'" height\x3d"'+c+'" antialiase\x3d"false" datasource\x3d"ELOCATION_MERCATOR" basemap\x3d"world_map" format\x3d"PNG_STREAM"\x3e',
da=new a.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMinX(),this.parentMap.getMapWindowBoundingBox().getMinY(),3857),ia=new a.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMaxX(),this.parentMap.getMapWindowBoundingBox().getMaxY(),3857),da='\x3cbox srsName\x3d"EPSG:3857"\x3e\x3ccoordinates\x3e'+da.getX()+","+da.getY()+","+ia.getX()+","+ia.getY()+"\x3c/coordinates\x3e\x3c/box\x3e\x3c/map_request\x3e";return oa+'xml_request\x3d\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e\x3cmap_request '+
wa+da}});a.layer.HereTileLayer=a.layer.BuiltinExternalTileLayer.extend({initialize:function la(b,c){la.base.call(this,b);var da=a.layer.HereTileLayer;this.over=2<arguments.length?arguments[2]:!1;c&&c.libURL?(this.libURL=c.libURL,-1===this.libURL.indexOf("/",this.libURL.length-1)&&(this.libURL+="/")):this.libURL="http://js.api.here.com/v3/3.0/";var ia=this;this.over||"undefined"!==typeof H||da.LOADING?da.LOADING||(da.LOADED=!0,a.util.Logger.finest("","OM.layer.HereTileLayer.initialize","HERE API already loaded.")):
(a.util.Logger.finest("","OM.layer.HereTileLayer.initialize","Loading HERE API ..."),a.layer.HereTileLayer.LOADING=!0,a.$.getScript(ia.libURL+"mapsjs-core.js",function(){a.$.when(a.$.getScript(ia.libURL+"mapsjs-service.js"),a.$.getScript(ia.libURL+"mapsjs-mapevents.js"),a.$.Deferred(function(b){a.$(b.resolve)})).done(function(){da.LOADING=!1;da.LOADED=!0;a.util.Logger.finest("","OM.layer.HereTileLayer.initialize","HERE API just loaded.")})}));this.appCode=c&&c.appCode?c.appCode:null;this.appID=c&&
c.appID?c.appID:null;!this.appID&&c&&c.appId&&(this.appID=c.appId);!this.appID&&c&&c.appid&&(this.appID=c.appid);!this.appID&&c&&c.app_id&&(this.appID=c.app_id);this.useHTTPS=c&&c.useHTTPS?c.useHTTPS:!1;this.useCIT=c&&c.useCIT?c.useCIT:!1;this.mapType=c&&c.mapType?c.mapType:a.layer.HereTileLayer.TYPE_NORMAL_MAP;this.mapTypeList=c&&c.mapTypeList?c.mapTypeList:null;a.isNull(this.mapTypeList)&&(this.mapTypeList=c&&c.map_type_values?c.map_type_values:null);this.mapTypeVisible=c&&a.notNull(c.mapTypeVisible)?
c.mapTypeVisible:!0;this.tileLayerConfig=a.layer.TileLayerConfig.CONFIG_GOOGLE;this.maxHeight=this.maxWidth=2048},init:function(){var b=null,oa=this,wa=this.startNewTask(),da=function(){if(oa.parentMap){wa.update(.25);var c=oa.parentMap.getMapContext(),ia=c.getCenterPoint(),da=function(J){var K=ia.getX(),da=ia.getY();J&&(K=J.getX(),da=J.getY());b=oa.getRealZoomLevel(c.getZoomLevel())+1;oa.checkMapType();if(!oa.map){try{oa.platform=new H.service.Platform({app_id:oa.appID,app_code:oa.appCode,useHTTPS:oa.useHTTPS,
useCIT:oa.useCIT})}catch(n){a.util.Logger.warning("MAPVIEWER_9077","OM.layer.HereTileLayer.showHereMap",n.message);return}a.util.Logger.finest("","OM.layer.HereTileLayer.showHereMap","H.service.Platform instance created.");try{oa.mapLayers=oa.platform.createDefaultLayers(),oa.map=new H.Map(oa.container,oa.mapLayers.normal.map,{zoom:b,center:{lng:K,lat:da}}),oa.setBaseLayer(oa.map,oa.mapLayers,oa.mapType)}catch(p){a.util.Logger.warning("MAPVIEWER_9078","OM.layer.HereTileLayer.showHereMap",p.message);
return}a.util.Logger.finest("","OM.layer.HereTileLayer.showHereMap","H.Map instance created.");try{oa.events=new H.mapevents.MapEvents(oa.map),oa.behavior=new H.mapevents.Behavior(oa.events)}catch(v){a.util.Logger.warning("MAPVIEWER_9079","OM.layer.HereTileLayer.showHereMap",v.message);return}a.util.Logger.finest("","OM.layer.HereTileLayer.showHereMap","H.mapevents.MapEvents and H.mapevents.Behavior instances created.");oa.parentMap.addListener(a.event.MapEvent.MAP_RESIZED,function(){oa.map.getViewPort().resize()});
if(oa.mapTypeList&&!oa.over){K=[];"string"===typeof oa.mapTypeList?K=oa.mapTypeList.split(";"):Array.isArray(oa.mapTypeList)&&(K=oa.mapTypeList);J={road:null,satellite:null,terrain:null};for(da=0;da<K.length;da++)if("OM.layer.HereTileLayer.TYPE_NORMAL_MAP"===K[da]||K[da]===a.layer.HereTileLayer.TYPE_NORMAL_MAP)J.road="road";else if("OM.layer.HereTileLayer.TYPE_SATELLITE_MAP"===K[da]||K[da]===a.layer.HereTileLayer.TYPE_SATELLITE_MAP)J.satellite="satellite";else if("OM.layer.HereTileLayer.TYPE_TERRAIN_MAP"===
K[da]||K[da]===a.layer.HereTileLayer.TYPE_TERRAIN_MAP)J.terrain="terrain";K=null;a.layer.HereTileLayer.TYPE_NORMAL_MAP===oa.mapType?K="road":a.layer.HereTileLayer.TYPE_SATELLITE_MAP===oa.mapType?K="satellite":a.layer.HereTileLayer.TYPE_TERRAIN_MAP===oa.mapType&&(K="terrain");oa.mapTypeControl=new a.control.MapTypeControl(oa.parentMap,oa,{enableTypes:J,type:K});oa.mapTypeControl.infoDecoration&&oa.mapTypeControl.infoDecoration.setVisible(oa.mapTypeVisible)}J=a.event;setTimeout(function(){a.notNull(wa)&&
(wa.complete(),wa=null)},1E3);K=new J.MapEvent(J.LayerEvent.FINISH_LOAD,oa);K.mapContext=oa.parentMap.getMapContext();oa.fire(J.LayerEvent.FINISH_LOAD,K)}};ia.transform(8307,function(a){wa.update(.5);da(a)})}else a.util.Logger.finest("","OM.layer.HereTileLayer.init_Here","A HereTileLayer instance already created.")},ia=c.setInterval(function(){!a.layer.HereTileLayer.LOADING&&a.layer.HereTileLayer.LOADED&&(da(),clearInterval(ia))},500)},setCenterAndZoomlevel:function(){var b=this.parentMap.getMapContext(),
c=this.getRealZoomLevel(b.getZoomLevel()),wa=this,da=this.startNewTask();da.update(.3);var ia=function(b){if(wa.map){wa.map.setCenter({lng:b.getX(),lat:b.getY()});wa.map.setZoom(c+1);setTimeout(function(){a.notNull(da)&&(da.complete(),da=null)},1E3);b=a.event;var ia=new b.MapEvent(b.LayerEvent.FINISH_LOAD,wa);ia.mapContext=wa.parentMap.getMapContext();wa.fire(b.LayerEvent.FINISH_LOAD,ia)}};b.getCenterPoint().transform(8307,function(a){da.update(.5);ia(a)})},setMapType:function(a){"road"===a?a="NORMAL_MAP":
"satellite"===a?a="SATELLITE_MAP":"terrain"===a&&(a="TERRAIN_MAP");this.mapType=a;this.map&&(this.checkMapType(),this.setBaseLayer(this.map,this.mapLayers,this.mapType),this.cloneLayer&&this.cloneLayer.setMapType(this.mapType))},getMapType:function(){return this.mapType},checkMapType:function(){var b=a.layer.HereTileLayer;a.isNull(b.TYPES[this.mapType])&&(this.mapType=b.TYPE_NORMAL_MAP)},clone:function(b){b||(b=this.name+"_clone");return this.cloneLayer=new a.layer.HereTileLayer(b,{libURL:this.libURL,
mapType:this.mapType,key:this.appCode,appID:this.appID},!0)},getStaticMapURL:function(b,c){var wa="http://image.maps.api.here.com/mia/1.6/mapview",da=this.map.getCenter(),da=da.lat+","+da.lng,ia="\x26t\x3d0",x=a.layer.HereTileLayer;this.mapType==x.TYPE_TERRAIN_MAP?ia="\x26t\x3d2":this.mapType==x.TYPE_SATELLITE_MAP&&(ia="\x26t\x3d1");x=this.map.getZoom();return wa=wa+"?app_id\x3d"+this.appID+"\x26app_code\x3d"+this.appCode+"\x26c\x3d"+da+"\x26z\x3d"+x+ia+("\x26w\x3d"+b+"\x26h\x3d"+c)+"\x26nodot "},
setBaseLayer:function(b,c,wa){a.isNull(b)||a.isNull(c)?a.util.Logger.warning("MAPVIEWER_9074","OM.layer.HereTileLayer.setBaseLayer"):(a.isNull(wa)&&(wa="NORMAL_MAP"),"NORMAL_MAP"===wa.toUpperCase()?b.setBaseLayer(c.normal.map):"SATELLITE_MAP"===wa.toUpperCase()?b.setBaseLayer(c.satellite.map):"TERRAIN_MAP"===wa.toUpperCase()?b.setBaseLayer(c.terrain.map):"NORMAL_TRAFFIC"===wa.toUpperCase()?b.setBaseLayer(c.normal.traffic):"SATELLITE_TRAFFIC"===wa.toUpperCase()?b.setBaseLayer(c.satellite.traffic):
"TERRAIN_TRAFFIC"===wa.toUpperCase()?b.setBaseLayer(c.terrain.traffic):"NORMAL_PANORAMA"===wa.toUpperCase()?b.setBaseLayer(c.normal.panorama):"SATELLITE_PANORAMA"===wa.toUpperCase()?b.setBaseLayer(c.satellite.panorama):"TERRAIN_PANORAMA"===wa.toUpperCase()?b.setBaseLayer(c.terrain.panorama):"NORMAL_TRANSIT"===wa.toUpperCase()?b.setBaseLayer(c.normal.transit):"NORMAL_XBASE"===wa.toUpperCase()?b.setBaseLayer(c.normal.xbase):"SATELLITE_XBASE"===wa.toUpperCase()?b.setBaseLayer(c.satellite.xbase):"TERRAIN_XBASE"===
wa.toUpperCase()?b.setBaseLayer(c.terrain.xbase):"NORMAL_BASE"===wa.toUpperCase()?b.setBaseLayer(c.normal.base):"SATELLITE_BASE"===wa.toUpperCase()?b.setBaseLayer(c.satellite.base):"TERRAIN_BASE"===wa.toUpperCase()?b.setBaseLayer(c.terrain.base):"NORMAL_LABELS"===wa.toUpperCase()?b.setBaseLayer(c.normal.labels):"SATELLITE_LABELS"===wa.toUpperCase()?b.setBaseLayer(c.satellite.labels):"TERRAIN_LABELS"===wa.toUpperCase()?b.setBaseLayer(c.terrain.labels):b.setBaseLayer(c.normal.map))},pan:function(){var b=
this;this.parentMap.getMapContext().getCenterPoint().transform(8307,function(c){if(b.map){b.map.setCenter({lng:c.getX(),lat:c.getY()});c=a.event;var wa=new c.MapEvent(c.LayerEvent.FINISH_LOAD,b);wa.mapContext=b.parentMap.getMapContext();b.fire(c.LayerEvent.FINISH_LOAD,wa)}})}});a.layer.HereTileLayer.TYPE_NORMAL_MAP="NORMAL_MAP";a.layer.HereTileLayer.TYPE_SATELLITE_MAP="SATELLITE_MAP";a.layer.HereTileLayer.TYPE_TERRAIN_MAP="TERRAIN_MAP";a.layer.HereTileLayer.TYPE_NORMAL_TRAFFIC="NORMAL_TRAFFIC";a.layer.HereTileLayer.TYPE_SATELLITE_TRAFFIC=
"SATELLITE_TRAFFIC";a.layer.HereTileLayer.TYPE_TERRAIN_TRAFFIC="TERRAIN_TRAFFIC";a.layer.HereTileLayer.TYPE_NORMAL_PANORAMA="NORMAL_PANORAMA";a.layer.HereTileLayer.TYPE_SATELLITE_PANORAMA="SATELLITE_PANORAMA";a.layer.HereTileLayer.TYPE_TERRAIN_PANORAMA="TERRAIN_PANORAMA";a.layer.HereTileLayer.TYPE_NORMAL_TRANSIT="NORMAL_TRANSIT";a.layer.HereTileLayer.TYPE_NORMAL_XBASE="NORMAL_XBASE";a.layer.HereTileLayer.TYPE_SATELLITE_XBASE="SATELLITE_XBASE";a.layer.HereTileLayer.TYPE_TERRAIN_XBASE="TERRAIN_XBASE";
a.layer.HereTileLayer.TYPE_NORMAL_BASE="NORMAL_BASE";a.layer.HereTileLayer.TYPE_SATELLITE_BASE="SATELLITE_BASE";a.layer.HereTileLayer.TYPE_TERRAIN_BASE="TERRAIN_BASE";a.layer.HereTileLayer.TYPE_NORMAL_LABELS="NORMAL_LABELS";a.layer.HereTileLayer.TYPE_SATELLITE_LABELS="SATELLITE_LABELS";a.layer.HereTileLayer.TYPE_TERRAIN_LABELS="TERRAIN_LABELS";a.layer.HereTileLayer.LOADING=!1;a.layer.HereTileLayer.LOADED=!1;a.layer.HereTileLayer.TYPES=[];a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_MAP]=
"NORMAL_MAP";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_MAP]="TERRAIN_MAP";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_MAP]="SATELLITE_MAP";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_TRAFFIC]="NORMAL_TRAFFIC";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_TRAFFIC]="TERRAIN_TRAFFIC";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_TRAFFIC]="SATELLITE_TRAFFIC";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_PANORAMA]=
"NORMAL_PANORAMA";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_PANORAMA]="TERRAIN_PANORAMA";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_PANORAMA]="SATELLITE_PANORAMA";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_TRANSIT]="NORMAL_TRANSIT";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_XBASE]="NORMAL_XBASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_XBASE]="TERRAIN_XBASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_XBASE]=
"SATELLITE_XBASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_BASE]="NORMAL_BASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_BASE]="TERRAIN_BASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_BASE]="SATELLITE_BASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_LABELS]="NORMAL_LABELS";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_LABELS]="TERRAIN_LABELS";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_LABELS]=
"SATELLITE_LABELS";a.layer.BaiduTileLayer=a.layer.BuiltinExternalTileLayer.extend({initialize:function oa(b,da){oa.base.call(this,b);this.isBaiduMap=!0;var ia=a.layer.BaiduTileLayer;da&&(da.libURL?(this.libURL=da.libURL,-1!==this.libURL.indexOf("/",this.libURL.length-1)&&(this.libURL=this.libURL.substring(0,this.libURL.length-1))):this.libURL=a.gv.secureHttp()+"//api.map.baidu.com/api",this.v=da.version||"2.0",a.isNull(da.APIKey)?(a.util.Logger.warning("","OM.layer.BaiduTileLayer.initialize","Application is required for Baidu Application"),
this.ak="Baidu application key is required!"):this.ak=da.APIKey,a.notNull(da.enableBD09Encoding)&&!0===da.enableBD09Encoding?this.enableBD09Encoding=!0:this.enableBD09Encoding=!1);var x=this;ia.LOADING?ia.LOADING||(ia.LOADED=!0,a.util.Logger.finest("","OM.layer.BaiduTileLayer.initialize","Baidu API already loaded.")):(c.setBaiduMapUtil=function(){"undefined"!==typeof BMap&&(ia.LOADING=!1,ia.LOADED=!0,a.util.Logger.finest("","OM.layer.BaiduTileLayer.initialize","Baidu API just loaded, now setting bdutil."),
x.bdutil={ak:x.ak,WGS84ToBD09:new BMap.Convertor,project:new BMap.MercatorProjection,enableBD09Encoding:x.enableBD09Encoding,BD09_APIURL:a.gv.secureHttp()+"//api.map.baidu.com/geoconv/v1/"})},a.$(document).ready(function(){var b=x.libURL+"?v\x3d"+x.v+"\x26ak\x3d"+x.ak+"\x26callback\x3dsetBaiduMapUtil";if(a.isNull(c.BMap)){var da=document.createElement("script");da.type="text/javascript";da.src=b;document.body.appendChild(da)}else x.bdutil={ak:x.ak,WGS84ToBD09:new BMap.Convertor,project:new BMap.MercatorProjection,
enableBD09Encoding:x.enableBD09Encoding,BD09_APIURL:a.gv.secureHttp()+"//api.map.baidu.com/geoconv/v1/"},a.util.Logger.finest("","OM.layer.BaiduTileLayer.initialize","Baidu API loaded already, only to set bdutil")}));this.tileLayerConfig=a.layer.TileLayerConfig.CONFIG_BAIDU;this.maxHeight=this.maxWidth=2048},init:function(){var b=null,wa=null,da=this,ia=this.container,x=this.startNewTask(),B=function(){if(da.parentMap){x.update(.25);var c=da.parentMap.getMapContext(),K=c.getCenterPoint(),B=function(n){var p=
K.getX(),v=K.getY();n&&(p=n.getX(),v=n.getY());n=da.bdutil.project.pointToLngLat(new BMap.Pixel(p,v));wa=new BMap.Point(n.lng,n.lat);b=da.getRealZoomLevel(c.getZoomLevel());wa=new BMap.Point(n.lng,n.lat);try{da.map=new BMap.Map(ia),da.map.centerAndZoom(wa,b)}catch(B){a.util.Logger.warning("","OM.layer.BaiduTileLayer.showBaiduMap",B.message);return}a.util.Logger.finest("","OM.layer.BaiduTileLayer.showBaiduMap");n=a.event;setTimeout(function(){a.notNull(x)&&(x.complete(),x=null)},1E3);p=new n.MapEvent(n.LayerEvent.FINISH_LOAD,
da);p.mapContext=da.parentMap.getMapContext();da.fire(n.LayerEvent.FINISH_LOAD,p)};K.transform(a.util.BaiduUtil.SRID,function(a){x.update(.5);B(a)})}else a.util.Logger.finest("","OM.layer.BaiduTileLayer.init_Baidu","A BaiduTileLayer instance already created.")},L=c.setInterval(function(){!a.layer.BaiduTileLayer.LOADING&&a.layer.BaiduTileLayer.LOADED&&(B(),clearInterval(L))},500)},setCenterAndZoomlevel:function(){var b=this.parentMap.getMapContext(),c=this.getRealZoomLevel(b.getZoomLevel()),da=this,
ia=this.startNewTask();ia.update(.3);var x=function(b){if(da.map){b=new BMap.Pixel(b.getX(),b.getY());b=da.bdutil.project.pointToLngLat(b);da.map.setCenter(new BMap.Point(b.lng,b.lat));da.map.setZoom(c);setTimeout(function(){a.notNull(ia)&&(ia.complete(),ia=null)},1E3);b=a.event;var J=new b.MapEvent(b.LayerEvent.FINISH_LOAD,da);J.mapContext=da.parentMap.getMapContext();da.fire(b.LayerEvent.FINISH_LOAD,J)}};b.getCenterPoint().transform(a.util.BaiduUtil.SRID,function(a){ia.update(.5);x(a)});b=a.event;
setTimeout(function(){a.notNull(ia)&&(ia.complete(),ia=null)},1E3);var B=new b.MapEvent(b.LayerEvent.FINISH_LOAD,da);B.mapContext=da.parentMap.getMapContext();da.fire(b.LayerEvent.FINISH_LOAD,B)},pan:function(){var b=this.parentMap.getMapContext();if(!a.isNull(this.map)){var c=this;b.getCenterPoint().transform(a.util.BaiduUtil.SRID,function(b){b=new BMap.Pixel(b.getX(),b.getY());b=c.bdutil.project.pointToLngLat(b);c.map.setCenter(new BMap.Point(b.lng,b.lat));b=a.event;var ia=new b.MapEvent(b.LayerEvent.FINISH_LOAD,
c);ia.mapContext=c.parentMap.getMapContext();c.fire(b.LayerEvent.FINISH_LOAD,ia)})}}});a.layer.BaiduTileLayer.LOADING=!1;a.layer.BaiduTileLayer.LOADED=!1;a.layer.GoogleTileLayer=a.layer.BuiltinExternalTileLayer.extend({initialize:function wa(b,c){wa.base.call(this,b);this.libURL=null;this.tileSource="google";var x=a.layer.GoogleTileLayer;this.over=2<arguments.length?arguments[2]:!1;this.mapTypeList=c&&c.mapTypeList?c.mapTypeList:null;a.isNull(this.mapTypeList)&&(this.mapTypeList=c&&c.map_type_values?
c.map_type_values:null);this.mapTypeVisible=c&&a.notNull(c.mapTypeVisible)?c.mapTypeVisible:!0;this.tilt=c&&c.tilt?c.tilt:0;c&&c.key&&(this.key=c.key);c&&c.clientID&&(this.clientID=c.clientID);var B="";!this.clientID&&this.key?B+="\x26key\x3d"+this.key:this.clientID&&(B+="\x26client\x3d"+this.clientID);this.over||"undefined"===typeof google?this.over||x.LOADING||(this.libURL=c&&c.libURL?c.libURL+"\x26callback\x3dOM.finishLoadGoogleV3"+B:a.gv.secureHttp()+"//maps.google.com/maps/api/js?v\x3d3\x26sensor\x3dfalse\x26callback\x3dOM.finishLoadGoogleV3"+
B,a.$.getScript(this.libURL),x.LOADING=!0):a.finishLoadGoogleV3();this.tileLayerConfig=a.layer.TileLayerConfig.CONFIG_GOOGLE;this.mapType=c&&c.mapType?c.mapType:a.layer.GoogleTileLayer.TYPE_ROAD;this.maxHeight=this.maxWidth=640},init:function(){var b=this.startNewTask(),da=null,ia=null,x=this,B=a.layer.GoogleTileLayer,L=this.container,J=function(){if(x.parentMap){b.update(.25);var c=x.parentMap.getMapContext(),J=c.getCenterPoint(),p=function(p){var K=J.getX(),Q=J.getY();p&&(K=p.getX(),Q=p.getY());
null!==K&&null!==Q&&(da=new google.maps.LatLng(Q,K));p=c.getZoomLevel();null!==p&&(ia=x.getRealZoomLevel(p)+1);x.checkMapType();x.map=new google.maps.Map(L,{zoom:ia,center:da,mapTypeId:B.TYPES[x.mapType],tilt:x.tilt,navigationControl:!1,panControl:!1,zoomControl:!1,mapTypeControl:!1,streetViewControl:!1,draggable:!1,keyboardShortcuts:!1,scrollwheel:!1});if(x.mapTypeList&&!x.over){K=[];"string"===typeof x.mapTypeList?K=x.mapTypeList.split(";"):Array.isArray(x.mapTypeList)&&(K=x.mapTypeList);p={road:null,
satellite:null,shaded:null,hybrid:null};for(Q=0;Q<K.length;Q++)if(K[Q]===a.layer.GoogleTileLayer.TYPE_ROAD||"OM.layer.GoogleTileLayer.TYPE_ROAD"===K[Q])p.road=B.TYPE_ROAD;else if(K[Q]===a.layer.GoogleTileLayer.TYPE_SATELLITE||"OM.layer.GoogleTileLayer.TYPE_SATELLITE"===K[Q])p.satellite=B.TYPE_SATELLITE;else if(K[Q]===a.layer.GoogleTileLayer.TYPE_SHADED||"OM.layer.GoogleTileLayer.TYPE_SHADED"===K[Q])p.shaded=B.TYPE_SHADED;else if(K[Q]===a.layer.GoogleTileLayer.TYPE_HYBRID||"OM.layer.GoogleTileLayer.TYPE_HYBRID"===
K[Q])p.hybrid=B.TYPE_HYBRID;var K=null,w;for(w in p)if(p[w]===x.mapType){K=w;break}a.isNull(K)&&(K=B.TYPE_ROAD);x.mapTypeControl=new a.control.MapTypeControl(x.parentMap,x,{enableTypes:p,type:K});x.mapTypeControl.infoDecoration&&x.mapTypeControl.infoDecoration.setVisible(x.mapTypeVisible)}b.update(.75);google.maps.event.addListener(x.map,"tilesloaded",function(){var J=a.event,p=new J.MapEvent(J.LayerEvent.FINISH_LOAD,x);p.mapContext=c;a.notNull(b)&&(b.complete(),b=null);x.fire(J.LayerEvent.FINISH_LOAD,
p)})};J.transform(8307,function(a){b.updateTask(.5);p(a)})}else b.abort(),b=null},K=c.setInterval(function(){!B.LOADING&&a.layer.GoogleTileLayer.LOADED&&(clearInterval(K),J())},500)},setCenterAndZoomlevel:function(){if(this.parentMap&&this.map){var b=this.startNewTask(),c=this.parentMap.getMapContext(),ia=this.getRealZoomLevel(c.getZoomLevel()),x=this,B=function(c){x.map.setOptions({zoom:ia+1,center:new google.maps.LatLng(c.getY(),c.getX())});c=new a.event.MapEvent(a.event.LayerEvent.FINISH_LOAD,
x);c.mapContext=x.parentMap.getMapContext();setTimeout(function(){a.notNull(b)&&(b.complete(),b=null)},1E3);x.fire(a.event.LayerEvent.FINISH_LOAD,c)};c.getCenterPoint().transform(8307,function(a){b.update(.5);B(a)})}},setMapType:function(b){this.mapType=b;this.map&&(this.checkMapType(),this.map.setMapTypeId(a.layer.GoogleTileLayer.TYPES[this.mapType]),this.cloneLayer&&this.cloneLayer.setMapType(this.mapType),this.parentMap.setMapZoomLevel(this.map.getZoom()-1))},resize:function(){this.map&&google.maps.event.trigger(this.map,
"resize")},getMapType:function(){return this.mapType},checkMapType:function(){var b=a.layer.GoogleTileLayer;b.TYPES[this.mapType]||(this.mapType=b.TYPE_ROAD)},pan:function(a,b){this.map&&this.map.panBy(-a,-b)},clone:function(b){b||(b=this.name+"_clone");return this.cloneLayer=new a.layer.GoogleTileLayer(b,{libURL:this.libURL,mapType:this.mapType},!0)},getStaticMapURL:function(b,c){var ia="http://maps.google.com/maps/api/staticmap?",x=this.map.getCenter(),x="center\x3d"+x.lat()+","+x.lng(),B="zoom\x3d"+
this.map.getZoom(),L="size\x3d"+b+"x"+c,J;switch(this.mapType){case a.layer.GoogleTileLayer.TYPE_SATELLITE:J="satellite";break;case a.layer.GoogleTileLayer.TYPE_HYBRID:J="hybrid";break;case a.layer.GoogleTileLayer.TYPE_SHADED:J="terrain";break;default:J="roadmap"}J="maptype\x3d"+J;var K="";if(a.isNull(this.clientID)&&this.key)K="\x26key\x3d"+this.key;else if(this.clientID){var K="\x26client\x3d"+this.clientID,z=a.util.MiscUtil.signURL(this.key,"/maps/api/staticmap?"+x+"\x26"+B+"\x26"+L+"\x26"+J+"\x26sensor\x3dfalse"+
K);a.notNull(z)&&(K=K+"\x26signature\x3d"+z)}return ia+x+"\x26"+B+"\x26"+L+"\x26"+J+"\x26sensor\x3dfalse"+K}});a.finishLoadGoogleV3=a.finishLoadGoogleV3||function(){var b=a.layer.GoogleTileLayer;a.layer.GoogleTileLayer.LOADED=!0;a.layer.GoogleTileLayer.LOADING=!1;null===b.TYPES&&(b.TYPES=[],b.TYPES[b.TYPE_ROAD]=google.maps.MapTypeId.ROADMAP,b.TYPES[b.TYPE_SATELLITE]=google.maps.MapTypeId.SATELLITE,b.TYPES[b.TYPE_HYBRID]=google.maps.MapTypeId.HYBRID,b.TYPES[b.TYPE_SHADED]=google.maps.MapTypeId.TERRAIN)};
a.layer.GoogleTileLayer.TYPE_ROAD="road";a.layer.GoogleTileLayer.TYPE_SATELLITE="satellite";a.layer.GoogleTileLayer.TYPE_HYBRID="hybrid";a.layer.GoogleTileLayer.TYPE_SHADED="shaded";a.layer.GoogleTileLayer.LOADING=!1;a.layer.GoogleTileLayer.LOADED=!1;a.layer.GoogleTileLayer.TYPES=null;a.layer.Cluster=a.Class.extend({initialize:function(a,b,c,x){this.clusterX=a;this.clusterY=b;this.numberOfPoints=1;this.featureArray=[c];this.updateFlag=!0;this.mbr=null;this.vectorClusterLayer=x},addFeature:function(a,
b,c){this.clusterX=(this.clusterX*this.numberOfPoints+a)/(this.numberOfPoints+1);this.clusterY=(this.clusterY*this.numberOfPoints+b)/(this.numberOfPoints+1);this.numberOfPoints++;this.featureArray.push(c);this.updateFlag=!0;this.mbr=null},addCluster:function(a){this.clusterX=(this.clusterX*this.numberOfPoints+a.clusterX*a.numberOfPoints)/(this.numberOfPoints+a.numberOfPoints);this.clusterY=(this.clusterY*this.numberOfPoints+a.clusterY*a.numberOfPoints)/(this.numberOfPoints+a.numberOfPoints);this.numberOfPoints+=
a.numberOfPoints;this.featureArray=this.featureArray.concat(a.featureArray)},getMBR:function(){if(a.notNull(this.mbr))return this.mbr;for(var b,c,ia=Number.MAX_VALUE,x=-Number.MAX_VALUE,B=Number.MAX_VALUE,L=-Number.MAX_VALUE,J=this.featureArray.length,K=0;K<J;K++)b=this.featureArray[K].getGeometry().getMBR(),a.isNull(c)&&(c=b.getSRID()),b.getMinX()<ia&&(ia=b.getMinX()),b.getMaxX()>x&&(x=b.getMaxX()),b.getMinY()<B&&(B=b.getMinY()),b.getMaxY()>L&&(L=b.getMaxY());return this.mbr=b=new a.geometry.Rectangle(ia,
B,x,L,c)},getMBP:function(){var a=null,b=null,c=[];this.iterateCoordinates(function(x){c.push(x);if(null===a||x.x<a.x)a=x;if(null===b||x.x>b.x)b=x});return[].concat(this.buildConvexHull([a,b],c),this.buildConvexHull([b,a],c))},getDistant:function(a,b){return(b[0].y-b[1].y)*(a.x-b[0].x)+(b[1].x-b[0].x)*(a.y-b[0].y)},findMostDistantPointFromBaseLine:function(a,b){for(var c=0,x=null,B=[],L=b.length-1;0<=L;L--){var J=b[L],K=this.getDistant(J,a);0<K&&(B.push(J),K>c&&(c=K,x=J))}return{maxPoint:x,newPoints:B}},
buildConvexHull:function(a,b){var c=[],x=this.findMostDistantPointFromBaseLine(a,b);return x.maxPoint?(c=c.concat(this.buildConvexHull([a[0],x.maxPoint],x.newPoints)),c=c.concat(this.buildConvexHull([x.maxPoint,a[1]],x.newPoints))):[a[0]]},iterateCoordinates:function(a){for(var b=this.featureArray.length,c=0;c<b;c++){var x=this.featureArray[c].getGeometry(),B=x.coordinates;"Polygon"===x.type&&(B=B[0]);for(var x=x.dim,L=0;L<B.length;L+=x)a({x:B[L],y:B[L+1]})}},removeFeature:function(a,b,c){for(var x=
0;x<this.featureArray.length;x++)if(this.featureArray[x]==c)return 1<this.numberOfPoints&&(this.clusterX=(this.clusterX*this.numberOfPoints-a)/(this.numberOfPoints-1),this.clusterY=(this.clusterY*this.numberOfPoints-b)/(this.numberOfPoints-1)),this.numberOfPoints--,this.featureArray.splice(x,1),this.updateFlag=!0;return!1},getVectorLayer:function(){if(this.vectorClusterLayer&&this.vectorClusterLayer.vectorLayer)return this.vectorClusterLayer.vectorLayer;a.util.Logger.warning("","OM.layer.Cluster",
"no vector layer was found for this cluster.");return null},createClusterFeature:function(b,c,ia){c=new a.geometry.Point(this.clusterX,this.clusterY,c);this.clusterFeatureId=b;b=new a.Feature(b,c,{renderingStyle:ia});b.cluster=this;ia=function(a){var b=a.target;a=b.parentLayer;var c=a.parentMap,b=b.cluster.getMBR();-1===a.clickZoomInLevels?c.zoomToExtent(b):0<a.clickZoomInLevels&&c.setMapCenterAndZoomLevel(b.getCenter(),c.getMapZoomLevel()+a.clickZoomInLevels)};c=this.getVectorLayer();a.notNull(c)&&
c.vClusterClickToZoomToMBR&&b.addListener(a.event.MouseEvent.MOUSE_CLICK,ia);this.updateFlag=!1;return b}});a.layer.VectorLayerCluster=a.Class.extend({initialize:function(b,c){this.vectorLayer=b;this.threshold=c&&c.threshold?c.threshold:30;this.clusterStyle=c&&c.clusterStyle?c.clusterStyle:null;this.clusterSelectStyle=a.notNull(c.clusterSelectStyle)?c.clusterSelectStyle:null;this.clusterHoverStyle=a.notNull(c.clusterHoverStyle)?c.clusterHoverStyle:null;this.minPointCount=c&&c.minPointCount?c.minPointCount:
2},initCluster:function(a,b){this.gridSizeInX=this.threshold*a;this.gridSizeInY=this.threshold*b;this.clusters={};var c=this.vectorLayer.parentMap.getMapContext().getUniverse().getMapBounds(),x=this.vectorLayer.visibleBound;this.minX=x?Math.max(x.getMinX(),c.getMinX()):c.getMinX();this.maxX=x?Math.min(x.getMaxX(),c.getMaxX()):c.getMaxX();this.minY=x?Math.max(x.getMinY(),c.getMinY()):c.getMinY();this.maxY=x?Math.min(x.getMaxY(),c.getMaxY()):c.getMaxY();this.numInX=Math.ceil((this.maxX-this.minX)/this.gridSizeInX);
this.numInY=Math.ceil((this.maxY-this.minY)/this.gridSizeInY);this.clusterFeatureArray=[];this.initialized=!0},addFeatureToCluster:function(b){var c=b.getGeometry().getMBR(),ia=(c.getMinX()+c.getMaxX())/2,c=(c.getMinY()+c.getMaxY())/2,x=Math.floor((ia-this.minX)/this.gridSizeInX),B=Math.floor((c-this.minY)/this.gridSizeInY);this.clusters[x]||(this.clusters[x]={});this.clusters[x][B]?this.clusters[x][B].addFeature(ia,c,b):this.clusters[x][B]=new a.layer.Cluster(ia,c,b,this);return{x:x,y:B}},displayAsCluster:function(b){a.util.Logger.finest(null,
"VectorLayerCluster","["+this.vectorLayer.name+"] displayAsCluster called.");var da=this.vectorLayer.parentMap.getMapContext(),ia=da.getUniverse(),x=da.getZoomLevel();if(!(this.vectorLayer.maxClusteringLevel<x)){this.initialized||(x=ia.getZoomLevels()[x],this.initCluster(x.resolution,x.resolution*x.stretchRatio));1<da.getWholeMapNum()&&(da=ia.getMapBounds(),b={x:da.getMinX(),y:da.getMinY(),w:da.getWidth(),h:da.getHeight()});this.startX=Math.floor((b.x-this.minX)/this.gridSizeInX);this.endX=Math.ceil((b.x+
b.w-this.minX)/this.gridSizeInX);this.startY=Math.floor((b.y-this.minY)/this.gridSizeInY);this.endY=Math.ceil((b.y+b.h-this.minY)/this.gridSizeInY);var x=(da=this.vectorLayer.featureArray)?da.length:0,B=ia.getSRID(),L=this,J=0;this.totolPointNumber=0;for(var ia=function(a){return function(){a.getGeometry().transform(B,function(b){a.srid=B;a.geo=b;L.addFeatureToCluster(a);J--})}()},K=0;K<x;K++){var z=da[K];z.inCluster=!1;"Point"!==z.geo.type&&"Polygon"!==z.geo.type||z.displayed||(this.totolPointNumber++,
z.geo.srid!==B?(J++,ia(z)):this.addFeatureToCluster(z))}var n=function(){if(0===J){for(var a=L.mergeAllClusters(b);a;)a=L.mergeAllClusters(b);L.showAllClusters()}else c.setTimeout(n,100)};n()}},showAllClusters:function(){for(var b=this.vectorLayer.parentMap.getMapContext().getUniverse().getSRID(),c=this.startX;c<this.endX;c++)for(var ia=this.startY;ia<this.endY;ia++)if(a.notNull(this.clusters[c])&&a.notNull(this.clusters[c][ia])&&this.clusters[c][ia].numberOfPoints>=this.minPointCount){var x="-CL"+
c+"-"+ia,B=this.getClusterFeatureById(x);B?this.updateMarkerText(B):(B=this.clusters[c][ia].createClusterFeature(x,b,this.clusterStyle),this.displayClusterFeature(B))}},displayClusterFeature:function(b){this.clusterFeatureArray.push(b);b.group=this.vectorLayer.realGroup;b.screenTransformObj=this.vectorLayer.parentMap.getMapContext().getTransform();b.graphics=this.vectorLayer.parentMap.graphics;b.parentLayer=this.vectorLayer;b.markerText=b.cluster.numberOfPoints;var c=b.renderingStyle;c instanceof
a.style.BucketStyle&&(c.generateBuckets([this.minPointCount,this.totolPointNumber],"_NUMBERINCLUSTER",!0),c=c.getRealStyle(b.cluster.numberOfPoints),b.renderingStyle=c);a.isNull(c)?c=b.renderingStyle:b.renderingStyle=c;b.displayFeature([c]);b.shape&&b.shape.applyStyle({tooltip:b.cluster.numberOfPoints+""});for(var c=b.cluster.featureArray.length,ia=0;ia<c;ia++){var x=b.cluster.featureArray[ia];x.displayed=!0;x.inCluster=!0;x.clusterId=b.id;x.clusterFeature=b}},mergeAllClusters:function(){for(var b=
!1,c=this.startX;c<this.endX;c++)for(var ia=this.startY;ia<this.endY;ia++)if(a.notNull(this.clusters[c])&&a.notNull(this.clusters[c][ia])){var x=this.mergeCluster(c,ia);a.notNull(x)&&(b=!0)}return b},mergeCluster:function(b,c){var ia=this.gridSizeInX*this.gridSizeInY,x=ia,B=ia,L=ia,J=ia,K=ia,z=ia,n=ia,p=ia;b+1<this.numInX&&a.notNull(this.clusters[b+1])&&a.notNull(this.clusters[b+1][c])&&(x=this.getSquareDistance(this.clusters[b][c],this.clusters[b+1][c]));c+1<this.numInY&&a.notNull(this.clusters[b][c+
1])&&(B=this.getSquareDistance(this.clusters[b][c],this.clusters[b][c+1]));0<=b-1&&a.notNull(this.clusters[b-1])&&a.notNull(this.clusters[b-1][c])&&(L=this.getSquareDistance(this.clusters[b][c],this.clusters[b-1][c]));0<=c-1&&a.notNull(this.clusters[b][c-1])&&(J=this.getSquareDistance(this.clusters[b][c],this.clusters[b][c-1]));b+1<this.numInX&&c+1<this.numInY&&a.notNull(this.clusters[b+1])&&a.notNull(this.clusters[b+1][c+1])&&(K=this.getSquareDistance(this.clusters[b][c],this.clusters[b+1][c+1]));
0<=b-1&&c+1<this.numInY&&a.notNull(this.clusters[b-1])&&a.notNull(this.clusters[b-1][c+1])&&(z=this.getSquareDistance(this.clusters[b][c],this.clusters[b-1][c+1]));b+1<this.numInX&&0<=c-1&&a.notNull(this.clusters[b+1])&&a.notNull(this.clusters[b+1][c-1])&&(n=this.getSquareDistance(this.clusters[b][c],this.clusters[b+1][c-1]));0<=b-1&&0<=c-1&&a.notNull(this.clusters[b-1])&&a.notNull(this.clusters[b-1][c-1])&&(p=this.getSquareDistance(this.clusters[b][c],this.clusters[b-1][c-1]));p=Math.min(x,Math.min(B,
Math.min(L,Math.min(J,Math.min(K,Math.min(z,Math.min(n,p)))))));if(p<ia){if(x===p)return this.mergeHorizontal(b,c,1),{directionX:1,directionY:0};if(B===p)return this.mergeVertical(b,c,1),{directionX:0,directionY:1};if(L===p)return this.mergeHorizontal(b,c,-1),{directionX:-1,directionY:0};if(J===p)return this.mergeVertical(b,c,-1),{directionX:0,directionY:-1};if(K===p)return this.mergeDiagonal(b,c,1,1),{directionX:1,directionY:1};if(z===p)return this.mergeDiagonal(b,c,-1,1),{directionX:-1,directionY:1};
if(n===p)return this.mergeDiagonal(b,c,1,-1),{directionX:1,directionY:-1};this.mergeDiagonal(b,c,-1,-1);return{directionX:-1,directionY:-1}}},getSquareDistance:function(a,b){return(a.clusterX-b.clusterX)*(a.clusterX-b.clusterX)+(a.clusterY-b.clusterY)*(a.clusterY-b.clusterY)},mergeHorizontal:function(a,b,c){this.clusters[a][b].addCluster(this.clusters[a+1*c][b]);var x=Math.floor((this.clusters[a][b].clusterX-this.minX)/this.gridSizeInX);x==a?(this.removeAllFeatureInCluster(this.clusters[a+1*c][b]),
this.clusters[a+1*c][b]=null):x==a+c&&(this.removeAllFeatureInCluster(this.clusters[a+1*c][b]),this.clusters[a+1*c][b]=this.clusters[a][b],this.removeAllFeatureInCluster(this.clusters[a][b]),this.clusters[a][b]=null)},mergeVertical:function(a,b,c){this.clusters[a][b].addCluster(this.clusters[a][b+1*c]);var x=Math.floor((this.clusters[a][b].clusterY-this.minY)/this.gridSizeInY);x==b?(this.removeAllFeatureInCluster(this.clusters[a][b+1*c]),this.clusters[a][b+1*c]=null):x==b+c&&(this.removeAllFeatureInCluster(this.clusters[a][b+
1*c]),this.clusters[a][b+1*c]=this.clusters[a][b],this.removeAllFeatureInCluster(this.clusters[a][b]),this.clusters[a][b]=null)},mergeDiagonal:function(b,c,ia,x){this.clusters[b][c].addCluster(this.clusters[b+1*ia][c+x]);var B=Math.floor((this.clusters[b][c].clusterX-this.minX)/this.gridSizeInX),L=Math.floor((this.clusters[b][c].clusterY-this.minY)/this.gridSizeInY);B==b&&L==c?(this.removeAllFeatureInCluster(this.clusters[b+ia][c+x]),this.clusters[b+1*ia][c+1*x]=null):B==b+ia&&L==c+x?(this.removeAllFeatureInCluster(this.clusters[b+
ia][c+x]),this.clusters[b+1*ia][c+1*x]=this.clusters[b][c],this.removeAllFeatureInCluster(this.clusters[b][c]),this.clusters[b][c]=null):(a.isNull(this.clusters[B][L])?this.clusters[B][L]=this.clusters[b][c]:this.clusters[B][L].addCluster(this.clusters[b][c]),this.removeAllFeatureInCluster(this.clusters[b][c]),this.clusters[b][c]=null,this.removeAllFeatureInCluster(this.clusters[b+ia][c+x]),this.clusters[b+ia][c+x]=null)},removeAllFeatureInCluster:function(b){var c=b.clusterFeatureId;if(a.isNull(c))for(c=
0;c<b.featureArray.length;c++){var ia=b.featureArray[c];ia.parentLayer&&ia.parentLayer.clearFeature(ia)}else for((c=this.getClusterFeatureById(c))&&c.parentLayer.clearFeature(c),b.clusterFeatureId=null,b=this.clusterFeatureArray?this.clusterFeatureArray.length:0,ia=0;ia<b;ia++)if(this.clusterFeatureArray[ia]==c){this.clusterFeatureArray.splice(ia,1);break}},redrawCluster:function(b,c,ia){if(!a.isNull(b)){var x=this.vectorLayer.parentMap.getMapContext().getUniverse().getSRID();return b.numberOfPoints>=
this.minPointCount?(ia="-CL"+c+"-"+ia,(c=this.getClusterFeatureById(ia))?(b=new a.geometry.Point(b.clusterX,b.clusterY,x),c.setGeometry(b),this.updateMarkerText(c)):(this.removeAllFeatureInCluster(b),c=b.createClusterFeature(ia,x,this.clusterStyle),this.displayClusterFeature(c)),!0):!1}},getClusterFeatureById:function(a){for(var b=0;b<this.clusterFeatureArray.length;b++)if(this.clusterFeatureArray[b].id==a)return this.clusterFeatureArray[b];return null},clearAllClusterFeatures:function(){for(var a=
(this.clusterFeatureArray?this.clusterFeatureArray.length:0)-1;0<a;a--){var b=this.clusterFeatureArray[a];b.group=null;b.screenTransformObj=null;b.graphics=null;b.displayed=!1;b.inCluster=!1;b.parentLayer=null;this.clusterFeatureArray.pop()}this.clusterFeatureArray=null;this.initialized=!1},updateMarkerText:function(a){1<a.shape.childrenCount&&a.shape.lastChild.applyStyle({textValue:a.cluster.numberOfPoints})},addFeature:function(b){var c=this.addFeatureToCluster(b),ia=this.mergeCluster(c.x,c.y),
x=this.clusters[c.x][c.y],B=!1;if(a.isNull(ia))B=this.redrawCluster(x,c.x,c.y);else{var L=c.x+ia.directionX,ia=c.y+ia.directionY;a.notNull(x)?B=this.redrawCluster(x,c.x,c.y):a.notNull(this.clusters[L][ia])&&(B=this.redrawCluster(this.clusters[L][ia],L,ia))}B&&(b.displayed=!0)},addClusterFeatureToLabelGrid:function(){for(var a=this.clusterFeatureArray?this.clusterFeatureArray.length:0,b=0;b<a;b++){var c=this.clusterFeatureArray[b];if(c.displayed&&c.screenPoints){var x=c.screenPoints.x,B=c.screenPoints.y,
L=c.renderingStyle.width,c=c.renderingStyle.height;this.vectorLayer.parentMap.grid.insert([x-L/2,B-c/2,x+L/2,B+c/2])}}},showClusterInWrapAround:function(){for(var a=this.vectorLayer.parentMap.getMapContext().getWholeMapNum(),b=this.clusterFeatureArray?this.clusterFeatureArray.length:0,c=1;c<a;c++)for(var x=0;x<b;x++){var B=this.clusterFeatureArray[x];B.group=this.vectorLayer.featureGroupArr[c];B.displayFeature([B.renderingStyle]);B.shape&&B.shape.applyStyle({tooltip:B.cluster.numberOfPoints+""})}}});
a.layer.EditableFeature=a.Feature.extend({initialize:function da(b,c,B){a.notNull(c)&&da.base.call(this,b,c,B);this.edit=!1;this.editable=!0;this.editing=this.modified=this.dragging=!1;this.contextMenu=null;this.refresh_dragging=this.point_dragging=this.dragging_flag=!1;this.mbrMinX=this.mbrMaxX=null;this.init();this.pointToSnap=null;var L=this;this.setParentThat=function(a){L=a};this.endEditing=function(b){if(!b||!b.evt||!b.evt.relatedTarget&&!L.dragging){var c;b&&b.target&&(c=b.target.parentFeature);
!c&&b&&b.focusFeature&&(c=b.focusFeature.parentFeature);!c&&b&&(c=b.focusFeature);c||(c=L);c.parentLayer.parentMap.deleteListener(a.event.MapEvent.I_MAP_CENTER_ZOOM,this.calDistance,this);c.editable=!1;c.editing=!1;b=c.geo;"Point"===b.type||"MultiPoint"===b.type?(c.deleteEditingProperties(),c.setRenderingStyle(c.normalStyle)):"OrientedPoint"===b.type?(c.deleteEditingProperties(),c.displayFeature([c.renderingStyle])):("Polygon"!==b.type&&"LineString"!==b.type&&"MultiPolygon"!==b.type&&"MultiLineString"!==
b.type||c.deleteEditingProperties(),c.parentLayer.parentMap.wraparound&&c.parentLayer.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh())}};this.shapePointMoving=function(b){a.notNull(a.gv.allowFeaturePointsInteraction)&&!1===a.gv.allowFeaturePointsInteraction||(L.dragging=!0,L.point_dragging=!0,L.featurePointMoving(b,!0))};this.possiblePointMoving=function(b){a.notNull(a.gv.allowFeaturePointsInteraction)&&!1===a.gv.allowFeaturePointsInteraction||(L.dragging=!0,L.point_dragging=
!0,L.featurePointMoving(b,!1))};this.resizePointMoving=function(b){a.notNull(a.gv.allowFeaturePointsInteraction)&&!1===a.gv.allowFeaturePointsInteraction||this.parentFeature.addResizeHandles(b)};this.showContextMenu=function(b){if(!a.notNull(a.gv.allowFeaturePointsInteraction)||!1!==a.gv.allowFeaturePointsInteraction){var c=b.target.parentLayer.parentMap,x=b.evt.clientX,n=b.evt.clientY,p=b.target,v=new a.layer.Menu(c,{left:x,top:n});v.menu.setPosition(x,n);var ia=function(){if(p&&(L.deleteShapePoint(p),
p.parentFeature)){var b=new a.event.LayerEvent(a.event.LayerEvent.FEATURE_EDITED,p.parentFeature);p.parentFeature.fire(a.event.LayerEvent.FEATURE_EDITED,b);p.parentFeature.addResizeHandles.apply(p.parentFeature)}};b=function(){if(p){var b=v.location.left,c=v.location.top,J=p.parentLayer.parentMap.getScreenPointLocation(b,c),c=p.parentLayer.parentMap.getScreenPointLocation(b-5,c-5),b=J.coordinates[0]-c.coordinates[0],c=c.coordinates[1]-J.coordinates[1],b=Math.sqrt(b*b+c*c),b=a.util.GeomUtil.findGeometryElement(p.getGeometry(),
J.coordinates[0],J.coordinates[1],b);-1!==b&&(J=p.getGeometry().clone(!0),J=a.util.GeomUtil.removeGeometryElement(J,b),a.notNull(J)&&(a.notNull(p.parentLayer.changeManager)&&(b=p.parentLayer.changeManager.updateFeature(p.id,p,J,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(b)&&p.parentLayer.getUndoManager().addEdit({feature:p,changeManager:p.parentLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"remove feature element"},
undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}})),p.setGeometry(J),p.fire(a.event.LayerEvent.FEATURE_EDITED),p.deleteEditingProperties(),
p.addEditProperties(!0)))}};x=function(){if(p){var b=p.parentLayer;if(!a.isNull(b)){var J=v.location.left,x=v.location.top,n=p.parentLayer.parentMap.getScreenPointLocation(J,x),x=p.parentLayer.parentMap.getScreenPointLocation(J-5,x-5),J=n.coordinates[0]-x.coordinates[0],x=x.coordinates[1]-n.coordinates[1],J=Math.sqrt(J*J+x*x),n=a.util.GeomUtil.findGeometryElement(p.getGeometry(),n.coordinates[0],n.coordinates[1],J);if(-1===n)a.util.Logger.alert("MAPVIEWER_9061","OM.EditableFeature.showContextMenu",
"");else{var ia=p.getGeometry().clone(!0),ia=a.util.GeomUtil.removeGeometryElement(ia,n);if(a.isNull(ia))a.util.Logger.alert("MAPVIEWER_9062","OM.EditableFeature.showContextMenu","");else{var B=a.util.GeomUtil.cloneGeometryElement(p.getGeometry(),n);if(a.isNull(B))a.util.Logger.alert("MAPVIEWER_9063","OM.EditableFeature.showContextMenu","");else{var n="\x3ctr\x3e\x3ctd\x3e\x3ctable\x3e",z=[],J=[],V=a.layer.VectorLayer,x=""+Math.floor(1E3*Math.random()+1);if(b.type===V.TYPE_PREDEFINED||b.type===V.TYPE_JDBC)if(a.notNull(b.keyColumn))z.push(b.keyColumn);
else return;else z.push("ID");if(a.notNull(b.notNullAttributes))for(var da=0;da<b.notNullAttributes.length;da++)b.notNullAttributes[da]!==b.keyColumn&&z.push(b.notNullAttributes[da].toUpperCase());for(da=0;da<z.length;da++){var L=document.getElementById("_wb_attr"+da+c.instanceId);a.notNull(L)&&(L.outerHTML="");0!==da?J.push(""):J.push(x);n+="\x3ctr\x3e\x3ctd\x3e"+z[da]+" : \x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:340px'  id\x3d'_wb_attr"+da+c.instanceId+"' value\x3d"+J[da]+"\x3e\x3c/td\x3e\x3c/tr\x3e"}n+=
"\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e";c.$featdialog=a.$('\x3cdiv id\x3d"_wb_dialog'+c.mapInstanceId+'" title\x3d"'+a.gv.getLabel("MAPVIEWER_WB_PROPERTIES")+'" style\x3d"overflow:visible"\x3e\x3ctable width\x3d100% cellSpacing\x3d0 borderSpacing\x3d0 style\x3d\'font-size:13px\'\x3e'+n+"\x3c/table\x3e\x3c/div\x3e");c.$featdialog.dialog({position:{of:c.$oracleMapDiv,at:"center"},resizable:!1,width:a.browser.touchSupported||a.gv.isWin8Touch?450:510,height:a.browser.touchSupported||a.gv.isWin8Touch?300:
360,buttons:[{closeOnEscape:!0,text:a.gv.getLabel("MAPVIEWER_WB_OK"),click:function(){for(var J=0;J<z.length;J++){var x=document.getElementById("_wb_attr"+J+c.instanceId).value;if(a.isNull(x)||0===x.length){alert(a.gv.getLabel("MAPVIEWER_9060")+" ["+z[J]+"]");return}var n=b.getAttributeType(z[J]);if(a.notNull(n)&&"string"!==n&&!0===isNaN(x)){alert(a.gv.getLabel("MAPVIEWER_9059")+" ["+z[J]+"]");return}}var x=document.getElementById("_wb_attr0"+c.instanceId).value,J={},n=!1,w=p.getAttributes(),v=null,
da=null,L=null;if(b.type===V.TYPE_PREDEFINED||b.type===V.TYPE_JDBC)for(v in w){da=v.toUpperCase();L=p.getAttributeValue(da);for(n=0;n<z.length;n++)if(z[n]===da){L=document.getElementById("_wb_attr"+n+c.instanceId).value;break}J[da]=L;n=!0}else for(v in w)da=v.toUpperCase(),J[da]=p.getAttributeValue(da),n=!0;x=new a.Feature(x,B);n&&(x.attributes=J);a.notNull(p.parentLayer.changeManager)?(J=a.edit.EditChangeEvent,p.parentLayer.getUndoManager().startChangeBlock("detach feature element"),J=p.parentLayer.changeManager.updateFeature(p.id,
p,ia,J.SPATIAL_UPDATE),a.notNull(J)&&p.parentLayer.getUndoManager().addEdit({feature:p,changeManager:p.parentLayer.changeManager,editChangeEvent:J,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"update feature element"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);
this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}),J=p.parentLayer.changeManager.addFeature(x.id,x),a.notNull(J)&&p.parentLayer.getUndoManager().addEdit({changeManager:p.parentLayer.changeManager,editChangeEvent:J,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"feature added"},undo:function(){this.changeManager.undo(this.editChangeEvent)},redo:function(){this.changeManager.redo(this.editChangeEvent)}}),
p.parentLayer.getUndoManager().endChangeBlock("detach feature element")):p.parentLayer.addFeature(x);p.setGeometry(ia);p.fire(a.event.LayerEvent.FEATURE_EDITED);p.deleteEditingProperties();p.addEditProperties(!0);a.$(this).dialog("close")}},{text:a.gv.getLabel("MAPVIEWER_WB_CANCEL"),click:function(){a.$(this).dialog("close")}}],close:function(a,b){}})}}}}}};n=function(){if(L.editable&&p){var b="\x3ctr\x3e\x3ctd\x3e\x3ctable\x3e",J,x,n,ia,B,z=[],V=[];n=-1;if(p.parentFeature)if(J=p.parentFeature.getGeometry(),
x=J.getDimension(),"OrientedPoint"===J.type)for(var da=0;da<x;da++)z.push(J.getDimensionValue(da)),V.push(J.getOrientationValue(da));else{da=p.id.indexOf("shapePoints");da=p.id.substring(da+11).split("_");n=parseInt(da[0]);ia=parseInt(da[1]);B=parseInt(da[2]);da=[];"MultiPolygon"===J.type?da=J.getOrdinates():"MultiLineString"===J.type?da=[J.getOrdinates()]:"Polygon"===J.type?da=[J.getOrdinates()]:"LineString"===J.type&&(da=[[J.getOrdinates()]]);for(var Ja=0;Ja<x;Ja++)z.push(da[n][ia][B*x+Ja])}else if(J=
p.getGeometry(),x=J.getDimension(),"Point"===J.type)for(da=0;da<x;da++)z.push(J.getDimensionValue(da));else{var Ja=v.location.left,vb=v.location.top,da=p.parentLayer.parentMap.getScreenPointLocation(Ja,vb),vb=p.parentLayer.parentMap.getScreenPointLocation(Ja-5,vb-5),Ja=da.coordinates[0]-vb.coordinates[0],vb=vb.coordinates[1]-da.coordinates[1],Ja=Math.sqrt(Ja*Ja+vb*vb);n=a.util.GeomUtil.findGeometryElement(J,da.coordinates[0],da.coordinates[1],Ja);if(-1!==n&&"MultiPoint"===J.type)for(da=0;da<x;da++)z.push(J.getOrdinates()[n][da])}for(da=
0;da<x;da++)Ja=document.getElementById("_wb_dim"+da+c.instanceId),a.notNull(Ja)&&(Ja.outerHTML=""),b+="\x3ctr\x3e\x3ctd\x3e"+a.gv.getLabel("MAPVIEWER_WB_DIMENSION")+" "+da+"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:340px'  id\x3d'_wb_dim"+da+c.instanceId+"' value\x3d"+z[da]+"\x3e\x3c/td\x3e\x3c/tr\x3e";if(0<V.length)for(da=0;da<x;da++)Ja=document.getElementById("_wb_orient"+da+c.instanceId),a.notNull(Ja)&&(Ja.outerHTML=""),b+="\x3ctr\x3e\x3ctd\x3e"+a.gv.getLabel("MAPVIEWER_WB_ORIENTATION")+
" "+da+"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:340px'  id\x3d'_wb_orient"+da+c.instanceId+"' value\x3d"+V[da]+"\x3e\x3c/td\x3e\x3c/tr\x3e";b+="\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e";c.$pointdialog=a.$('\x3cdiv id\x3d"_wb_dialog'+c.mapInstanceId+'" title\x3d"'+a.gv.getLabel("MAPVIEWER_WB_GEOM_PROPERTIES")+'" style\x3d"overflow:visible"\x3e\x3ctable width\x3d100% cellSpacing\x3d0 borderSpacing\x3d0 style\x3d\'font-size:13px\'\x3e'+b+"\x3c/table\x3e\x3c/div\x3e");c.$pointdialog.dialog({position:{of:c.$oracleMapDiv,
at:"center"},resizable:!1,width:a.browser.touchSupported||a.gv.isWin8Touch?450:510,height:a.browser.touchSupported||a.gv.isWin8Touch?300:360,buttons:[{closeOnEscape:!0,text:a.gv.getLabel("MAPVIEWER_WB_UPDATE"),click:function(){for(var b=a.util.ValidationUtil.isNumber,v=0;v<z.length;v++)if(!b(document.getElementById("_wb_dim"+v+c.instanceId).value)){alert(a.gv.getLabel("MAPVIEWER_9059")+" ["+a.gv.getLabel("MAPVIEWER_WB_DIMENSION")+":"+v+"]");return}for(v=0;v<V.length;v++)if(!b(document.getElementById("_wb_orient"+
v+c.instanceId).value)){alert(a.gv.getLabel("MAPVIEWER_9059")+" ["+a.gv.getLabel("MAPVIEWER_WB_ORIENTATION")+":"+v+"]");return}var da=v=b=null,Q=null;if(p.parentFeature)if(v=p.parentFeature,J=p.parentFeature.getGeometry(),b=J.clone(!0),x=J.getDimension(),"OrientedPoint"===J.type){for(da=0;da<x;da++)b.setDimensionValue(da,parseFloat(document.getElementById("_wb_dim"+da+c.instanceId).value)),b.setOrientationValue(da,parseFloat(document.getElementById("_wb_orient"+da+c.instanceId).value));da=v.screenPoints;
Q={x:da.x,y:da.y,angle:da.angle};da.angle=-Math.atan2(b.getOrientationValue(1),b.getOrientationValue(0))}else for(var L=b.getOrdinates(),kb=0;kb<x;kb++)"MultiPolygon"===J.type?L[n][ia][B*x+kb]=parseFloat(document.getElementById("_wb_dim"+kb+c.instanceId).value):"MultiLineString"===J.type?L[ia][B*x+kb]=parseFloat(document.getElementById("_wb_dim"+kb+c.instanceId).value):"Polygon"===J.type?L[ia][B*x+kb]=parseFloat(document.getElementById("_wb_dim"+kb+c.instanceId).value):"LineString"===J.type&&(L[B*
x+kb]=parseFloat(document.getElementById("_wb_dim"+kb+c.instanceId).value));else if(v=p,J=p.getGeometry(),b=J.clone(!0),x=J.getDimension(),"Point"===J.type)for(L=0;L<x;L++)b.setDimensionValue(L,parseFloat(document.getElementById("_wb_dim"+L+c.instanceId).value));else if(-1!==n&&"MultiPoint"===J.type)for(L=b.getOrdinates(),kb=0;kb<x;kb++)L[n][kb]=parseFloat(document.getElementById("_wb_dim"+kb+c.instanceId).value);a.notNull(b)&&(a.notNull(v.parentLayer.changeManager)&&(L=v.parentLayer.changeManager.updateFeature(v.id,
v,b,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(L)&&v.parentLayer.getUndoManager().addEdit({feature:v,changeManager:v.parentLayer.changeManager,editChangeEvent:L,screenPointsOld:Q,screenPointNew:da,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"point orientation change"},undo:function(){this.changeManager.undo(this.editChangeEvent);"OrientedPoint"===this.feature.geo.type&&(this.feature.screenPoints=this.screenPointsOld);this.feature.deleteEditingProperties();
this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);"OrientedPoint"===this.feature.geo.type&&(this.feature.screenPoints=this.screenPointsNew);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}})),v.setGeometry(b),"OrientedPoint"===v.geo.type&&(v.screenPoints=da),v.deleteEditingProperties(),v.addEditProperties());a.$(this).dialog("close")}},{text:a.gv.getLabel("MAPVIEWER_WB_CANCEL"),click:function(){a.$(this).dialog("close")}}],
close:function(a,b){}})}};if(a.notNull(p.parentFeature))"OrientedPoint"!==p.parentFeature.geo.type&&v.addMenuItem(a.gv.getLabel("MAPVIEWER_WB_DELETE"),ia),v.addMenuItem(a.gv.getLabel("MAPVIEWER_WB_PROPERTIES"),n);else{ia=p.geo.type;if("MultiPolygon"===ia||"MultiLineString"===ia||"MultiPoint"===ia||"MultiOrientedPoint"===ia||"GeometryCollection"===ia)v.addMenuItem(a.gv.getLabel("MAPVIEWER_WB_DELETE_ELEMENT"),b),v.addMenuItem(a.gv.getLabel("MAPVIEWER_WB_UNGROUP_ELEMENT"),x);("Point"===ia||"OrientedPoint"===
ia||"MultiPoint"===ia||"MultiOrientedPoint"===ia)&&this.editable&&v.addMenuItem(a.gv.getLabel("MAPVIEWER_WB_PROPERTIES"),n)}v.show=!0;this.parentFeature&&(this.parentFeature.contextMenu=v)}};this.registerUpdate=function(b,c,x,n){a.isNull(b)||a.isNull(c)||a.isNull(x)||(c===x?x.parentLayer.getUndoManager().addEdit({feature:x,changeManager:x.parentLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return n},undo:function(){this.changeManager.undo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}):x.parentLayer.getUndoManager().addEdit({feature:c,changeManager:x.parentLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return n},undo:function(){this.changeManager.undo(this.editChangeEvent)},
redo:function(){this.changeManager.redo(this.editChangeEvent)}}))}},init:function(){this.relatedFeature=[]},startDrag:function(b,c){var x=this;if(!a.gv.featureDragDisabled(x)&&!x.dragging){var B=x.parentLayer.parentMap.$oracleMapDiv.offset();x.startX=b.clientX+B.left;x.startY=b.clientY+B.top;x.lastX=b.clientX+B.left;x.lastY=b.clientY+B.top;x.parentLayer.parentMap.enableMapAction.drag?x.parentLayer.parentMap.enableMapDrag(!1):x.lockedParMap=!0;this.dragging=!0;if(a.notNull(x.parentFeature)&&c){B=x.parentFeature;
B.relatedFeature=[];var L=B.featureEditingProperties;x.orientation?(B=B.featureEditingProperties.shapePoints[0][0][0],x.centerX=B.screenPoints.x,x.centerY=B.screenPoints.y,x.posX=this.screenPoints.x,x.posY=this.screenPoints.y,x.endDragOrietation=function(){var b=x.parentLayer;b.parentMap.enableMapDrag(!0);var c=x.screenPoints.x-x.centerX,ia=x.centerY-x.screenPoints.y;x.startX=null;x.startY=null;x.posX=null;x.posY=null;var n,p,v=x.parentFeature;if(v.tool)n=v.tool.currentPoint,p=new a.geometry.Point(n.getX(),
n.getY(),n.srid,c,ia),v.tool.currentPoint=p;else{n=v.geo;p=new a.geometry.Point(n.getX(),n.getY(),n.srid,c,ia);if(2<n.dim)for(var B=2;B<n.dim;B++){var da=n.getOrientationValue(B),w=n.getDimensionValue(B);p.addDimension(w,da)}n=v.screenPoints;B={x:n.x,y:n.y,angle:n.angle};n.angle=-Math.atan2(ia,c);a.notNull(v.parentLayer.changeManager)&&(c=v.parentLayer.changeManager.updateFeature(v.id,v,p,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(c)&&v.parentLayer.getUndoManager().addEdit({feature:v,changeManager:v.parentLayer.changeManager,
editChangeEvent:c,screenPointsOld:B,screenPointNew:n,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"point orientation change"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.screenPoints=this.screenPointsOld;var a=new L(L.FEATURE_MOVED,this.feature);this.feature.fire(L.FEATURE_MOVED,a);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);
this.feature.screenPoints=this.screenPointNew;var a=new L(L.FEATURE_MOVED,this.feature);this.feature.fire(L.FEATURE_MOVED,a);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}));v.setGeometry(p);v.screenPoints=n}x.dragging=!1;b.labelsVisible()&&b.parentMap.refreshVectorLayerLabels();var L=a.event.LayerEvent,b=new L(L.FEATURE_MOVED,x);x.fire(b)}):x.pos?(L.shapePoints[0][0][1].setVisible(!1),L.shapePoints[0][0][2].setVisible(!1)):this.calRelatedFeature(L,
x)}}},calRelatedFeature:function(a,b){this.point_dragging=!0;var c=b.parentFeature;b.relatedFeature=[];var B,L,J,K,z,n,p;B=0;for(J=a.shapePoints.length;B<J;B++)for(L=0,K=a.shapePoints[B].length;L<K;L++)for(z=a.shapePoints[B][L].length;z--;)if(n=a.shapePoints[B][L],p=a.possiblePoints[B][L],n[z]===b&&("Polygon"===c.geo.type||"LineString"===c.geo.type||"MultiPolygon"===c.geo.type||"MultiLineString"===c.geo.type)){if(0!==z)b.relatedFeature.push(p[z-1]),b.relatedFeature.push(n[z-1]);else if("Polygon"===
c.geo.type||"MultiPolygon"===c.geo.type)b.relatedFeature.push(p[n.length-1]),b.relatedFeature.push(n[p.length-1]);b.relatedFeature.push(p[z]);if(z===n.length-1&&("Polygon"===c.geo.type||"MultiPolygon"===c.geo.type))z=-1;else if(z===n.length-1)return;b.relatedFeature.push(n[z+1]);return}B=0;for(J=a.possiblePoints.length;B<J;B++)for(L=0,K=a.possiblePoints[B].length;L<K;L++)for(z=a.possiblePoints[B][L].length;z--;)if(n=a.shapePoints[B][L],p=a.possiblePoints[B][L],p[z]==b&&("Polygon"==c.geo.type||"LineString"==
c.geo.type||"MultiPolygon"===c.geo.type||"MultiLineString"===c.geo.type)){b.relatedFeature.push(z);b.relatedFeature.push(n[z]);z==n.length-1&&(z=-1);b.relatedFeature.push(n[z+1]);b.relatedFeature.push(L);b.relatedFeature.push(B);return}},featureDragging:function(b){this._activeIndex=this.parentLayer.parentMap.getCursorLocation().wraparoundMapIndex;this.dragging_flag||(this.dragging_flag=this._activeIndex,a.isNull(this.dragging_flag)&&(this.dragging_flag=!1));var c;if(this.parentLayer&&!a.gv.featureDragDisabled(this)){var x=
this.parentLayer.parentMap.getMapContext();c=x.getUniverse().getZoomLevels()[x.getZoomLevel()];var x=a.event.LayerEvent,B=b.pageX-this.lastX,L=b.pageY-this.lastY,J=B*c.resolution;if(!this.mbrMaxX||!this.mbrMinX){var K=new a.geometry.Point(this.geo.getMBR().getMaxX(),this.geo.getMBR().getMaxY(),this.geo.srid),z=new a.geometry.Point(this.geo.getMBR().getMinX(),this.geo.getMBR().getMinY(),this.geo.srid),K=this.parentLayer.parentMap.getACL(K,this.dragging_flag),z=this.parentLayer.parentMap.getACL(z,this.dragging_flag);
this.mbrMaxX=K.getX();this.mbrMinX=z.getX()}this.mbrMaxX+=J;this.mbrMinX+=J;if(this.parentLayer.parentMap.wraparound&&!this.point_dragging&&(this.mbrMaxX>=this.parentLayer.parentMap.mapBBox[this.dragging_flag].maxX||this.mbrMinX<=this.parentLayer.parentMap.mapBBox[this.dragging_flag].minX)||this.parentLayer.parentMap.wraparound&&!(this.mbrMaxX<=this.parentLayer.parentMap.mapBBox[this.dragging_flag].maxX&&this.mbrMinX>=this.parentLayer.parentMap.mapBBox[this.dragging_flag].minX))this.lastX=b.pageX,
this.lastY=b.pageY;else{this.mouseLocX=b.pageX;this.mouseLocY=b.pageY;this.moving=!0;if(this.orientation){this.posX+=B;this.posY+=L;J=Math.atan2(this.centerY-this.posY,this.posX-this.centerX);z=this.parentFeature;K=z.geo;z.tool&&(K=z.tool.currentPoint);var n=K.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE+20,c,J);this.setGeometry(n);n=K.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE/2,c,J);c=K.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE/2+20,c,J);c=new a.geometry.LineString([n.getX(),
n.getY(),c.getX(),c.getY()],n.srid);z.featureEditingProperties.shapePoints[0][0][2].setGeometry(c);c=new a.event.LayerEvent(a.event.LayerEvent.FEATURE_ORIENTATION_CHANGING,this.parentLayer);c.angle=J;z.fire(x.FEATURE_ORIENTATION_CHANGING,c)}else if(this.shapeGroup)for(J=this.shapeGroup.length,c=0;c<J;c++)this.shapeGroup[c].translate(B,L);else if(this.scale&&("Point"===this.geo.type||"OrientedPoint"===this.geo.type))B/=this.scale,L/=this.scale,this.shape.translate(B,L);else if(a.notNull(this.shape))if(this.parentLayer.parentMap.wraparound&&
!this.point_dragging)for(c=0;c<this.parentLayer.featureGroupArr.length;c++)this.parentLayer.featureGroupArr[c].translate(B,L);else{if(this.dragging_flag!==this._activeIndex&&this.parentLayer.parentMap.wraparound)return;this.shape.translate(B,L)}this.lastX=b.pageX;this.lastY=b.pageY;this.labelShape&&!this.ghostShape&&this.labelShape.translate(B,L);B=new x(x.FEATURE_MOVING,this);B.orgEvt=b;this.fire(x.FEATURE_MOVING,B);a.notNull(this.parentFeature)&&this.parentFeature.fire(x.FEATURE_MOVING,B);!this.refresh_dragging&&
this.parentLayer.parentMap.wraparound&&this.parentLayer.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh()}}},endDrag:function(){this.mbrMinX=this.mbrMaxX=null;var b=this.parentLayer;if(!a.isNull(b)&&!a.gv.featureDragDisabled(this)){this.dragging=!1;b.parentMap.enableMapAction.drag||(this.lockedParMap?b.parentMap.enableMapDrag(!1):b.parentMap.enableMapDrag(!0));var c,x;if(this.moving){this.moving=!1;var B=this.startX-this.mouseLocX,L=this.startY-this.mouseLocY;(B||L)&&this.deleteEditingProperties();
var J=b.parentMap.getMapContext(),J=J.getUniverse().getZoomLevels()[J.getZoomLevel()];x=this.getGeometry().clone(!0);this.point_dragging&&this.dragging_flag!==this._activeIndex&&this.parentLayer.parentMap.wraparound?(a.util.Logger.warning(0,"Point is out of bounding",""),this.point_dragging=!1):this.move(B,L,J);this.startY=this.startX=null;var K=this.getGeometry().clone(!0),z=this.editing;c=this;if(a.notNull(this.parentFeature)&&"OrientedPoint"===this.parentFeature.geo.type){z=this.parentFeature.editing;
b=this.parentFeature.parentLayer;c=this.parentFeature;x=this.parentFeature.getGeometry().clone(!0);var n=K.getX(),p=K.getY(),K=this.parentFeature.getGeometry().clone(!0);K.setPoint(n,p)}z&&a.notNull(b.changeManager)&&(c.geo=x,x=b.changeManager.updateFeature(c.id,c,K,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(x)&&b.getUndoManager().addEdit({feature:c,changeManager:b.changeManager,editChangeEvent:x,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"feature move"},
undo:function(){this.changeManager.undo(this.editChangeEvent);var a=new v(v.FEATURE_MOVED,this.feature);this.feature.fire(v.FEATURE_MOVED,a);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);var a=new v(v.FEATURE_MOVED,this.feature);this.feature.fire(v.FEATURE_MOVED,a);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}));b.labelsVisible()&&b.parentMap.refreshVectorLayerLabels();
var v=a.event.LayerEvent;this.pos&&(c=this.parentFeature,x=c.featureEditingProperties,x.shapePoints[0][0][1].move(B,L,J),x.shapePoints[0][0][1].shape.translate(-B,-L),x.shapePoints[0][0][2].move(B,L,J),x.shapePoints[0][0][2].shape.translate(-B,-L),x.shapePoints[0][0][1].setVisible(!0),x.shapePoints[0][0][2].setVisible(!0),x=this.geo.getX(),K=this.geo.getY(),c.tool?c.tool.currentPoint.setPoint(x,K):(J=c.geo,J.setPoint(x,K),x={x:this.screenPoints.x,y:this.screenPoints.y,angle:c.screenPoints.angle},
c.setGeometry(J),c.screenPoints=x));J=new v(v.FEATURE_MOVED,this);this.fire(v.FEATURE_MOVED,J);a.notNull(this.parentFeature)&&this.parentFeature.fire(v.FEATURE_MOVED,J);this.addEditProperties(!0);b.parentMap.wraparound&&(this.refresh_dragging=!1,b.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh(),b.parentMap.getLayerByName("ii_oracle_maps_internal_others").refresh());return B&&L}this.pos&&(c=this.parentFeature,x=c.featureEditingProperties,x.shapePoints[1].setVisible(!0),x.shapePoints[2].setVisible(!0))}},
addEditProperties:function(){if(!a.notNull(this.parentFeature)){var b=this.getGeometry();if("Polygon"===b.type||"LineString"===b.type||"MultiPolygon"===b.type||"Point"===b.type||"OrientedPoint"===b.type||"MultiLineString"===b.type||"MultiPoint"===b.type){var c=b.getDimension();"MultiPolygon"!==b.type&&"MultiLineString"!==b.type&&"MultiPoint"!==b.type&&"OrientedMultiPoint"!==b.type&&"GeometryCollection"!==b.type&&"Point"!==b.type&&"OrientedPoint"!==b.type||this.addListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,
this.showContextMenu);var x=a.layer.EditableFeature,B=this.parentLayer.parentMap.getMapContext().getUniverse(),L=this.parentLayer.parentMap.getDefaultFeatureLayer(),J={shapePoints:[],possiblePoints:[]};this.featureEditingProperties=J;if("OrientedPoint"==b.type){J.shapePoints[0]=[];J.shapePoints[0][0]=[];var K=new a.geometry.Point(b.getX(),b.getY(),b.srid),B=new a.layer.EditableFeature(this.id+"pos",K,{renderingStyle:x.pointStyle});B.addListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,B.showContextMenu);
B.parentFeature=this;B.pos=!0;L.addFeature(B);J.shapePoints[0][0].push(B);K=this.parentLayer.parentMap.getMapContext();B=K.getUniverse();B=B.getZoomLevels()[K.getZoomLevel()];K=b.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE+20,B);K=new a.layer.EditableFeature(this.id+"orien",K,{renderingStyle:x.ORIENTATION_POINT_STYLE});K.parentFeature=this;K.orientation=!0;L.addFeature(K);J.shapePoints[0][0].push(K);K=b.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE/2,B);B=b.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE/
2+20,B);B=new a.geometry.LineString([K.getX(),K.getY(),B.getX(),B.getY()],K.srid);B=new a.Feature(this.id+"orienline",B,{renderingStyle:x.ORIENTATION_LINE_STYLE});B.parentFeature=this;L.addFeature(B);J.shapePoints[0][0].push(B)}B=[];if("MultiPolygon"===b.type)B=b.getOrdinates();else if("MultiLineString"===b.type)B=[b.getOrdinates()];else if("Polygon"===b.type)B=[b.getOrdinates()];else if("LineString"===b.type)B=[[b.getOrdinates()]];else return;for(var K=0,z=B.length;K<z;K++){var n=B[K];n[0]instanceof
Array||(n=[n[0]]);J.shapePoints[K]=[];J.possiblePoints[K]=[];for(var p=0;p<n.length;p++){J.shapePoints[K][p]=[];J.possiblePoints[K][p]=[];for(var v=null,V=null,Q=n[p],w,ha=0;ha<Q.length/c;ha++){var pa=Q[ha*c],ua=Q[ha*c+1];if("LineString"===b.type||"MultiLineString"===b.type||ha!==Q.length/c-1)w=new a.layer.EditableFeature(this.id+"shapePoints"+K+"_"+p+"_"+ha,new a.geometry.Point(pa,ua,b.srid),{renderingStyle:x.pointStyle}),w.parentFeature=this,w.ringIds=[K,p,ha],w.addListener(a.event.LayerEvent.FEATURE_MOVING,
w.shapePointMoving),w.addListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,w.showContextMenu),w.addListener(a.event.LayerEvent.FEATURE_MOVED,w.shapePointMoved),J.shapePoints[K][p].push(w),L.addFeature(w);a.notNull(v)&&a.notNull(V)&&(w=new a.layer.EditableFeature(this.id+"possiblePoints"+K+"_"+p+"_"+(ha-1),new a.geometry.Point(v+(pa-v)/2,V+(ua-V)/2,b.srid),{renderingStyle:x.possibleStyle}),w.parentFeature=this,w.ringIds=[K,p,ha],w.addListener(a.event.LayerEvent.FEATURE_MOVING,w.possiblePointMoving),w.addListener(a.event.LayerEvent.FEATURE_MOVED,
w.possiblePointMoved),J.possiblePoints[K][p].push(w),L.addFeature(w));v=pa;V=ua}}}this.addResizeHandles();this.calDistance()}}},addResizeHandles:function(b){if(!a.notNull(a.gv.showManipulator)||!1!==a.gv.showManipulator){var c=this.getGeometry(),x=c.getType();if("Polygon"===x||"MultiPolygon"===x||"LineString"===x||"MultiLineString"===x){var x=this.parentLayer.parentMap.getDefaultFeatureLayer(),B=x.parentMap.getMapContext(),L=B.getUniverse().getZoomLevels()[B.getZoomLevel()],J=new a.style.Color({stroke:"#FF0080",
strokeThickness:2,strokeOpacity:.5}),B=this.featureEditingProperties,K=c.getMBR(),z=K.coordinates[0],n=K.coordinates[1],p=K.coordinates[2],v=K.coordinates[3],V;if(!B.resizePoints)B.resizePoints=[];else if(b){V=b.target;var K=new this.graphics.oui.geom.Matrix,Q=-(V.startX-V.mouseLocX)*L.resolution,w=(V.startY-V.mouseLocY)*L.resolution*L.stretchRatio,ha=V.getGeometry().coordinates,pa=V.anchor,Q=ha[0]+Q,w=ha[1]+w;if(V===B.rotateHandle)if(this.parentLayer.parentMap.wraparound)a.util.Logger.warning("MAPVIEWER_9010",
"OM.EditableFeature.startEditing","Not support rotation for wraparound");else{if(p=Math.atan2(w-pa.y,Q-pa.x),K.translate(pa.x,pa.y),K.rotate(p),K.translate(-pa.x,-pa.y),B.resizeMBR&&B.resizeMBR.setVisible(!1),B.resizePoints)for(n=0;n<B.resizePoints.length;n++)(v=B.resizePoints[n])&&v.setVisible(!1)}else p=(Q-pa.x)/(p-z)*V.correction.x,n=(w-pa.y)/(v-n)*V.correction.y,V.id===this.id+"resizePointsN"||V.id===this.id+"resizePointsS"?p=b.orgEvt.shiftKey?n:1:V.id===this.id+"resizePointsW"||V.id===this.id+
"resizePointsE"?n=b.orgEvt.shiftKey?p:1:b.orgEvt.shiftKey&&(n=p=Math.max(p,n)),K.translate(pa.x,pa.y),K.scale(p,n),K.translate(-pa.x,-pa.y);p=a.util.GeomUtil.getTransformedGeometry(c,K);B.transitFeature?B.transitFeature.setGeometry(p):(n=new a.style.Line({stroke:"#8684F3",strokeThickness:3,strokeOpacity:.5}),n=new a.layer.EditableFeature(this.id+"transitFeature",p,{renderingStyle:n}),n.parentFeature=this,B.transitFeature=n,x.addFeature(n));b=p.getMBR();z=b.coordinates[0];n=b.coordinates[1];p=b.coordinates[2];
v=b.coordinates[3]}b=z+(p-z)/2;for(var K=n+(v-n)/2,pa="NW N NE E SE S SW W".split(" "),z=[z,b,p,p,p,b,z,z],w=[v,v,v,K,n,n,n,K],ha=[-1,1,1,1,1,1,-1,-1],Q=[1,1,1,1,-1,-1,-1,1],ua=[],n=0;n<z.length;n++){ua.push(z[n]);ua.push(w[n]);var v=B.resizePoints[n],Aa=new a.geometry.Point(z[n],w[n],c.srid);v?v!==V&&v.setGeometry(Aa):(v=new a.layer.EditableFeature(this.id+"resizePoints"+pa[n],Aa,{renderingStyle:a.layer.EditableFeature.resizeHandleStyle}),v.parentFeature=this,v.correction={x:ha[n],y:Q[n]},v.addListener(a.event.LayerEvent.FEATURE_MOVING,
v.resizePointMoving),v.addListener(a.event.LayerEvent.FEATURE_MOVED,v.resizePointMoved),B.resizePoints.push(v),x.addFeature(v),v.anchor=4>n?{x:z[n+4],y:w[n+4]}:{x:z[n-4],y:w[n-4]})}ua.push(z[0]);ua.push(w[0]);n=new a.geometry.LineString(ua,c.srid);if(B.resizeMBR)B.resizeMBR.setGeometry(n);else{var J=new a.Feature(this.id+"resizePointsMBR",n,{renderingStyle:J}),ta=this.id+"resizePointsMBR";J.parentFeature=this;B.resizeMBR=J;J.addListener(a.event.MouseEvent.MOUSE_DOWN,function(a){a.target.id===ta&&
(a.target.sendBackward(),a.evt.stopPropagation())});x.addFeature(J)}c=new a.geometry.Point(p+20*L.resolution,K,c.srid);B.rotateHandle?B.rotateHandle!==V&&B.rotateHandle.setGeometry(c):(V=new a.layer.EditableFeature(this.id+"rotateHandle",c,{renderingStyle:a.layer.EditableFeature.rotateHandleStyle}),V.parentFeature=this,V.anchor={x:b,y:K},V.addListener(a.event.LayerEvent.FEATURE_MOVING,V.resizePointMoving),V.addListener(a.event.LayerEvent.FEATURE_MOVED,V.resizePointMoved),B.rotateHandle=V,x.addFeature(V))}}},
calDistance:function(){for(var b=this.getGeometry(),c=null,c="Polygon"===b.type||"MultiLineString"===b.type?[b.coordinates]:"Polygon"===b.type?b.coordinates:[[b.coordinates]],x=b.getDimension(),B=this.featureEditingProperties,L=0,J=c.length;L<J;L++)for(var K=0,z=c[L].length;K<z;K++){var n=c[L][K].length/x;"Polygon"!==b.type&&"MultiPolygon"!==b.type||n--;for(var p=0;p<n;p++){var v=p+1;if(v===n&&("Polygon"===b.type||"MultiPolygon"===b.type))v=0;else if(v===n)break;var V=B.shapePoints[L][K][p].geo.getX(),
Q=B.shapePoints[L][K][p].geo.getY(),w=B.shapePoints[L][K][v].geo.getX(),v=B.shapePoints[L][K][v].geo.getY(),ha=this.parentLayer.parentMap.getMapContext(),ha=ha.getUniverse().getZoomLevels()[ha.getZoomLevel()],V=Math.pow(Math.pow((V-w)/ha.resolution,2)+Math.pow((Q-v)/ha.resolution*ha.stretchRatio,2),.5);B.possiblePoints[L][K][p].setVisible(V>=a.layer.EditableFeature.NEAREST_DISTANCE)}}},startEditing:function(){if(!this.dragging&&!a.notNull(this.parentFeature)){var b=this.geo;if(!(b instanceof a.geometry.Circle||
b instanceof a.geometry.Rectangle)){var c=a.layer.EditableFeature;this.editing=!0;"Point"!==b.type&&"MultiPoint"!==b.type||!a.isNull(this.parentFeature)?"OrientedPoint"===b.type&&a.isNull(this.parentFeature)?(this.tool&&(this.tool.currentPoint=this.geo.clone(),b=this.tool,b.textFeature&&b.textFeature!==this&&b.textFeature.parentLayer.deselectFeature(b.textFeature),a.tool.WhiteBoardTool.showDialog(this.parentLayer.parentMap,this.tool,this)),this.remove(),this.displayed=!1,this.deleteEditingProperties(),
this.addEditProperties(!0)):"Polygon"===b.type||"LineString"===b.type||"MultiPolygon"===b.type||"MultiLineString"===b.type?(this.deleteEditingProperties(),this.addEditProperties(!0),this.parentLayer.parentMap.on(a.event.MapEvent.I_MAP_CENTER_ZOOM,this.calDistance,this)):a.util.Logger.alert("MAPVIEWER_9010","OM.EditableFeature.startEditing",""):(this.normalStyle=this.renderingStyle,this instanceof a.TextFeature?a.notNull(this.editRenderingStyle)?this.setRenderingStyle(this.editRenderingStyle):this.setRenderingStyle(c.textStyle):
this.setRenderingStyle(c.pointStyle),this.deleteEditingProperties(),this.addEditProperties(!0))}}},startDragging:function(){if(!this.dragging&&!a.notNull(this.parentFeature)){var b=this.geo;b instanceof a.geometry.Circle||b instanceof a.geometry.Rectangle||(this.editing=!0,"Point"!==b.type&&"MultiPoint"!==b.type||!a.isNull(this.parentFeature)?"OrientedPoint"===b.type&&a.isNull(this.parentFeature)?(this.tool&&(this.tool.currentPoint=this.geo.clone(),b=this.tool,b.textFeature&&b.textFeature!==this&&
b.textFeature.parentLayer.deselectFeature(b.textFeature),a.tool.WhiteBoardTool.showDialog(this.parentLayer.parentMap,this.tool,this)),this.remove(),this.displayed=!1,this.deleteEditingProperties(),this.addEditProperties(!0)):a.util.Logger.alert("to be filed",a.EditableFeature.start):(this.normalStyle=this.renderingStyle,this.deleteEditingProperties(),this.addEditProperties(!0)))}},deleteEditingProperties:function(){a.isNull(this.parentFeature)&&this.deleteListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,
this.showContextMenu);var c=this.featureEditingProperties,ia=this.parentLayer.parentMap.getDefaultFeatureLayer();if(!a.isNull(c)){var x,B,L,J,K,z;x=0;for(J=c.shapePoints.length;x<J;x++)for(K=c.shapePoints[x].length,B=0;B<K;B++)for(z=c.shapePoints[x][B].length,L=0;L<z;L++)ia.removeFeature(c.shapePoints[x][B][L]);c.shapePoints=[];x=0;for(J=c.possiblePoints.length;x<J;x++)for(K=c.possiblePoints[x].length,B=0;B<K;B++)for(z=c.possiblePoints[x][B].length,L=0;L<z;L++)ia.removeFeature(c.possiblePoints[x][B][L]);
c.possiblePoints=[];if(c.resizePoints){x=c.resizePoints.length;for(B=0;B<x;B++)ia.removeFeature(c.resizePoints[B]);c.resizePoints=[]}c.resizeMBR&&(ia.removeFeature(c.resizeMBR),c.resizeMBR=b);c.transitFeature&&(ia.removeFeature(c.transitFeature),c.transitFeature=b);c.rotateHandle&&(ia.removeFeature(c.rotateHandle),c.rotateHandle=b);ia&&ia.group&&a.$("#"+ia.group._id).unbind();this.featureEditingProperties=null;this.contextMenu&&!0===this.contextMenu.show&&this.contextMenu.removeRightClickMenu()}},
focusProperties:function(b){var c=this.featureEditingProperties;if(a.isNull(c)&&(a.notNull(this.parentFeature)&&(c=this.parentFeature.featureEditingProperties),a.isNull(c)))return;var x=0,B,L,J,K;if(this.isEditProperties(b,c)){x=c.resizePoints.length;for(b=0;b<x;b++)c.resizePoints[b].bringToTop();c.resizeMBR&&c.resizeMBR.bringToTop()}else{x=c.shapePoints.length;for(B=0;B<x;B++)for(L=c.shapePoints[B].length,b=0;b<L;b++)for(J=c.shapePoints[B][b].length,K=0;K<J;K++)c.shapePoints[B][b][K].bringToTop();
x=c.possiblePoints.length;for(B=0;B<x;B++)for(L=c.shapePoints[B].length,b=0;b<L;b++)for(J=c.possiblePoints[B][b].length,K=0;K<J;K++)c.possiblePoints[B][b][K].bringToTop()}},isEditProperties:function(b,c){var x=b.id;if(a.isNull(c))return!1;if(c.resizePoints)for(var B=c.resizePoints.length,L=0;L<B;L++)if(c.resizePoints[L].id===x)return!0;return c.resizeMBR&&c.resizeMBR.id===x?!0:!1},shapePointMoved:function(b){a.notNull(a.gv.allowFeaturePointsInteraction)&&!1===a.gv.allowFeaturePointsInteraction||(this.point_dragging=
this.dragging=!1,this.parentFeature.featurePointMoved(b,!0),b=new a.event.LayerEvent(a.event.LayerEvent.FEATURE_EDITED,this.parentFeature),this.parentFeature.fire(a.event.LayerEvent.FEATURE_EDITED,b))},possiblePointMoved:function(b){a.notNull(a.gv.allowFeaturePointsInteraction)&&!1===a.gv.allowFeaturePointsInteraction||(this.point_dragging=this.dragging=!1,this.parentFeature.featurePointMoved(b,!1),b=new a.event.LayerEvent(a.event.LayerEvent.FEATURE_EDITED,this.parentFeature),this.parentFeature.fire(a.event.LayerEvent.FEATURE_EDITED,
b))},resizePointMoved:function(){this.mbrMinX=this.mbrMaxX=null;if(!a.notNull(a.gv.allowFeaturePointsInteraction)||!1!==a.gv.allowFeaturePointsInteraction){var b=this.parentFeature,c=b.featureEditingProperties.transitFeature,x=c.getGeometry().clone();a.notNull(b.parentLayer.changeManager)&&(x=b.parentLayer.changeManager.updateFeature(b.id,b,x,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(x)&&b.parentLayer.getUndoManager().addEdit({feature:b,changeManager:b.parentLayer.changeManager,editChangeEvent:x,
canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"feature transform"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.selected&&
this.feature.addEditProperties()}}));b.setGeometry(c.getGeometry());b.fire(a.event.LayerEvent.FEATURE_EDITED);b.deleteEditingProperties();b.addEditProperties(!0)}},digHole:function(){console.info("hole")},deleteShapePoint:function(b){if(!a.notNull(a.gv.allowFeaturePointsInteraction)||!1!==a.gv.allowFeaturePointsInteraction){var c=b.parentFeature,x=c.geo.dim,B=c.featureEditingProperties,L=b.parentLayer.parentMap.getDefaultFeatureLayer(),J=null,K=null,z=null,n=null,p=-1,v=0,V=0;b.ringIds&&2<b.ringIds.length&&
(V=b.ringIds[0],v=b.ringIds[1]);var Q=B.shapePoints[V][v],w=B.possiblePoints[V][v],ha;if("Polygon"===c.geo.type||"LineString"===c.geo.type||"MultiPolygon"===c.geo.type||"MultiLineString"===c.geo.type){p=Q.length;if(2>=p){a.util.Logger.alert("MAPVIEWER_9011","OM.EditableFeature.deleteShapePoint","");return}if(("Polygon"===c.geo.type||"MultiPolygon"===c.geo.type)&&3>=p){a.util.Logger.alert("MAPVIEWER_9012","OM.EditableFeature.deleteShapePoint","");return}for(;p--;)if(Q[p]===b){if(0!==p&&p!==Q.length-
1)J=w[p-1],z=Q[p-1],K=w[p],n=Q[p+1],ha=z.geo.getX()+(n.geo.getX()-z.geo.getX())/2,z=z.geo.getY()+(n.geo.getY()-z.geo.getY())/2,K.setGeometry(new a.geometry.Point(ha,z,b.geo.srid));else if("Polygon"===c.geo.type||"MultiPolygon"===c.geo.type)0===p?(J=w[w.length-1],z=Q[Q.length-1],K=w[p],n=Q[p+1]):p===Q.length-1&&(J=w[p-1],z=Q[p-1],K=w[p],n=Q[0]),ha=z.geo.getX()+(n.geo.getX()-z.geo.getX())/2,z=z.geo.getY()+(n.geo.getY()-z.geo.getY())/2,K.setGeometry(new a.geometry.Point(ha,z,b.geo.srid));else if("LineString"===
c.geo.type||"MultiLineString"===c.geo.type)0===p?(K=w[p],L.removeFeature(K),w.splice(p,1)):p===Q.length-1&&(J=w[p-1]);break}}for(K=0;K<Q.length;K++)if(Q[K]===b){Q.splice(K,1);L.removeFeature(b);break}if(J)for(K=0;K<w.length;K++)if(w[K]===J){w.splice(K,1);L.removeFeature(J);break}J=c.geo.getOrdinates();Q=[];for(L=0;L<B.shapePoints.length;L++)for(Q[L]=[],K=0;K<B.shapePoints[L].length;K++){Q[L][K]=[];for(ha=0;ha<B.shapePoints[L][K].length;ha++)if(B.shapePoints[L][K][ha].id=c.id+"shapePoints"+L+"_"+K+
"_"+ha,Q[L][K].push(B.shapePoints[L][K][ha].geo.getX()),Q[L][K].push(B.shapePoints[L][K][ha].geo.getY()),2<x)for(z=0,ha>=p&&L===V&&K===v&&z++,n=2;n<x;n++){var pa=0;"MultiPolygon"===c.geo.type&&(pa=J[L][K][(ha+z)*x+n]);"Polygon"===c.geo.type?pa=J[K][(ha+z)*x+n]:"LineString"===c.geo.type?pa=J[(ha+z)*x+n]:"MultiLineString"===c.geo.type&&(pa=J[K][(ha+z)*x+n]);Q[L][K].push(pa)}if("Polygon"===c.geo.type||"MultiPolygon"===c.geo.type)if(Q[L][K].push(B.shapePoints[L][K][0].geo.getX()),Q[L][K].push(B.shapePoints[L][K][0].geo.getY()),
2<x)for(ha=2;ha<x;ha++)z=0,z="MultiPolygon"===c.geo.type?J[L][K][J[L][K].length-x+ha]:J[K][J[K].length-x+ha],Q[L][K].push(z)}var ua;"Polygon"===c.geo.type?ua=new a.geometry.Polygon(Q[0],c.geo.srid,x):"MultiPolygon"===c.geo.type?ua=new a.geometry.MultiPolygon(Q,c.geo.srid,x):"MultiLineString"===c.geo.type?ua=new a.geometry.MultiLineString(Q[0],c.geo.srid,x):"LineString"===c.geo.type&&(ua=new a.geometry.LineString(Q[0][0],c.geo.srid,x));p=ua.clone();x=[];x.push(c);B={};B[c.id]=p;if(c.parentLayer.hasSharedBoundary()&&
(p=c.parentLayer.parentMap.getScreenLocation(b.geo),v=c.parentLayer.parentMap.getScreenPointLocation(p.x-3,p.y-3),p=b.geo.getX()-v.coordinates[0],v=v.coordinates[1]-b.geo.getY(),p=Math.sqrt(p*p+v*v),b=[b.geo.getX(),b.geo.getY()],b=a.edit.GeometrySegmentUtil.getLayerSegmentPoints(c.parentLayer,b,p,!1,!1,!1,!1),a.notNull(b)))for(p=0;p<b.length;p++)v=b[p].getFeature().id,v!==c.id&&(V=b[p].getFeature().getGeometry().clone(!0),a.edit.GeometrySegmentUtil.removeVertexFromGeometry(V,b[p])&&(x.push(b[p].getFeature()),
B[v]=V));if(a.notNull(c.parentLayer.changeManager)){b=a.edit.EditChangeEvent;1<x.length&&c.parentLayer.getUndoManager().startChangeBlock("feature point move");for(p=0;p<x.length;p++)v=x[p],a.isNull(B[v.id])||(V=c.parentLayer.changeManager.updateFeature(v.id,v,B[v.id],b.SPATIAL_UPDATE),a.notNull(V)&&c.registerUpdate(V,v,c,"feature point delete"));1<x.length&&c.parentLayer.getUndoManager().endChangeBlock("feature point move")}for(b=0;b<x.length;b++)p=x[b],p.setGeometry(B[p.id]);for(K=0;K<w.length;K++)w[K].id=
c.id+"possiblePoints"+K}},featurePointMoving:function(b,c){this.refresh_dragging=!0;this.activeIndex=this.parentLayer.parentMap.getCursorLocation().wraparoundMapIndex;a.isNull(this.activeIndex)&&(this.activeIndex=0);if(!a.notNull(a.gv.allowFeaturePointsInteraction)||!1!==a.gv.allowFeaturePointsInteraction){var x=b.target.parentFeature,B=x.parentLayer.parentMap,L=new a.style.Line({stroke:"#8684F3",strokeThickness:5,strokeOpacity:.5}),J=b.target.graphics,K=null,z=null;if(x&&("Polygon"===x.geo.type||
"LineString"===x.geo.type||"MultiPolygon"===x.geo.type||"MultiLineString"===x.geo.type)){c?(1>b.target.relatedFeature.length&&x.calRelatedFeature(x.featureEditingProperties,b.target),K=b.target.relatedFeature[1],z=b.target.relatedFeature[3]):(1>b.target.relatedFeature.length&&x.calRelatedFeature(x.featureEditingProperties,b.target),K=b.target.relatedFeature[1],z=b.target.relatedFeature[2]);var n=J.getLeftTop(K.parentLayer.group),p=J.getLeftTop(B.draggableGroup),v=b.orgEvt.pageX-B.$oracleMapDiv.offset().left-
n.x-p.x,n=b.orgEvt.pageY-B.$oracleMapDiv.offset().top-n.y-p.y,p=K.parentLayer.group,V;x.editingLineBefore||x.editingLineAfter?(K&&(V=a.util.GeomUtil.screenPointsXOffset(K.screenPoints.x,this.activeIndex,B.getMapContext()),J.setPath(x.editingLineBefore,[[V,K.screenPoints.y,v,n]])),z&&(V=a.util.GeomUtil.screenPointsXOffset(z.screenPoints.x,this.activeIndex,B.getMapContext()),J.setPath(x.editingLineAfter,[[V,z.screenPoints.y,v,n]]))):(K&&(V=a.util.GeomUtil.screenPointsXOffset(K.screenPoints.x,this.activeIndex,
B.getMapContext()),x.editingLineBefore=J.drawPath([[V,K.screenPoints.y,v,n]],L,{group:p}),x.editingLineBefore.setStrokeDashArray([10]),K.bringToTop()),z&&(V=a.util.GeomUtil.screenPointsXOffset(z.screenPoints.x,this.activeIndex,B.getMapContext()),x.editingLineAfter=J.drawPath([[V,z.screenPoints.y,v,n]],L,{group:p}),x.editingLineAfter.setStrokeDashArray([10]),z.bringToTop()),b.target.bringToTop())}}},featurePointMoved:function(b,c){if((!a.notNull(a.gv.allowFeaturePointsInteraction)||!1!==a.gv.allowFeaturePointsInteraction)&&
0!==b.target.relatedFeature.length){b.target.graphics.remove(this.editingLineBefore);this.editingLineBefore=null;b.target.graphics.remove(this.editingLineAfter);this.editingLineAfter=null;var x=b.target,B=x.parentFeature,L=!1;if(a.notNull(B)){var J=B.pointToSnap;a.notNull(J)&&(x.geo.setPoint(J[0],J[1]),B.pointToSnap=null,L=!0)}var K=B.geo.dim,z=B.featureEditingProperties,J=B.parentLayer.parentMap.getDefaultFeatureLayer(),n=a.layer.EditableFeature;B.parentLayer.removeFromRtree(x);B.parentLayer.addToRtree(x);
var p=J.parentMap.getMapContext(),v=p.getUniverse().getZoomLevels()[p.getZoomLevel()],V,Q,w,ha,pa,ua,Aa,ta,p=null,Ba,Ta,Ja;if(c){if("Polygon"===B.geo.type||"LineString"===B.geo.type||"MultiPolygon"===B.geo.type||"MultiLineString"===B.geo.type)p=[],"MultiPolygon"===B.geo.type?p=B.geo.getOrdinates():"MultiLineString"===B.geo.type?p=[B.geo.getOrdinates()]:"Polygon"===B.geo.type?p=[B.geo.getOrdinates()]:"LineString"===B.geo.type&&(p=[[B.geo.getOrdinates()]]),n=B.geo.getDimension(),Ba=b.target.ringIds[0],
Ta=b.target.ringIds[1],Ja=b.target.ringIds[2],p=[p[Ba][Ta][Ja*n],p[Ba][Ta][Ja*n+1]],V=x.geo.getX()+(b.target.relatedFeature[1].geo.getX()-x.geo.getX())/2,Q=x.geo.getY()+(b.target.relatedFeature[1].geo.getY()-x.geo.getY())/2,b.target.relatedFeature[0].setGeometry(new a.geometry.Point(V,Q,x.geo.srid)),w=x.geo.getX(),ha=x.geo.getY(),Q=b.target.relatedFeature[1].geo.getX(),pa=b.target.relatedFeature[1].geo.getY(),Q=Math.pow(Math.pow((w-Q)/v.resolution,2)+Math.pow((ha-pa)/v.resolution*v.stretchRatio,2),
.5),Q<a.layer.EditableFeature.NEAREST_DISTANCE?b.target.relatedFeature[0].setVisible(!1):b.target.relatedFeature[0].setVisible(!0),b.target.relatedFeature[3]&&(V=x.geo.getX()+(b.target.relatedFeature[3].geo.getX()-x.geo.getX())/2,Q=x.geo.getY()+(b.target.relatedFeature[3].geo.getY()-x.geo.getY())/2,b.target.relatedFeature[2].setGeometry(new a.geometry.Point(V,Q,x.geo.srid)),Q=b.target.relatedFeature[3].geo.getX(),pa=b.target.relatedFeature[3].geo.getY(),Q=Math.pow(Math.pow((w-Q)/v.resolution,2)+Math.pow((ha-
pa)/v.resolution*v.stretchRatio,2),.5),Q<a.layer.EditableFeature.NEAREST_DISTANCE?b.target.relatedFeature[2].setVisible(!1):b.target.relatedFeature[2].setVisible(!0))}else if("Polygon"===B.geo.type||"LineString"===B.geo.type||"MultiPolygon"===B.geo.type||"MultiLineString"===B.geo.type){ua=b.target.relatedFeature[0];Aa=b.target.relatedFeature[3];Ba=ta=b.target.relatedFeature[4];Ta=Aa;Ja=ua;ha=a.event.LayerEvent;z.shapePoints[ta][Aa].splice(ua+1,0,x);x.setRenderingStyle(n.pointStyle);x.addListener(ha.FEATURE_MOVING,
x.possiblePointMoving);x.addListener(ha.FEATURE_MOVING,x.shapePointMoving);x.deleteListener(ha.FEATURE_MOVED,x.possiblePointMoved);x.addListener(ha.FEATURE_MOVED,x.shapePointMoved);x.addListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,x.showContextMenu);for(w=0;w<z.shapePoints[ta][Aa].length;w++)z.shapePoints[ta][Aa][w].id=B.id+"shapePoints"+ta+"_"+Aa+"_"+w;p=b.target.relatedFeature[1].geo.getX();w=b.target.relatedFeature[1].geo.getY();V=b.target.relatedFeature[2].geo.getX();Q=b.target.relatedFeature[2].geo.getY();
p=[p+(V-p)/2,w+(Q-w)/2];w=b.target.relatedFeature[1].geo;Q=x.geo;V=w.getX()+(Q.getX()-w.getX())/2;Q=w.getY()+(Q.getY()-w.getY())/2;V=new a.layer.EditableFeature(B.id+"possiblePoints"+ta+"_"+Aa+"_"+ua,new a.geometry.Point(V,Q,x.geo.srid),{renderingStyle:n.pointStyle});V.parentFeature=B;V.addListener(ha.FEATURE_MOVING,V.possiblePointMoving);V.addListener(ha.FEATURE_MOVED,V.possiblePointMoved);J.addFeature(V);z.possiblePoints[ta][Aa].splice(ua,1,V);w=x.geo.getX();ha=x.geo.getY();Q=b.target.relatedFeature[1].geo.getX();
pa=b.target.relatedFeature[1].geo.getY();Q=Math.pow(Math.pow((w-Q)/v.resolution,2)+Math.pow((ha-pa)/v.resolution*v.stretchRatio,2),.5);Q<a.layer.EditableFeature.NEAREST_DISTANCE?V.setVisible(!1):V.setVisible(!0);V=x.geo.getX()+(b.target.relatedFeature[2].geo.getX()-x.geo.getX())/2;Q=x.geo.getY()+(b.target.relatedFeature[2].geo.getY()-x.geo.getY())/2;V=new a.layer.EditableFeature(B.id+"possiblePoints"+ta+"_"+Aa+"_"+z.possiblePoints[ta][Aa].length,new a.geometry.Point(V,Q,x.geo.srid),{renderingStyle:n.pointStyle});
V.parentFeature=B;V.addListener(a.event.LayerEvent.FEATURE_MOVING,V.possiblePointMoving);V.addListener(a.event.LayerEvent.FEATURE_MOVED,V.possiblePointMoved);J.addFeature(V);z.possiblePoints[ta][Aa].splice(ua+1,0,V);Q=b.target.relatedFeature[2].geo.getX();pa=b.target.relatedFeature[2].geo.getY();Q=Math.pow(Math.pow((w-Q)/v.resolution,2)+Math.pow((ha-pa)/v.resolution*v.stretchRatio,2),.5);Q<a.layer.EditableFeature.NEAREST_DISTANCE?V.setVisible(!1):V.setVisible(!0);v=0;for(ua=z.possiblePoints.length;v<
ua;v++)for(w=0,Aa=z.possiblePoints[v].length;w<Aa;w++)for(ha=0,ta=z.possiblePoints[v][w].length;ha<ta;ha++)z.possiblePoints[v][w][ha].id=B.id+"possiblePoints"+v+"_"+w+"_"+ha,z.possiblePoints[v][w][ha].setRenderingStyle(n.possibleStyle)}n=B.geo.getOrdinates();ta=[];v=0;for(ua=z.shapePoints.length;v<ua;v++)for(ta[v]=[],w=0,Aa=z.shapePoints[v].length;w<Aa;w++){ta[v][w]=[];ha=0;for(V=z.shapePoints[v][w].length;ha<V;ha++)if(Q=z.shapePoints[v][w][ha].geo,ta[v][w].push(Q.getX()),ta[v][w].push(Q.getY()),
2<K)for(Q=0,!c&&ha>Ja+1&&v===Ba&&w===Ta&&Q--,pa=2;pa<K;pa++){var vb=0;c||ha!==Ja+1||v!==Ba||w!==Ta?("MultiPolygon"===B.geo.type&&(vb=n[v][w][(ha+Q)*K+pa]),"Polygon"===B.geo.type?vb=n[w][(ha+Q)*K+pa]:"LineString"===B.geo.type?vb=n[(ha+Q)*K+pa]:"MultiLineString"===B.geo.type&&(vb=n[w][(ha+Q)*K+pa]),ta[v][w].push(vb)):ta[v][w].push(0)}if(("Polygon"===B.geo.type||"MultiPolygon"===B.geo.type)&&z.shapePoints[v][w]instanceof Array&&(ha=z.shapePoints[v][w][0].geo,ta[v][w].push(ha.getX()),ta[v][w].push(ha.getY()),
2<K))for(ha=2;ha<K;ha++)V=0,V="MultiPolygon"===B.geo.type?n[v][w][n[v][w].length-K+ha]:n[w][n[w].length-K+ha],ta[v][w].push(V)}var xb;"MultiPolygon"===B.geo.type&&(xb=new a.geometry.MultiPolygon(ta,B.geo.srid,K));"Polygon"===B.geo.type?xb=new a.geometry.Polygon(ta[0],B.geo.srid,K):"LineString"===B.geo.type?xb=new a.geometry.LineString(ta[0][0],B.geo.srid,K):"MultiLineString"===B.geo.type&&(xb=new a.geometry.MultiLineString(ta[0],B.geo.srid,K));z=xb.clone();xb=[];xb.push(B);K={};K[B.id]=z;if(B.parentLayer.hasSharedBoundary()&&
(z=B.parentLayer.parentMap.getScreenLocation(x.geo),Ba=B.parentLayer.parentMap.getScreenPointLocation(z.x-3,z.y-3),z=x.geo.getX()-Ba.coordinates[0],Ba=Ba.coordinates[1]-x.geo.getY(),z=Math.sqrt(z*z+Ba*Ba),p=a.edit.GeometrySegmentUtil.getLayerSegmentPoints(B.parentLayer,[p[0],p[1]],z,!1,!1,!1,!1),a.notNull(p)))for(z=0;z<p.length;z++)Ba=p[z].getFeature().id,Ba!==B.id&&(Ta=p[z].getPointLocation(),Ja=p[z].getFeature().getGeometry().clone(!0),2===Ta?(p[z].setPoint([x.geo.getX(),x.geo.getY()]),a.edit.GeometrySegmentUtil.addVertexToGeometry(Ja,
p[z])&&(xb.push(p[z].getFeature()),K[Ba]=Ja)):a.edit.GeometrySegmentUtil.moveGeometryVertex(Ja,p[z],[x.geo.getX(),x.geo.getY()])&&(xb.push(p[z].getFeature()),K[Ba]=Ja));if(a.notNull(B.parentLayer.changeManager)){x=a.edit.EditChangeEvent;1<xb.length&&B.parentLayer.getUndoManager().startChangeBlock("feature point move");for(p=0;p<xb.length;p++)z=xb[p],a.isNull(K[z.id])||(Ba=B.parentLayer.changeManager.updateFeature(z.id,z,K[z.id],x.SPATIAL_UPDATE),a.notNull(Ba)&&B.registerUpdate(Ba,z,B,"feature point move"));
1<xb.length&&B.parentLayer.getUndoManager().endChangeBlock("feature point move")}B.activeIdx=null;for(x=0;x<xb.length;x++)p=xb[x],p.setGeometry(K[p.id]),B.parentLayer.parentMap.wraparound&&(p.parentLayer.refresh(),B.parentLayer.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh());a.notNull(J)&&L&&J.refresh();this.addResizeHandles()}}});a.layer.EditableFeature.MARKER_SIZE=10;a.layer.EditableFeature.NEAREST_DISTANCE=35;if(a.browser.touchSupported||a.gv.isWin8Touch)a.layer.EditableFeature.MARKER_SIZE=
20,a.layer.EditableFeature.NEAREST_DISTANCE=50;a.layer.EditableFeature.POINT_BACKGROUND=new a.style.Marker({width:30,height:30,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:30,height:30},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1,fillOpacity:0,strokeOpacity:0}}]});a.layer.EditableFeature.ORIENTEDPOINT_BACKGROUND=new a.style.Marker({width:70,height:70,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:70,height:70},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1,fillOpacity:0,
strokeOpacity:0}}]});a.layer.EditableFeature.ORIENTATION_POINT_STYLE=new a.style.Marker({styleName:"_orientationPointStyle",width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"circle",cx:a.layer.EditableFeature.MARKER_SIZE/2,cy:a.layer.EditableFeature.MARKER_SIZE/2},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});a.layer.EditableFeature.ORIENTATION_LINE_STYLE=new a.style.Line({styleName:"_orientationLinetyle",stroke:"#0000ff",
strokeThickness:1});a.layer.EditableFeature.pointStyle=new a.style.Marker({width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});a.layer.EditableFeature.possibleStyle=new a.style.Marker({width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"rectangle",
x:0,y:0,width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1,fillOpacity:.4,strokeOpacity:.4}}]});a.layer.EditableFeature.resizeHandleStyle=new a.style.Marker({width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#ff00ff",
strokeThickness:1,fillOpacity:.4,strokeOpacity:.4}}]});a.layer.EditableFeature.rotateHandleStyle=new a.style.Marker({width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"circle",cx:0,cy:0,width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#ff00ff",strokeThickness:1,fillOpacity:.4,strokeOpacity:.4}}]});a.layer.EditableFeature.bgPolyStyle=new a.style.Color({styleName:"polygonToolStyle",
fillOpacity:0,fill:"#8D8DFF",stroke:"#C0C0C0",strokeThickness:15,strokeOpacity:0});a.layer.EditableFeature.bgLineStyle=new a.style.Line({styleName:"polygonToolStyle",fillOpacity:0,fill:"#8D8DFF",stroke:"#C0C0C0",strokeThickness:15,strokeOpacity:0});a.layer.EditableFeature.textStyle=new a.style.Text({styleName:"editableTextStyle",fill:"#000000",stroke:"#C0C0C0",fontFamily:"Arial",fontStyle:a.Text.FONTSTYLE_ITALIC});a.layer.XMLMapLayer=a.layer.Layer.extend({setXMLRequest:function(a){this.xmlRequest=
a}});a.layer.OSMTileLayer=a.layer.TileLayer.extend({initialize:function ia(b,c,L,J){ia.base.call(this,b,{tileLayerConfig:a.layer.TileLayerConfig.CONFIG_OSM,getTileURL:function(b,x,n,p){n=this.tileLayerConfig.tileImageHeight;var v=this.tileLayerConfig.zoomLevels[b];p=(this.tileLayerConfig.bounds.getMaxY()-p.getMaxY())/v.resolution/n;n=null;if(a.isNull(c)){n="a";switch((x+p)%3){case 1:n="b";break;case 2:n="c"}n="http://"+n+".tile.openstreetmap.org/"+b+"/"+x+"/"+p+".png"}else n=(x+p)%c.length,n=c[n],
n=!0===this.isInZYXOrder?n+"/"+b+"/"+p+"/"+x:n+"/"+b+"/"+x+"/"+p,n=a.isNull(L)?n+".png":"."===L[0]?n+L:n+("."+L);if(a.notNull(J)){b="?";for(var V in J)J.hasOwnProperty(V)&&(n=n+b+V+"\x3d"+J[V],b="\x26")}return n}})},setInZYXOrder:function(a){if(!0===a||"true"===a.toLowerCase)this.isInZYXOrder=!0}});a.layer.Menu=a.Class.extend({initialize:function(b,c){var B=this;this.map=b;this.menuId="menu_0";this.menuTableId="mvmenu_table_0";this.menuTableBodyId="mvmenu_table_body_0";this.show=!1;this.location=
c;for(var L=0;L<this.map.decorationArray.length;L++)this.map.decorationArray[L]&&"menu_0"==this.map.decorationArray[L].sblx&&this.map.removeMapDecoration(this.map.decorationArray[L]);this.menu=new a.control.MapDecoration("\x3ctable id\x3d'"+this.menuTableId+"' cellpadding\x3d0 cellspacing\x3d0 style\x3d'width:0px'\x3e\x3ctr\x3e\x3ctd style\x3d'border-width:0px;border-style:solid;border-color:black;background-color:white'\x3e\x3ctable width\x3d100%\x3e\x3ctbody id\x3d'"+this.menuTableBodyId+"'\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
{offsetX:c.left,offsetY:c.top},{draggable:!0,panelOptions:{style:{"border-style":"solid","border-color":"#0000ff","border-width":"1px",backgroundColor:"#FDFDFD",filter:"alpha(Opacity\x3d80)","-moz-opacity":"0.8",opacity:"0.8"}}});this.menu.sblx="menu_0";this.map.addMapDecoration(this.menu);a.layer.Menu.count+=1;this.removeRightClickMenu=function(){B.menu&&B.show&&(B.map.removeMapDecoration(B.menu),B.map.deleteListener(a.event.MouseEvent.MOUSE_CLICK,B.removeRightClickMenu),B.menu=null,B.show=!1)};
this.map.on(a.event.MouseEvent.MOUSE_CLICK,B.removeRightClickMenu)},addMenuItem:function(b,c){var B=document.getElementById(this.menuTableBodyId);document.getElementById(this.menuTableId).style.width=12*b.length+"px";var L=document.createElement("tr");B.appendChild(L);L.style.fontFamily="Arial, Helvetica, Geneva, sans-serif";L.style.fontSize="12px";L.style.cursor="pointer";L.align="center";B=document.createElement("td");B.innerHTML=b;L.appendChild(B);L.onmouseover=function(){this.style.backgroundColor=
"#336699";this.style.color="#ffffff"};L.onmouseout=function(){this.style.backgroundColor="transparent";this.style.color="#000000"};if(c){var B=function(a){a.stopPropagation();a.preventDefault();J.removeRightClickMenu();c()},J=this;a.browser.touchSupported?a.$(L).bind("touchstart",B):a.$(L).mousedown(B)}}});a.layer.Menu.count=0;a.layer.VectorLayerHeatMap=a.Class.extend({initialize:function(b,c){this.opacity=b&&0<b.opacity&&1>b.opacity?b.opacity:1;a.browser.android&&4>=a.browser.androidVersion&&(this.opacity=
1);this.initColor(b.colorStops);this.vectorLayer=c;this.maxValue=b.maxValue;this.minValue=b.minValue;this.loadingBoundaray=!1;this.scale=b.sampleFactor;this.bigCanvas=this.smallCanvas=null;var B=this;(this.containerVectorLayer=b.containerVectorLayer)&&a.isNull(this.containerVectorLayer.serverURL)&&(this.containerVectorLayer.serverURL=c.parentMap.mapviewerURL);if(this.containerVectorLayer&&!this.containerVectorLayer.dataLoaded&&!this.containerVectorLayer.loading&&!this.containerVectorLayer.usedInOverview)B.containerVectorLayer.parentMap=
B.vectorLayer.parentMap,B.loadingBoundaray=!0,B.containerVectorLayer.dataBufferWindow=B.vectorLayer.dataBufferWindow,B.containerVectorLayer.getThemeData(null,function(){B.containerVectorLayer.loading=!1;B.loadingBoundaray=!1},function(){B.containerVectorLayer.loading=!1;B.loadingBoundaray=!1});else if(this.containerVectorLayer){B.loadingBoundaray=!0;var L=function(){B.containerVectorLayer.dataLoaded?B.loadingBoundaray=!1:setTimeout(L,100)};L()}},init:function(a,b,c,L,J){this.realWidth=a;this.realHeight=
b;this.width=a;this.height=b;1<this.scale&&(this.width=a/this.scale,this.height=b/this.scale);this.width|=0;this.height|=0;this.minX=c;this.minY=L;this.data=[];this.realMaxValue=Number.NEGATIVE_INFINITY;this.realMinValue=Number.POSITIVE_INFINITY;a=J/this.scale;this.radius=1<a?Math.floor(a):1;50<this.radius&&(this.radius=50);this.smallCanvas&&(a=this.smallCanvas,a.width!==this.width||a.height!==this.height)&&(this.smallCanvas=null);this.sX=parseInt(c/this.scale);this.sY=parseInt(L/this.scale)},addData:function(a,
b,c){this.data[a]||(this.data[a]=[]);this.data[a][b]||(this.data[a][b]={num:0,value:0});var L=this.data[a][b].num;c=this.isValued?(this.data[a][b].value*L+c)/(L+1):this.data[a][b].value+c;this.data[a][b]={num:L+1,value:c};c>this.realMaxValue&&(this.realMaxValue=c);c<this.realMinValue&&(this.realMinValue=c)},drawHeatMap:function(b){this.numClass=this.origNum;this.max=this.realMaxValue;this.min=this.realMinValue;a.notNull(this.maxValue)&&(this.max=this.maxValue,this.maxValue<this.realMaxValue&&this.numClass--);
a.notNull(this.minValue)&&(this.min=this.minValue,this.minValue>this.realMinValue&&this.numClass--);0>=this.numClass&&(this.numClass=1);this.step=(this.max-this.min)/this.numClass;var c=this.drawShrunkenMap(),B=document.createElement("canvas");B.width=this.realWidth;B.height=this.realHeight;var L=B.getContext("2d");(!a.browser.android||4<a.browser.androidVersion)&&this.clip(L);if(1<this.scale){var J=Math.round(this.scale/2);L.drawImage(c,0,0,this.width,this.height,0-J,0-J,this.realWidth-this.scale/
2,this.realHeight-this.scale/2)}else L.drawImage(c,0,0,this.width,this.height,0,0,this.realWidth,this.realHeight);b(B)},initColor:function(a){var b=document.createElement("canvas");b.width="1";b.height="256";for(var b=b.getContext("2d"),c=b.createLinearGradient(0,0,1,256),L=a.length,J=0;J<L;J++)c.addColorStop(J/L,a[J]);b.fillStyle=c;b.fillRect(0,0,1,256);this.colorData=b.getImageData(0,0,1,256).data;this.origNum=L},drawShrunkenMap:function(){var b=this.smallCanvas;b||(b=document.createElement("canvas"),
b.width=this.width,b.height=this.height,this.smallCanvas=b);var c=b.getContext("2d");c.clearRect(0,0,b.width,b.height);console&&console.time&&a.util.Logger.finest("","OM.VectorLayerHeatMap.drawShrunkenMap",console.time("computingHeatMap"));this.isValued?this.metricHeatMap3(b,c):this.classicalHeatMap(c);for(var B=c.getImageData(0,0,this.width,this.height),L=B.data,J=L.length,K=3;K<J;K+=4){var z=L[K];0!==z&&(z*=4,L[K-3]=this.colorData[z],L[K-2]=this.colorData[z+1],L[K-1]=this.colorData[z+2],L[K]=255*
this.opacity)}console&&console.timeEnd&&a.util.Logger.finest("","OM.VectorLayerHeatMap.drawShrunkenMap",console.timeEnd("computingHeatMap"));B.data=L;c.putImageData(B,0,0);return b},classicalHeatMap:function(a){for(var b=0;b<this.width;b++)for(var c=0;c<this.height;c++){var L=b+this.sX,J=c+this.sY;this.data[L]&&this.data[L][J]&&(L=this.data[L][J].value/this.max,J=a.createRadialGradient(b,c,0,b,c,this.radius),J.addColorStop(0,"rgba(0,0,0,"+L+")"),J.addColorStop(1,"rgba(0,0,0,0)"),a.fillStyle=J,a.beginPath(),
a.arc(b,c,this.radius,0,2*Math.PI,!0),a.closePath(),a.fill())}},metricHeatMap:function(a){var b=this.radius;3>b&&(b=3);var c=document.createElement("canvas");c.width=2*b;c.height=2*b;for(var L=c.getContext("2d"),J=0;J<this.width;J++)for(var K=0;K<this.height;K++){var z=J+this.sX,n=K+this.sY;if(this.data[z]&&this.data[z][n]){z=this.data[z][n].value/this.max;n=L.createRadialGradient(b,b,0,b,b,b);n.addColorStop(0,"rgba(0,0,0,"+z+")");n.addColorStop(1,"rgba(0,0,0,0)");L.fillStyle=n;L.beginPath();L.arc(b,
b,b,0,2*Math.PI,!0);L.closePath();L.fill();for(var z=L.getImageData(0,0,2*b,2*b).data,n=a.getImageData(J-b,K-b,2*b,2*b),p=n.data,v=3,V=z.length;v<V;v+=4)p[v]=Math.max(z[v],p[v]);n.data=p;a.putImageData(n,J-b,K-b);L.clearRect(0,0,c.width,c.height)}}},metricHeatMap2:function(a,b){var c=this.radius;3>c&&(c=3);var L=document.createElement("canvas"),J=2*c;L.width=J;L.height=J;for(var L=L.getContext("2d"),K=b.getImageData(0,0,a.width,a.height),z=K.data,n=a.width,p=0;p<this.width;p++)for(var v=0;v<this.height;v++){var V=
p+this.sX,Q=v+this.sY;if(this.data[V]&&this.data[V][Q]){V=this.data[V][Q].value/this.max;Q=L.createRadialGradient(c,c,0,c,c,c);Q.addColorStop(0,"rgba(0,0,0,"+V+")");Q.addColorStop(1,"rgba(0,0,0,0)");L.fillStyle=Q;L.beginPath();L.arc(c,c,c,0,2*Math.PI,!0);L.closePath();L.fill();for(var w=L.getImageData(0,0,2*c,2*c).data,Q=0;Q<J;Q++)for(V=0;V<J;V++){var ha=4*((v-c+Q)*n+(p-c+V));0>ha||(z[ha+3]=Math.max(w[4*(Q*J+V)+3],z[ha+3]))}L.clearRect(0,0,J,J)}}K.data=z;b.putImageData(K,0,0)},metricHeatMap3:function(a,
b){var c=this.radius;3>c&&(c=3);var L=document.createElement("canvas"),J=2*c;L.width=J;L.height=J;var K=L.getContext("2d"),L=b.getImageData(0,0,a.width,a.height),z=L.data,n=a.width,p=K.createRadialGradient(c,c,0,c,c,c);p.addColorStop(0,"rgba(0,0,0,1)");p.addColorStop(1,"rgba(0,0,0,0)");K.fillStyle=p;K.beginPath();K.arc(c,c,c,0,2*Math.PI,!0);K.closePath();K.fill();K=K.getImageData(0,0,2*c,2*c).data;for(p=0;p<this.width;p++)for(var v=0;v<this.height;v++){var V=p+this.sX,Q=v+this.sY;if(this.data[V]&&
this.data[V][Q]){var w=this.data[V][Q].value/this.max;1<w&&(w=1);for(Q=0;Q<J;Q++)for(V=0;V<J;V++){var ha=4*((v-c+Q)*n+(p-c+V));0>ha||(z[ha+3]=Math.max(parseInt(K[4*(Q*J+V)+3]*w),z[ha+3]))}}}L.data=z;b.putImageData(L,0,0)},clip:function(b){if(this.containerVectorLayer){var c=this.vectorLayer.parentMap.getMapContext().getTransform(),B=this.containerVectorLayer.size();if(0===B)this.clipByBounds(b);else{b.beginPath();for(var L=0;L<B;L++){var J=this.containerVectorLayer.featureArray[L].getGeometry(),K=
J.getMBR(),z=this.vectorLayer.dataBufferWindow;if(!a.notNull(K)||!(K.maxX<z.x||K.maxY<z.y||K.minX>z.x+z.w||K.minY>z.y+z.h)){var n,p,v;if("Polygon"===J.type)for(K=J.coordinates.slice(0),n=0;1>n;n++){if(z=K[n].slice(0),z=c.transformHeatMapSegment(z,1,J.dim,this.minX,this.minY,1))if(p=z.length,!(6>p))for(b.moveTo(z[0],z[1]),v=2;v<p;v+=2)b.lineTo(z[v],z[v+1])}else if("MultiPolygon"===J.type){var K=J.coordinates.slice(0),V=K.length;for(n=0;n<V;n++)if(z=K[n][0].slice(0),z=c.transformHeatMapSegment(z,1,
J.dim,this.minX,this.minY,1))if(p=z.length,!(6>p))for(b.moveTo(z[0],z[1]),v=2;v<p;v+=2)b.lineTo(z[v],z[v+1])}}}b.closePath();b.clip()}}else this.clipByBounds(b)},clipByBounds:function(a){var b=this.vectorLayer.parentMap.getMapContext(),c=b.getTransform(),b=b.getUniverse().getMapBounds().coordinates.slice(0),b=c.transformHeatMapSegment(b,1,2,this.minX,this.minY,1);4>b.length||(a.beginPath(),a.moveTo(b[0],b[1]),a.lineTo(b[0],b[3]),a.lineTo(b[2],b[3]),a.lineTo(b[2],b[1]),a.closePath(),a.clip())},getPixelValue:function(b){b>
this.max&&a.notNull(this.maxValue)&&(b=this.max);b<this.min&&a.notNull(this.minValue)&&(b=this.min);b=parseInt((b-this.min)/this.step);b=4*parseInt(255*b/this.numClass);return{r:this.colorData[b],g:this.colorData[b+1],b:this.colorData[b+2]}},getRadius:function(a,b){return a+parseInt((b-this.min)/((this.max-this.min)/3))},calculate:function(a,b,c,L){3>L&&(L=3);L=this.getRadius(L,a[b][c].value);for(var J=-L;J<=L;J++){var K=c+J;if(!(0>K))for(var z=Math.sqrt(L*L-J*J),n=Math.floor(b-z),z=Math.ceil(b+z),
n=0>n?0:n;n<=z;n++)if(a[n]||(a[n]=[]),b!=n||c!=K){var p=Math.sqrt((n-b)*(n-b)+J*J);if(!(p>L)){var v=a[b][c].num*Math.sqrt((L-p)/L),p=a[b][c].value*Math.sqrt((L-p)/L);a[n][K]?(v=a[n][K].num+v,p>a[n][K].value&&(a[n][K]={num:v,value:p})):a[n][K]={num:v,value:p}}}}}});a.layer.MultiFeature=a.Class.extend({initialize:function(a){this.fList=a},add:function(a){this.fList?this.fList.push(a):this.fList=[a]},createFeature:function(b,c){var B=this.fList.length,L=new a.Feature(b,this.fList[0].geo,{renderingStyle:c});
L.setMarkerText(B+"");return L}});a.layer.VectorLayerMultiFeature=a.Class.extend({initialize:function(b){this.vectorLayer=b;this.mfList=[];this.group=b.parentMap.graphics.createGroup();b.group.appendChild(this.group);var c=this;b.parentMap.graphics.attachEventListener(a.event.MouseEvent.MOUSE_LEAVE,function(){c.clear()},this.group)},checkLocation:function(){for(var b=this.vectorLayer.featureArray,c=0,B=b.length;c<B-1;c++)if((!this.vectorLayer.mapping||b[c].mapping||this.vectorLayer.nsdp.fullDisplay)&&
!b[c].multi&&b[c].geo&&b[c].geo.type===a.GeomTypes.POINT){for(var L=b[c].geo.coordinates[0],J=b[c].geo.coordinates[1],K=null,z=c+1;z<B;z++)if((!this.vectorLayer.mapping||b[z].mapping||this.vectorLayer.nsdp.fullDisplay)&&!b[z].multi&&b[z].geo&&b[z].geo.type===a.GeomTypes.POINT){var n=b[z].geo.coordinates[1];L===b[z].geo.coordinates[0]&&J===n&&(K?K.add(b[z]):K=new a.layer.MultiFeature([b[c],b[z]]),b[c].multi=b[z].multi=!0)}K&&this.mfList.push(K)}},display:function(){for(var b=this,c=function(c,J){return function(){J.graphics.attachEventListener(a.event.MouseEvent.MOUSE_ENTER,
function(){b.showFeatures(c.fList,J.screenPoints)},J.shape)}()},B=function(a){a=a.target;var c=a.mf;c.open?b.clear():(b.showFeatures(c.fList,a.screenPoints),c.open=!0)},L=0,J=this.mfList.length;L<J;L++){var K=this.mfList[L];K.open=!1;var z=K.createFeature("_mul"+L,this.vectorLayer.mfMarker);z.mf=K;z.group=this.vectorLayer.realGroup;z.screenTransformObj=this.vectorLayer.parentMap.getMapContext().getTransform();z.graphics=this.vectorLayer.parentMap.graphics;z.parentLayer=this.vectorLayer;z.displayFeature([this.vectorLayer.mfMarker]);
a.browser.touchSupported?z.addListener(a.event.MouseEvent.MOUSE_CLICK,B,z.shape):c(K,z)}},showFeatures:function(b,c){var B=b.length;if(!(2>B)){var L=this.vectorLayer.parentMap.graphics;this.clear();var J=2*Math.PI/B,K=this.algorith1;J<Math.PI/5&&(K=this.algorith2,J=Math.PI/5);this.group.applyStyle({opacity:1});this.lineGroup=L.createGroup();this.markerGroup=L.createGroup();this.markerGroup.applyStyle({cursor:this.vectorLayer.mouseCursor});this.group.appendChild(this.lineGroup);this.group.appendChild(this.markerGroup);
this.group.parentNode||(this.vectorLayer.group.appendChild(this.group),L.sendToBottom(this.group));for(var z=function(a,b){return function(){b.vectorLayer.showInfoWindow(a,a.getGeometry());b.clear();L.clearToolTips()}},n=0;n<B;n++){var p=J*n+Math.PI/2,v=K(n),V=Math.cos(p)*v.r1+c.x,Q=-Math.sin(p)*v.r1+c.y,w=Math.cos(p)*v.r2+c.x,p=-Math.sin(p)*v.r2+c.y,v=b[n];L.drawPath([[V,Q,w,p]],{stroke:"#003286",strokeThickness:1},{group:this.lineGroup});v.screenPoints={x:w,y:p};v.parentLayer=this.vectorLayer;this.vectorLayer.getFeatureStyles(v).draw(v,
this.vectorLayer.parentMap.getMapContext(),{group:this.markerGroup,type:v.geo.type,screenPoints:{x:w,y:p}});v.displayed=!0;v.applyToolTip();a.browser.touchSupported?L.attachEventListener(a.event.MouseEvent.TOUCH_TAP,z(v,this),v.shape):L.attachEventListener(a.event.MouseEvent.MOUSE_CLICK,z(v,this),v.shape)}B=2*K(n).r2;B=L.drawEllipse({cx:c.x,cy:c.y,width:B,height:B},{fill:"#ffffff",fillOpacity:0},{group:this.group});L.sendToBottom(B)}},algorith1:function(){return{r1:15,r2:30}},algorith2:function(a){return{r1:15,
r2:30+3*a}},clear:function(){for(var a=0,b=this.mfList.length;a<b;a++)this.mfList[a].open=!1;this.vectorLayer.parentMap.graphics.clearGroup(this.group)},destroy:function(){for(var a=this.mfList.length-1;0<=a;a--){var b=this.mfList[a];b.shape=null;b.screenPoints=null;b.parentLayer=null;b.graphics=null;this.mfList.pop()}this.vectorLayer.parentMap.graphics.clearGroup(this.group)}});a.layer.KMLParser=a.Class.extend({initialize:function(a){this.vLayer=a;this.minY=this.minX=Number.POSITIVE_INFINITY;this.maxY=
this.maxX=Number.NEGATIVE_INFINITY},parse:function(b,c){var B=0,L=this.vLayer;L.featureArray=[];var J=this;b.find("Placemark").each(function(){var b=a.$(this),c="KML"+B,n=J.parseExtendedData(b),K=b.find("name").text(),x=b.find("addresss").text(),z=b.find("phoneNumber").text();a.notNull(K)&&""!==K&&(n.name=K);a.notNull(x)&&""!==x&&(n.address=x);a.notNull(z)&&""!==z&&(n.phone=z);K=b.find("gx\\:Track, Track");x=0;for(z=K.length;x<z;x++){var ia=J.parseTrack(a.$(K[x]),c,n);0<ia.length&&(L.addFeatures(ia),
B++)}var K=b.find("MultiGeometry"),ua;if(0<K.length){var Aa=[],ta,Ba=[];K.children().each(function(){var b=J.parseSimpleGeometry(a.$(this));b&&(Aa.push(b),Ba.push(b.getOrdinates()),ta?ta!==b.getType()&&(ta="GeometryCollection"):ta=b.getType())});1<Aa.length&&("GeometryCollection"==ta?ua=new a.geometry.GeometryCollection(Aa,8307):"Point"==ta?ua=new a.geometry.MultiPoint(Ba,8307):"LineString"==ta?ua=new a.geometry.MultiLineString(Ba,8307):"Polygon"==ta&&(ua=new a.geometry.MultiPolygon(Ba,8307)),ua.dimension=
Aa[0].dimension)}else ua=J.parseSimpleGeometry(b);ua&&(b=new a.Feature(c,ua,{attributes:n}),L.featureArray.push(b),B++)});L.dataLoaded=!0;if(!L.featureArray||0===L.featureArray.length)return!1;var K=a.event,z=function(a){var b=new K.LayerEvent(K.LayerEvent.FEATURES_LOADED,L);b.mapContext=L.parentMap.getMapContext();L.fire(K.LayerEvent.FEATURES_LOADED,b);c(a)},n=L.parentMap.getMapContext().getUniverse().getSRID();8307!==n?(new a.geometry.Rectangle(this.minX,this.minY,this.maxX,this.maxY,8307)).transform(n,
function(a){a=[a.getMinX(),a.getMinY(),a.getMaxX(),a.getMaxY()];z(a)}):z([this.minX,this.minY,this.maxX,this.maxY]);return!0},parseSimpleGeometry:function(b){var c=b.find("coordinates"),B;if(0<c.length)if(B=c.parent()[0].nodeName,"LinearRing"==B){if(c=b.find("outerBoundaryIs").find("coordinates").text(),a.notNull(c)&&""!==c)return B=this.parseCoordinates(c),c=b.find("innerBoundaryIs").find("coordinates").text(),b=[B.coords],a.notNull(c)&&""!==c&&(c=this.parseCoordinates(c),b.push(c.coords)),b=new a.geometry.Polygon(b,
8307),b.dimension=B.dimension,b}else{c=c.text();if("Point"==B)return b=c.split(","),B=Number(b[0]),b=Number(b[1]),c=new a.geometry.Point(B,b,8307),B<this.minX&&(this.minX=B),B>this.maxX&&(this.maxX=B),b<this.minY&&(this.minY=b),b>this.maxY&&(this.maxY=b),c;if("LineString"==B)return B=this.parseCoordinates(c),b=new a.geometry.LineString(B.coords,8307),b.dimension=B.dimension,b}return null},parseCoordinates:function(a){var b=a.trim().split(/\s+/g)[0].split(",").length;a=a.trim().split(/\s+|,/g);for(var c=
0,L=a.length;c<L;c++)a[c]=Number(a[c]),0===c%b?(a[c]<this.minX&&(this.minX=a[c]),a[c]>this.maxX&&(this.maxX=a[c])):1===c%b&&(a[c]<this.minY&&(this.minY=a[c]),a[c]>this.maxY&&(this.maxY=a[c]));return{coords:a,dimension:b}},parseTrack:function(b,c,B){var L=b.find("when"),J=b.find("gx\\:coord, coord"),K,z,n;if(0<L.length&&0<J.length&&L.length==J.length){var p=[];b=[];for(var v=0,V=L.length;v<V;v++){var Q=a.$(J[v]).text().trim().split(" ");K=Q.length;z=Number(Q[0]);var w=Number(Q[1]),ha=new a.geometry.Point(z,
w,8307);z<this.minX&&(this.minX=z);z>this.maxX&&(this.maxX=z);w<this.minY&&(this.minY=w);w>this.maxY&&(this.maxY=w);z={when:a.$(L[v]).text()};for(n in B)B[n]instanceof Array&&B[n].length>v&&(z[n]=B[n][v]);b.push(new a.Feature(c+"_"+v,ha,{attributes:z}));Array.prototype.push.apply(p,Q)}if(1<V){L=new a.geometry.LineString(p,8307);L.dimension=K;K={};for(n in B)!B[n]instanceof Array&&(z[K]=B[K]);b.splice(0,0,new a.Feature(c+"_"+v,L,{}))}return b}},parseExtendedData:function(b){var c={},B=b.find("ExtendedData").find("Data"),
L,J,K,z,n;L=0;for(J=B.length;L<J;L++){K=a.$(B[L]);z=K.attr("name");var p=K.find("displayName").text();n=K.find("value").text();a.notNull(p)&&""!==p?c[p]=n:c[z]=n}B=b.find("ExtendedData").find("SimpleData");L=0;for(J=B.length;L<J;L++)K=a.$(B[L]),z=K.attr("name"),n=K.find("value").text(),c[z]=n;B=b.find("ExtendedData").find("gx\\:SimpleArrayData, SimpleArrayData");b=function(){n.push(a.$(this).text())};L=0;for(J=B.length;L<J;L++)K=a.$(B[L]),z=K.attr("name"),n=[],K.children().each(b),c[z]=n;return c}});
a.layer.GeoJSONParser=a.Class.extend({initialize:function(a){this.layer=a;this.count=0},parse:function(b,c,B){var L=!b||b.mds_error||b.error;if(L){var J=L.message;(L=L.details)&&(J+=" [details]:"+L);this.layer.dataLoaded=!1;a.util.Logger.severe("MAPVIEWER_9007","OM.layer.VectorLayer.getThemeData",J);B()}else{this.layer.getDataRequest=null;this.parseSRID(b);this.parselayerLevelStyle(b);this.parseEditParameters(b);this.parseFeatures(b);var K=this,z=function(){if(0===K.count){if(!K.layer.dataLoaded){K.layer.dataLoaded=
!0;var J=a.event,p=new J.LayerEvent(J.LayerEvent.FEATURES_LOADED,K.layer);p.mapContext=K.layer.parentMap.getMapContext();K.layer.fire(J.LayerEvent.FEATURES_LOADED,p)}c(K.bbox);b=null}else setTimeout(z,100)};z()}},parseSRID:function(b){this.srid=b.srs;!this.srid&&b.crs&&"name"===b.crs.type&&b.crs.properties&&b.crs.properties.name&&(this.srid=a.util.GeomUtil.parseCRSName(b.crs.properties.name));a.isNull(this.srid)&&(this.srid=8307)},parseBBox:function(b){if(this.bbox=b.bbox){b=new a.geometry.Rectangle(this.bbox[0],
this.bbox[1],this.bbox[2],this.bbox[3],this.srid);4<this.bbox.length&&(b=parseInt(this.bbox.length/2),b=new a.geometry.Rectangle(this.bbox[0],this.bbox[1],this.bbox[b],this.bbox[b+1],this.srid));var c=this.layer.parentMap.getMapContext().getUniverse().getSRID();if(this.srid!==c){var B=this;(new a.geometry.LineString([b.getMinX(),b.getMinY(),b.getMaxX(),b.getMaxY()],this.srid)).transform(c,function(b){b=b.coordinates;B.layer.mbr=new a.geometry.Rectangle(b[0],b[1],b[2],b[3],B.srid);B.bbox=[b[0],b[1],
b[2],b[3]];505050===c&&(B.layer.mbr=null,B.bbox=null)})}else this.layer.mbr=b}},parselayerLevelStyle:function(a){!this.layer.renderingStyle&&a.renderStyle&&this.layer.setRenderingStyle({dataSource:this.layer.dataSource,name:a.renderStyle,url:this.layer.serverURL});!this.layer.hoverStyle&&a.hoverStyle&&this.layer.setHoverStyle({dataSource:this.layer.dataSource,name:a.hoverStyle,url:this.layer.serverURL});!this.layer.selectionStyle&&a.selectStyle&&this.layer.setSelectStyle({dataSource:this.layer.dataSource,
name:a.selectStyle,url:this.layer.serverURL});!this.layer.labelingStyle&&a.labelStyle&&this.layer.setLabelingStyle({dataSource:this.layer.dataSource,name:a.labelStyle,url:this.layer.serverURL})},parseEditParameters:function(b){a.notNull(b.not_null_attr_names)?this.layer.notNullAttributes=b.not_null_attr_names:this.layer.notNullAttributes=[];if(!a.isNull(b.edit_properties)){a.isNull(this.layer.keyColumn)&&(this.keyColumn=b.edit_properties.id_attr,a.notNull(this.keyColumn)&&(this.layer.keyColumn=this.keyColumn.toUpperCase()));
this.baseTable=b.edit_properties.base_table;a.notNull(this.baseTable)?this.layer.baseTable=this.baseTable.toUpperCase():this.layer.baseTable=null;a.isNull(this.layer.geometryColumn)&&(this.spatialAttr=b.edit_properties.spatial_attr,a.notNull(this.spatialAttr)&&(this.layer.geometryColumn=this.spatialAttr.toUpperCase()));this.spatialType=b.edit_properties.spatial_type;a.notNull(this.spatialType)?this.layer.spatialType=this.spatialType:this.layer.spatialType="geometry";this.workspace=b.edit_properties.workspace;
a.notNull(this.workspace)?this.layer.workspace=this.workspace.toUpperCase():this.layer.workspace="LIVE";var c=b.attr_names;b=b.attr_types;this.layer.attributeTypes={};if(a.notNull(c)&&a.notNull(b)&&c.length===b.length)for(var B=0;B<c.length;B++){var L=c[B].toUpperCase();this.layer.attributeTypes[L]=b[B]}}},parseFeatures:function(b){var c=this.layer.getSelectedFeatures(),B=b.features,L=B.length,J={};this.layer.featureArray=[];this.layer.mapping=!1;this.layer.attrNames=b.attr_names;this.layer.columnMap=
b.columnMap;var K=this;b=function(b){J[b]||(J[b]=b,K.count++,a.style.StyleStore.getServerSideStyle(K.layer.dataSource,b,{url:K.layer.serverURL,callback:function(b){"undefined"!==typeof a.style.HeatMap&&b instanceof a.style.HeatMap&&!K.layer.renderingStyle&&(K.layer.renderingStyle=b);K.count--}}))};for(var z=0;z<L;z++)try{var n=B[z],p=n.geometry;if(!a.isNull(p)&&!a.$.isEmptyObject(p)){this.layer.type===a.layer.VectorLayer.TYPE_DATAPACK&&(p=a.util.GeomUtil.parseGeoJson(p));var v="undefined"!==typeof n._id?
n._id:z;if(this.layer.loadOnDemand){if(this.layer.featureEditable&&a.notNull(this.layer.changeManager)&&this.layer.changeManager.hasChanges())if(this.layer.changeManager.isModifiedFeature(v)){this.layer.featureArray.push(this.layer.changeManager.modifiedFeatures[v]);this.layer.changeManager.modifiedFeatures[v].rtreeKeys=[];continue}else if(this.layer.changeManager.isRemovedFeature(v))continue;if(a.notNull(c)&&0<c.length){for(var V=-1,Q=0;Q<c.length;Q++)if(c[Q].id===v){V=Q;break}if(-1<V){this.layer.featureArray.push(c[V]);
c[V].rtreeKeys=[];continue}}}p.srid=this.srid;var w=new a.Feature(v,p,{attributes:n.properties});a.notNull(this.layer.columnMap)&&(w.columnMap=this.layer.columnMap);w.srid=this.srid;if(!this.layer.doFilter(w)){w.labelBox=n.label_box;if(this.layer.type!==a.layer.VectorLayer.TYPE_DATAPACK){if(n.styles&&n.styles.rendering&&n.styles.rendering.style){n.styles&&n.styles.rendering&&n.styles.rendering.columns&&(w.columns=n.styles.rendering.columns);var ha=n.styles.rendering.style;w.styleName=ha;b(ha)}n.styles&&
n.styles.labeling&&n.styles.labeling.style&&(n.styles&&n.styles.labeling&&n.styles.labeling.columns&&(w.labelColumn=n.styles.labeling.columns[0]),w.labelStyleName=n.styles.labeling.style,b(w.labelStyleName))}this.layer.featureArray.push(w)}}}catch(pa){a.util.Logger.warning("MAPVIEWER_9101","OM.layer.GeoJsonParser.parseFeatures",pa.message+" (Feature id: "+v+")")}if(this.layer.loadOnDemand&&this.layer.featureEditable&&a.notNull(this.layer.changeManager)){c=this.layer.changeManager.getNewFeatures();
for(B=0;B<c.length;B++)this.layer.featureArray.push(c[B]),c[B].rtreeKeys=[];this.layer.rtree=null;this.layer.segmentRtree={}}}});a.layer.GeoRSSParser=a.Class.extend({initialize:function(a){this.vLayer=a},parse:function(b,c){var B=this.vLayer,L=Number.POSITIVE_INFINITY,J=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY,z=Number.NEGATIVE_INFINITY;B.featureArray=[];var n=B.parentMap.getMapContext().getUniverse().getSRID();a.$(b).find("entry").each(function(){var b=a.$(this),c=b.find("title").text(),
p=b.find("link").attr("href"),n=b.find("id").text(),v=b.find("updated").text(),x=b.find("content").text(),Aa=b.find("summary").text(),ta=b.find("georss\\:point").text();""===ta&&(ta=b.find("point").text());if(a.notNull(ta)&&""!==ta){var ta=ta.split(" "),b=Number(ta[1]),ta=Number(ta[0]),Ba=new a.geometry.Point(b,ta,8307),Ta={};a.notNull(c)&&(Ta._LABEL_=c);a.notNull(p)&&(Ta.link="\x3ca href\x3d'"+p+"' target\x3d'_blank'\x3elink\x3c/a\x3e");a.notNull(v)&&(Ta.updated=v);a.notNull(x)&&(Ta.content=x);a.notNull(Aa)&&
(Ta.summary=Aa);c=new a.Feature(n,Ba,{attributes:Ta});b<L&&(L=b);b>K&&(K=b);ta<J&&(J=ta);ta>z&&(z=ta);B.featureArray.push(c)}});B.dataLoaded=!0;if(!B.featureArray||0===B.featureArray.length)return!1;var p=a.event,v=function(a){var b=new p.LayerEvent(p.LayerEvent.FEATURES_LOADED,B);b.mapContext=B.parentMap.getMapContext();B.fire(p.LayerEvent.FEATURES_LOADED,b);c(a)};8307!==n?(new a.geometry.Rectangle(L,J,K,z,8307)).transform(n,function(a){a=[a.getMinX(),a.getMinY(),a.getMaxX(),a.getMaxY()];v(a)}):
v([L,J,K,z]);return!0}});a.layer.DynamicTileLayer=a.layer.TileLayer.extend({initialize:function x(b,c,J){c=a.$.extend(!0,{},c);if(a.notNull(J)&&"[object Object]"===Object.prototype.toString.call(J))try{c.serverMapRequest=J,a.isNull(c.dataSource)&&(a.notNull(J.dataSource)?c.dataSource=J.dataSource:a.notNull(J.datasource)?c.dataSource=J.datasource:a.util.Logger.warning("MAPVIEWER_9099","OM.layer.DynamicTileLayer.initialize")),a.isNull(c.tileServerURL)&&(a.notNull(J.baseURL)?c.tileServerURL=J.baseURL+
"/omserver":a.util.Logger.warning("MAPVIEWER_9100","OM.layer.DynamicTileLayer.initialize"))}catch(K){a.util.Logger.warning("MAPVIEWER_9082","OM.layer.DynamicTileLayer.initialize")}a.isNull(c.isWMSTileLayer)&&(c.isDynamicTileLayer=!0);a.notNull(c.isDynamicTileLayer&&c.tileServerURL)&&(c.tileServerURL=this.fixTileServerUrl(c.tileServerURL));x.base.call(this,b,c);this.initialize_DTL(c);this.bindingParameters=null},fixTileServerUrl:function(b){if(a.notNull(b)&&-1===b.indexOf("/omserver")){a.util.Logger.warning("MAPVIEWER_9075",
"OM.layer.Tilelayer.initialize");var c=b.indexOf("/mcserver");0<c&&(b=b.substring(0,c)+"/omserver",a.util.Logger.warning("MAPVIEWER_9076","OM.layer.Tilelayer.initialize"))}return b},initialize_DTL:function(b){this.layerType=a.LayerTypes.DYNAMIC_TILE;a.isNull(b.isWMSTileLayer)?this.isDynamicTileLayer=!0:this.isWMSTileLayer=!0;var c;if(a.isNull(b))a.util.Logger.warning("MAPVIEWER_9070","OM.layer.TileLayer.initialize_DTL");else{this.yOffset_DynamicTL=this.xOffset_DynamicTL=0;this.tileLayerConfig={};
if(b.tileLayerConfig){this.tileLayerConfig.tileImageHeight=b.tileLayerConfig.tileImageHeight;this.tileLayerConfig.tileImageWidth=b.tileLayerConfig.tileImageWidth;this.tileLayerConfig.tileImageFormat=b.tileLayerConfig.tileImageFormat;if(a.isNull(this.tileLayerConfig.tileImageFormat)||"PNG"===this.tileLayerConfig.tileImageFormat)this.tileLayerConfig.tileImageFormat="image/png";if(a.isNull(this.tileLayerConfig.tileImageHeight)||a.isNull(this.tileLayerConfig.tileImageWidth)||0>=this.tileLayerConfig.tileImageHeight||
0>=this.tileLayerConfig.tileImageWidth)this.tileLayerConfig.tileImageHeight=256,this.tileLayerConfig.tileImageWidth=256}else c=new a.layer.TileLayerConfig,this.tileLayerConfig.tileImageHeight=c.tileImageHeight,this.tileLayerConfig.tileImageWidth=c.tileImageHeight,this.tileLayerConfig.tileImageFormat="image/png";b.universe?(this.tileLayerConfig.bounds=b.universe.bound,this.tileLayerConfig.srid=b.universe.srid,this.tileLayerConfig.zoomLevels=b.universe.zoomLevels):a.isNull(this.parentMap)?(c=new a.universe.ElocationUniverse,
this.tileLayerConfig.bounds=c.bound,this.tileLayerConfig.srid=c.srid,this.tileLayerConfig.zoomLevels=c.zoomLevels,a.util.Logger.warning("MAPVIEWER_9072","OM.layer.TileLayer.initialize_DTL")):(c=this.parentMap.getMapContext(),a.isNull(c)?a.util.Logger.warning("MAPVIEWER_9084","OM.layer.TileLayer.initialize_DTL"):(c=c.getUniverse(),a.isNull(c)&&(c=new a.universe.ElocationUniverse,a.util.Logger.warning("MAPVIEWER_9072","OM.layer.TileLayer.initialize_DTL")),this.tileLayerConfig.bounds=c.bound,this.tileLayerConfig.srid=
c.srid,this.tileLayerConfig.zoomLevels=c.zoomLevels));a.notNull(b.urlBuilder)&&(this.getURLBuilderURL=b.urlBuilder,a.notNull(b.urlBuilderOptions)&&(this.urlBuilderParams=b.urlBuilderOptions));a.notNull(b.tileURLTemplate)&&this.extractCustomTileURL(b.tileURLTemplate);a.notNull(b.hideInOverviewMap)?this.hideInOverviewMap=b.hideInOverviewMap:this.hideInOverviewMap=!0;this.serverMapRequest=b.serverMapRequest}},getDefaultImgURL:function(b,c,L,J,K,z){var n,p=this.parentMap;a.notNull(this.serverMapRequest)&&
(n=this.serverMapRequest.clone(),n.setImageWidth(b),n.setImageHeight(c),n.setBBox(L,J,K,z,this.tileLayerConfig.srid),b=this.serverURL,a.notNull(this.serverArray)&&(b=this.serverArray[this.serverCounter],this.serverCounter+=1,this.serverCounter%=this.serverArray.length),n.setProperties({isclienttilereq:!0,tileServerURL:b,applicationID:a.notNull(p.applicationID)?p.applicationID:null}),this.enableUTFGrid&&(n.setEnableUTFGrid(!0),n.setUTFGridResolution(this.utfgridResolution)),n=n.toXMLString());return n},
getCustomURL:function(b,c,L){var J;if(a.notNull(this.tileURLTemplate)){J=Math.ceil((this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh)-1;b=a.util.MiscUtil.substituteStr(this.tileURLTemplate,"{x}",""+b);b=a.util.MiscUtil.substituteStr(b,"{y}",""+(J-c));b=a.util.MiscUtil.substituteStr(b,"{z}",""+(L+(a.notNull(this.z_offset)?this.z_offset:0)));if(a.notNull(this.tileCustomURLProps))for(var K in this.tileCustomURLProps)b=a.util.MiscUtil.substituteStr(b,"{"+
K+"}",this.tileCustomURLProps[K]);return b}},getDynamicTL_URL:function(b,c,L){if(this.tileCustomURL)return this.getCustomURL(b,c,L);var J=this.tileLayerConfig.zoomLevels[L];L=this.tileLayerConfig.tileImageWidth;var K=this.tileLayerConfig.tileImageHeight,z=L*J.resolution,J=K*J.resolution*J.stretchRatio;b=this.tileLayerConfig.bounds.getMinX()+b*z;z=b+z;c=this.tileLayerConfig.bounds.getMinY()+c*J;J=c+J;return a.isNull(this.getURLBuilderURL)?this.getDefaultImgURL(L,K,b,c,z,J):this.getURLBuilderURL(L,
K,b,c,z,J,this.urlBuilderParams)},setBindingParameters:function(b){var c=this.serverMapRequest;a.notNull(c)&&c.setBindingParameters(b)},getStaticMapURL:function(b,c){var L=new a.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMinX(),this.parentMap.getMapWindowBoundingBox().getMinY(),this.tileLayerConfig.srid),J=new a.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMaxX(),this.parentMap.getMapWindowBoundingBox().getMaxY(),this.tileLayerConfig.srid);return a.isNull(this.getURLBuilderURL)?
this.getDefaultImgURL(b,c,L.getX(),L.getY(),J.getX(),J.getY()):this.getURLBuilderURL(b,c,L.getX(),L.getY(),J.getX(),J.getY(),this.urlBuilderParams)},extractCustomTileURL:function(b){!0===Array.isArray(b)?(this.checkRequiredPlaceHolders(b[0]),2!==b.length?a.util.Logger.warning("MAPVIEWER_9098","OM.layer.DynamicTileLayer.extractCustomTileURL"):this.tileCustomURLProps=b[1],this.tileURLTemplate=b[0]):(this.checkRequiredPlaceHolders(b),this.tileURLTemplate=b)},checkRequiredPlaceHolders:function(b){var c=
b.toUpperCase().indexOf("{X}"),L=b.toUpperCase().indexOf("{Y}");b=b.toUpperCase().indexOf("{Z}");return 0<c&&0<L&&0<b?!0:(a.util.Logger.warning("MAPVIEWER_9097","OM.layer.DynamicTileLayer.checkRequiredPlaceHolders"),!1)},setZoomLevelOffset:function(a){this.z_offset=a}});a.layer.DynamicTileLayer.combineDTLURLs=function(a){var b=this.combineDTLThemes(a);a=this.combineDTLStyles(a);return b+a};a.layer.DynamicTileLayer.combineDTLThemes=function(b){for(var c="",L=0;L<b.length;L++){var J=b[L],J=decodeURIComponent(J),
K=-1,z=-1,n=-1,p="";a.notNull(J)&&(K=J.indexOf('datasource\x3d"'),0<K&&(z=J.indexOf('"',K),0<z&&(n=J.indexOf(" ",z)),0<K,0<z&&0<n))&&(p=J.substring(z,n));a.isNull(p)&&a.util.Logger.warning("MAPVIEWER_9099","OM.Map.combineDTLThemes","No datasource attribute found in ["+J+"]");n=0;do K=J.indexOf("\x3ctheme ",n),0<K&&(z=J.indexOf("\x3c/theme\x3e",n),0<z&&(c+="\x3ctheme datasource\x3d"+p+" "+J.substring(K+7,z)+"\x3c/theme\x3e",n=z+8));while(0<K)}return a.notNull(c)&&0<c.trim().length?"\x3cthemes\x3e"+
c+"\x3c/themes\x3e":""};a.layer.DynamicTileLayer.combineDTLStyles=function(b){for(var c="",L=0;L<b.length;L++){var J=b[L],J=decodeURIComponent(J),K=-1,z=-1,K=J.indexOf("\x3cstyles\x3e");0<K&&(z=J.indexOf("\x3c/styles\x3e"),0<z&&(c+=J.substring(K+8,z)))}return a.notNull(c)&&0<c.trim().length?"\x3cstyles\x3e"+c+"\x3c/styles\x3e":""};a.layer.WMSTileLayer=a.layer.DynamicTileLayer.extend({initialize:function B(b,c){a.notNull(c)&&(c.isWMSTileLayer=!0);B.base.call(this,b,c);this.initialize_WMSTL(c);this.bindingParameters=
null},initialize_WMSTL:function(b){this.isWMSTileLayer=!0;this.layerType=a.LayerTypes.DYNAMIC_TILE;a.isNull(b)?a.util.Logger.warning("MAPVIEWER_9069","OM.layer.TileLayer.initialize_WMSTL"):(this.serverURL=b.wmsServerURL,a.isNull(this.serverURL)&&a.util.Logger.warning("MAPVIEWER_9066","OM.layer.TileLayer.initialize_WMSTL"),a.isNull(b.urlBuilderOptions)||(this.optParams_WMSTL=b.urlBuilderOptions,a.isNull(this.optParams_WMSTL.layers)&&a.util.Logger.warning("MAPVIEWER_9067","OM.layer.TileLayer.initialize_WMSTL"),
a.isNull(this.optParams_WMSTL.version)&&a.util.Logger.warning("MAPVIEWER_9068","OM.layer.TileLayer.initialize_WMSTL")),a.notNull(b.hideInOverviewMap)?this.hideInOverviewMap=b.hideInOverviewMap:this.hideInOverviewMap=!0)},buildWMSTL_URL:function(b,c,J,K,z,n){var p="";b=this.serverURL+"?request\x3dgetmap\x26bbox\x3d"+J+","+K+","+z+","+n+"\x26width\x3d"+b+"\x26height\x3d"+c;if(!a.isNull(this.optParams_WMSTL))for(var v in this.optParams_WMSTL)p="bgcolor"===v.toLowerCase()?p+"\x26"+v+"\x3d"+encodeURIComponent(this.optParams_WMSTL[v]):
p+"\x26"+v+"\x3d"+this.optParams_WMSTL[v];return b+p},getWMSTL_URL:function(a,b,c){c=this.tileLayerConfig.zoomLevels[c];var K=this.tileLayerConfig.tileImageWidth*c.resolution;c=this.tileLayerConfig.tileImageHeight*c.resolution*c.stretchRatio;a=this.tileLayerConfig.bounds.getMinX()+a*K;K=a+K;b=this.tileLayerConfig.bounds.getMinY()+b*c;return this.buildWMSTL_URL(this.tileLayerConfig.tileImageWidth,this.tileLayerConfig.tileImageHeight,a,b,K,b+c)}});a.layer.WMTSTileLayer=a.layer.TileLayer.extend({initialize:function L(a,
b){var c=b||{};L.base.call(this,a,c);this.initialize_WMTS(c)},initialize_WMTS:function(b){this.layerType=a.LayerTypes.WMTS_TILE;this.getCapabilitiesURL=b.url;this.getTileTemplate=b.getTileTemplate;this.layerID=b.layerID;this.tileMatrixSetID=b.tileMatrixSetID;a.notNull(b.hideInOverviewMap)?this.hideInOverviewMap=b.hideInOverviewMap:this.hideInOverviewMap=!0},buildConfig:function(b){if(null===b)a.util.Logger.warning("","OM.layer.WMTSTileLayer.buildConfig","The WMTS config cannot be null.");else{if(a.notNull(this.getTileTemplate))this.tileURLTemplate=
this.getTileTemplate;else if(b.urls&&0<b.urls.length)this.tileURLTemplate=b.urls[0];else{a.util.Logger.warning("","OM.layer.WMTSTileLayer.buildConfig","The WMTS URL template does not present.");return}this.style=b.style;for(var c=[],K=0,z=b.tileGrid.resolutions.length;K<z;K+=1)c.push(new a.universe.ZoomLevel(b.tileGrid.resolutions[K]));return{srid:b.projection.SRID,bounds:b.projection.bounds,zoomLevels:c,tileImageWidth:b.tileGrid.tileSizes[0],tileImageHeight:b.tileGrid.tileSizes[0]}}},getWMTS_URL:function(b,
c,K){var z;if(a.notNull(this.tileURLTemplate)){z=Math.ceil((this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh-1);b=a.util.MiscUtil.substituteStr(this.tileURLTemplate,"{TileCol}",""+b);b=a.util.MiscUtil.substituteStr(b,"{TileRow}",""+(z-c));b=a.util.MiscUtil.substituteStr(b,"{TileMatrix}",""+(K+(a.notNull(this.z_offset)?this.z_offset:0)));b=a.util.MiscUtil.substituteStr(b,"{style}",this.style);b=a.util.MiscUtil.substituteStr(b,"{TileMatrixSet}",""+this.tileMatrixSetID);
if(a.notNull(this.tileCustomURLProps))for(var n in this.tileCustomURLProps)b=a.util.MiscUtil.substituteStr(b,"{"+n+"}",this.tileCustomURLProps[n]);return b}}});a.layer.VectorTileLayer=a.layer.VectorLayer.extend({initialize:function J(b,c){if(a.isNull(c)||a.isNull(c.def))throw Error("Invalid or null VectorTileLayer options found.");var n=this;c.def.type=a.layer.VectorLayer.TYPE_MAPBOX;var p=c.def;this.options=c;J.base.call(this,b,c);this.type=p.type;this.dataSource=p.dataSource||p.datasource;this.themeName=
p.theme;this.keyColumn=p.keyColumn?p.keyColumn.toUpperCase():null;this.serverURL=p.url;a.isNull(this.serverURL)&&(this.serverURL=a.gv._baseURL);this.featuresMap={};this.tileFeatures={};this.loadTileFeaturesTask=null;a.notNull(this.themeName)&&(a.isNull(this.keyColumn)||a.isNull(this.renderingStyle))&&a.util.HttpRequest.send("/mapviewer/omserver",{xml_request:'\x3cnon_map_request\x3e\x3cget_theme_info data_source\x3d"'+n.dataSource+'" theme\x3d"'+n.themeName+'"/\x3e\x3c/non_map_request\x3e'},function(b){if(a.isNull(n.keyColumn)){var c=
a.$(b).find("key_column").text();console.log("Key column: "+c);a.notNull(c)&&(n.keyColumn=c)}a.isNull(n.renderingStyle)&&(b=a.$(b).find("theme_style[label\x3d'false']").attr("name"),console.log("Theme render style: "+b),a.notNull(b)&&(n.renderingStyle={name:b,dataSource:n.dataSource}))},"xml")},enableFeatureEditing:function(a){return!1},getFeatureGeometryType:function(){if(this.featureArray&&0<this.featureArray.length){var b=this.featureArray[0].geo.geometries;if(a.notNull(b)&&0<b.length){b=b[0];
if("Point"===b.type||"OrientedPoint"===b.type||"MultiPoint"===b.type||"OrientedMultiPoint"===b.type)return"POINT";if("LineString"===b.type||"MultiLineString"===b.type)return"LINESTRING";if("Polygon"===b.type||"MultiPolygon"===b.type)return"POLYGON"}}return""},addFeature:function(a){},addFeatures:function(a){},refreshImpl:function(b,c,z){if(!a.isNull(this.group))if(z=b&&b.type===a.event.MapEvent.MAP_BEFORE_REFRESH?b.bigPan:!1,c?(z||(this.loaded=!1),z||(this.dataLoaded=!1)):b&&null!==b.beforeZoomLevel&&
null!==b.afterZoomLevel&&b.beforeZoomLevel!==b.afterZoomLevel&&this.setWindow(),this.clearFeatureShapes(),this.clearAllLabels(),this.checkVisible()){b=this.parentMap.getMapContext();c=b.getUniverse();var n=c.getZoomLevels()[b.getZoomLevel()],p=b.getCenterPoint();z=this.orgWidth*this.xRatio*n.resolution;n=this.orgHeight*this.yRatio*n.resolution*n.stretchRatio;this.dataBufferWindow={x:p.getX()-z/2,y:p.getY()-n/2,w:z,h:n};this.emptyCustomLayer();var p=c.getSRID(),v=null,V=this.visibleBound?Math.max(this.dataBufferWindow.x,
this.visibleBound.getMinX()):this.dataBufferWindow.x,Q=this.visibleBound?Math.max(this.dataBufferWindow.y,this.visibleBound.getMinY()):this.dataBufferWindow.y;z=this.visibleBound?Math.min(this.dataBufferWindow.x+z,this.visibleBound.getMaxX()):this.dataBufferWindow.x+z;n=this.visibleBound?Math.min(this.dataBufferWindow.y+n,this.visibleBound.getMaxY()):this.dataBufferWindow.y+n;c.geodetic&&(-180>V&&(V=-180),-90>Q&&(Q=-90),180<z&&(z=180),90<n&&(n=90));v=new a.geometry.Rectangle(V,Q,z,n,p);v.transform(3857,
function(a){v=a});n=a.util.WorldMercatorUtil.metersToPixels(b.getZoomLevel(),v.getMinX(),v.getMinY());V=a.util.WorldMercatorUtil.metersToPixels(b.getZoomLevel(),v.getMaxX(),v.getMaxY());p=Math.round(n[0]/256);c=Math.round(V[0]/256);z=Math.min(Math.round(n[1]/256),Math.round(V[1]/256));n=Math.max(Math.round(n[1]/256),Math.round(V[1]/256));V=z;z=(1<<b.getZoomLevel())-1-n;n=(1<<b.getZoomLevel())-1-V;0>p&&(p=0);0>z&&(z=0);this.tileFeatures={};this.featuresMap={};this.featureArray=[];this.rtree=this.attrNames=
null;this.numberOfTilesToLoad=(c-p+1)*(n-z+1);if(1>this.numberOfTilesToLoad)a.util.Logger.info(null,"VectorTileLayer","["+this.name+"]  No tiles to load.");else{this.loadedTiles=[];this.loading=!0;this.loaded=!1;a.util.Logger.fine(null,"VectorTileLayer","["+this.name+"]  tile loading started. ["+this.numberOfTilesToLoad+"]");a.util.Logger.finest(null,"VectorTileLayer","["+this.name+"]  tile retrieval and rendering started.");a.util.Logger.finest(null,"VectorTileLayer","["+this.name+"]  number of tiles to process: "+
this.numberOftilesToProcess);for(this.loadTileFeaturesTask=this.startNewTask();p<=c;p++)for(V=z;V<=n;V++)Q=b.getZoomLevel()+"_"+p+"_"+V,a.util.Logger.finest(null,"VectorTileLayer","["+this.name+"] processing tile "+Q+"."),a.notNull(this.tileFeatures[Q])?this.checkVisible()&&this.displayTileFeatures(b.getZoomLevel(),p,V):this.getTileData(b.getZoomLevel(),p,V);a.util.Logger.fine(null,"VectorTileLayer","["+this.name+"]  all tiles processed (but some may be in rendering phase).");a.notNull(this.initTask)&&
(this.initTask.complete(),this.initTask=null)}}else b=a.event,c=new b.MapEvent(b.LayerEvent.FINISH_LOAD,this),c.mapContext=this.parentMap.getMapContext(),this.fire(b.LayerEvent.FINISH_LOAD,c)},getTileData:function(b,c,z){var n=dcodeIO.ProtoBuf,p=n.loadProtoFile(a.gv.getProtoResourcePath()+"vector_tile.proto").build("vector_tile"),v=a.util.WorldMercatorUtil.getTileCoverage(b,c,z),V=n.Util.XHR();V.open("GET",this.serverURL+"/vt/"+this.dataSource+"/"+b+"/"+c+"/"+z+".mvt?t\x3d"+this.themeName,!0);var Q=
this;V.responseType="arraybuffer";V.onload=function(n){n=p.Tile.decode(V.response);n=Q.decodeFeatures(n,v);var ha=b+"_"+c+"_"+z;if(a.isNotNull(n)&&0<n.length){Q.featureArray||(Q.featureArray=[]);var pa=Q.parentMap.getMapContext().getUniverse().getSRID();v.transform(pa,function(a){v=a});for(var ua=0;ua<n.length;ua++)if(a.isNotNull(n[ua].id)){var Aa=Q.featuresMap[n[ua].id],ta={},Ba=null,Ba=Ba=Ba=null;if(a.isNull(Aa)){var Ta=n[ua].geo;Ta.transform(pa,function(a){Ta=a});Ba=[];Ba.push(Ta);Ba=new a.geometry.GeometryCollection(Ba,
pa);Aa=new a.Feature(n[ua].id,Ba,{attributes:n[ua].getAttributes()});Aa.tiledFeature=!0;Q.featureArray.push(Aa);ta[n[ua].id]=Ta;Aa.tileGeometries[ha]=ta;Aa.clipMap[ha]=v;Aa.zoomLevelsGeometries["zoomlevel_"+b]=Ba;Ba=[];Ba.push(v);Aa.zoomLevelsGeomClipArea["zoomlevel_"+b]=Ba;Q.featuresMap[n[ua].id]=Aa;if(a.isNull(Q.attrNames)&&a.isNotNull(Aa.getAttributes())){ta=Aa.getAttributes();Q.attrNames=[];for(var Ja in ta)ta.hasOwnProperty(Ja)&&Q.attrNames.push(Ja);Q.nsdpTitleArray&&(Q.attrNames?(Q.nsdpTitleArray[0].toUpperCase()===
Q.nsdpKey&&Q.nsdpTitleArray.shift(),Q.attrNames=Q.attrNames.concat(Q.nsdpTitleArray)):this.nsdpTitleArray[0].toUpperCase()===Q.nsdpKey&&(Q.attrNames=Q.nsdpTitleArray.slice(1)))}}else Ta=n[ua].geo,Ta.transform(pa,function(a){Ta=a}),ta=Aa.tileGeometries[ha],a.isNull(ta)&&(ta={},Aa.tileGeometries[ha]=ta),ta[n[ua].id]=Ta,Aa.clipMap[ha]=v,Ba=Aa.zoomLevelsGeometries["zoomlevel_"+b],a.isNull(Ba)?(Ba=[],Ba.push(Ta),Ba=new a.geometry.GeometryCollection(Ba,pa),Aa.zoomLevelsGeometries["zoomlevel_"+b]=Ba,Ba=
[],Ba.push(v),Aa.zoomLevelsGeomClipArea["zoomlevel_"+b]=Ba):(Ba=Ba.geometries,Ba.push(Ta),Ba=Aa.zoomLevelsGeomClipArea["zoomlevel_"+b],Ba.push(v));Ba=Q.tileFeatures[ha];a.isNull(Ba)&&(Ba=[],Q.tileFeatures[ha]=Ba);Ba.push(n[ua].id);Q.mappingFeatureNSDP(Aa)}!Q.checkVisible()||Q.renderingStyle&&("HeatMap"===Q.renderingStyle.styleType||Q.renderingStyle instanceof a.style.BucketStyle&&!Q.renderingStyle.isServerSide&&Q.renderingStyle.buckets&&0<Q.renderingStyle.buckets.length&&!(Q.renderingStyle.buckets[0]instanceof
a.style.CollectionBucket))||Q.displayTileFeatures(b,c,z)}Q.addToTileLoadedList(ha)};V.onerror=function(p){p=b+"_"+c+"_"+z;a.util.Logger.warning(null,"VectorTileLayer","["+Q.name+"]  error while processing tile "+p+".");console.log("["+Q.name+"]  error while processing tile "+p+".");Q.addToTileLoadedList(p)};V.send(null)},addToTileLoadedList:function(b){if(!(a.isNull(b)||1>this.numberOfTilesToLoad)&&(this.loadedTiles.push(b),a.notNull(this.loadTileFeaturesTask)&&this.loadedTiles.length!==this.numberOfTilesToLoad&&
this.loadTileFeaturesTask.update(this.loadedTiles.length/this.numberOfTilesToLoad),this.loadedTiles.length===this.numberOfTilesToLoad)){this.loading=!1;this.loaded=!0;a.util.Logger.fine(null,"VectorTileLayer","Finished loading of "+this.numberOfTilesToLoad+" tiles.");if(this.checkVisible())if(this.renderingStyle&&"HeatMap"===this.renderingStyle.styleType)console.log("Going to display heat map ..."),this.displayHeatMap();else if(this.renderingStyle&&this.renderingStyle instanceof a.style.BucketStyle&&
!this.renderingStyle.isServerSide&&this.renderingStyle.buckets&&0<this.renderingStyle.buckets.length&&!(this.renderingStyle.buckets[0]instanceof a.style.CollectionBucket)&&(this.renderingStyle.generateBuckets(this.featureArray,this.styleAttributes,!0),a.isNotNull(this.featureArray)))for(b=0;b<this.featureArray.length;b++)this.displayFeature(this.featureArray[b]);a.notNull(this.loadTileFeaturesTask)&&(this.loadTileFeaturesTask.complete(),this.loadTileFeaturesTask=null)}},displayEnd:function(a){console.log("Vector tile layer displayEnd called.")},
displayTileFeatures:function(b,c,z){var n=this.startNewTask();b=b+"_"+c+"_"+z;c=this.tileFeatures[b];if(a.isNotNull(c)){z={};for(var p=.3,v=0;v<c.length;v++){var V=v/c.length;a.isNotNull(z[c[v]])||(V>=p&&(n.update(V),p+=.3),z[c[v]]=v,this.displayFeature(this.featuresMap[c[v]],b))}}n.complete()},displayFeature:function(b,c){if(!a.isNull(b)){if(!b.displayed){var z=this.parentMap.getMapContext();z.getWholeMapNum();z.getBaseWholeMapIndex();a.notNull(this.featureGroupArr)&&0<this.featureGroupArr.length&&
(a.notNull(b.activeIdx)?this.realGroup=this.featureGroupArr[b.activeIdx]:this.realGroup=this.featureGroupArr[0]);a.isNull(this.realGroup)&&(this.realGroup=this.parentMap.graphics.createGroup(),this.realGroup.applyStyle({cursor:this.mouseCursor}),this.pointerSensitivity||this.realGroup.applyStyle({pointerSensitivity:!1}),this.group.appendChild(this.realGroup));b.group=this.realGroup;b.screenTransformObj=this.parentMap.getMapContext().getTransform();b.graphics=this.parentMap.graphics;b.parentLayer=
this}z=null;z=a.isNotNull(c)?b.tileGeometries[c][b.id].getMBR():b.geo.getMBR();this.display(b,z,c)}},decodeFeatures:function(b,c){if(a.isNull(b.layers)||0===b.layers.length|a.isNull(c))return null;var z=b.layers[0].extent,n=[];if(a.isNotNull(b.layers[0].keys)&&0<b.layers[0].keys.length)for(var p=0;p<b.layers[0].keys.length;p++)n.push(b.layers[0].keys[p]);var v=[];if(a.isNotNull(b.layers[0].values)&&0<b.layers[0].values.length)for(p=0;p<b.layers[0].values.length;p++){var V=null;a.notNull(b.layers[0].values[p].bool_value)?
V=b.layers[0].values[p].bool_value:a.notNull(b.layers[0].values[p].double_value)?V=b.layers[0].values[p].double_value:a.notNull(b.layers[0].values[p].float_value)?V=b.layers[0].values[p].float_value:a.notNull(b.layers[0].values[p].int_value)?V=b.layers[0].values[p].int_value:a.notNull(b.layers[0].values[p].sint_value)?V=b.layers[0].values[p].sint_value:a.notNull(b.layers[0].values[p].string_value)?V=b.layers[0].values[p].string_value:a.notNull(b.layers[0].values[p].uint_value)&&(V=b.layers[0].values[p].uint_value);
v.push(V)}V=[];if(a.isNotNull(b.layers[0].features)&&0<b.layers[0].features.length)for(p=0;p<b.layers[0].features.length;p++){var Q=this.decodeFeature(b.layers[0].features[p].type,b.layers[0].features[p].geometry,b.layers[0].features[p].tags,n,v,c,z);a.isNotNull(Q)&&V.push(Q)}return V},decodeFeature:function(b,c,z,n,p,v,V){if(a.isNull(c)||a.isNull(v))return null;var Q=null;1===b?Q=this.decodePointGeometry(c,v,V):2===b?Q=this.decodeLineGeometry(c,v,V):3===b&&(Q=this.decodePolygonGeometry(c,v,V));if(a.isNull(Q))return null;
b=this.decodeFeatureAttributes(z,n,p);return a.notNull(b)&&a.notNull(b[this.keyColumn])?new a.Feature(b[this.keyColumn],Q,{attributes:b}):null},decodePointGeometry:function(b,c,z){if(a.isNull(b)||a.isNull(c)||a.isNull(z))return null;var n=b[0]>>3,p=null,p=b[1]>>1^-(b[1]&1),v=b[2]>>1^-(b[2]&1),V=this.getMapPoint(c,z,p,v),Q=p,w=v;if(1===n)p=new a.geometry.Point(V[0],V[1],3857);else{for(var ha=[],pa=0;pa<n;pa++){var ua=[];0===pa?(ua.push(V[0]),ua.push(V[1])):(p=b[1+2*pa]>>1^-(b[1+2*pa]&1),v=b[2*pa+2]>>
1^-(b[2*pa+2]&1),p+=Q,v+=w,V=this.getMapPoint(c,z,p,v),ua.push(V[0]),ua.push(V[1]),Q=p,w=v);ha.push(ua)}p=new a.geometry.MultiPoint(ha,3857,2)}return p},decodeLineGeometry:function(b,c,z){if(a.isNull(b)||a.isNull(c)||a.isNull(z))return null;var n=b.length,p=b[3]>>3,v=null,v=[];if(n===2*p+4){var V=b[1]>>1^-(b[1]&1),Q=b[2]>>1^-(b[2]&1),w=V,ha=Q,pa=this.getMapPoint(c,z,V,Q);v.push(pa[0]);v.push(pa[1]);for(V=0;V<p;V++){var Q=b[4+2*V]>>1^-(b[4+2*V]&1),ua=b[2*V+5]>>1^-(b[2*V+5]&1);if(Q!==w||ua!==ha)Q+=
w,ua+=ha,pa=this.getMapPoint(c,z,Q,ua),v.push(pa[0]),v.push(pa[1]),w=Q,ha=ua}v=new a.geometry.LineString(v,3857,2)}else{for(var ha=w=-1,Aa=0,ta=[];Aa<n;){v=[];V=b[Aa+1]>>1^-(b[Aa+1]&1);Q=b[Aa+2]>>1^-(b[Aa+2]&1);0<Aa&&(V+=w,Q+=ha);pa=this.getMapPoint(c,z,V,Q);v.push(pa[0]);v.push(pa[1]);w=V;ha=Q;p=b[Aa+3]>>3;for(V=0;V<p;V++)if(pa=Aa+4,Q=b[pa+2*V]>>1^-(b[pa+2*V]&1),ua=b[pa+2*V+1]>>1^-(b[pa+2*V+1]&1),Q!==w||ua!==ha)Q+=w,ua+=ha,pa=this.getMapPoint(c,z,Q,ua),v.push(pa[0]),v.push(pa[1]),w=Q,ha=ua;ta.push(v);
Aa=Aa+4+2*p}v=new a.geometry.MultiLineString(ta,3857,2)}return v},decodePolygonGeometry:function(b,c,z){if(a.isNull(b)||a.isNull(c)||a.isNull(z))return null;for(var n=b.length,p=b[3]>>3,v=null,V=[],Q=-1,w=-1,ha=0;ha<n;){var pa=[],ua=b[ha+1]>>1^-(b[ha+1]&1),p=b[ha+2]>>1^-(b[ha+2]&1);0<ha&&(ua+=Q,p+=w);Q=this.getMapPoint(c,z,ua,p);pa.push(Q[0]);pa.push(Q[1]);Q=ua;w=p;p=b[ha+3]>>3;for(ua=0;ua<p;ua++){var Aa=ha+4,ta=b[Aa+2*ua]>>1^-(b[Aa+2*ua]&1),Aa=b[Aa+2*ua+1]>>1^-(b[Aa+2*ua+1]&1);if(ta!==Q||Aa!==w)ta+=
Q,Aa+=w,Q=this.getMapPoint(c,z,ta,Aa),pa.push(Q[0]),pa.push(Q[1]),Q=ta,w=Aa}ua=pa[1];pa.push(pa[0]);pa.push(ua);V.push(pa);ha=ha+4+2*p+1}if(0<V.length){b=[];for(ua=0;ua<V.length;ua++){c=[];c.push(V[ua]);z=a.util.GeomUtil.isClockwise(V[ua],2);for(n=ua+1;n<V.length;n++)if(a.util.GeomUtil.isClockwise(V[n],2)===z){ua=n-1;break}else c.push(V[n]);b.push(c)}0<b.length&&(v=1===b.length?new a.geometry.Polygon(b[0],3857,2):new a.geometry.MultiPolygon(b,3857,2))}return v},decodeFeatureAttributes:function(b,
c,z){if(a.isNull(c))return null;for(var n={},p=0;p<c.lenght;p++)n[c[p]]="";for(p=0;p<b.length;p+=2)n[c[b[p]]]=z[b[p+1]];return n},getMapPoint:function(b,c,z,n){if(a.isNull(b)||a.isNull(c)||a.isNull(z)||a.isNull(n))return null;z=z*b.getWidth()/c+b.getMinX();b=b.getMaxY()-n*b.getHeight()/c;return[z,b]},mappingFeatureNSDP:function(b){if(!a.isNull(b)&&!b.mapping&&this.nsdpData&&this.nsdpKey){var c=this.getNsdpDataForFeature(b);if(a.notNull(c)){a.$.extend(b.attributes,c);b.columns=[];for(var z in c)b.columns.push(z);
b.mapping=!0}else b.mapping=!1}}});a.visualfilter.VisualFilter=a.Class.extend({initialize:function(){}});a.visualfilter.DropShadow=a.visualfilter.VisualFilter.extend({initialize:function(b){this.type="DROPSHADOW";this.angle=b&&a.notNull(b.angle)?b.angle:45;this.color=b&&a.notNull(b.color)?b.color:null;this.knockout=b&&a.notNull(b.knockout)?b.knockout:null;this.offset=b&&a.notNull(b.offset)?b.offset:2;this.opacity=b&&a.notNull(b.opacity)?b.opacity:.5;this.radius=b&&a.notNull(b.radius)?b.radius:2;this.applyToLayer=
b&&a.notNull(b.applyToLayer)?b.applyToLayer:!0}});a.visualfilter.Glow=a.visualfilter.VisualFilter.extend({initialize:function(b){this.type="GLOW";this.color=b&&a.notNull(b.color)?b.color:null;this.strength=b&&a.notNull(b.strength)?b.strength:3;this.applyToLayer=b&&a.notNull(b.applyToLayer)?b.applyToLayer:!0}});a.infowindow.InfoWindow=a.Class.extend({initialize:function(b,c){this.maxY=this.maxX=this.minY=this.minX=0;var z=b.getMapContext();this.width=z.getDeviceWidth();this.height=z.getDeviceHeight();
this.parentMap=b;this.wininfo=null;this.$div=a.$("\x3cdiv style\x3d'position:absolute;width:0px;height:0px;z-index:3000'\x3e\x3c/div\x3e");this.parentMap.$topLayerDIV.append(this.$div);this.div=this.$div[0];this.infoWindows=[];this.$infoWindow=null;this.mouseOver=this.clrIntervalFlag=this.enablePropagation=!1;this.id=c;this.idPrefix="omv2_ifw_";z=a.event.MapEvent;b.addListener(z.I_MAP_DRAGGING,this.panEventAction);b.addListener(z.MAP_BEFORE_REFRESH,this.refreshEventAction);b.addListener(z.I_MAP_CENTER_ZOOM,
this.zoomEventAction);b.addListener(z.MAP_RESIZED,this.resizeEventAction);b.addListener(z.MAP_DESTROY,this.destroyEventAction);b.addListener(z.MAP_CLEAN,this.refreshEventAction);var n=this;n.infoStopPropagation=function(b){a.event.EventSource.stopEvents[b.type]=!0};n.infoMouseMove=function(a){n.mouseOnInfoWindow=!0;n.div&&(n.div.style.zIndex=3002);n.infoStopPropagation(a)};n.infoMouseOver=function(a){n.mouseOnInfoWindow=!0;n.div&&(n.div.style.zIndex=3001);n.infoStopPropagation(a)};n.infoMouseOut=
function(a){n.mouseOnInfoWindow=!1;n.div&&(n.div.style.zIndex=3E3);n.infoStopPropagation(a)};this.$div.bind("mousemove",n.infoMouseMove);this.$div.bind("mouseover",n.infoMouseOver);this.$div.bind("mouseout",n.infoMouseOut);this.$div.bind("touchmove touchend mousewheel mousedown mouseover mouseout click keyup keydown keypress dblclick",this.infoStopPropagation)},init:function(b){b=b?b:{};this.ellipsis=!1===b.ellipsis?!1:!0;this.infoWidth=parseInt(b.width);this.infoHeight=parseInt(b.height);this.background=
b.background?b.background:"#F5F5F9";this.title_string=b.title?b.title:"";this.tailStyle=this.closeButtonStyle=null;b.infoWindowStyle?("string"==typeof b.infoWindowStyle?(this.infoWindowStyle={},this.infoWindowStyle=this.toJsonCss(b.infoWindowStyle)):this.infoWindowStyle=b.infoWindowStyle,this.infoWindowStyle["background-color"]&&(this.infoWindowStyle.background=this.infoWindowStyle["background-color"]),this.background=this.infoWindowStyle.background,this.infoWindowStyle&&this.infoWindowStyle.background||
(this.background=this.infoWindowStyle.background="#F5F5F9")):this.infoWindowStyle={};b.titleStyle?"string"==typeof b.titleStyle?(this.titleStyle={},this.titleStyle=this.toJsonCss(b.titleStyle)):this.titleStyle=b.titleStyle:this.titleStyle={};b.contentStyle?"string"==typeof b.contentStyle?(this.contentStyle={},this.contentStyle=this.toJsonCss(b.contentStyle)):this.contentStyle=b.contentStyle:this.contentStyle={};this.tailStyle=b.tailStyle?b.tailStyle:{};b.closeButtonStyle&&(this.closeButtonStyle=b.closeButtonStyle);
this.infoWinId=this.idPrefix+b.id+"_";this.clrIntervalFlag=!1;this.typeId=b.typeId?b.typeId:this.parentMap.mapInstanceId+"_1";this.$infoWindow=a.$("\x3cdiv class\x3d'omv2_infoWindow_info' id\x3d\""+this.infoWinId+'"\x3e\x3c/div\x3e');this.$container=a.$("\x3cdiv\x3e\x3c/div\x3e")},showTabInfoWindow:function(b,K,z){this.init(z);b=this.parentMap.getScreenLocation(b);for(var n=0;n<this.infoWindows.length;n++){if(this.infoWinId&&this.infoWindows[n].nid==this.infoWinId){this.deleteInfoWindow(this.infoWindows[n]);
return}this.typeId&&this.infoWindows[n].typeId==this.typeId&&this.deleteInfoWindow(this.infoWindows[n])}this.infoWidth||(this.infoWidth=150);this.infoHeight||(this.infoHeight=50);this.getPageDirection();this.$infoWindow.css({background:"none repeat scroll 0 0 "+this.background,width:this.infoWidth,height:this.infoHeight});this.$infoWindow.css(this.infoWindowStyle);this.$container.css({position:"absolute",width:this.infoWidth-5,height:this.infoHeight-3,left:"6px","z-index":"2"});this.div.appendChild(this.$infoWindow[0]);
this.createCloseButtonDiv();var p=a.$("\x3cimg class\x3d'omv2_l_arrow_info' src\x3d'"+a.gv.resourcePath()+"overflow_left_ena.png'\x3e\x3c/img\x3e"),v=a.$("\x3cimg class\x3d'omv2_r_arrow_info' src\x3d'"+a.gv.resourcePath()+"overflow_right_ena.png'\x3e\x3c/img\x3e");v.css({right:"10px",top:"14px"});p.css({left:"0px",top:"14px"});v.bind("click touchstart",function(){p.css({visibility:"visible"});ha.css({left:parseInt(ha.css("left"))-60});parseInt(ha.css("left"))<=60*-(K.length-1)&&v.css({visibility:"hidden"})}).mouseover(function(){a.$(this)[0].src=
a.gv.resourcePath()+"overflow_right_ovr.png"}).mouseout(function(){a.$(this)[0].src=a.gv.resourcePath()+"overflow_right_ena.png"});p.bind("click touchstart",function(){v.css({visibility:"visible"});ha.css({left:parseInt(ha.css("left"))+60});0<=parseInt(ha.css("left"))&&(p.css({visibility:"hidden"}),v.css({visibility:"visible"}))}).mouseover(function(){a.$(this)[0].src=a.gv.resourcePath()+"overflow_left_ovr.png"}).mouseout(function(){a.$(this)[0].src=a.gv.resourcePath()+"overflow_left_ena.png"});var n=
this.infoWinId+"tabs",V=this.infoWinId+"tab_",Q=this.infoWinId+"subTab_",w=a.$("\x3cdiv class\x3d'omv2_tabDiv_info'\x3e\x3c/div\x3e"),ha=a.$("\x3cdiv class\x3d'omv2_tab_info' id\x3d'"+n+"'\x3e\x3c/div\x3e"),pa;if(0===K.length)n=a.$("\x3cdiv class\x3d'omv2_tab_select_info' name\x3d'#tab'\x3esample\x3c/div\x3e"),n.data("ts","sample"),ha[0].appendChild(n[0]);else for(n=0;n<K.length;n++)pa=a.$("\x3cdiv id\x3d'"+Q+n+"' class\x3d'"+(0===n?"omv2_tab_select_info":"omv2_tab_unselect_info")+"' style\x3d'left:"+
60*n+"px' name\x3d'#tab"+n+"'\x3e"+K[n].title+"\x3c/div\x3e"),pa.data("ts",K[n].title),a.browser.touchSupported||this.tipLengthAdjust(pa,60),ha[0].appendChild(pa[0]);this.createTip(ha.find("div"));var ua=a.$("\x3cdiv id\x3d'"+(this.infoWinId+"content")+"' class\x3d'omv2_defaultContent_info'\x3e\x3c/div\x3e");if(0===K.length)Q=a.$("\x3cdiv id\x3d'"+V+"' style\x3d'margin-top:5px;'\x3e \x3ch2\x3etab sample\x3c/h2\x3e  \x3c/div\x3e"),ua[0].appendChild(Q[0]);else for(n=0;n<K.length;n++)Q=a.$("\x3cdiv id\x3d'"+
V+n+"' style\x3d'margin-top:5px;'\x3e "+K[n].content+"  \x3c/div\x3e"),ua[0].appendChild(Q[0]);this.createGeneralDiv();this.$infoWindow[0].appendChild(v[0]);this.$infoWindow[0].appendChild(p[0]);this.infoWindows.push(this.$infoWindow);this.$infoWindow.nid=this.infoWinId;this.$infoWindow.typeId=this.typeId;this.$infoWindow.winX=b.x;this.$infoWindow.winY=b.y;w[0].appendChild(ha[0]);this.$container[0].appendChild(w[0]);this.$container[0].appendChild(ua[0]);this.$infoWindow[0].appendChild(this.$container[0]);
for(n=0;n<K.length;n++)this.touchscroll("subtab"+n);this.touchscroll("content");w.css({width:this.$infoWindow.width()-38});w.css({left:"8px"});60*K.length<this.$infoWindow.width()?(p.css({visibility:"hidden"}),v.css({visibility:"hidden"})):p.css({visibility:"hidden"});ua.css({position:"absolute",top:w.height(),height:this.infoHeight-w.height(),width:this.$infoWindow.width()-12,overflow:"auto"});ua.css(this.contentStyle);0<ua.find("a").length&&ua.find("a").bind("touchstart",function(){c.location.href=
ua.find("a").attr("href")});b=this.checkInfoWindowOverLayer(this,this.$infoWindow,b);this.$infoWindow.css({left:b.x,top:b.y,visibility:"visible"});this.tabControl();a.$("#tabs").find("div").mouseover(function(){a.$(this).css({cursor:"pointer"})});ua.mouseover(function(){a.$(this).css({cursor:"default"})});if(a.notNull(z)&&a.notNull(z.activeIndex))for(a.$("#tabs div[name\x3d#tab"+(z.activeIndex-1)+"]").click(),n=0;n<z.activeIndex-1;n++);},showInfoWindow:function(a,b,c){var n=this;n.init(c);b.wraparoundMapIndex&&
(b=n.parentMap.getACL(b,b.wraparoundMapIndex));n.screenLoc=n.parentMap.getScreenLocation(b);for(b=0;b<n.infoWindows.length;b++)n.infoWinId&&n.infoWindows[b].nid==n.infoWinId?n.deleteInfoWindow(n.infoWindows[b]):n.typeId&&n.infoWindows[b].typeId==n.typeId&&n.deleteInfoWindow(n.infoWindows[b]);n.getPageDirection();n.infoWindows.push(n.$infoWindow);n.$infoWindow.nid=n.infoWinId;n.$infoWindow.typeId=n.typeId;n.$infoWindow.winX=n.screenLoc.x;n.$infoWindow.winY=n.screenLoc.y;n.createCloseButtonDiv();a=
n.initCss(a);var p=a[0],v=a[1];n.calculatePosition(p,v,n.screenLoc,c);var V=setInterval(function(){n.$closeButton&&p&&v&&(clearInterval(V),n.titleContentCloseAdjust(p,v,n.$closeButton))},10)},initCss:function(b){var K=this.infoWinId+"content",z=a.$("\x3cdiv id\x3d'"+(this.infoWinId+"title")+"' class\x3d'omv2_defaultTitle_info'\x3e"+this.title_string.replace(/[ ]/g,"\x26nbsp;")+"\x3c/div\x3e"),n=a.$("\x3cdiv id\x3d'"+K+"' class\x3d'omv2_defaultContent_info'\x3e"+b+"\x3c/div\x3e");this.$infoWindow.css({width:this.infoWidth,
height:this.infoHeight});this.$infoWindow.css(this.infoWindowStyle);this.$container.css({position:"absolute",width:this.infoWidth-5,height:this.infoHeight-3,"z-index":"2"});this.div.appendChild(this.$infoWindow[0]);z.css({left:"5px"});this.$container[0].appendChild(z[0]);this.$container[0].appendChild(n[0]);this.$infoWindow[0].appendChild(this.$container[0]);n.css({top:parseInt(z.height())+2,height:"",width:""});this.infoWidth&&(""!==this.title_string?n.css({width:this.$infoWindow.width()-10}):n.css({width:this.$infoWindow.width()-
20}));this.infoHeight&&(""!==this.title_string?n.css({height:this.$infoWindow.height()-z.height()-3}):n.css({height:this.$infoWindow.height()-3}));n.css(this.contentStyle);0<n.find("a").length&&n.find("a").bind("touchstart",function(){c.location.href=n.find("a").attr("href")});this.touchscroll("content");n.css({left:"5px","margin-right":"5px"});z.data("ts",z.html());this.titleStyle.width&&!a.browser.touchSupported&&this.tipLengthAdjust(z,parseInt(this.titleStyle.width)-20);1<this.$infoWindow.width()&&
z.width(this.$infoWindow.width()-20);z.css(this.titleStyle);this.touchscroll("title");n.mouseover(function(){a.$(this).css({cursor:"default"})});z.mouseover(function(){a.$(this).css({cursor:"default"})});""===this.title_string&&(z.width("0px"),z.height("0px"));return[z,n]},infoResize:function(b,c,z,n){var p=this.height-z.y,v=this.width-z.x;if(this.$infoWindow.height()>p-20&&this.$infoWindow.height()>z.y-20&&(parseInt(this.$infoWindow.css("top"))+this.$infoWindow.height()>this.height||0>parseInt(this.$infoWindow.css("top")))||
this.$infoWindow.width()>v-20&&this.$infoWindow.width()>z.x-20)this.infoDomResize(b,c,z),this.$infoWindow.height()>p-20&&this.$infoWindow.height()>z.y-20&&(parseInt(this.$infoWindow.css("top"))+this.$infoWindow.height()>this.height||0>parseInt(this.$infoWindow.css("top")))&&(p>=z.y?0>parseInt(this.$infoWindow.css("top"))?(c.height(p-60),a.browser.firefox&&""!==this.title_string?c.width(c.width()+45):c.width(c.width()+25),""!==this.title_string?this.$infoWindow.width(c.width()+11):this.$infoWindow.width(c.width()+
20),this.$infoWindow.height(p+5-60)):(c.height(p),a.browser.firefox&&""!==this.title_string?c.width(c.width()+45):c.width(c.width()+25),""!==this.title_string?this.$infoWindow.width(c.width()+11):this.$infoWindow.width(c.width()+20),this.$infoWindow.height(p+5)):50>p?(c.height(z.y-60),a.browser.firefox&&""!==this.title_string?c.width(c.width()+45):c.width(c.width()+25),""!==this.title_string?this.$infoWindow.width(c.width()+11):this.$infoWindow.width(c.width()+20),this.$infoWindow.height(z.y+5-60)):
(c.height(z.y),a.browser.firefox&&""!==this.title_string?c.width(c.width()+45):c.width(c.width()+25),""!==this.title_string?this.$infoWindow.width(c.width()+11):this.$infoWindow.width(c.width()+20),this.$infoWindow.height(z.y+5))),this.$infoWindow.width()>v-20&&this.$infoWindow.width()>z.x-20&&(v>=z.x?(c.width(v-40),this.$infoWindow.width(v-40+20)):(c.width(z.x-40),this.$infoWindow.width(z.x-40+20))),5<=b.height()+c.height()-this.$infoWindow.height()&&this.$infoWindow.height(b.height()+c.height()+
5),n&&a.notNull(n.title)&&(b.width()>this.$infoWindow.width()-20&&b.width(this.$infoWindow.width()-20),a.browser.touchSupported||this.tipLengthAdjust(b,parseInt(this.$infoWindow.width())-19)),30>this.$infoWindow.height()&&this.checkMinHeightInfowindow(b,c),this.adjustInfowindowLayout(this,z);this.clrIntervalFlag=!0},infoDomResize:function(a,b,c){b.width()>this.$infoWindow.width()&&(this.$infoWindow.width(b.width()+20),this.$infoWindow[0].removeChild(this.$hideDiv[0]),this.$infoWindow[0].removeChild(this.$fadeDiv[0]),
this.$infoWindow[0].removeChild(this.$vancantDiv[0]),this.createGeneralDiv(),this.adjustInfowindowLayout(this,c),this.clrIntervalFlag=!0);b.height()>this.$infoWindow.height()-a.height()&&(0===a.height()?(b.css({width:this.$infoWindow.width()-19}),b.height(b.height()),this.$infoWindow.height(b.height()+parseInt(a.css("top"))+2)):(b.css({width:this.$infoWindow.width()-11}),this.$infoWindow.height(b.height()+a.height()+parseInt(a.css("top"))+2)),30>this.$infoWindow.height()&&this.checkMinHeightInfowindow(a,
b),this.$infoWindow[0].removeChild(this.$hideDiv[0]),this.$infoWindow[0].removeChild(this.$fadeDiv[0]),this.$infoWindow[0].removeChild(this.$vancantDiv[0]),this.createGeneralDiv(),this.adjustInfowindowLayout(this,c),this.clrIntervalFlag=!0)},setInfoSize:function(b,c){this.infoWidth?(b.width()>this.$infoWindow.width()-20&&b.width(this.$infoWindow.width()-20),""!==this.title_string?c.width()>this.$infoWindow.width()-10&&c.width(this.$infoWindow.width()-10):c.width()>this.$infoWindow.width()-20&&c.width(this.$infoWindow.width()-
20),!a.browser.touchSupported&&(a.isNull(this.titleStyle.width)||this.titleStyle.width>=this.infoWidth||""===this.titleStyle.width)&&this.tipLengthAdjust(b,parseInt(this.$infoWindow.width())-20)):(b.width()+6>c.width()?(b.width(b.width()+6),b.width()>1.5*c.width()&&this.ellipsis&&b.width(1.5*c.width()),this.$infoWindow.width(b.width()+20),this.contentStyle.width||c.width(b.width())):(""!==this.title_string?this.$infoWindow.width(c.width()+11):this.$infoWindow.width(c.width()+20),this.titleStyle.width||
""===this.title_string||b.width(c.width()-10)),120>this.$infoWindow.width()&&this.checkMinWidthInfowindow(b,c),a.browser.touchSupported||this.tipLengthAdjust(b,parseInt(this.$infoWindow.width())-18),this.infoWidth=this.$infoWindow.width());this.infoHeight?(b.height()>this.$infoWindow.height()-2&&b.height(this.$infoWindow.height()),c.height()>this.infoHeight-parseInt(b.height())&&c.height(this.infoHeight-parseInt(b.height())-3),c.css({top:parseInt(b.height())+2})):(this.$infoWindow.height(c.height()+
b.height()+parseInt(b.css("top"))+2),30>this.$infoWindow.height()&&this.checkMinHeightInfowindow(b,c),c.css({top:parseInt(b.height())+2}),this.infoHeight=this.$infoWindow.height())},checkMinWidthInfowindow:function(a,b){this.$infoWindow.width("120px");""!==this.title_string?(a.width("100px"),b.width("110px")):b.width("100px")},checkMinHeightInfowindow:function(a,b){this.$infoWindow.height("30px");b.height(30-parseInt(a.height())-3)},calculatePosition:function(b,c,z,n){var p=this;p.setInfoSize(b,c);
p.createGeneralDiv();p.t_h=b.height();(a.browser.chrome||a.browser.touchSupported)&&0===c.find("img").length&&6>p.$infoWindow.width()-c.width()&&c.width(c.width()-1);var v=0;if(!p.infoHeight||!p.infoWidth)if(a.isNull(p.contentStyle.width)||a.isNull(p.contentStyle.height))var V=setInterval(function(){121>=p.$infoWindow.width()?p.checkMinWidthInfowindow(b,c):p.infoWidth||c.width("");30>=p.$infoWindow.height()?p.checkMinHeightInfowindow(b,c):p.infoHeight||c.height("");(a.browser.chrome||a.browser.touchSupported)&&
0===c.find("img").length&&6>p.$infoWindow.width()-c.width()&&c.width(c.width()-1);v++;20<v&&clearInterval(V);p.infoDomResize(b,c,z);p.infoResize(b,c,z,n);p.clrIntervalFlag&&(clearInterval(V),""!==p.title_string&&(b.width(p.$infoWindow.width()-20),b.html(b.data("ts")),a.browser.touchSupported||p.tipLengthAdjust(b,parseInt(p.$infoWindow.width())-19)));""!==p.title_string&&b.width()>c.width()&&c.width(b.width());p.$infoWindow.css({visibility:"visible"})},100);var Q=0,w=setInterval(function(){Q++;p.infoResize(b,
c,z,n);if(20<Q||p.clrIntervalFlag)clearInterval(w),0!==c.find("img").length&&c.height(p.$infoWindow.height()-b.height()-3)},100);a.browser.chrome&&c.find("img").length&&c.find("img").load(function(){c.width(a.$("#content").children().first().width()+25);p.infoDomResize(b,c,z)});p.adjustInfowindowLayout(p,z);p.infoHeight&&p.infoWidth||(a.isNull(p.contentStyle.width)||a.isNull(p.contentStyle.height))&&p.$infoWindow.css({visibility:"hidden"});p.createTip(b)},adjustInfowindowLayout:function(a,b){var c=
a.checkInfoWindowOverLayer(a,a.$infoWindow,b);a.$infoWindow.css({left:c.x,top:c.y,visibility:"visible"})},titleContentCloseAdjust:function(a,b,c){var n;n=a.width()>b.width()?a.width():b.width();b.width()==this.$infoWindow.width()-10&&(n=a.width());var p=parseInt(c.width()),v=parseInt(c.height()),V,Q;this.closeButtonStyle?(V=parseInt(this.closeButtonStyle.xOffset),Q=parseInt(this.closeButtonStyle.yOffset)):Q=V=0;V||(V=0);Q||(Q=0);this.$infoWindow.width()-n<c.width()+parseInt(c.css("right"))&&c.css({right:this.$infoWindow.width()-
n-6-c.width()});0>this.$infoWindow.width()-n-6-c.width()&&c.css({right:"0"});this.$infoWindow.width()-n<=c.width()?c.width(this.$infoWindow.width()-n-6):21>this.$infoWindow.width()-n&&(c.css({right:"0"}),c.width("14px"));c.height()+parseInt(c.css("top"))>this.$infoWindow.height()&&c.css({top:this.$infoWindow.height()-c.height()});c.height()>this.$infoWindow.height()-parseInt(c.css("top"))&&c.height(this.$infoWindow.height()-parseInt(c.css("top")));c.height()>this.$infoWindow.height()&&(c.css({top:"0"}),
c.height(this.$infoWindow.height()));p+V<this.$infoWindow.width()-n&&(c.css({right:V+"px"}),c.width(p));p+V>=this.$infoWindow.width()-n&&p<this.$infoWindow.width()-n&&(c.css({right:this.$infoWindow.width()-n-p-6+"px"}),c.width(p));v+Q<this.$infoWindow.height()&&(c.css({top:Q+"px"}),c.height(v));v+Q>=this.$infoWindow.height()&&v<this.$infoWindow.height()&&(c.css({top:this.$infoWindow.height()-v-6+"px"}),c.height(v));11>=this.$infoWindow.width()-b.width()&&(p+V<this.$infoWindow.width()-a.width()-5?
(c.css({right:V+"px"}),c.width(p)):p+V>=this.$infoWindow.width()-a.width()-5&&p<this.$infoWindow.width()-a.width()-5?(c.css({right:this.$infoWindow.width()-a.width()-5-p+"px"}),c.width(p)):(c.css({right:"0px"}),c.width("14px")),v+Q<a.height()?(c.css({top:Q+"px"}),c.height(v)):v+Q>=a.height()&&v<a.height()?(c.css({top:a.height()-v+"px"}),c.height(v)):(c.css({top:"0px"}),c.height("14px")));this.infoHeight||this.infoWidth||this.contentStyle.width||this.contentStyle.height||this.titleStyle.width||this.titleStyle.height||
(c.css({right:"0px"}),c.width("14px"),c.css({top:"0px"}),c.height("14px"))},tipLengthAdjust:function(b,c){var z;if("omv2_defaultTitle_info"!=b.attr("class")){if(z=a.$("\x3cdiv class\x3d'omv2_temp_info' \x3e"+b.html()+"\x3c/div\x3e"),this.$infoWindow[0].appendChild(z[0]),z.width()>c)for(var n=z.html().length-1;-1<n;n--){var p=z.html();if(z.width()<c){b.html(z.html().substring(0,z.html().length-3)+"...");break}z.html(p.substring(0,n))}}else if(z=a.$("\x3cdiv class\x3d'omv2_temp_info' \x3e"+b.text()+
"\x3c/div\x3e"),z.css({"font-size":"16px","font-family":"Tahoma","font-weight":"bold"}),this.titleStyle["font-size"]&&z.css({"font-size":this.titleStyle["font-size"]}),this.titleStyle["font-family"]&&z.css({"font-family":this.titleStyle["font-family"]}),this.titleStyle["font-weight"]&&z.css({"font-weight":this.titleStyle["font-weight"]}),this.$infoWindow[0].appendChild(z[0]),z.width()>c)for(z.html("..."),n=0;n<b.text().length;n++){if(z.width()>c){b.html(z.text());break}z.html(b.text().substring(0,
n)+"...")}},createCloseButtonDiv:function(){var b=this;b.$closeButton=this.closeButtonStyle&&this.closeButtonStyle.mouseOutButton&&this.closeButtonStyle.mouseOutButton.src?a.$("\x3cimg class\x3d'omv2_closeButton_info' src\x3d'"+this.closeButtonStyle.mouseOutButton.src+"'\x3e\x3c/img\x3e"):a.$("\x3cimg class\x3d'omv2_closeButton_info' src\x3d'"+a.gv.resourcePath()+"close_en.png'\x3e\x3c/img\x3e");b.$closeButton.css({right:"0"});this.closeButtonStyle&&this.closeButtonStyle.xOffset&&(b.$closeButton.css({right:this.closeButtonStyle.xOffset}),
this.closeButtonStyle&&this.closeButtonStyle.yOffset&&b.$closeButton.css({top:this.closeButtonStyle.yOffset}));a.browser.touchSupported&&b.$closeButton.bind("touchstart",function(){b.deleteInfoWindow(b.infoWindows[0]);return!1});b.$closeButton.click(function(){b.deleteInfoWindow(b.infoWindows[0]);return!1}).mouseover(function(){b.closeButtonStyle&&b.closeButtonStyle.mouseOverButton&&b.closeButtonStyle.mouseOverButton.src?a.$(this)[0].src=b.closeButtonStyle.mouseOverButton.src:a.$(this)[0].src=a.gv.resourcePath()+
"close_ov.png"}).mouseout(function(){b.closeButtonStyle&&b.closeButtonStyle.mouseOutButton&&b.closeButtonStyle.mouseOutButton.src?a.$(this)[0].src=b.closeButtonStyle.mouseOutButton.src:a.$(this)[0].src=a.gv.resourcePath()+"close_en.png"});this.closeButtonStyle&&this.closeButtonStyle.width&&b.$closeButton.width(this.closeButtonStyle.width);this.closeButtonStyle&&this.closeButtonStyle.height&&b.$closeButton.height(this.closeButtonStyle.height);this.$infoWindow[0].appendChild(b.$closeButton[0])},createGeneralDiv:function(){var b=
a.$("\x3cdiv class\x3d'omv2_tail_info'\x3e\x3c/div\x3e"),c=a.$("\x3cdiv\x3e\x3c/div\x3e"),z=a.$("\x3cdiv style\x3d'position:absolute;overflow:hidden;border:0px solid black;'\x3e\x3c/div\x3e"),n=a.$("\x3cdiv style\x3d'z-index:3001;position:absolute;background:"+this.background+"'\x3e\x3c/div\x3e");c.css({position:"absolute",background:this.background,"z-index":"1","border-radius":"5px 5px 5px 5px"});this.infoWindowStyle&&this.infoWindowStyle.border?c.css({width:parseInt(this.infoWindowStyle.border.split(" ")[0])+
1+"px"}):c.css({width:"1px"});b.width("25px");b.height("25px");60>this.$infoWindow.height()&&(b.width("15px"),b.height("15px"));this.tailStyle&&(b.css(this.tailStyle),""!==this.tailStyle.offset&&(b.width(this.tailStyle.offset),b.height(this.tailStyle.offset)));1.414*b.width()>this.$infoWindow.width()&&(b.width(this.$infoWindow.width()),b.height(b.width()));1.414*b.height()>this.$infoWindow.height()&&(b.height(.707*(this.$infoWindow.height()-25)),b.width(b.height()));if(130<b.width()||130<b.height())b.width("130px"),
b.height("130px");z.width(.707*parseInt(b.width())+3);z.height(1.414*parseInt(b.height())+3);z[0].appendChild(b[0]);this.$infoWindow[0].appendChild(n[0]);this.$infoWindow[0].appendChild(z[0]);this.$infoWindow[0].appendChild(c[0]);this.$tail=b;this.$hideDiv=z;this.$fadeDiv=c;this.$vancantDiv=n},createTip:function(b){var c=a.$("\x3cspan class\x3d'omv2_tip_info'\x3e\x3c/span\x3e");this.$infoWindow[0].appendChild(c[0]);var z,n,p;b.mouseover(function(){var v=this;z=!1;var V;V="omv2_tab_info"==b.parent().attr("class")?
a.$(v).position().left+parseInt(b.parent().css("left"))+30:a.$(v).position().left+30;n=setTimeout(function(){z=!0},1E3);p=setInterval(function(){z&&(a.$(v).data("ts"),c.html(a.$(v).data("ts").replace(/[ ]/g,"\x26nbsp;")),c.css({display:"block",left:V}))},100);"current"!=a.$(this)[0].id&&"omv2_tab_info"==b.parent().attr("class")&&a.$(this).css({background:"#2F4F4F",color:"#9cd9fe"})}).mouseout(function(){z=!1;clearTimeout(n);clearInterval(p);c.css({display:"none"});"current"!=a.$(this)[0].id&&"omv2_tab_info"==
b.parent().attr("class")&&a.$(this).css({background:"#2F4F4F",color:"#e9f6fe"})})},panEventAction:function(b){var c=b.target.infoLayer;if(!a.isNull(c)&&c.$div){var z=parseInt(c.$infoWindow[0].style.left),n=parseInt(c.$infoWindow[0].style.top),n=isNaN(n)?0:n,z=isNaN(z)?0:z;c.$infoWindow.css({left:z+b.xOffset,top:n+b.yOffset});c.screenLoc.x+=b.xOffset;c.screenLoc.y+=b.yOffset}},refreshEventAction:function(a){a.target.infoLayer.deleteInfoWindow()},zoomEventAction:function(a){a.target.infoLayer.closeInfoWindows()},
destroyEventAction:function(b){b=b.target.infoLayer;a.isNotNull(b)&&b.destroy()},resizeEventAction:function(a){a=a.target.infoLayer;a.closeInfoWindows();var b=a.parentMap.getMapContext();a.width=b.getDeviceWidth();a.height=b.getDeviceHeight()},deleteInfoWindow:function(a){for(var b=0,b=0;b<this.infoWindows.length;b++)this.infoWindows[b]==a&&this.infoWindows.splice(b,1);this.$div.off("mouseover mouseout mousedown mouseup click touchend","**");this.$div.empty();this.mouseOnInfoWindow=!1},closeInfoWindows:function(){var b=
this.parentMap,c=a.event.MapEvent;b.deleteListener(c.I_MAP_DRAGGING,this.panEventAction);b.deleteListener(c.MAP_BEFORE_REFRESH,this.refreshEventAction);b.deleteListener(c.I_MAP_CENTER_ZOOM,this.zoomEventAction);b.deleteListener(c.MAP_RESIZED,this.resizeEventAction);b.deleteListener(c.MAP_DESTROY,this.destroyEventAction);b.deleteListener(c.MAP_CLEAN,this.refreshEventAction);b=0;for(c=this.infoWindows.length;b<c;b++)this.deleteInfoWindow(this.infoWindows[b])},checkInfoWindowOverLayer:function(a,b,c){this.tailStyle&&
this.tailStyle.border||(this.tailStyle.border="1px solid #c3d0df");var n=b.width(),p=b.height(),v=a.height,V=c.x,Q=c.y,w=!0,ha=!0;V>a.width/2&&(w=!1);Q<v/2&&(ha=!1);ha?(80>=p?this.$hideDiv.css({bottom:p/10+"px"}):this.$hideDiv.css({bottom:"25px"}),Q=Q+parseInt(this.$hideDiv.css("bottom"))-p+this.$hideDiv.height()/2-1):(80>=p?this.$hideDiv.css({top:p/7.5+"px"}):this.$hideDiv.css({top:"25px"}),Q=Q-parseInt(this.$hideDiv.css("top"))-this.$hideDiv.height()/2-1);w?(this.$tail.css({right:.707*-this.$hideDiv.width(),
top:.2*this.$tail.width()}),this.$hideDiv.css({left:-this.$hideDiv.width()+1}),this.$vancantDiv.height(p-10),this.$vancantDiv.css({left:"0px",width:"3px",top:"5px"}),V=V+.707*this.$tail.width()-2,b.css({"box-shadow":"5px 5px 5px rgba(0,0,0,0.5)"})):(this.$tail.css({left:.707*-this.$hideDiv.width(),top:.2*this.$tail.width()}),this.$hideDiv.css({right:-this.$hideDiv.width()+1}),this.$vancantDiv.height(p-10),this.$vancantDiv.css({right:"0px",width:"3px",top:"5px"}),V=V-n-.707*this.$tail.width(),b.css({"box-shadow":"-5px 5px 5px rgba(0,0,0,0.5)"}));
this.$tail.css({"box-shadow":"3px 3px 3px rgba(0,0,0,0.5)"});if(v>c.y+p+20||0<c.y-p-20)0>v-Q-p&&w?(this.$hideDiv.width(1.414*parseInt(this.$tail.height())+3),this.$hideDiv.height(.707*parseInt(this.$tail.width())+3),this.$tail.css({top:.707*-this.$hideDiv.height(),left:.2*this.$tail.width()}),this.$hideDiv.css({bottom:-this.$hideDiv.height()+1}),this.$vancantDiv.width(n-10),this.$vancantDiv.css({bottom:"0px",height:"3px",left:"5px",top:""}),Q=80>=p?Q-this.$hideDiv.height()-p/10-this.$hideDiv.width()/
2+1:Q-this.$hideDiv.height()-25-this.$hideDiv.width()/2+1,this.$hideDiv.css({left:"20px"}),V=V-20-this.$hideDiv.width()/2-this.$hideDiv.width()/2+2,b.css({"box-shadow":"5px -5px 5px rgba(0,0,0,0.5)"}),this.$tail.css({"box-shadow":"3px -3px 3px rgba(0,0,0,0.5)"})):0>v-Q-p&&!w?(this.$hideDiv.width(1.414*parseInt(this.$tail.height())+3),this.$hideDiv.height(.707*parseInt(this.$tail.width())+3),this.$tail.css({top:.707*-this.$hideDiv.height(),left:.2*this.$tail.width()}),this.$hideDiv.css({bottom:-this.$hideDiv.height()+
1}),this.$vancantDiv.width(n-10),this.$vancantDiv.css({bottom:"0px",height:"3px",right:"5px",top:""}),Q=80>=p?Q-this.$hideDiv.height()-p/10-this.$hideDiv.width()/2+1:Q-this.$hideDiv.height()-25-this.$hideDiv.width()/2+1,this.$hideDiv.css({right:"20px"}),V=V+this.$hideDiv.width()/2+this.$hideDiv.width()/2+20,b.css({"box-shadow":"-5px -5px 5px rgba(0,0,0,0.5)"}),this.$tail.css({"box-shadow":"-3px 3px 3px rgba(0,0,0,0.5)"})):0>Q&&w?(this.$hideDiv.width(1.414*parseInt(this.$tail.height())+3),this.$hideDiv.height(.707*
parseInt(this.$tail.width())+3),this.$tail.css({top:.28*this.$tail.width(),left:.2*this.$tail.width()}),this.$hideDiv.css({top:-this.$hideDiv.height()+1}),this.$vancantDiv.width(n-10),this.$vancantDiv.css({top:"0px",height:"3px",left:"5px",bottom:""}),Q=80>=p?Q+p/7.5+this.$hideDiv.height()+this.$hideDiv.width()/2+1-5:Q+25+this.$hideDiv.height()+this.$hideDiv.width()/2+1-5,this.$hideDiv.css({left:"20px"}),V=V-20-this.$hideDiv.width()/2-this.$hideDiv.width()/2+2,b.css({"box-shadow":"5px 5px 5px rgba(0,0,0,0.5)"}),
this.$tail.css({"box-shadow":"3px -3px 3px rgba(0,0,0,0.5)"})):0>Q&&!w&&(this.$hideDiv.width(1.414*parseInt(this.$tail.height())+3),this.$hideDiv.height(.707*parseInt(this.$tail.width())+3),this.$tail.css({top:.28*this.$tail.width(),left:.2*this.$tail.width()}),this.$hideDiv.css({top:-this.$hideDiv.height()+1}),this.$vancantDiv.width(n-10),this.$vancantDiv.css({top:"0px",height:"3px",right:"5px",bottom:""}),Q=80>=p?Q+p/7.5+this.$hideDiv.height()+this.$hideDiv.width()/2+1-6:Q+25+this.$hideDiv.height()+
this.$hideDiv.width()/2+1-6,this.$hideDiv.css({right:"20px"}),V=V+this.$hideDiv.width()/2+this.$hideDiv.width()/2+20,b.css({"box-shadow":"-5px 5px 5px rgba(0,0,0,0.5)"}),this.$tail.css({"box-shadow":"-3px 3px 3px rgba(0,0,0,0.5)"}));return{x:V,y:Q}},destroy:function(){a.isNull(this.$div)||(this.deleteInfoWindow(),this.$div.unbind("mousewheel mousedown mouseup mouseover mouseout click keyup keydown keypress",this.infoStopPropagation),this.$div.unbind("mousemove",this.infoMouseMove),this.$div.unbind("mouseover",
this.infoMouseOver),this.$div.unbind("mouseout",this.infoMouseOut),this.infoMouseOut=this.infoMouseOver=this.infoMouseMove=this.infoStopPropagation=null,a.$(this.infoTip).empty(),this.wininfo=this.infoWindows=this.$div=this.div=this.infoTip=null)},getPageDirection:function(){var a=document.createElement("table"),b=document.createElement("tr"),c=document.createElement("td"),n=document.createElement("td"),p=document.createElement("tbody");a.cellSpacing=0;a.cellPadding=0;c.innerHTML="fsdfsds";n.innerHTML=
"p";p.appendChild(b);a.appendChild(p);b.appendChild(c);b.appendChild(n);this.div.appendChild(a);this.pageDirection=0===c.offsetLeft?!0:!1;this.div.removeChild(a)},touchscroll:function(b){var c,z;a.browser.touchSupported&&a.notNull(document.getElementById(b))&&(document.getElementById(b).addEventListener("touchstart",function(a){c=a.targetTouches[0].pageX;z=a.targetTouches[0].pageY},!1),document.getElementById(b).addEventListener("touchmove",function(a){a.preventDefault();var b=z-a.targetTouches[0].pageY;
this.scrollLeft+=c-a.targetTouches[0].pageX;this.scrollTop+=b},!1))},tabControl:function(){(function(){a.$("#content \x3e div").hide();a.$("#tabs div:first").attr("id","current");a.$("#content \x3e div:first").fadeIn();a.$("#tabs div").bind("click touchstart",function(b){b.preventDefault();"current"!=a.$(this).attr("id")&&(a.$("#content \x3e div").hide(),a.$("#tabs div").attr("id",""),a.$("#tabs div").removeClass("omv2_tab_select_info"),a.$("#tabs div").addClass("omv2_tab_unselect_info"),a.$("#tabs div").css({color:a.$("#tabs div:first").css("color")}),
a.$(this).attr("id","current"),a.$(a.$(this).attr("name")).fadeIn(),a.$(this).removeClass("omv2_tab_unselect_info"),a.$(this).addClass("omv2_tab_select_info"))})})()},toJsonCss:function(a){var b={};a=a.split(";");for(var c=0;c<a.length;c++){var n=a[c].split(":");b[n[0]]=n[1]}return b},deleteInfoWindows:function(){this.infoWindows&&0<this.infoWindows.length&&this.infoWindows.pop();this.$div.off("mouseover mouseout mousedown mouseup click touchend","**");this.$div.empty();this.mouseOnInfoWindow=!1},
deleteInfoWindowById:function(a){a="infowin_"+a;for(var b=this.infoWindows.length,c=0;c<b;c++)if(this.infoWinId&&this.infoWindows[c].nid==a){this.deleteInfoWindow(this.infoWindows[c]);break}}});a.infowindow.MVInfoWindowTab=function(a,b){this.title=a;this.content=b};a.infowindow.MVInfoWindowTab.prototype.getTitle=function(){return this.title};a.infowindow.MVInfoWindowTab.prototype.getContent=function(){return this.content};a.tool.Tool=a.Class.extend({mixin:a.event.EventSource,initialize:function(b){this._$container=
b.$oracleMapDiv;this._geometry=null;this._graphic=b.graphics;this._map=b;this._group=this._toolShape=null;this._style=new a.style.Line({stroke:"#000000",strokeThickness:1});this._style.fill=b.graphics.oui.NO_PAINT;this.toolFeature=null;this.featureStyle=this._style;this.status=a.tool.Tool.STOPPED},start:function(){a.util.Logger.info("MAPVIEWER_9036","OM.tool.Tool.start","")},clear:function(){a.util.Logger.info("MAPVIEWER_9037","OM.tool.Tool.clear","")},clear_base:function(){this._group&&(this._graphic.remove(this._group),
this._group=null);this._toolShape=null;this.status=a.tool.Tool.STOPPED;if(this.toolFeature){this.toolFeature.deleteEditingProperties&&this.toolFeature.deleteEditingProperties();var b=this._map.getToolFeatureLayer();a.isNotNull(b)&&b.removeFeature(this.toolFeature);this.toolFeature=null;b=a.event.ToolEvent;b=new b(b.TOOL_CLEAR,this);this.fire(b.type,b)}},getStatus:function(){return this.status},getGeometry:function(){return this._geometry},setDrawingStyle:function(b){if(!b)return this;this._style=
b.clone();a.isNull(b.fill)&&(this._style.fill=this._map.graphics.oui.NO_PAINT);return this},setStyle:function(a){this.featureStyle=a.clone();this.toolFeature&&this.toolFeature.setRenderingStyle(this.featureStyle);return this}});a.tool.Tool.STOPPED=0;a.tool.Tool.STARTED=1;a.tool.Tool.FINISHED=3;a.tool.CircleTool=a.tool.Tool.extend({initialize:function K(b){K.base.call(this,b);this._radius=0;this._toPntOfCircle=this._geoCenter=null;var c=this,p=a.event.ToolEvent,v=null;this.begin=function(b){if(c.status==
a.tool.Tool.STARTED){c._geoCenter=c._map.getCursorLocation();var Q=b.pageX-c._$container.offset().left;b=b.pageY-c._$container.offset().top;var w=c._graphic.getLeftTop(c._map.draggableGroup),w={cx:Q-w.x,cy:b-w.y,width:1,height:1};v={x:Q,y:b};c._style.fill=c._graphic.oui.NO_PAINT;c._toolShape?c._graphic.setEllipse(c._toolShape,w):c._toolShape=c._graphic.drawEllipse(w,c._style,{group:c._group});a.$(document).bind("mousemove",c.drawShape);a.browser.touchSupported&&c._$container.bind("touchmove",c.drawShape_touch);
b=new p(p.TOOL_START,c);c.fire(b.type,b)}};this.begin_touch=function(b){var p=a.util.DomUtil;1<p.getTouchCount(b)||(p=p.getTouchesPosition(b),b.pageX=p.x,b.pageY=p.y,c.begin(b))};this.drawShape=function(b){if(c.status==a.tool.Tool.STARTED){var Q=b.pageX-c._$container.offset().left;b=b.pageY-c._$container.offset().top;(0>=Q||0>b||Q>c._map.getMapContext().getDeviceWidth()||b>c._map.getMapContext().getDeviceHeight())&&c.finish();var w=Math.round(Math.sqrt((Q-v.x)*(Q-v.x)+(b-v.y)*(b-v.y))),z=c._map.getMapContext().getUniverse().getZoomLevels()[c._map.getMapContext().getZoomLevel()].resolution;
c._radius=w*z;c._toPntOfCircle=c._map.getScreenPointLocation(Q,b);c._graphic.setEllipse(c._toolShape,{width:2*w,height:2*w});Q=new p(p.CIRCLE_DRAG,c);c.fire(Q.type,Q)}};this.drawShape_touch=function(b){var p=a.util.DomUtil;1<p.getTouchCount(b)||(p=p.getTouchesPosition(b),b.pageX=p.x,b.pageY=p.y,c.drawShape(b))};this.finish=function(b){c._map.enableMapDrag(!0);c._map.enableMapAction.mouse=!0;v=null;c._$container.unbind("mousedown",c.begin);c.drawShape&&a.$(document).unbind("mousemove",c.drawShape);
c._$container.unbind("mouseup",c.finish);a.browser.touchSupported&&(c._$container.unbind("touchstart",c.begin_touch),c._$container.unbind("touchmove",c.drawShape_touch),c._$container.unbind("touchend",c.finish));c._graphic.remove(c._toolShape);c.status=a.tool.Tool.FINISHED;c._geoCenter&&(c._geometry=new a.geometry.Circle(c._geoCenter.getX(),c._geoCenter.getY(),c._radius,c._geoCenter.srid),c.toolFeature=new a.Feature("circleTool"+(new Date).getTime(),c._geometry,{renderingStyle:c.featureStyle}),c._map.getToolFeatureLayer().addFeature(c.toolFeature),
c._geoCenter=null,b=new p(p.TOOL_END,c),c.fire(b.type,b))}},start:function(){var b=a.event.ToolEvent;this._radius=0;this._geoCenter=null;this.clear();this._map.enableMapDrag(!1);this._map.enableMapAction.mouse=!1;this._group||(this._group=this._graphic.createGroup(),this._graphic.addGroup(this._group,this._map.draggableGroup));this._$container.bind("mousedown",this.begin);this._$container.bind("mouseup",this.finish);a.browser.touchSupported&&(this._$container.bind("touchstart",this.begin_touch),this._$container.bind("touchend",
this.finish));this.status=a.tool.Tool.STARTED;b=new b(b.TOOL_START,this);this.fire(b.type,b);return this},clear:function(){this.finish();this.clear_base()},getCenter:function(){return this._geoCenter},getRadius:function(b,c){if(!b)return null;var n=[];this._geoCenter?(n.push(this._geoCenter.getX()),n.push(this._geoCenter.getY())):this._geometry&&(n.push(this._geometry.centerX),n.push(this._geometry.centerY));n.push(this._toPntOfCircle.getX());n.push(this._toPntOfCircle.getY());var p=null;this._geoCenter?
p=new a.geometry.LineString(n,this._geoCenter.srid):this._geometry&&(p=new a.geometry.LineString(n,this._geometry.srid));return p?a.util.GeomUtil.getLength(p,c,{unit:b,transformToGeodetic:!0}):null},getDrawingRadius:function(){return this._radius}});a.tool.RectangleTool=a.tool.Tool.extend({initialize:function z(b){z.base.call(this,b);this.allowZeroSize=!1;var c=this,v=a.event.ToolEvent,V,Q,w=null;this.dragGeoPoint=this.startGeoPoint=null;this.begin=function(b){if(c.status===a.tool.Tool.STARTED){c.startGeoPoint=
c._map.getCursorLocation();c.dragGeoPoint=c._map.getCursorLocation();var v=b.pageX-c._$container.offset().left;b=b.pageY-c._$container.offset().top;V=v;Q=b;var n=c._graphic.getLeftTop(c._map.draggableGroup),v={x:v-n.x,y:b-n.y,width:1,height:1};a.isNull(c._style.fill)&&(c._style.fill=c._graphic.oui.NO_PAINT);c._toolShape?c._graphic.setRectangle(c._toolShape,v):c._toolShape=c._graphic.drawRectangle(v,c._style,{group:c._group});a.$(document).bind("mousemove",c.drawShape);a.browser.touchSupported&&c._$container.bind("touchmove",
c.drawShape_touch)}};this.begin_touch=function(b){var v=a.util.DomUtil;1<v.getTouchCount(b)||(v=v.getTouchesPosition(b),b.pageX=v.x,b.pageY=v.y,c.begin(b))};this.drawShape=function(b){if(c.status===a.tool.Tool.STARTED){var n=V,w=Q,z=b.pageX-c._$container.offset().left;b=b.pageY-c._$container.offset().top;(0>=z||0>b||z>c._map.getMapContext().getDeviceWidth()||b>c._map.getMapContext().getDeviceHeight())&&c.finish();c.dragGeoPoint=c._map.getCursorLocation();var ta=c._graphic.getLeftTop(c._map.draggableGroup),
n={width:Math.abs(z-n),height:Math.abs(b-w),x:n<z?n-ta.x:z-ta.x,y:w<b?w-ta.y:b-ta.y};c._graphic.setRectangle(c._toolShape,n);b=new v(v.RECTANGLE_DRAG,c);c.fire(b.type,b)}};this.drawShape_touch=function(b){var v=a.util.DomUtil;1<v.getTouchCount(b)||(v=v.getTouchesPosition(b),b.pageX=v.x,b.pageY=v.y,c.drawShape(b))};this.finish=function(b){c._map.enableMapDrag(!0);c._map.enableMapAction.mouse=!0;a.gv.featureDrag=!0;a.gv.allowFeaturePointsInteraction=!0;c._$container.unbind("mousedown",c.begin);c.drawShape&&
a.$(document).unbind("mousemove",c.drawShape);c._$container.unbind("mouseup",c.finish);a.browser.touchSupported&&(c._$container.unbind("touchstart",c.begin_touch),c._$container.unbind("touchmove",c.drawShape_touch),c._$container.unbind("touchend",c.finish));c._graphic.remove(c._toolShape);c.status=a.tool.Tool.FINISHED;c.dragGeoPoint=null;if(c.startGeoPoint)if(w=c._map.getCursorLocation(),c.startGeoPoint.getX()!==w.getX()&&c.startGeoPoint.getY()!==w.getY()||c.allowZeroSize){b=[c.startGeoPoint.getX(),
c.startGeoPoint.getY(),w.getX(),w.getY()];var n=0;b[0]>b[2]&&(n=b[0],b[0]=b[2],b[2]=n);b[1]>b[3]&&(n=b[1],b[1]=b[3],b[3]=n);c._geometry=new a.geometry.Rectangle(b[0],b[1],b[2],b[3],w.srid);c.toolFeature=new a.Feature("rectangleTool"+(new Date).getTime(),c._geometry,{renderingStyle:c.featureStyle});c._map.getToolFeatureLayer().addFeature(c.toolFeature);c.startGeoPoint=null;b=new v(v.TOOL_END,c);c.fire(b.type,b)}else c._geometry=null,c.startGeoPoint=null,a.util.Logger.alert("MAPVIEWER_9045","OM.tool.RectangleTool.finish",
""),c.start()}},setZeroSizeAllowed:function(a){this.allowZeroSize=a},start:function(){var b=a.event.ToolEvent;this.clear();this._map.enableMapDrag(!1);this._map.enableMapAction.mouse=!1;this._group||(this._group=this._graphic.createGroup(),this._graphic.addGroup(this._group,this._map.draggableGroup));this._$container.bind("mousedown",this.begin);this._$container.bind("mouseup",this.finish);a.browser.touchSupported&&(this._$container.bind("touchstart",this.begin_touch),this._$container.bind("touchend",
this.finish));this.status=a.tool.Tool.STARTED;a.gv.featureDrag=!1;a.gv.allowFeaturePointsInteraction=!1;b=new b(b.TOOL_START,this);this.fire(b.type,b);return this},clear:function(){this.finish();this.clear_base()},getDraggingWidth:function(){return this.status!==a.tool.Tool.STARTED||a.isNull(this.startGeoPoint)||a.isNull(this.dragGeoPoint)?0:Math.abs(this.startGeoPoint.getX()-this.dragGeoPoint.getX())},getDraggingHeight:function(){return this.status!==a.tool.Tool.STARTED||a.isNull(this.startGeoPoint)||
a.isNull(this.dragGeoPoint)?0:Math.abs(this.startGeoPoint.getY()-this.dragGeoPoint.getY())}});a.tool.DistanceTool=a.tool.Tool.extend({initialize:function n(b,c){n.base.call(this,b);this._tool=new a.tool.RedlineTool(b,a.tool.RedlineTool.TYPE_LINESTRING,{continuousMode:!1});this.unit="kilometer";c&&c.unit&&(this.unit=c.unit);this.transformToGeodetic=!0;c&&!1===c.transformToGeodetic&&(this.transformToGeodetic=c.transformToGeodetic);c&&c.dataSource&&(this.dataSource=c.dataSource);this._map=b;this._distanceInfo=
null;this._lastSubTotalDis=this._subTotalDis=0;this.segmentsDisArray=[];var V=this,Q=a.event.ToolEvent;this.newPoint=function(){var b=V._tool;if(1<b._points.length){for(var c=[],v=null,p=0;p<b._points.length;p++)v=b._points[p].geo,c.push(v.getX()),c.push(v.getY());V.calTotalDistance(new a.geometry.LineString(c,V._map.getMapContext().getUniverse().srid))}};this.drawing=function(b){V._map.getMapContext().getUniverse();a.$("#sub_tr_1")&&a.$("#sub_tr_1").show();V._distanceInfo.setVisible(!0);var c=V._map.getAbsoluteCursorLocation();
a.isNotNull(b.loc)&&(c=b.loc);b=V._tool._points[V._tool._points.length-1].geo;c=a.util.GeomUtil.getLength(new a.geometry.LineString([c.getX(),c.getY(),b.getX(),b.getY()],V._map.getMapContext().getUniverse().srid),null,{unit:V.unit,transformToGeodetic:V.transformToGeodetic,dataSource:V.dataSource,toServerTranform:!1});c=Math.round(100*c)/100;a.$("#distance_total_1").text(Math.round(100*(V._subTotalDis+c))/100+V.getUnitLabel(V.unit));a.$("#distance_sub_1").text(c+V.getUnitLabel(V.unit))};this.finish=
function(){if(V.status==a.tool.Tool.STARTED){V.status=a.tool.Tool.FINISHED;V.calTotalDistance(V._tool.toolFeature.geo);V._tool.finish();var b=new Q(Q.TOOL_END,V);V.fire(b.type,b);V._tool.toolFeature.on(a.event.LayerEvent.FEATURE_EDITED,V.edit,V._tool.toolFeature)}};this.edit=function(){V.calSegmentsDistance(V._tool.toolFeature.geo)};this._tool.on(Q.REDLINE_POINT_CREATE,V.newPoint);this._tool.on(Q.REDLINE_DRAW,V.drawing);this._tool.on(Q.TOOL_END,V.finish);this._tool.on(Q.REDLINE_EDITED,V.edit)},start:function(){this.clear();
this._distanceInfo=new a.control.MapDecoration("\x3ctable style\x3d'width:100%;border:0'\x3e \x3ctr\x3e\x3ctd align\x3d'right'\x3e"+a.gv.getLabel("MAPVIEWER_SB_TOTAL_DISTANCE").replace(/[ ]/g,"\x26nbsp;")+":\x3c/td\x3e\x3ctd align\x3d'left'\x3e\x3cspan id\x3d'distance_total_1'\x3e0"+this.getUnitLabel(this.unit)+"\x3c/span\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr id\x3d'sub_tr_1'\x3e\x3ctd align\x3d'right'\x3e"+a.gv.getLabel("MAPVIEWER_SB_SUB_DISTANCE").replace(/[ ]/g,"\x26nbsp;")+":\x3c/td\x3e\x3ctd align\x3d'left'\x3e\x3cspan id\x3d'distance_sub_1'\x3e0"+
this.getUnitLabel(this.unit)+"\x3c/span\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",{left:.5,top:.7},{draggable:!0,panelOptions:{style:{"border-style":"solid","border-color":"#0000ff","border-width":"1px",backgroundColor:"#FDFDFD",filter:"alpha(Opacity\x3d80)","-moz-opacity":"0.8",opacity:"0.8"}}});this._map.addMapDecoration(this._distanceInfo);this._distanceInfo.setVisible(!1);this._tool.start();this.status=a.tool.Tool.STARTED;var b=new a.event.ToolEvent(a.event.ToolEvent.TOOL_START,this);this.fire(b.type,
b);return this},clear:function(){this._distanceInfo&&(this._distanceInfo.setVisible(!1),this._map.removeMapDecoration(this._distanceInfo),this._distanceInfo=null);this._subTotalDis=0;this.segmentsDisArray=[];this._tool.clear()},getGeometry:function(){return this._tool.getGeometry()},getSegmentsArray:function(){return this.segmentsDisArray},getTotalDistance:function(){return Math.round(100*this._subTotalDis)/100},calTotalDistance:function(b){var c=this,v=function(v){0!==v&&(c._subTotalDis=v,c._distanceInfo.setVisible(!0),
a.$("#distance_total_1").text(Math.round(100*c._subTotalDis)/100+c.getUnitLabel(c.unit)),c.segmentsDisArray.length&&c.status!=a.tool.Tool.FINISHED&&c.segmentsDisArray.push(Math.round(100*(c._subTotalDis-c._lastSubTotalDis))/100),0===c.segmentsDisArray.length&&c.segmentsDisArray.push(Math.round(100*c._subTotalDis)/100),a.$("#sub_tr_1")&&a.$("#sub_tr_1").hide(),c._lastSubTotalDis=v,v=a.event.ToolEvent,v=new v(v.DISTANCE_UPDATE,c),v.point=b.getLastPoint(),c.fire(v.type,v))};c.transformToGeodetic?b.transform(8307,
function(b){4<=b.coordinates.length&&a.util.GeomUtil.getLength(b,v,{unit:c.unit,transformToGeodetic:c.transformToGeodetic,dataSource:c.dataSource})}):4<=b.coordinates.length&&a.util.GeomUtil.getLength(b,v,{unit:c.unit,transformToGeodetic:c.transformToGeodetic,dataSource:c.dataSource})},calSegmentsDistance:function(b){var c=this;c.segmentsDisArray=[];var v=[],V=0,Q=[],w=function(a,b){0!==a&&(c.segmentsDisArray[b]=Math.round(100*a)/100)};if(c.transformToGeodetic)b.transform(8307,function(b){for(var n=
0;n<b.getOrdinates().length/2-1;n++)Q[n]=w,v[n]=new a.geometry.LineString([b.getOrdinates()[2*n],b.getOrdinates()[2*n+1],b.getOrdinates()[2*n+2],b.getOrdinates()[2*n+3]],b.srid),4<=v[n].coordinates.length&&a.util.GeomUtil.getLength(v[n],Q[n],{idx:n,unit:c.unit,transformToGeodetic:c.transformToGeodetic,dataSource:c.dataSource})});else for(var ha=0;ha<b.getOrdinates().length/2-1;ha++)Q[ha]=w,v[ha]=new a.geometry.LineString([b.getOrdinates()[2*ha],b.getOrdinates()[2*ha+1],b.getOrdinates()[2*ha+2],b.getOrdinates()[2*
ha+3]],b.srid),4<=v[ha].coordinates.length&&a.util.GeomUtil.getLength(v[ha],Q[ha],{idx:ha,unit:c.unit,transformToGeodetic:c.transformToGeodetic,dataSource:c.dataSource});var pa=setInterval(function(){if(c.segmentsDisArray.length==b.getOrdinates().length/2-1){for(var v=0;v<c.segmentsDisArray.length;v++)V+=c.segmentsDisArray[v];c._distanceInfo.setVisible(!0);c._subTotalDis=V;a.$("#distance_total_1").text(Math.round(100*c._subTotalDis)/100+c.getUnitLabel(c.unit));a.$("#sub_tr_1")&&a.$("#sub_tr_1").hide();
v=a.event.ToolEvent;v=new v(v.DISTANCE_UPDATE,c);v.point=b.getLastPoint();c.fire(v.type,v);clearInterval(pa)}},100)},getUnitLabel:function(b){b||(b=this.unit);return b?(b=b.toUpperCase(),"KILOMETER"===b||"KM"===b?a.gv.getLabel("MAPVIEWER_SB_KILOMETERS"):"METER"===b||"M"===b?a.gv.getLabel("MAPVIEWER_SB_METERS"):"MILE"===b?a.gv.getLabel("MAPVIEWER_SB_MILES"):"FOOT"===b?a.gv.getLabel("MAPVIEWER_SB_FEET"):"CENTIMETER"===b||"CM"===b?a.gv.getLabel("MAPVIEWER_SB_CENTIMETER"):"YARD"===b?a.gv.getLabel("MAPVIEWER_SB_YARD"):
b):"KM"},setDrawingStyle:function(a){if(!a)return this;this._tool&&this._tool.setDrawingStyle(a)},setStyle:function(b){this._tool&&this._tool.setStyle({type:a.tool.DistanceTool.TYPE_LINESTRING,style:b})}});a.tool.DistanceTool.TYPE_POINT=1;a.tool.DistanceTool.TYPE_LINESTRING=2;a.tool.RedlineTool=a.tool.Tool.extend({initialize:function p(c,V,Q){p.base.call(this,c);var w=this;this.activeMapIndex=null;this.finishMode=a.tool.RedlineTool.FINISH_ON_CLICK;this.simplified=!0;Q&&(a.notNull(Q.simplified)&&(this.simplified=
Q.simplified),a.notNull(Q.finishMode)&&(this.finishMode=Q.finishMode));this.start_move_line_mode=!1;this._geoType=V&&"number"==typeof V?V:a.tool.RedlineTool.TYPE_POLYGON;this._pointStyle=new a.style.Marker({width:10,height:10,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});this._pointEndHoverStyle=new a.style.Marker({width:15,height:15,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:15,height:15},style:{fill:"#ffffff",
stroke:"#0000ff",strokeThickness:1}}]});this.featurePointStyle=this._pointStyle;this.featurePolygonStyle=this.featureStyle=this._style;this._nextPointId=0;w._nextLineId=0;this._points=[];this._continuousPoints=[];this._screenPoints=[];this._lines=[];this._shapeGroup=null;this._editFlag=!0;var ha=null,pa=null,ua=null,Aa=null;this.dragging=!1;var ta=a.event.ToolEvent;this.snapPoint=null;this.mouseDown=function(b){0===b.button&&(ha=b.pageX,w.dragging=!0,w._group&&w._group.bringToFront(),w._geoType!==
a.tool.RedlineTool.TYPE_POINT&&w._map.enableMapDrag(!1));b.stopPropagation()};this.nextPoint=function(b,c){if(w.status==a.tool.Tool.STARTED){var v=a.util.ValidationUtil.isNumber;a.notNull(b)&&a.notNull(c)&&v(b)&&v(c)&&(v=a.MapContext(w._map).getUniverse().srid,v=new a.geometry.Point(b,c,v),w.addVertex(null,v))}};this.mouseUp=function(b){if(2===b.button)b=new ta(a.event.ToolEvent.MOUSE_RIGHT_CLICK,w),w.fire(b.type,b);else if(w.status!=a.tool.Tool.STOPPED&&w.status!=a.tool.Tool.FINISHED){w._graphic.getLeftTop(w._map.draggableGroup);
w._$container.offset();w._$container.offset();if(0<w._continuousPoints.length){var c;c=w.simplified?a.util.GeomUtil.simplify(w._continuousPoints,3):w._continuousPoints;w._continuousPoints=[];w._screenPoints=[];w._map.getUndoManager().startChangeBlock();for(var v=1;v<c.length;v++){var p=c[v];p&&w.addVertex(null,p)}w.endBlock=w._map.getUndoManager().endChangeBlock()}w.dragging=!1;a.notNull(w.snapPoint)&&2===w.snapPoint.length&&(w._map.mLocX=w.snapPoint[0],w._map.mLocY=w.snapPoint[1]);(b.isRedo||b.pageX==
ha&&b.pageX!=Aa)&&w.addVertex(null,{x:w._map.mLocX,y:w._map.mLocY});Aa=b.pageX;w.done(b,w.finishMode===a.tool.RedlineTool.FINISH_ON_RELEASE)}};this.done=function(a,b){return w.clicktofinish||b?(w.finishAndCleanUp(a),!0):!1};this.finishAndCleanUp=function(a){a.preventDefault();w.finish();w.finishFeature=null;ua=pa=w.clicktofinish=null;w.dragging=!1};this.mouseMove=function(b){w.snapPoint=null;if(a.isNotNull(w.finishFeature)){var c=w._map.getScreenLocation(w.finishFeature.getGeometry()),v=w._map.getScreenLocation(w._map.getAbsoluteCursorLocation());
if(5>=Math.abs(v.x-c.x)&&5>=Math.abs(v.y-c.y)){var p;switch(w._geoType){case a.tool.RedlineTool.TYPE_POINT:p=1;break;case a.tool.RedlineTool.TYPE_LINESTRING:p=2;break;case a.tool.RedlineTool.TYPE_POLYGON:p=3}if(w._points.length>p-1&&(w.finishFeature.bringToTop(),a.isNotNull(w.finishFeature.movedOut)||w.touchEnabled)&&(w.finishFeature.setRenderingStyle(w._pointEndHoverStyle),w.clicktofinish=!0,w._geoType==a.tool.RedlineTool.TYPE_LINESTRING)){w.setPath(w._shapeGroup,[[0,0,0,0]],w._style);b=new ta(ta.REDLINE_DRAW,
w);b.loc=w.finishFeature.getGeometry();w.fire(b.type,b);return}}else w.clicktofinish=!1,w.finishFeature.setRenderingStyle(w._pointStyle),w.finishFeature.bringToTop(),w.finishFeature.movedOut=!0}if(w.status!=a.tool.Tool.STOPPED&&w.status!=a.tool.Tool.FINISHED){if(a.isNull(w.clicktofinish)||!1===w.clicktofinish)c=new ta(a.event.ToolEvent.SNAP_POINT,w),w.fire(c.type,c);w._geoType!=a.tool.RedlineTool.TYPE_POINT&&(v=w._graphic.getLeftTop(w._map.draggableGroup),c=b.pageX-w._$container.offset().left-v.x,
b=b.pageY-w._$container.offset().top-v.y,w.dragging?(w._screenPoints.push(c),w._screenPoints.push(b),b=w._map.getAbsoluteCursorLocation(),b=new a.Feature("_rlcpt"+w._continuousPoints.length,b,{renderingStyle:w._pointStyle}),b.x=w._map.mLocX,b.y=w._map.mLocY,w._continuousPoints.push(b),1<w._continuousPoints.length?w._shapeGroup?w.setPath(w._shapeGroup,[w._screenPoints],w._style):w._shapeGroup=w.drawLine([w._continuousPoints],w._style,{group:w._group}):w.addVertex(null,{x:w._map.mLocX,y:w._map.mLocY})):
pa&&ua&&(w._shapeGroup?w.setPath(w._shapeGroup,[[pa,ua,c,b]],w._style):(w._zoom&&(v=w._map.getScreenLocation(w._points[w._points.length-1].geo),pa=v[0],ua=v[1],w._zoom=!1),w._shapeGroup=w.drawLine([[pa,ua,c,b]],w._style,{group:w._group})),b=new ta(ta.REDLINE_DRAW,w),w.fire(b.type,b)))}};this.addVertex=function(b,c,v){var p=a.MapContext(w._map),Q=w._points,V=w._lines,Aa=w._map.getToolFeatureLayer(),ha;if("number"!==typeof b||0>b||b>Q.length)b=Q.length;c instanceof a.geometry.Point?(ha=a.MapContext(w._map).getUniverse(),
ha=ha.srid,ha!=c.srid&&(c=c.transform(ha)),c.wraparoundMapIndex=p.getBaseWholeMapIndex()):c=w._map.getScreenPointLocation(c.x,c.y);w.activeMapIndex||(w.activeMapIndex=c.wraparoundMapIndex);if(c.wraparoundMapIndex===w.activeMapIndex){c.wraparoundMapIndex&&(c=w._map.getACL(c,c.wraparoundMapIndex));var nb;if(0===Q.length||w._geoType!==a.tool.RedlineTool.TYPE_POINT){p=new a.Feature("RedlinePoints"+w._nextPointId++,c,{renderingStyle:w._pointStyle});p.activeIdx=w.activeIdx;Q.splice(b,0,p);Aa.addFeature(p);
switch(w._geoType){case a.tool.RedlineTool.TYPE_POINT:w.finish();break;case a.tool.RedlineTool.TYPE_LINESTRING:1<Q.length&&(w.finishFeature=p);break;case a.tool.RedlineTool.TYPE_POLYGON:1==Q.length?w.finishFeature=p:a.isNotNull(w.finishFeature)&&w.finishFeature.bringToTop()}p=!1;Q[b-1]&&(ha=Q[b-1].getGeometry(),ha=new a.geometry.LineString([ha.getX(),ha.getY(),c.getX(),c.getY()],ha.srid),ha=new a.Feature("RedlineLines"+w._nextLineId++,ha,{renderingStyle:w._style}),ha.activeIdx=w.activeIdx,V.splice(b,
0,ha),Aa.addFeature(ha),p=!0);Q[b+1]&&(ha=Q[b+1].getGeometry(),ha=new a.geometry.LineString([c.getX(),c.getY(),ha.getX(),ha.getY()],ha.srid),ha=new a.Feature("RedlineLines"+w._nextLineId++,ha,{renderingStyle:w._style}),p&&(Aa.removeFeature(V[b-1]),V.splice(b-1,1)),V.splice(b,0,ha),Aa.addFeature(ha))}else nb=Q[0].getGeometry(),Q[0].setGeometry(c),w.finishFeature=Q[0],w.finishFeature.movedOut=null;v||w._geoType===a.tool.RedlineTool.TYPE_POINT||(v=w._map.getUndoManager().addEdit({index:b,vertex:c,prevVertex:nb,
canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"Redline tool point ("+this.x+","+this.y+")"},undo:function(){this.prevVertex?w.addVertex(this.index,this.prevVertex,!0):w.removeVertex(this.index,!0)},redo:function(){w.addVertex(this.index,this.vertex,!0)}}),a.isNull(w.startBlock)&&(w.startBlock=v),w.endBlock=v);b==Q.length-1&&(w.removeShapeGroup(w),w._shapeGroup=null,b=w._map.getScreenLocation(c),c=w._graphic.getLeftTop(w._map.draggableGroup),pa=b.x-
c.x,ua=b.y-c.y);b=new ta(ta.REDLINE_POINT_CREATE,w);w.fire(b.type,b)}};this.removeVertex=function(b,c){var v=w._points;if(!(0>b||b>=v.length)){var p=w._lines,Q=w._map.getToolFeatureLayer(),V,ha=1,Aa=v[b-1],nb=v[b+1];Aa&&nb&&(ha=2,V=Aa.getGeometry(),nb=nb.getGeometry(),V=new a.geometry.LineString([V.getX(),V.getY(),nb.getX(),nb.getY()],V.srid),V=new a.Feature("RedlineLines"+w._nextLineId++,V,{renderingStyle:w._style}),Q.addFeature(V));nb=v.splice(b,1)[0];Q.removeFeature(nb);nb=nb.getGeometry();p=V?
p.splice(Math.max(0,b-1),ha,V):p.splice(Math.max(0,b-1),ha);for(ha=0;ha<p.length;ha++)Q.removeFeature(p[ha]);c||w._geoType===a.tool.RedlineTool.TYPE_POINT||(Q=w._map.getUndoManager().addEdit({index:b,vertex:nb,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"Redline tool point ("+this.x+","+this.y+")"},undo:function(){w.addVertex(this.index,this.vertex,!0)},redo:function(){w.removeVertex(this.index,!0)}}),a.isNull(w.startBlock)&&(w.startBlock=Q),w.endBlock=
Q);b==v.length&&(w.removeShapeGroup(w),ua=pa=w._shapeGroup=null,Aa&&(v=w._map.getScreenLocation(Aa.getGeometry()),Aa=w._graphic.getLeftTop(w._map.draggableGroup),pa=v.x-Aa.x,ua=v.y-Aa.y));v=new ta(ta.REDLINE_POINT_REMOVE,w);w.fire(v.type,v)}};this.newShapePoint=function(a,b,c,v,p){this.addVertex(null,w._map.getScreenPointLocation(a,b,!0))};this.zoomAction=function(){w.finish()};this.finish=function(){if(w.status==a.tool.Tool.STARTED){a.isNotNull(this.startBlock)&&a.isNotNull(this.endBlock)&&(w._map.getUndoManager().trimEdits(this.startBlock,
this.endBlock+1),this.endBlock=this.startBlock=b);var c=w._map.getToolFeatureLayer();w._map.deleteListener(a.event.MapEvent.MAP_BEFORE_ZOOM,w.zoomAction,w);var v=!0;a.browser.touchSupported||a.gv.isWin8Touch||(v=!1);w._$container.unbind("mousemove",w.mouseMove);w._$container.unbind("mouseup",w.mouseUp);w._$container.unbind("mousedown",w.mouseDown);a.gv.isWin8Touch&&(w._$container[0].removeEventListener("MSPointerUp",w.mouseUp),w._$container[0].removeEventListener("MSPointerDown",w.mouseDown));a.browser.touchSupported&&
(w._$container.unbind("touchstart",w.touchStart),w._$container.unbind("touchmove",w.touchMove),w._$container.unbind("touchend",w.touchEnd));w.touchEnabled=null;v&&a.Hammer(w._$container[0]).off("hold",w.finishAndCleanUp);w.removeShapeGroup(w);if(0===w._points.length)w.status=a.tool.Tool.FINISHED;else{var v=[],p;for(p=0;p<w._points.length;p++)0<p&&w._points[p].getGeometry().getX()==w._points[p-1].getGeometry().getX()&&w._points[p].getGeometry().getY()==w._points[p-1].getGeometry().getY()||(v.push(w._points[p].getGeometry().getX()),
v.push(w._points[p].getGeometry().getY())),c.removeFeature(w._points[p]);for(p=0;p<w._lines.length;p++)c.removeFeature(w._lines[p]);switch(w._geoType){case a.tool.RedlineTool.TYPE_POINT:c=v;w._geometry=new a.geometry.Point(c[c.length-2],v[v.length-1],w._points[0].getGeometry().srid);break;case a.tool.RedlineTool.TYPE_LINESTRING:if(2>w._points.length){w.status=a.tool.Tool.FINISHED;a.util.Logger.warning("MAPVIEWER_9011","OM.tool.RedlineTool.finish","");w._map.moveflag=!1;v=new ta(ta.TOOL_END,w);w.fire(v.type,
v);w._map.enableMapAction.dbclick=!0;w._map.enableMapAction.mouse=!0;w._map.enableMapDrag(!0);return}w._geometry=new a.geometry.LineString(v,w._points[0].getGeometry().srid);break;case a.tool.RedlineTool.TYPE_POLYGON:if(3>w._points.length){w.status=a.tool.Tool.FINISHED;a.util.Logger.warning("MAPVIEWER_9012","OM.tool.RedlineTool.finish","");w._map.moveflag=!1;v=new ta(ta.TOOL_END,w);w.fire(v.type,v);w._map.enableMapAction.dbclick=!0;w._map.enableMapAction.mouse=!0;w._map.enableMapDrag(!0);return}c=
w._points[0].getGeometry();v.push(c.getX());v.push(c.getY());w._geometry=new a.geometry.Polygon(v,c.srid)}w.end();w.status=a.tool.Tool.FINISHED;v=new ta(ta.TOOL_END,w);w.fire(v.type,v)}w._map.enableMapAction.dbclick=!0;w._map.enableMapAction.mouse=!0;w._map.enableMapDrag(!0)}};this.touchStart=function(b){var c=a.util.DomUtil,v=c.getTouchCount(b);if(1==v)b.button=0,c=c.getTouchesPosition(b),w.touchPos=c,b.pageX=c.x,b.pageY=c.y;else if(2==v)b.button=2;else return;w.mouseDown(b)};this.touchMove=function(){w.touchPos=
null};this.touchEnd=function(a){w.touchPos&&(a.pageX=w.touchPos.x,a.pageY=w.touchPos.y,w.mouseMove(a),w.mouseUp(a))}},start:function(){var b=a.event.ToolEvent;this.clear();this._map.enableMapAction.dbclick=!1;this._map.enableMapAction.mouse=!1;this._group||(this._group=this._graphic.createGroup(),this._graphic.addGroup(this._group,this._map.draggableGroup));this.domainArea={};this.activeIdx=null;this._points=[];this._lines=[];this._map.on(a.event.MapEvent.MAP_BEFORE_ZOOM,this.zoomAction,this);var c=
!0;a.browser.touchSupported||a.gv.isWin8Touch||(c=!1);this._$container.bind("mouseup",this.mouseUp);this._$container.bind("mousedown",this.mouseDown);this._$container.bind("mousemove",this.mouseMove);a.gv.isWin8Touch&&(this._$container[0].addEventListener("MSPointerUp",this.mouseUp),this._$container[0].addEventListener("MSPointerDown",this.mouseDown));a.browser.touchSupported?(this._$container.bind("touchstart",this.touchStart),this._$container.bind("touchmove",this.touchMove),this._$container.bind("touchend",
this.touchEnd),this.touchEnabled=!0):this.touchEnabled=!1;if(c)a.Hammer(this._$container[0]).on("hold",this.finishAndCleanUp);this.status=a.tool.Tool.STARTED;this.fire(b.type,b);return this},end:function(){var b=null;switch(this._geoType){case a.tool.RedlineTool.TYPE_POINT:b=this.featurePointStyle;break;case a.tool.RedlineTool.TYPE_LINESTRING:b=this.featureStyle;break;case a.tool.RedlineTool.TYPE_POLYGON:b=this.featurePolygonStyle}var c=this._map.getToolFeatureLayer();this.toolFeature=new a.Feature("RedlineTool"+
c.featureArray.length,this._geometry,{renderingStyle:b});this._map.getToolFeatureLayer();c.enableFeatureEditing(!0);c.addFeature(this.toolFeature);this.toolFeature.on(a.event.LayerEvent.FEATURE_MOVED,function(){this._geometry=this.toolFeature.geo;var b=new a.event.ToolEvent(a.event.ToolEvent.REDLINE_EDITED,this);this.fire(b.type,b)},this);this.toolFeature.on(a.event.LayerEvent.FEATURE_EDITED,function(){this._geometry=this.toolFeature.geo;var b=new a.event.ToolEvent(a.event.ToolEvent.REDLINE_EDITED,
this);this.fire(b.type,b)},this)},clear:function(){this.finish();this._pointStyle=new a.style.Marker({width:10,height:10,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});this.clear_base()},getGeometryType:function(){return this._geoType},getGeometry:function(){return this._geometry},setDrawingStyle:function(b){if(!b)return this;var c=a.tool.RedlineTool;b.type===c.TYPE_POINT&&(this._pointStyle=b.style.clone());if(b.type===
c.TYPE_LINESTRING||b.type===c.TYPE_POLYGON)this._style=b.style.clone();return this},drawLine:function(b,c,V){var Q=[];if(c&&"Line"==c.styleType){a.style.Style.calculateStyleSize(c,this._map.getMapContext());c=c.stylelist;for(var w=c.length,ha=0;ha<w;ha++){var pa=c[ha];pa.stroke&&Q.push(this._graphic.drawPath(b,pa,V))}}else V={group:this._group,id:"lstr"},c.stroke||(c.stroke=c.fill?c.fill:"#000000"),c.fill=null,Q.push(this._graphic.drawPath(b,c,V));return Q},setPath:function(b,c,V){if(!a.isNull(b)){b=
b.length;a.style.Style.calculateStyleSize(V,this._map.getMapContext());V=V.stylelist;for(var Q=0;Q<b;Q++)this._graphic.setPath(this._shapeGroup[Q],c,V[Q])}},removeShapeGroup:function(a){if(a&&a._shapeGroup){for(var b=a._shapeGroup.length,c=0;c<b;c++)a._graphic.remove(a._shapeGroup[c]);a._shapeGroup.length=0;a._shapeGroup=null}},setStyle:function(b){b.type==a.tool.RedlineTool.TYPE_POINT&&(this.featurePointStyle=b.style.clone(),this.toolFeature&&this._geoType==a.tool.RedlineTool.TYPE_POINT&&this.toolFeature.setRenderingStyle(this.featurePointStyle));
b.type==a.tool.RedlineTool.TYPE_LINESTRING&&(this.featureStyle=b.style.clone(),this.toolFeature&&this._geoType==a.tool.RedlineTool.TYPE_LINESTRING&&this.toolFeature.setRenderingStyle(this.featureStyle));b.type==a.tool.RedlineTool.TYPE_POLYGON&&(this.featurePolygonStyle=b.style.clone(),this.toolFeature&&this._geoType==a.tool.RedlineTool.TYPE_POLYGON&&this.toolFeature.setRenderingStyle(this.featurePolygonStyle));return this}});a.tool.RedlineTool.TYPE_POINT=1;a.tool.RedlineTool.TYPE_LINESTRING=2;a.tool.RedlineTool.TYPE_POLYGON=
3;a.tool.RedlineTool.FINISH_ON_CLICK=1;a.tool.RedlineTool.FINISH_ON_RELEASE=2;a.tool.MarqueeZoomTool=a.tool.RectangleTool.extend({initialize:function v(b,c){v.base.call(this,b);var w=this;this.mode=c?c:a.tool.MarqueeZoomTool.PROMPT;this.setStyle(new a.style.Color({stroke:"#00FF00",fill:"#FF0000",strokeThickness:1,fillOpacity:.5}));this.setDrawingStyle(new a.style.Color({stroke:"#00FF00",fill:"#FF0000",strokeThickness:1,fillOpacity:.5}));this.on(a.event.ToolEvent.TOOL_END,function(){var c=w.getGeometry(),
v=function(b){w.clear();b&&(w._map.zoomToExtent(c),w.status=a.tool.Tool.FINISHED)},Q=function(){v(!1);b.deleteListener(a.event.MouseEvent.MOUSE_CLICK,Q)},Aa=function(){v(!0);b.deleteListener(a.event.MouseEvent.MOUSE_CLICK,Q)};w.mode!=a.tool.MarqueeZoomTool.PROMPT?v(!0):(w.toolFeature.on(a.event.MouseEvent.MOUSE_CLICK,Aa),b.on(a.event.MouseEvent.MOUSE_CLICK,Q));w.mode==a.tool.MarqueeZoomTool.CONTINUOUS&&w.start()})},setMode:function(a){this.mode=a}});a.tool.MarqueeZoomTool.ONE_TIME=1;a.tool.MarqueeZoomTool.CONTINUOUS=
2;a.tool.MarqueeZoomTool.PROMPT=3;a.tool.ButtonGroup=a.Class.extend({initialize:function(a){this.butGroupId=a;this.buttonArray=[]},createHTML:function(){for(var a="\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e",b=this.buttonArray.length,c=0;c<b;c++)a+="\x3ctd\x3e",a+=this.buttonArray[c].createHTML(),a+="\x3c/td\x3e";return a+"\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e"},addButton:function(a){a.parent=this;this.buttonArray.push(a)},removeButton:function(a){for(var b=this.buttonArray.length,c=0;c<b;c++)this.buttonArray[c]==
a&&(this.buttonArray.splice(c,1),a.parent=null)},attachEvents:function(){for(var a=this.buttonArray.length,b=0;b<a;b++)this.buttonArray[b].attachEvents()},setDownButton:function(a){for(var b=this.buttonArray.length,c=0;c<b;c++){var w=this.buttonArray[c];w==a?w.setStatus(!0):w.setStatus(!1)}}});a.tool.ImageButton=a.Class.extend({initialize:function(b,c){this.btID=b;c&&(this.btIcon=c.buttonEnableIcon,this.btOverIcon=c.buttonOverIcon,this.btDownIcon=c.buttonDownIcon,this.btDisableIcon=c.buttonDisableIcon,
this.tip=c.toolTip,this.width=c.width,this.height=c.height);this.status=c&&c.status?c.status:a.tool.ImageButton.STATUS_UP},createHTML:function(){var b;b='\x3ca href\x3d"javascript:void(0)" style\x3d"vertical-align:bottom"'+(a.isNull(this.tip)?"\x3e":' title\x3d"'+this.tip+'"\x3e');return b+='\x3cimg id\x3d"'+this.btID+'" src\x3d'+this.btIcon+" border\x3d0\x3e\x3c/a\x3e"},attachEvents:function(){this.$icon=a.$("#"+this.btID);this.status==a.tool.ImageButton.STATUS_DOWN&&(this.$icon.attr("src",this.btDownIcon),
this.$icon[0].down=!0);if(!this.attched){this.attched=!0;var b=this;a.$(this.$icon).hover(function(a){b.btOverIcon&&!this.down&&b.$icon.attr("src",b.btOverIcon)},function(a){b.btOverIcon&&!this.down&&b.$icon.attr("src",b.btIcon)}).mousedown(function(a){b.btDownIcon&&b.$icon.attr("src",b.btDownIcon)}).click(function(c){b.parent instanceof a.tool.ButtonGroup?this.down||(this.down=!0,b.parent.setDownButton(b)):b.setStatus(!this.down)})}},setStatus:function(b){b?(this.$icon.attr("src",this.btDownIcon),
this.$icon[0].down=!0,this.status=a.tool.ImageButton.STATUS_DOWN):(this.$icon.attr("src",this.btIcon),this.$icon[0].down=!1,this.status=a.tool.ImageButton.STATUS_UP)}});a.tool.ImageButton.STATUS_DOWN="DOWN";a.tool.ImageButton.STATUS_UP="UP";a.control.MapDecoration=a.Class.extend({mixin:a.event.EventSource,initialize:function(b,c){this.dragDiv=!1;this._randomId=""+this.s4()+this.s4();this.id="decorationDiv_"+this._randomId;this.visible=!0;this.minimized=this.collapsible=!1;this.title="";a.isNull(this.isHtml)&&
(this.isHtml=!1);this.cleaned=!1;this.Y=this.X=0;this.inAnimation=this.draggable=this.relativePosition=this.anchored=!1;this.collapsibleContainer=null;if(b&&b.substr||typeof b)this.isHtml=!0,this.content=b,this.type="CustomHtmlDecoration";if(c){this.restoredWidth=c.width?c.width:0;this.restoredHeight=c.height?c.height:0;this.mapType=c.mapType;this.draggable=c.draggable?c.draggable:!1;a.isNull(c.draggable)&&(this.draggable=!0);this.X=a.notNull(c.offsetX)?c.offsetX:20;this.Y=a.notNull(c.offsetY)?c.offsetY:
20;this.isPanel=!0;this.width=c.width?c.width:0;this.height=c.height?c.height:0;this.title=c.title?c.title:"";this.collapsible=c.collapsible?c.collapsible:!1;this.titleStyle=c.titleStyle?c.titleStyle:null;this.contentStyle=c.contentStyle?c.contentStyle:null;if(a.notNull(c.anchorPosition)){this.anchorPosition=parseInt(c.anchorPosition);if(1>this.anchorPosition||6<this.anchorPosition)a.util.Logger.warning("","OM.MapDecoration.initialize","anchorPosition value is out of range, default value is used."),
this.anchorPosition=1;this.anchored=!0}a.notNull(c.enableAnimation)&&(this.enableAnimation=c.enableAnimation)}},display:function(b){b=this.map||b;var c=this.graphics=b.graphics,Q=b.getMapContext();this.parentMapWidth=Q.getDeviceWidth();this.parentMapHeight=Q.getDeviceHeight();this.isHtml?(this.container=b.$topLayerDIV,this.generateHtmlDecoration(),this.setDraggable(this.draggable),this.delegate("mousedown",function(b){a.event.EventSource.stopEvents[b.type]=!0}),this.delegate("dblclick",function(b){a.event.EventSource.stopEvents[b.type]=
!0})):(this.container=b.fixedGroup,this.defaultGroup=c.createGroup(),c.addGroup(this.defaultGroup,this.container),this.delegate("dblclick",function(a){a.stopPropagation();a.preventDefault()}),this.delegate("mousedown",function(a){a.stopPropagation();a.preventDefault()}),this.delegate("mouseup",function(a){a.stopPropagation();a.preventDefault()}));this.map.on(a.event.MapEvent.MAP_RESIZED,this.resize,this);"NavigationPanelBar"!==this.type&&this.setPosition();a.notNull(this.anchorPosition)&&!0===this.anchored&&
this.setAnchorPosition(this.anchorPosition);this.relativePosition&&!this.draggable&&this.map.addListener(a.event.MapEvent.MAP_RESIZED,this.setPosition,this);this.graphics&&this.defaultGroup&&!this.visible&&this.graphics.setVisible(this.defaultGroup,this.visible);b=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DISPLAYED,this);this.fire(a.event.MapDecorationEvent.DISPLAYED,b)},remove:function(){this.relativePosition&&this.map.deleteListener(a.event.MapEvent.MAP_RESIZED,this.setPosition,
this);this.unDelegate();this.isHtml&&this.$DecorationDiv&&(this.$DecorationDiv.unbind(),this.map&&(this.map.$oracleMapDiv.unbind("mousemove",this.mapDiv_msmove),this.map.$oracleMapDiv.unbind("touchmove",this.mapDiv_touchmove),this.map.$oracleMapDiv.unbind("touchend",this.mapDiv_touchend)),this.$DecorationDiv.remove(),this.$DecorationBtnDiv&&this.$DecorationBtnDiv.remove())},clean:function(){this.unDelegate&&this.unDelegate();this.isHtml?(this.$DecorationDiv.remove(),this.$DecorationBtnDiv&&this.$DecorationBtnDiv.remove()):
this.graphics.clearGroup(this.defaultGroup);this.cleaned=!0},setPosition:function(b,c){1<=b&&(b=parseInt(b));1<=c&&(c=parseInt(c));this.X=b||this.X;this.Y=c||this.Y;this.map&&this.parentMapWidth&&(1>this.X&&0<this.X&&(this.X*=this.parentMapWidth,this.relativePosition=!0),1>this.Y&&0<this.Y&&(this.Y*=this.parentMapHeight,this.relativePosition=!0));this.defaultGroup&&this.graphics?this.graphics.setLeftTop(this.defaultGroup,this.X,this.Y):this.isHtml&&a.notNull(this.$DecorationDiv)&&(this.container.append(this.$DecorationDiv),
this.$DecorationDiv.css({top:this.Y,left:this.X,bottom:"",right:""}))},setAnchorPosition:function(b){isNaN(b)&&(b=this.anchorPosition);var c=b||this.anchorPosition;this.anchorPosition=c;if(!a.isNull(this.map)){var Q=this.container.find("div[id^\x3domv2_anchorBox]");"ScaleBar"===this.type?(this.setMainDecorationAnchorCss(b),$(Q[b-1]).append(this.$DecorationDiv[0])):"CopyRight"===this.type?(this.setCopyRightStyle(b),this.container.append(this.$DecorationDiv)):"NavigationPanelBar"===this.type?(this.setMainDecorationAnchorCss(b),
$(Q[b-1]).append(this.$DecorationDiv[0])):"OverviewMap"===this.type?(this.setMainDecorationAnchorCss(b),$(Q[b-1]).append(this.$DecorationDiv)):"Magnifier"===this.type?(this.$DecorationDiv.detach(),this.setMainDecorationAnchorCss(b),$(Q[b-1]).append(this.$DecorationDiv)):"LayerControl"===this.type?(this.$DecorationDiv.detach(),this.setMainDecorationAnchorCss(b),$(Q[b-1]).append(this.$DecorationDiv)):(this.$DecorationDiv||this.graphics)&&this.doSetAnchorPosition(c);this.anchored=!0}},setMainDecorationAnchorCss:function(a){switch(a){case 1:case 2:case 3:this.$DecorationDiv.css({top:"0px",
bottom:""});break;case 4:case 5:case 6:this.$DecorationDiv.css({bottom:"0px",top:""})}switch(a){case 1:case 4:this.$DecorationDiv.css({left:"0px",right:""});break;case 2:case 5:this.$DecorationDiv.css({left:"",right:""});break;case 3:case 6:this.$DecorationDiv.css({left:"",right:"0px"})}},setCopyRightStyle:function(a){this.$DecorationDiv.css({display:"inline-flex"});switch(a){case 1:this.$DecorationDiv.css({display:"inline-flex",left:"0px","justify-content":"center","align-items":"flex-start","align-content":"flex-start",
top:"0px",right:"",bottom:""});break;case 2:this.$DecorationDiv.css({display:"inline-flex",left:"calc(50% - "+this.$DecorationDiv.width()/2+"px )","justify-content":"center","align-items":"flex-start","align-content":"flex-start",top:"0px",right:"",bottom:""});break;case 3:this.$DecorationDiv.css({display:"inline-flex",right:"0px","justify-content":"center","align-items":"flex-end","align-content":"flex-end",top:"0px",left:"",bottom:""});break;case 4:this.$DecorationDiv.css({display:"inline-flex",
left:"0px","justify-content":"center","align-items":"flex-start","align-content":"flex-start",bottom:"0px",right:"",top:""});break;case 5:this.$DecorationDiv.css({display:"inline-flex",left:"calc(50% - "+this.$DecorationDiv.width()/2+"px )","justify-content":"center","align-items":"flex-start","align-content":"flex-start",bottom:"0px",right:"",top:""});break;case 6:this.$DecorationDiv.css({display:"inline-flex",right:"0px","justify-content":"center","align-items":"flex-end","align-content":"flex-end",
bottom:"0px",left:"",top:""})}},doSetAnchorPosition:function(a){if(1>a||6<a)a=4;this.isHtml?this.setHtmlAnchorPosition(a):this.graphics&&this.setGraphicsAnchorPosition(a)},setSize:function(a,b){a&&b&&(this.width=a,this.height=b,this.restoredWidth=a,this.restoredHeight=b,this.isHtml&&(this.$DecorationDiv.width(this.width),this.$DecorationDiv.height(this.height)))},setDraggable:function(a){this.draggable=a},setVisible:function(b){this.visible=b;this.isHtml?a.isNull(this.$DecorationDiv)&&a.isNull(this.$DecorationBtnDiv)||
(b?(this.$DecorationDiv.css("display",""),a.notNull(this.$DecorationBtnDiv)&&this.$DecorationBtnDiv.css("display","")):(this.$DecorationDiv.css("display","none"),a.notNull(this.$DecorationBtnDiv)&&this.$DecorationBtnDiv.css("display","none"))):this.graphics&&this.graphics.setVisible(this.defaultGroup,b)},getHtmlElementId:function(b){return a.isNull(b)?this.id:this._randomId},s4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},generateHtmlDecoration:function(){var b=this;this.$DecorationDiv=
a.$("\x3cdiv onselectstart\x3d'return false'\x3e\x3c/div\x3e");this.$DecorationDiv.attr("id",this.id);a.isNull(this.type)?this.$DecorationDiv.css({"z-index":"6",position:"absolute",overflow:"auto"}):this.$DecorationDiv.css({"z-index":"6",position:"absolute"});this.visible||this.$DecorationDiv.css("display","none");this.mapWidth=this.map.getMapContext().getDeviceWidth();this.mapHeight=this.map.getMapContext().getDeviceHeight();this.container.append(this.$DecorationDiv);this.$DecorationBtnDiv&&this.$DecorationBtnDiv.bind("mouseup mousedown",
function(a){a.stopPropagation()});this.$DecorationDiv.bind("mouseup mousedown",function(a){a.stopPropagation()});"Magnifier"===this.type&&(this.$Content=a.$("\x3cdiv class\x3d'defaultStyle_magni'\x3e\x3c/div\x3e"),this.$hideDiv=a.$("\x3cdiv class\x3d'hideStyle_magni'\x3e\x3c/div\x3e"),this.$hideDiv.css({width:this.width,height:this.height}),this.$Content.css({width:this.width,height:this.height}),this.$DecorationDiv.append(this.$Content),this.$DecorationDiv.append(this.$hideDiv));"LayerControl"===
this.type&&(this.$Content=a.$("\x3cdiv class\x3d'defaultStyle_layerctrl'\x3e\x3c/div\x3e"),this.$Content.css({width:this.width,"z-index":0}),this.$title=a.$("\x3cdiv class\x3d'titleStyleBasic_layerctrl titleStyleEna_layerctrl'\x3e"+a.gv.getLabel("MAPVIEWER_LC_TITLE")+"\x3c/div\x3e"),this.$title.css({width:this.width-4,"font-size":this.title_font_size,"font-family":this.title_font_family,"z-index":1}),this.collapsibleContainer=a.$("\x3cdiv id\x3d'_customContainer' \x3e\x3c/div\x3e"),this.collapsibleContainer.css({display:"inline-flex",
margin:"5px","flex-direction":"column",flex:"content"}),this.collapsibleContainer.append(this.$title,this.$Content),this.$DecorationDiv.append(this.collapsibleContainer));"OverviewMap"===this.type&&(this.$DecorationDiv.css({display:"inline-flex","flex-direction":"row","align-items":"flex-end","align-content":"flex-end"}),this.overviewMapDIV=a.$("\x3cdiv id\x3d'_DecorationOverview' class\x3d'style_overviewMap'\x3e\x3c/div\x3e"),this.overviewMapDIV.css({height:.3*this.parentMapHeight,width:.3*this.parentMapWidth}));
if("ToolBar"===this.type||this.mapType){var V=this.$Content=a.$("\x3cdiv style\x3d'overflow:false'\x3e\x3c/div\x3e"),Q=this.$realContent=a.$("\x3cdiv\x3e"+this.content+"\x3c/div\x3e"),w=this.$tb_title=a.$("\x3cdiv class\x3d'titleStyleEna_layerctrl'\x3e\x3c/div\x3e");w.css({height:"6px"});this.defaultStyle={"border-style":"solid","border-color":"#101418","border-width":"1px",padding:"0px","font-size":"16px",color:"#000000",backgroundColor:"#FDFDFD"};this.contentStyle?Q.css(this.contentStyle):Q.css(this.defaultStyle);
if(this.title){this.title=this.title.replace(/\ /g,"\x26nbsp;");var ha=this.$titleDiv=a.$("\x3cdiv\x3e"+this.title+"\x3c/div\x3e");this.defaultTitleStyle={"border-style":"solid","border-color":"#391EA6","border-width":"1px",backgroundColor:"#0D0D0D","font-size":"18px","font-weight":"bold",color:"#FDFDFD"};this.titleStyle?ha.css(this.titleStyle):ha.css(this.defaultTitleStyle);V.append(this.$titleDiv)}V.append(Q);"ToolBar"===this.type&&this.draggable&&this.$DecorationDiv.append(w);this.$DecorationDiv.append(V);
this.width&&V.width(this.width);this.height&&V.height(this.height);this.width||(this.width=this.$DecorationDiv.width());this.height||(this.height=this.$DecorationDiv.height())}if("CustomHtmlDecoration"===this.type&&!this.mapType){V=a.$('\x3ctable border\x3d"0" cellspacing\x3d"0"\x3e');this.title&&(this.title=this.title.replace(/\ /g,"\x26nbsp;"),Q=a.$("\x3ctr\x3e\x3c/tr\x3e"),Q.appendTo(V),w=a.$("\x3ctd\x3e"+this.title+"\x3c/td\x3e"),w.appendTo(Q),this.titleStyle?w.css(this.titleStyle):w.addClass("defaultTitleStyle_noType"));
Q=a.$("\x3ctr\x3e\x3c/tr\x3e");Q.appendTo(V);var pa=a.$("\x3ctd id\x3d'content_td'\x3e"+this.content+"\x3c/td\x3e");0<pa.find("a").length&&pa.find("a").bind("touchstart",function(){c.location.href=pa.find("a").attr("href")});pa.appendTo(Q);this.contentStyle?pa.css(this.contentStyle):pa.addClass("defaultContentStyle_noType");this.collapsibleContainer=a.$("\x3cdiv id\x3d'_customContainer' \x3e\x3c/div\x3e");this.collapsibleContainer.css({display:"inline-flex",margin:"5px"});this.collapsibleContainer.append(V);
this.$DecorationDiv.append(this.collapsibleContainer);"ScaleBar"!==this.type&&(this.width=this.$DecorationDiv.width(),this.restoredHeight=this.height=this.$DecorationDiv.height(),this.restoredWidth=this.width);this.width&&V.width(this.width);this.height&&V.height(this.height);this.width||(this.width=this.$DecorationDiv.width());this.height||(this.height=this.$DecorationDiv.height())}this.collapsible&&(a.browser.touchSupported?(this.btnW=this.btnH=a.gv.decorationCollapseButtonSizeTouch,this.$DecorationBtnDiv=
a.$("\x3cdiv id\x3d'_DecorationBtnDiv' class\x3d'omv2_collapse_button'\x3e\x3cimg src\x3d'"+a.control.MapDecoration.getImage(this)+"' style\x3d'height:24px;width:24px'\x3e\x3c/div\x3e"),this.$DecorationBtnDiv.bind("touchstart",function(c){"OverviewMap"===b.type?b.collapsible&&(b.minimized?b.restore():b.collapse()):b.minimized?b.restore():b.collapse();a.event.EventSource.stopEvents[c.type]=!0})):(this.btnW=this.btnH=a.gv.decorationCollapseButtonSizeNoTouch,this.$DecorationBtnDiv=a.$("\x3cdiv id\x3d'_DecorationBtnDiv' class\x3d'omv2_collapse_button'\x3e\x3cimg src\x3d'"+
a.control.MapDecoration.getImage(this)+"' style\x3d'height:18px;width:18px'\x3e\x3c/div\x3e")),this.$DecorationBtnDiv.css({"z-index":"201",position:"relative"}),this.visible||this.$DecorationBtnDiv.css("display","none"),this.$DecorationBtnDiv.mouseover(function(c){c.target.src=!0===b.minimized?b.getMinimizeIcon():b.getRestoreIcon();a.event.EventSource.stopEvents[c.type]=!0}).mouseout(function(c){c.target.src=a.control.MapDecoration.getImage(b);a.event.EventSource.stopEvents[c.type]=!0}).click(function(c){b.collapsible&&
(b.minimized?b.restore():b.collapse());a.event.EventSource.stopEvents[c.type]=!0}),this.$DecorationBtnDiv.bind("dblclick mousemove mousedown",function(b){a.event.EventSource.stopEvents[b.type]=!0}),"OverviewMap"===this.type?this.$DecorationDiv.append(this.$DecorationBtnDiv[0],this.overviewMapDIV[0]):"CustomHtmlDecoration"===this.type||"LayerControl"===this.type?(this.$DecorationBtnDiv.css({position:"absolute"}),this.$DecorationDiv.css({"flex-direction":"column"}),this.$DecorationDiv.append(this.$DecorationBtnDiv)):
this.container.append(this.$DecorationBtnDiv));"Magnifier"===this.type&&(this.width&&this.$Content.width(this.width),this.height&&this.$Content.height(this.height),this.width||(this.width=this.$DecorationDiv.width()),this.height||(this.height=this.$DecorationDiv.height()));b=this;this.moveY=this.moveX=0;this.flag=!1;"LayerControl"===this.type&&(this.$title.mousedown(function(a){b.mousedown(a)}).mouseup(function(c){b.mouseup(c);a.event.EventSource.stopEvents[c.type]=!0}).dblclick(function(b){a.event.EventSource.stopEvents[b.type]=
!0}).mouseover(function(c){b.map.$oracleMapDiv.css("cursor","pointer");a.event.EventSource.stopEvents[c.type]=!0}).mouseout(function(c){b.map.$oracleMapDiv.css("cursor","default");a.event.EventSource.stopEvents[c.type]=!0}),this.$title.bind("touchstart",function(a){a.preventDefault();b.touchstart(a)}),this.$title.bind("touchend",function(a){a.stopPropagation();a.preventDefault();b.touchend(a)}),this.$Content.bind("touchmove touchstart touchend",function(a){a.stopPropagation();a.preventDefault()}),
this.$DecorationDiv.bind("mousedown mouseup mouseover mouseout mousewheel click dblclick",function(c){b.fire(c.type,c);a.event.EventSource.stopEvents[c.type]=!0}));if(a.isNull(this.type)||"Magnifier"===this.type||"ToolBar"===this.type||"CustomHtmlDecoration"===this.type)this.$tb_title&&this.$tb_title.mouseover(function(){b.dragging||(a.$(this).removeClass("titleStyleEna_layerctrl"),a.$(this).removeClass("titleStyleDwn_layerctrl"),a.$(this).addClass("titleStyleOvr_layerctrl"),a.$(this).css("cursor",
"move"))}).mouseout(function(){b.dragging||(a.$(this).removeClass("titleStyleOvr_layerctrl"),a.$(this).removeClass("titleStyleDwn_layerctrl"),a.$(this).addClass("titleStyleEna_layerctrl"),a.$(this).css("cursor","default"))}).mousedown(function(){a.$(this).removeClass("titleStyleOvr_layerctrl");a.$(this).removeClass("titleStyleEna_layerctrl");a.$(this).addClass("titleStyleDwn_layerctrl")}).mouseup(function(){a.$(this).removeClass("titleStyleDwn_layerctrl");a.$(this).removeClass("titleStyleEna_layerctrl");
a.$(this).addClass("titleStyleOvr_layerctrl")}),this.$DecorationDiv.bind("touchend",function(b){var c=this.lastTouchTimeStamp,v=b.timeStamp;this.lastTouchTimeStamp=v;500>v-c&&(a.event.EventSource.stopEvents[b.type]=!0)}),this.$DecorationDiv.bind("touchstart",function(a){b.touchstart(a)}),this.$DecorationDiv.mousedown(function(c){a.browser.chrome&&(c.offsetY>a.$(this).height()-21&&c.offsetY<a.$(this).height()||c.offsetX>a.$(this).width()-21)||a.browser.msie&&(c.offsetY>a.$(this).height()-17&&c.offsetY<
a.$(this).height()||c.offsetX>a.$(this).width()-17)||(a.$(this).css("cursor","default"),b.draggable&&a.$(this).css("cursor","move"),b.mousedown(c))}).mouseup(function(c){a.$(this).css("cursor","default");b.map.moveflag=!1;b.mouseup(c);a.event.EventSource.stopEvents[c.type]=!0}).scroll(function(c){b.mouseup(c);a.event.EventSource.stopEvents[c.type]=!0}),this.$DecorationDiv.bind("dblclick mouseover mouseout mousewheel click keyup keydown keypress",function(b){a.event.EventSource.stopEvents[b.type]=
!0});"OverviewMap"!==this.type&&(a.$(document).mouseup(function(a){b.mouseup(a)}),this.mapDiv_msmove=function(w){a.browser.msie&&1!==c.event.button&&b.mouseup(w);b.mousemove(w)},this.mapDiv_touchmove=function(a){a.stopPropagation();a.preventDefault();b.touchmove(a)},this.mapDiv_touchend=function(a){a.preventDefault();b.touchend(a)},this.map.$oracleMapDiv.mousemove(this.mapDiv_msmove),this.map.$oracleMapDiv.bind("touchmove",this.mapDiv_touchmove),this.map.$oracleMapDiv.bind("touchend",this.mapDiv_touchend));
a.isNull(this.type)&&this.map._decoration[this.type]&&this.map._decoration[this.type].$DecorationDiv.append(this.$DecorationDiv)},resize:function(){this.mapWidth=this.map.getMapContext().getDeviceWidth();this.mapHeight=this.map.getMapContext().getDeviceHeight()},mousedown:function(b){!a.isNull(this.map)&&this.draggable&&(this.dragDiv=!0,this.map.enableMapAction.drag&&(this.dragging=!0,this.map.enableMapDrag(!1),this.startX=parseInt(b.clientX),this.startY=parseInt(b.clientY),this.positionX=parseInt(this.$DecorationDiv.css("left")),
this.positionY=parseInt(this.$DecorationDiv.css("top")),this.dragStartFlag=!0,a.event.EventSource.stopEvents[b.type]=!0))},mousemove:function(b){this.parentMapHeight=this.map.getMapContext().getDeviceHeight();this.parentMapWidth=this.map.getMapContext().getDeviceWidth();this.height=this.$DecorationDiv.height();"LayerControl"===this.type&&(this.height=this.$Dom.height());if(this.dragging){if(!0===this.dragStartFlag){var c=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG_START,this);this.fire(a.event.MapDecorationEvent.DRAG_START,
c);this.dragStartFlag=!1}this.moveX=this.positionX+b.clientX-this.startX;this.moveY=this.positionY+b.clientY-this.startY;this.$DecorationDiv.css("left",this.moveX);this.$DecorationDiv.css("top",this.moveY);this.top=this.moveY;c=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG,this);this.fire(a.event.MapDecorationEvent.DRAG,c);a.event.EventSource.stopEvents[b.type]=!0}},mouseup:function(b){a.isNull(this.map)||(this.v_isDrag=this.dragDiv=this.flag=!1,!0===this.dragging&&this.startX!==
parseInt(b.clientX)&&this.startY!==parseInt(b.clientY)&&(b=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG_END,this),this.fire(a.event.MapDecorationEvent.DRAG_END,b)),this.dragging&&(this.dragging=this.dragStartFlag=!1,this.map.enableMapDrag(!0)))},touchstart:function(b){if(!a.isNull(this.map)&&this.draggable&&(this.dragDiv=!0,this.map.enableMapAction.drag)){this.dragging=!0;this.map.enableMapDrag(!1);var c=a.util.DomUtil;this.touchCount=c.getTouchCount(b);if(!(2<this.touchCount)){var Q=
[];1===this.touchCount&&(b=c.getTouchesPosition(b),Q.push(b),this.touchStartX=parseInt(Q[0].x),this.touchStartY=parseInt(Q[0].y),this.touchPositionX=parseInt(this.$DecorationDiv.css("left")),this.touchPositionY=parseInt(this.$DecorationDiv.css("top")),this.dragStartFlag=!0)}}},touchmove:function(b){var c=a.util.DomUtil,Q=[];1===this.touchCount&&(c=c.getTouchesPosition(b),Q.push(c));this.dragging&&(!0===this.dragStartFlag&&(c=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG_START,this),
this.fire(a.event.MapDecorationEvent.DRAG_START,c),this.dragStartFlag=!1),this.touchMoveX=this.touchPositionX+Q[0].x-this.touchStartX,this.touchMoveY=this.touchPositionY+Q[0].y-this.touchStartY,this.moveX=this.touchMoveX,this.moveY=this.touchMoveY,this.$DecorationDiv.css("left",this.touchMoveX),this.$DecorationDiv.css("top",this.touchMoveY),Q=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG,this),this.fire(a.event.MapDecorationEvent.DRAG,Q),0>parseInt(this.$DecorationDiv.css("left"))&&
(this.$DecorationDiv.css("left","0px"),this.touchend(b)),0>parseInt(this.$DecorationDiv.css("top"))&&(this.$DecorationDiv.css("top","0px"),this.touchend(b)),this.parentMapWidth-parseInt(this.$DecorationDiv.css("left"))<this.width&&(this.$DecorationDiv.css("left",this.parentMapWidth-this.width),this.touchend(b)),this.parentMapHeight-parseInt(this.$DecorationDiv.css("top"))<this.height&&(this.$DecorationDiv.css("top",this.parentMapHeight-this.height),this.touchend(b)))},touchend:function(b){if(!a.isNull(this.map)){this.dragDiv=
this.flag=!1;var c=a.util.DomUtil,Q=[];1==this.touchCount&&(b=c.getTouchesPosition(b),Q.push(b));!0===this.dragging&&this.touchStartX!==parseInt(Q[0].x)&&this.touchStartY!==parseInt(Q[0].y)&&(Q=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG_END,this),this.fire(a.event.MapDecorationEvent.DRAG_END,Q));this.dragging&&(this.dragging=this.dragStartFlag=!1,this.map.enableMapDrag(!0));this.map.touchStartLocs=[]}},touchscroll:function(b){var c,Q;a.browser.touchSupported&&(document.getElementById(b).addEventListener("touchstart",
function(a){c=a.targetTouches[0].pageX;Q=a.targetTouches[0].pageY;a.stopPropagation()},!1),document.getElementById(b).addEventListener("touchmove",function(a){a.preventDefault();a.stopPropagation();var b=Q-a.targetTouches[0].pageY;this.scrollLeft+=c-a.targetTouches[0].pageX;this.scrollTop+=b},!1))},delegate:function(b,c,Q){var w,ha=c instanceof Object?!0:!1;if(this.isHtml)if(w=this.$DecorationDiv,ha&&a.notNull(Q)){var pa=c.attr("id")||"selector_"+Math.random().toString().replace(/\./,0);c.attr("id",
pa);a.$(w).on(b,"#"+pa,Q)}else a.$(w).on(b,c,Q);else{w=this.defaultGroup;if(c&&"function"===typeof c)return this.delegate(b,w,c);pa=this.delegateListeners=this.delegateListeners||[];pa[b]=pa[b]||[];var ua=Q.id=Q.id||"fn_"+Math.random().toString().replace(/\./,0),Aa;Aa=function(a){for(var b=a.target.getAncestors(),v=b.length-1;0<v&&(ha?b[v]===c&&(a.delegateTarget=b[v],Q.call(null,a)):b[v].queryType&&-1!=b[v].queryType.indexOf("#"+c)&&(a.delegateTarget=b[v],Q.call(null,a)),b[v]!==a.currentTarget);v--);
};Aa.id=ua;w.addEventListener(b,Aa);pa[b].push(Aa)}return this},unDelegate:function(b,c,Q){var w;b=b||"mouseover mouseout mousemove mousedown mouseup click dblclick";var ha=c instanceof Object?!0:!1;if(this.isHtml)if(w=this.$DecorationDiv,ha){var pa=c.attr("id");a.$(w).off(b,"#"+pa,Q)}else a.$(w).off(b,c,Q);else if(this.defaultGroup)for(w=this.defaultGroup,c=this.delegateListeners,b=b.split(" "),ha=0;ha<b.length;ha++){var ua=b[ha];if(w.listeners&&w.listeners[ua])if(Q){for(var Aa=0;Aa<c[ua].length;Aa++)if(c[ua][Aa].id===
Q.id){pa=c[ua][Aa];c[ua].splice(Aa,1);break}w.removeEventListener(ua,pa)}else w.listeners[ua]=[],this.delegateListeners[ua]=[]}return this},getRestoreIcon:function(){switch(this.anchorPosition||1){case 1:return a.control.MapDecoration.BUTTON_RESTORE_TOP_LEFT;case 2:return a.control.MapDecoration.BUTTON_RESTORE_TOP_LEFT;case 3:return a.control.MapDecoration.BUTTON_RESTORE_TOP_RIGHT;case 4:return a.control.MapDecoration.BUTTON_RESTORE_LOWER_LEFT;case 5:return a.control.MapDecoration.BUTTON_RESTORE_LOWER_LEFT;
case 6:return a.control.MapDecoration.BUTTON_RESTORE_LOWER_RIGHT}},getMinimizeIcon:function(){switch(this.anchorPosition||1){case 1:return a.control.MapDecoration.BUTTON_MINIMIZE_TOP_LEFT;case 2:return a.control.MapDecoration.BUTTON_MINIMIZE_TOP_LEFT;case 3:return a.control.MapDecoration.BUTTON_MINIMIZE_TOP_RIGHT;case 4:return a.control.MapDecoration.BUTTON_MINIMIZE_LOWER_LEFT;case 5:return a.control.MapDecoration.BUTTON_MINIMIZE_LOWER_LEFT;case 6:return a.control.MapDecoration.BUTTON_MINIMIZE_LOWER_RIGHT}},
collapse:function(){if(!this.inAnimation&&!this.minimized&&this.collapsible){var b=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.BEFORE_COLLAPSE,this);this.fire(b.type,b);this.collapsibleContainer.detach();this.inAnimation=!1;this.minimized=!0;this.$DecorationBtnDiv.children("img").attr("src",this.getMinimizeIcon())}},restore:function(){this.collapsible&&(this.minimized=this.inAnimation=!1,this.$DecorationDiv.append(this.collapsibleContainer,this.$DecorationBtnDiv),this.$DecorationBtnDiv.children("img").attr("src",
this.getRestoreIcon()))},isVisible:function(){return this.visible}});a.control.MapDecoration.POSITION_UPPER_LEFT=1;a.control.MapDecoration.POSITION_UPPER_CENTER=2;a.control.MapDecoration.POSITION_UPPER_RIGHT=3;a.control.MapDecoration.POSITION_LOWER_LEFT=4;a.control.MapDecoration.POSITION_LOWER_CENTER=5;a.control.MapDecoration.POSITION_LOWER_RIGHT=6;a.control.MapDecoration.setIconsPath=function(){var b=a.gv.resourcePath(),c=a.control.MapDecoration;c.OVER_VIEW_ICON=b+"overviewicon.gif";c.BUTTON_MINIMIZE_LOWER_LEFT=
b+"button_minimize_l.gif";c.BUTTON_RESTORE_LOWER_LEFT=b+"button_restore_l.gif";c.BUTTON_MINIMIZE_LOWER_RIGHT=b+"button_minimize.gif";c.BUTTON_RESTORE_LOWER_RIGHT=b+"button_restore.gif";c.BUTTON_MINIMIZE_TOP_LEFT=b+"button_restore.gif";c.BUTTON_RESTORE_TOP_LEFT=b+"button_minimize.gif";c.BUTTON_MINIMIZE_TOP_RIGHT=b+"button_restore_l.gif";c.BUTTON_RESTORE_TOP_RIGHT=b+"button_minimize_l.gif";c.MAGNIFIER=b+"func_search_16_ena.png";c.TH_BG_S=b+"th_bg_s.png"};a.control.MapDecoration.setIconsPath();a.control.MapDecoration.setCustomIcons=
function(b){b&&(b.overview&&(a.control.MapDecoration.OVER_VIEW_ICON=b.overview),b.minimize&&(a.control.MapDecoration.BUTTON_MINIMIZE=b.minimize),b.restore&&(a.control.MapDecoration.BUTTON_RESTORE=b.restore),b.magnifier&&(a.control.MapDecoration.MAGNIFIER=b.magnifier))};a.control.MapDecoration.getImage=function(b){return"Magnifier"==b.type?a.control.MapDecoration.MAGNIFIER:a.control.MapDecoration.OVER_VIEW_ICON};a.control.NavigationPanelBar=a.control.MapDecoration.extend({initialize:function V(b){V.base.call(this,
"no content",a.$.extend({},b));b=b?b:{};this.isInternal=!0;this.type="NavigationPanelBar";a.isNull(this.anchorPosition)&&(this.anchorPosition=a.control.MapDecoration.POSITION_UPPER_LEFT);this.style=a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY;a.notNull(b.style)&&(this.style=parseInt(b.style),1>this.style||4<this.style)&&(a.util.Logger.warning("","OM.control.NavigationPanelBar.initialize","style value is out of range, default value is used."),this.style=a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY);
a.notNull(b.infoTips)&&(this.infoTips=b.infoTips);a.isNull(b.offsetX)?this.left=this.getOffset().offsetX:this.left=b.offsetX;a.isNull(b.offsetY)?this.top=this.getOffset().offsetY:this.top=b.offsetY;this.tipTimer=new a.util.TimerManager;this.centerCss={"margin-left":"auto","margin-right":"auto",display:"inline-block"};this.borderAndBackgroundCss={"border-style":"solid","border-width":"1px","border-color":"#dddddd","border-radius":"2px","background-color":"#fefefe",opacity:"0.75"};this.zoomInFont="\ue65c";
this.zoomOutFont="\ue65d";this.defaultColor="#878c90";this.hoverColor="#85bbe7";this.disabledColor="#c3c3c3"},getButtons:function(b){a.isNull(this.buttons)&&(this.buttons=[{name:"up",img:"func_shuffleup_16_btn_ena.png",img_hov:"func_shuffleup_16_btn_hov.png",css:{top:"0px",left:"20px"}},{name:"right",img:"func_shuffleright_16_btn_ena.png",img_hov:"func_shuffleright_16_btn_hov.png",css:{right:"0px",top:"20px"}},{name:"down",img:"func_shuffledown_16_btn_ena.png",img_hov:"func_shuffledown_16_btn_hov.png",
css:{bottom:"0px",left:"20px"}},{name:"left",img:"func_shuffleleft_16_btn_ena.png",img_hov:"func_shuffleleft_16_btn_hov.png",css:{left:"0px",top:"20px"}}]);return a.isNull(b)?this.buttons:this.buttons[b]},display:function Q(b,c){Q.base.call(this,b,c);var pa=this,ua=this.map;if(ua.displayed||ua.getMapContext().getZoomLevel())pa.$DecorationDiv.css({"text-align":"center"}),pa.hasPanel()&&pa.$DecorationDiv.append(pa.createPanHtml()),(pa.hasZoombar()||pa.hasZoombtn())&&pa.$DecorationDiv.append(pa.createZoomHtml()),
ua.navigationPanelBar=pa,0!==pa.$DecorationDiv.width()&&(pa.width=pa.$DecorationDiv.width(),pa.height=pa.$DecorationDiv.height()),(!1===this.anchored||1>this.anchorPosition||6<this.anchorPosition)&&this.setPosition(),pa.hasZoombar()&&(pa.recenter=function(){pa.updateBarByLevel()},ua.on(a.event.MapEvent.I_MAP_CENTER_ZOOM,this.recenter,this),pa.recenter()),pa.hasZoombtn()&&(pa.updateIamge=function(){var b=pa.map.getMapContext(),c=b.getUniverse().getZoomLevelNumber(),b=b.getZoomLevel();0===b?(a.util.DomUtil.setFontIcon(a.$(pa.zoomOut).find("div"),
pa.zoomOutFont,pa.disabledColor),a.$(this.zoomOut).css("cursor","")):(a.util.DomUtil.setFontIcon(a.$(pa.zoomOut).find("div"),pa.zoomOutFont,pa.defaultColor),a.$(this.zoomOut).css("cursor","pointer"));b===c-1?(a.util.DomUtil.setFontIcon(a.$(pa.zoomIn).find("div"),pa.zoomInFont,pa.disabledColor),a.$(this.zoomIn).css("cursor","")):(a.util.DomUtil.setFontIcon(a.$(pa.zoomIn).find("div"),pa.zoomInFont,pa.defaultColor),a.$(this.zoomIn).css("cursor","pointer"))},ua.on(a.event.MapEvent.I_MAP_CENTER_ZOOM,pa.updateIamge,
this),ua.on(a.event.MapEvent.MAP_RESIZED,function(){this.anchorPosition&&this.setAnchorPosition(this.anchorPosition)}.bind(this)),pa.updateIamge())},setPosition:function(b,c){a.notNull(b)&&a.notNull(c)&&(this.anchored=!1);a.isNull(this.$DecorationDiv)&&(this.$DecorationDiv=a.$("\x3cdiv onselectstart\x3d'return false'\x3e\x3c/div\x3e"),this.$DecorationDiv.attr("id",this.id));1<=b&&(b=parseInt(b));1<=c&&(c=parseInt(c));this.X=b||this.X;this.Y=c||this.Y;this.map&&this.parentMapWidth&&(1>this.X&&0<this.X&&
(this.X*=this.parentMapWidth,this.relativePosition=!0),1>this.Y&&0<this.Y&&(this.Y*=this.parentMapHeight,this.relativePosition=!0));a.notNull(this.$DecorationDiv)&&this.$DecorationDiv.css({top:this.Y,left:this.X,bottom:"",right:""})},createPanHtml:function(){for(var b=this,c={cursor:"pointer",position:"absolute",width:"16px",height:"16px"},ha=a.$.extend({},b.borderAndBackgroundCss,{width:"56px",height:"56px",margin:5,position:"relative","border-radius":"28px",cursor:"pointer"}),ha=a.$("\x3cdiv\x3e\x3c/div\x3e").css(ha),
pa=this.getButtons(),ua=this.map.getMapContext(),Aa=.25*(ua.getDeviceHeight()+ua.getDeviceWidth()),ta=this.map,Ba=0;Ba<pa.length;Ba++){var Ta=b.setBackground(a.$("\x3cdiv\x3e\x3c/div\x3e").css(c).css(pa[Ba].css),pa[Ba].img);(function(){var c=pa[Ba],w=Ba;Ta.hover(function(){b.setBackground(a.$(this),c.img_hov)},function(){b.setBackground(a.$(this),c.img)});Ta.click(function(){0===w?ta.pan(0,Aa,!0):1===w?ta.pan(-Aa,0,!0):2===w?ta.pan(0,-Aa,!0):3===w&&ta.pan(Aa,0,!0)})})();ha.append(Ta)}return ha},createZoomHtml:function(){var b=
this,c=this.map,ha=a.$.extend({},b.borderAndBackgroundCss,{"border-radius":"2px 2px 2px 2px",cursor:"pointer"}),pa=a.browser.touchSupported?{width:"26px",height:"26px","background-position":"center",margin:"0px","text-align":"center","line-height":"26x"}:{width:"21px",height:"21px","background-position":"center",margin:"0px","text-align":"center","line-height":"21px"},ua=this.centerCss,ua=a.$("\x3cdiv\x3e\x3c/div\x3e").css(ua),Aa=a.$("\x3cdiv\x3e\x3c/div\x3e").css(pa),pa=a.$("\x3cdiv\x3e\x3c/div\x3e").css(pa);
a.util.DomUtil.setFontIcon(pa,b.zoomOutFont,b.defaultColor);a.util.DomUtil.setFontIcon(Aa,b.zoomInFont,b.defaultColor);Aa=a.$('\x3cdiv id\x3d"zoomin_'+this._randomId+'"\x3e\x3c/div\x3e').css(ha).append(Aa);ha=a.$('\x3cdiv id\x3d"zoomout_'+this._randomId+'"\x3e\x3c/div\x3e').css(ha).append(pa);b.zoomIn=Aa;b.zoomOut=ha;b.style===a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY&&Aa.css({"margin-bottom":"5px"});Aa.hover(function(){b.zoomdisabled(!0)||a.util.DomUtil.setFontIcon(a.$(this).find("div"),
b.zoomInFont,b.hoverColor)},function(){b.zoomdisabled(!0)||a.util.DomUtil.setFontIcon(a.$(this).find("div"),b.zoomInFont,b.defaultColor)});Aa.on("touchend click",function(a){b.zoomdisabled(!0)||(a.preventDefault(),c.zoomIn())});ha.hover(function(){b.zoomdisabled()||a.util.DomUtil.setFontIcon(a.$(this).find("div"),b.zoomOutFont,b.hoverColor)},function(){b.zoomdisabled()||a.util.DomUtil.setFontIcon(a.$(this).find("div"),b.zoomOutFont,b.defaultColor)});ha.on("touchend click",function(a){b.zoomdisabled()||
(a.preventDefault(),c.zoomOut())});if(b.hasZoombar())ua.on("mouseover",function(){b.tipTimer.schedule("tip",2E3,function(){b.tipContainer.fadeOut()});b.tipContainer.show()});b.hasZoombtn()&&ua.append(Aa);b.hasZoombar()&&ua.append(b.createBarHtml());b.hasZoombtn()&&ua.append(ha);return b.zoomContainer=ua},zoomdisabled:function(a){var b=this.map.getMapContext(),c=b.getZoomLevel(),b=b.getUniverse().getZoomLevelNumber();return!0===a?c===b-1:0===c},createBarHtml:function(){var b=this,c=a.$("\x3cdiv\x3e\x3c/div\x3e").css({position:"relative",
top:0,left:0,bottom:0,right:0,height:"100px"}),ha=b.setBackground(a.$("\x3cdiv\x3e\x3c/div\x3e"),"func_zoomout_16_btn_ena.png").css({width:"16px",height:"12px","margin-left":"auto","margin-right":"auto","background-position":"center"}),pa=a.$("\x3cdiv\x3e\x3c/div\x3e").css({width:3,height:"98px",cursor:"pointer"}).css(this.centerCss).css(this.borderAndBackgroundCss),ua=a.$("\x3cdiv\x3e\x3c/div\x3e").css({position:"absolute",cursor:"pointer",top:0,left:5,bottom:0,width:"16px",height:"12px"}).css(this.centerCss).css(this.borderAndBackgroundCss);
ua.append(ha);ua.hover(function(){b.setBackground(a.$(this).find("div"),"func_zoomout_16_btn_hov.png")},function(){b.setBackground(a.$(this).find("div"),"func_zoomout_16_btn_ena.png")});var Aa,ta,Ba;ua.on("mousedown",function(a){Aa=!0;ta=a.clientY;Ba=ua.position().top});ua.on("mouseup",function(){!0===Aa&&b.updateBar();Aa=!1});ua.on("mousemove",function(a){!0===Aa&&b.updateBarPos(Ba+a.clientY-ta)});pa.on("mousedown",function(a){b.updateBarPos(a.offsetY);b.updateBar()});b.draggerBarContainer=ua;c.append(pa).append(ua).append(b.createTips());
return c},createTips:function(){var b=this,c=a.$("\x3cdiv\x3e\x3c/div\x3e").css({position:"absolute",top:0,left:"5px",display:"none"}),ha={position:"absolute","border-radius":"1px",left:"20px","z-index":1,"text-align":"left",cursor:"pointer"},pa;for(pa in this.infoTips)if(!(0>parseInt(pa))){var ua=a.$("\x3cdiv\x3e\x3c/div\x3e").css(ha);ua.attr("maplevel",pa);ua.on("click",function(){b.map.setMapZoomLevel(a.$(this).attr("maplevel"))});ua.hover(function(){a.$(this).parent().find("\x3ediv").css({"z-index":1,
"font-weight":"normal"});a.$(this).css({"z-index":2,"font-weight":"bold"});b.tipTimer.cancel("tip")},function(){a.$(this).parent().find("\x3ediv").css({"z-index":1,"font-weight":"normal"});b.tipTimer.schedule("tip",2E3,function(){b.tipContainer.fadeOut()})});ua.on("mouseover",function(){return!1});ua.css({top:this.levelToTop(pa)+"px"});var Aa=a.$("\x3cdiv\x3e\x3c/div\x3e").css({"line-height":"15px",position:"absolute",left:"15px"}).css(b.borderAndBackgroundCss).css({"border-left":""}).html(this.infoTips[pa]),
ta=b.setBackground(a.$("\x3cdiv\x3e\x3c/div\x3e"),"arrow.png").css({width:"15px",height:"15px",position:"absolute",top:0,opacity:"0.85"});ua.append(ta).append(Aa);c.append(ua)}return b.tipContainer=c},updateBarPos:function(a){var b=this.draggerBarContainer.height(),c=this.draggerBarContainer.parent().height()-2;a=Math.max(0,Math.min(a,c-b));this.draggerBarContainer.css("top",a)},levelToTop:function(b){var c=this.map.getMapContext(),ha=c.getUniverse().getZoomLevelNumber();a.isNull(b)&&(b=c.getZoomLevel());
b=Math.max(0,Math.min(b,ha-1));c=this.draggerBarContainer.height();return(this.draggerBarContainer.parent().height()-2-c)*(ha-b-1)/(ha-1)},updateBar:function(){var a=this.map.getMapContext().getUniverse().getZoomLevelNumber(),b=this.draggerBarContainer.height(),c=this.draggerBarContainer.parent().height()-2,pa=this.draggerBarContainer.position().top;this.updateBarByLevel(a-1-parseInt(pa/(c-b)*(a-1)))},updateBarByLevel:function(b){var c=!0,ha=this.map.getMapContext(),pa=ha.getUniverse().getZoomLevelNumber();
a.isNull(b)&&(b=ha.getZoomLevel(),c=!1);b=Math.max(0,Math.min(b,pa-1));ha=this.draggerBarContainer.height();pa=(this.draggerBarContainer.parent().height()-2-ha)*(pa-b-1)/(pa-1);this.draggerBarContainer.css("top",pa);!0===c&&this.map.setMapZoomLevel(b)},setBackground:function(b,c){b.css({background:'url("'+a.gv.resourcePath()+"navicontrol/"+c+'") no-repeat',"background-position":"center"});return b},setZoomLevelInfoTips:function(a){this.infoTips=a},setStyle:function(b){a.isNull(b)||(a.notNull(b.position)&&
this.setPosition(b.position.left,b.position.top),a.notNull(b.backgroundColor)&&a.$.extend(this.borderAndBackgroundCss,{"background-color":b.backgroundColor}),a.notNull(b.borderColor)&&a.$.extend(this.borderAndBackgroundCss,{"border-color":b.borderColor}))},remove:function w(){w.base.call(this);this.map.navigationPanelBar=null;this.map.deleteListener(a.event.MapEvent.I_MAP_CENTER_ZOOM,this.recenter,this)},hasPanel:function(){switch(this.style){case a.control.NavigationPanelBar.STYLE_FULL:return!0;
case a.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return!1;case a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return!1;case a.control.NavigationPanelBar.STYLE_PAN_ONLY:return!0}},hasZoombar:function(){switch(this.style){case a.control.NavigationPanelBar.STYLE_FULL:return!0;case a.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return!0;case a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return!1;case a.control.NavigationPanelBar.STYLE_PAN_ONLY:return!1}},hasZoombtn:function(){switch(this.style){case a.control.NavigationPanelBar.STYLE_FULL:return!0;
case a.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return!0;case a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return!0;case a.control.NavigationPanelBar.STYLE_PAN_ONLY:return!1}},getOffset:function(){switch(this.style){case a.control.NavigationPanelBar.STYLE_FULL:return{offsetX:0,offsetY:0};case a.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return{offsetX:10,offsetY:10};case a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return{offsetX:0,offsetY:0};case a.control.NavigationPanelBar.STYLE_PAN_ONLY:return{offsetX:0,
offsetY:0}}}});a.control.NavigationPanelBar.STYLE_FULL=1;a.control.NavigationPanelBar.STYLE_ZOOM_ONLY=2;a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY=3;a.control.NavigationPanelBar.STYLE_PAN_ONLY=4;a.control.NavigationPanelBar.ORIENTATION_VERTICAL=1;a.control.NavigationPanelBar.ORIENTATION_HORIZONTAL=2;a.control.CopyRight=a.control.MapDecoration.extend({initialize:function ha(b){ha.base.call(this,"no content",a.$.extend({},{offsetX:0,offsetY:0},b));this.isInternal=!0;this.anchorPosition=a.control.MapDecoration.POSITION_LOWER_RIGHT;
this.anchored=!0;this.fontSize=12;this.textValue="";this.type="CopyRight";b&&(this.textValue=b.textValue?b.textValue:"",this.anchorPosition=b.anchorPosition?b.anchorPosition:a.control.MapDecoration.POSITION_LOWER_CENTER,this.fontSize=b.fontSize?b.fontSize:12,this.fontFamily=b.fontFamily?b.fontFamily:"Tahoma",this.fill=b.fontColor?b.fontColor:"black")},setStyle:function(a){a&&(a.fontSize&&(this.fontSize=a.fontSize),a.fontFamily&&(this.fontFamily=a.fontFamily),a.fontColor&&(this.fill=a.fontColor))},
display:function pa(a,b){pa.base.call(this,a,b);this.$DecorationDiv.empty();this.$DecorationDiv=this.createHtml();this.setAnchorPosition(this.anchorPosition)},createHtml:function(){return this.createDiv()},createDiv:function(){var b=a.$('\x3cdiv class\x3d"cpdiv"\x3e\x3c/div\x3e').css({"font-size":this.fontSize,"font-family":this.fontFamily,color:this.fill,"white-space":"nowrap",display:"inline-flex","align-items":"baseline",position:"absolute","z-index":6});b.html(this.textValue);b.wrapInner('\x3cspan style\x3d"background-color: white; opacity:0.7; width:100%"\x3e\x3c/span\x3e');
return b},remove:function ua(){ua.base.call(this);this.map.CopyRight=null}});a.control.DrawerPanel=a.Class.extend({initialize:function(b,c){var ta=this,Ba=(new Date).getTime();this.title=b.title;this.ID="omv2_drp_"+Ba;this.drawer=c;this.editPanel=null;this.panelTab=a.$("\x3cli\x3e\x3c/li\x3e");this.panelTab.id=this.ID;this.panelTab.addClass("omv2_drp_drawer_tabs");this.singleTabContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");this.singleTabContainer.id="omv2_drp_singleTabContainer_"+Ba;this.singleTabContainer.addClass("omv2_drp_single_tab_container");
this.singleTabContainer.appendTo(this.panelTab);this.singleTabContainer_a=a.$("\x3ca\x3e\x3c/a\x3e");this.singleTabContainer_a.id="omv2_drp_singleTabContainer_a_"+Ba;this.singleTabContainer_a.href="#";this.singleTabContainer_a.role="presentation";this.singleTabContainer_a.tabindex=-1;this.singleTabContainer_a.appendTo(this.singleTabContainer);this.tabHeader=a.$("\x3cdiv\x3e\x3c/div\x3e");this.tabHeader.id="omv2_drp_tabHeader_"+Ba;this.tabHeader.addClass("omv2_drp_tab_header");this.tabHeader.appendTo(this.singleTabContainer_a);
if(b.mode===a.control.DrawerPanel.TEXT_AND_ICON||b.mode===a.control.DrawerPanel.ICON_ONLY)this.tabHeader_icon=a.$("\x3cspan\x3e\x3c/span\x3e",{title:ta.title}),this.tabHeader_icon.id="omv2_drp_tabHeader_icon_"+Ba,this.tabHeader_icon.role="img",b.urlIcon&&null!==b.urlIcon?(this.tabHeader_icon.css("width","21px"),this.tabHeader_icon.css("height","21px"),this.tabHeader_icon.css("display","inline-block"),this.tabHeader_icon.css("vertical-align","middle"),this.tabHeader_icon.css("background-image","url("+
b.urlIcon+")"),this.tabHeader_icon.css("background-repeat","no-repeat"),this.tabHeader_icon.css("background-size","contain")):b.altaIcon&&null!==b.altaIcon&&this.tabHeader_icon.addClass("omv2_drp_tab_header_icon "+b.altaIcon),this.tabHeader_icon.appendTo(this.tabHeader);this.tabHeader_title=null;if(b.mode===a.control.DrawerPanel.TEXT_AND_ICON||b.mode===a.control.DrawerPanel.TEXT_ONLY)this.tabHeader_title=a.$("\x3cspan\x3e\x3c/span\x3e"),this.tabHeader_title.id="omv2_drp_tabHeader_title"+Ba,this.tabHeader_title.addClass("omv2_drp_tab_header_title"),
this.tabHeader_title.appendTo(this.tabHeader),this.tabHeader_title.text(b.title);this.tabHeader_closeIcon=a.$("\x3cspan\x3e\x3c/span\x3e");this.tabHeader_closeIcon.id="omv2_drp_tabHeader_closeIcon"+Ba;this.tabHeader_closeIcon.addClass("omv2_drp_tab_header_close_icon");this.tabHeader_closeIcon.appendTo(this.tabHeader);this.panelContent=a.$("\x3cdiv\x3e\x3c/div\x3e");this.panelContent.id||(this.panelContent.id="omv2_drp_panel_"+Ba);this.panelContent.addClass("omv2_drp_drawer_tabs_content");b.panelDiv&&
a.isNotNull(b.panelDiv)&&b.panelDiv.appendTo(this.panelContent);this.tabHeader_closeIcon.click(function(){ta.panelTab.remove();ta.panelContent.remove();ta.drawer.updateScrollButtons();"edit_panel"===b.type&&ta.drawer.removeEditPanel()})},getID:function(){return this.ID},getTitle:function(){return this.title},getPanelTab:function(){return this.panelTab},getPanelContent:function(){return this.panelContent},getSingleTabContainer:function(){return this.singleTabContainer},getTabHeaderTitle:function(){return this.tabHeader_title}});
a.control.DrawerPanel.ICON_ONLY=1;a.control.DrawerPanel.TEXT_ONLY=2;a.control.DrawerPanel.TEXT_AND_ICON=3;a.control.DrawerPanel.ALTA_ICON_HOME="home";a.control.DrawerPanel.ALTA_ICON_TOOLS="tools";a.control.Drawer=a.Class.extend({mixin:a.event.EventSource,initialize:function(b,c){var ta=this;a.isNull(c)?(c={},c.width=a.control.Drawer.MINIMUM_WIDTH,c.height=a.control.Drawer.MINIMUM_HEIGHT,c.position=a.control.Drawer.LEFT):(c.width||(c.width=a.control.Drawer.MINIMUM_WIDTH),c.height||(c.height=a.control.Drawer.MINIMUM_HEIGHT),
c.position||(c.position=a.control.Drawer.LEFT));this.parentID=b;this.minWidth=a.control.Drawer.MINIMUM_WIDTH;this.minHeight=a.control.Drawer.MINIMUM_HEIGHT;this.fixedTabWidth=a.control.Drawer.TAB_SIZE;this.tabBarPosition=c.position;var Ba=(new Date).getTime();this.parent=a.$("#"+b);this.drawerID="omv2_drawer__"+Ba;this.visible=!1;this.width=Math.max(c.width,this.minWidth);this.height=Math.max(c.height,this.minHeight);this.position=c.position;this.direction=this.position===a.control.Drawer.LEFT?"left":
"right";this.drawerContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");this.drawerContainer.id=this.drawerID;this.drawerContainer.addClass("omv2_drawer_container");this.drawerContainer.css("width",this.width+"px");this.drawerContainer.css("height",this.height+"px");this.drawerContainer.css("display","none");this.drawerContainer.draggable({containment:"parent",cursor:"move",handle:".omv2_drawer_title_container"});this.drawerContainer.resizable({minWidth:this.minWidth,minHeight:this.minHeight,handles:"sw, se"});
this.drawerIcon=a.$("\x3cdiv\x3e\x3c/div\x3e");this.drawerIcon.id="omv2_drawer_icon_"+Ba;this.drawerIcon.addClass("omv2_drawer_circle");this.drawerContainer.appendTo(this.parent);this.drawerIcon.appendTo(this.parent);this.setPosition(this.position);this.drawerIcon.click(function(){ta.showDrawer()});this.titleContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");this.titleContainer.id="omv2_drawer_title_container_"+Ba;this.titleContainer.addClass("omv2_drawer_title_container");this.titleContainer.appendTo(this.drawerContainer);
var Ta=a.$("\x3cdiv\x3e\x3c/div\x3e");Ta.addClass("omv2_drawer_title_div");Ta.appendTo(this.titleContainer);a.$("\x3cspan\x3e\x3c/span\x3e",{text:"Editing Tool Panel"}).appendTo(Ta);Ta=a.$("\x3cdiv\x3e\x3c/div\x3e");Ta.addClass("omv2_drawer_title_close_icon_div");Ta.appendTo(this.titleContainer);var Ja=a.$("\x3cspan\x3e\x3c/span\x3e");Ja.addClass("omv2_drawer_title_close_icon_span");Ja.bind("click",function(){ta.hideDrawer()});Ja.appendTo(Ta);this.tabAndContentContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");
this.tabAndContentContainer.id="omv2_drawer_tabAndContentContainer_"+Ba;this.tabAndContentContainer.addClass("omv2_drawer_tab_and_content_container");this.tabAndContentContainer.appendTo(this.drawerContainer);Ta=a.$("\x3cdiv\x3e\x3c/div\x3e");Ta.addClass("omv2_drawer_tab_bar");Ta.appendTo(this.tabAndContentContainer);this.leftArrow_div=a.$("\x3cdiv\x3e\x3c/div\x3e");this.leftArrow_div.addClass("omv2_drawer_tabs_arrow_div");this.leftArrow_div.appendTo(Ta);this.leftArrow_icon=a.$("\x3cspan\x3e\x3c/span\x3e");
this.leftArrow_icon.addClass("omv2_drawer_left_arrow_icon");this.leftArrow_icon.css("visibility","hidden");this.leftArrow_icon.appendTo(this.leftArrow_div);this.leftArrow_icon.click(function(){ta.moveTabsToLeft()});this.tabContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");this.tabContainer.id="omv2_drawer_tabContainer_"+Ba;this.tabContainer.addClass("omv2_drawer_tabs_container");this.tabContainer.appendTo(Ta);this.rightArrow_div=a.$("\x3cdiv\x3e\x3c/div\x3e");this.rightArrow_div.addClass("omv2_drawer_tabs_arrow_div");
this.rightArrow_div.appendTo(Ta);this.rightArrow_icon=a.$("\x3cspan\x3e\x3c/span\x3e");this.rightArrow_icon.addClass("omv2_drawer_right_arrow_icon");this.rightArrow_icon.css("visibility","hidden");this.rightArrow_icon.appendTo(this.rightArrow_div);this.rightArrow_icon.click(function(){ta.moveTabsToRight()});this.tabTable=a.$("\x3cdiv\x3e\x3c/div\x3e");this.tabTable.id="omv2_drawer_tabTable_"+Ba;this.tabTable.css("display","table");this.tabTable.appendTo(this.tabContainer);Ja=a.$("\x3cdiv\x3e\x3c/div\x3e");
Ja.id="omv2_drawer_tabTableRow_"+Ba;Ja.css("display","table-row");Ja.appendTo(this.tabTable);Ta=a.$("\x3cdiv\x3e\x3c/div\x3e");Ta.id="omv2_drawer_tabTableRow_"+Ba;Ta.css("display","table-cell");Ta.appendTo(Ja);Ja=a.$("\x3cdiv\x3e\x3c/div\x3e");Ja.id="omv2_drawer_cellContainer_"+Ba;Ja.css("overflow","hidden");Ja.css("display","inline_block");Ja.css("position","relative");Ja.css("vertical-align","top");Ja.css("margin-bottom","0px");Ja.appendTo(Ta);Ta=a.$("\x3cdiv\x3e\x3c/div\x3e");Ta.id="omv2_drawer_cellContainerChild_"+
Ba;Ta.css("display","inline_block");Ta.css("position","relative");Ta.appendTo(Ja);Ja=a.$("\x3cdiv\x3e\x3c/div\x3e");Ja.id="omv2_drawer_tabInnerTable_"+Ba;Ja.css("display","table");Ja.appendTo(Ta);Ta=a.$("\x3cdiv\x3e\x3c/div\x3e");Ta.id="omv2_drawer_tabInnerRow_"+Ba;Ta.css("display","table-row");Ta.appendTo(Ja);Ja=a.$("\x3cdiv\x3e\x3c/div\x3e");Ja.id="omv2_drawer_tabInnerCell_"+Ba;Ja.css("display","table-cell");Ja.appendTo(Ta);this.tabListContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");this.tabListContainer.id=
"omv2_drawer_tabListContainer_"+Ba;this.tabListContainer.addClass("omv2_drawer_tabs_list_container");this.tabListContainer.appendTo(Ja);this.tabList=a.$("\x3cul\x3e\x3c/ul\x3e");this.tabList.id="omv2_drawer_tabList_"+Ba;this.tabList.addClass("omv2_drawer_tabs-list");this.tabList.appendTo(this.tabListContainer)},moveTabsToRight:function(){var a=0,a=this.fixedTabWidth,b=this.tabContainer.width(),c=this.tabListContainer.width()-this.tabBarPosition;c<=b||(a=Math.min(a,c-b),this.tabListContainer.animate({marginLeft:"-\x3d"+
a}),this.tabBarPosition+=a,this.updateScrollButtons())},moveTabsToLeft:function(){var a=0,a=this.fixedTabWidth,b=this.tabBarPosition;0>=b||(a=Math.min(a,b),this.tabListContainer.animate({marginLeft:"+\x3d"+a}),this.tabBarPosition-=a,this.updateScrollButtons())},updateScrollButtons:function(){var a=this.tabContainer.width(),b=this.tabListContainer.width()-this.tabBarPosition;0===this.tabList.children().length?(this.leftArrow_icon.css("visibility","hidden"),this.rightArrow_icon.css("visibility","hidden")):
(this.leftArrow_icon.css("visibility","visible"),this.rightArrow_icon.css("visibility","visible"));b<=a?this.rightArrow_icon.removeClass("enabled"):this.rightArrow_icon.addClass("enabled");0>=this.tabBarPosition?this.leftArrow_icon.removeClass("enabled"):this.leftArrow_icon.addClass("enabled")},setPosition:function(b){var c=(this.parent.height()-this.drawerContainer.height())/2,ta=this.parent.width()-this.drawerContainer.width()-5;switch(b){case a.control.Drawer.LEFT:this.drawerContainer.removeClass();
this.drawerContainer.addClass("omv2_drawer_container");this.drawerContainer.css("left","5px");this.drawerContainer.css("top",c+"px");this.drawerIcon.removeClass();this.drawerIcon.addClass("omv2_drawer_circle left");this.position=a.control.Drawer.LEFT;this.direction="left";break;case a.control.Drawer.RIGHT:this.drawerIcon.removeClass(),this.drawerIcon.addClass("omv2_drawer_circle right"),this.drawerContainer.removeClass(),this.drawerContainer.addClass("omv2_drawer_container"),this.drawerContainer.css("top",
c+"px"),this.drawerContainer.css("left",ta+"px"),this.position=a.control.Drawer.RIGHT,this.direction="right"}},isVisible:function(){return this.visible},showDrawer:function(){this.isVisible()||(this.drawerIcon.hide(),this.visible=!this.visible,this.setPosition(this.position),this.drawerContainer.toggle("slide",{direction:this.direction},function(){}))},hideDrawer:function(){this.isVisible()&&(this.visible=!1,this.drawerContainer.hide(),this.drawerIcon.show())},addTab:function(b){if(b.title){b.type||
(b.type="regular_tab");b=new a.control.DrawerPanel(b,this);this.attachTab(b);var c=b.getPanelTab().width(),ta=b.getTabHeaderTitle().width(),c=c-this.fixedTabWidth;b.getTabHeaderTitle().css("width",ta-c);this.updateScrollButtons()}},attachTab:function(b){var c=b.getPanelTab(),ta=b.getPanelContent(),Ba=b.getSingleTabContainer(),Ta=b.getTabHeaderTitle();c.appendTo(this.tabList);ta.appendTo(this.tabAndContentContainer);c.click(function(){a.$(".omv2_drp_drawer_tabs").removeClass("selected");a.$(".omv2_drp_single_tab_container").removeClass("selected");
a.$(".omv2_drp_drawer_tabs_content").removeClass("selected");a.$(".omv2_drp_tab_header_title").removeClass("selected");c.addClass("selected");Ba.addClass("selected");ta.addClass("selected");null!==Ta&&Ta.addClass("selected")})},addEditPanel:function(b){a.isNotNull(this.editPanel)||(this.editPanel=new a.control.EditPanel({width:this.width,target_layer:b}),this.editPanel.addSelectTool(),this.editPanel.addNewPolygonTool(),this.editPanel.addVoidPolygonTool(),this.editPanel.addNewLineTool(),this.editPanel.addNewPointTool(),
b={title:"Edition Tools",altaIcon:a.control.DrawerPanel.ALTA_ICON_TOOLS,panelDiv:this.editPanel.getEditPanelDiv(),mode:a.control.DrawerPanel.TEXT_AND_ICON,type:"edit_panel"},this.addTab(b))},removeEditPanel:function(){a.isNotNull(this.editPanel)&&(this.editPanel=null)},getEditPanel:function(){return this.editPanel}});a.control.Drawer.MINIMUM_WIDTH=200;a.control.Drawer.MINIMUM_HEIGHT=300;a.control.Drawer.TAB_SIZE=120;a.control.Drawer.PANEL_SHOWN="panelShown";a.control.Drawer.PANEL_TOGGLE="panelToggle";
a.control.Drawer.PANEL_HIDEN="panelHide";a.control.Drawer.LEFT=1;a.control.Drawer.RIGHT=2;a.control.EditPanel=a.Class.extend({mixin:a.event.EventSource,initialize:function(b){this.rndID=(new Date).getTime();this.prefixID="omv2_editpanel_";!b||a.isNull(b)?(b={},b.width=a.control.EditPanel.MINIMUM_WIDTH):b.width||(b.width=a.control.EditPanel.MINIMUM_WIDTH);this.tool=null;this.snapLayer=new a.layer.VectorLayer("snap_layer",{def:{type:a.layer.VectorLayer.TYPE_LOCAL}});this.snaplineStyle=new a.style.Marker({width:12,
height:12,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#ff0000",strokeThickness:1}}]});this.snapLayer.setRenderingStyle(this.snaplineStyle);this.snapFeature=null;this.newFeatCounter=0;this.toolMap={};this.width=Math.max(b.width,a.control.EditPanel.MINIMUM_WIDTH);this.targetLayer=b.target_layer?b.target_layer:null;this.isEnabled=!1;this.targetLayer.isFeatureEditable()&&(this.isEnabled=!0);this.targetLayer.parentMap.addLayer(this.snapLayer);this.editPanel_div=
a.$("\x3cdiv\x3e\x3c/div\x3e");this.editPanel_div.id=this.prefixID+"main_div"+this.rndID;this.editPanel_div.addClass("omv2_edit_panel_container")},setTargetLayer:function(a){this.targetLayer=a;this.refreshEditPanel()},getEditPanelDiv:function(){return this.editPanel_div},addNewEditTool:function(b,c){var ta=this.targetLayer.isFeatureEditable()?" enabled":" disabled",Ba={};Ba.container=a.$("\x3cdiv\x3e\x3c/div\x3e");Ba.container.id=this.prefixID+b+"Tool"+this.rndID;Ba.container.addClass("omv2_edit_panel_tool_container");
Ba.container.appendTo(this.editPanel_div);Ba.icon=a.$("\x3cdiv\x3e\x3c/div\x3e");Ba.icon.id=this.prefixID+b+"Tool_icon"+this.rndID;Ba.icon.addClass("omv2_edit_panel_tool_icon "+b+" "+ta);Ba.icon.appendTo(Ba.container);Ba.title_container=a.$("\x3cdiv\x3e\x3c/div\x3e");Ba.title_container.id=this.prefixID+b+"Tool_title_container"+this.rndID;Ba.title_container.addClass("omv2_edit_panel_tool_title_container");Ba.title_container.appendTo(Ba.container);Ba.title_text=a.$("\x3cspan\x3e\x3c/span\x3e");Ba.title_text.id=
this.prefixID+b+"Tool_title_text"+this.rndID;Ba.title_text.addClass("omv2_edit_panel_tool_title_text");Ba.title_text.appendTo(Ba.title_container);Ba.title_text.text(c);return Ba},refresh:function(){var a=this.targetLayer.isFeatureEditable()?" enabled":" disabled",b;for(b in this.toolMap)this.toolMap[b]&&null!==this.toolMap[b]&&(this.toolMap[b].icon.removeClass("enabled disabled"),this.toolMap[b].icon.addClass("omv2_edit_panel_tool_icon "+b+" "+a))},addSelectTool:function(){this.toolMap[a.control.EditPanel.SELECT_TOOL]&&
null!==this.toolMap[a.control.EditPanel.SELECT_TOOL]||(this.toolMap[a.control.EditPanel.SELECT_TOOL]=this.addNewEditTool(a.control.EditPanel.SELECT_TOOL,"Select"),this.goToSelectState())},addNewPolygonTool:function(){if(!this.toolMap[a.control.EditPanel.NEW_POLYGON_TOOL]||null===this.toolMap[a.control.EditPanel.NEW_POLYGON_TOOL]){var b=this;this.toolMap[a.control.EditPanel.NEW_POLYGON_TOOL]=this.addNewEditTool(a.control.EditPanel.NEW_POLYGON_TOOL,"New Polygon");this.toolMap[a.control.EditPanel.NEW_POLYGON_TOOL].icon.click(function(){b.newPolygon()})}},
addVoidPolygonTool:function(){if(!this.toolMap[a.control.EditPanel.VOID_POLYGON_TOOL]||null===this.toolMap[a.control.EditPanel.VOID_POLYGON_TOOL]){var b=this;this.toolMap[a.control.EditPanel.VOID_POLYGON_TOOL]=this.addNewEditTool(a.control.EditPanel.VOID_POLYGON_TOOL,"Void Polygon");this.toolMap[a.control.EditPanel.VOID_POLYGON_TOOL].icon.click(function(){b.newVoidPolygon()})}},addNewLineTool:function(){if(!this.toolMap[a.control.EditPanel.NEW_LINE_TOOL]||null===this.toolMap[a.control.EditPanel.NEW_LINE_TOOL]){var b=
this;this.toolMap[a.control.EditPanel.NEW_LINE_TOOL]=this.addNewEditTool(a.control.EditPanel.NEW_LINE_TOOL,"New Line");this.toolMap[a.control.EditPanel.NEW_LINE_TOOL].icon.click(function(){b.newLine()})}},addNewPointTool:function(){if(!this.toolMap[a.control.EditPanel.NEW_POINT_TOOL]||null===this.toolMap[a.control.EditPanel.NEW_POINT_TOOL]){var b=this;this.toolMap[a.control.EditPanel.NEW_POINT_TOOL]=this.addNewEditTool(a.control.EditPanel.NEW_POINT_TOOL,"New Point");this.toolMap[a.control.EditPanel.NEW_POINT_TOOL].icon.click(function(){b.newPoint()})}},
addNewRectangleTool:function(){if(!this.toolMap[a.control.EditPanel.NEW_RECTANGLE_TOOL]||null===this.toolMap[a.control.EditPanel.NEW_RECTANGLE_TOOL]){var b=this;this.toolMap[a.control.EditPanel.NEW_RECTANGLE_TOOL]=this.addNewEditTool(a.control.EditPanel.NEW_RECTANGLE_TOOL,"New Rectangle");this.toolMap[a.control.EditPanel.NEW_RECTANGLE_TOOL].icon.click(function(){b.newRectangle()})}},goToSelectState:function(){$(".omv2_edit_panel_tool_title_text").css("text-decoration","none");this.toolMap[a.control.EditPanel.SELECT_TOOL].title_text.css("text-decoration",
"underline")},newPolygon:function(){this.targetLayer.isFeatureEditable()&&($(".omv2_edit_panel_tool_title_text").css("text-decoration","none"),this.toolMap[a.control.EditPanel.NEW_POLYGON_TOOL].title_text.css("text-decoration","underline"),this.newFeature(3))},newVoidPolygon:function(){this.targetLayer.isFeatureEditable()&&($(".omv2_edit_panel_tool_title_text").css("text-decoration","none"),this.toolMap[a.control.EditPanel.VOID_POLYGON_TOOL].title_text.css("text-decoration","underline"),this.createVoidPolygon())},
newLine:function(){this.targetLayer.isFeatureEditable()&&($(".omv2_edit_panel_tool_title_text").css("text-decoration","none"),this.toolMap[a.control.EditPanel.NEW_LINE_TOOL].title_text.css("text-decoration","underline"),this.newFeature(2))},newPoint:function(){this.targetLayer.isFeatureEditable()&&($(".omv2_edit_panel_tool_title_text").css("text-decoration","none"),this.toolMap[a.control.EditPanel.NEW_POINT_TOOL].title_text.css("text-decoration","underline"),this.newFeature(1))},newRectangle:function(){this.targetLayer.isFeatureEditable()&&
($(".omv2_edit_panel_tool_title_text").css("text-decoration","none"),this.toolMap[a.control.EditPanel.NEW_RECTANGLE_TOOL].title_text.css("text-decoration","underline"))},newFeature:function(b){var c=this.targetLayer.parentMap,ta=this;!this.tool||this.tool instanceof a.tool.RedlineTool&&b===this.tool.getGeometryType()||this.removeTool();this.tool||(a.isNull(b)||b===a.tool.RedlineTool.TYPE_POLYGON?this.tool=new a.tool.RedlineTool(c,a.tool.RedlineTool.TYPE_POLYGON):this.tool=b===a.tool.RedlineTool.TYPE_LINESTRING?
new a.tool.RedlineTool(c,a.tool.RedlineTool.TYPE_LINESTRING):new a.tool.RedlineTool(c,a.tool.RedlineTool.TYPE_POINT),this.tool.addListener(a.event.ToolEvent.SNAP_POINT,function(){a.notNull(ta.snapFeature)&&(ta.snapLayer.removeFeature(ta.snapFeature),ta.snapLayer.redraw(),ta.snapFeature=null);ta.tool.snapPoint=null;var b=c.getScreenPointLocation(c.mLocX,c.mLocY);if(a.notNull(b)){var ua=c.getScreenPointLocation(c.mLocX-3,c.mLocY-3),Ja=b.coordinates[0]-ua.coordinates[0],ua=ua.coordinates[1]-b.coordinates[1],
Ja=Math.sqrt(Ja*Ja+ua*ua),Ja=a.edit.GeometrySegmentUtil.getLayerSegmentPoint(ta.targetLayer,[b.coordinates[0],b.coordinates[1]],Ja,!1,!1,!1,!1);a.notNull(Ja)&&(Ja=Ja.getPoint(),b=new a.geometry.Point(Ja[0],Ja[1],b.getSRID()),Ja=c.getScreenLocation(b),ta.tool.snapPoint=[],ta.tool.snapPoint.push(Ja.x),ta.tool.snapPoint.push(Ja.y),ta.snapFeature=new a.Feature("SnapPoint",b,{renderingStyle:ta.snaplineStyle}),ta.snapLayer.addFeature(ta.snapFeature),ta.snapLayer.redraw())}}),this.tool.addListener(a.event.ToolEvent.TOOL_END,
function(){if(!a.isNull(ta.tool.getGeometry())){var b=ta.tool.getGeometry();if(ta.tool.getGeometryType()===a.tool.RedlineTool.TYPE_POLYGON){var c=b.getOrdinates()[0];a.util.GeomUtil.isClockwise(c[0])&&(c=a.util.GeomUtil.reverseCoordinates(c),b.coordinates[0]=c)}b=new a.Feature("newfeat_"+ta.rndID+"_"+ta.newFeatCounter++,b);b=ta.targetLayer.changeManager.addFeature(b.id,b);a.notNull(b)&&ta.targetLayer.getUndoManager().addEdit({changeManager:ta.targetLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},
canRedo:function(){return!0},getPresentationName:function(){return"feature added"},undo:function(){this.changeManager.undo(this.editChangeEvent)},redo:function(){this.changeManager.redo(this.editChangeEvent)}});a.notNull(ta.snapFeature)&&(ta.snapLayer.removeFeature(ta.snapFeature),ta.snapLayer.redraw(),ta.snapFeature=null);ta.tool.snapPoint=null;ta.tool.clear();ta.tool=null;ta.goToSelectState()}}),this.tool.start())},createVoidPolygon:function(){var b=this,c=this.targetLayer.parentMap,ta=this.targetLayer.getSelectedFeatures();
a.isNull(ta)||1!==ta.length?this.goToSelectState():(!this.tool||this.tool instanceof a.tool.VoidPolygonTool||this.removeTool(),this.tool||(this.tool=new a.tool.VoidPolygonTool(c,ta[0]),this.tool.addListener(a.event.ToolEvent.TOOL_END,function(){b.removeTool();b.goToSelectState()}),a.isNull(this.tool.polygonFeature)?(this.goToSelectState(),this.removeTool()):this.tool.start()))},removeTool:function(){this.tool&&(this.tool.clear(),this.tool=null)}});a.control.EditPanel.MINIMUM_WIDTH=200;a.control.EditPanel.MINIMUM_HEIGHT=
200;a.control.EditPanel.SELECT_TOOL="select";a.control.EditPanel.NEW_POLYGON_TOOL="new_polygon";a.control.EditPanel.VOID_POLYGON_TOOL="void_polygon";a.control.EditPanel.NEW_LINE_TOOL="new_line";a.control.EditPanel.NEW_POINT_TOOL="new_point";a.control.EditPanel.NEW_RECTANGLE_TOOL="new_ractangle";a.control.ScaleBar=a.control.MapDecoration.extend({initialize:function Aa(b){Aa.base.call(this);this.anchored=this.isInternal=!0;this.anchorPosition=a.control.MapDecoration.POSITION_LOWER_LEFT;this.format=
"BOTH";this.maxLength=100;this.transformToGeodetic=!1;this.fontSize=12;this.fontColor="#000000";this.fontWeight="bold";this.scaleBarColor="#000000";this.textShadow=this.barShadow=this.boxColor=this.boxShadow="";this.barThickness=3;this.fontFamily="arial,bold";this.barColummn=this.textColumn=this.flexContainer=this.botBarText=this.topBarText=this.botBarDiv=this.topBarDiv=this.botTextDiv=this.topTextDiv=null;this.topScaleBarHost={};this.bottomScaleBarHost={};this.type="ScaleBar";this.isHtml=!0;this.style=
{};b&&(this.format=b.format?b.format:"BOTH",this.anchorPosition=b.anchorPosition?b.anchorPosition:a.control.MapDecoration.POSITION_LOWER_LEFT,a.isNotNull(b.style)&&this.setStyle(b.style))},updateScale:function(){if(this.map){var a=this;this.decideScale(this.map,this.maxLength,function(b){var c=b.fpsLength,Ta=b.metricLength,Ja=b.fpsText;b=b.metricText;"METRIC"===a.format?(a.topScaleBarHost.length=Ta,a.topScaleBarHost.text=b):"IMPERIAL"===a.format?(a.topScaleBarHost.length=c,a.topScaleBarHost.text=
Ja):(a.topScaleBarHost.length=c,a.topScaleBarHost.text=Ja,a.bottomScaleBarHost.length=Ta,a.bottomScaleBarHost.text=b);a.renderDivLength(a.topBarDiv,a.botBarDiv);a.renderTextElement(a.topBarText,a.topScaleBarHost.text);a.renderTextElement(a.botBarText,a.bottomScaleBarHost.text)})}},setStyle:function(b){a.isNull(b)||(b.fontSize&&(this.fontSize="string"===typeof b.fontSize?parseInt(b.fontSize,10):b.fontSize),b.fontColor&&(this.fontColor=b.fontColor),b.scaleBarColor&&(this.scaleBarColor=b.scaleBarColor),
b.fontWeight&&(this.fontWeight=b.fontWeight),b.boxShadow&&(this.boxShadow=b.boxShadow),b.textShadow&&(this.textShadow=b.textShadow),b.scaleBarShadow&&(this.barShadow=b.scaleBarShadow),b.maxLength&&(this.maxLength=b.maxLength),b.barThickness&&(this.barThickness=b.barThickness),b.fontFamily&&(this.fontFamily=b.fontFamily),b.boxColor&&(this.boxColor=b.boxColor),this.style=b,this.updateScaleBarGroup())},setFormat:function(b){a.isNull(b)||(this.format=b,a.notNull(this.map)&&this.updateScaleBarGroup())},
display:function ta(b,c){ta.base.call(this,b,c);this.pageDirection=a.util.DomUtil.getPageDirection(this.map);this.updateScaleBarGroup()},updateScaleBarGroup:function(){var b=this,c=this.map;!a.isNull(c)&&c.displayed&&(c.ScaleBar=this,b.shadowFilter=null,this.decideScale(c,this.maxLength,function(Ta){var Ja=Ta.fpsLength,vb=Ta.metricLength,xb=Ta.fpsText;Ta=Ta.metricText;"METRIC"===b.format||"IMPERIAL"===b.format?"METRIC"===b.format?(b.topScaleBarHost.length=vb,b.topScaleBarHost.text=Ta):(b.topScaleBarHost.length=
Ja,b.topScaleBarHost.text=xb):(b.topScaleBarHost.length=Ja,b.topScaleBarHost.text=xb,b.bottomScaleBarHost.length=vb,b.bottomScaleBarHost.text=Ta);b.createScaleBar();Ja=a.event.MapEvent;b.anchorPosition&&(b.setAnchorPosition(),c.on(Ja.MAP_RESIZED,b.setAnchorPosition,b));c.on(Ja.I_MAP_CENTER_ZOOM,b.updateScale,b);c.on(Ja.MAP_RECENTERED,b.updateScale,b)}))},createScaleBar:function(){if(!a.isNull(this.$DecorationDiv)){this.$DecorationDiv.empty();this.$DecorationDiv.css({display:"inline-flex"});this.flexContainer=
a.$("\x3cdiv id\x3d'flexContainer'\x3e\x3c/div\x3e");this.flexContainer.css({display:"inline-flex","flex-direction":"row"});this.flexContainer.css({"box-shadow":this.boxShadow,"background-color":this.boxColor});this.$DecorationDiv.append(this.flexContainer);var b=a.$("\x3cdiv id\x3d'fRow'\x3e\x3c/div\x3e");this.textColumn=b;b.css({display:"inline-flex","flex-direction":"column","align-items":"baseline","justify-content":"space-around"});var c=a.$("\x3cdiv id\x3d'sRow'\x3e\x3c/div\x3e");this.barColumn=
c;c.css({display:"inline-flex","flex-direction":"column","align-items":"baseline","justify-content":"space-around"});this.flexContainer.append(b,c);this.topTextDiv=a.$("\x3cdiv id\x3d'flxTtxt'\x3e\x3c/div\x3e");this.topTextDiv.css({display:"inline-flex","padding-right":"10px"});this.botTextDiv=a.$("\x3cdiv id\x3d'flxBtxt'\x3e\x3c/div\x3e");this.botTextDiv.css({display:"inline-flex","padding-right":"10px"});this.topBarText=a.$("\x3cspan class\x3d'omv2_scaleText'\x3e\x3c/span\x3e");this.renderTextElement(this.topBarText,
this.topScaleBarHost.text);this.topTextDiv.append(this.topBarText);this.botBarText=a.$("\x3cspan class\x3d'omv2_scaleText'\x3e\x3c/span\x3e");this.renderTextElement(this.botBarText,this.bottomScaleBarHost.text);this.botTextDiv.append(this.botBarText);this.topBarDiv=a.$("\x3cdiv id\x3d'flxTbr'\x3e\x3c/div\x3e");this.topBarDiv.css({display:"inline-flex"});this.botBarDiv=a.$("\x3cdiv id\x3d'flxBbr'\x3e\x3c/div\x3e");this.botBarDiv.css({display:"inline-flex"});b.append(this.topTextDiv,this.botTextDiv);
c.append(this.topBarDiv,this.botBarDiv);this.renderDivLength(this.topBarDiv,this.botBarDiv);if(this.map._decoration[this.type]){this.map._decoration[this.type].$DecorationDiv.find("table").remove();this.map._decoration[this.type].contentStyle?this.map._decoration[this.type].$DecorationDiv.css(this.map._decoration[this.type].contentStyle):this.map._decoration[this.type].$DecorationDiv.css({background:"white"});var Ta=this,Ja=Ta.map._decoration[this.type].$DecorationDiv.height();setTimeout(function(){Ta.$DecorationDiv.css({position:"absolute",
top:Ja-Ta.height})},100);this.map._decoration[this.type].$DecorationDiv.append(this.$DecorationDiv);this.$DecorationDiv.css({"z-index":"9999999999"})}}},renderDivLength:function(b,c){b.empty();c.empty();var Ta=a.$("\x3cspan\x3e\x3c/span\x3e"),Ja=a.$("\x3cspan\x3e\x3c/span\x3e"),vb=a.$("\x3cdiv class\x3d'omv2_scaleBar'\x3e\x3c/div\x3e");vb.append(Ta);var xb=a.$("\x3cdiv class\x3d'omv2_scaleBar'\x3e\x3c/div\x3e");xb.append(Ja);vb.css({"background-color":this.scaleBarColor,"box-shadow":this.barShadow,
height:this.barThickness,width:this.topScaleBarHost.length});xb.css({"background-color":this.scaleBarColor,"box-shadow":this.barShadow,height:this.barThickness,width:this.bottomScaleBarHost.length});b.append(vb);c.append(xb);Ta.css({display:"inline-block","white-space":"nowrap",width:"100%"});Ja.css({display:"inline-block","white-space":"nowrap",width:"100%"})},renderText:function(){this.$topScaleText.css({"font-size":this.fontSize,color:this.fontColor,"font-weight":this.fontWeight});this.$bottomScaleText.css({"font-size":this.fontSize,
color:this.fontColor,"font-weight":this.fontWeight});this.pageDirection?(this.$topScaleText.text(this.topScaleBarHost.text),this.$bottomScaleText.text(this.bottomScaleBarHost.text)):(this.$topScaleText.text(this.topScaleBarHost.text.split(" ").reverse().join(" ")),this.$bottomScaleText.text(this.bottomScaleBarHost.text.split(" ").reverse().join(" ")))},renderTextElement:function(a,b){this.pageDirection?a.text(b):a.text(b.split(" ").reverse().join(" "));a.css({"font-size":this.fontSize,color:this.fontColor,
"font-weight":this.fontWeight,"text-shadow":this.textShadow,"font-family":this.fontFamily})},round125:function(a){if(1<a){for(var b=0;10<=a;)a/=10,b+=1;for(a=5<=a?5:2<=a?2:1;0<b;)a*=10,--b}return a},decideScale:function(b,c,Ta){var Ja,vb,xb,db,La=this,Db=c/2;c=b.getScreenPointLocation(b.getMapContext().getDeviceWidth()/2-Db,b.getMapContext().getDeviceHeight()/2);b=b.getScreenPointLocation(b.getMapContext().getDeviceWidth()/2+Db,b.getMapContext().getDeviceHeight()/2);b=new a.geometry.LineString([c.getX(),
c.getY(),b.getX(),b.getY()],c.srid);Ja=a.util.GeomUtil.getLength(b,function(b){Ja=b;vb=La.round125(Ja);1E3<=vb?(b=La.round125(Ja/1E3),db=Math.round(La.maxLength*b/(Ja/1E3)),xb=b+" "+a.gv.getLabel("MAPVIEWER_SB_KILOMETERS")):(db=Math.round(La.maxLength*vb/Ja),xb=vb+" "+a.gv.getLabel("MAPVIEWER_SB_METERS"));b=Ja/1609.344;var c=3.28084*Ja;if(1<=b)c=La.round125(b),b=Math.round(La.maxLength*c/b),c=c+" "+a.gv.getLabel("MAPVIEWER_SB_MILES");else{var na=La.round125(c);b=Math.round(La.maxLength*na/c);c=na+
" "+a.gv.getLabel("MAPVIEWER_SB_FEET")}na={};na.fpsLength=b;na.metricLength=db;na.fpsText=c;na.metricText=xb;Ta(na)},{unit:"METER",transformToGeodetic:!0})},remove:function Ba(){Ba.base.call(this);var b=this.map,c=a.event.MapEvent;this.anchored&&b.deleteListener(c.MAP_RESIZED,this._setAnchorPosition,this);b.deleteListener(c.I_MAP_CENTER_ZOOM,this.updateScale,this);b.deleteListener(c.MAP_RECENTERED,this.updateScale,this);this.map.ScaleBar=null},getTopScaleValue:function(){return this.topScaleBarHost.text.split(" ")[0]},
getBottomScaleValue:function(){return"BOTH"===this.format?this.bottomScaleBarHost.text.split(" ")[0]:""},getTopScaleUnit:function(){return this.topScaleBarHost.text.split(" ")[1]},getBottomScaleUnit:function(){return"BOTH"===this.format?this.bottomScaleBarHost.text.split(" ")[1]:""},getTopScaleBar:function(){return this.$topScaleBar.css({position:"relative",top:"0px",left:""})},getBottomScaleBar:function(){if("BOTH"===this.format)return this.$bottomScaleBar.css({position:"relative",top:this.padding,
left:""})}});a.control.OverviewMap=a.control.MapDecoration.extend({initialize:function(b){this.isInternal=!0;this.type="OverviewMap";this.visible=this.isHtml=!0;this.overFeatureLayer=this.rectangleFeature=this.layer=this.submap=this.mainmap=null;this.cursorStyleDefault=this.cursorStyleDragging=a.CursorTypes.POINTER;this.scaleRatio=null;this.enableAnimation=!1;this.rectangleStyle=b.rectStyle||new a.style.Color({strokeThickness:1,stroke:"#f0ff00",fill:"#ff0000",fillOpacity:.3});this.actionOnSubMap=
this.actionOnMainMap=!1;this.collapsible=!0;this.minimized=!1;this.anchorPosition=b.anchorPosition?parseInt(b.anchorPosition):6},display:function Ta(b,c){this.minimized=!1;Ta.base.call(this,b,c);a.$(this.overviewMapDIV).mousewheel(function(a){a.stopPropagation()});this.mainmap=this.map;this.submap=new a.Map(this.overviewMapDIV,{mapviewerURL:this.mainmap.mapviewerURL,over:!0,wraparound:!1});this.setOverviewMapSize();this.submap.enableMapZoom(this.mainmap.zoomEnabled);this.mainmap.displayed&&(this.map.changeOverView(),
this.doinit(),this.anchorPosition&&this.setAnchorPosition(this.anchorPosition))},doinit:function(){a.notNull(this.mainmap.overviewLayer)&&(this.layer=this.mainmap.overviewLayer.clone("over_"+this.mainmap.overviewLayer.name,!0));if(this.layer){if(this.submap.getLayerByName(this.layer.name))return;this.submap.addLayer(this.layer)}this.overFeatureLayer=this.submap.getDefaultFeatureLayer();var b=this.mainmap.getMapContext();this.submap.getMapContextToken().universe=b.getUniverse().clone();this.submap.setMapCenter(b.getCenterPoint().clone());
this.submap.setMapZoomLevel(b.getZoomLevel()-this.calMapZoomDiff());this.submap.enableMapDrag(!1);this.submap.enableMapAction.click=!1;this.submap.enableMapAction.dbclick=!1;this.submap.enableMapAction.mousewheel=!1;var c=this,vb=function(){var b=c.mainmap.getMapWindowBoundingBox();a.isNull(c.rectangleFeature)&&(c.rectangleFeature=new a.layer.EditableFeature("overview_rectangle",b,{renderingStyle:c.rectangleStyle}));var vb=a.event.LayerEvent;c.overFeatureLayer.addFeature(c.rectangleFeature);c.rectangleFeature.on(vb.FEATURE_MOVED,
c.endDragRect,c);c.rectangleFeature.on(vb.FEATURE_MOVING,c.draggingRect,c);c.overFeatureLayer.on(vb.FEATURES_DISPLAYED,function(){this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDefault})},c);b.getWidth()>=c.submap.getMapWindowBoundingBox().getWidth()&&c.rectangleFeature.setVisible(!1)};this.submap.on(a.event.MapEvent.MAP_INITIALIZED,vb);this.submap.init();this.on(a.event.MapDecorationEvent.AFTER_RESTORE,function(){c.layer&&c.layer.layerType===a.LayerTypes.EXTERNAL?(c.setCenterAndZoomlevel(),
c.submap.refreshMap()):c.setCenterAndZoomlevel();vb()});this.mainmap.on(a.event.MapEvent.MAP_RESIZED,function(){this.resize();this.setAnchorPosition(this.anchorPosition);this.setRectangleFeature();this.endDragRect()},this);this.collapse()},clean:function(){},collapse:function(){this.overviewMapDIV.css({width:"0px",height:"0px",overflow:"hidden","border-width":"0px"});this.inAnimation=!1;this.minimized=!0;var a=this.$DecorationBtnDiv.children("img");a.attr("src")===this.getMinimizeIcon()?a.attr("src",
this.getRestoreIcon()):a.attr("src")===this.getRestoreIcon()&&a.attr("src",this.getMinimizeIcon())},restore:function(){this.setOverviewMapSize();this.minimized=this.inAnimation=!1;if(a.notNull(this.$DecorationBtnDiv)){this.overviewMapDIV.css({"border-width":"1px"});var b=this.$DecorationBtnDiv.children("img");b.attr("src")===this.getRestoreIcon()?b.attr("src",this.getMinimizeIcon()):b.attr("src")===this.getMinimizeIcon()&&b.attr("src",this.getRestoreIcon())}},setAnchorPosition:function(a){this.decideButtonAndMapLayout(a);
var b=this.container.find("div[id^\x3domv2_anchorBox]");$(b[a-1]).append(this.$DecorationDiv)},decideButtonAndMapLayout:function(a){var b=this.$DecorationBtnDiv,c=this.overviewMapDIV;switch(a){case 1:case 2:case 3:this.$DecorationDiv.css({top:"0px",bottom:""});break;case 4:case 5:case 6:this.$DecorationDiv.css({bottom:"0px",top:""})}switch(a){case 1:this.$DecorationDiv.css({left:"0px",right:"","flex-direction":"row","align-items":"flex-end"});this.$DecorationDiv.append(c,b);break;case 4:this.$DecorationDiv.css({left:"0px",
right:"","flex-direction":"row","align-items":"flex-end"});this.$DecorationDiv.append(c,b);break;case 2:this.$DecorationDiv.css({left:"",right:"","flex-direction":"column","align-items":"center"});this.$DecorationDiv.append(c,b);break;case 5:this.$DecorationDiv.css({left:"",right:"","flex-direction":"column","align-items":"center"});this.$DecorationDiv.append(b,c);break;case 3:this.$DecorationDiv.css({left:"",right:"0px","flex-direction":"row","align-items":"flex-end"});this.$DecorationDiv.append(b,
c);break;case 6:this.$DecorationDiv.css({left:"",right:"0px","flex-direction":"row","align-items":"flex-end"}),this.$DecorationDiv.append(b,c)}},resize:function Ja(){this.setOverviewMapSize();Ja.base.call(this)},setOverviewMapSize:function(){var b=this.mainmap.getMapContext().getDeviceWindow(),c=Math.round(.3*b.w),b=Math.round(.3*b.h);if(a.notNull(this.submap)){var xb=this.submap.getMapContextToken();xb.deviceWindow.w=c;xb.deviceWindow.h=b}a.notNull(this.overviewMapDIV)&&(this.overviewMapDIV.width(c),
this.overviewMapDIV.height(b))},draggingRect:function(){this.cursorStyleDragging&&this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDragging})},endDragRect:function(){var a=this.rectangleFeature.geo.getCenter(),b=this.mainmap.getMapContext().getZoomLevel();this.mainmap.setMapCenterAndZoomLevel(a,b);this.setRectangleFeature();this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDefault})},remove:function vb(){vb.base.call(this);this.layer=this.overFeatureLayer=this.rectangleFeature=
null;this.submap&&this.submap.destroyMap();this.layerDel=this.layerAdd=this.styleChange=this.setRectangleFeature=this.endDragRect=this.refreshMainMap=this.resize=this._display=this.map=this.submap=this.mainmap=this.overviewMapDIV=this.rectangleStyle=null},setRectangleFeature:function(){var b=this.mainmap.getMapWindowBoundingBox();a.isNull(b)||a.isNull(this.submap.getMapWindowBoundingBox())||(b.getWidth()>=this.submap.getMapWindowBoundingBox().getWidth()&&!this.mainmap.wraparound?this.rectangleFeature.setVisible(!1):
(b.getWidth()>=this.submap.getMapWindowBoundingBox().getWidth()&&this.mainmap.wraparound||this.rectangleFeature.setGeometry(b),this.rectangleFeature.setVisible(!0),3>this.mainmap.getMapZoomLevel()&&this.mainmap.wraparound&&this.rectangleFeature.setVisible(!1)))},styleChange:function(a){var b=a.affectLayer;this.layer&&"over_"+b.name===this.layer.name&&b.layerType==this.layer.layerType&&((b=a.newStyle)&&"HeatMap"===b.styleType&&b.containerVectorLayer&&(b=b.clone(),b.containerVectorLayer=b.containerVectorLayer.clone("over_"+
b.containerVectorLayer.name,!0,!0)),this.layer.setRenderingStyle(b,a.attributes))},nsdpMapped:function(a){a=a.affectLayer;if(this.layer&&"over_"+a.name===this.layer.name&&a.layerType==this.layer.layerType){this.layer.clearFeatureShapes();this.layer.featureArray=[];for(var b=a.featureArray.length,c=0;c<b;c++){var La=a.featureArray[c].clone();this.layer.featureArray.push(La)}this.layer.redraw()}},layerAdd:function(){},layerDel:function(b){(b=b.affectedLayer)&&this.layer&&this.layer.name==="over_"+b.name&&
b.layerType==this.layer.layerType&&(this.layer.copyFeatures&&this.mainmap.overviewLayer.deleteListener(a.event.LayerEvent.FEATURES_LOADED,this.layer.copyFeatures),this.submap.removeLayer(this.layer),this.layer=this.mainmap.overviewLayer=null)},setCenterAndZoomlevel:function(){if(!this.minimized){var a=this.mainmap.getMapContext();this.submap.setMapCenterAndZoomLevel(a.getCenterPoint(),a.getZoomLevel()-this.calMapZoomDiff());this.setRectangleFeature()}},calMapZoomDiff:function(){for(var a=null,b=this.mainmap.getMapContext(),
c=b.getUniverse(),a=1<this.scaleRatio?c.getZoomLevels()[b.getZoomLevel()].resolution*this.scaleRatio:this.mainmap.getMapWindowBoundingBox().getWidth()/(Math.round(.3*b.getDeviceWidth())/2),La=0;La<b.getZoomLevel();La++)if(c.getZoomLevels()[La+1].resolution<=a&&c.getZoomLevels()[La].resolution>=a)return b.getZoomLevel()-La;if(c.getZoomLevels()[0].resolution<a)return b.getZoomLevel()},setOverviewMapOptions:function(b){if(b.scaleRatio&&1<b.scaleRatio){if(this.scaleRatio===b.scaleRatio)return;this.scaleRatio=
b.scaleRatio;this.submap&&this.submap.displayed&&this.mainmap&&this.submap.setMapZoomLevel(this.mainmap.getMapContext().getZoomLevel()-this.calMapZoomDiff())}b.overviewLayer&&(this.mainmap.overviewLayer=b.overviewLayer,this.submap&&this.submap.displayed&&(this.submap.removeLayer(this.layer),this.layer=b.overviewLayer.clone("over_"+b.overviewLayer.name,!0),this.submap.addLayer(this.layer)));if(b.panelOptions){var c=b.panelOptions;c.style&&(this.rectangleStyle=c.style,this.submap.displayed&&this.rectangleFeature.setRenderingStyle(this.rectangleStyle));
a.notNull(c.draggingCursorStyle)&&(this.cursorStyleDragging=c.draggingCursorStyle);a.notNull(c.defaultCursorStyle)&&(this.cursorStyleDefault=c.defaultCursorStyle,this.rectangleFeature&&this.rectangleFeature.shape&&this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDefault}));a.notNull(c.enableAnimation)&&(this.enableAnimation=c.enableAnimation)}a.notNull(b.anchorPosition)&&(this.anchorPosition=b.anchorPosition,this.setAnchorPosition(this.anchorPosition));a.notNull(b.display)&&this.setVisible(b.display);
a.notNull(b.collapse)&&(b.collapse?this.collapse():this.restore())},refreshMainMap:function(){if(!this.actionOnMainMap){this.actionOnSubMap=!0;var a=this.submap.getMapContext();this.mainmap.setMapCenterAndZoomLevel(a.getCenterPoint(),a.getZoomLevel()+this.calMapZoomDiff());this.actionOnSubMap=!1}this.setRectangleFeature()},getMapConfig:function(){if(this.overviewTileLayer.config)return this.overviewTileLayer.config;a.util.Logger.warning("MAPVIEWER_9001","MVOverviewMap.getMapConfig")},getZoomLevel:function(){return this.submap.getZoomLevel()},
errLoadLayer:function(){var a=this.mainmap.overviewLayer;this.layer=a.clone("over_"+a.name,!0);this.submap.inited=!1;this.submap.displayed||(this.submap.addLayer(this.layer),this.submap.init())},enableOverViewMapZoom:function(a){this.submap&&this.submap.enableMapZoom(a)}});a.control.ToolButton=a.Class.extend({mixin:a.event.EventSource,initialize:function(b,c,db){this.btID=b;this.btType=c;this.btName=db&&db.buttonName;this.btIcon=db&&db.buttonIcon;this.btSelectedIcon=db&&db.buttonSelectedIcon;this.btState=
a.control.ToolButton.UP;this.tip=db&&db.tooltip;this.parentToolBar=null;this.btDiv=document.createElement("div");this.btDiv.id=this.btID;this.btImg=document.createElement("img");this.tipDiv=document.createElement("div");this.width=db&&db.width;this.height=db&&db.height;this.positionPending=!1;var La=this;La.initButton();var Db=function(b){var c=a.event.ToolbarEvent,xa=new a.event.ToolbarEvent(c.BUTTON_STATE_CHANGE,La);xa.btID=La.btID;La.fire(xa.type,xa);b.stopPropagation();La.btType==a.control.ToolButton.COMMAND?
(La.btImg.setAttribute("src",La.btSelectedIcon),La.btState=a.control.ToolButton.DOWN,b=new a.event.ToolbarEvent(c.BUTTON_DOWN,La),b.btID=La.btID,La.fire(b.type,b)):La.btType==a.control.ToolButton.TOGGLE&&(La.btState==a.control.ToolButton.UP?(La.btImg.setAttribute("src",La.btSelectedIcon),La.btState=a.control.ToolButton.DOWN,b=new a.event.ToolbarEvent(c.BUTTON_DOWN,La)):(La.btImg.setAttribute("src",La.btIcon),La.btState=a.control.ToolButton.UP,b=new a.event.ToolbarEvent(c.BUTTON_UP,La)),b.btID=La.btID,
La.fire(b.type,b))},nb=function(b){La.btType==a.control.ToolButton.COMMAND&&La.btState==a.control.ToolButton.DOWN&&La.reset();b.stopPropagation()};a.$(this.btImg).mouseover(function(){if(La.btType!=a.control.ToolButton.SEPARATOR){if(a.$(La.parentToolBar.toolBarDecorationDiv).css("cursor","pointer"),La.tip){La.parentToolBar.toolBarDecorationDiv.appendChild(La.tipDiv);La.tipDiv.innerHTML=La.tip;a.$(La.tipDiv).addClass("tip_toolbar");var b={display:"inline",left:La.btDiv.parentNode.offsetLeft+5,top:La.btDiv.parentNode.offsetTop+
30,"white-space":"nowrap"};a.$(La.tipDiv).css(b);setTimeout(function(){a.$(La.tipDiv).css({display:"none"})},4E3)}}else a.$(La.parentToolBar.toolBarDecorationDiv).css("cursor","default")}).mouseout(function(b){La.tip&&a.$(La.tipDiv).css({display:"none"});La.btType==a.control.ToolButton.COMMAND&&La.btState==a.control.ToolButton.DOWN&&La.reset();b.stopPropagation()}).mousedown(Db).mouseup(nb);a.browser.touchSupported&&(a.$(this.btImg).bind("touchstart",function(a){a.preventDefault();a.stopPropagation();
Db(a)}),a.$(this.btImg).bind("touchend",function(a){a.preventDefault();a.stopPropagation();nb(a)}))},initButton:function(){this.btDiv.appendChild(this.btImg);a.$(this.tipDiv).css({display:"none"});a.$(this.btDiv).addClass("btDiv_toolbar");"clear"!=this.btID.substring(this.btID.lastIndexOf("bt_")+3)||a.control.ToolBar.ENABLECLEAR||a.$(this.btDiv).css({display:"none"});this.btType!=a.control.ToolButton.SEPARATOR&&(this.btImg.setAttribute("src",this.btIcon),this.width&&this.btImg.setAttribute("width",
this.width),this.height&&this.btImg.setAttribute("height",this.height))},destroy:function(){a.$(this.btDiv).empty();this.tipDiv=this.btImg=this.btDiv=null},setToolTip:function(a){this.tip=a},reset:function(b){this.tool&&b&&this.tool.clear();this.btState==a.control.ToolButton.DOWN&&(this.btImg.setAttribute("src",this.btIcon),this.btState=a.control.ToolButton.UP,this.tool&&this.tool.getStatus()==a.tool.Tool.STARTED&&this.tool.clear(),b=new a.event.ToolbarEvent(a.event.ToolbarEvent.BUTTON_UP,this),b.btID=
this.btID,this.fire(b.type,b))}});a.control.ToolButton.COMMAND=0;a.control.ToolButton.TOGGLE=1;a.control.ToolButton.SEPARATOR=2;a.control.ToolButton.UP=0;a.control.ToolButton.DOWN=1;a.control.ButtonGroup=a.Class.extend({initialize:function(){this.toolButtons=[];this.toolBar=null;var b=this;this.onToolButtonStateChange=function(c){c=c.btID;var db=!1;"clear"==c.substring(c.lastIndexOf("bt_")+3)&&(db=!0);if(b.toolButtons)for(var La in b.toolButtons)c!=La&&b.toolButtons[La]instanceof a.control.ToolButton&&
b.toolButtons[La].reset(db)}},add:function(b){this.toolButtons[b.btID]=b;b.group=this;b.on(a.event.ToolbarEvent.BUTTON_STATE_CHANGE,this.onToolButtonStateChange);this.toolBar&&this.toolBar.addButton(b)}});a.control.ToolBar=a.control.MapDecoration.extend({initialize:function(b,c){c&&a.notNull(c.orientation)&&c.orientation==a.control.ToolBar.VERTICAL?this.direction=c.orientation:this.direction=a.control.ToolBar.HORIZONTAL;c&&a.notNull(c.enableClear)?a.control.ToolBar.ENABLECLEAR=c.enableClear:a.control.ToolBar.ENABLECLEAR=
!0;this.innerID=b=(new Date).getTime();this.toolBarTB=this.toolBarDecorationDiv=this.toolBarDecoration=this.map=null;this.left=.35;this.top=.05;var db=this,La=a.gv.toolButtonW,Db=a.gv.toolButtonH;a.browser.touchSupported&&(La*=1.5,Db*=1.5);this.addedBuiltInbts=c.builtInButtons;this.enableBuiltInBts=[!1,!1,!1,!1,!1,!1];this.builtInBts=[];this.allToolBts=[];this.toBeAddedBts=[];this.builtInButtonGroup=new a.control.ButtonGroup;this.buttonGroups=[this.builtInButtonGroup];this.toolBarDecoration=new a.control.MapDecoration('\x3cdiv id\x3d"div_'+
db.innerID+'" style\x3d"background: white;"\x3e\x3c/div\x3e',{offsetX:this.left,offsetY:this.top,draggable:!0,contentStyle:{"border-style":"solid","border-color":"#ffffff","border-width":"2px",backgroundColor:"#ffffff",filter:"alpha(Opacity\x3d80)","-moz-opacity":"0.8",opacity:"1"}});this.toolBarDecoration.type="ToolBar";this.toolBarDecoration.clean=function(){};this.builtInBtSelected=function(c){c=c.btID;var kb=db.map;if(c==b+"_bt_clear"){a.notNull(kb)&&kb.setMaskOutInfoWindow(!1);for(var na in db.allToolBts)db.allToolBts[na].tool&&
(c=db.allToolBts[na].btID,c!=b+"_bt_redline"&&c!=b+"_bt_distance"&&c!=b+"_bt_circle"&&c!=b+"_bt_rectangle"||db.allToolBts[na].tool.clear())}else if(a.notNull(kb)&&kb.setMaskOutInfoWindow(!0),c==b+"_bt_redline"||c==b+"_bt_distance"||c==b+"_bt_circle"||c==b+"_bt_rectangle"||c==b+"_bt_zoom")for(na=0;na<db.builtInBts.length;na++)if(db.builtInBts[na].btID==c){db.builtInBts[na].tool.start();break}};this.builtInBtUnSelected=function(b){var c=null;if(b.btID)c=db.allToolBts[b.btID];else if(b.target.bt)c=b.target.bt;
else return;a.notNull(db.map)&&db.map.setMaskOutInfoWindow(!1);c.reset()};this.clearTools=function(){for(var a=0;a<db.builtInBts.length;a++)db.builtInBts[a].reset()};(function(){db.toolBarTB=document.createElement("Table");db.toolBarTB.id="tb_"+db.innerID;db.toolBarTB.style.backgroundColor="rgb(242, 237, 242)";db.toolBarTB.cellSpacing=1;db.toolBarTB.cellPadding=0;db.toolBarTB.style.border="0px solid #7F9DB9";db.toolBarTB.style.width="100%";db.builtInBts.push(new a.control.ToolButton(b+"_bt_clear",
a.control.ToolButton.COMMAND,{buttonIcon:a.gv.resourcePath()+"tbicons/clear.gif",buttonSelectedIcon:a.gv.resourcePath()+"tbicons/p_clear.gif",width:La,height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_CLEAR")}));db.builtInBts.push(new a.control.ToolButton(b+"_bt_circle",a.control.ToolButton.TOGGLE,{buttonIcon:a.gv.resourcePath()+"tbicons/func_circleselect_16_ena.png",buttonSelectedIcon:a.gv.resourcePath()+"tbicons/func_circleselect_16_act.png",width:La,height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_CIRCLE"),
buttonName:a.control.ToolBar.BUILTIN_CIRCLE}));db.builtInBts.push(new a.control.ToolButton(b+"_bt_rectangle",a.control.ToolButton.TOGGLE,{buttonIcon:a.gv.resourcePath()+"tbicons/func_rectangleselect_16_ena.png",buttonSelectedIcon:a.gv.resourcePath()+"tbicons/func_rectangleselect_16_act.png",width:La,height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_RECTANGLE"),buttonName:a.control.ToolBar.BUILTIN_RECTANGLE}));db.builtInBts.push(new a.control.ToolButton(b+"_bt_redline",a.control.ToolButton.TOGGLE,
{buttonIcon:a.gv.resourcePath()+"tbicons/func_polyselect_16_ena.png",buttonSelectedIcon:a.gv.resourcePath()+"tbicons/func_polyselect_16_act.png",width:La,height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_REDLINE"),buttonName:a.control.ToolBar.BUILTIN_REDLINE}));db.builtInBts.push(new a.control.ToolButton(b+"_bt_distance",a.control.ToolButton.TOGGLE,{buttonIcon:a.gv.resourcePath()+"tbicons/func_distance_11_ena.png",buttonSelectedIcon:a.gv.resourcePath()+"tbicons/func_distance_11_act.png",width:La,
height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_DISTANCE"),buttonName:a.control.ToolBar.BUILTIN_DISTANCE}));db.builtInBts.push(new a.control.ToolButton(b+"_bt_zoom",a.control.ToolButton.TOGGLE,{buttonIcon:a.gv.resourcePath()+"tbicons/zoom.gif",buttonSelectedIcon:a.gv.resourcePath()+"tbicons/p_zoom.gif",width:La,height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_ZOOM"),buttonName:a.control.ToolBar.BUILTIN_MARQUEE_ZOOM}));for(var c=0;c<db.builtInBts.length;c++)db.builtInBts[c].on(a.event.ToolbarEvent.BUTTON_DOWN,
db.builtInBtSelected),db.builtInButtonGroup.add(db.builtInBts[c])})()},setPosition:function(b,c){this.left=b||this.left;this.top=c||this.top;this.positionPending=!1;0<this.left&&1>this.left&&(a.notNull(this.toolBarDecoration.map)?this.left*=this.toolBarDecoration.map.getMapContext().getDeviceWidth():this.positionPending=!0);0<this.top&&1>this.top&&(a.notNull(this.toolBarDecoration.map)?this.top*=this.toolBarDecoration.map.getMapContext().getDeviceHeight():this.positionPending=!0);this.toolBarDecoration.left=
this.left;this.toolBarDecoration.top=this.top;a.notNull(this.toolBarDecoration.$DecorationDiv)?this.toolBarDecoration.$DecorationDiv.css({left:this.left,top:this.top,right:"",bottom:""}):this.positionPending=!0},display:function xb(a,b){xb.base.call(this,a,b);!0===this.positionPending&&this.setPosition()},setVisible:function(a){this.toolBarDecoration&&this.toolBarDecoration.setVisible(a)},setDraggable:function(a){this.toolBarDecoration&&this.toolBarDecoration.setDraggable(a)},isVisible:function(){if(this.toolBarDecoration)return this.toolBarDecoration.isVisible()},
initBuiltInTools:function(){var b=a.control.ToolBar,c=a.event.ToolEvent;this.toolBarDecorationDiv=document.getElementById("div_"+this.innerID);this.toolBarDecorationDiv.appendChild(this.toolBarTB);this.builtInBts[b.BUILTIN_CIRCLE].tool=new a.tool.CircleTool(this.map);this.builtInBts[b.BUILTIN_CIRCLE].tool.bt=this.builtInBts[b.BUILTIN_CIRCLE];this.builtInBts[b.BUILTIN_CIRCLE].tool.on(c.TOOL_END,this.builtInBtUnSelected);this.builtInBts[b.BUILTIN_RECTANGLE].tool=new a.tool.RectangleTool(this.map);this.builtInBts[b.BUILTIN_RECTANGLE].tool.bt=
this.builtInBts[b.BUILTIN_RECTANGLE];this.builtInBts[b.BUILTIN_RECTANGLE].tool.on(c.TOOL_END,this.builtInBtUnSelected);this.builtInBts[b.BUILTIN_REDLINE].tool=new a.tool.RedlineTool(this.map);this.builtInBts[b.BUILTIN_REDLINE].tool.bt=this.builtInBts[b.BUILTIN_REDLINE];this.builtInBts[b.BUILTIN_REDLINE].tool.on(c.TOOL_END,this.builtInBtUnSelected);this.builtInBts[b.BUILTIN_DISTANCE].tool=new a.tool.DistanceTool(this.map);this.builtInBts[b.BUILTIN_DISTANCE].tool.bt=this.builtInBts[b.BUILTIN_DISTANCE];
this.builtInBts[b.BUILTIN_DISTANCE].tool.on(c.TOOL_END,this.builtInBtUnSelected);this.builtInBts[b.BUILTIN_MARQUEE_ZOOM].tool=new a.tool.MarqueeZoomTool(this.map,a.tool.MarqueeZoomTool.ONE_TIME);this.builtInBts[b.BUILTIN_MARQUEE_ZOOM].tool.bt=this.builtInBts[b.BUILTIN_MARQUEE_ZOOM];this.builtInBts[b.BUILTIN_MARQUEE_ZOOM].tool.on(c.TOOL_END,this.builtInBtUnSelected);this.enableBuiltInButton(this.addedBuiltInbts);var La=this,b=function(){for(var a=0;a<La.builtInBts.length;a++)La.getBuiltInToolButton(a).reset()};
this.toolBarDecoration.$DecorationDiv.mousedown(b);if(a.browser.touchSupported)this.toolBarDecoration.$DecorationDiv.on("touchend",b)},enableBuiltInButton:function(b){for(var c=0;c<b.length;c++)if(b[c]==a.control.ToolBar.BUILTIN_ALL){for(b=0;b<this.enableBuiltInBts.length;b++)this.enableBuiltInBts[b]||(this.enableBuiltInBts[b]=!0);break}else b[c]<this.enableBuiltInBts.length&&0<=b[c]&&(this.enableBuiltInBts[0]=!0,this.enableBuiltInBts[b[c]]=!0);for(b=0;b<this.builtInBts.length;b++)this.enableBuiltInBts[b]&&
this.addButton(this.builtInBts[b])},removeButton:function(b){if(b){for(var c=this.toBeAddedBts.length-1;0<=c;c--)this.toBeAddedBts[c]==b&&this.toBeAddedBts.splice(c,1);if(this.map)if(delete this.allToolBts[b.btID],b.group&&(delete b.group.toolButtons[b.btID],b.group=null),this.direction==a.control.ToolBar.HORIZONTAL){var La=this.toolBarTB.firstChild.firstChild;if(0!==La.childNodes.length)for(var c=La.childNodes,Db=0;Db<c.length;Db++)c[Db].id=="_td_"+b.btID&&La.deleteCell(Db)}else if(0!==this.toolBarTB.firstChild.childNodes.length)for(c=
this.toolBarTB.firstChild.childNodes,La=0;La<c.length;La++)c[La].id=="_tr_"+b.btID&&this.toolBarTB.firstChild.deleteRow(La)}},addButton:function(b){if(this.map){b.btType==a.control.ToolButton.SEPARATOR&&(this.direction==a.control.ToolBar.HORIZONTAL?b.btImg.setAttribute("src",a.gv.resourcePath()+"tbicons/bk_v.png"):b.btImg.setAttribute("src",a.gv.resourcePath()+"tbicons/bk_h.png"));var c=null,c=null;this.direction==a.control.ToolBar.HORIZONTAL?(c=0===this.toolBarTB.childNodes.length?this.toolBarTB.insertRow(0):
this.toolBarTB.firstChild.firstChild,c=c.insertCell(c.childNodes.length),c.id="_td_"+b.btID):(c=0===this.toolBarTB.childNodes.length?this.toolBarTB.insertRow(0):this.toolBarTB.insertRow(this.toolBarTB.firstChild.childNodes.length),c.id="_tr_"+b.btID,c=c.insertCell(0));b.parentToolBar=this;c.appendChild(b.btDiv);this.allToolBts[b.btID]=b}else this.toBeAddedBts.push(b)},initCustomBts:function(){for(var a=0;a<this.toBeAddedBts.length;a++)this.addButton(this.toBeAddedBts[a])},getBuiltInTool:function(a){return this.builtInBts[a]?
this.builtInBts[a].tool:null},getBuiltInToolButton:function(a){return this.builtInBts[a]?this.builtInBts[a]:null},addSeparator:function(b){b=new a.control.ToolButton(b,a.control.ToolButton.SEPARATOR);this.addButton(b)},removeSeparator:function(a){for(var b=this.toBeAddedBts.length-1;0<=b;b--)if(this.toBeAddedBts[b].btID==a){this.removeButton(this.toBeAddedBts[b]);break}},destroy:function(){this.allToolBts=this.toolBarDecorationDiv=this.toolBarDecoration=this.map=null;for(var a=0;a<this.builtInBts&&
this.builtInBts.length;a++)this.builtInBts[a].destroy(),this.builtInBts[a]=null;this.buttonsToAdd=this.buttonGroups=this.DrawingButtonGroup=this.builtInBts=null}});a.control.ToolBar.VERTICAL=0;a.control.ToolBar.HORIZONTAL=1;a.control.ToolBar.ENABLECLEAR=!0;a.control.ToolBar.BUILTIN_CLEAR=0;a.control.ToolBar.BUILTIN_CIRCLE=1;a.control.ToolBar.BUILTIN_RECTANGLE=2;a.control.ToolBar.BUILTIN_REDLINE=3;a.control.ToolBar.BUILTIN_DISTANCE=4;a.control.ToolBar.BUILTIN_MARQUEE_ZOOM=5;a.control.ToolBar.BUILTIN_ALL=
6;a.control.Magnifier=a.control.MapDecoration.extend({initialize:function db(a){db.base.call(this);this.collapsible=this.draggable=this.isInternal=!0;this.innerID=null;this.width=a.width?a.width:150;this.height=a.height?a.height:150;this.zoomIncrement=a.zoomIncrement?a.zoomIncrement:1;this.anchorPosition=a.anchorPosition?a.anchorPosition:1;!1===a.collapsible&&(this.collapsible=!1);!1===a.draggable&&(this.draggable=!1);this.left=a.offsetX?a.offsetX:20;this.top=a.offsetY?a.offsetY:20;this.type="Magnifier";
this.isHtml=!0;this.scaleRatio=this.cursorStyleDefault=this.cursorStyleDragging=this.overFeatureLayer=this.layer=this.submap=this.mainmap=null;this.actionOnSubMap=this.actionOnMainMap=!1;this.zommLevel=this.mapHeight=this.mapWidth=0},display:function La(a,b){La.base.call(this,a,b);this.MagnifierMapDIV=this.$Content;this.mainmap=this.map;this.doinit()},centerAndZoomlevel:function(a){this.actionOnSubMap||(this.actionOnMainMap=!0,this.setCenterAndZoomlevel(a),this.actionOnMainMap=!1)},resize:function(){this.submap.getMapContextToken().transform=
null;this.submap.getMapContext().getTransform();this.submap.graphics.setLeftTop(this.submap.draggableGroup,0,0);this.refreshSubMap();this.mapWidth=this.mainmap.getMapContext().getDeviceWidth();this.mapHeight=this.mainmap.getMapContext().getDeviceHeight()},refreshSubMap:function(){var b=this.mainmap.getMapContext(),c=b.getDeviceWidth()/2-this.moveX-this.width/2,nb=b.getDeviceHeight()/2-this.moveY-this.height/2,kb=b.getZoomLevel(),na=b.getUniverse().getZoomLevels()[kb],c=c*na.resolution,nb=nb*na.resolution*
na.stretchRatio,na=b.getCenterPoint(),na=new a.geometry.Point(na.getX()-c,na.getY()+nb,na.getSRID()),b=b.getUniverse().getZoomLevelNumber();kb+this.zoomIncrement>=b?this.submap.setMapCenterAndZoomLevel(na,b-1):this.submap.setMapCenterAndZoomLevel(na,kb+this.zoomIncrement);this.X=-c;this.Y=nb},remove:function(){this.layer=this.overFeatureLayer=null;this.submap&&this.submap.destroyMap();this.refreshSubMap=this.resize=this.centerAndZoomlevel=this.display=this.map=this.submap=this.mainmap=this.MagnifierMapDIV=
null},doinit:function(){this.mainmap.on(a.event.MapEvent.MAP_RESIZED,this.resize,this);this.setAnchorPosition(this.anchorPosition);this.submap=new a.Map(this.MagnifierMapDIV,{mapviewerURL:this.mainmap.mapviewerURL,magnifier:!0});this.mapWidth=this.mainmap.getMapContext().getDeviceWidth();this.mapHeight=this.mainmap.getMapContext().getDeviceHeight();this.zoomLevel=this.mainmap.getMapContext().getZoomLevel();for(var b=0;b<this.mainmap.divLayers.length;b++){var c=this.mainmap.divLayers[b],c=c.clone("clone_"+
c.name);this.submap.addLayer(c)}for(b=2;b<this.mainmap.svgLayers.length;b++){var c=this.mainmap.svgLayers[b],nb=c.name;"ii_oracle_maps_internal_editing"!==nb&&"ii_oracle_maps_internal_others"!==nb&&(c=c.clone("clone_"+nb),this.submap.addLayer(c))}this.overFeatureLayer=this.submap.getDefaultFeatureLayer();var nb=this.mapWidth/2-this.X-this.width/2,c=this.mapHeight/2-this.Y-this.height/2,b=this.mainmap.getMapContext(),kb=b.getZoomLevel(),kb=b.getUniverse().getZoomLevels()[kb],nb=nb*kb.resolution,c=
c*kb.resolution*kb.stretchRatio,b=b.getCenterPoint(),b=new a.geometry.Point(b.getX()-nb,b.getY()+c,b.getSRID());this.mainmap.getMapContext().getZoomLevel()+this.zoomIncrement>=this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()?this.submap.setMapCenterAndZoomLevel(b,this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()-1):this.submap.setMapCenterAndZoomLevel(b,this.mainmap.getMapContext().getZoomLevel()+this.zoomIncrement);this.submap.enableMapAction.mouse=!1;var na=this;this.flag=
!1;this.submap.init();this.mapdown=!1;a.browser.touchSupported||(this.map.$oracleMapDiv.mousedown(function(){na.mapdown=!0}),this.map.$oracleMapDiv.mouseup(function(){na.mapdown=!1}),this.map.$oracleMapDiv.mousemove(function(a){na.mapdown&&na.refreshSubMap(a)}),this.$DecorationDiv.mousedown(function(){a.$(this).css("cursor","default");na.draggable&&a.$(this).css("cursor","move");na.flag=!0;na.map.$oracleMapDiv.mousemove(function(){if(na.flag){var b=na.mapWidth/2-na.moveX-na.width/2,c=na.mapHeight/
2-na.moveY-na.height/2,kb=na.mainmap.getMapContext(),Za=kb.getZoomLevel(),La=kb.getUniverse().getZoomLevels()[Za],b=b*La.resolution,c=c*La.resolution*La.stretchRatio,La=kb.getCenterPoint(),La=new a.geometry.Point(La.getX()-b,La.getY()+c,La.getSRID()),kb=kb.getUniverse().getZoomLevelNumber();Za+na.zoomIncrement>=kb?na.submap.setMapCenterAndZoomLevel(La,kb-1):na.submap.setMapCenterAndZoomLevel(La,Za+na.zoomIncrement);na.X=-b;na.Y=c}})}).mouseup(function(){a.$(this).css("cursor","default")}),na.submap.$oracleMapDiv.mouseup(function(){na.flag=
!1}));a.browser.touchSupported&&(this.$DecorationDiv.bind("touchstart",function(a){na.touchStart(a)}),this.map.$oracleMapDiv.bind("touchmove",function(a){na.touchMove(a)}),this.$DecorationDiv.bind("touchend",function(a){na.touchEnd(a)}));b=a.event.MapEvent;this.mainmap.on(b.I_MAP_CENTER_ZOOM,this.refreshSubMap,this);this.mainmap.on(b.MAP_RECENTERED,this.refreshSubMap,this);a.browser.touchSupported&&(this.map.$oracleMapDiv.bind("touchstart",function(){na.mapdown=!0}),this.map.$oracleMapDiv.bind("touchmove",
function(a){na.mapdown&&na.refreshSubMap(a)}),this.map.$oracleMapDiv.bind("touchend",function(){na.mapdown=!1}))},touchStart:function(){this.flag=!0},touchMove:function(){if(this.flag){var b=this.mapWidth/2-this.touchMoveX-this.width/2,c=this.mapHeight/2-this.touchMoveY-this.height/2;this.submap.$oracleMapDiv.css("cursor","pointer");var nb=this.mainmap.getMapContext(),kb=nb.getZoomLevel(),kb=nb.getUniverse().getZoomLevels()[kb],b=b*kb.resolution,c=c*kb.resolution*kb.stretchRatio,nb=nb.getCenterPoint(),
nb=new a.geometry.Point(nb.getX()-b,nb.getY()+c,nb.getSRID());this.mainmap.getMapContext().getZoomLevel()+this.zoomIncrement>=this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()?this.submap.setMapCenterAndZoomLevel(nb,this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()-1):this.submap.setMapCenterAndZoomLevel(nb,this.mainmap.getMapContext().getZoomLevel()+this.zoomIncrement);this.X=-b;this.Y=c}},touchEnd:function(){this.flag=!1},setCenterAndZoomlevel:function(){this.minimized||
(this.submap.setMapCenterAndZoomLevel(this.mainmap.getMapContext().getCenterPoint(),this.mainmap.getMapContext().getZoomLevel()+1),this.setRectangleFeature())}});a.control.LayerControl=a.control.MapDecoration.extend({initialize:function Db(a){Db.base.call(this);this.collapsible=this.draggable=this.isInternal=!0;a=a?a:{};a.position=a.position?a.position:{};this.left=a.offsetX?a.offsetX:20;this.top=a.offsetY?a.offsetY:20;a.contentStyle=a.contentStyle?a.contentStyle:{};this.minWidth=this.width=parseInt(a.contentStyle.minWidth)?
parseInt(a.contentStyle.minWidth):150;this.maxHeight=parseInt(a.contentStyle.maxHeight)?parseInt(a.contentStyle.maxHeight):500;a.titleStyle=a.titleStyle?a.titleStyle:{};this.title_font_size=a.titleStyle.font_size?a.titleStyle.font_size:11;this.title_font_family=a.titleStyle.font_family?a.titleStyle.font_family:"Tahoma";this.content_font_size=a.contentStyle.font_size?a.contentStyle.font_size:11;this.content_font_family=a.contentStyle.font_family?a.contentStyle.font_family:"Tahoma";this.anchorPosition=
a.anchorPosition?a.anchorPosition:1;this.layerDeleteEnable=a.layerDeleteEnable?a.layerDeleteEnable:!1;!1===a.collapsible&&(this.collapsible=!1);!1===a.draggable&&(this.draggable=!1);this.type="LayerControl";this.isHtml=!0;this.layer=this.mainmap=null},display:function nb(a,b){nb.base.call(this,a,b);this.panelDIV=this.$Content;this.mainmap=this.map;this.doinit()},remove:function kb(){kb.base.call(this);this.map&&(this.map.$oracleMapDiv.unbind("mousemove",this.mapDiv_mousemove),this.map.$oracleMapDiv.unbind("mouseup",
this.mapDiv_mouseup));this.resize=this._display=this.map=null;this.document_mousemove&&a.$(document).unbind("mousemove",this.document_mousemove);this.document_mouseup&&a.$(document).unbind("mouseup",this.document_mouseup);this.document_msup&&a.$(document).unbind("mouseup",this.document_msup)},resize:function(){this.setAnchorPosition(this.anchorPosition)},doinit:function(){this.el=null;this.aY=this.pY=this.moveY=this.scrollTop=0;this.preStyleId=this.aftStyleId=this.preClass=this.aftClass=this.preId=
this.aftId="";var b=this;this.ck4=this.ck3=this.ck2=this.ck1=!1;this.chkAll=!0;var na=0;this.flag=!1;this._width=b.width;this.v_isDrag=!1;this.offsetX=0;this.array=[];this._currentWidth=this.width;var xa={};b.currentWidth=this._currentWidth;this.setAnchorPosition(this.anchorPosition,5,5);this.mapWidth=this.map.getMapContext().getDeviceWidth();this.mapHeight=this.map.getMapContext().getDeviceHeight();this.map.on(a.event.MapEvent.MAP_RESIZED,this.resize,this);var Qa=this.mainmap.typeArray.slice(3);
0===this.mainmap.divLayers.length&&(Qa=this.mainmap.typeArray.slice(2));for(var ab=Qa.length,Za=ab-1;1<=Za;Za--)Qa[Za-1]==Qa[Za]&&Qa.splice(Za,1);for(var lb=[],Za=0,ab=Qa.length;Za<ab;Za++)!RegExp(Qa[Za],"g").test(lb.join(","))&&lb.push(Qa[Za]);Qa=lb;this.$Dom=a.$("\x3cdiv id\x3d'content' class\x3d'outDom_layerctrl'\x3e\x3c/div\x3e");this.panelDIV.append(this.$Dom);this.touchscroll("content");this.list={};this.dataSource={};for(Za=0;Za<this.mainmap.svgLayers.length;Za++)ab=this.mainmap.svgLayers[Za].name,
lb=this.mainmap.getLayerByName(ab).themeName,this.list[ab]=lb,this.dataSource[ab]=this.mainmap.getLayerByName(ab).getDataSouce();for(Za=0;Za<Qa.length;Za++)if(0!==this.mainmap.nameArray[Qa[Za]].length){var Ob;if("undefined"===Qa[Za])for(Ob=!0,ab=this.mainmap.nameArray[Qa[Za]].length-1;0<=ab;ab--)this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][ab])&&"ii_oracle_maps_internal_others"!==this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][ab]).name&&"ii_oracle_maps_internal_editing"!==
this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][ab]).name&&this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][ab]).layerType==a.LayerTypes.VECTOR&&(Ob=!1);if(!Ob){na++;lb=document.createElement("div");lb.id="dom"+Za;lb.setAttribute("style","position:absolute");lb.setAttribute("style","padding-top:10px;padding-left:9px;height:20px;width:"+(this.width-9+2)+"px;background:#F5F5F9;border: 0px solid #C6CAD5");var Cb=document.createElement("img");Cb.setAttribute("name",Qa[Za]);Cb.setAttribute("type",
"checkbox");Cb.setAttribute("value",Qa[Za]);Cb.setAttribute("checked","true");Cb.src=a.gv.resourcePath()+"checkMark_readonly.png";Cb.setAttribute("style","padding-left:6px;display:'';");ab=document.createElement("img");ab.src=a.gv.resourcePath()+"zoomout.gif";ab.alt=Qa[Za];a.browser.touchSupported||this.typeCheckBoxEvent(Cb,"click");a.browser.touchSupported&&this.typeCheckBoxEvent(Cb,"touchstart");var yb=document.createElement("text");yb.id="typeText"+na;a.$(yb).addClass("typeText_layerctrl");a.$(yb).css({"font-size":this.content_font_size,
"font-family":this.content_font_family});var pb;pb="undefined"==Qa[Za]?document.createTextNode("vector layers"):document.createTextNode(Qa[Za]);yb.appendChild(pb);a.browser.touchSupported||(xa[ab.alt]=1,a.$(ab).click(function(){1==xa[a.$(this)[0].alt]?(a.$("img[name \x3d "+this.alt+"]")[0].setAttribute("style","display:none"),a.$("."+this.alt).css({display:"none"}),a.$(".style_"+this.alt).css({display:"none"}),b.adjustSize(),this.src=a.gv.resourcePath()+"zoomin.gif",xa[a.$(this)[0].alt]=0):(a.$("img[name \x3d "+
this.alt+"]")[0].setAttribute("style","padding-left:3px;display:inline;"),a.$("."+this.alt).css({display:""}),b.adjustSize(),this.src=a.gv.resourcePath()+"zoomout.gif",xa[a.$(this)[0].alt]=1)}));lb.appendChild(ab);lb.appendChild(Cb);lb.appendChild(yb);b.$Dom.append(lb);a.$(lb).height(a.$(yb).height()+7);for(lb=this.mainmap.nameArray[Qa[Za]].length-1;0<=lb;lb--)if(this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][lb])&&!this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][lb]).ignoreLayerControl&&
"ii_oracle_maps_internal_editing"!=this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][lb]).name&&"ii_oracle_maps_internal_others"!=this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][lb]).name&&this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][lb]).layerType==a.LayerTypes.VECTOR){Cb=document.createElement("div");Cb.id="item"+na+lb;Cb.className="item "+Qa[Za];Cb.setAttribute("style","display:'';padding-left:20px;height:20px;width:"+(this.width-20+2)+"px;background:#F5F5F9;border-top:0px solid white");
Cb.setAttribute("draggable","false");Cb.setAttribute("z-index","999999");this.layerDeleteEnable&&(yb=document.createElement("img"),yb.setAttribute("style","display:none;margin-left:-10px;padding-top:6px;width:12px;height:12px"),yb.src=a.gv.resourcePath()+"cross.png",yb.setAttribute("value",this.mainmap.nameArray[Qa[Za]][lb]),yb.setAttribute("name","deletebutton_layercontrol"),a.$(yb).bind("click touchstart",function(){b.mainmap.removeLayer(b.mainmap.getLayerByName(a.$(this).attr("value")))}),a.$(yb).bind("mouseover",
function(c){c.stopPropagation();a.$(this)[0].src=a.gv.resourcePath()+"delete_ena.png";b.layerDeleteEnable&&a.$(this).css({display:""});a.$(this).css({cursor:"pointer"})}),a.$(yb).bind("mouseout",function(){a.$(this)[0].src=a.gv.resourcePath()+"cross.png"}),Cb.appendChild(yb));pb=document.createElement("img");pb.setAttribute("name","item_"+Qa[Za]);pb.setAttribute("type","checkbox");pb.setAttribute("value",this.mainmap.nameArray[Qa[Za]][lb]);pb.className=this.mainmap.nameArray[Qa[Za]][lb];pb.setAttribute("checked",
"true");pb.setAttribute("style","padding-left:6px;padding-top:6px");pb.src=a.gv.resourcePath()+"checkMark_readonly.png";a.$(pb).mouseover(function(c){b.layerDeleteEnable&&a.$(this).prev().css({display:""});c.stopPropagation()}).mousedown(function(a){a.stopPropagation()});a.browser.touchSupported||(this.itemCheckBoxEvent(pb,"click"),this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][lb]).visible||a.$(pb).click());a.browser.touchSupported&&(this.itemCheckBoxEvent(pb,"touchstart"),this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][lb]).visible||
a.$(pb).trigger("touchstart"));yb=document.createElement("text");yb.id="itemText"+na+lb;a.$(yb).addClass("itemText_layerctrl");a.$(yb).css({"font-size":this.content_font_size,"font-family":this.content_font_family});var Ib=document.createTextNode(this.mainmap.nameArray[Qa[Za]][lb]);yb.appendChild(Ib);Cb.appendChild(pb);Cb.appendChild(yb);a.browser.touchSupported||a.$(yb).mouseover(function(c){a.$(this).css({cursor:"pointer","font-weight":"600"});b.layerDeleteEnable&&a.$(this).prev().prev().css({display:""});
c.stopPropagation()}).bind("mouseout",function(c){a.$(this).css({cursor:"default","font-weight":"normal"});b.layerDeleteEnable&&a.$(this).prev().prev().css({display:"none"});c.stopPropagation()}).bind("mousedown",function(a){a.stopPropagation()});a.browser.touchSupported&&(a.$(yb).bind("touchend",function(c){a.$(this).css({cursor:"default","font-weight":"normal"});b.layerDeleteEnable&&a.$(this).prev().prev().css({display:"none"});c.stopPropagation()}),a.$(yb).bind("touchstart",function(a){a.stopPropagation()}));
if(!a.browser.touchSupported){var mb=1,tb;a.$(yb).click(function(){1==mb?("none"==a.$("#style"+a.$(this).attr("id")).css("display")?(a.$("#style"+a.$(this).attr("id")).css({display:""}),tb=this,b.getThemeStyle(tb)):a.$("#style"+a.$(this).attr("id")).css({display:"none"}),b.adjustSize(),mb=0):("block"==a.$("#style"+a.$(this).attr("id")).css("display")||""===a.$("#style"+a.$(this).attr("id")).css("display")?a.$("#style"+a.$(this).attr("id")).css({display:"none"}):(a.$("#style"+a.$(this).attr("id")).css({display:""}),
tb=this,b.getThemeStyle(tb)),b.adjustSize(),mb=1)})}a.browser.touchSupported&&b.touchEvent(ab,yb);pb=document.createElement("div");pb.id="styleitemText"+na+lb;pb.setAttribute("style","display:none;padding-left:40px;height:20;width:"+(this.width-40+2)+"px;background:#ECF9FF;border-top:0px solid white;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;");pb.className="style style_"+Qa[Za]+" style_"+this.mainmap.nameArray[Qa[Za]][lb];Ib=document.createElement("text");Ib.id="styleTextitemText"+
na+lb;a.$(Ib).addClass("styleText_layerctrl");a.$(Ib).css({"font-size":this.content_font_size,"font-family":this.content_font_family});var Gb=document.createTextNode(""),ab=document.createElement("img");ab.id="imgitemText"+na+lb;ab.setAttribute("style","width:18px;height:18px;");ab.setAttribute("value",this.mainmap.nameArray[Qa[Za]][lb]);pb.appendChild(ab);Ib.appendChild(Gb);pb.appendChild(Ib);b.$Dom.append(Cb);b.$Dom.append(pb);a.$(Cb).height(a.$(yb).height()+10);a.$(pb).mouseover(function(){a.$(this).css({cursor:"default"})})}a.browser.touchSupported||
a.$("#dom"+Za).mouseover(function(){a.$(this).css({cursor:"default"});b.flag&&a.$(this).css({background:"#B8DFFD","border-bottom":"2px solid black",opacity:"1",cursor:"n-resize"})}).mouseout(function(){a.$(this).css({background:"#ECF9FF","border-bottom":"0px solid black","border-top":"0px solid black",opacity:"1"})}).bind("mouseup",function(c){b.flag&&0<a.$(this).find("img[alt]").attr("src").indexOf("zoomin")&&a.$(this).find("img[alt]").click();b.touchFlag&&0<a.$(this).find("img[alt]").attr("src").indexOf("zoomin")&&
a.$(this).find("img[alt]").trigger("touchstart");b.itemMoveEventOnTypeDiv(c,this);a.browser.touchSupported&&(b.flag=!1,b.touchFlag=!1,b.ff=!1)});a.browser.touchSupported&&a.$("#dom"+Za).bind("touchstart",function(c){b.flag&&0<a.$(this).find("img[alt]").attr("src").indexOf("zoomin")&&a.$(this).find("img[alt]").click();b.touchFlag&&0<a.$(this).find("img[alt]").attr("src").indexOf("zoomin")&&a.$(this).find("img[alt]").trigger("touchstart");b.itemMoveEventOnTypeDiv(c,this);a.browser.touchSupported&&(b.flag=
!1,b.touchFlag=!1,b.ff=!1)});a.browser.touchSupported||a.$("div[id^\x3d'item']").each(function(){a.$(this)[0].onmousedown=function(na){3==na.which?alert("right click event!"):(a.$("div[id^\x3d'item']").each(function(){a.$(this).css({background:"#ECF9FF"})}),a.$(this).css({background:"gray"}),b.scrollTop=a.$(b.$Dom)[0].scrollTop,b.flag=!0,b.preId=this.id,b.preStyleId="styleitemText"+this.id.substring(4),b.preClass=a.$(this).attr("class"),b.pY=(na||c.event).clientY,b.cloneDiv(na))}});b.touchFlag=!1;
b.ff=!1;a.$("div[id^\x3d'item']").bind("touchstart",function(){if(!b.touchFlag){var c=[],na=a.util.DomUtil.getTouchesPosition(event);c.push(na);b.flag=!0;b.preId=this.id;b.preStyleId="styleitemText"+this.id.substring(4);b.preClass=a.$(this).attr("class");b.pY=c[0].y;b.pX=c[0].x;b.touchFlag=!0;a.$(this).css({background:"#B8DFFD"})}}).bind("touchend",function(){b.ff=b.touchFlag?!0:!1;a.$("div[id^\x3d'item']").css({background:"#ECF9FF"})});a.browser.touchSupported||a.$("div[id^\x3d'item']").click(function(){a.$(this).css({background:"#B8DFFD",
cursor:"n-resize"})}).mouseover(function(){b.layerDeleteEnable&&a.$(a.$(this).find("img")[0]).css({display:""});a.$(this).css({background:"#B8DFFD"});b.flag&&a.$(this).css({"border-bottom":"2px solid black",opacity:"1"});a.$(this).css({cursor:"n-resize"})}).mouseout(function(){b.layerDeleteEnable&&a.$(a.$(this).find("img")[0]).css({display:"none"});a.$(this).css({background:"#ECF9FF","border-top":"0px solid white","border-bottom":"0px solid white"});b.flag?a.$("#"+b.preId).css({background:"gray"}):
(a.$(this)[0].id==b.preId&&(b.preId=""),a.$("div[id^\x3d'item']").each(function(){a.$(this).css({background:"#ECF9FF"})}))}).bind("mouseup",function(a){b.itemMoveEventOnItemDiv(a,this)})}}a.browser.touchSupported&&a.$("div[id^\x3d'item']").bind("touchstart",function(a){b.itemMoveEventOnItemDiv(a,this)});this.$Dom.height()>this.maxHeight&&this.$Dom.height(this.maxHeight);na=document.createElement("div");na.id="v_drag";a.browser.touchSupported?na.setAttribute("style","cursor: e-resize;z-index:5000000;position:absolute;top:0px;left:"+
(parseInt(this.width)-10)+"px;height:"+this.$title.height()+"px;width:12px;background:#E0E0E0;border:0px solid gray"):na.setAttribute("style","cursor: e-resize;z-index:5000000;position:absolute;top:0px;left:"+this.width+"px;height:"+this.$title.height()+"px;width:2px;background:#E0E0E0;border:0px solid gray");this.panelDIV[0].appendChild(na);this.mouseEvent();a.$("img[class][type\x3d'checkbox'][checked\x3d'true']").each(function(){b.array.push(a.$(this).attr("value"))});b.array=[];this.height=this.$Dom.height();
this.setAnchorPosition(this.anchorPosition,5,5);this.panelDIV.height(this.$Dom.height())},typeCheckBoxEvent:function(b,c){var xa=this,Qa=!0;a.$(b).mouseover(function(){a.$(this).css({cursor:"default"})});a.$(b).bind(c,function(){"false"==a.$(this)[0].getAttribute("checked")&&(Qa=!1);Qa?(xa.chkAll=!1,a.$(this)[0].setAttribute("checked","false"),a.$(this)[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png",a.$("img[name \x3d item_"+this.name+"]").attr("src",a.gv.resourcePath()+"checkMark_NS_readonly.png"),
a.$("img[name \x3d item_"+this.name+"]").each(function(){a.$(this)[0].setAttribute("checked","false");xa.map.getLayerByName(a.$(this).attr("value")).setVisible(!1)}),Qa=!1):(xa.chkAll=!0,a.$(this)[0].setAttribute("checked","true"),a.$(this)[0].src=a.gv.resourcePath()+"checkMark_readonly.png",a.$("img[name \x3d item_"+this.name+"]").attr("src",a.gv.resourcePath()+"checkMark_readonly.png"),a.$("img[name \x3d item_"+this.name+"]").each(function(){a.$(this)[0].setAttribute("checked","true");xa.map.getLayerByName(a.$(this).attr("value")).setVisible(!0)}),
Qa=!0)})},itemCheckBoxEvent:function(b,c){var xa=this,Qa=!0;a.$(b).mouseover(function(){a.$(this).css({cursor:"default"})});a.$(b).bind(c,function(b){b.stopPropagation();Qa="true"==a.$(this)[0].getAttribute("checked")?!0:!1;var c=0;Qa?(a.$("img[name \x3d "+this.name+"]").each(function(){"true"==a.$(this)[0].getAttribute("checked")&&(c+=1)}),a.$(this)[0].setAttribute("checked","false"),b=this.name.substr(5),a.$(this)[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png",2>c&&(a.$("img[name \x3d "+
b+"]")[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png"),xa.map.getLayerByName(a.$(this).attr("value")).setVisible(!1)):(a.$(this)[0].setAttribute("checked","true"),b=this.name.substr(5),a.$(this)[0].src=a.gv.resourcePath()+"checkMark_readonly.png",a.$("img[name \x3d "+b+"]")[0].src=a.gv.resourcePath()+"checkMark_readonly.png",xa.map.getLayerByName(a.$(this).attr("value")).setVisible(!0))})},typeDivEvent:function(){},itemDivEvent:function(){},mouseEvent:function(){var b=this;a.$("#v_drag").mousedown(function(a){b.v_isDrag=
!0;b.offsetX=a.clientX}).mouseup(function(){b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth});this.panelDIV.mouseup(function(){b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth});this.document_mouseup=function(){b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth};a.$(document).mouseup(this.document_mouseup);a.$("#v_drag").mouseout(function(){b.$title.removeClass("titleStyleDwn_layerctrl");b.$title.removeClass("titleStyleOvr_layerctrl");
b.$title.addClass("titleStyleEna_layerctrl")});b.mapDiv_mousemove=function(na){b.v_isDrag&&(na=c.event?c.event:na,b._width=na.clientX-b.offsetX+b._currentWidth,b._width>=b.minWidth?(a.$("#content div").width(b._width-9+2),a.$(".item").width(b._width-20+2),a.$(".style").width(b._width-49+11),b.panelDIV.width(b._width),a.$("#v_drag")[0].style.left=b._width+"px",b.$title.width(b._width-6)):b._width=b.minWidth)};b.mapDiv_mouseup=function(){b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth};
this.map.$oracleMapDiv.mousemove(b.mapDiv_mousemove);this.map.$oracleMapDiv.mouseup(b.mapDiv_mouseup);this.$title.mouseup(function(c){c.stopPropagation();b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth;a.$(this).removeClass("titleStyleEna_layerctrl");a.$(this).removeClass("titleStyleDwn_layerctrl");a.$(this).addClass("titleStyleOvr_layerctrl");b.flag=!1;a.$("div[id^\x3d'item']").each(function(){a.$(this).css({background:"#ECF9FF"})});b.el&&(b.container[0].removeChild(b.el),b.el=
null)}).mouseover(function(){b.draggable||a.$(this).css({cursor:"default"});b.dragging?(a.$(this).removeClass("titleStyleEna_layerctrl"),a.$(this).removeClass("titleStyleOvr_layerctrl"),a.$(this).addClass("titleStyleDwn_layerctrl")):(a.$(this).removeClass("titleStyleEna_layerctrl"),a.$(this).removeClass("titleStyleDwn_layerctrl"),a.$(this).addClass("titleStyleOvr_layerctrl"))}).mousedown(function(){a.$(this).removeClass("titleStyleEna_layerctrl");a.$(this).removeClass("titleStyleOvr_layerctrl");a.$(this).addClass("titleStyleDwn_layerctrl")}).mouseout(function(){b.dragging?
(a.$(this).removeClass("titleStyleEna_layerctrl"),a.$(this).removeClass("titleStyleOvr_layerctrl"),a.$(this).addClass("titleStyleDwn_layerctrl")):(a.$(this).removeClass("titleStyleDwn_layerctrl"),a.$(this).removeClass("titleStyleOvr_layerctrl"),a.$(this).addClass("titleStyleEna_layerctrl"))});a.browser.touchSupported&&(a.$("#v_drag").bind("touchstart",function(c){b.v_isDrag=!0;var xa=[];c=a.util.DomUtil.getTouchesPosition(c);xa.push(c);b.offsetX=xa[0].x}),a.$("#v_drag").bind("touchend",function(){b.v_isDrag=
!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth}),a.$("#v_drag").bind("touchmove",function(c){if(b.v_isDrag){var xa=[];c=a.util.DomUtil.getTouchesPosition(c);xa.push(c);b._width=xa[0].x-b.offsetX+b._currentWidth;b._width>b.minWidth?(a.$("#content div").width(b._width-9+2),a.$(".item").width(b._width-20+2),a.$(".style").width(b._width-49+11),b.panelDIV.width(b._width),a.$("#v_drag")[0].style.left=b._width-10+"px",b.$title.width(b._width-6)):b._width=b.width}}),this.$title.bind("touchend",
function(c){c.stopPropagation();b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth;a.$(this).removeClass("titleStyleDwn_layerctrl");a.$(this).removeClass("titleStyleOvr_layerctrl");a.$(this).addClass("titleStyleEna_layerctrl")}).bind("touchstart",function(){a.$(this).removeClass("titleStyleEna_layerctrl");a.$(this).removeClass("titleStyleOvr_layerctrl");a.$(this).addClass("titleStyleDwn_layerctrl")}))},itemMoveEventOnTypeDiv:function(b,c){var xa=this;a.$("div[id^\x3d'item']").css({background:"#ECF9FF"});
a.$(c).css({cursor:"default",background:"#ECF9FF","border-bottom":"0px solid black","border-top":"0px solid black",opacity:"1"});if(xa.flag){xa.el&&(xa.container[0].removeChild(xa.el),xa.el=null);xa.aftId=c.id;xa.aftClass="item "+a.$(c).find("img[name]").attr("name");xa.aftStyleId="styleitemText"+c.id.substring(4);c.$preDiv=a.$("#"+xa.preId);c.$aftDiv=a.$("#"+xa.aftId);c.$preStyleDiv=a.$("#"+xa.preStyleId);c.$aftStyleDiv=a.$("#"+xa.aftStyleId);c.$temp=c.$aftDiv.next();var Qa=c.$preDiv.attr("class"),
Qa=Qa.substring(5),ab=a.$(".item."+Qa).length;if(1==ab&&Qa==a.$(c).find("img[name]").attr("name"))xa.flag=!1;else{1==ab?a.$("img[name\x3d"+Qa+"]").parent().find("img").css("display","none"):a.$("img[name\x3d"+Qa+"]").parent().find("img").css({display:"inline"});0===a.$(".item."+a.$(c).find("img[name]").attr("name")).length&&a.$("img[name\x3d"+a.$(c).find("img[name]").attr("name")+"]").parent().find("img").css({display:"inline"});c.$preDiv.insertAfter(c.$aftDiv);c.$preStyleDiv.insertAfter(c.$preDiv);
c.$preDiv.attr("class",xa.aftClass);Qa=c.$preStyleDiv.attr("class").split(" ");Qa[1]="style_"+a.$(c).find("img[name]").attr("name");c.$preStyleDiv.attr("class",Qa[0]+" "+Qa[1]+" "+Qa[2]);xa.aftClass=xa.aftClass.replace(" ","_");xa.layerDeleteEnable?a.$("#"+xa.preId).children().eq(1).attr("name",xa.aftClass):a.$("#"+xa.preId).children().eq(0).attr("name",xa.aftClass);xa.flag=!1;a.$("img[class][type\x3d'checkbox']").each(function(){xa.array.push(a.$(this).attr("value"))});Qa=xa.array.length;for(ab=
xa.array.length-1;0<=ab;ab--)xa.map.getLayerByName(xa.array[ab]).setZIndex(Qa+1-ab);a.$("img[class][type\x3d'checkbox']").each(function(){"false"==a.$(this)[0].getAttribute("checked")&&xa.map.getLayerByName(a.$(this).attr("value")).setVisible(!1)});xa.array=[];var Za=xa.aftClass.substring(5),lb=xa.preClass.substring(5);a.$("img[name \x3d item_"+Za+"]").each(function(){"false"==a.$(this)[0].getAttribute("checked")&&(xa.ck2=!0);a.$("img[name \x3d "+Za+"]")[0].src=a.gv.resourcePath()+"checkMark_readonly.png"});
xa.ck2&&(a.$("img[name \x3d "+Za+"]")[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png",xa.ck2=!1);xa.ck4=!1;a.$("img[name \x3d item_"+lb+"]").each(function(){"false"==a.$(this)[0].getAttribute("checked")&&(xa.ck4=!0);a.$("img[name \x3d"+lb+"]")[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png"});xa.ck4||(a.$("img[name \x3d"+lb+"]")[0].src=a.gv.resourcePath()+"checkMark_readonly.png",xa.ck4=!1)}}},itemMoveEventOnItemDiv:function(b,na){var xa=this;a.browser.touchSupported||(xa.ff=!0);if(xa.ff){a.$("div[id^\x3d'item']").css({background:"#ECF9FF"});
a.$(na).css({background:"#B8DFFD",cursor:"n-resize"});if(xa.flag){a.$(na).css({"border-top":"0px solid white","border-bottom":"0px solid white"});xa.el&&(xa.container[0].removeChild(xa.el),xa.el=null);xa.aftId=na.id;xa.aftClass=a.$(na).attr("class");xa.aftStyleId="styleitemText"+na.id.substring(4);var Qa;a.browser.touchSupported||(Qa=b||c.event);na.$preDiv=a.$("#"+xa.preId);na.$aftDiv=a.$("#"+xa.aftId);var ab=na.$preDiv.attr("class"),ab=ab.substring(5);1==a.$(".item."+ab).length?a.$("img[name\x3d"+
ab+"]").parent().find("img").css("display","none"):a.$("img[name\x3d"+ab+"]").parent().find("img").css({display:"inline"});0!==a.$(".item."+xa.aftClass.substring(5)).length&&a.$("img[name\x3d"+xa.aftClass.substring(5)+"]").parent().find("img").css({display:"inline"});na.$preStyleDiv=a.$("#"+xa.preStyleId);na.$aftStyleDiv=a.$("#"+xa.aftStyleId);if(na.$preDiv[0]!=na.$aftDiv[0]){a.browser.touchSupported?(Qa=[],ab=a.util.DomUtil.getTouchesPosition(event),Qa.push(ab),xa.aY=Qa[0].y):xa.aY=Qa.clientY;xa.moveY=
xa.aY-xa.pY;na.$temp=na.$aftDiv.next();na.$temp1=na.$preDiv.next();xa.preId!=xa.aftId&&(0<xa.moveY&&(na.$aftDiv[0].nextSibling||na.$aftDiv[0].previousSibling==na.$preDiv[0]?(na.$preDiv.next().next(),na.$preDiv.insertAfter(na.$aftDiv)):(na.$tt=a.$(na.$aftDiv[0].previousSibling),na.$aftDiv.insertBefore(na.$preDiv),na.$preDiv.insertAfter(na.$tt)),na.$preStyleDiv.insertAfter(na.$preDiv),na.$aftStyleDiv.insertAfter(na.$aftDiv),xa.changeClassName(na),na.$preDiv.attr("class",xa.aftClass),xa.aftClass=xa.aftClass.replace(" ",
"_"),xa.layerDeleteEnable?a.$("#"+xa.preId).children().eq(1).attr("name",xa.aftClass):a.$("#"+xa.preId).children().eq(0).attr("name",xa.aftClass)),0>xa.moveY&&(na.$aftDiv[0].previousSibling||na.$aftDiv[0].nextSibling==na.$preDiv[0]?na.$preDiv.insertAfter(na.$aftDiv):(na.$qq=a.$(na.$aftDiv[0].nextSibling),na.$aftDiv.insertBefore(na.$preDiv),na.$preDiv.insertBefore(na.$qq)),na.$preStyleDiv.insertAfter(na.$preDiv),na.$aftStyleDiv.insertAfter(na.$aftDiv),xa.changeClassName(na),na.$preDiv.attr("class",
xa.aftClass),xa.aftClass=xa.aftClass.replace(" ","_"),xa.layerDeleteEnable?a.$("#"+xa.preId).children().eq(1).attr("name",xa.aftClass):a.$("#"+xa.preId).children().eq(0).attr("name",xa.aftClass)));a.$("img[class][type\x3d'checkbox']").each(function(){xa.array.push(a.$(this).attr("value"))});Qa=xa.array.length;for(ab=xa.array.length-1;0<=ab;ab--)xa.map.getLayerByName(xa.array[ab]).setZIndex(Qa+1-ab);a.$("img[class][type\x3d'checkbox']").each(function(){"false"==a.$(this)[0].getAttribute("checked")&&
xa.map.getLayerByName(a.$(this).attr("value")).setVisible(!1)});xa.array=[];var Za=a.$(na).attr("class").substring(5),lb=xa.preClass.substring(5);a.$("img[name \x3d item_"+Za+"]").each(function(){"false"==a.$(this)[0].getAttribute("checked")&&(xa.ck3=!0);a.$("img[name \x3d"+Za+"]")[0].src=a.gv.resourcePath()+"checkMark_readonly.png"});xa.ck3&&(a.$("img[name \x3d"+Za+"]")[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png",xa.ck3=!1);xa.ck4=!1;a.$("img[name \x3d item_"+lb+"]").each(function(){"false"==
a.$(this)[0].getAttribute("checked")&&(xa.ck4=!0);a.$("img[name \x3d"+lb+"]")[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png"});xa.ck4||(a.$("img[name \x3d"+lb+"]")[0].src=a.gv.resourcePath()+"checkMark_readonly.png",xa.ck4=!1)}}xa.flag=!1;xa.touchFlag=!1;a.browser.android&&a.$(na).css({background:"#ECF9FF"})}},changeClassName:function(b){var c=b.$preStyleDiv.attr("class").split(" ");c[1]=this.layerDeleteEnable?"style_"+a.$(a.$(b).find("img[name]")[1]).attr("name").slice(5):"style_"+a.$(b).find("img[name]").attr("name").slice(5);
b.$preStyleDiv.attr("class",c[0]+" "+c[1]+" "+c[2])},touchEvent:function(b,c){var xa=this,Qa=!0;a.$(b).bind("touchstart",function(){Qa?(a.$("img[name \x3d "+this.alt+"]")[0].setAttribute("style","display:none"),a.$("."+this.alt).css({display:"none"}),a.$(".style_"+this.alt).css({display:"none"}),xa.adjustSize(),this.src=a.gv.resourcePath()+"zoomin.gif",Qa=!1):(a.$("img[name \x3d "+this.alt+"]")[0].setAttribute("style","padding-left:3px;display:inline;"),a.$("."+this.alt).css({display:""}),xa.adjustSize(),
this.src=a.gv.resourcePath()+"zoomout.gif",Qa=!0)});var ab=!0;a.$(c).bind("touchstart",function(b){b.stopPropagation();ab?(a.$("#style"+a.$(this).attr("id")).css({display:""}),xa.getThemeStyle(this),xa.adjustSize(),ab=!1):(a.$("#style"+a.$(this).attr("id")).css({display:"none"}),xa.adjustSize(),ab=!0);a.browser.android&&xa.panelDIV.height(xa.$Dom.height())})},getThemeStyle:function(b){var c=this;a.util.HttpRequest.send("/mapviewer/omserver",{xml_request:'\x3cnon_map_request\x3e\x3cget_theme_info data_source\x3d"'+
c.dataSource[a.$(b).text()]+'" theme\x3d"'+c.list[a.$(b).text()]+'"/\x3e\x3c/non_map_request\x3e'},function(xa){a.$("#img"+a.$(b).attr("id"))[0]&&(xa=a.$(xa).find("theme_style[label\x3d'false']").attr("name"),a.$("#styleText"+a.$(b).attr("id")).text(xa),a.$("#img"+a.$(b).attr("id"))[0].src="/mapviewer/omserver?sty\x3d"+xa+"\x26ds\x3d"+c.dataSource[a.$(b).text()],c.map&&c.map.getLayerByName(a.$("#img"+a.$(b).attr("id")).attr("value")).customImg&&(a.$("#img"+a.$(b).attr("id"))[0].src=c.map.getLayerByName(a.$("#img"+
a.$(b).attr("id")).attr("value")).customImg),c.map&&c.map.getLayerByName(a.$("#img"+a.$(b).attr("id")).attr("value")).getRenderingStyle()&&(a.$("#img"+a.$(b).attr("id"))[0].src=c.map.getLayerByName(a.$("#img"+a.$(b).attr("id")).attr("value")).getRenderingStyle().src))},"xml")},cloneDiv:function(b){for(var na=this,xa=a.$("div[id^\x3d'item']"),Qa=0;Qa<xa.length;Qa++)xa[Qa].pos=na.getElementPos(xa[Qa]),xa[Qa].size=na.getElementSize(xa[Qa]);b=b||c.event;b=b.target||b.srcElement;"deletebutton_layercontrol"!=
a.$(b).attr("name")&&(na.el=b.cloneNode(!0),na.el.style.position="absolute",na.el.style.left=b.pos.x-7+"px",na.el.style.display="none",na.el.style.width=b.size.width-20+"px",na.el.style.height=b.size.height+"px",na.el.style.border="1px solid #d4d4d4",na.el.style.background="lightgray",na.el.style.opacity="1",na.el.style.color="red",this.container[0].appendChild(na.el),this.document_mousemove=function(b){if(na.flag){b=b||c.event;var xa=na.getMousePos(b);na.el.style.display="";na.el.style.left=na.left;
na.el.style.top=parseInt(xa.y)-parseInt(na.map.$oracleMapDiv.parent()[0].offsetTop)-10+"px";parseInt(na.el.style.top)<na.top+na.$title.height()&&(na.el.style.top=na.top+na.$title.height()+"px");parseInt(na.el.style.top)>na.top+na.$Dom.height()-10&&(na.el.style.top=na.top+na.$Dom.height()-10+"px");na.aY=b.clientY;a.$(na.$Dom)[0].scrollTop=na.scrollTop+(na.aY-na.pY)*(a.$(na.$Dom)[0].scrollHeight/a.$(na.$Dom).height())}},this.document_msup=function(){na.flag=!1;a.$("div[id^\x3d'item']").each(function(){a.$(this).css({background:"#ECF9FF"})});
na.el&&(na.container[0].removeChild(na.el),na.el=null)},a.$(document).mousemove(this.document_mousemove),a.$(document).mouseup(this.document_msup),a.$(na.$Dom).mouseup(function(){na.flag=!1;na.el&&(na.container[0].removeChild(na.el),na.el=null)}).mouseout(function(){na.map.$oracleMapDiv.css({cursor:"default"})}))},adjustSize:function(){this.$Dom.height()>this.maxHeight+1&&this.$Dom.height(this.maxHeight);this.panelDIV.height(this.$Dom.height());a.$("#v_drag").height(this.$title.height())},getMousePos:function(a){return{x:a.pageX||
a.clientX+document.body.scrollLeft,y:a.pageY||a.clientY+document.body.scrollTop}},getElementPos:function(a){return{x:a.offsetParent?a.offsetLeft+arguments.callee(a.offsetParent).x:a.offsetLeft,y:a.offsetParent?a.offsetTop+arguments.callee(a.offsetParent).y:a.offsetTop}},getElementSize:function(a){return{width:a.offsetWidth,height:a.offsetHeight}}});a.control.MapTypeControl=a.control.MapDecoration.extend({initialize:function(b,c,xa){this.map=b;this.tileLayer=c;this.enableTypes=xa?xa.enableTypes:null;
this.type=xa?xa.type:null;var Qa=this;this.addListener=function(){a.$("#div_type").bind("click touchend",function(b){b=b.target;b.style.backgroundImage="url('"+a.gv.resourcePath()+"button_bg_dwn.png')";b.style.color="#000000";b.style.borderColor="#e0e3e8 #606974 #606974 #e0e3e8";if(Qa.tileLayer){Qa.tileLayer.setMapType(Qa.enableTypes[b.id]);var c=document.getElementById(Qa.type);Qa.type!==b.id&&(c.style.backgroundImage="url('"+a.gv.resourcePath()+"button_bg_ena.png')",c.style.color="#003d5b",c.style.borderColor=
"#e0e3e8 #606974 #606974 #e0e3e8");Qa.type=b.id}}).mouseover(function(b){b=b.target;b.id!==Qa.type&&(b.style.backgroundImage="url('"+a.gv.resourcePath()+"button_bg_ovr.png')",b.style.color="#000000")}).mouseout(function(b){b=b.target;b.id!==Qa.type&&(b.style.backgroundImage="url('"+a.gv.resourcePath()+"button_bg_ena.png')",b.style.color="#003d5b")})};if(!this.infoDecoration){b="";c=0;for(var ab in this.enableTypes)this.enableTypes[ab]&&(b=ab===this.type?b+"\x3ctd\x3e\x3ca class\x3d'selectedLinkStyle_mapTypeCtrl' id\x3d\""+
ab+'" href\x3d"javascript:void(0);"\x3e '+ab+"\x3c/a\x3e\x3c/td\x3e":b+"\x3ctd\x3e\x3ca class\x3d'linkStyle_mapTypeCtrl' id\x3d\""+ab+'" href\x3d"javascript:void(0);"\x3e '+ab+"\x3c/a\x3e\x3c/td\x3e",c+=60);0<c&&(this.infoDecoration=new a.control.MapDecoration('\x3cdiv id\x3d"div_type" style\x3d"background: white;"\x3e\x3ctable width\x3d100% cellspacing\x3d0 cellpadding\x3d0\x3e\x3ctr\x3e'+b+"\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e",{mapType:"mapTypeControl",offsetX:10,offsetY:10,draggable:!1,height:20,
contentStyle:{"border-style":"solid","border-color":"#ffffff",border:"0px",backgroundColor:"#ffffff",filter:"alpha(Opacity\x3d80)","-moz-opacity":"0.8"}}),this.infoDecoration.setAnchorPosition(3),this.map.addMapDecoration(this.infoDecoration),this.addListener(),this.infoDecoration.$DecorationDiv.css({"z-index":5}))}},destroy:function(){this.infoDecoration&&this.map.removeMapDecoration(this.infoDecoration)}});a.filter.Filter=a.Class.extend({initialize:function(){this.filterMode=a.filter.Filter.CLIENT_SIDE;
this.sql=null},setFilterMode:function(){this.filterMode=a.filter.Filter.CLIENT_SIDE},evaluate:function(a){return this.invokeClient(a)},invokeClient:function(){return!1}});a.filter.Filter.CLIENT_SIDE="client_side";a.filter.Equals=a.filter.Filter.extend({initialize:function na(a,b){na.base.call(this);this.filterType="equalsFilter";this.filterAttribute=a?a.toUpperCase():"";this.filterValue=b},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]?(a=a.attributes[this.filterAttribute],
isNaN(a)||isNaN(this.filterValue)?a===this.filterValue:parseFloat(a)===parseFloat(this.filterValue)):!1}});a.filter.NotEquals=a.filter.Filter.extend({initialize:function xa(b,c){xa.base.call(this);this.filterType="notEqualsFilter";this.equalsFilter=new a.filter.Equals(b,c)},invokeClient:function(a){return!this.equalsFilter.evaluate(a)}});a.filter.Greater=a.filter.Filter.extend({initialize:function Qa(a,b){Qa.base.call(this);this.filterType="greaterFilter";this.filterAttribute=a?a.toUpperCase():"";
this.filterValue=b},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]&&a.attributes[this.filterAttribute]>this.filterValue?!0:!1}});a.filter.GreaterEquals=a.filter.Filter.extend({initialize:function ab(a,b){ab.base.call(this);this.filterType="greaterEqualsFilter";this.filterAttribute=a?a.toUpperCase():"";this.filterValue=b},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]&&a.attributes[this.filterAttribute]>=this.filterValue?!0:!1}});
a.filter.Less=a.filter.Filter.extend({initialize:function Za(a,b){Za.base.call(this);this.filterType="lessFilter";this.filterAttribute=a?a.toUpperCase():"";this.filterValue=b},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]&&a.attributes[this.filterAttribute]<this.filterValue?!0:!1}});a.filter.LessEquals=a.filter.Filter.extend({initialize:function lb(a,b){lb.base.call(this);this.filterType="lessEqualsFilter";this.filterAttribute=a?a.toUpperCase():"";this.filterValue=
b},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]&&a.attributes[this.filterAttribute]<=this.filterValue?!0:!1}});a.filter.Between=a.filter.Filter.extend({initialize:function Ob(a,b,c){Ob.base.call(this);this.filterType="betweenFilter";this.filterAttribute=a?a.toUpperCase():"";this.lowValue=parseFloat(b);this.highValue=parseFloat(c)},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]&&parseFloat(a.attributes[this.filterAttribute])>=this.lowValue&&
parseFloat(a.attributes[this.filterAttribute])<=this.highValue?!0:!1}});a.filter.Like=a.filter.Filter.extend({initialize:function Cb(a,b){Cb.base.call(this);this.filterType="likeFilter";this.filterAttribute=a?a.toUpperCase():"";this.filterValue=b},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]?this.executeLikeReg(this.filterValue,a.attributes[this.filterAttribute]):!1},executeLikeReg:function(b,c){if(b===c)return!0;var pb=""+b,Ib=""+c;-1!==pb.indexOf("_")&&(pb=pb.replace(/\_/g,
"."));-1!==pb.indexOf("%")&&(pb=pb.replace(/\%/g,"[a-zA-Z0-9.@!#$^\x26*() \\s]+"));pb=new RegExp(pb);return a.notNull(Ib.match(pb))&&0<Ib.match(pb).length?Ib.match(pb)[0]===c:!1}});a.filter.InsidePolygon=a.filter.Filter.extend({initialize:function yb(a){yb.base.call(this);this.filterType="InsidePolygonFilter";this.filterGeom=a;this.filterMBR=this.filterGeom.getMBR()},invokeClient:function(a){var b;if(a.geo)if(a.geo.srid!==this.filterGeom.srid){var c=this;this.filterGeom.transform(a.geo.srid,function(b){c.filterGeom=
b;c.evaluate(a)})}else{var mb=this.filterGeom.type;b=a.getGeometry().getMBR();if("Rectangle"===mb){if(b.getMinX()>=this.filterGeom.getMinX()&&b.getMaxX()<=this.filterGeom.getMaxX()&&b.getMinY()>=this.filterGeom.getMinY()&&b.getMaxY()<=this.filterGeom.getMaxY())return!0}else if("Polygon"===mb){if(b.getMinX()>=this.filterMBR.getMinX()&&b.getMaxX()<=this.filterMBR.getMaxX()&&b.getMinY()>=this.filterMBR.getMinY()&&b.getMaxY()<=this.filterMBR.getMaxY()&&(this._MBRInPolygon(b,this.filterGeom)||this.geomInPolygon(a.geo,
this.filterGeom)))return!0}else if("MultiPolygon"===mb&&b.getMinX()>=this.filterMBR.getMinX()&&b.getMaxX()<=this.filterMBR.getMaxX()&&b.getMinY()>=this.filterMBR.getMinY()&&b.getMaxY()<=this.filterMBR.getMaxY()&&(this._MBRInPolygon(b,this.filterGeom)||this.geomInPolygon(a.geo,this.filterGeom)))return!0;return!1}else return!1},pointInsidePolygonRing:function(a,b,c){for(var mb=[],tb=[],Gb=c[0].length/2,Fb=0;Fb<Gb;Fb++)mb[Fb]=parseFloat(c[0][2*Fb]),tb[Fb]=parseFloat(c[0][2*Fb+1]);var Nb=0;c=0;for(Fb=
Gb-1;c<Gb;Fb=c++)tb[c]>b!==tb[Fb]>b&&a<(mb[Fb]-mb[c])*(b-tb[c])/(tb[Fb]-tb[c])+mb[c]&&(Nb=!Nb);return Nb},pointInsideCircle:function(a,b,c){var mb=c.centerX,tb=c.centerY,Gb=0;(mb-a)*(mb-a)+(tb-b)*(tb-b)<c.radius*c.radius&&(Gb=!Gb);return Gb},pointInPolygon:function(a,b,c){var mb=c.getType(),tb=0;if("Polygon"===mb)tb=c.circlePolygon?this.pointInsideCircle(a,b,c):this.pointInsidePolygonRing(a,b,c.coordinates);else if("MultiPolygon"===mb){c=c.coordinates;for(var mb=c.length,Gb=0;Gb<mb;Gb++){var Fb=this.pointInsidePolygonRing(a,
b,c[Gb]);if(Fb){tb=Fb;break}}}return tb},geomInPolygon:function(a,b){var c,mb,tb;if("Point"===a.type||"OrientedPoint"===a.type){if(c=a.coordinates,this.pointInPolygon(c[0],c[1],this.filterGeom))return!0}else{if("MultiPoint"===a.type||"OrientedMultiPoint"===a.type){mb=a.coordinates;for(tb=0;tb<mb.length;tb++)if(c=mb[tb],!this.pointInPolygon(c[0],c[1],b))return!1;return!0}if("Rectangle"===a.type)return c=a.coordinates,c.push(c[0],c[3],c[2],c[1]),this._geomInPolygon(c,b)?!0:!1;if("LineString"===a.type)return c=
a.coordinates,this._geomInPolygon(c,b)?!0:!1;if("MultiLineString"===a.type){mb=a.coordinates;for(tb=0;tb<mb.length;tb++)if(c=mb[tb],!this._geomInPolygon(c,b))return!1;return!0}if("Polygon"===a.type)return c=a.coordinates[0],this._geomInPolygon(c,b)?!0:!1;if("MultiPolygon"===a.type){mb=a.coordinates;for(tb=0;tb<mb.length;tb++)if(c=mb[tb][0],!this._geomInPolygon(c,b))return!1;return!0}}return!1},_geomInPolygon:function(a,b){var c=a.length/2;if(b.circlePolygon)return this._geomInPolygonCircle(a,b);for(var mb=
0,tb=c-1;mb<c;mb++)if(!this.pointInPolygon(a[2*mb],a[2*mb+1],b)||this.segmentCrossPolygon({coordinates:[a[2*mb],a[2*mb+1],a[2*tb],a[2*tb+1]]},b))return!1;return!0},_geomInPolygonCircle:function(a,b){for(var c=a.length/2,mb=0;mb<c;mb++)if(!this.pointInPolygon(a[2*mb],a[2*mb+1],b))return!1;return!0},_MBRInPolygon:function(a,b){return this.geomInPolygon(a,b)},segmentCrossPolygon:function(b,c){this.proxy||(this.proxy=new a.filter.AnyInteract(this.filterGeom));return this.proxy.segmentCrossPolygon(b,c)}});
a.filter.All=a.filter.Filter.extend({initialize:function pb(a){pb.base.call(this);this.filterType="allFilter";this.filterArray=a},invokeClient:function(a){for(var b=0;b<this.filterArray.length;b++)if(!1===this.filterArray[b].evaluate(a))return!1;return!0}});a.filter.And=a.filter.Filter.extend({initialize:function Ib(a,b){Ib.base.call(this);this.filterType="andFilter";this.filter1=a;this.filter2=b},invokeClient:function(a){var b=this.filter1.evaluate(a);a=this.filter2.evaluate(a);return!!(b&a)}});
a.filter.Any=a.filter.Filter.extend({initialize:function mb(a){mb.base.call(this);this.filterType="anyFilter";this.filterArray=a},invokeClient:function(a){for(var b=0;b<this.filterArray.length;b++)if(!0===this.filterArray[b].evaluate(a))return!0;return!1}});a.filter.In=a.filter.Any.extend({initialize:function tb(b,c){var Nb=[];"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);for(var Pb=0;Pb<c.length;Pb++)Nb.push(new a.filter.Equals(b,c[Pb]));tb.base.call(this,Nb);this.filterType="inFilter"}});
a.filter.IsNotNull=a.filter.Filter.extend({initialize:function Gb(a){Gb.base.call(this);this.filterType="isNotNullFilter";this.filterAttribute=a?a.toUpperCase():""},invokeClient:function(b){return a.notNull(b.attributes)&&a.notNull(b.attributes[this.filterAttribute])?!0:!1}});a.filter.IsNull=a.filter.Filter.extend({initialize:function Fb(a){Fb.base.call(this);this.filterType="isNullFilter";this.filterAttribute=a?a.toUpperCase():""},invokeClient:function(b){return a.isNull(b.attributes)||a.isNull(b.attributes[this.filterAttribute])?
!0:!1}});a.filter.Not=a.filter.Filter.extend({initialize:function Nb(a){Nb.base.call(this);this.filterType="notFilter";this.negateFilter=a},invokeClient:function(a){return!this.negateFilter.evaluate(a)}});a.filter.Or=a.filter.Filter.extend({initialize:function Pb(a,b){Pb.base.call(this);this.filterType="orFilter";this.filter1=a;this.filter2=b},invokeClient:function(a){var b=this.filter1.evaluate(a);a=this.filter2.evaluate(a);return b||a}});a.filter.Xor=a.filter.Filter.extend({initialize:function Sb(a,
b){Sb.base.call(this);this.filterType="xorFilter";this.filter1=a;this.filter2=b},invokeClient:function(a){var b=this.filter1.evaluate(a);a=this.filter2.evaluate(a);return!!(b^a)}});a.filter.AnyInteract=a.filter.Filter.extend({initialize:function Tb(a){Tb.base.call(this);this.filterType="AnyInteractFilter";this.filterGeom=a;this.filterMBR=this.filterGeom.getMBR();this.sqlStr=null},invokeClient:function(b){if(b.geo)if(b.geo.srid!==this.filterGeom.srid){var c=this;this.filterGeom.transform(b.geo.srid,
function(a){var T=a.getMBR();c.filterGeom=a;c.filterMBR=c.filterGeom.getMBR();a=b.getGeometry().getMBR();a.getMinX()>T.getMinX()&&a.getMaxX()<T.getMaxX()&&a.getMinY()>T.getMinY()&&a.getMaxY()<T.getMaxY()&&this._AnyInteractWithPolygon(b.geo,this.filterGeom);return!1})}else{var T=b.getGeometry(),R=T.getMBR(),D=T.type,F=this.filterGeom.type;return a.isNull(R)?!1:R.getMaxX()<this.filterMBR.getMinX()||R.getMinX()>this.filterMBR.getMaxX()||R.getMaxY()<this.filterMBR.getMinY()||R.getMinY()>this.filterMBR.getMaxY()?
!1:"Polygon"===F||"Rectangle"===F||"MultiPolygon"===F?this._AnyInteractWithPolygon(T,this.filterGeom):"Polygon"===D||"Rectangle"===D||"MultiPolygon"===D?this._AnyInteractWithPolygon(this.filterGeom,T):"LineString"!==F&&"MultiLineString"!==F||"LineString"!==D&&"MultiLineString"!==D?"LineString"===F||"MultiLineString"===F?this.isPointOnLine(T,this.filterGeom):"LineString"===D||"MultiLineString"===D?this.isPointOnLine(this.filterGeom,T):this.isSamePoints(this.filterGeom,T):this.isInteractLine(T,this.filterGeom)}else return!1},
_AnyInteractWithPolygon:function(a,b){return this.intersectWithPolygon(a,b)||this.hasPointsInPolygon(a,b)?!0:!1},intersectWithPolygon:function(a,b){var c=a.type,R,D,F,U,ea;if("Point"===c||"OrientedPoint"===c)return this.pointInPolygon(a.getX(),a.getY(),b);if("MultiPoint"===c||"OrientedMultiPoint"===c)for(c=a.coordinates,F=0,R=c.length;F<R;F++){if(this.pointInPolygon(c[F][0],c[F][1],b))return!0}else if("LineString"===c)for(c=a.coordinates,F=0,R=c.length/2;F<R-1;F++){if(D={coordinates:[c[2*F],c[2*F+
1],c[2*(F+1)],c[2*(F+1)+1]]},this.segmentCrossPolygon(D,b))return!0}else if("MultiLineString"===c){U=a.coordinates;ea=U.length;for(var ja=0;ja<ea;ja++)for(c=U[ja],F=0,R=c.length/2;F<R-1;F++)if(D={coordinates:[c[2*F],c[2*F+1],c[2*(F+1)],c[2*(F+1)+1]]},this.segmentCrossPolygon(D,b))return!0}else if("Rectangle"===c)for(c=a.coordinates,c.push(c[0],c[3],c[2],c[1]),R=c.length/2,F=0,D=R-1;F<R;D=F++){if(D={coordinates:[c[2*F],c[2*F+1],c[2*D],c[2*D+1]]},this.segmentCrossPolygon(D,b))return!0}else if("Polygon"===
c)for(c=a.coordinates[0],R=c.length/2,F=0,D=R-1;F<R;D=F++){if(D={coordinates:[c[2*F],c[2*F+1],c[2*D],c[2*D+1]]},this.segmentCrossPolygon(D,b))return!0}else if("MultiPolygon"===c)for(U=a.coordinates,ea=U.length,R=0;R<ea;R++)for(c=U[R][0],ja=c.length/2,F=0,D=ja-1;F<ja;D=F++)if(D={coordinates:[c[2*F],c[2*F+1],c[2*D],c[2*D+1]]},this.segmentCrossPolygon(D,b))return!0;return!1},segmentCrossPolygon:function(a,b){var c=b.coordinates;if("Rectangle"==b.type){var R=b.coordinates,c=R[0],D=R[1],F=R[2],R=R[3],
U=a.coordinates;if(U[0]>=c&&U[0]<=F&&U[1]>=D&&U[1]<=R||U[2]>=c&&U[2]<=F&&U[3]>=D&&U[3]<=R)return!0;c=[[[c,D,F,D,F,R,c,R,c,D]]]}"Polygon"===b.type&&(c=[c]);D=0;for(F=c.length;D<F;D++)for(var R=c[D][0],U=R.length/2,ea=0,ja=U-1;ea<U;ja=ea++)if(this.segmentsStraddle(a,{coordinates:[R[2*ea],R[2*ea+1],R[2*ja],R[2*ja+1]]}))return!0;return!1},segmentsStraddle:function(a,b){if(!this.rectangleScopeOverlap(a,b))return!1;var c={x:a.coordinates[2]-b.coordinates[0],y:a.coordinates[3]-b.coordinates[1]},R={x:b.coordinates[2]-
b.coordinates[0],y:b.coordinates[3]-b.coordinates[1]},D={x:b.coordinates[0]-a.coordinates[0],y:b.coordinates[1]-a.coordinates[1]},F={x:b.coordinates[2]-a.coordinates[0],y:b.coordinates[3]-a.coordinates[1]},U={x:a.coordinates[2]-a.coordinates[0],y:a.coordinates[3]-a.coordinates[1]},c=this.crossProduct({x:a.coordinates[0]-b.coordinates[0],y:a.coordinates[1]-b.coordinates[1]},R)*this.crossProduct(R,c),D=this.crossProduct(D,U)*this.crossProduct(U,F);return 0<=c&&0<=D?!0:!1},crossProduct:function(a,b){return Math.round(1E5*
(a.x*b.y-a.y*b.x))/1E5},rectangleScopeOverlap:function(a,b){var c=function(a,b){var c={};a>=b?(c.max=a,c.min=b):(c.max=b,c.min=a);return c},R=c(a.coordinates[0],a.coordinates[2]),D=c(a.coordinates[1],a.coordinates[3]),F=c(b.coordinates[0],b.coordinates[2]),c=c(b.coordinates[1],b.coordinates[3]);return R.max<F.min||R.min>F.max||D.max<c.min||D.min>c.max?!1:!0},hasPointsInPolygon:function(a,b){var c=a.type,R,D,F,U;if("Point"===c||"OrientedPoint"===c)return this.pointInPolygon(a.getX(),a.getY(),b);if("MultiPoint"===
c||"OrientedMultiPoint"===c){c=0;for(D=a.coordinates.length/2;c<D;c++)if(this.pointInPolygon(a.coordinates[2*c],a.coordinates[2*c+1],b))return!0;return!1}if("LineString"===a.type){c=0;for(R=a.coordinates.length/2;c<R;c++)if(this.pointInPolygon(a.coordinates[2*c],a.coordinates[2*c+1],b))return!0;return!1}if("MultiLineString"===a.type){D=0;for(F=a.coordinates.length;D<F;D++)for(U=a.coordinates[D],c=0,R=U.length/2;c<R;c++)if(this.pointInPolygon(U[2*c],U[2*c+1],b))return!0;return!1}if("Rectangle"===a.type)return c=
a.coordinates,this.pointInPolygon(c[0],c[1],b)||this.pointInPolygon(c[2],c[3],b)||this.pointInPolygon(c[0],c[3],b)||this.pointInPolygon(c[2],c[1],b)?!0:!1;if("Polygon"===a.type){c=0;for(R=a.coordinates[0].length/2;c<R;c++)if(this.pointInPolygon(a.coordinates[0][2*c],a.coordinates[0][2*c+1],b))return!0;return!1}if("MultiPolygon"===a.type){D=0;for(F=a.coordinates.length;D<F;D++)for(U=a.coordinates[D][0],c=0,R=U.length/2;c<R;c++)if(this.pointInPolygon(U[2*c],U[2*c+1],b))return!0;return!1}},pointInPolygon:function(a,
b,c){var R;if("Polygon"===c.type)R=c.coordinates[0],R=this._pointInPolygon(a,b,R);else if("Rectangle"==c.type)R=[c.getMinX(),c.getMinY(),c.getMaxX(),c.getMinY(),c.getMaxX(),c.getMaxY(),c.getMinX(),c.getMaxY(),c.getMinX(),c.getMinY()],R=this._pointInPolygon(a,b,R);else if("MultiPolygon"===c.type)for(var D=c.coordinates,F=0;F<D.length;F++)if(R=D[F][0],R=this._pointInPolygon(a,b,R))return!0;return R?!0:this.isPointOnLine({coordinates:[a,b],type:"Point"},c)},_pointInPolygon:function(a,b,c){for(var R=
[],D=[],F=c.length/2,U=0;U<F;U++)R[U]=parseFloat(c[2*U]),D[U]=parseFloat(c[2*U+1]);var ea=0;c=0;for(U=F-1;c<F;U=c++)D[c]>b!==D[U]>b&&a<(R[U]-R[c])*(b-D[c])/(D[U]-D[c])+R[c]&&(ea=!ea);return ea},isInteractLine:function(a,b){for(var c=this.getSegments(a),R=this.getSegments(b),D=0,F=c.length;D<F;D++)for(var U=0,ea=R.length;U<ea;U++)if(this.segmentsStraddle(c[D],R[U]))return!0;return!1},getSegments:function(a){var b=a.type;a=a.coordinates;var c=[],R,D,F,U;if("LineString"===b)for(b=0,R=a.length/2;b<R-
1;b++)c.push({coordinates:[a[2*b],a[2*b+1],a[2*(b+1)],a[2*(b+1)+1]]});else if("MultiLineString"===b)for(D=0,F=a.length;D<F;D++)for(U=a[D],b=0,R=U.length/2;b<R-1;b++)c.push({coordinates:[U[2*b],U[2*b+1],U[2*(b+1)],U[2*(b+1)+1]]});else if("Polygon"===b)for(a=a[0],b=0,R=a.length/2;b<R-1;b++)c.push({coordinates:[a[2*b],a[2*b+1],a[2*(b+1)],a[2*(b+1)+1]]});else if("MultiPolygon"===b)for(D=0,F=a.length;D<F;D++)for(U=a[D][0],b=0,R=U.length/2;b<R-1;b++)c.push({coordinates:[U[2*b],U[2*b+1],U[2*(b+1)],U[2*(b+
1)+1]]});else"Rectangle"===b&&(c.push({coordinates:[a[0],a[1],a[2],a[1]]}),c.push({coordinates:[a[2],a[1],a[2],a[3]]}),c.push({coordinates:[a[2],a[3],a[0],a[3]]}),c.push({coordinates:[a[0],a[3],a[0],a[1]]}));return c},isPointOnLine:function(a,b){var c=this.getSegments(b),R=a.coordinates;if("Point"===a.type||"OrientedPoint"===a.type)R=[R];for(var D=0,F=R.length;D<F;D++)for(var U=0,ea=c.length;U<ea;U++)if(this.isPointOnSegment(R[D][0],R[D][1],c[U]))return!0;return!1},isPointOnSegment:function(a,b,c){c=
c.coordinates;return 0!==this.crossProduct({x:a-c[0],y:b-c[1]},{x:c[2]-c[0],y:c[3]-c[1]})?!1:Math.min(c[0],c[2])<=a&&a<=Math.max(c[0],c[2])&&Math.min(c[1],c[3])<=b&&b<=Math.max(c[1],c[3])?!0:!1},isSamePoints:function(a,b){var c=a.coordinates,R=b.coordinates;if("Point"===a.type||"OrientedPoint"===a.type)c=[c];if("Point"===b.type||"OrientedPoint"===b.type)R=[R];for(var D=0,F=c.length;D<F;D++)for(var U=0,ea=R.length;U<ea;U++){var ja=c[D],ra=R[U];if(ja[0]===ra[0]&&ja[1]===ra[1])return!0}return!1}});a.template.TemplateConfig=
a.Class.extend({initialize:function(b,c){this.baseFolder=this.url="";var T={};c?this.config=c:(b&&-1!==b.indexOf("config.json",b.length-11)&&(this.url=b,this.baseFolder=b.substring(0,b.lastIndexOf("/")+1),a.$.ajax({url:b,async:!1,dataType:"json",success:function(a){T=a}})),this.config=T)},vectorLayerList:function(){var a=this.config,b=[];if(a.vectorLayers)for(var c=0;c<a.vectorLayers.length;c++)b.push(a.vectorLayers[c].dn);return b},initVectorLayerList:function(){},tileLayerList:function(){var a=
this.config,b=[];if(a.tileLayers)for(var c=0;c<a.tileLayers.length;c++)b.push(a.tileLayers[c].dn);return b},styleList:function(){var a=this.config,b=[];if(a.styles)for(var c=0;c<a.styles.length;c++)b.push(a.styles[c].dn);return b},getTileLayer:function(b){if(!this.config.vectorLayers)return null;var c=this.getTileLayerConfig(b);if(a.isNull(c))return null;var T=null,R=c.vendor;if("google"===R)T=new a.layer.GoogleTileLayer(b);else if("oracle"===R)T=new a.layer.ElocationTileLayer(b);else if("nokia"===
R){var T=c.key,R=c.secondary_key,D=null;if(c.mapTypes)for(var c=c.mapTypes.split(","),D="",F=0;F<c.length;F++)0<F&&(D+=";"),D+="OM.layer.NokiaTileLayer.TYPE_"+c[F].toUpperCase();T=new a.layer.NokiaTileLayer(b,{key:T,appID:R,mapTyleList:D})}else"bing"===R&&(T=new a.layer.BingTileLayer(b,{key:c.key}));return T},getVectorLayer:function(b,c){if(!this.config.vectorLayers)return null;var T=this.getVectorLayerConfig(c);if(a.isNull(T))return null;var R=T.uri;this.baseFolder&&0>T.uri.indexOf("http")&&(R=this.baseFolder+
T.uri);R=new a.layer.VectorLayer(b,{def:{type:a.layer.VectorLayer.TYPE_DATAPACK,url:R}});if(T.styles){var D=T.styles;D.normal&&R.setRenderingStyle(this.getStyle(D.normal));D.selected&&R.setSelectStyle(this.getStyle(D.selected));D.mouseOver&&(R.enableFeatureHover(!0),R.setHoverStyle(this.getStyle(D.mouseOver)))}T.nsdp&&R.setNSDP(T.nsdp);return R},getStyle:function(b){var c=this.config;if(!c.styles)return null;for(var c=c.styles,T=null,R=0;R<c.length;R++)if(c[R].dn===b){switch(c[R].type){case "color":T=
new a.style.Color(c[R].def);break;case "marker":T=new a.style.Marker(c[R].def);break;case "linear-gradient":T=new a.style.LinearGradient(c[R].def);break;case "pulse_animation":T=new a.style.PulseAnimation(c[R].def);break;case "color_animation":b={};c[R].beginColor&&(b.beginColor=this.getStyle(c[R].beginColor));c[R].endColor&&(b.endColor=this.getStyle(c[R].endColor));c[R].duration&&(b.duration=c[R].duration);c[R].movingDashLine&&(b.enableMovingDashLine=c[R].movingDashLine);T=new a.style.AnimationColor(b);
break;case "line":T=new a.style.Line(c[R].def);break;case "text":T=new a.style.Text(c[R].def);break;case "heat_map":b=c[R].container;b=this.getVectorLayer(c[R].dn+" "+b,b);c=c[R].def;c.containerVectorLayer=b;T=new a.style.HeatMap(c);break;case "bar_chart":var D=c[R].barArr,F=D.length,T=[];for(b=0;b<F;b++)T.push(new a.style.Bar(D[b].name,D[b].color));c=c[R].def;c.bars=T;T=new a.style.BarChart(c);break;case "pie_chart":D=c[R].pieArr;F=D.length;T=[];for(b=0;b<F;b++)T.push(new a.style.PieSlice(D[b].name,
D[b].color));c=c[R].def;c.pieSlices=T;T=new a.style.PieChart(c)}break}return T},getConfig:function(){return this.config},setConfig:function(a){this.config=a},initMap:function(b){var c=this.config;if(c.init){c=c.init;if(c.tileLayer)b.addLayer(this.getTileLayer(c.tileLayer));else if(c.customUniverse){var T=c.customUniverse,R=T.bounds,T=new a.universe.Universe({srid:T.srid,bounds:new a.geometry.Rectangle(R[0],R[1],R[2],R[3],R[4]),numberOfZoomLevels:T.numberOfZoomLevels});b.getMapContextToken().universe=
T}else return;if(c.layers)for(b.removeAllFeatureLayers(),T=c.layers,R=0;R<T.length;R++)b.addLayer(this.getVectorLayer(T[R],T[R]));if(c.center){var T=c.center[0],R=c.center[1],D=b.getMapContext().getUniverse().srid,T=new a.geometry.Point(T,R,D);b.setMapCenter(T)}c.zoomLevel&&b.setMapZoomLevel(c.zoomLevel);c.copyright&&b.addMapDecoration(new a.control.CopyRight(c.copyright));c.navigation&&b.addMapDecoration(new a.control.NavigationPanelBar(c.navigation))}},getVectorLayerConfig:function(a){a=this.indexOfVectorLayer(a);
return-1===a?null:this.config.vectorLayers[a]},getTileLayerConfig:function(a){a=this.tileLayerList().indexOf(a);return-1===a?null:this.config.tileLayers[a]},indexOfVectorLayer:function(a){var b=this.vectorLayerList().indexOf(a);if(-1===b)for(var c=this.config.vectorLayers,R=0;R<c.length;R++){var D=c[R];if(D.cn&&(b=D.cn.indexOf(a),-1!==b)){b=R;break}}return b}});a.template.Template=a.Class.extend({initialize:function(b){this.name="default";this.containerMap=null;b&&b.name&&(this.name=b.name);this.config=
null;b.url?this.config=new a.template.TemplateConfig(b.url):b.data&&(this.config=new a.template.TemplateConfig(null,b.data))},getConfig:function(){return this.config},setConfig:function(b){var c=new a.template.TemplateConfig(null);c.setConfig(b);this.config=c},getVectorLayer:function(b,c,T){if(!this.config)return null;var R=this.config.getVectorLayer(b,c);if(a.isNull(R))return null;if(!(T&&T instanceof Array&&0<T.length))return R;c=this.config.getVectorLayerConfig(c).uri;var D=null;a.$.ajax({url:c,
async:!1,dataType:"json",success:function(a){D=a}});if(a.isNull(D))return null;c=D.features;for(var R=c.length,F=D.attr_names,U=D.srs,ea=[],ja=0;ja<R;ja++){var ra=c[ja],Ea=0;a:for(;Ea<T.length;Ea++)for(var Ha=T[Ea].toUpperCase(),Ka=0;Ka<F.length;Ka++){var Ra=F[Ka].toUpperCase();if(ra.properties[Ra].toUpperCase()===Ha){Ha=ra.geometry;Ha.srid=U;Ea=a.notNull(ra._id)?ra._id:ja;Ha=a.geometry.Geometry.createGeometry(Ha,U);Ea=new a.Feature(Ea,Ha,{attributes:ra.properties});Ea.srid=U;Ea.label_box=ra.label_box;
ea.push(Ea);break a}}}return new a.layer.VectorLayer(b,{def:{type:a.layer.VectorLayer.TYPE_LOCAL,features:ea}})},getTileLayer:function(a){return this.config?this.config.getTileLayer(a):null},getStyle:function(a){return this.config?this.config.getStyle(a):null},setupMapControls:function(a){try{this.config.initMap(a),a.template=this,this.containerMap=a}catch(b){}},getVectorLayerNames:function(){return this.config.vectorLayerList()},getTileLayerNames:function(){return this.config.tileLayerList()},getStyleNames:function(){return this.config.styleList()},
getChildLayerNames:function(a){if(!this.config)return null;var b=[];a=this.config.getVectorLayerConfig(a);null!==a&&a.cl&&(b=a.cl);return b},getParentLayerNames:function(a){if(!this.config)return null;var b=[];a=this.config.getVectorLayerConfig(a);null!==a&&a.pl&&(b=a.pl);return b},getChildLayer:function(b,c,T,R){if(!this.config)return null;c=this.config.getVectorLayerConfig(c);if(a.isNull(c)||!c.cl)return null;c=c.cl;if("string"===typeof T)if(-1===c.indexOf(T)){var D=this.config.indexOfVectorLayer(T);
if(-1===D)return null;for(var F=!1,U=0;U<c.length;U++){var ea=this.config.indexOfVectorLayer(c[U]);if(D===ea){F=!0;break}}if(F)return this.getVectorLayer(b,T,R)}else return this.getVectorLayer(b,T,R);else if("number"===typeof T&&!(0>T||T>=c.length))return this.getVectorLayer(b,c[T],R);return null},switchTileLayer:function(b){if(this.getTileLayerNames()&&b){var c=this.containerMap.getLayerByName(b);if(!c){var T=this.getTileLayer(b);T?(c&&this.containerMap.removeLayer(c),this.containerMap.addLayer(T)):
a.util.Logger.warning("MAPVIEWER_9031","OM.template.Template",b)}}},destroy:function(){this.containerMap=null}});(function(a){a.lbs.OutputAddress=a.Class.extend({initialize:function(a){this.id=a;this.edgeId=this.percent=this.side=this.postalAddonCode=this.postalCode=this.country=this.region=this.municipality=this.settlement=this.street=this.houseNumber=this.name=null}})})(a);(function(a){a.lbs.Match=a.Class.extend({initialize:function(a,b){this.id=a;this.sequence=b;this.outputAddress=this.srid=this.matchVector=
this.errorMessage=this.matchCode=this.latitude=this.longitude=null},getErrorMessage:function(){return this.errorMessage},setErrorMessage:function(a){this.errorMessage=a},getId:function(){return this.id},setId:function(a){this.id=a},getLatitude:function(){return this.latitude},setLatitude:function(a){this.latitude=a},getLongitude:function(){return this.longitude},setLongitude:function(a){this.longitude=a},getMatchCode:function(){return this.matchCode},setMatchCode:function(a){this.matchCode=a},getMatchVector:function(){return this.matchVector},
setMatchVector:function(a){this.matchVector=a},getSequence:function(){return this.sequence},setSequence:function(a){this.sequence=a},getOutputAddress:function(){return this.outputAddress},setOutputAddress:function(a){this.outputAddress=a},getSrid:function(){return this.srid},setSrid:function(a){this.srid=a}})})(a);(function(a){a.lbs.GCResult=a.Class.extend({initialize:function(){this.MATCH_CODE1=1;this.MATCH_CODE2=2;this.MATCH_CODE3=3;this.MATCH_CODE4=4;this.MATCH_CODE10=10;this.MATCH_CODE11=11},
getId:function(){},succeeded:function(){},getMatches:function(){}})})(a);(function(a){a.lbs.DefaultGCResult=a.lbs.GCResult.extend({initialize:function T(b,c){T.base.call(this);this.id=b;this.rawResponse=c;this.matchCount=0;this.matches=null;a.gv.proxyEnabled?this.parseResult():this.parseJsonResult()},getId:function(){return this.id},succeeded:function(){return 0<this.matchCount},getMatches:function(){return this.matches},parseJsonResult:function(){this.matchCount=0;this.matches=null;var b=this.rawResponse;
if(!(a.isNull(b)||(this.matchCount=b.length,0>=this.matchCount))){this.matches=[];for(var c=0;c<this.matchCount;c++){var D={};D.longitude=b[c].x;D.latitude=b[c].y;D.matchCode=b[c].matchCode;D.matchVector=b[c].matchVector;D.errorMessage=b[c].errorMessage;var F={name:""};F.houseNumber=b[c].houseNumber;F.street=b[c].street;F.country=b[c].country;F.postalCode=b[c].postalCode;F.region=b[c].region;F.settlement=b[c].settlement;F.municipality=b[c].municipality;F.side=b[c].side;F.percent=b[c].percent;F.edgeId=
b[c].edgeId;D.outputAddress=F;a.isNotNull(D)&&"not geocoded"!=D.errorMessage&&this.matches.push(D)}}},parseResult:function(){this.matchCount=0;this.matches=null;var b=this.rawResponse;if(!(a.isNull(b)||7>b.length)){this.id||(this.id=a.lbs.MetaData.DefaultAddressId);var c='\x3cgeocode id\x3d"'+this.id+'"',c=b.indexOf(c),D=b.indexOf("\x3c/geocode\x3e",c+7),b=b.substring(c,D);if(0>c)return null;this.matchCount=this.getAttribute(b,"match_count",0);if(!(0>=this.matchCount))for(this.matches=[],c=0;c<this.matchCount;c++)D=
this.parseMatch(this.id,c,b),a.isNotNull(D)&&this.matches.push(D)}},getAttribute:function(a,b,c){b+='\x3d"';c=a.indexOf(b,c);var F=a.indexOf('"',c+b.length);return a.substring(c+b.length,F)},parseMatch:function(b,c,D){var F=D.indexOf('\x3cmatch sequence\x3d"'+c+'"');if(0>F)return null;var U=D.indexOf("\x3c/match\x3e",F+7);D=D.substring(F,U);c=new a.lbs.Match(b,c);F=Number(this.getAttribute(D,"longitude",0));U=Number(this.getAttribute(D,"latitude",0));c.setLongitude(F);c.setLatitude(U);c.setErrorMessage(this.getAttribute(D,
"error_message",0));c.setMatchVector(this.getAttribute(D,"match_vector",0));c.setSrid(this.getAttribute(D,"srid",0));F=this.getAttribute(D,"match_code",0);c.setMatchCode(F);b=this.parseOutputAddress(b,D);c.setOutputAddress(b);return c},parseOutputAddress:function(b,c){var D=c.indexOf("\x3coutput_address");if(0>D)return null;var F=c.indexOf("/\x3e",D+1);c=c.substring(D,F);D=new a.lbs.OutputAddress(b);D.name=this.getAttribute(c,"name",0);D.houseNumber=this.getAttribute(c,"house_number",0);D.street=
this.getAttribute(c,"street",0);D.settlement=this.getAttribute(c,"settlement",0);D.region=this.getAttribute(c,"region",0);D.municipality=this.getAttribute(c,"municipality",0);D.country=this.getAttribute(c,"country",0);D.postalCode=this.getAttribute(c,"postal_code",0);D.postalAddonCode=this.getAttribute(c,"postal_addon_code",0);D.side=this.getAttribute(c,"side",0);D.percent=this.getAttribute(c,"percent",0);D.edgeId=this.getAttribute(c,"edge_id",0);return D}})})(a);(function(a){a.lbs.MetaData=a.Class.extend({initialize:function(a){a?
("/"==a.substr(a.length-1,1)&&(a=a.substr(0,a.length-1)),this.baseURL=a):this.baseURL="http://elocation.oracle.com";this.mappingUrl=this.baseURL+"/mapviewer";this.geocoderUrl=this.baseURL+"/geocoder/gcserver";this.elocationLbsUrl=this.baseURL+"/elocation/lbs"},getElocationLbsUrl:function(){return this.elocationLbsUrl},setElocationLbsUrl:function(a){this.elocationLbsUrl=a},getGeocoderUrl:function(){return this.geocoderUrl},setGeocoderUrl:function(a){this.geocoderUrl=a},getMappingUrl:function(){return this.mappingUrl},
setMappingUrl:function(a){this.mappingUrl=a},getRoutingUrl:function(){return this.routingUrl},setRoutingUrl:function(a){this.routingUrl=a}});a.lbs.MetaData.DefaultAddressId="0"})(a);(function(a){a.lbs.Geocoder=a.Class.extend({initialize:function(b){(this.metaData=b)&&b.getGeocoderUrl()&&a.gv.proxyEnabled&&(this.geocoderUrl=b.getGeocoderUrl());b&&b.getGeocoderUrl()&&!a.gv.proxyEnabled&&(this.elocationLbsUrl=b.getElocationLbsUrl())},geocode:function(a,b){var c=this.wrapAddress2Xml(a);this.send_geocode(a.id,
c,b)},parseJson:function(b){return a.notNull(b)&&a.notNull(b.replace)?(b=b.replace(/([{,])(?:\s*)([^:"{},]+)(?:\s*):/g,'$1"$2":'),a.$.parseJSON(b)):null},batchGeoCode:function(b,c){for(var R="",D=0;D<b.length;D++)R+=this.wrapAddress2Xml(b[D]);var F=this.wrapRequests(R);a.util.Logger.fine("","OM.Geocoder.batchGeoCode","gc batch request\x3d"+F);var R=function(F){for(var D=a.lbs.Geocoder.STATUS_FAILED,U=[],D=0;D<b.length;D++){var R=new a.lbs.DefaultGCResult(b[D].id,F);U.push(R)}D=a.lbs.Geocoder.STATUS_OK;
a.util.Logger.fine("","OM.Geocoder.batchGeoCode","gc batch response\x3d"+F);a.notNull(c)&&c(U,D)},U=this;MVXMLHttpRequest={callBack:function(F,D){D=U.parseJson(D);for(var R=a.lbs.Geocoder.STATUS_FAILED,ea=[],R=0;R<D.length;R++)if(1<D.length&&a.notNull(D[R][0].x)){var ja=new a.lbs.DefaultGCResult(b[R].id,D[R]);ea.push(ja)}R=a.lbs.Geocoder.STATUS_OK;a.util.Logger.fine("","OM.Geocoder.batchGeoCode","gc batch response\x3d"+D);a.notNull(c)&&c(ea,R)}};var D=function(b,c,F){"abort"!==F&&(c="URL: "+ja,F&&
(c+="\nError: "+F),b&&b.responseText&&(c+="\nResponse : "+b.responseText),a.util.Logger.warning("MAPVIEWER_9014","OM.lbs.Geocoder.geocode",c))},ea=a.util.HttpRequest,F={xml_request:F,format:"xml"},ja;a.gv.proxyEnabled?(ja=this.geocoderUrl,ea.send(ja,F,R,"text",D,!0,!0)):(F.format="JSON",ja=this.elocationLbsUrl,a.util.HttpRequest.sendAsScripts(ja,F,MVXMLHttpRequest.callBack,"JSON",!0))},reverseGeocode:function(b,c,R){b=this.wrapLatLon2Xml(b,c);this.send_geocode(a.lbs.MetaData.DefaultAddressId,b,R)},
reverseGeocodePoint:function(b,c){if(!a.isNull(b)){var R=this,D=b.getSRID();8307===D||4326===D?this.reverseGeocode(b.getX(),b.getY(),c):b.transform(8307,function(a){R.reverseGeocode(a.getX(),a.getY(),c)})}},send_geocode:function(b,c,R){var D=this.wrapRequests(c);c=function(c){var F=a.lbs.Geocoder.STATUS_FAILED;c=new a.lbs.DefaultGCResult(b,c);F=a.lbs.Geocoder.STATUS_OK;a.notNull(R)&&R(c,F)};var F=this;MVXMLHttpRequest={callBack:function(b,c){c=F.parseJson(c);var T=a.lbs.Geocoder.STATUS_FAILED,D=new a.lbs.DefaultGCResult(b,
c),T=a.lbs.Geocoder.STATUS_OK;a.notNull(R)&&R(D,T)}};var U=function(b,c,F){"abort"!==F&&(c="URL: "+ja,F&&(c+="\nError: "+F),b&&b.responseText&&(c+="\nResponse : "+b.responseText),a.util.Logger.warning("MAPVIEWER_9014","OM.lbs.Geocoder.geocode",c))},ea=a.util.HttpRequest,D={xml_request:D,format:"xml"},ja;a.gv.proxyEnabled?(ja=this.geocoderUrl,ea.send(ja,D,c,"text",U,!0,!0)):(D.format="JSON",ja=this.elocationLbsUrl,a.util.HttpRequest.sendAsScripts(ja,D,MVXMLHttpRequest.callBack,"JSON",!0))},wrapAddress2Xml:function(b){return b instanceof
a.lbs.Address?b.toXmlString():(new a.lbs.Address(b)).toXmlString()},wrapLatLon2Xml:function(a,b){var c;c="\x3cinput_location "+('longitude\x3d"'+a+'" ')+('latitude\x3d"'+b+'"');return c+="/\x3e"},wrapRequests:function(a){var b;b='\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e\n\x3cgeocode_request vendor\x3d"oracle"\x3e\n\x3caddress_list\x3e\n';b+=a;b+="\x3c/address_list\x3e\n";return b+="\x3c/geocode_request\x3e"}});a.lbs.Geocoder.MATCH_MODE_EXACT="EXACT";a.lbs.Geocoder.MATCH_MODE_RELAX_STREET_TYPE=
"RELAX_STREET_TYPE";a.lbs.Geocoder.MATCH_MODE_RELAX_POI_NAME="RELAX_POI_NAME";a.lbs.Geocoder.MATCH_MODE_RELAX_HOUSE_NUMBER="RELAX_HOUSE_NUMBER";a.lbs.Geocoder.MATCH_MODE_RELAX_BASE_NAME="RELAX_BASE_NAME";a.lbs.Geocoder.MATCH_MODE_RELAX_POSTAL_CODE="RELAX_POSTAL_CODE";a.lbs.Geocoder.MATCH_MODE_RELAX_BUILTUP_AREA="RELAX_BUILTUP_AREA";a.lbs.Geocoder.MATCH_MODE_RELAX_ALL="RELAX_ALL";a.lbs.Geocoder.MATCH_MODE_DEFAULT="RELAX_POSTAL_CODE";a.lbs.Geocoder.STATUS_FAILED=0;a.lbs.Geocoder.STATUS_OK=1})(a);(function(a){a.lbs.Address=
a.Class.extend({initialize:function(b){this.id=a.lbs.MetaData.DefaultAddressId;this.address="";this.country="US";this.matchMode=a.lbs.Geocoder.MATCH_MODE_DEFAULT;b&&(b.id&&(this.id=b.id),b.address&&(this.address=b.address),b.country&&(this.country=b.country),b.matchMode&&(this.matchMode=b.matchMode))},toXmlString:function(){for(var a="",b=this.address.split(","),a=a+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cunformatted country\x3d"'+this.country+
'"\x3e'),c=0;c<b.length;c++)a+='\x3caddress_line value \x3d"'+b[c]+'"/\x3e';return a+"\x3c/unformatted\x3e\x3c/input_address\x3e\x3c/input_location\x3e"},getStreetLine:function(b){if(!b.houseNumber)return b.street?b.street:null;var c=b.country;return a.isNull(c)||"US"==c||"AD"==c||"AU"==c||"CA"==c||"FR"==c||"GB"==c||"IE"==c||"LU"==c||"MC"==c||"NZ"==c||"PR"==c?b.houseNumber+" "+b.street:b.street+" "+b.houseNumber},getLocalityLine:function(b){var c=b.country,R=!1;!a.notNull(c)||"AT"!=c&&"BE"!=c&&"DK"!=
c&&"FI"!=c&&"FR"!=c&&"DE"!=c&&"IT"!=c&&"LI"!=c&&"LU"!=c&&"MC"!=c&&"NL"!=c&&"NO"!=c&&"PT"!=c&&"SM"!=c&&"ES"!=c&&"SE"!=c&&"CH"!=c||(R=!0);var D=!1;if(a.isNull(c)||"US"==c||"AU"==c||"CA"==c)D=!0;c="";b.settlement&&(c+=b.settlement);b.municipality&&b.municipality!=b.settlement&&(c+=(0<c.length?", ":"")+b.municipality);D&&b.region&&(c+=(0<c.length?", ":"")+b.region);a.notNull(b.postalCode)&&(c=R?b.postalCode+" "+c:c+" "+b.postalCode);return""===c?null:c}})})(a);(function(a){a.lbs.GdfFormAddress=a.lbs.Address.extend({initialize:function T(a){T.base.call(this,
a);this.postalAddonCode=this.postalCode=this.order1Area=this.order2Area=this.order8Area=this.builtupArea=this.intersectingStreet=this.street=this.name="";this.country="US";a&&(this.name=a.name,this.street=a.street,this.intersectingStreet=a.intersectingStreet,this.builtupArea=a.builtupArea,this.order8Area=a.order8Area,this.order2Area=a.order2Area,this.order1Area=a.order1Area,this.postalCode=a.postalCode,this.postalAddonCode=a.postalAddonCode,a.country&&(this.country=a.country))},toXmlString:function(){var a;
a=""+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cgdf_form ');this.name&&(a+='name \x3d"'+this.name+'" ');this.street&&(a+='street \x3d"'+this.street+'" ');this.intersectingStreet&&(a+='intersecting_street \x3d"'+this.intersectingStreet+'" ');this.builtupArea&&(a+='builtup_area \x3d"'+this.builtupArea+'" ');this.order8Area&&(a+='order8_area \x3d"'+this.order8Area+'" ');this.order2Area&&(a+='order2_area \x3d"'+this.order2Area+'" ');this.order1Area&&
(a+='order1_area \x3d"'+this.order1Area+'" ');this.country&&(a+='country \x3d"'+this.country+'" ');this.postalCode&&(a+='postal_code \x3d"'+this.postalCode+'" ');this.postalAddonCode&&(a+='postal_addon_code \x3d"'+this.postalAddonCode+'" ');return a+"/\x3e\x3c/input_address\x3e\x3c/input_location\x3e"}})})(a);(function(a){a.lbs.GenFormAddress=a.lbs.Address.extend({initialize:function T(a){T.base.call(this,a);this.postalAddonCode=this.postalCode=this.region=this.city=this.subArea=this.intersectingStreet=
this.street=this.name="";this.country="US";a&&(this.name=a.name,this.street=a.street,this.intersectingStreet=a.intersectingStreet,this.subArea=a.subArea,this.city=a.city,this.region=a.region,this.postalCode=a.postalCode,this.postalAddonCode=a.postalAddonCode,a.country&&(this.country=a.country))},toXmlString:function(){var a;a=""+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cgen_form ');this.name&&(a+='name \x3d"'+this.name+'" ');this.street&&
(a+='street \x3d"'+this.street+'" ');this.intersectingStreet&&(a+='intersecting_street \x3d"'+this.intersectingStreet+'" ');this.subArea&&(a+='sub_area \x3d"'+this.subArea+'" ');this.city&&(a+='city \x3d"'+this.city+'" ');this.region&&(a+='region \x3d"'+this.region+'" ');this.country&&(a+='country \x3d"'+this.country+'" ');this.postalCode&&(a+='postal_code \x3d"'+this.postalCode+'" ');this.postalAddonCode&&(a+='postal_addon_code \x3d"'+this.postalAddonCode+'" ');return a+"/\x3e\x3c/input_address\x3e\x3c/input_location\x3e"}})})(a);
(function(a){a.lbs.USForm1Address=a.lbs.Address.extend({initialize:function T(a){T.base.call(this,a);this.lastline=this.intersectingStreet=this.street=this.name="";a&&(this.name=a.name,this.street=a.street,this.intersectingStreet=a.intersectingStreet,this.lastline=a.lastline)},toXmlString:function(){var a;a=""+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cus_form1 ');this.name&&(a+='name \x3d"'+this.name+'" ');this.street&&(a+='street \x3d"'+
this.street+'" ');this.intersectingStreet&&(a+='intersecting_street \x3d"'+this.intersectingStreet+'" ');this.lastline&&(a+='lastline \x3d"'+this.lastline+'" ');return a+"/\x3e\x3c/input_address\x3e\x3c/input_location\x3e"}})})(a);(function(a){a.lbs.USForm2Address=a.lbs.Address.extend({initialize:function T(a){T.base.call(this,a);this.zipCode=this.state=this.city=this.intersectingStreet=this.street=this.name="";a&&(this.name=a.name,this.street=a.street,this.intersectingStreet=a.intersectingStreet,
this.city=a.city,this.state=a.state,this.zipCode=a.zipCode)},toXmlString:function(){var a;a=""+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cus_form2 ');this.name&&(a+='name \x3d"'+this.name+'" ');this.street&&(a+='street \x3d"'+this.street+'" ');this.intersectingStreet&&(a+='intersecting_street \x3d"'+this.intersectingStreet+'" ');this.city&&(a+='city \x3d"'+this.city+'" ');this.state&&(a+='state \x3d"'+this.state+'" ');this.zipCode&&(a+=
'zip_code \x3d"'+this.zipCode+'" ');return a+"/\x3e\x3c/input_address\x3e\x3c/input_location\x3e"}})})(a);(function(a){a.lbs.UnformatedAddress=a.lbs.Address.extend({initialize:function(b){this.id=a.lbs.MetaData.DefaultAddressId;this.address="";this.country="US";this.matchMode="relax_street_type";b&&(b.id&&(this.id=b.id),b.address&&(this.address=b.address),b.country&&(this.country=b.country),b.matchMode&&(this.matchMode=b.matchMode))},toXmlString:function(){for(var a="",b=this.address.split(","),a=
a+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cunformatted country\x3d"'+this.country+'"\x3e'),c=0;c<b.length;c++)a+='\x3caddress_line value \x3d"'+b[c]+'"/\x3e';return a+"\x3c/unformatted\x3e\x3c/input_address\x3e\x3c/input_location\x3e"}})})(a);a.edit.EditChangeEvent=a.Class.extend({initialize:function(b){var c=a.edit.EditChangeEvent;this.eventType=c.NO_EVENT;this.updateType=c.NO_UPDATE;this.oldChange=this.currentChange=this.feature=this.key=
null;this.isModifiedFeature=this.isNewFeature=!1;a.notNull(b)&&(a.notNull(b.eventType)&&(this.eventType=b.eventType),a.notNull(b.updateType)&&(this.updateType=b.updateType),a.notNull(b.key)&&(this.key=b.key),a.notNull(b.feature)&&(this.feature=b.feature),a.notNull(b.currentChange)&&(this.currentChange=b.currentChange),a.notNull(b.oldChange)&&(this.oldChange=b.oldChange),a.notNull(b.isNewFeature)&&(this.isNewFeature=b.isNewFeature),a.notNull(b.isModifiedFeature)&&(this.isModifiedFeature=b.isModifiedFeature))},
getEventType:function(){return this.eventType},getUpdateType:function(){return this.updateType},getKey:function(){return this.key},getFeature:function(){return this.feature},getCurrentChange:function(){return this.currentChange},getOldChange:function(){return this.oldChange},isNewFeature:function(){return this.isNewFeature},isModifiedFeature:function(){return this.isModifiedFeature}});a.edit.EditChangeEvent.NO_EVENT=0;a.edit.EditChangeEvent.NEW_EVENT=1;a.edit.EditChangeEvent.UPDATE_EVENT=2;a.edit.EditChangeEvent.REMOVE_EVENT=
3;a.edit.EditChangeEvent.NO_UPDATE=0;a.edit.EditChangeEvent.SPATIAL_UPDATE=1;a.edit.EditChangeEvent.ATTRIBUTE_UPDATE=2;a.edit.EditChangeManager=a.Class.extend({initialize:function(b){this.layer=a.notNull(b)?b.layer:null;this.newFeatures={};this.removedFeatures={};this.modifiedFeatures={};this.updateChanges={}},addFeature:function(b,c){if(a.isNull(this.layer)||a.isNull(b)||a.isNull(c))return null;this.layer.addFeature(c);this.newFeatures[b]=c;var T=a.edit.EditChangeEvent;return new a.edit.EditChangeEvent({eventType:T.NEW_EVENT,
updateType:T.NO_UPDATE,key:b,feature:c,currentChange:c,oldChange:null,isNewFeature:!0,isModifiedFeature:!1})},removeFeature:function(b,c){if(a.isNull(this.layer)||a.isNull(b)||a.isNull(c))return null;this.layer.removeFeature(c);var T=!1,R=!1;a.notNull(this.newFeatures[b])?(T=!0,delete this.newFeatures[b]):(this.removedFeatures[b]=c,a.notNull(this.modifiedFeatures[b])&&(delete this.modifiedFeatures[b],R=!0));var D=a.edit.EditChangeEvent;return new a.edit.EditChangeEvent({eventType:D.REMOVE_EVENT,updateType:D.NO_UPDATE,
key:b,feature:c,currentChange:null,oldChange:c,isNewFeature:T,isModifiedFeature:R})},updateFeature:function(b,c,T,R){if(a.isNull(this.layer)||a.isNull(b))return null;var D=null,F=a.edit.EditChangeEvent;if(R===F.SPATIAL_UPDATE)D=c.geo,c.geo=T;else if(R===F.ATTRIBUTE_UPDATE){if(D={},a.notNull(T))for(var U in T)T.hasOwnProperty(U)&&(D[U]=c.getAttributeValue(U),a.isNull(c.attributes)&&(c.attributes={}),c.attributes[U]=T[U])}else return null;var ea=!1;U=!1;a.isNull(this.newFeatures[b])?(a.notNull(this.modifiedFeatures[b])&&
(U=!0),this.modifiedFeatures[b]=c):(ea=!0,this.newFeatures[b]=c);U=new a.edit.EditChangeEvent({eventType:F.UPDATE_EVENT,updateType:R,key:b,feature:c,currentChange:T,oldChange:D,isNewFeature:ea,isModifiedFeature:U});!1===ea&&(ea=this.updateChanges[b],a.isNull(ea)&&(ea=[],this.updateChanges[b]=ea),ea.push(U));a.notNull(this.layer.rtree)&&R===F.SPATIAL_UPDATE&&(a.notNull(D)&&(b=D.getMBR(),a.notNull(b)&&(this.layer.removeFromRtree(c),delete this.layer.segmentRtree[c.id])),a.notNull(T)&&(T=T.getMBR(),
a.notNull(T)&&this.layer.addToRtree(c)));return U},getNewFeatures:function(){var a=[],b;for(b in this.newFeatures)this.newFeatures.hasOwnProperty(b)&&a.push(this.newFeatures[b]);return a},getRemovedFeatures:function(){var a=[],b;for(b in this.removedFeatures)this.removedFeatures.hasOwnProperty(b)&&a.push(this.removedFeatures[b]);return a},getModifiedFeatures:function(){var a=[],b;for(b in this.modifiedFeatures)this.modifiedFeatures.hasOwnProperty(b)&&a.push(this.modifiedFeatures[b]);return a},hasChanges:function(){for(var a in this.newFeatures)if(this.newFeatures.hasOwnProperty(a))return!0;
for(a in this.removedFeatures)if(this.removedFeatures.hasOwnProperty(a))return!0;for(a in this.modifiedFeatures)if(this.modifiedFeatures.hasOwnProperty(a))return!0;return!1},hasSpatialAttributeChanged:function(b){if(a.isNull(b)||a.isNull(this.modifiedFeatures[b]))return!1;b=this.updateChanges[b];if(a.isNull(b))return!1;for(var c=a.edit.EditChangeEvent,T=b.length,R=0;R<T;R++)if(b[R].getUpdateType()===c.SPATIAL_UPDATE)return!0;return!1},getChangedAttributesOfModifiedFeature:function(b){if(a.isNull(b))return null;
if(a.isNull(this.modifiedFeatures[b]))return!1;b=this.updateChanges[b];if(a.isNull(b))return!1;for(var c=[],T=a.edit.EditChangeEvent,R=b.length,D=0;D<R;D++)if(b[D].getUpdateType()===T.ATTRIBUTE_UPDATE){var F=b[D].getCurrentChange();if(!a.isNull(F))for(var U in F)if(F.hasOwnProperty(U)){for(var ea=!1,ja=0;ja<c.length;ja++)if(c[ja]==U){ea=!0;break}!1===ea&&c.push(U)}}return c},undo:function(b){if(!a.isNull(b)){var c=b.key,T=b.eventType,R=a.edit.EditChangeEvent;if(T===R.NEW_EVENT)this.layer.removeFeature(b.currentChange),
delete this.newFeatures[c],a.notNull(this.layer.rtree)&&a.notNull(b.currentChange.geo)&&(c=b.currentChange.geo.getMBR(),a.notNull(c)&&(this.layer.removeFromRtree(b.currentChange),delete this.layer.segmentRtree[b.currentChange.id]));else if(T===R.UPDATE_EVENT){T=b.updateType;if(T===R.SPATIAL_UPDATE){if(a.isNull(b.feature))return;b.feature.setGeometry(b.oldChange)}else if(T===R.ATTRIBUTE_UPDATE&&a.notNull(b.oldChange))for(var D in b.oldChange)b.oldChange.hasOwnProperty(D)&&(b.feature.attributes[D]=
b.oldChange[D]);!1===b.isNewFeature&&(D=this.updateChanges[c],a.notNull(D)&&0<D.length&&(D.pop(),0===D.length&&delete this.updateChanges[c]),!1===b.isModifiedFeature&&delete this.modifiedFeatures[c]);a.notNull(this.layer.rtree)&&T===R.SPATIAL_UPDATE&&(a.notNull(b.currentChange)&&(c=b.currentChange.getMBR(),a.notNull(c)&&(this.layer.removeFromRtree(b.feature),delete this.layer.segmentRtree[b.feature.id])),a.notNull(b.oldChange)&&(c=b.oldChange.getMBR(),a.notNull(c)&&this.layer.addToRtree(b.feature)))}else T===
R.REMOVE_EVENT&&(this.layer.addFeature(b.oldChange),!1===b.isNewFeature?(delete this.removedFeatures[c],!0===b.isModifiedFeature&&(this.modifiedFeatures[c]=b.oldChange)):this.newFeatures[c]=b.oldChange,a.notNull(this.layer.rtree)&&a.notNull(b.oldChange.geo)&&(c=b.oldChange.geo.getMBR(),a.notNull(c)&&this.layer.addToRtree(b.oldChange)))}},redo:function(b){if(!a.isNull(b)){var c=b.key,T=b.eventType,R=a.edit.EditChangeEvent;if(T===R.NEW_EVENT)this.layer.addFeature(b.currentChange),this.newFeatures[c]=
b.currentChange,a.notNull(this.layer.rtree)&&a.notNull(b.currentChange.geo)&&(c=b.currentChange.geo.getMBR(),a.notNull(c)&&this.layer.addToRtree(b.currentChange));else if(T===R.UPDATE_EVENT){T=b.updateType;if(T===R.SPATIAL_UPDATE){if(a.isNull(b.feature))return;b.feature.setGeometry(b.currentChange)}else if(T===R.ATTRIBUTE_UPDATE&&a.notNull(b.currentChange))for(var D in b.currentChange)b.currentChange.hasOwnProperty(D)&&(b.feature.attributes[D]=b.currentChange[D]);!1===b.isNewFeature&&(D=this.updateChanges[c],
a.isNull(D)&&(D=[],this.updateChanges[c]=D),D.push(b),!1===b.isModifiedFeature&&(this.modifiedFeatures[c]=b.feature));a.notNull(this.layer.rtree)&&T===R.SPATIAL_UPDATE&&(a.notNull(b.oldChange)&&(c=b.oldChange.getMBR(),a.notNull(c)&&(this.layer.removeFromRtree(b.feature),delete this.layer.segmentRtree[b.feature.id])),a.notNull(b.currentChange)&&(c=b.currentChange.getMBR(),a.notNull(c)&&this.layer.addToRtree(b.feature)))}else T===R.REMOVE_EVENT&&(this.layer.removeFeature(b.oldChange),!1===b.isNewFeature?
(this.removedFeatures[c]=b.oldChange,!0===b.isModifiedFeature&&delete this.modifiedFeatures[c]):delete this.newFeatures[c],a.notNull(this.layer.rtree)&&a.notNull(b.oldChange.geo)&&(c=b.oldChange.geo.getMBR(),a.notNull(c)&&(this.layer.removeFromRtree(b.oldChange),delete this.layer.segmentRtree[b.oldChange.id])))}},clearChanges:function(){this.newFeatures={};this.removedFeatures={};this.modifiedFeatures={};this.updateChanges={}},isNewFeature:function(b){return a.isNotNull(this.newFeatures[b])?!0:!1},
isRemovedFeature:function(b){return a.isNotNull(this.removedFeatures[b])?!0:!1},isModifiedFeature:function(b){return a.isNotNull(this.modifiedFeatures[b])?!0:!1}});a.edit.GeometrySegment=a.Class.extend({initialize:function(b){var c=a.edit.GeometrySegment;this.subElemIndex=this.elemIndex=this.segIndex=-1;this.segType=c.UNDEFINED_TYPE;a.notNull(b)&&(a.notNull(b.segIndex)&&(this.segIndex=b.segIndex),a.notNull(b.elemIndex)&&(this.elemIndex=b.elemIndex),a.notNull(b.subElemIndex)&&(this.subElemIndex=b.subElemIndex),
a.notNull(b.segType)&&(this.segType=b.segType))},getSegmentIndex:function(){return this.segIndex},setSegmentIndex:function(a){this.segIndex=a},getElementIndex:function(){return this.elemIndex},setElementIndex:function(a){this.elemIndex=a},getSubElementIndex:function(){return this.subElemIndex},setSubElementIndex:function(a){this.subElemIndex=a},getSegmentType:function(){return this.segType},setSegmentType:function(a){this.segType=a}});a.edit.GeometrySegment.UNDEFINED_TYPE=0;a.edit.GeometrySegment.POINT_TYPE=
1;a.edit.GeometrySegment.LINE_TYPE=2;a.edit.GeometrySegment.RECTANGLE_TYPE=3;a.edit.GeometrySegment.ARC_TYPE=4;a.edit.GeometrySegment.CIRCLE_TYPE=5;a.edit.GeometrySegmentPoint=a.Class.extend({initialize:function(b){var c=a.edit.GeometrySegmentPoint;this.point=this.segment=this.feature=null;this.pointLocation=c.UNDEFSEG_POINT;a.notNull(b)&&(a.notNull(b.feature)&&(this.feature=b.feature),a.notNull(b.segment)&&(this.segment=b.segment),a.notNull(b.point)&&(this.point=b.point),a.notNull(b.pointLocation)&&
(this.pointLocation=b.pointLocation))},getFeature:function(){return this.feature},setFeature:function(a){this.feature=a},getGeometrySegment:function(){return this.segment},setGeometrySegment:function(a){this.segment=a},getPoint:function(){return this.point},setPoint:function(a){this.point=a},getPointLocation:function(){return this.pointLocation},setPointLocation:function(a){this.pointLocation=a}});a.edit.GeometrySegmentPoint.UNDEFSEG_POINT=-1;a.edit.GeometrySegmentPoint.STARTSEG_POINT=0;a.edit.GeometrySegmentPoint.ENDSEG_POINT=
1;a.edit.GeometrySegmentPoint.MIDSEG_POINT=2;a.edit.GeometrySegmentUtil=a.edit.GeometrySegmentUtil||{};a.edit.GeometrySegmentUtil.buildSegmentTree=function(b){if(a.isNull(b))return null;var c=b.getGeometry();if(a.isNull(c))return null;b=new a.RTree(10);var T=c.getType(),R=a.edit.GeometrySegment,D=c.getMBR();if(a.isNull(D))return null;var F={x:D.minX,y:D.minY,w:D.maxX-D.minX,h:D.maxY-D.minY},D=c.getDimension();switch(T){case "Point":case "OrientedPoint":case "Rectangle":c=new a.edit.GeometrySegment;
c.setElementIndex(0);c.setSegmentIndex(0);c.setSubElementIndex(0);"Point"===T||"OrientedPoint"===T?c.setSegmentType(R.POINT_TYPE):c.setSegmentType(R.RECTANGLE_TYPE);b.insert(F,c);break;case "MultiPoint":case "OrientedMultiPoint":for(var F=c.coordinates.length,U=0;U<F;U++){var ea={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY},ea="MultiPoint"===T?a.geometry.Geometry.getCoordsMBR(c.coordinates[U],D,ea):a.geometry.Geometry.getCoordsMBR([c.coordinates[U][0],
c.coordinates[U][1]],D,ea),ja=new a.edit.GeometrySegment;ja.setElementIndex(U);ja.setSegmentIndex(0);ja.setSubElementIndex(0);ja.setSegmentType(R.POINT_TYPE);b.insert({x:ea.minX,y:ea.minY,w:ea.maxX-ea.minX,h:ea.maxY-ea.minY},ja)}break;case "LineString":T=c.coordinates.length;for(U=F=0;U<T-D;U+=D){var ja=ea=Number.POSITIVE_INFINITY,ra=Number.NEGATIVE_INFINITY,Ea=Number.NEGATIVE_INFINITY,Ha=new a.edit.GeometrySegment;Ha.setElementIndex(0);Ha.setSegmentIndex(F++);Ha.setSubElementIndex(0);Ha.setSegmentType(R.LINE_TYPE);
ea=Math.min(c.coordinates[U],c.coordinates[U+D]);ra=Math.max(c.coordinates[U],c.coordinates[U+D]);ja=Math.min(c.coordinates[U+1],c.coordinates[U+1+D]);Ea=Math.max(c.coordinates[U+1],c.coordinates[U+1+D]);b.insert({x:ea,y:ja,w:ra-ea,h:Ea-ja},Ha)}break;case "MultiLineString":T=c.coordinates.length;for(F=0;F<T;F++)for(U=c.coordinates[F].length,ja=ea=0;ja<U-D;ja+=D){var Ea=ra=Number.POSITIVE_INFINITY,Ka=Ha=Number.NEGATIVE_INFINITY,Ra=new a.edit.GeometrySegment;Ra.setElementIndex(F);Ra.setSegmentIndex(ea++);
Ra.setSubElementIndex(0);Ra.setSegmentType(R.LINE_TYPE);ra=Math.min(c.coordinates[F][ja],c.coordinates[F][ja+D]);Ha=Math.max(c.coordinates[F][ja],c.coordinates[F][ja+D]);Ea=Math.min(c.coordinates[F][ja+1],c.coordinates[F][ja+1+D]);Ka=Math.max(c.coordinates[F][ja+1],c.coordinates[F][ja+1+D]);b.insert({x:ra,y:Ea,w:Ha-ra,h:Ka-Ea},Ra)}break;case "Polygon":T=c.coordinates.length;for(F=0;F<T;F++)for(U=c.coordinates[F].length,ja=ea=0;ja<U-D;ja+=D)Ea=ra=Number.POSITIVE_INFINITY,Ka=Ha=Number.NEGATIVE_INFINITY,
Ra=new a.edit.GeometrySegment,Ra.setElementIndex(0),Ra.setSegmentIndex(ea++),Ra.setSubElementIndex(F),Ra.setSegmentType(R.LINE_TYPE),ra=Math.min(c.coordinates[F][ja],c.coordinates[F][ja+D]),Ha=Math.max(c.coordinates[F][ja],c.coordinates[F][ja+D]),Ea=Math.min(c.coordinates[F][ja+1],c.coordinates[F][ja+1+D]),Ka=Math.max(c.coordinates[F][ja+1],c.coordinates[F][ja+1+D]),b.insert({x:ra,y:Ea,w:Ha-ra,h:Ka-Ea},Ra);break;case "MultiPolygon":for(T=c.coordinates.length,F=0;F<T;F++)for(U=c.coordinates[F].length,
ea=0;ea<U;ea++)for(ja=c.coordinates[F][ea].length,Ea=ra=0;Ea<ja-D;Ea+=D){var Ka=Ha=Number.POSITIVE_INFINITY,ib=Ra=Number.NEGATIVE_INFINITY,fb=new a.edit.GeometrySegment;fb.setElementIndex(F);fb.setSegmentIndex(ra++);fb.setSubElementIndex(ea);fb.setSegmentType(R.LINE_TYPE);Ha=Math.min(c.coordinates[F][ea][Ea],c.coordinates[F][ea][Ea+D]);Ra=Math.max(c.coordinates[F][ea][Ea],c.coordinates[F][ea][Ea+D]);Ka=Math.min(c.coordinates[F][ea][Ea+1],c.coordinates[F][ea][Ea+1+D]);ib=Math.max(c.coordinates[F][ea][Ea+
1],c.coordinates[F][ea][Ea+1+D]);b.insert({x:Ha,y:Ka,w:Ra-Ha,h:ib-Ka},fb)}}return b};a.edit.GeometrySegmentUtil.getFeatureSegmentPoint=function(b,c,T,R,D,F,U,ea){if(a.isNull(b)||a.isNull(b.getGeometry()))return null;var ja=null,ja=a.isNull(c)?a.edit.GeometrySegmentUtil.buildSegmentTree(b):c;if(a.isNull(ja))return null;c={x:T[0]-R,y:T[1]-R,w:2*R,h:2*R};a.isNull(D)&&(D=!1);a.isNull(ea)&&(ea=!1);a.isNull(U)&&(U=!1);a.isNull(F);var ra=ja.search(c);if(a.isNull(ra)||0===ra.length)return null;var Ea=a.edit.GeometrySegment,
Ha=a.edit.GeometrySegmentPoint;c=ja=F=null;for(var Ka,Ra,ib,fb=Number.MAX_VALUE,bb=b.getGeometry(),qb=bb.getDimension(),$a=0;$a<ra.length;$a++){var hb=ra[$a];if(hb.getSegmentType()===Ea.POINT_TYPE)!1!==D&&(Ka=bb.getX()-T[0],Ra=bb.getY()-T[1],ib=Math.sqrt(Ka*Ka+Ra*Ra),ib<=R&&ib<fb&&(fb=ib,F=hb,ja=[bb.getX(),bb.getY()],c=Ha.STARTSEG_POINT));else if(hb.getSegmentType()===Ea.LINE_TYPE){Ka=hb.getElementIndex();Ra=hb.getSegmentIndex();var wb=hb.getSubElementIndex(),Kb=ib=0,Lb=0,Mb=0;if("Polygon"===bb.getType())ib=
bb.coordinates[wb][Ra*qb],Kb=bb.coordinates[wb][Ra*qb+1],Lb=bb.coordinates[wb][Ra*qb+qb],Mb=bb.coordinates[wb][Ra*qb+qb+1];else if("MultiPolygon"===bb.getType())ib=bb.coordinates[Ka][wb][Ra*qb],Kb=bb.coordinates[Ka][wb][Ra*qb+1],Lb=bb.coordinates[Ka][wb][Ra*qb+qb],Mb=bb.coordinates[Ka][wb][Ra*qb+qb+1];else if("LineString"===bb.getType())ib=bb.coordinates[Ra*qb],Kb=bb.coordinates[Ra*qb+1],Lb=bb.coordinates[Ra*qb+qb],Mb=bb.coordinates[Ra*qb+qb+1];else if("MultiLineString"===bb.getType())ib=bb.coordinates[Ka][Ra*
qb],Kb=bb.coordinates[Ka][Ra*qb+1],Lb=bb.coordinates[Ka][Ra*qb+qb],Mb=bb.coordinates[Ka][Ra*qb+qb+1];else continue;Ka=a.util.GeomUtil.distanceToSegment(T[0],T[1],ib,Kb,Lb,Mb);a.notNull(Ka)&&Ka[0]<=R&&(fb=Ka[0],F=hb,c=Math.floor(Ka[1]),0===c?ja=[ib,Kb]:1===c?ja=[Lb,Mb]:(ja=a.util.GeomUtil.getSegmentPoint(T[0],T[1],ib,Kb,Lb,Mb),c=Ha.MIDSEG_POINT,a.notNull(ja)&&(Ka=ja[0]-ib,Ra=ja[1]-Kb,Math.sqrt(Ka*Ka+Ra*Ra)<=R?(ja=[ib,Kb],c=Ha.STARTSEG_POINT):(Ka=ja[0]-Lb,Ra=ja[1]-Mb,Math.sqrt(Ka*Ka+Ra*Ra)<=R&&(ja=
[Lb,Mb],c=Ha.ENDSEG_POINT)))))}else hb.getSegmentType()===Ea.ARC_TYPE&&ea||hb.getSegmentType()===Ea.CIRCLE_TYPE&&U||hb.getSegmentType()}if(a.isNull(F))return null;T=new a.edit.GeometrySegmentPoint;T.feature=b;T.segment=F;T.point=ja;T.pointLocation=c;return T};a.edit.GeometrySegmentUtil.getLayerSegmentPoint=function(b,c,T,R,D,F,U){if(a.isNull(b)||a.isNull(c)||a.isNull(T))return null;var ea=b.searchFeatures({x:c[0]-T,y:c[1]-T,w:2*T,h:2*T});if(a.isNull(ea)||0===ea.length)return null;for(var ja=Number.MAX_VALUE,
ra=null,Ea=0;Ea<ea.length;Ea++){var Ha=b.segmentRtree[ea[Ea].id];if(a.isNull(Ha))if(Ha=a.edit.GeometrySegmentUtil.buildSegmentTree(ea[Ea]),a.isNull(Ha))continue;else b.segmentRtree[ea[Ea].id]=Ha;Ha=a.edit.GeometrySegmentUtil.getFeatureSegmentPoint(ea[Ea],Ha,c,T,R,U,F,D);if(!a.isNull(Ha)){var Ka=Ha.getPoint();if(null!==Ka){var Ra=c[0]-Ka[0],Ka=c[1]-Ka[1],Ra=Math.sqrt(Ra*Ra+Ka*Ka);Ra<ja&&(ja=Ra,ra=Ha)}}}return ra};a.edit.GeometrySegmentUtil.getLayerSegmentPoints=function(b,c,T,R,D,F,U){if(a.isNull(b)||
a.isNull(c)||a.isNull(T))return null;var ea=b.searchFeatures({x:c[0]-T,y:c[1]-T,w:2*T,h:2*T});if(a.isNull(ea)||0===ea.length)return null;for(var ja=[],ra=0;ra<ea.length;ra++){var Ea=b.segmentRtree[ea[ra].id];if(a.isNull(Ea))if(Ea=a.edit.GeometrySegmentUtil.buildSegmentTree(ea[ra]),a.isNull(Ea))continue;else b.segmentRtree[ea[ra].id]=Ea;Ea=a.edit.GeometrySegmentUtil.getFeatureSegmentPoint(ea[ra],Ea,c,T,R,D,F,U);a.isNull(Ea)||ja.push(Ea)}return 0===ja.length?null:ja};a.edit.GeometrySegmentUtil.getFeatureSegmentPointsWithinBox=
function(b,c,T){if(a.isNull(b)||a.isNull(T)||a.isNull(b.getGeometry()))return null;var R=null,R=a.isNull(c)?a.edit.GeometrySegmentUtil.buildSegmentTree(b):c;if(a.isNull(R))return null;c=R.search(T);if(a.isNull(c)||0===c.length)return null;for(var R=a.edit.GeometrySegment,D=a.edit.GeometrySegmentPoint,F=b.getGeometry(),U=F.getDimension(),ea=[],ja={},ra=null,Ea=0;Ea<c.length;Ea++){var Ha=c[Ea],Ka=Ha.getElementIndex(),Ra=Ha.getSegmentIndex(),ib=Ha.getSubElementIndex();if(Ha.getSegmentType()===R.LINE_TYPE){var fb=
0,bb=0,qb=0,$a=0;if("Polygon"===F.getType())fb=F.coordinates[ib][Ra*U],bb=F.coordinates[ib][Ra*U+1],qb=F.coordinates[ib][Ra*U+U],$a=F.coordinates[ib][Ra*U+U+1];else if("MultiPolygon"===F.getType())fb=F.coordinates[Ka][ib][Ra*U],bb=F.coordinates[Ka][ib][Ra*U+1],qb=F.coordinates[Ka][ib][Ra*U+U],$a=F.coordinates[Ka][ib][Ra*U+U+1];else if("LineString"===F.getType())fb=F.coordinates[Ra*U],bb=F.coordinates[Ra*U+1],qb=F.coordinates[Ra*U+U],$a=F.coordinates[Ra*U+U+1];else if("MultiLineString"===F.getType())fb=
F.coordinates[Ka][Ra*U],bb=F.coordinates[Ka][Ra*U+1],qb=F.coordinates[Ka][Ra*U+U],$a=F.coordinates[Ka][Ra*U+U+1];else continue;ra=""+Ka+":"+(Ra-1)+":"+ib+":"+D.ENDSEG_POINT;a.util.GeomUtil.pointInRect(fb,bb,T.x,T.y,T.x+T.w,T.y+T.h)&&a.isNull(ja[ra])&&(ra=new a.edit.GeometrySegmentPoint,ra.feature=b,ra.segment=Ha,ra.point=[fb,bb],ra.pointLocation=D.STARTSEG_POINT,ea.push(ra),ja[""+Ka+":"+Ra+":"+ib+":"+D.STARTSEG_POINT]="*");ra=""+Ka+":"+(Ra+1)+":"+ib+":"+D.STARTSEG_POINT;a.util.GeomUtil.pointInRect(qb,
$a,T.x,T.y,T.x+T.w,T.y+T.h)&&a.isNull(ja[ra])&&(fb=new a.edit.GeometrySegmentPoint,fb.feature=b,fb.segment=Ha,fb.point=[qb,$a],fb.pointLocation=D.ENDSEG_POINT,ea.push(fb),ja[""+Ka+":"+Ra+":"+ib+":"+D.ENDSEG_POINT]="*")}}return 0===ea.length?null:ea};a.edit.GeometrySegmentUtil.getLayerSegmentPointsWithinBox=function(b,c){if(a.isNull(b)||a.isNull(c))return null;var T=b.searchFeatures(c);if(a.isNull(T)||0===T.length)return null;for(var R={},D=0;D<T.length;D++){var F=[],U=b.segmentRtree[T[D].id];if(a.isNull(U))if(U=
a.edit.GeometrySegmentUtil.buildSegmentTree(T[D]),a.isNull(U))continue;else b.segmentRtree[T[D].id]=U;U=a.edit.GeometrySegmentUtil.getFeatureSegmentPointsWithinBox(T[D],U,c);if(!a.isNull(U)){for(var ea=0;ea<U.length;ea++)F.push(U[ea]);R[T[D].id]=F}}var T=!1,ja;for(ja in R)if(R.hasOwnProperty(ja)){T=!0;break}return T?R:null};a.edit.GeometrySegmentUtil.removeVertexFromGeometry=function(b,c){if(a.isNull(b)||a.isNull(c))return!1;var T=b.getType();if("Point"===T||"MultiPoint"===T||"OrientedPoint"===T)return!1;
var R=b.getOrdinates();if(a.isNull(R))return!1;var D=c.getGeometrySegment(),F=c.getPoint(),U=c.getPointLocation();if(a.isNull(D)||a.isNull(F))return!1;var F=a.edit.GeometrySegment,ea=a.edit.GeometrySegmentPoint;if(D.getSegmentType()!==F.LINE_TYPE||U===ea.MIDSEG_POINT)return!1;var F=D.getElementIndex(),ja=D.getSegmentIndex(),D=D.getSubElementIndex(),ea=b.getDimension(),U=ja*ea+U*ea,ja=0;switch(T){case "LineString":ja=R.length/ea;if(3>ja)return!1;R.splice(U,ea);break;case "MultiLineString":ja=R[F].length/
ea;if(3>ja)return!1;R[F].splice(U,ea);break;case "Polygon":ja=R[D].length/ea;if(5>ja)return!1;R[D].splice(U,ea);break;case "MultiPolygon":ja=R[F][D].length/ea;if(5>ja)return!1;R[F][D].splice(U,ea);break;default:return!1}b.mbr=null;b.getMBR();return!0};a.edit.GeometrySegmentUtil.addVertexToGeometry=function(b,c){if(a.isNull(b)||a.isNull(c))return!1;var T=b.getType();if("Point"===T||"MultiPoint"===T||"OrientedPoint"===T)return!1;var R=b.getOrdinates();if(a.isNull(R))return!1;var D=c.getGeometrySegment(),
F=c.getPoint(),U=c.getPointLocation();if(a.isNull(D)||a.isNull(F))return!1;var ea=a.edit.GeometrySegment,ja=a.edit.GeometrySegmentPoint;if(D.getSegmentType()!==ea.LINE_TYPE||U!==ja.MIDSEG_POINT)return!1;U=D.getElementIndex();ea=D.getSegmentIndex();ja=D.getSubElementIndex();D=b.getDimension();ea*=D;switch(T){case "LineString":for(T=0;T<D;T++)2>T?R.splice(ea+T+D,0,F[T]):R.splice(ea+T+D,0,0);break;case "MultiLineString":for(T=0;T<D;T++)2>T?R[U].splice(ea+T+D,0,F[T]):R[U].splice(ea+T+D,0,0);break;case "Polygon":for(T=
0;T<D;T++)2>T?R[ja].splice(ea+T+D,0,F[T]):R[ja].splice(ea+T+D,0,0);break;case "MultiPolygon":for(T=0;T<D;T++)2>T?R[U][ja].splice(ea+T+D,0,F[T]):R[U][ja].splice(ea+T+D,0,0);break;default:return!1}b.mbr=null;b.getMBR();return!0};a.edit.GeometrySegmentUtil.moveGeometryVertex=function(b,c,T){if(a.isNull(b)||a.isNull(c)||a.isNull(T))return!1;var R=b.getType();if("Point"===R||"MultiPoint"===R||"OrientedPoint"===R)return!1;var D=b.getOrdinates();if(a.isNull(D))return!1;var F=c.getGeometrySegment(),U=c.getPoint();
c=c.getPointLocation();if(a.isNull(F)||a.isNull(U))return!1;var U=a.edit.GeometrySegment,ea=a.edit.GeometrySegmentPoint;if(F.getSegmentType()!==U.LINE_TYPE||c===ea.MIDSEG_POINT)return!1;var U=F.getElementIndex(),ea=F.getSegmentIndex(),F=F.getSubElementIndex(),ja=b.getDimension();c=ea*ja+c*ja;switch(R){case "LineString":D[c]=T[0];D[c+1]=T[1];break;case "MultiLineString":D[U][c]=T[0];D[U][c+1]=T[1];break;case "Polygon":D[F][c]=T[0];D[F][c+1]=T[1];break;case "MultiPolygon":D[U][F][c]=T[0];D[U][F][c+
1]=T[1];break;default:return!1}b.mbr=null;b.getMBR();return!0};a.edit.GeometrySegmentUtil.removeVertexesFromGeometry=function(b,c){if(a.isNull(b)||a.isNull(c))return!1;var T=b.getType();if("Point"===T||"MultiPoint"===T||"OrientedPoint"===T)return!1;var R=b.getOrdinates();if(a.isNull(R))return!1;for(var D=b.getDimension(),F=!1,U={},ea=0;ea<c.length;ea++){var ja=c[ea].getGeometrySegment(),ra=c[ea].getPoint(),Ea=c[ea].getPointLocation();if(!a.isNull(ja)&&!a.isNull(ra)){var ra=a.edit.GeometrySegment,
Ha=a.edit.GeometrySegmentPoint;if(ja.getSegmentType()===ra.LINE_TYPE&&Ea!==Ha.MIDSEG_POINT){var ra=ja.getElementIndex(),Ha=ja.getSegmentIndex(),ja=ja.getSubElementIndex(),Ea=Ha*D+Ea*D,Ka=Ha=0;switch(T){case "LineString":Ha=R.length/D;if(2>Ha-c.length)break;for(;Ka!=D;)R[Ea+Ka]=Number.NaN,Ka++;F=!0;break;case "MultiLineString":for(;Ka!=D;)R[ra][Ea+Ka]=Number.NaN,Ka++,U[""+ra]=!0;F=!0;break;case "Polygon":for(;Ka!=D;)R[ja][Ea+Ka]=Number.NaN,Ka++,U[""+ja]=!0;F=!0;break;case "MultiPolygon":for(;Ka!=D;)R[ra][ja][Ea+
Ka]=Number.NaN,Ka++,U[""+ra+":"+ja]=!0;F=!0;break;default:return!1}}}}if(!F)return!1;switch(T){case "LineString":U=[];for(T=0;T<R.length;T++)isNaN(R[T])||U.push(R[T]);b.coordinates=U;break;case "MultiLineString":for(T=0;T<R.length;T++)if(!a.isNull(U[""+T])){D=[];for(F=0;F<R[T].length;F++)isNaN(R[T][F])||D.push(R[T][F]);R[T]=D}for(U=0;U<R.length;U++)2>R[U].length&&(R.splice(U,1),U--);break;case "Polygon":for(T=0;T<R.length;T++)if(!a.isNull(U[""+T])){D=[];for(F=0;F<R[T].length;F++)isNaN(R[T][F])||D.push(R[T][F]);
R[T]=D}for(U=0;U<R.length;U++)if(4>R[U].length){if(0===U)return!1;R.splice(U,1);U--}break;case "MultiPolygon":for(T=0;T<R.length;T++)for(D=0;D<R[T].length;D++)if(!a.isNull(U[""+T+":"+D])){F=[];for(ea=0;ea<R[T][D].length;ea++)isNaN(R[T][D][ea])||F.push(R[T][D][ea]);R[T][D]=F}for(U=0;U<R.length;U++)for(T=0;T<R[U].length;T++)if(4>R[U][T].length)if(0===T){R.splice(U,1);U--;break}else R[U].splice(T,1),T--}b.mbr=null;b.getMBR();return!0};a.edit.GeometrySegmentUtil.breakLineGeometry=function(b,c){if(a.isNull(b)||
a.isNull(c))return!1;var T=b.getType();if("LineString"!==T&&"MultiLineString"!==T)return!1;var R=b.getOrdinates();if(a.isNull(R))return!1;var D=c.getGeometrySegment(),F=c.getPoint(),U=c.getPointLocation();if(a.isNull(D)||a.isNull(F))return!1;var ea=a.edit.GeometrySegment,ja=a.edit.GeometrySegmentPoint;if(D.getSegmentType()!==ea.LINE_TYPE)return!1;var ra=D.getElementIndex(),D=D.getSegmentIndex(),Ea=b.getDimension(),Ha=-1;if(U!==ja.MIDSEG_POINT)if(Ha=D*Ea+U*Ea,"LineString"===T){if(0===Ha||Ha===R.length-
Ea)return!1}else{if(0===Ha||Ha===R[ra].length-Ea)return!1}else Ha=D*Ea+Ea;var D=[],ea=[],Ka=[],Ra=null;if("LineString"===T)Ra=R;else for(Ra=R[ra],T=0;T<R.length;T++)T!==ra&&D.push(R[T]);for(R=0;R<Ha;R++)ea.push(Ra[R]);if(U!==ja.MIDSEG_POINT)for(F=0;F<Ea;F++)ea.push(Ra[Ha+F]);else for(U=0;U<Ea;U++)2>U?(ea.push(F[U]),Ka.push(F[U])):(ea.push(0),Ka.push(0));for(F=Ha;F<Ra.length;F++)Ka.push(Ra[F]);D.push(ea);D.push(Ka);b.type="MultiLineString";b.coordinates=D;return!0};a.edit.GeometrySegmentUtil.splitPolygonGeometry=
function(b,c,T){if(a.isNull(b)||a.isNull(c)||a.isNull(T))return!1;var R=b.getType();if("Polygon"!==R&&"MultiPolygon"!==R)return!1;var D=c.length;if(0===D||0!==D%2||c[0].getGeometrySegment().getElementIndex()!==c[D-1].getGeometrySegment().getElementIndex())return!1;var F;if(2<c.length)for(F=1;F<D-1;F+=2)if(c[F].getSubElementIndex()!=c[F+1].getSegment().getSubElementIndex())return!1;for(F=0;F<T.length;F++){var U=T[F];if(a.isNull(U)||2>U.length/2)return!1}var ea=b.getDimension(),U=c[0].getGeometrySegment().getElementIndex();
if(-1===U)return!1;var ja=null,ja="Polygon"===R?b.getOrdinates():b.getOrdinates()[U],ra=c[0].getPointLocation(),Ea=c[D-1].getPointLocation(),Ha=c[0].getGeometrySegment().getSegmentIndex(),Ka=c[D-1].getGeometrySegment().getSegmentIndex(),Ra=ja[0].length-1;if(c[0].getPoint()[0]===c[D-1].getPoint()[0]&&c[0].getPoint()[1]===c[D-1].getPoint()[1])return!1;if(2<c.length)for(F=1;F<D-2;F+=2)if(c[F].getPoint()[0]===c[F+1].getPoint()[0]&&c[F].getPoint()[1]==c[F+1].getPoint()[1])return!1;var ib=[],fb=a.edit.GeometrySegmentPoint;
if(2===c.length)ib.push(T[0]),ib.push(T[0]);else return!1;F=!1;var bb=NaN,qb=NaN,$a,hb,wb;Ha===Ka&&(F=!0,$a=c[0].getPoint(),T=c[D-1].getPoint(),hb=ja[Ha*ea],wb=ja[Ha*ea+1],bb=$a[0]-hb,$a=$a[1]-wb,bb=Math.sqrt(bb*bb+$a*$a),hb=T.getX()-hb,T=T.getY()-wb,qb=Math.sqrt(hb*hb+T*T));T=[];wb=[];$a=hb=-1;hb=2;if(Ha<Ka||F&&bb<qb){ra===fb.STARTSEG_POINT?hb=Ha*ea:ra===fb.ENDSEG_POINT?hb=(Ha+1)*ea:(hb=(Ha+1)*ea,T.push(c[0].getPoint()[0]),T.push(c[0].getPoint()[1]));Ea===fb.STARTSEG_POINT||Ea===fb.MIDSEG_POINT?
$a=Ka*ea+ea:Ea===fb.ENDSEG_POINT&&($a=(Ka+1)*ea+ea);F&&ra===fb.MIDSEG_POINT&&Ea===fb.MIDSEG_POINT&&($a=hb);for(F=hb;F<$a;F+=ea)T.push(ja[0][F]),T.push(ja[0][F+1]);Ea===fb.MIDSEG_POINT&&(T.push(c[D-1].getPoint()[0]),T.push(c[D-1].getPoint()[1]));F=ib[0];hb=2;for(bb=F.length-ea;0<bb;bb-=hb)T.push(F[bb-hb]),T.push(F[bb-hb+1]);Ea===fb.STARTSEG_POINT?hb=Ka*ea:Ea===fb.ENDSEG_POINT?hb=(Ka+1)*ea:(hb=(Ka+1)*ea,wb.push(c[D-1].getPoint()[0]),wb.push(c[D-1].getPoint()[1]));$a=Ra+1;for(F=hb;F<$a;F+=ea)wb.push(ja[0][F]),
wb.push(ja[0][F+1]);ra===fb.STARTSEG_POINT||ra===fb.MIDSEG_POINT?$a=Ha*ea+ea:ra===fb.ENDSEG_POINT&&($a=(Ha+1)*ea+ea);for(F=ea;F<$a;F+=ea)wb.push(ja[0][F]),wb.push(ja[0][F+1]);ra===fb.MIDSEG_POINT&&(wb.push(c[0].getPoint()[0]),wb.push(c[0].getPoint()[1]));F=ib[1];hb=2;for(c=ea;c<F.length;c+=hb)wb.push(F[c]),wb.push(F[c+1])}else if(Ha>Ka||F&&bb>qb){Ea===fb.STARTSEG_POINT?hb=Ka*ea:Ea===fb.ENDSEG_POINT?hb=(Ka+1)*ea:(hb=(Ka+1)*ea,T.push(c[D-1].getPoint()[0]),T.push(c[D-1].getPoint()[1]));ra===fb.STARTSEG_POINT||
ra===fb.MIDSEG_POINT?$a=Ha*ea+ea:ra===fb.ENDSEG_POINT&&($a=(Ha+1)*ea+ea);for(F=hb;F<$a;F+=ea)T.push(ja[0][F]),T.push(ja[0][F+1]);ra===fb.MIDSEG_POINT&&(T.push(c[0].getPoint()[0]),T.push(c[0].getPoint()[1]));F=ib[0];hb=2;for(bb=ea;bb<F.length;bb+=hb)T.push(F[bb]),T.push(F[bb+1]);ra===fb.STARTSEG_POINT?hb=Ha*ea:ra===fb.ENDSEG_POINT?hb=(Ha+1)*ea:(hb=(Ha+1)*ea,wb.push(c[0].getPoint()[0]),wb.push(c[0].getPoint()[1]));$a=Ra+1;for(F=hb;F<$a;F+=ea)wb.push(ja[0][F]),wb.push(ja[0][F+1]);Ea===fb.STARTSEG_POINT||
Ea===fb.MIDSEG_POINT?$a=Ka*ea+ea:Ea===fb.ENDSEG_POINT&&($a=(Ka+1)*ea+ea);for(F=ea;F<$a;F+=ea)wb.push(ja[0][F]),wb.push(ja[0][F+1]);Ea===fb.MIDSEG_POINT&&(wb.push(c[D-1].getPoint()[0]),wb.push(c[D-1].getPoint()[1]));F=ib[1];hb=2;for(bb=F.length-ea;0<bb;bb-=hb)wb.push(F[bb-hb]),wb.push(F[bb-hb+1])}else return!1;c=[];D=-1;"Polygon"===R?(D=1,c[0]=[],c[1]=[]):(D=b.getOrdinates().length,c=b.getOrdinates());c[U]=[T];c[D]=[wb];b.coordinates=c;b.type="MultiPolygon";b.mbr=null;b.getMBR();return!0};a.tool.BreakLineTool=
a.tool.RedlineTool.extend({initialize:function Ub(b,c){Ub.base.call(this,b,a.tool.RedlineTool.TYPE_POINT);var D=this;this.lineFeature=c;this.lineElement=-1;this.snapSegment=this.snapFeature=this.secondLine=this.firstLine=null;a.isNull(this.lineFeature)?(a.util.Logger.alert("MAPVIEWER_9054","OM.tool.BreakLineTool.initialize",""),this.clear()):(a.notNull(this.lineFeature)&&a.notNull(this.lineFeature.getGeometry())&&("LineString"===this.lineFeature.getGeometry().getType()||"MultiLineString"===this.lineFeature.getGeometry().getType())?
this.lineFeature.editable=!1:(a.util.Logger.alert("MAPVIEWER_9055","OM.tool.BreakLineTool.initialize",""),this.lineFeature=null,this.clear()),a.gv.featureDrag=!1,a.gv.allowFeaturePointsInteraction=!1,this.addListener(a.event.ToolEvent.TOOL_END,this.processPoint),this.snapLayer=new a.layer.VectorLayer("snap_layer_"+Math.random(),{def:{type:a.layer.VectorLayer.TYPE_LOCAL}}),this.snapLayerStyle=new a.style.Marker({width:12,height:12,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",
stroke:"#ff0000",strokeThickness:1}}]}),this.snapLayer.setRenderingStyle(this.snapLayerStyle),b.addLayer(this.snapLayer),this.addListener(a.event.ToolEvent.SNAP_POINT,function(){if(!a.isNull(D.lineFeature)){a.notNull(D.snapFeature)&&(D.snapLayer.removeFeature(D.snapFeature),D.snapLayer.redraw(),D.snapFeature=null);D.snapPoint=null;var b=D._map.getScreenPointLocation(D._map.mLocX,D._map.mLocY);if(a.notNull(b)){var c=D._map.getScreenPointLocation(D._map.mLocX-3,D._map.mLocY-3),R=b.coordinates[0]-c.coordinates[0],
c=c.coordinates[1]-b.coordinates[1],R=Math.sqrt(R*R+c*c),c=[b.coordinates[0],b.coordinates[1]],T=null;a.notNull(D.lineFeature.parentLayer)&&(T=D.lineFeature.parentLayer.segmentRtree[D.lineFeature.id],a.isNull(T)&&(T=a.edit.GeometrySegmentUtil.buildSegmentTree(D.lineFeature),a.notNull(T)&&(D.lineFeature.parentLayer.segmentRtree[D.lineFeature.id]=T)));R=a.edit.GeometrySegmentUtil.getFeatureSegmentPoint(D.lineFeature,T,c,R,!1,!1,!1,!1);D.snapSegment=null;if(a.notNull(R)){var ra=R.getGeometrySegment(),
c=R.getPointLocation(),T=a.edit.GeometrySegmentPoint,Ea=ra.getElementIndex(),ra=ra.getSegmentIndex(),Ha=D.lineFeature.getGeometry().getDimension(),Ka=D.lineFeature.getGeometry().getType(),Ra=D.lineFeature.getGeometry().getOrdinates(),ib=-1;if(c!==T.MIDSEG_POINT)if(ib=ra*Ha+c*Ha,"LineString"===Ka){if(0===ib||ib===Ra.length-Ha)return}else if(0===ib||ib===Ra[Ea].length-Ha)return;D.snapSegment=R;R=R.getPoint();b=new a.geometry.Point(R[0],R[1],b.getSRID());R=D._map.getScreenLocation(b);D.snapPoint=[];
D.snapPoint.push(R.x);D.snapPoint.push(R.y);D.snapFeature=new a.Feature("SnapPoint",b,{renderingStyle:D.snapLayerStyle});D.snapLayer.addFeature(D.snapFeature);D.snapLayer.redraw()}}}}))},clear:function(){a.gv.featureDrag=!0;a.gv.allowFeaturePointsInteraction=!0;a.notNull(this.snapFeature)&&(this.snapLayer.removeFeature(this.snapFeature),this.snapLayer.redraw(),this.snapFeature=null);this.finish();this.clear_base()},processPoint:function(){this.lineElement=-1;this.secondLine=this.firstLine=null;if(!a.isNull(this.lineFeature)){if(a.notNull(this._geometry)&&
a.notNull(this.snapSegment)){var b=this.lineFeature.getGeometry().clone(!0);if(a.edit.GeometrySegmentUtil.breakLineGeometry(b,this.snapSegment)){this.lineElement=this.snapSegment.getElementIndex;var c=b.getOrdinates().length;this.firstLine=b.getOrdinates()[c-2];this.secondLine=b.getOrdinates()[c-1];a.notNull(this.lineFeature.parentLayer.changeManager)&&(c=this.lineFeature.parentLayer.changeManager.updateFeature(this.lineFeature.id,this.lineFeature,b,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(c)&&
this.lineFeature.parentLayer.getUndoManager().addEdit({feature:this.lineFeature,changeManager:this.lineFeature.parentLayer.changeManager,editChangeEvent:c,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"break line"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.deleteEditingProperties();
this.feature.selected&&this.feature.addEditProperties()}}));this.lineFeature.editable=!0;this.lineFeature.deleteEditingProperties();this.lineFeature.addEditProperties();this.lineFeature.setGeometry(b);this.lineFeature.parentLayer.selectFeature(this.lineFeature)}}this._map.getToolFeatureLayer().removeFeature(this._points[0])}this.start()}});a.tool.RemoveVertexesTool=a.tool.RectangleTool.extend({initialize:function T(b,c){T.base.call(this,b);this.selectedFeature=c;this.addListener(a.event.ToolEvent.TOOL_END,
this.processRectangle);this.registerUpdate=function(b,c){a.isNull(b)||a.isNull(c)||a.isNull(this.selectedFeature)||(c===this.selectedFeature?this.selectedFeature.parentLayer.getUndoManager().addEdit({feature:this.selectedFeature,changeManager:this.selectedFeature.parentLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"feature vertexes remove"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.deleteEditingProperties();
this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}):this.selectedFeature.parentLayer.getUndoManager().addEdit({feature:c,changeManager:this.selectedFeature.parentLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"feature vertexes remove"},undo:function(){this.changeManager.undo(this.editChangeEvent)},
redo:function(){this.changeManager.redo(this.editChangeEvent)}}))}},processRectangle:function(){if(a.notNull(this._geometry)){var b=[],c={},D={x:this._geometry.getMinX(),y:this._geometry.getMinY(),w:this._geometry.getWidth(),h:this._geometry.getHeight()},D=a.edit.GeometrySegmentUtil.getLayerSegmentPointsWithinBox(this.selectedFeature.parentLayer,D);if(a.notNull(D)&&a.notNull(D[this.selectedFeature.id]))for(var F in D)if(D.hasOwnProperty(F)){var U=D[F];if(a.notNull(U)&&0<U.length&&(F===this.selectedFeature.id||
this.selectedFeature.parentLayer.hasSharedBoundary())){var ea=U[0].getFeature().getGeometry().clone(!0);a.edit.GeometrySegmentUtil.removeVertexesFromGeometry(ea,U)&&(b.push(U[0].getFeature()),c[F]=ea)}}if(a.notNull(this.selectedFeature.parentLayer.changeManager)){F=a.edit.EditChangeEvent;1<b.length&&this.selectedFeature.parentLayer.getUndoManager().startChangeBlock("feature vertexes remove");for(D=0;D<b.length;D++)U=b[D],a.isNull(c[U.id])||(ea=this.selectedFeature.parentLayer.changeManager.updateFeature(U.id,
U,c[U.id],F.SPATIAL_UPDATE),a.notNull(ea)&&this.registerUpdate(ea,U));1<b.length&&this.selectedFeature.parentLayer.getUndoManager().endChangeBlock("feature vertexes remove")}for(F=0;F<b.length;F++)D=b[F],D.setGeometry(c[D.id]);this.selectedFeature.deleteEditingProperties();this.selectedFeature.addEditProperties()}this._geometry=null}});a.tool.SplitPolygonTool=a.tool.RedlineTool.extend({initialize:function R(b,c){R.base.call(this,b,a.tool.RedlineTool.TYPE_POINT);var U=this;this.splitLineStyle=new a.style.Line({stroke:"#FF0000",
strokeThickness:5,strokeOpacity:.5});this.splitLineStyle.fill=b.graphics.oui.NO_PAINT;this.snapSegmentPoint=this.snapFeature=null;this.splitPoints=[];this.splitLines=[];this.currentSplitLine=[];this.shapeGroup=[];this.ghostShape=null;this.lastSubElem=-1;this.hasSplitLines=this.islastActionMoveTo=this.hasSplitLines=this.isInAction=!1;this.lastPointWC=[];this.lastScreenPoint=[];a.isNull(c)?(a.util.Logger.alert("MAPVIEWER_9054","OM.tool.SplitPolygonTool.initialize",""),this.clear()):(this.polygonFeature=
c,!a.notNull(this.polygonFeature)||"Polygon"!==this.polygonFeature.getGeometry().getType()&&"MultiPolygon"!==this.polygonFeature.getGeometry().getType()?(a.util.Logger.alert("MAPVIEWER_9038","OM.tool.SplitPolygonTool.initialize",""),this.polygonFeature=null,this.clear()):this.polygonFeature.editable=!1,a.gv.featureDrag=!1,a.gv.allowFeaturePointsInteraction=!1,this.addListener(a.event.ToolEvent.REDLINE_POINT_CREATE,this.processPoint),this.snapLayer=new a.layer.VectorLayer("snap_layer_"+Math.random(),
{def:{type:a.layer.VectorLayer.TYPE_LOCAL}}),this.snapLayerStyle=new a.style.Marker({width:12,height:12,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#ff0000",strokeThickness:1}}]}),this.snapLayer.setRenderingStyle(this.snapLayerStyle),b.addLayer(this.snapLayer),this.addListener(a.event.ToolEvent.SNAP_POINT,function(){if(!a.isNull(U.polygonFeature)){a.notNull(U.snapFeature)&&(U.snapLayer.removeFeature(U.snapFeature),U.snapLayer.redraw(),U.snapFeature=
null);U.snapPoint=null;var b=U._map.getScreenPointLocation(U._map.mLocX,U._map.mLocY);if(a.notNull(b)){var c=U._map.getScreenPointLocation(U._map.mLocX-3,U._map.mLocY-3),F=b.coordinates[0]-c.coordinates[0],c=c.coordinates[1]-b.coordinates[1],F=Math.sqrt(F*F+c*c),c=[b.coordinates[0],b.coordinates[1]],D=null;a.notNull(U.polygonFeature.parentLayer)&&(D=U.polygonFeature.parentLayer.segmentRtree[U.polygonFeature.id],a.isNull(D)&&(D=a.edit.GeometrySegmentUtil.buildSegmentTree(U.polygonFeature),a.notNull(D)&&
(U.polygonFeature.parentLayer.segmentRtree[U.polygonFeature.id]=D)));F=a.edit.GeometrySegmentUtil.getFeatureSegmentPoint(U.polygonFeature,D,c,F,!1,!1,!1,!1);U.snapSegmentPoint=null;if(a.notNull(F)){D=F.getGeometrySegment();c=D.getSubElementIndex();D=D.getSegmentIndex();if(0===U.splitPoints.length){if(0!==c)return}else{if(1===U.splitPoints.length&&1===this.currentSplitLine.length&&0===this.splitLines.length&&U.splitPoints[0].getGeometrySegment().getSegmentIndex()===D)return;if(1<U.splitPoints.length)if(D=
U.splitPoints[U.splitPoints.length-1].getGeometrySegment().getSubElementIndex(),0===U.splitPoints.length%2){if(D!==c)return}else if(D===c)return}U.snapSegmentPoint=F;F=F.getPoint();b=new a.geometry.Point(F[0],F[1],b.getSRID());F=U._map.getScreenLocation(b);U.snapPoint=[];U.snapPoint.push(F.x);U.snapPoint.push(F.y);U.snapFeature=new a.Feature("SnapPoint",b,{renderingStyle:U.snapLayerStyle});U.snapLayer.addFeature(U.snapFeature);U.snapLayer.redraw()}}a.notNull(U.ghostShape)&&(a.notNull(U.snapPoint)?
U._graphic.setPath(U.ghostShape,[[U.lastScreenPoint[0],U.lastScreenPoint[1],U.snapPoint[0],U.snapPoint[1]]]):U._graphic.setPath(U.ghostShape,[[U.lastScreenPoint[0],U.lastScreenPoint[1],U._map.mLocX,U._map.mLocY]]))}}))},reset:function(){a.notNull(this.snapFeature)&&(this.snapLayer.removeFeature(this.snapFeature),this.snapLayer.redraw(),this.snapFeature=null);this.snapSegmentPoint=this.snapFeature=null;this.splitPoints=[];this.splitLines=[];this.currentSplitLine=[];this.lastSubElem=-1;this.hasSplitLines=
this.islastActionMoveTo=this.hasSplitLines=this.isInAction=!1;this.lastPointWC=[];this.lastScreenPoint=[];if(0<this.shapeGroup.length)for(var b=this.shapeGroup.length-1;-1<b;b--)this._graphic.remove(this.shapeGroup[b]);this.shapeGroup=[];a.notNull(this.ghostShape)&&this._graphic.remove(this.ghostShape);this.ghostShape=null},clear:function(){a.gv.featureDrag=!0;a.gv.allowFeaturePointsInteraction=!0;this.polygonFeature.editable=!0;this.reset();this.finish();this.clear_base()},processPoint:function(){this.hasSplitLines=
!1;if(0!==this.splitPoints.length||!a.isNull(this.snapSegmentPoint)){var b,c,F,U=this._geometry;b=U.getX();c=U.getY();if(0===this.splitPoints.length)b=this.snapSegmentPoint.getPoint()[0],c=this.snapSegmentPoint.getPoint()[1],this.islastActionMoveTo=this.isInAction=!0,this.currentSplitLine=[],this.currentSplitLine.push(b),this.currentSplitLine.push(c),this.splitPoints.push(this.snapSegmentPoint),this.lastPointWC=[b,c],F=new a.geometry.Point(b,c,U.getSRID()),F=this._map.getScreenLocation(F),this.lastScreenPoint=
[F.x,F.y],this.ghostShape=this._graphic.drawPath([[F.x,F.y,F.x,F.y]],this.splitLineStyle,{group:this._group}),this.ghostShape.setStrokeDashArray([6]);else{var ea=!0;1<this.splitPoints.length&&a.notNull(this.snapSegmentPoint)&&0===this.splitPoints.length%2&&this.splitPoints[this.splitPoints.length-1].getGeometrySegment().getSubElementIndex()==this.snapSegmentPoint.getGeometrySegment().getSubElementIndex()&&(ea=!1);a.notNull(this.snapSegmentPoint)&&(b=this.snapSegmentPoint.getPoint()[0],c=this.snapSegmentPoint.getPoint()[1]);
F=new a.geometry.Point(b,c,U.getSRID());F=this._map.getScreenLocation(F);this.lastScreenPoint=[F.x,F.y];if(ea){this.islastActionMoveTo=!1;this.currentSplitLine.push(b);this.currentSplitLine.push(c);for(var ea=[],ja=0;ja<this.currentSplitLine.length;ja+=2)F=new a.geometry.Point(this.currentSplitLine[ja],this.currentSplitLine[ja+1],U.getSRID()),F=this._map.getScreenLocation(F),ea.push(F.x),ea.push(F.y),a.isNull(this.shapeGroup[this.splitLines.length])?(this.shapeGroup[this.splitLines.length]=this._graphic.drawPath([ea],
this.splitLineStyle,{group:this._group}),this.shapeGroup[this.splitLines.length].setStrokeDashArray([6])):this._graphic.setPath(this.shapeGroup[this.splitLines.length],[ea])}else this.islastActionMoveTo=!0,this.splitLines.push(this.currentSplitLine),this.currentSplitLine=[],this.currentSplitLine.push(b),this.currentSplitLine.push(c);a.notNull(this.snapSegmentPoint)&&(this.splitPoints.push(this.snapSegmentPoint),1<this.splitPoints.length&&this.snapSegmentPoint.getGeometrySegment().getSubElementIndex()==
this.splitPoints[0].getGeometrySegment().getSubElementIndex()&&(this.hasSplitLines=!0,this.splitLines.push(this.currentSplitLine)));this.lastPointWC=[b,c];this.hasSplitLines&&(b=this.polygonFeature.getGeometry().clone(!0),a.edit.GeometrySegmentUtil.splitPolygonGeometry(b,this.splitPoints,this.splitLines)&&(a.notNull(this.polygonFeature.parentLayer.changeManager)&&(c=this.polygonFeature.parentLayer.changeManager.updateFeature(this.polygonFeature.id,this.polygonFeature,b,a.edit.EditChangeEvent.SPATIAL_UPDATE),
a.notNull(c)&&this.polygonFeature.parentLayer.getUndoManager().addEdit({feature:this.polygonFeature,changeManager:this.polygonFeature.parentLayer.changeManager,editChangeEvent:c,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"split polygon"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.deleteEditingProperties();
this.feature.addEditProperties()}})),this.polygonFeature.deleteEditingProperties(),this.polygonFeature.addEditProperties(),this.polygonFeature.setGeometry(b)),this.reset())}this._map.getToolFeatureLayer().removeFeature(this._points[0])}}});a.tool.VoidPolygonTool=a.tool.RedlineTool.extend({initialize:function D(b,c){D.base.call(this,b,a.tool.RedlineTool.TYPE_POLYGON);a.isNull(c)?(a.util.Logger.alert("MAPVIEWER_9054","OM.tool.VoidPolygonTool.initialize",""),this.clear()):(this.polygonFeature=c,this.polygonElement=
-1,!a.notNull(this.polygonFeature)||"Polygon"!==this.polygonFeature.getGeometry().getType()&&"MultiPolygon"!==this.polygonFeature.getGeometry().getType()?(a.util.Logger.alert("MAPVIEWER_9038","OM.tool.VoidPolygonTool.initialize",""),this.polygonFeature=null,this.clear()):this.polygonFeature.editable=!1)},end:function(){this.polygonElement=-1;if(!a.isNull(this._geometry)&&!a.isNull(this.polygonFeature)){var b=this._geometry.getOrdinates()[0],c=b[0],U=b[1],ea=this.polygonFeature.getGeometry().getDimension();
if("Polygon"===this.polygonFeature.getGeometry().getType())this.polygonElement=0;else for(var ja=this.polygonFeature.getGeometry(),ra=ja.getOrdinates().length,Ea=0;Ea<ra;Ea++){var Ha=new a.geometry.Polygon(ja.getOrdinates()[Ea][0],this.polygonFeature.getGeometry().getSRID(),ea);if(a.util.GeomUtil.poinInPolygonGeometry(Ha,c,U)){this.polygonElement=Ea;break}}if(-1!==this.polygonElement){ja=a.util.GeomUtil.isClockwise(b);c=this.polygonFeature.getGeometry().clone(!0);U=null;U="Polygon"===this.polygonFeature.getGeometry().getType()?
c.getOrdinates():c.getOrdinates()[this.polygonElement];if((ra=a.util.GeomUtil.isClockwise(U[0],ea))&&ja||!ra&&!ja)b=a.util.GeomUtil.reverseCoordinates(b);ja=[];if(2<ea){for(ra=0;ra<b.length;ra+=2)for(ja.push(b[ra]),ja.push(b[ra+1]),Ea=2;Ea<ea;Ea++)ja.push(0);b=ja}U[U.length]=b;a.notNull(this.polygonFeature.parentLayer.changeManager)&&(b=this.polygonFeature.parentLayer.changeManager.updateFeature(this.polygonFeature.id,this.polygonFeature,c,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(b)&&this.polygonFeature.parentLayer.getUndoManager().addEdit({feature:this.polygonFeature,
changeManager:this.polygonFeature.parentLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"add void polygon"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}));
this.polygonFeature.editable=!0;this.polygonFeature.deleteEditingProperties();this.polygonFeature.addEditProperties();this.polygonFeature.setGeometry(c);this.polygonFeature.parentLayer.selectFeature(this.polygonFeature)}}}});a.tool.WhiteBoardTool=a.tool.Tool.extend({initialize:function F(b){F.base.call(this,b);var c=b.mapInstanceId;if(!b.$dialog){var ja=a.tool.WhiteBoardTool,ra;if(a.browser.touchSupported||a.gv.isWin8Touch)ra="\x3ctr\x3e\x3ctd\x3e"+a.gv.getLabel("MAPVIEWER_WB_TEXT")+"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' size\x3d'25' id\x3d'_wb_text"+
c+"'\x3e\x3c/td\x3e\x3ctd\x3e"+ja.genSizes()+"\x3c/td\x3e\x3c/tr\x3e",b.$dialog=a.$('\x3cdiv id\x3d"_wb_dialog'+b.mapInstanceId+'" title\x3d"'+a.gv.getLabel("MAPVIEWER_WB_TTILE")+'" style\x3d"overflow:visible"\x3e\x3ctable width\x3d100%\x3e'+ra+"\x3c/table\x3e\x3c/div\x3e");else{ra="\x3ctr\x3e\x3ctd\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e"+a.gv.getLabel("MAPVIEWER_WB_TEXT")+"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:400px'  id\x3d'_wb_text"+c+"'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e";
var Ea="\x3ctr\x3e\x3ctd\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e"+a.gv.getLabel("MAPVIEWER_WB_X",!0)+"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:100px' value\x3d'1' id\x3d'_wb_orienx"+c+"'\x3e\x3c/td\x3e\x3ctd\x3e\x26nbsp;\x26nbsp;"+a.gv.getLabel("MAPVIEWER_WB_Y",!0)+"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:100px' value\x3d'0' id\x3d'_wb_orieny"+c+"'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e";b.weightBut=new a.tool.ImageButton("_wb_weight"+
c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_BOLD"),buttonEnableIcon:a.tool.WhiteBoardTool.img_bold_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_bold_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_bold_dwn});b.styleBut=new a.tool.ImageButton("_wb_style"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_ITALIC"),buttonEnableIcon:a.tool.WhiteBoardTool.img_italic_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_italic_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_italic_dwn});b.hAlignGroup=new a.tool.ButtonGroup;var Ha=new a.tool.ImageButton("_wb_halign_left"+
c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_ALIGN_LEFT"),buttonEnableIcon:a.tool.WhiteBoardTool.img_leftalign_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_leftalign_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_leftalign_dwn}),Ka=new a.tool.ImageButton("_wb_halign_center"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_ALIGN_CENTER"),buttonEnableIcon:a.tool.WhiteBoardTool.img_centeralign_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_centeralign_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_centeralign_dwn,status:a.tool.ImageButton.STATUS_DOWN}),
Ra=new a.tool.ImageButton("_wb_halign_right"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_ALIGN_RIGHT"),buttonEnableIcon:a.tool.WhiteBoardTool.img_rightalign_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_rightalign_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_rightalign_dwn});b.hAlignGroup.addButton(Ha);b.hAlignGroup.addButton(Ka);b.hAlignGroup.addButton(Ra);b.vAlignGroup=new a.tool.ButtonGroup;Ha=new a.tool.ImageButton("_wb_valign_bottom"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_VALIGN_BOTTOM"),buttonEnableIcon:a.tool.WhiteBoardTool.img_bottomalign_ena,
buttonOverIcon:a.tool.WhiteBoardTool.img_bottomalign_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_bottomalign_dwn});Ka=new a.tool.ImageButton("_wb_valign_center"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_VALIGN_CENTER"),buttonEnableIcon:a.tool.WhiteBoardTool.img_centervalign_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_centervalign_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_centervalign_dwn,status:a.tool.ImageButton.STATUS_DOWN});Ra=new a.tool.ImageButton("_wb_valign_top"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_VALIGN_TOP"),
buttonEnableIcon:a.tool.WhiteBoardTool.img_topalign_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_topalign_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_topalign_dwn});b.vAlignGroup.addButton(Ra);b.vAlignGroup.addButton(Ka);b.vAlignGroup.addButton(Ha);Ha="\x3ctr\x3e\x3ctd\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e"+ja.genColor(c)+"\x3c/td\x3e\x3ctd\x3e";Ha+=b.weightBut.createHTML()+"\x3c/td\x3e\x3ctd\x3e"+b.styleBut.createHTML();Ha+="\x3c/td\x3e\x3ctd\x3e"+b.hAlignGroup.createHTML()+"\x3c/td\x3e\x3ctd\x3e"+
b.vAlignGroup.createHTML()+"\x3c/td\x3e\x3ctd\x3e";Ha+=ja.genFontFamily(c)+"\x3c/td\x3e\x3ctd\x3e"+ja.genSizes()+"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e";b.$dialog=a.$('\x3cdiv id\x3d"_wb_dialog'+b.mapInstanceId+'" title\x3d"'+a.gv.getLabel("MAPVIEWER_WB_TTILE")+'" style\x3d"overflow:visible"\x3e\x3ctable width\x3d100% cellSpacing\x3d0 borderSpacing\x3d0 style\x3d\'font-size:13px\'\x3e'+ra+Ea+Ha+"\x3c/table\x3e\x3c/div\x3e")}}var ib=null,fb=null,bb=null,qb=null,$a=this;this.allTextFeatures=
[];this.downEventAction=function(b){if(3===b.which)$a.finish();else if("touchstart"===b.type){var c=a.util.DomUtil;1===c.getTouchCount(b)&&(b=c.getTouchesPosition(b),ib=b.x,bb=b.y)}else ib=b.pageX,bb=b.pageY};this.newShapePoint=function(F){var ja=$a._map.getToolFeatureLayer();if(!ja.focusFeature&&$a.status!==a.tool.Tool.STOPPED&&$a._map.currentTool===$a){var ra=null,Ea=null;if("touchend"===F.type)if(ra=a.util.DomUtil,1===ra.getTouchCount(F))Ea=ra.getChangedTouchesPosition(F),ra=Ea[0].x,Ea=Ea[0].y;
else return;else ra=F.pageX,Ea=F.pageY;if(2>Math.abs(ra-ib)&&ra!=fb&&2>Math.abs(Ea-bb)&&Ea!=qb){$a._graphic.getLeftTop($a._map.draggableGroup);$a._$container.offset();$a._$container.offset();F=$a._map.getCursorLocation();$a.currentPoint=null;a.tool.WhiteBoardTool.showDialog(b,$a);var Ha=1,Ka=0;a.browser.touchSupported||a.gv.isWin8Touch||(Ha=parseFloat(a.$("#_wb_orienx"+c).val()),Ka=parseFloat(a.$("#_wb_orieny"+c).val()),isNaN(Ha)&&(Ha=1),isNaN(Ka)&&(Ka=0));$a.currentPoint=new a.geometry.Point(F.getX(),
F.getY(),F.srid,Ha,Ka);$a.toolFeature&&ja.removeFeature($a.toolFeature);$a.textFeature&&(F=$a.textFeature,F.saved?(F.editable?F.parentLayer.deselectFeature(F):F.old&&(F.setText(F.old.text),F.setRenderingStyle(F.old.style)),F=null,$a.textFeature=null):ja.removeFeature(F));$a.toolFeature=new a.Feature("_wb_point_"+(new Date).getTime(),$a.currentPoint,{renderingStyle:a.tool.WhiteBoardTool.pointStyle});a.browser.touchSupported||a.gv.isWin8Touch||($a.toolFeature.addListener(a.event.LayerEvent.FEATURE_ORIENTATION_CHANGING,
function(b){var F=b.angle;b=F<=Math.PI/2&&F>=-Math.PI/2?1:-1;F=Math.tan(F)*b;a.$("#_wb_orienx"+c).val(b);a.$("#_wb_orieny"+c).val(F)}),$a.addEventLisenterButtons());ja.addFeature($a.toolFeature);ja.selectFeature($a.toolFeature);$a.toolFeature.tool=$a}fb=ra;qb=Ea}}},start:function(){var b=a.event.ToolEvent;this.clear();a.browser.touchSupported?(this._$container.bind("touchstart",this.downEventAction),this._$container.bind("touchend",this.newShapePoint)):(this._$container.bind("mousedown",this.downEventAction),
this._$container.bind("click",this.newShapePoint));this.status=a.tool.Tool.STARTED;this._map.currentTool=this;b=new b(b.TOOL_START,this);this.fire(b.type,b);return this},clear:function(){this.clearAll()},finish:function(){this._$container.unbind("mousedown",this.downEventAction);this._$container.unbind("click",this.newShapePoint);this._$container.unbind("touchstart",this.downEventAction);this._$container.unbind("touchend",this.newShapePoint);var a=this._map.getToolFeatureLayer();this.toolFeature&&
a.removeFeature(this.toolFeature);this.toolFeature=null;this._map.$dialog.dialog("isOpen")&&this._map.$dialog.dialog("close");for(var a=this.allTextFeatures.length,b=0;b<a;b++)this.allTextFeatures[b].enableEditing=null;return this},clearAll:function(){for(var a=this._map.getToolFeatureLayer(),b=this.allTextFeatures.length-1;0<=b;b--){var c=this.allTextFeatures.pop();a.removeFeature(c);a.refresh()}},getTextStyle:function(){var b;if(a.browser.touchSupported||a.gv.isWin8Touch)b={fontSize:a.tool.WhiteBoardTool.currentSize};
else{var c=this._map.mapInstanceId;b=a.$("#_wb_weight"+c)[0].down?"BOLD":"NORMAL";var ea=a.$("#_wb_style"+c)[0].down?"ITALIC":"NORMAL",ja=a.$("#_wb_valign_bottom"+c)[0].down?"BOTTOM":a.$("#_wb_valign_top"+c)[0].down?"TOP":"CENTERV",c=a.$("#_wb_halign_left"+c)[0].down?"LFET":a.$("#_wb_halign_right"+c)[0].down?"RIGHT":"CENTER",ra=a.tool.WhiteBoardTool;b={fontFamily:ra.currentFontFamily,fontSize:ra.currentSize,fill:ra.currentColor,fontWeight:b,fontStyle:ea,vAlign:ja,hAlign:c}}return new a.style.Text(b)},
addText:function(b){var c=a.$("#_wb_text"+this._map.mapInstanceId).val(),ea=this.getTextStyle(),ja=this._map.getToolFeatureLayer();this.textFeature!==this.toolFeature&&ja.removeFeature(this.toolFeature);if(this.textFeature){var ra=this.textFeature;ra.old||(ra.old={text:this.textFeature.getText(),style:this.textFeature.getRenderingStyle(),point:this.textFeature.getGeometry()});ra.setText(c);ra.setRenderingStyle(ea);ra.screenPoints=null;ra.setGeometry(b);ja.deselectFeature(ra)}else ra="_wb_textfeature_"+
(new Date).getTime(),this.toolFeature=new a.TextFeature(ra,b,c,ea),this.toolFeature.tool=this,ja.addFeature(this.toolFeature)},addEventLisenterButtons:function(){this._map.hAlignGroup.attachEvents();this._map.vAlignGroup.attachEvents();this._map.weightBut.attachEvents();this._map.styleBut.attachEvents()},getAllTextFeatures:function(){return this.allTextFeatures},saveToLS:function(b){if(!localStorage)a.util.Logger.alert("MAPVIEWER_9041","OM.tool.WhiteBoardTool.saveToLS");else if(!a.isNull(b)&&""!==
b){var c=this.getAllTextFeatures(),ea=c?c.length:0;if(0!==ea){for(var ja=[],ra=0;ra<ea;ra++)ja.push(c[ra].toJSON());localStorage[b]=JSON.stringify(ja)}}}});a.tool.WhiteBoardTool.pointStyle=new a.style.Marker({width:20,height:20,vectorDef:[{shape:{type:"path",coords:[[0,7,0,13,10,13,10,20,20,10,10,0,10,7,0,7]],width:20,height:20},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});a.tool.WhiteBoardTool.textFeatureIdSeq=0;a.tool.WhiteBoardTool.fontFamilyArray="Arial;Bookman Old Style;Courier New;Garamond;Lucida Console;Symbol;Tahoma;Times New Roman;Verdana".split(";");
a.tool.WhiteBoardTool.currentFontFamily="Arial";a.tool.WhiteBoardTool.genFontFamily=function(b){b='\x3cselect id\x3d"_wb_fontfamily'+b+'" onchange\x3d"OM.tool.WhiteBoardTool.setFontFamily('+b+')"\x3e';for(var c="",ea=a.tool.WhiteBoardTool.fontFamilyArray.length,ja=0;ja<ea;ja++)c=a.tool.WhiteBoardTool.fontFamilyArray[ja]==a.tool.WhiteBoardTool.currentFontFamily?"selected\x3dtrue":"",b+="\x3coption "+c+' value\x3d"'+a.tool.WhiteBoardTool.fontFamilyArray[ja]+'"\x3e'+a.tool.WhiteBoardTool.fontFamilyArray[ja]+
"\x3c/option\x3e";return b+"\x3c/select\x3e"};a.tool.WhiteBoardTool.setFontFamily=function(b){b=a.$("#_wb_fontfamily"+b).val();a.tool.WhiteBoardTool.currentFontFamily=b};a.tool.WhiteBoardTool.addFont=function(b){for(var c=MVAnnotationTool.fontFamilyArray.length-1,ea=0;ea<c;ea++){if(a.tool.WhiteBoardTool.fontFamilyArray[ea]==b)return;if(a.tool.WhiteBoardTool.fontFamilyArray[ea]<b&&a.tool.WhiteBoardTool.fontFamilyArray[ea+1]>b){a.tool.WhiteBoardTool.fontFamilyArray.splice(ea+1,0,b);return}}a.tool.WhiteBoardTool.fontFamilyArray.push(b)};
a.tool.WhiteBoardTool.removeFont=function(b){for(var c=a.tool.WhiteBoardTool.fontFamilyArray.length-1,ea=0;ea<c;ea++)if(a.tool.WhiteBoardTool.fontFamilyArray[ea]==b){a.tool.WhiteBoardTool.fontFamilyArray.splice(ea,1);break}};a.tool.WhiteBoardTool.genSizes=function(b){b='\x3cselect id\x3d"_wb_fontsize'+b+'" onchange\x3d"OM.tool.WhiteBoardTool.setSize('+b+')"\x3e';for(var c="",ea=5;50>ea;ea++)c=ea==a.tool.WhiteBoardTool.currentSize?"selected\x3dtrue":"",b+="\x3coption "+c+' value\x3d"'+ea+'px"\x3e'+
ea+"px\x3c/option\x3e";return b+"\x3c/select\x3e"};a.tool.WhiteBoardTool.setSize=function(b){b=a.$("#_wb_fontsize"+b).val();a.tool.WhiteBoardTool.currentSize=parseInt(b,10)};a.tool.WhiteBoardTool.genColor=function(b){var c=a.tool.WhiteBoardTool;b='\x3cdiv id\x3d"_wb_color'+b+'" style\x3d"background: url(\''+c.color_picker_icon+"') ";return b=b+"repeat scroll center center transparent; height: 16px;left: 4px;top: 4px;width: 16px;background-color: "+(c.currentColor+'"\x3e\x3c/div\x3e')};a.tool.WhiteBoardTool.showDialog=
function(b,c,ea){var ja=c._map.getToolFeatureLayer();ea&&(c.textFeature=ea,ea.addListener(a.event.LayerEvent.FEATURE_ORIENTATION_CHANGING,function(b){var F=b.angle;b=F<=Math.PI/2&&F>=-Math.PI/2?1:-1;F=Math.tan(F)*b;a.$("#_wb_orienx"+c._map.mapInstanceId).val(b);a.$("#_wb_orieny"+c._map.mapInstanceId).val(F)}),c.currentPoint=ea.getGeometry().clone(),c.textFeature!==c.toolFeature&&ja.removeFeature(c.toolFeature));b.$dialog.dialog({position:{of:b.$oracleMapDiv,at:"center"},resizable:!1,width:a.browser.touchSupported||
a.gv.isWin8Touch?450:510,height:a.browser.touchSupported||a.gv.isWin8Touch?190:230,buttons:[{closeOnEscape:!0,text:a.gv.getLabel("MAPVIEWER_WB_OK"),click:function(){if(ea){var ra=a.$("#_wb_text"+b.mapInstanceId).val();ea.setText(ra);ra=c.getTextStyle();ea.setRenderingStyle(ra);ea.screenPoints=null;ea.setGeometry(c.currentPoint);ja.deselectFeature(ea);ea.old=null;c.toolFeature=null;c.textFeature=null}else c.addText(c.currentPoint),c.toolFeature.tool=c,c.toolFeature.saved=!0,c.allTextFeatures.push(c.toolFeature),
c.toolFeature.old=null,c.toolFeature=null;a.$(this).dialog("close")}},{text:a.gv.getLabel("MAPVIEWER_WB_PREVIEW"),click:function(){c.addText(c.currentPoint)}}],close:function(a,b){c.currentEditingFeature=null;c.toolFeature&&ja.removeFeature(c.toolFeature);ea&&(ea.old&&(ea.setText(ea.old.text),ea.setRenderingStyle(ea.old.style),ea.setGeometry(ea.old.point)),ea.parentLayer&&ea.parentLayer.deselectFeature(ea));c.toolFeature=null;c.textFeature=null}});a.browser.touchSupported||a.gv.isWin8Touch||(b.$dialog.parent().draggable("option",
"containment",b.$oracleMapDiv),a.$("#_wb_color"+b.mapInstanceId).ColorPicker({color:"#000000",onShow:function(b){a.$(b).fadeIn(500);return!1},onHide:function(b){a.$(b).fadeOut(500);return!1},onChange:function(c,U,ea){a.$("#_wb_color"+b.mapInstanceId).css("backgroundColor","#"+U);a.tool.WhiteBoardTool.currentColor="#"+U},onSubmit:function(b,c,F,U){a.tool.WhiteBoardTool.currentColor="#"+c;a.$(U).ColorPickerHide()}}));ea?a.$("#_wb_text"+b.mapInstanceId).val(ea.getText()):a.$("#_wb_text"+b.mapInstanceId).val("")};
a.tool.WhiteBoardTool.currentSize=15;a.tool.WhiteBoardTool.currentColor="#000000";a.tool.WhiteBoardTool.setIconsPath=function(){var b=a.gv.resourcePath()+"txt/",c=a.tool.WhiteBoardTool;c.color_picker_icon=b+"func_text_color_16_ena.png";c.img_bold_ena=b+"func_bold_16_ena.png";c.img_bold_ovr=b+"func_bold_16_hov.png";c.img_bold_dwn=b+"func_bold_16_act.png";c.img_italic_ena=b+"func_italic_16_ena.png";c.img_italic_ovr=b+"func_italic_16_hov.png";c.img_italic_dwn=b+"func_italic_16_act.png";c.img_leftalign_ena=
b+"func_leftalign_16_ena.png";c.img_leftalign_ovr=b+"func_leftalign_16_hov.png";c.img_leftalign_dwn=b+"func_leftalign_16_act.png";c.img_centeralign_ena=b+"func_centeralign_16_ena.png";c.img_centeralign_ovr=b+"func_centeralign_16_hov.png";c.img_centeralign_dwn=b+"func_centeralign_16_act.png";c.img_rightalign_ena=b+"func_rightalign_16_ena.png";c.img_rightalign_ovr=b+"func_rightalign_16_hov.png";c.img_rightalign_dwn=b+"func_rightalign_16_act.png";c.img_bottomalign_ena=b+"bottomalignment_ena.png";c.img_bottomalign_ovr=
b+"bottomalignment_ovr.png";c.img_bottomalign_dwn=b+"bottomalignment_dwn.png";c.img_centervalign_ena=b+"centeralignment_ena.png";c.img_centervalign_ovr=b+"centeralignment_ovr.png";c.img_centervalign_dwn=b+"centeralignment_dwn.png";c.img_topalign_ena=b+"topalignment_ena.png";c.img_topalign_ovr=b+"topalignment_ovr.png";c.img_topalign_dwn=b+"topalignment_dwn.png"};a.tool.WhiteBoardTool.setIconsPath();a.tool.WhiteBoardTool.loadFromLS=function(b){if(!localStorage)a.util.Logger.alert("MAPVIEWER_9041","OM.tool.WhiteBoardTool.loadFromLS");
else if(!a.isNull(b)&&""!==b&&(b=localStorage[b],!a.isNull(b)&&""!==b&&(b=a.$.parseJSON(b),b.length))){for(var c=[],ea=0,ja=b.length;ea<ja;ea++){var ra=b[ea],Ea=a.geometry.Geometry.createGeometry(ra.geometry,ra.geometry.srid),Ha=new a.style.Text(ra.styleConfig),ra=new a.TextFeature(ra.id,Ea,b[ea].text,Ha);c.push(ra)}return c}};a.tool.DuplicateTool=a.tool.Tool.extend({initialize:function U(b,c){U.base.call(this,b);var ra=this;this.feature=c;a.isNull(c)?(a.util.Logger.alert("MAPVIEWER_9054","OM.tool.DuplicateTool.initialize",
""),this.clear()):(this.mouseDown=function(a){a.stopPropagation()},this.mouseUp=function(c){if(!(a.isNull(c)||ra.status==a.tool.Tool.STOPPED||ra.status==a.tool.Tool.FINISHED||a.isNull(ra.feature)||a.isNull(ra.feature.getGeometry())||a.isNull(ra.feature.parentLayer)||a.isNull(ra.feature.parentLayer.changeManager))){c=ra.feature.getGeometry();var U=c.getMBR();if(!a.isNull(U)){var ja=b.getScreenPointLocation(ra._map.mLocX,ra._map.mLocY),Ra=U.getCenter(),U=ja.coordinates[0]-Ra.coordinates[0],ja=ja.coordinates[1]-
Ra.coordinates[1];c=c.clone(!0);a.util.GeomUtil.moveGeometry(c,U,ja);U="dup_"+Math.floor(1E4*Math.random()+1).toString();U=new a.Feature(U,c);c=ra.feature.parentLayer;U=c.changeManager.addFeature(U.id,U);a.notNull(U)&&c.getUndoManager().addEdit({changeManager:c.changeManager,editChangeEvent:U,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"feature added"},undo:function(){this.changeManager.undo(this.editChangeEvent)},redo:function(){this.changeManager.redo(this.editChangeEvent)}})}}},
this.touchStart=function(b){var c=a.util.DomUtil,U=c.getTouchCount(b);if(1==U)b.button=0,c=c.getTouchesPosition(b),ra.touchPos=c,b.pageX=c.x,b.pageY=c.y;else if(2==U)b.button=2;else return;ra.mouseDown(b)},this.touchEnd=function(a){ra.touchPos&&(a.pageX=ra.touchPos.x,a.pageY=ra.touchPos.y,ra.mouseUp(a))},this.finish=function(){ra.status==a.tool.Tool.STARTED&&(ra._$container.unbind("mouseup",ra.mouseUp),ra._$container.unbind("mousedown",ra.mouseDown),a.gv.isWin8Touch&&(ra._$container[0].removeEventListener("MSPointerUp",
ra.mouseUp),ra._$container[0].removeEventListener("MSPointerDown",ra.mouseDown)),a.browser.touchSupported&&(ra._$container.unbind("touchstart",ra.touchStart),ra._$container.unbind("touchend",ra.touchEnd)),ra.status=a.tool.Tool.FINISHED,ra._map.enableMapAction.dbclick=!0,ra._map.enableMapAction.mouse=!0,ra._map.enableMapDrag(!0))})},start:function(){var b=a.event.ToolEvent;this.clear();this._map.enableMapAction.dbclick=!1;this._map.enableMapAction.mouse=!1;this._group||(this._group=this._graphic.createGroup(),
this._graphic.addGroup(this._group,this._map.draggableGroup));this._map.on(a.event.MapEvent.MAP_BEFORE_ZOOM,this.zoomAction,this);this._$container.bind("mouseup",this.mouseUp);this._$container.bind("mousedown",this.mouseDown);a.gv.isWin8Touch&&(this._$container[0].addEventListener("MSPointerUp",this.mouseUp),this._$container[0].addEventListener("MSPointerDown",this.mouseDown));a.browser.touchSupported&&(this._$container.bind("touchstart",this.touchStart),this._$container.bind("touchend",this.touchEnd));
this.status=a.tool.Tool.STARTED;this.fire(b.type,b);return this},end:function(){},clear:function(){this.finish();this.clear_base()}});c.OM=a})(window);